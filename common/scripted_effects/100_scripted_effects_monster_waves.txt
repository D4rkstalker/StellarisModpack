##########################################################################
# Scripted Effects for Monster Waves
#
# Written by ScepraX
##########################################################################

# Creates the monster countries
create_monster_waves_countries = {
	create_tiyanki_country_monster_waves = yes
	create_amoeba_country_monster_waves = yes
	create_cloud_country_monster_waves = yes
	create_drone_country_monster_waves = yes
	create_crystal_country_monster_waves = yes
	
	# Disable attacking enclave stations
	every_country = {
		limit = { 
			is_country_type = enclave 
		}
		every_country = {
			limit = { 
				OR = {
					is_country_type = tiyanki 
					is_country_type = amoeba 
					is_country_type = cloud 
					is_country_type = drone 
					is_country_type = crystal 
					is_country_type = monster_waves_tiyanki 
					is_country_type = monster_waves_amoeba 
					is_country_type = monster_waves_cloud 
					is_country_type = monster_waves_drone 
					is_country_type = monster_waves_crystal 
				}
			}
			
			set_faction_hostility = {
				target = PREV
				set_hostile = no
				set_neutral = no
				set_friendly = yes
			}
		}
	}

	# Tiyankis are neutral to some other monsters
	every_country = {
		limit = {
			OR = {
				is_country_type = tiyanki
				is_country_type = monster_waves_tiyanki
			}
		}
		every_country = {
			limit = {
				OR = {
					is_country_type = crystal
					is_country_type = cloud
					is_country_type = monster_waves_crystal
					is_country_type = monster_waves_cloud
				}				
			}
			set_faction_hostility = {
				target = prev
				set_hostile = no
				set_neutral = yes
				set_friendly = no
			}					
		}
	}
}

####################################
# Tiyanki
####################################

# Creates the Tiyanki country
create_tiyanki_country_monster_waves = {
	if = {
		limit = { 
			NOT = { 
				exists = event_target:monster_waves_tiyanki_country 
			} 
		}
		
		create_country = {
			name = "The Herd"
			type = monster_waves_tiyanki
			auto_delete = no
			flag = {
				icon = {
					category = "zoological"
					file = "flag_zoological_11.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"black"
					"black"
					"null"
					"null"
				}
			}
		}
		
		last_created_country = {
			save_global_event_target_as = monster_waves_tiyanki_country
			
			# Make yourselves known to everybody
			every_country = {
				limit = { 
					NOT = { 
						has_communications = event_target:monster_waves_tiyanki_country
					} 
				}
				
				establish_communications_no_message = event_target:monster_waves_tiyanki_country
				event_target:monster_waves_tiyanki_country = {
					establish_communications_no_message = PREV
				}
			}
		}
		
		# log = "Created Tiyanki country."
	}
}

create_hostile_tiyanki_country_monster_waves = {
	if = {
		limit = { 
			NOT = { 
				exists = event_target:monster_waves_hostile_tiyanki_country 
			} 
		}
		
		create_country = {
			name = "The Wild Herd"
			type = monster_waves_tiyanki
			auto_delete = yes
			flag = {
				icon = {
					category = "zoological"
					file = "flag_zoological_3.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"black"
					"black"
					"null"
					"null"
				}
			}
		}
		
		last_created_country = {
			save_global_event_target_as = monster_waves_hostile_tiyanki_country
			
			# Make the country hostile
			set_faction_hostility = { 
				set_hostile = yes 
			}
			
			# Make yourselves known to everybody
			every_country = {
				limit = { 
					NOT = { 
						has_communications = event_target:monster_waves_hostile_tiyanki_country
					} 
				}
				
				establish_communications_no_message = event_target:monster_waves_hostile_tiyanki_country
				event_target:monster_waves_hostile_tiyanki_country = {
					establish_communications_no_message = PREV
				}
			}
		}
		
		# log = "Created Hostile Tiyanki country."
	}
}

# Add the Monster Waves Tiyanki event chain to the FROM country.
add_monster_waves_tiyanki_event_chain = {
	if = {
		limit = {
			FROM = { 
				NOT = {
					has_event_chain = "monster_waves_tiyanki_event_chain"
				}
			}
		}
		
		begin_event_chain = {
			event_chain = "monster_waves_tiyanki_event_chain"
			target = FROM
		}
	}
}

# Create a Tiyanki fleet
create_monster_waves_tiyanki_fleet = {
	while = {
		count = 2
		
		random_list = {
			2 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= -40
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 10
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 60
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 10
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 60
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 110
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 160
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
			
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				create_ship = {
					name = "NAME_The_Matriarch"
					design = "NAME_Progenitor"
				}
			}
			98 = { 
				# Do nothing
			}
		}
	}
	
	create_ship = {
		name = "NAME_Cow"
		design = "NAME_Tiyanki_Cow"
	}
	
	create_ship = {
		name = "NAME_Bull"
		design = "NAME_Tiyanki_Bull"
	}
	
	while = {
		count = 6
		
		random_list = {
			8 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= -40
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 10
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 60
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 10
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 60
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 110
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 160
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
			
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				create_ship = {
					name = ""
					design = "NAME_Tiyanki_Calf"
				}
			}
			92 = {
				# Do nothing
			}
		}
	}
}

# Give the rewards for killing it based on ship type/size
add_monster_waves_tiyanki_reward = {
	if = {
		limit = {
			FROMFROM = {
				OR = {
					is_ship_size = wraith_01_blue
					is_ship_size = wraith_01_red
					is_ship_size = wraith_01_yellow
				}
			}
		}
		
		FROM = {
			add_resource = {
				food = 500
				society_research = 100
			}
		}
	}
		
	else_if = {
		limit = {
			FROMFROM = {
				is_ship_size = space_whale_4
			}
		}
		
		FROM = {
			add_resource = {
				food = 20
				society_research = 4
			}
		}
	}
	
	else_if = {
		limit = {
			FROMFROM = {
				OR = {
					is_ship_size = space_whale_1
					is_ship_size = space_whale_2
				}
			}
		}
		
		FROM = {
			add_resource = {
				food = 15
				society_research = 3
			}
		}
	}
	
	else_if = {
		limit = {
			FROMFROM = {
				is_ship_size = space_whale_3
			}
		}
		
		FROM = {
			add_resource = {
				food = 10
				society_research = 2
			}
		}
	}
}

####################################
# Amoeba
####################################

# Creates the Amoeba country
create_amoeba_country_monster_waves = {
	if = {
		limit = { 
			NOT = { 
				exists = event_target:monster_waves_amoeba_country 
			} 
		}
		
		create_country = {
			name = "Space Squids"
			type = monster_waves_amoeba
			auto_delete = no
			flag = {
				icon = {
					category = "zoological"
					file = "flag_zoological_17.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"black"
					"black"
					"null"
					"null"
				}
			}
		}
		
		last_created_country = {
			save_global_event_target_as = monster_waves_amoeba_country
			
			# Make yourselves known to everybody
			every_country = {
				limit = { 
					NOT = { 
						has_communications = event_target:monster_waves_amoeba_country
					} 
				}
				
				establish_communications_no_message = event_target:monster_waves_amoeba_country
				event_target:monster_waves_amoeba_country = {
					establish_communications_no_message = PREV
				}
			}
			
			# Make friendly with same country types
			every_country = {
				limit = { 
					NOT = {
						is_same_value = PREV
					}	
					is_country_type = amoeba 
				}
				
				set_faction_hostility = {
					target = PREV
					set_hostile = no
					set_neutral = no
					set_friendly = yes
				}
			}
		}
		
		# log = "Created Amoeba country."
	}
}

# Add the Monster Waves Amoeba event chain to the FROM country.
add_monster_waves_amoeba_event_chain = {
	if = {
		limit = {
			FROM = { 
				NOT = {
					has_event_chain = "monster_waves_amoeba_event_chain"
				}
			}
		}
		
		begin_event_chain = {
			event_chain = "monster_waves_amoeba_event_chain"
			target = FROM
		}
	}
}

# Create a Amoeba fleet
create_monster_waves_amoeba_fleet = {
	# Large Space Organism
	while = {
		count = 20
		
		random_list = {
			2 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= -30
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 20
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 70
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 20
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 70
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 120
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 170
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
			
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				random_list = {
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Large_Space_Organism_Blue"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Large_Space_Organism_Orange"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Large_Space_Organism_Teal"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Large_Space_Organism_Zebra"
						}
					}
				}	
			}
			98 = {
				# Do nothing
			}
		}
	}
	
	# Small Space Organism
	while = {
		count = 80
		
		random_list = {
			2 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= -30
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 20
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 70
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 20
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 70
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 120
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 170
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
				
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				random_list = {
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Small_Space_Organism_Blue"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Small_Space_Organism_Orange"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Small_Space_Organism_Teal"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Small_Space_Organism_Zebra"
						}
					}
				}	
			}
			98 = {
				# Do nothing
			}
		}
	}
}

# Give the rewards for killing it based on ship type/size
add_monster_waves_amoeba_reward = {
	if = {
		limit = {
			FROMFROM = {
				is_ship_size = space_dragon_red
			}
		}
		
		FROM = {
			add_resource = {
				food = 500
				society_research = 100
			}
		}
	}
	
	else_if = {
		limit = {
			FROMFROM = {
				is_ship_size = space_dragon_baby
			}
		}
		
		FROM = {
			add_resource = {
				food = 250
				society_research = 50
			}
		}
	}
	
	else_if = {
		limit = {
			FROMFROM = {
				is_ship_size = space_amoeba_mother
			}
		}
		
		FROM = {
			add_resource = {
				food = 25
				society_research = 5
			}
		}
	}
	
	else_if = {
		limit = {
			FROMFROM = {
				is_ship_size = space_amoeba
			}
		}
		
		FROM = {
			add_resource = {
				food = 5
				society_research = 1
			}
		}
	}
}

####################################
# Cloud
####################################

# Creates the Void Cloud country
create_cloud_country_monster_waves = {
	if = {
		limit = { 
			NOT = { 
				exists = event_target:monster_waves_cloud_country 
			} 
		}
		
		create_country = {
			name = "Electric Void"
			type = monster_waves_cloud
			auto_delete = no
			flag = {
				icon = {
					category = "zoological"
					file = "flag_zoological_20.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"black"
					"black"
					"null"
					"null"
				}
			}
		}
		
		last_created_country = {
			save_global_event_target_as = monster_waves_cloud_country
			
			# Clouds have a country modifier
			add_modifier = {
				modifier = cloud_power
				days = -1
			}
			
			# Make yourselves known to everybody
			every_country = {
				limit = { 
					NOT = { 
						has_communications = event_target:monster_waves_cloud_country
					} 
				}
				
				establish_communications_no_message = event_target:monster_waves_cloud_country
				event_target:monster_waves_cloud_country = {
					establish_communications_no_message = PREV
				}
			}
			
			# Make friendly with same country types
			every_country = {
				limit = { 
					NOT = {
						is_same_value = PREV
					}	
					is_country_type = cloud 
				}
				
				set_faction_hostility = {
					target = PREV
					set_hostile = no
					set_neutral = no
					set_friendly = yes
				}
			}
		}
		
		# log = "Created Cloud country."
	}
}

# Add the Monster Waves Cloud event chain to the FROM country.
add_monster_waves_cloud_event_chain = {
	if = {
		limit = {
			FROM = { 
				NOT = {
					has_event_chain = "monster_waves_cloud_event_chain"
				}
			}
		}
		
		begin_event_chain = {
			event_chain = "monster_waves_cloud_event_chain"
			target = FROM
		}
	}
}

# Create a Cloud fleet
create_monster_waves_cloud_fleet = {
	# Void Clouds
	while = {
		count = 10
		
		random_list = {
			2 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= -20
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 30
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 80
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 30
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 80
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 130
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 180
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
				
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				create_ship = {
					name = ""
					design = "NAME_Void_Cloud"
				}
			}
			98 = {
				# Do nothing
			}
		}
	}
}

# Give the rewards for killing it based on ship type/size
add_monster_waves_cloud_reward = {
	if = {
		limit = {
			FROMFROM = {
				is_ship_size = monster_waves_cloud
			}
		}
		
		FROM = {
			add_resource = {
				energy = 500
				physics_research = 100
			}
		}
	}
	
	else_if = {
		limit = {
			FROMFROM = {
				is_ship_size = space_cloud
			}
		}
		
		FROM = {
			add_resource = {
				energy = 50
				physics_research = 10
			}
		}
	}
}

####################################
# Drone
####################################

# Creates the Mining Drone country
create_drone_country_monster_waves = {
	if = {
		limit = { 
			NOT = { 
				exists = event_target:monster_waves_drone_country 
			} 
		}
			
		create_country = {
			name = "Collective Mineral Extractors"
			type = monster_waves_drone
			auto_delete = no
			flag = {
				icon = {
					category = "zoological"
					file = "flag_zoological_2.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"black"
					"orange"
					"null"
					"null"
				}
			}
		}
		
		last_created_country = {
			save_global_event_target_as = monster_waves_drone_country
			
			# Drones need a graphical culture
			set_graphical_culture = ancient_drone_01
			
			# Make yourselves known to everybody
			every_country = {
				limit = { 
					NOT = { 
						has_communications = event_target:monster_waves_drone_country
					} 
				}
				
				establish_communications_no_message = event_target:monster_waves_drone_country
				event_target:monster_waves_drone_country = {
					establish_communications_no_message = PREV
				}
			}
			
			# Make friendly with same country types
			every_country = {
				limit = { 
					NOT = {
						is_same_value = PREV
					}	
					is_country_type = drone 
				}
				
				set_faction_hostility = {
					target = PREV
					set_hostile = no
					set_neutral = no
					set_friendly = yes
				}
			}
			
			# Fallen Empire Machine countries are friendly
			every_country = {
				limit = {
					has_country_flag = fallen_empire_machine
				}
				every_country = {
					limit = {
						is_country_type = drone
					}
					
					set_faction_hostility = {
						target = prev
						set_hostile = no
						set_neutral = no
						set_friendly = yes
					}					
				}
			}
		}
		
		# log = "Created Drone country."
	}
}

# Add the Monster Waves Drone event chain to the FROM country.
add_monster_waves_drone_event_chain = {
	if = {
		limit = {
			FROM = { 
				NOT = {
					has_event_chain = "monster_waves_drone_event_chain"
				}
			}
		}
		
		begin_event_chain = {
			event_chain = "monster_waves_drone_event_chain"
			target = FROM
		}
	}
}

# Create a Drone fleet
create_monster_waves_drone_fleet = {
	# Carrier
	random_list = {
		2 = {
			modifier = {
				factor = 2
				mid_game_years_passed >= -10
			}
			modifier = {
				factor = 2
				mid_game_years_passed >= 40
			}
			modifier = {
				factor = 2
				mid_game_years_passed >= 90
			}
			modifier = {
				factor = 2
				end_game_years_passed >= 40
			}
			modifier = {
				factor = 2
				end_game_years_passed >= 90
			}
			modifier = {
				factor = 2
				end_game_years_passed >= 140
			}
			modifier = {
				factor = 2
				end_game_years_passed >= 190
			}
			
			modifier = {
				factor = 2
				is_monster_waves_fleet_power_1 = yes
			}
			modifier = {
				factor = 2
				is_monster_waves_fleet_power_2 = yes
			}
			modifier = {
				factor = 2
				is_monster_waves_fleet_power_3 = yes
			}
			modifier = {
				factor = 2
				is_monster_waves_fleet_power_4 = yes
			}
			modifier = {
				factor = 2
				is_monster_waves_fleet_power_5 = yes
			}
			
			# Difficulty modifiers
			modifier = {
				factor = 0.25
				is_monster_waves_very_easy = yes
			}
			modifier = {
				factor = 0.5
				is_monster_waves_easy = yes
			}
			modifier = {
				factor = 2.0
				is_monster_waves_hard = yes
			}
			modifier = {
				factor = 4.0
				is_monster_waves_insane = yes
			}
		
			create_ship = {
				name = ""
				design = "NAME_Antique_Carrier_Drone"
			}
		}
		98 = {
			# Do nothing
		}
	}

	# Destroyers
	while = {
		count = 25
		
		random_list = {
			2 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= -10
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 40
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 90
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 40
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 90
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 140
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 190
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
			
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				create_ship = {
					name = ""
					design = "NAME_Antique_Destroyer"
				}
			}
			98 = {
				# Do nothing
			}
		}
	}
	
	# Combat Drones
	while = {
		count = 50
		
		random_list = {
			2 = {	
				modifier = {
					factor = 2
					mid_game_years_passed >= -10
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 40
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 90
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 40
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 90
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 140
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 190
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
			
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				create_ship = {
					name = ""
					design = "NAME_Antique_Combat_Drone"
				}
			}
			98 = {
				# Do nothing
			}
		}
	}
		
	# Mining Drones
	while = {
		count = 100
		
		random_list = {
			2 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= -10
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 40
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 90
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 40
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 90
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 140
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 190
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
				
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				create_ship = {
					name = ""
					design = "NAME_Antique_Mining_Drone"
				}
			}
			98 = {
				# Do nothing
			}
		}
	}
}

# Give the rewards for killing it based on ship type/size
add_monster_waves_drone_reward = {
	if = {
		limit = {
			FROMFROM = {
				is_ship_size = monster_waves_drone
			}
		}
		
		FROM = {
			add_resource = {
				minerals = 250
				energy = 250
				engineering_research = 100
			}
		}
	}
	
	else_if = {
		limit = {
			FROMFROM = {
				is_ship_size = monster_waves_drone_carrier
			}
		}
		
		FROM = {
			add_resource = {
				minerals = 25
				energy = 25
				engineering_research = 10
			}
		}
	}
	
	else_if = {
		limit = {
			FROMFROM = {
				is_ship_size = ancient_destroyer
			}
		}
		
		FROM = {
			add_resource = {
				minerals = 10
				energy = 10
				engineering_research = 4
			}
		}
	}
	
	else_if = {
		limit = {
			FROMFROM = {
				OR = {
					is_ship_size = ancient_mining_drone
					is_ship_size = ancient_corvette
				}
			}
		}
		
		FROM = {
			add_resource = {
				minerals = 5
				energy = 5
				engineering_research = 2
			}
		}
	}
}

####################################
# Crystal
####################################

# Creates the Crystalline Entity country
create_crystal_country_monster_waves = {
	if = {
		limit = {
			NOT = {
				exists = event_target:monster_waves_crystal_country
			}
		}
		create_country = {
			name = "Spectrum"
			type = monster_waves_crystal
			auto_delete = no
			flag = {
				icon = {
					category = "zoological"
					file = "flag_zoological_1.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"black"
					"black"
					"null"
					"null"
				}
			}
		}
		last_created_country = {
			save_global_event_target_as = monster_waves_crystal_country
			
			# Make yourselves known to everybody
			every_country = {
				limit = { 
					NOT = { 
						has_communications = event_target:monster_waves_crystal_country
					} 
				}
				
				establish_communications_no_message = event_target:monster_waves_crystal_country
				event_target:monster_waves_crystal_country = {
					establish_communications_no_message = PREV
				}
			}
			
			# Make friendly with same country types
			every_country = {
				limit = { 
					NOT = {
						is_same_value = PREV
					}	
					is_country_type = crystal 
				}
				
				set_faction_hostility = {
					target = PREV
					set_hostile = no
					set_neutral = no
					set_friendly = yes
				}
			}
		}
		
		# log = "Created Crystal country."
	}
}

# Add the Monster Waves Crystal event chain to the FROM country.
add_monster_waves_crystal_event_chain = {
	if = {
		limit = {
			FROM = { 
				NOT = {
					has_event_chain = "monster_waves_crystal_event_chain"
				}
			}
		}
		
		begin_event_chain = {
			event_chain = "monster_waves_crystal_event_chain"
			target = FROM
		}
	}
}

# Create a Crystal fleet
create_monster_waves_crystal_fleet = {
	# Large Crystal
	while = {
		count = 20
		
		random_list = {
			2 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= 0
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 50
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 0
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 50
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 100
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 150
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 200
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
				
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				random_list = {
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Large_Crystal_Blue"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Large_Crystal_Green"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Large_Crystal_Yellow"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Large_Crystal_Red"
						}
					}
				}	
			}
			98 = {
				# Do nothing
			}
		}
	}
	
	# Medium Crystal
	while = {
		count = 40
		
		random_list = {
			2 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= 0
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 50
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 0
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 50
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 100
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 150
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 200
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
				
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				random_list = {
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Medium_Crystal_Blue"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Medium_Crystal_Green"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Medium_Crystal_Yellow"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Medium_Crystal_Red"
						}
					}
				}	
			}
			98 = {
				# Do nothing
			}
		}
	}
	
	# Small Crystal
	while = {
		count = 80
		
		random_list = {
			2 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= 0
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 50
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 0
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 50
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 100
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 150
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 200
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
			
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				random_list = {
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Small_Crystal_Blue"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Small_Crystal_Green"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Small_Crystal_Yellow"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Small_Crystal_Red"
						}
					}
				}	
			}
			98 = {
				# Do nothing
			}
		}
	}
}

# Create a Elite Crystal fleet
create_monster_waves_crystal_elite_fleet = {
	# Large Crystal
	while = {
		count = 20
		
		random_list = {
			4 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= 0
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 50
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 0
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 50
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 100
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 150
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 200
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
				
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				random_list = {
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Large_Crystal_Blue_Elite"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Large_Crystal_Green_Elite"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Large_Crystal_Yellow_Elite"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Large_Crystal_Red_Elite"
						}
					}
				}	
			}
			96 = {
				# Do nothing
			}
		}
	}
	
	# Medium Crystal
	while = {
		count = 40
		
		random_list = {
			4 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= 0
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 50
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 0
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 50
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 100
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 150
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 200
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
			
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				random_list = {
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Medium_Crystal_Blue_Elite"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Medium_Crystal_Green_Elite"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Medium_Crystal_Yellow_Elite"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Medium_Crystal_Red_Elite"
						}
					}
				}	
			}
			96 = {
				# Do nothing
			}
		}
	}
	
	# Small Crystal
	while = {
		count = 80
		
		random_list = {
			4 = {
				modifier = {
					factor = 2
					mid_game_years_passed >= 0
				}
				modifier = {
					factor = 2
					mid_game_years_passed >= 50
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 0
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 50
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 100
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 150
				}
				modifier = {
					factor = 2
					end_game_years_passed >= 200
				}
				
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_1 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_2 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_3 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_4 = yes
				}
				modifier = {
					factor = 2
					is_monster_waves_fleet_power_5 = yes
				}
			
				# Difficulty modifiers
				modifier = {
					factor = 0.25
					is_monster_waves_very_easy = yes
				}
				modifier = {
					factor = 0.5
					is_monster_waves_easy = yes
				}
				modifier = {
					factor = 2.0
					is_monster_waves_hard = yes
				}
				modifier = {
					factor = 4.0
					is_monster_waves_insane = yes
				}
			
				random_list = {
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Small_Crystal_Blue_Elite"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Small_Crystal_Green_Elite"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Small_Crystal_Yellow_Elite"
						}
					}
					25 = {
						create_ship = {
							name = ""
							design = "NAME_Small_Crystal_Red_Elite"
						}
					}
				}	
			}
			96 = {
				# Do nothing
			}
		}
	}
}

# Give the rewards for killing it based on ship type/size
add_monster_waves_crystal_reward = {
	if = {
		limit = {
			FROMFROM = {
				OR = {
					is_ship_size = monster_waves_crystal
					is_ship_size = crystal_station_large
				}
			}
		}
		
		FROM = {
			add_resource = {
				minerals = 500
				physics_research = 100
			}
		}
	}
	
	else_if = {
		limit = {
			FROMFROM = {
				OR = {
					is_ship_size = crystal_ship_large_blue
					is_ship_size = crystal_ship_large_green
					is_ship_size = crystal_ship_large_yellow
					is_ship_size = crystal_ship_large_red
					is_ship_size = crystal_ship_large_blue_elite
					is_ship_size = crystal_ship_large_green_elite
					is_ship_size = crystal_ship_large_yellow_elite
					is_ship_size = crystal_ship_large_red_elite
				}
			}
		}
		
		FROM = {
			add_resource = {
				minerals = 50
				physics_research = 10
			}
		}
	}
	
	else_if = {
		limit = {
			FROMFROM = {
				OR = {
					is_ship_size = crystal_ship_medium_blue
					is_ship_size = crystal_ship_medium_green
					is_ship_size = crystal_ship_medium_yellow
					is_ship_size = crystal_ship_medium_red
					is_ship_size = crystal_ship_medium_blue_elite
					is_ship_size = crystal_ship_medium_green_elite
					is_ship_size = crystal_ship_medium_yellow_elite
					is_ship_size = crystal_ship_medium_red_elite
				}
			}
		}
		
		FROM = {
			add_resource = {
				minerals = 20
				physics_research = 4
			}
		}
	}
	
	else_if = {
		limit = {
			FROMFROM = {
				OR = {
					is_ship_size = crystal_ship_small_blue
					is_ship_size = crystal_ship_small_green
					is_ship_size = crystal_ship_small_yellow
					is_ship_size = crystal_ship_small_red
					is_ship_size = crystal_ship_small_blue_elite
					is_ship_size = crystal_ship_small_green_elite
					is_ship_size = crystal_ship_small_yellow_elite
					is_ship_size = crystal_ship_small_red_elite
				}
			}
		}
		
		FROM = {
			add_resource = {
				minerals = 10
				physics_research = 2
			}
		}
	}
}
