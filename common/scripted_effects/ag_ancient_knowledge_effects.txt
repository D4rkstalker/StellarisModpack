
ag_change_ancient_knowledge_action_state = {
	optimize_memory
	if = {
		limit = { has_country_flag = ag_ancient_knowledge_action_$ag_action_id$ }
		remove_country_flag = ag_ancient_knowledge_action_$ag_action_id$
		subtract_variable = { which = ag_num_actived_knowledge_actions value = 1 }
	}
	else = {
		set_country_flag = ag_ancient_knowledge_action_$ag_action_id$
		change_variable = { which = ag_num_actived_knowledge_actions value = 1 }
	}
}
ag_restart_ancient_knowledge_event = {
	optimize_memory
	remove_country_flag = ag_ancient_knowledge_window_opened
	country_event = { id = ag_ancient_knowledge.1 }
}

ag_add_ancient_knowledge = {
	optimize_memory
	add_resource = { ag_ancient_knowledge = 1 mult = $ag_value$ }
	# [[ag_custom_tooltip]custom_tooltip = $ag_custom_tooltip$]
	hidden_effect = {
		if = {
			limit = { NOT = { has_country_flag = ag_ancient_knowledge_noti_fired } }
			set_country_flag = ag_ancient_knowledge_noti_fired
			country_event = { id = ag_ancient_knowledge.2 }
		}
		set_variable = { which = ag_ancient_knowledge_var_temp value = $ag_value$ }
		if = {
			limit = { always = $ag_notification|no$ }
			create_message = {
				type = "message_ag_gain_ancient_knowledge"
				localization = $ag_notification_desc$
				days = 20
				target = this
				variable = {
					type = variable
					varname = ag_ancient_knowledge_var_temp
					localization = "ag_value"
					scope = this
				}
				[[ag_who]
					variable = {
						type = name
						localization = "ag_who"
						scope = $ag_who$
					}
				]
				[[ag_location]
					variable = {
						type = name
						localization = "ag_location"
						scope = $ag_location$
					}
				]
			}
		}
		clear_variable = ag_ancient_knowledge_var_temp
	}
}
ag_subtract_ancient_knowledge = {
	optimize_memory
	add_resource = { ag_ancient_knowledge = -1 mult = $ag_value$ }
	hidden_effect = { if = {
		limit = { resource_stockpile_compare = { resource = ag_ancient_knowledge value <= ag_num_using_ancient_knowledge } }
		set_variable = { which = ag_num_using_ancient_knowledge value = 0 }
		if = { limit = { has_modifier = "ag_ancient_knowledge_research_buff" } remove_modifier = "ag_ancient_knowledge_research_buff" remove_country_flag = ag_ancient_knowledge_action_1 }
		if = { limit = { has_modifier = "ag_ancient_knowledge_archaeology_buff" } remove_modifier = "ag_ancient_knowledge_archaeology_buff" remove_country_flag = ag_ancient_knowledge_action_2 }
		if = { limit = { has_modifier = "ag_ancient_knowledge_projects_buff" } remove_modifier = "ag_ancient_knowledge_projects_buff" remove_country_flag = ag_ancient_knowledge_action_3 }
		if = { limit = { has_modifier = "ag_ancient_knowledge_industry_buff" } remove_modifier = "ag_ancient_knowledge_industry_buff" remove_country_flag = ag_ancient_knowledge_action_4 }
		if = { limit = { has_modifier = "ag_ancient_knowledge_spacecraft_buff" } remove_modifier = "ag_ancient_knowledge_spacecraft_buff" remove_country_flag = ag_ancient_knowledge_action_5 }
		if = { limit = { has_modifier = "ag_ancient_knowledge_fleet_build_buff" } remove_modifier = "ag_ancient_knowledge_fleet_build_buff" remove_country_flag = ag_ancient_knowledge_action_6 }
		if = { limit = { has_modifier = "ag_ancient_knowledge_planet_construction_buff" } remove_modifier = "ag_ancient_knowledge_planet_construction_buff" remove_country_flag = ag_ancient_knowledge_action_7 }
		create_message = { type = "message_ag_insufficient_ancient_knowledge" localization = "message_ag_insufficient_ancient_knowledge_desc" days = 20 target = this }
	} }
}
