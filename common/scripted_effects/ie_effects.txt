ie_gate_setup = {
	while = {
		count = 1849
		create_pop = {
			species = owner_main_species
		}
	}

	if = {
		limit = { owner = { has_valid_civic = civic_machine_servitor } }
		last_created_species = {
			set_citizenship_type = {
				country = root.owner
				type = citizenship_limited
			}
			set_living_standard = {
				country = root.owner
				type = living_standard_organic_trophy
			}
		}
		while = {
			count = 100
			create_pop = {
				species = last_created_species
				ethos = random
			}
			last_created_pop = {
				clear_ethos = yes
			}
		}
	}

	if = {
		limit = { owner = { has_valid_civic = civic_machine_assimilator } }
		last_created_species = {
			set_citizenship_type = {
				country = root.owner
				type = citizenship_full_machine
			}
			set_living_standard = {
				country = root.owner
				type = living_standard_hive_mind
			}
		}
		while = {
			count = 100
			create_pop = {
				species = last_created_species
				ethos = random
			}
			last_created_pop = {
				clear_ethos = yes
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				OR = {
					has_valid_civic = civic_machine_assimilator
					has_valid_civic = civic_machine_servitor
					has_origin = origin_syncretic_evolution
					has_origin = origin_necrophage
				}
			}
		}

		if = {
			limit = { owner = { last_created_species = { is_lithoid = yes } } }
			owner = {
				set_country_flag = lithoid_subspecies
			}
		}
		else = {
			owner = {
				set_country_flag = non_lithoid_subspecies
			}
		}
	}
	
	set_planet_size = 25
	while = {
		count = 1
		add_district_and_planet_size_if_needed_effect = {
			district = district_ie_industrial
		}
	}
	add_district_and_planet_size_if_needed_effect = {
		district = district_ie_admin
	}
	if = {
		limit = { owner = { is_regular_empire = yes } }
		while = {
			count = 3
			add_district_and_planet_size_if_needed_effect = {
				district = district_ie_industrial
			}
		}
	}
	while = {
		count = 1
		add_district_and_planet_size_if_needed_effect = {
			district = district_ie_mining
		}
	}
	if = {
		limit = { owner = { is_regular_empire = yes } }
		while = {
			count = 1
			add_district_and_planet_size_if_needed_effect = {
				district = district_ie_mining
			}
		}
	}
	while = {
		count = 6
		add_district_and_planet_size_if_needed_effect = {
			district = district_ie_space_mining
		}
	}
	if = {
		limit = { owner = { is_regular_empire = yes } }
		add_district_and_planet_size_if_needed_effect = {
			district = district_ie_leisure
		}
	}
	if = {
		limit = { owner = { is_regular_empire = yes } }
		add_district_and_planet_size_if_needed_effect = {
			district = district_ie_city
		}
	}
	if = {
		limit = {
			owner = { NOT = { is_regular_empire = yes } }
			is_planet_class = pc_ie_gateway
		}
		while = {
			count = 1
			add_district_and_planet_size_if_needed_effect = {
				district = district_ie_generator
			}
		}
	}
	if = {
		limit = {
			is_planet_class = pc_ie_gateway
			owner = {
				NOR = {
					has_authority = auth_machine_intelligence
					is_lithoid_empire = yes
				}
			}
		}
		while = {
			count = 3
			add_district_and_planet_size_if_needed_effect = {
				district = district_ie_farming
			}
		}
	}
	if = {
		limit = { owner = { has_authority = auth_machine_intelligence } }
			while = {
				count = 4
				add_district_and_planet_size_if_needed_effect = {
					district = district_ie_nexus
				}
			}
			while = {
				count = 1
				add_district_and_planet_size_if_needed_effect = {
					district = district_ie_generator
				}
			}
	}
	if = {
		limit = { owner = { has_authority = auth_hive_mind } }
			while = {
				count = 2
				add_district_and_planet_size_if_needed_effect = {
					district = district_ie_hive
				}
			}
	}
	if = {
		limit = {
			is_planet_class = pc_ie_gateway
			owner = { is_lithoid_empire = yes }
		}
		while = {
			count = 3
			add_district_and_planet_size_if_needed_effect = {
				district = district_ie_mining
			}
		}
	}
	if = {
		limit = { owner = { has_valid_civic = civic_machine_servitor } }
			while = {
				count = 1
				add_district_and_planet_size_if_needed_effect = {
					district = district_ie_sanctuary
				}
			}
			while = {
				count = 1
				add_district_and_planet_size_if_needed_effect = {
					district = district_ie_farming
				}
			}
	}
	if = {
		limit = { owner = { has_valid_civic = civic_machine_assimilator } }
			while = {
				count = 2
				add_district_and_planet_size_if_needed_effect = {
					district = district_ie_farming
				}
			}
			while = {
				count = 1
				add_district_and_planet_size_if_needed_effect = {
					district = district_ie_nexus
				}
			}
	}
	if = {
		limit = { owner = { has_authority = auth_machine_intelligence } }
		add_building = building_ie_machine_assembly_plant
	}
	if = {
		limit = { owner = { has_authority = auth_hive_mind } }
		add_building = building_ie_spawning_pool
	}
	
	add_deposit = d_ie_md 
	add_deposit = d_ie_ds 
	add_deposit = d_ie_sn 
	add_deposit = d_ie_ai
	add_deposit = d_ie_ia
	add_deposit = d_ie_scc
	add_deposit = d_ie_ms
	add_deposit = d_ie_sa
	
	remove_building = building_colony_shelter
	remove_building = building_capital
	remove_building = building_major_capital
	remove_building = building_system_capital
	remove_building = building_imperial_capital
	remove_building = building_hive_capital
	remove_building = building_hive_major_capital
	remove_building = building_hab_capital
	remove_building = building_hab_major_capital
	remove_building = building_resort_capital
	remove_building = building_resort_major_capital
	remove_building = building_slave_capital
	remove_building = building_slave_major_capital
	remove_building = building_deployment_post
	remove_building = building_machine_capital
	remove_building = building_machine_major_capital
	remove_building = building_machine_system_capital
	remove_building = building_imperial_machine_capital
	remove_building = building_imperial_hive_capital
	
	if = {
			limit = { 
				owner = { has_authority = auth_machine_intelligence }
				is_planet_class = pc_ie_gateway
			}
			add_building = building_galactic_machine_capital
		}
	if = {
		limit = { 
			owner = { has_authority = auth_hive_mind } 
			is_planet_class = pc_ie_gateway
		}
		add_building = building_galactic_hive_capital
	}
	if = {
		limit = { 
			owner = { is_regular_empire = yes }
			is_planet_class = pc_ie_gateway
		}
		add_building = building_galactic_capital
	}
	set_country_flag = has_built_or_repaired_megastructure
}