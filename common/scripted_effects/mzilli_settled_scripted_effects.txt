create_mzilli_settled_colonies_1 = {
	if = { # Checks for guaranteed colony sites
		limit = {
			any_system_planet = {
				NOT = { has_planet_flag = dormant }
				has_planet_flag = mzilli_settled_planet #modders, add the flag "mzilli_settled_planet" to make this work
			}
		}
		random_system_planet = {
			limit = {
				NOT = { has_planet_flag = dormant }
				has_planet_flag = mzilli_settled_planet
			}
			set_planet_flag = dormant
			remove_planet_flag = mzilli_settled_planet
		}
	}
	else_if = { # Checks for habitable planets in your system
		limit = {
			any_system_planet = {
				NOR = {
					has_planet_flag = dormant
					exists = owner
					is_planet_class = pc_bespin
				}
				habitability = {
					who = event_target:dormant_world_owner.owner_species
					value >= 0.5
				}
			}
		}
		random_system_planet = {
			limit = {
				NOR = {
					has_planet_flag = dormant
					exists = owner
					is_planet_class = pc_bespin
				}
				habitability = {
					who = event_target:dormant_world_owner.owner_species
					value >= 0.5
				}
			}
			set_planet_flag = dormant
		}
	}
	else_if = { # Checks for semi-habitable planets in your system
		limit = {
			any_system_planet = {
				NOR = {
					has_planet_flag = dormant
					exists = owner
					is_planet_class = pc_bespin
				}
				habitability = {
					who = event_target:dormant_world_owner.owner_species
					value > 0
				}
			}
		}
		random_system_planet = {
			limit = {
				NOR = {
					has_planet_flag = dormant
					exists = owner
					is_planet_class = pc_bespin
				}
				habitability = {
					who = event_target:dormant_world_owner.owner_species
					value > 0
				}
			}
			set_planet_flag = dormant
		}
	}
	else_if = { # Next checks for any moons orbiting your homeworld, i.e. Luna
		limit = {
			event_target:dormant_world_owner = {
				capital_scope = {
					has_moon = yes
					any_moon = {
						NOR = {
							has_planet_flag = dormant
							is_planet_class = pc_toxic
							is_planet_class = pc_frozen
							exists = owner
						}
					}
				}
			}
		}
		event_target:dormant_world_owner = {
			capital_scope = {
				random_moon = {
					limit = {
						NOR = {
							has_planet_flag = dormant
							is_planet_class = pc_toxic
							is_planet_class = pc_frozen
							exists = owner
						}
					}
					set_planet_flag = dormant
				}
			}
		}
	}
	else_if = { # Terraforming Candidates, i.e. Mars
		limit = {
			any_system_planet = {
				has_modifier = "terraforming_candidate"
				OR = {
					is_planet_class = pc_barren
					is_planet_class = pc_barren_cold
				}
				NOR = {
					has_planet_flag = dormant
					has_planet_flag = b_planet
					has_planet_flag = c_planet
					has_planet_flag = e_planet
					has_planet_flag = d_planet
					has_planet_flag = f_planet
				}
			}
		}
		random_system_planet = {
			limit = {
				has_modifier = "terraforming_candidate"
				OR = {
					is_planet_class = pc_barren
					is_planet_class = pc_barren_cold
				}
				NOR = {
					has_planet_flag = dormant
					has_planet_flag = b_planet
					has_planet_flag = c_planet
					has_planet_flag = e_planet
					has_planet_flag = d_planet
					has_planet_flag = f_planet
				}
			}
			set_planet_flag = dormant
		}
	}
	else_if = { # Titan
		limit = { solar_system = { has_star_flag = sol } }
		random_system_planet = {
			limit = {
				OR = {
					is_planet_class = pc_gas_giant
					is_planet_class = pc_bespin
				}
				has_ring = yes
				has_moon = yes
			}
			random_moon = {
				limit = {
					is_planet_class = pc_frozen
					NOT = { has_planet_flag = dormant }
				}
				set_planet_flag = dormant
				set_planet_flag = moon_titan
			}	
		}
	}
	else_if = { # Ganymede
		limit = { solar_system = { has_star_flag = sol } }
		random_system_planet = {
			limit = {
				is_planet_class = pc_frozen
				is_moon = yes
				planet_size = 9
				NOT = { has_planet_flag = dormant }
			}
			set_planet_flag = dormant
			set_planet_flag = moon_ganymede	
		}
	}
	else_if = { # Any large-ish Barren World
		limit = {
			any_system_planet = {
				OR = {
					is_planet_class = pc_barren
					is_planet_class = pc_barren_cold
				}
				NOR = {
					has_planet_flag = dormant
					has_planet_flag = b_planet
					has_planet_flag = c_planet
					has_planet_flag = e_planet
					has_planet_flag = d_planet
					has_planet_flag = f_planet
				}
				planet_size >= 12
			}
		}
		random_system_planet = {
			limit = {
				OR = {
					is_planet_class = pc_barren
					is_planet_class = pc_barren_cold
				}
				NOR = {
					has_planet_flag = dormant
					has_planet_flag = b_planet
					has_planet_flag = c_planet
					has_planet_flag = e_planet
					has_planet_flag = d_planet
					has_planet_flag = f_planet
				}
				planet_size >= 12
			}
			set_planet_flag = dormant
		}
	}
	else_if = { # Any Barren World at all
		limit = {
			any_system_planet = {
				OR = {
					is_planet_class = pc_barren
					is_planet_class = pc_barren_cold
				}
				NOT = { has_planet_flag = dormant }
			}
		}
		random_system_planet = {
			limit = {
				OR = {
					is_planet_class = pc_barren
					is_planet_class = pc_barren_cold
				}
				NOT = { has_planet_flag = dormant }
			}
			set_planet_flag = dormant
		}
	}
	else_if = { # Toxic Worlds
		limit = {
			any_system_planet = {
				is_planet_class = pc_toxic
				NOT = { has_planet_flag = dormant }
			}
		}
		random_system_planet = {
			limit = {
				is_planet_class = pc_toxic
				NOT = { has_planet_flag = dormant }
			}
			set_planet_flag = dormant
		}
	}
	else_if = { # Helios/New Luna
		limit = { solar_system = { has_star_flag = deneb_system } }
		random_system_planet = {
			limit = {
				is_planet_class = pc_frozen
				is_moon = yes
			}
			set_planet_flag = dormant
		}
	}
	#else_if = { # Inferno
	#	limit = { solar_system = { has_star_flag = deneb_system } }
	#	random_system_planet = {
	#		limit = { is_planet_class = pc_molten }
	#		set_planet_flag = dormant
	#		set_planet_flag = planet_inferno
	#	}
	#}
	else_if = { # Molten Worlds
		limit = { any_system_planet = { is_planet_class = pc_molten } }
		random_system_planet = {
			limit = {
				is_planet_class = pc_molten
				NOT = { has_planet_flag = dormant }
			}
			set_planet_flag = dormant
			set_planet_flag = former_molten
		}
	}
	else = { # Frozen Worlds
		random_system_planet = {
			limit = {
				is_planet_class = pc_frozen
				NOT = { has_planet_flag = dormant }
			}
			set_planet_flag = dormant
			set_planet_flag = former_frozen
		}
	}
}

create_mzilli_settled_colonies_2 = {
	random_system_planet = {
		limit = { has_planet_flag = dormant }
		set_planet_flag = former_dormant
		remove_planet_flag = dormant
		if = {
			limit = { NOT = { is_colonizable = yes } }
			if = {
				limit = { planet_size < 10 }
				set_planet_size = 10
			}
			else_if = {
				limit = { planet_size > 25 }
				set_planet_size = 25
			}
			set_timed_planet_flag = { # The planet takes a few days to stabilize; this prevents unrest events
				flag = recent_unrest_event
				days = 60
			}
			if = {
				limit = { # Is this Mars?
					OR = {
						has_planet_flag = planet_mars
						AND = {
							solar_system = { has_star_flag = sol }
							is_planet_class = pc_barren
							NOT = { has_planet_flag = not_mars }
						}
					}
				}
				set_planet_flag = dormant_mars
				change_pc = pc_dormant
				set_planet_entity = { entity = "dormant_planet_mars_entity" }
				add_modifier {		
					modifier = "mineral_rich"
					days = -1
				}
				if = {
					limit = { NOT = { has_modifier = weak_magnetic_field } }
					add_modifier {		
						modifier = "weak_magnetic_field"
						days = -1
					}
				}
			}
			else_if = {
				limit = { # Is this Luna?
					OR = {
						has_planet_flag = moon_luna
						AND = {
							solar_system = { has_star_flag = sol }
							is_moon = yes
							is_planet_class = pc_barren_cold
							NOT = { has_planet_flag = not_luna }
						}
					}
				}
				set_planet_flag = dormant_luna
				change_pc = pc_dormant_cold
				set_planet_entity = { entity = "dormant_cold_planet_luna_entity" }
			}
			else = {
				if = {
					limit = {
						OR = {
							is_planet_class = pc_molten
							is_planet_class = pc_toxic
						}
					}
					change_pc = pc_dormant_toxic
				}
				else_if = {
					limit = {
						OR = {
							is_planet_class = pc_barren
							has_planet_flag = moon_titan
						}
					}
					change_pc = pc_dormant
					if = {
						limit = { has_planet_flag = moon_titan }
						set_planet_entity = { entity = "dormant_planet_titan_entity" }
						add_modifier = {
							modifier = "low_gravity"
							days = -1
						}
					}
				}
				else_if = {
					limit = { is_planet_class = pc_frozen }
					change_pc = pc_dormant_frozen
					if = {
						limit = {
							OR = {
								has_planet_flag = planet_helios
								has_planet_flag = planet_new_luna
							}
						}
						set_planet_entity = { entity = "dormant_frozen_planet_01_entity" }
					}
					else_if = {
						limit = { has_planet_flag = moon_ganymede }
						set_planet_entity = { entity = "dormant_frozen_planet_02_entity" }
					}
				}
				else = { change_pc = pc_dormant_cold }
				if = {
					limit = { solar_system = { NOT = { has_star_flag = sol } } }
					random_list = {
						95 = { }
						10 = {
							modifier = {
								factor = 0.5
								solar_system = { any_system_planet = { has_modifier = "unstable_tectonics" } }
							}
							modifier = {
								factor = 1.5
								is_planet_class = pc_dormant_toxic
							}
							add_modifier {		
								modifier = "unstable_tectonics"
								days = -1
							}
						}
						10 = {
							modifier = {
								factor = 0.5
								solar_system = { any_system_planet = { has_modifier = "weak_magnetic_field" } }
							}
							add_modifier {		
								modifier = "weak_magnetic_field"
								days = -1
							}
						}
						10 = {
							modifier = {
								factor = 0.5
								solar_system = { any_system_planet = { has_modifier = "strong_magnetic_field" } }
							}
							add_modifier {		
								modifier = "strong_magnetic_field"
								days = -1
							}
						}
						10 = {
							modifier = {
								factor = 0.5
								solar_system = { any_system_planet = { has_modifier = "low_gravity" } }
							}
							modifier = {
								factor = 0
								planet_size > 10
							}
							add_modifier {		
								modifier = "low_gravity"
								days = -1
							}
						}
						10 = {
							modifier = {
								factor = 0.5
								solar_system = { any_system_planet = { has_modifier = "high_gravity" } }
							}
							modifier = {
								factor = 0
								planet_size < 17
							}
							add_modifier {		
								modifier = "high_gravity"
								days = -1
							}
						}
						10 = {
							modifier = {
								factor = 0.5
								solar_system = { any_system_planet = { has_modifier = "mineral_rich" } }
							}
							add_modifier {		
								modifier = "mineral_rich"
								days = -1
							}
						}
						10 = {
							modifier = {
								factor = 0
								OR = {
									has_ring = no
									has_modifier = "asteroid_belt"
								}
							}
							modifier = {
								factor = 20
								has_ring = yes
								NOT = { has_modifier = "asteroid_belt" }
							}
							add_modifier {		
								modifier = "asteroid_belt"
								days = -1
							}
						}
						10 = {
							modifier = {
								factor = 0.5
								solar_system = { any_system_planet = { has_modifier = "natural_beauty" } }
							}
							add_modifier {		
								modifier = "natural_beauty"
								days = -1
							}
						}
						10 = {
							modifier = {
								factor = 0
								NOT = { is_planet_class = pc_dormant_toxic }
							}
							modifier = {
								factor = 0.5
								solar_system = { any_system_planet = { has_modifier = "wild_storms" } }
							}
							add_modifier {		
								modifier = "wild_storms"
								days = -1
							}
						}
						10 = {
							modifier = {
								factor = 0
								NOT = { is_planet_class = pc_dormant_toxic }
							}
							modifier = {
								factor = 0.5
								solar_system = { any_system_planet = { has_modifier = "wild_storms" } }
							}
							add_modifier {		
								modifier = "hazardous_weather"
								days = -1
							}
						}
					}
				}
			}
			dormant_world_deposits = yes
		}
		if = {
			limit = { exists = event_target:dormant_world_owner }
			set_owner = event_target:dormant_world_owner
			create_pop = { species = event_target:dormant_world_owner }
			create_pop = { species = event_target:dormant_world_owner }
			create_pop = { species = event_target:dormant_world_owner }
			#if = {
			#	limit = { event_target:dormant_world_owner = { has_authority = auth_hive_mind } }
			#	create_pop = { species = event_target:dormant_world_owner }
			#	create_pop = { species = event_target:dormant_world_owner }
			#}
		}
		if = {
			limit = { NOT = { event_target:dormant_world_owner = { has_authority = auth_hive_mind } } }
			add_building = building_colony_shelter
		}
		else = { add_building = building_hive_capital }
		if = {
			limit = { has_planet_flag = planet_mars }
			if = {
				limit = { NOT = { event_target:dormant_world_owner = { has_authority = auth_hive_mind } } }
				add_district = district_mining
			}
			else = { add_district = district_generator }
		}
		else_if = {
			limit = { has_planet_flag = moon_luna }
			add_district = district_generator
		}
		else = {
			random_list = {
				10 = {
					modifier = {
						factor = 100
						NOT = {
							solar_system = {
								any_system_planet = {
									has_planet_flag = former_dormant
									has_district = district_mining
								}
							}
						}
					}
					#modifier = {
					#	factor = 0
					#	event_target:dormant_world_owner = { has_authority = auth_hive_mind }
					#}
					add_district = district_mining
				}
				10 = {
					modifier = {
						factor = 100
						NOT = {
							solar_system = {
								any_system_planet = {
									has_planet_flag = former_dormant
									has_district = district_generator
								}
							}
						}
					}
					add_district = district_generator
				}
			}
		}
	}
}

dormant_world_deposits = {
	clear_deposits = yes
	if = {
		limit = { has_modifier = "terraforming_candidate" }
		remove_modifier = "terraforming_candidate"
	}
	add_modifier = {
		modifier = mzilli_settled_dormant
		days = -1
	}
	if = {
		limit = {
			OR = {
				is_planet_class = pc_dormant
				is_planet_class = pc_dormant_toxic
			}
		}
		add_deposit = d_geothermal_vent
	}
	else = { add_deposit = d_helium_3 }
	add_deposit = d_rich_mountain
	add_deposit = d_arid_highlands
	add_deposit = d_veiny_cliffs
	random_list = {
		10 = { add_deposit = d_arid_highlands }
		10 = { add_deposit = d_veiny_cliffs }
	}
	if = {
		limit = { planet_size > 12 }
		random_list = {
			10 = { add_deposit = d_searing_desert }
			10 = { add_deposit = d_prosperous_mesa }
		}
	}
	if = {
		limit = { planet_size > 15 }
		random_list = {
			10 = {
				add_deposit = d_arid_highlands
				add_deposit = d_arid_highlands
			}
			10 = { add_deposit = d_ore_rich_caverns }
		}
	}
	if = {
		limit = { planet_size > 18 }
		random_list = {
			10 = { add_deposit = d_arid_highlands }
			10 = { add_deposit = d_veiny_cliffs }
		}
	}
	if = {
		limit = { planet_size > 21 }
		if = {
			limit = {
				OR = {
					is_planet_class = pc_dormant
					is_planet_class = pc_dormant_toxic
				}
			}
			add_deposit = d_geothermal_vent
		}
		else = { add_deposit = d_helium_3 }
		add_deposit = d_rich_mountain
	}
}

dormant_world_food_1 = {
	if = {
		limit = { is_planet_class = pc_arctic }
		add_deposit = d_lichen_fields
	}
	else_if = {
		limit = {
			OR = {
				is_planet_class = pc_arid
				is_planet_class = pc_savannah
			}
		}
		add_deposit = d_bountiful_plains
	}
	else_if = {
		limit = { is_planet_class = pc_continental }
		add_deposit = d_rugged_woods
	}
	else_if = {
		limit = {
			OR = {
				is_planet_class = pc_ocean
				is_planet_class = pc_tropical
			}
		}
		add_deposit = d_green_hills
	}
	else_if = {
		limit = { is_planet_class = pc_gaia }
		add_deposit = d_natural_farmland
	}
	else_if = {
		limit = { is_planet_class = pc_desert }
		add_deposit = d_nutritious_mudland
	}
	else = { add_deposit = d_forgiving_tundra }
}

dormant_world_food_2 = {
	if = {
		limit = { is_cold = yes }
		add_deposit = d_fungal_caves
	}
	else_if = {
		limit = { is_planet_class = pc_desert }
		add_deposit = d_great_river
	}
	else_if = {
		limit = {
			OR = {
				is_planet_class = pc_gaia
				is_planet_class = pc_tropical
				is_planet_class = pc_ocean
			}
		}
		add_deposit = d_lush_jungle
	}
	else = { add_deposit = d_fertile_lands }
}

dormant_world_food = {
	dormant_world_food_1 = yes
	dormant_world_food_1 = yes
	# 3 Food
	if = {
		limit = { is_cold = yes }
		add_deposit = d_fungal_forest
	}
	else_if = {
		limit = { is_planet_class = pc_ocean }
		add_deposit = d_teeming_reef
	}
	else_if = {
		limit = {
			OR = {
				is_planet_class = pc_arid
				is_planet_class = pc_desert
				is_planet_class = pc_tropical
			}
		}
		add_deposit = d_tropical_island
	}
	else = { add_deposit = d_black_soil }

	if = {
		limit = { planet_size > 12 }
		random_list = {
			10 = { }
			10 = { dormant_world_food_2 = yes }
		}
	}

	if = {
		limit = { planet_size > 18 }
		random_list = {
			10 = { }
			10 = { dormant_world_food_1 = yes }
		}
	}

	if = {
		limit = { planet_size > 21 }
		random_list = {
			10 = { }
			10 = { dormant_world_food_1 = yes }
		}
	}

	if = {
		limit = {
			OR = {
				is_wet = yes
				is_planet_class = pc_gaia
			}
		}
		dormant_world_food_2 = yes
		random_list = {
			10 = { }
			10 = { dormant_world_food_2 = yes }
		}
	}
}