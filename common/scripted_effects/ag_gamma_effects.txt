
ag_gamma_station_colony_effect = {
	optimize_memory
	every_system_planet = {
		limit = {
			is_colony = yes
			num_pops > 0
			NOR = {
				ag_is_habitat = yes
				AND = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no }
			}
		}
		if = { limit = { NOT = { is_planet_class = pc_nuked } } ag_change_pc = { ag_planet_class = pc_nuked } }
		if = {
			limit = { NOT = { has_modifier = "ag_ancient_gamma_station_in_system" } }
			add_modifier = { modifier = "ag_ancient_gamma_station_in_system" days = -1 }
		}
	}
	every_country = {
		limit = {
			NOT = { is_same_value = event_target:ag_ancient_gamma_guardian_country }
			has_event_chain = "ag_gamma_guardian_crisis_chain"
		}
		add_event_chain_counter = { event_chain = "ag_gamma_guardian_crisis_chain" counter = "ag_gamma_station_small_deployed" amount = 1 }
	}
}

ag_remove_all_modifier_gamma = {
	optimize_memory
	if = { limit = { has_modifier = "ag_ancient_gamma_station_in_system" } remove_modifier = "ag_ancient_gamma_station_in_system" }
	if = { limit = { has_modifier = "ag_ancient_bombardment_effect_1" } remove_modifier = "ag_ancient_bombardment_effect_1" }
	if = { limit = { has_modifier = "holy_planet" } remove_modifier = "holy_planet" }
}

ag_gamma_station_damage_ship_in_system = {
	optimize_memory
	every_fleet_in_system = {
		limit = { owner = { NOT = { is_same_value = event_target:ag_ancient_gamma_guardian_country } } }
		every_controlled_ship = {
			limit = { NOT = { ag_is_ancient_ship = yes } }
			ag_reduce_hp_percent = { ag_value = $ag_gamma_damage_percent$ }
			ag_spawn_buff_effect = { ag_type = 4 ag_scale = s ag_color = red }
		}
	}
}

ag_gamma_situation_reward = {
	optimize_memory
	if = {
		limit = { NOT = { has_country_flag = ag_gamma_70_fired } }
		set_country_flag = ag_gamma_70_fired
		country_event = { id = ag_gamma.70 days = 5 random = 5 }
	}
	else = {
		random_list = {
			10 = {
				modifier = { factor = 0 has_country_flag = ag_gamma_73_fired }
				set_country_flag = ag_gamma_73_fired
				country_event = { id = ag_gamma.73 days = 5 random = 5 }
			}
			10 = {
				modifier = { factor = 0 has_country_flag = ag_gamma_170_fired }
				set_country_flag = ag_gamma_170_fired
				country_event = { id = ag_gamma.170 days = 5 random = 5 }
			}
			10 = {
				if = {
					limit = { NOT = { has_country_flag = ag_gamma_171_fired } }
					set_country_flag = ag_gamma_171_fired
					country_event = { id = ag_gamma.171 days = 5 random = 5 }
				}
				else = {
					set_country_flag = ag_gamma_172_fired
					country_event = { id = ag_gamma.172 days = 5 random = 5 }
				}
			}
		}
		reroll_random = yes
	}
}
