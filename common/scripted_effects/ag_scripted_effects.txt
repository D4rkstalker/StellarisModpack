
# ag_hostile_kill_counter = { ... }
# A counter on Victim's country to count how many ships belong to this country were destroyed, different ship class has different weight.
# this: Victim(Country Scope), owner of distroyed ship.
# prev: Victim(Ship Scope), distroyed ship.
# Parameters: 
# ag_variable_name: Name of the variable that used as the counter, can't be empty.
# ag_effect_corvette_class: Scripted effects that triggered when the victim ship belongs to the corvette class, default is do nothing.
# ag_effect_destroyer_class: Scripted effects that triggered when the victim ship belongs to the destroyer class, default is do nothing.
# ag_effect_cruiser_class: Scripted effects that triggered when the victim ship belongs to the cruiser class, default is do nothing.
# ag_effect_battleship_class: Scripted effects that triggered when the victim ship belongs to the battleship class, default is do nothing.
# ag_effect_titan_class: Scripted effects that triggered when the victim ship belongs to the titan class, default is do nothing.
# ag_effect_colossus_class: Scripted effects that triggered when the victim ship belongs to the colossus class, default is do nothing.
# ag_effect_ancient_class: Scripted effects that triggered when the victim ship is an ancient ship in this mod, default is do nothing.
# ag_effect_constructor_class: Scripted effects that triggered when the victim ship belongs to the constructor class, default is do nothing.
# ag_effect_colonizer_class: Scripted effects that triggered when the victim ship belongs to the colonizer class, default is do nothing.
# ag_effect_science_class: Scripted effects that triggered when the victim ship belongs to the science class, default is do nothing.
# ag_effect_transport_class: Scripted effects that triggered when the victim ship belongs to the transport class, default is do nothing.
# ag_effect_defensive_station_class: Scripted effects that triggered when the victim ship belongs to the defensive_station class, default is do nothing.
# ag_effect_starbase_class: Scripted effects that triggered when the victim ship belongs to the starbase class, default is do nothing.
# ag_effect_civilian_station_class: Scripted effects that triggered when the victim ship belongs to the civilian_station class, default is do nothing.

# ag_bin_search_x = { ... }, x = [3, 7].
# Binary search in [1, 2^x-1], export value to a variable.
# Formula: ag_variable(final) = ag_variable * ag_multiplier + ag_offset.
# Parameters: 
# ag_trigger: Simple triggers that accept <trigger> <operator> <integer> only.
# ag_scope: Exported variable's scope.
# ag_variable: Exported variable's name.
# ag_multiplier.
# ag_offset.

#######################################
###			Special Effects
#######################################

ag_spawn_buff_effect = {
	if = {
		limit = { NOT = { has_global_flag = ag_ancient_empire_mod_no_particle_effect } }
		create_ambient_object = {
			type = ag_ship_ability_buff_effect[[ag_color]_$ag_color$][[ag_scale]_$ag_scale$]
			play_animation_once = yes
			location = this
			duration = 10
			use_3d_location = yes
			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }
			entity_scale_to_size = yes
			scale = 1.0
		}
	}
}
ag_spawn_explosion_effect = {
	if = {
		limit = { NOT = { has_global_flag = ag_ancient_empire_mod_no_particle_effect } }
		create_ambient_object = {
			type = ag[[ag_scale]_$ag_scale$]_explosion[[ag_color]_$ag_color$]
			play_animation_once = yes
			location = this
			duration = 10
			use_3d_location = yes
			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }
			entity_scale_to_size = yes
			scale = 1.0
		}
	}
}

ag_ancient_planet_killer_hit_explosion = {
	create_ambient_object = {
		type = ag_ancient_planet_killer_hit_explosion
		location = this
		duration = 30
		
		use_3d_location = yes
		
		entity_offset = { min = 0 max = 0 }
		entity_offset_angle = { min = 0 max = 0 }
		entity_offset_height = { min = 0 max = 0 }
		
		entity_scale_to_size = yes
		scale = 0.32
	}
}

ag_spawn_jumpdrive_effect = {
	every_owned_ship = {
		create_ambient_object = {
			type = horror_spawn_object
			location = this

			use_3d_location = yes
			
			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }
			
			entity_scale_to_size = yes
			scale = @ag_jumpdrive_effect_scale
		}
	}
}

#######################################
###			Common Effects
#######################################

ag_print_scope = {
	switch = {
		trigger = is_scope_type
		country = { log = "[[ag_prifix]$ag_prifix$: ]Country Scope" }
		planet = { log = "[[ag_prifix]$ag_prifix$: ]Planet Scope" }
		fleet = { log = "[[ag_prifix]$ag_prifix$: ]Fleet Scope" }
		ship = { log = "[[ag_prifix]$ag_prifix$: ]Ship Scope" }
		sector = { log = "[[ag_prifix]$ag_prifix$: ]Sector Scope" }
		galactic_object = { log = "[[ag_prifix]$ag_prifix$: ]Galactic Object Scope" }
		megastructure = { log = "[[ag_prifix]$ag_prifix$: ]Megastructure Scope" }
		ambient_object = { log = "[[ag_prifix]$ag_prifix$: ]Ambient Object Scope" }
		deposit = { log = "[[ag_prifix]$ag_prifix$: ]Deposit Scope" }
		archeaological_site = { log = "[[ag_prifix]$ag_prifix$: ]Archeaological Site Scope" }
		army = { log = "[[ag_prifix]$ag_prifix$: ]Army Scope" }
		pop = { log = "[[ag_prifix]$ag_prifix$: ]Pop Scope" }
		species = { log = "[[ag_prifix]$ag_prifix$: ]Species Scope" }
		leader = { log = "[[ag_prifix]$ag_prifix$: ]Leader Scope" }
		pop_faction = { log = "[[ag_prifix]$ag_prifix$: ]Pop Faction Scope" }
		design = { log = "[[ag_prifix]$ag_prifix$: ]Design Scope" }
		federation = { log = "[[ag_prifix]$ag_prifix$: ]Federation Scope" }
		alliance = { log = "[[ag_prifix]$ag_prifix$: ]Alliance Scope" }
		war = { log = "[[ag_prifix]$ag_prifix$: ]War Scope" }
		starbase = { log = "[[ag_prifix]$ag_prifix$: ]Starbase Scope" }
		default = { log = "[[ag_prifix]$ag_prifix$: ]Unknown Scope(Default)" }
	}
}

ag_spawn_ancient_system = {
	save_event_target_as = ag_system_discover_country
	if = {
		limit = {
			any_system = {
				ag_spawnsystem_trigger = yes
			}
		}
		random_system = {
			limit = {
				ag_spawnsystem_trigger = yes
			}
			spawn_system = {
				min_distance >= 20
				max_distance <= 50
				initializer = $ag_system_to_spawn$
			}
		}
	}
	else_if = {
		limit = {
			any_rim_system = {
				ag_spawnsystem_trigger_fallback_1 = yes
			}
		}
		random_rim_system = {
			limit = {
				ag_spawnsystem_trigger_fallback_1 = yes
			}
			spawn_system = {
				min_distance >= 20
				max_distance <= 50
				initializer = $ag_system_to_spawn$
			}
		}
	}
	else_if = {
		limit = {
			any_system = {
				ag_spawnsystem_trigger_fallback_2 = yes
			}
		}
		random_system = {
			limit = {
				ag_spawnsystem_trigger_fallback_2 = yes
			}
			spawn_system = {
				min_distance >= 20
				max_distance <= 50
				initializer = $ag_system_to_spawn$
			}
		}
	}
	else_if = {
		limit = {
			always = yes
		}
		random_system = {
			spawn_system = {
				min_distance >= 20
				max_distance <= 50
				initializer = $ag_system_to_spawn$
			}
		}
	}
	if = {
		limit = {
			NOT = {
				has_event_chain = "ag_hidden_system_chain"
			}
		}
		begin_event_chain = {
			event_chain = "ag_hidden_system_chain"
			target = root.owner
		}
	}
}

ag_bin_search_3 = {
	if = { limit = { $ag_trigger$ = 4 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 4 } } }
	else_if = { limit = { $ag_trigger$ < 4 }
		if = { limit = { $ag_trigger$ = 2 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 2 } } }
		else_if = { limit = { $ag_trigger$ < 2 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 1 } } }
		else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 3 } } }
	}
	else_if = { limit = { always = yes }
		if = { limit = { $ag_trigger$ = 6 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 6 } } }
		else_if = { limit = { $ag_trigger$ < 6 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 5 } } }
		else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 7 } } }
	}
	if = {
		limit = { is_variable_set = $ag_variable$ }
		[[ag_multiplier]multiply_variable = { which = $ag_variable$ value = $ag_multiplier$ }]
		[[ag_offset]change_variable = { which = $ag_variable$ value = $ag_offset$ }]
	}
}
ag_bin_search_4 = {
	if = { limit = { $ag_trigger$ = 8 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 8 } } }
	else_if = { limit = { $ag_trigger$ < 8 }
		if = { limit = { $ag_trigger$ = 4 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 4 } } }
		else_if = { limit = { $ag_trigger$ < 4 }
			if = { limit = { $ag_trigger$ = 2 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 2 } } }
			else_if = { limit = { $ag_trigger$ < 2 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 1 } } }
			else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 3 } } }
		}
		else_if = { limit = { always = yes }
			if = { limit = { $ag_trigger$ = 6 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 6 } } }
			else_if = { limit = { $ag_trigger$ < 6 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 5 } } }
			else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 7 } } }
		}
	}
	else_if = { limit = { always = yes }
		if = { limit = { $ag_trigger$ = 12 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 12 } } }
		else_if = { limit = { $ag_trigger$ < 12 }
			if = { limit = { $ag_trigger$ = 10 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 10 } } }
			else_if = { limit = { $ag_trigger$ < 10 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 9 } } }
			else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 11 } } }
		}
		else_if = { limit = { always = yes }
			if = { limit = { $ag_trigger$ = 14 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 14 } } }
			else_if = { limit = { $ag_trigger$ < 14 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 13 } } }
			else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 15 } } }
		}
	}
	if = {
		limit = { is_variable_set = $ag_variable$ }
		[[ag_multiplier]multiply_variable = { which = $ag_variable$ value = $ag_multiplier$ }]
		[[ag_offset]change_variable = { which = $ag_variable$ value = $ag_offset$ }]
	}
}
ag_bin_search_5 = {
	if = { limit = { $ag_trigger$ = 16 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 16 } } }
	else_if = { limit = { $ag_trigger$ < 16 }
		if = { limit = { $ag_trigger$ = 8 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 8 } } }
		else_if = { limit = { $ag_trigger$ < 8 }
			if = { limit = { $ag_trigger$ = 4 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 4 } } }
			else_if = { limit = { $ag_trigger$ < 4 }
				if = { limit = { $ag_trigger$ = 2 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 2 } } }
				else_if = { limit = { $ag_trigger$ < 2 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 1 } } }
				else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 3 } } }
			}
			else_if = { limit = { always = yes }
				if = { limit = { $ag_trigger$ = 6 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 6 } } }
				else_if = { limit = { $ag_trigger$ < 6 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 5 } } }
				else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 7 } } }
			}
		}
		else_if = { limit = { always = yes }
			if = { limit = { $ag_trigger$ = 12 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 12 } } }
			else_if = { limit = { $ag_trigger$ < 12 }
				if = { limit = { $ag_trigger$ = 10 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 10 } } }
				else_if = { limit = { $ag_trigger$ < 10 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 9 } } }
				else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 11 } } }
			}
			else_if = { limit = { always = yes }
				if = { limit = { $ag_trigger$ = 14 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 14 } } }
				else_if = { limit = { $ag_trigger$ < 14 } w$ag_scope$ = { set_variable = { which = $ag_variable$ value = 13 } } }
				else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 15 } } }
			}
		}
	}
	else_if = { limit = { always = yes }
		if = { limit = { $ag_trigger$ = 24 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 24 } } }
		else_if = { limit = { $ag_trigger$ < 24 }
			if = { limit = { $ag_trigger$ = 20 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 20 } } }
			else_if = { limit = { $ag_trigger$ < 20 }
				if = { limit = { $ag_trigger$ = 18 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 19 } } }
				else_if = { limit = { $ag_trigger$ < 18 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 17 } } }
				else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 19 } } }
			}
			else_if = { limit = { always = yes }
				if = { limit = { $ag_trigger$ = 22 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 22 } } }
				else_if = { limit = { $ag_trigger$ < 22 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 21 } } }
				else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 23 } } }
			}
		}
		else_if = { limit = { always = yes }
			if = { limit = { $ag_trigger$ = 28 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 28 } } }
			else_if = { limit = { $ag_trigger$ < 28 }
				if = { limit = { $ag_trigger$ = 26 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 26 } } }
				else_if = { limit = { $ag_trigger$ < 26 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 25 } } }
				else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 27 } } }
			}
			else_if = { limit = { always = yes }
				if = { limit = { $ag_trigger$ = 30 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 30 } } }
				else_if = { limit = { $ag_trigger$ < 30 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 29 } } }
				else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 31 } } }
			}
		}
	}
	if = {
		limit = { is_variable_set = $ag_variable$ }
		[[ag_multiplier]multiply_variable = { which = $ag_variable$ value = $ag_multiplier$ }]
		[[ag_offset]change_variable = { which = $ag_variable$ value = $ag_offset$ }]
	}
}
ag_bin_search_6 = {
	if = { limit = { $ag_trigger$ = 32 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 32 } } }
	else_if = { limit = { $ag_trigger$ < 32 }
		if = { limit = { $ag_trigger$ = 16 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 16 } } }
		else_if = { limit = { $ag_trigger$ < 16 }
			if = { limit = { $ag_trigger$ = 8 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 8 } } }
			else_if = { limit = { $ag_trigger$ < 8 }
				if = { limit = { $ag_trigger$ = 4 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 4 } } }
				else_if = { limit = { $ag_trigger$ < 4 }
					if = { limit = { $ag_trigger$ = 2 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 2 } } }
					else_if = { limit = { $ag_trigger$ < 2 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 1 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 3 } } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 6 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 6 } } }
					else_if = { limit = { $ag_trigger$ < 6 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 5 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 7 } } }
				}
			}
			else_if = { limit = { always = yes }
				if = { limit = { $ag_trigger$ = 12 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 12 } } }
				else_if = { limit = { $ag_trigger$ < 12 }
					if = { limit = { $ag_trigger$ = 10 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 10 } } }
					else_if = { limit = { $ag_trigger$ < 10 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 9 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 11 } } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 14 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 14 } } }
					else_if = { limit = { $ag_trigger$ < 14 } w$ag_scope$ = { set_variable = { which = $ag_variable$ value = 13 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 15 } } }
				}
			}
		}
		else_if = { limit = { always = yes }
			if = { limit = { $ag_trigger$ = 24 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 24 } } }
			else_if = { limit = { $ag_trigger$ < 24 }
				if = { limit = { $ag_trigger$ = 20 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 20 } } }
				else_if = { limit = { $ag_trigger$ < 20 }
					if = { limit = { $ag_trigger$ = 18 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 19 } } }
					else_if = { limit = { $ag_trigger$ < 18 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 17 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 19 } } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 22 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 22 } } }
					else_if = { limit = { $ag_trigger$ < 22 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 21 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 23 } } }
				}
			}
			else_if = { limit = { always = yes }
				if = { limit = { $ag_trigger$ = 28 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 28 } } }
				else_if = { limit = { $ag_trigger$ < 28 }
					if = { limit = { $ag_trigger$ = 26 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 26 } } }
					else_if = { limit = { $ag_trigger$ < 26 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 25 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 27 } } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 30 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 30 } } }
					else_if = { limit = { $ag_trigger$ < 30 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 29 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 31 } } }
				}
			}
		}
	}
	else_if = { limit = { always = yes }
		if = { limit = { $ag_trigger$ = 48 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 48 } } }
		else_if = { limit = { $ag_trigger$ < 48 }
			if = { limit = { $ag_trigger$ = 40 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 40 } } }
			else_if = { limit = { $ag_trigger$ < 40 }
				if = { limit = { $ag_trigger$ = 36 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 36 } } }
				else_if = { limit = { $ag_trigger$ < 36 }
					if = { limit = { $ag_trigger$ = 34 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 34 } } }
					else_if = { limit = { $ag_trigger$ < 34 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 33 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 35 } } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 38 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 38 } } }
					else_if = { limit = { $ag_trigger$ < 38 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 37 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 39 } } }
				}
			}
			else_if = { limit = { always = yes }
				if = { limit = { $ag_trigger$ = 44 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 44 } } }
				else_if = { limit = { $ag_trigger$ < 44 }
					if = { limit = { $ag_trigger$ = 42 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 42 } } }
					else_if = { limit = { $ag_trigger$ < 42 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 41 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 43 } } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 46 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 46 } } }
					else_if = { limit = { $ag_trigger$ < 46 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 45 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 47 } } }
				}
			}
		}
		else_if = { limit = { always = yes }
			if = { limit = { $ag_trigger$ = 56 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 56 } } }
			else_if = { limit = { $ag_trigger$ < 56 }
				if = { limit = { $ag_trigger$ = 52 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 52 } } }
				else_if = { limit = { $ag_trigger$ < 52 }
					if = { limit = { $ag_trigger$ = 50 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 50 } } }
					else_if = { limit = { $ag_trigger$ < 50 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 49 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 51 } } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 54 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 54 } } }
					else_if = { limit = { $ag_trigger$ < 54 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 53 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 55 } } }
				}
			}
			else_if = { limit = { always = yes }
				if = { limit = { $ag_trigger$ = 60 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 60 } } }
				else_if = { limit = { $ag_trigger$ < 60 }
					if = { limit = { $ag_trigger$ = 58 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 58 } } }
					else_if = { limit = { $ag_trigger$ < 58 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 57 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 59 } } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 62 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 62 } } }
					else_if = { limit = { $ag_trigger$ < 62 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 61 } } }
					else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 63 } } }
				}
			}
		}
	}
	if = {
		limit = { is_variable_set = $ag_variable$ }
		[[ag_multiplier]multiply_variable = { which = $ag_variable$ value = $ag_multiplier$ }]
		[[ag_offset]change_variable = { which = $ag_variable$ value = $ag_offset$ }]
	}
}
ag_bin_search_7 = {
	if = { limit = { $ag_trigger$ = 64 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 64 } } }
	else_if = { limit = { $ag_trigger$ < 64 }
		if = { limit = { $ag_trigger$ = 32 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 32 } } }
		else_if = { limit = { $ag_trigger$ < 32 }
			if = { limit = { $ag_trigger$ = 16 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 16 } } }
			else_if = { limit = { $ag_trigger$ < 16 }
				if = { limit = { $ag_trigger$ = 8 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 8 } } }
				else_if = { limit = { $ag_trigger$ < 8 }
					if = { limit = { $ag_trigger$ = 4 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 4 } } }
					else_if = { limit = { $ag_trigger$ < 4 }
						if = { limit = { $ag_trigger$ = 2 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 2 } } }
						else_if = { limit = { $ag_trigger$ < 2 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 1 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 3 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 6 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 6 } } }
						else_if = { limit = { $ag_trigger$ < 6 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 5 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 7 } } }
					}
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 12 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 12 } } }
					else_if = { limit = { $ag_trigger$ < 12 }
						if = { limit = { $ag_trigger$ = 10 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 10 } } }
						else_if = { limit = { $ag_trigger$ < 10 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 9 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 11 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 14 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 14 } } }
						else_if = { limit = { $ag_trigger$ < 14 } w$ag_scope$ = { set_variable = { which = $ag_variable$ value = 13 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 15 } } }
					}
				}
			}
			else_if = { limit = { always = yes }
				if = { limit = { $ag_trigger$ = 24 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 24 } } }
				else_if = { limit = { $ag_trigger$ < 24 }
					if = { limit = { $ag_trigger$ = 20 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 20 } } }
					else_if = { limit = { $ag_trigger$ < 20 }
						if = { limit = { $ag_trigger$ = 18 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 19 } } }
						else_if = { limit = { $ag_trigger$ < 18 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 17 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 19 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 22 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 22 } } }
						else_if = { limit = { $ag_trigger$ < 22 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 21 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 23 } } }
					}
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 28 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 28 } } }
					else_if = { limit = { $ag_trigger$ < 28 }
						if = { limit = { $ag_trigger$ = 26 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 26 } } }
						else_if = { limit = { $ag_trigger$ < 26 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 25 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 27 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 30 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 30 } } }
						else_if = { limit = { $ag_trigger$ < 30 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 29 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 31 } } }
					}
				}
			}
		}
		else_if = { limit = { always = yes }
			if = { limit = { $ag_trigger$ = 48 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 48 } } }
			else_if = { limit = { $ag_trigger$ < 48 }
				if = { limit = { $ag_trigger$ = 40 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 40 } } }
				else_if = { limit = { $ag_trigger$ < 40 }
					if = { limit = { $ag_trigger$ = 36 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 36 } } }
					else_if = { limit = { $ag_trigger$ < 36 }
						if = { limit = { $ag_trigger$ = 34 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 34 } } }
						else_if = { limit = { $ag_trigger$ < 34 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 33 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 35 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 38 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 38 } } }
						else_if = { limit = { $ag_trigger$ < 38 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 37 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 39 } } }
					}
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 44 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 44 } } }
					else_if = { limit = { $ag_trigger$ < 44 }
						if = { limit = { $ag_trigger$ = 42 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 42 } } }
						else_if = { limit = { $ag_trigger$ < 42 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 41 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 43 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 46 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 46 } } }
						else_if = { limit = { $ag_trigger$ < 46 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 45 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 47 } } }
					}
				}
			}
			else_if = { limit = { always = yes }
				if = { limit = { $ag_trigger$ = 56 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 56 } } }
				else_if = { limit = { $ag_trigger$ < 56 }
					if = { limit = { $ag_trigger$ = 52 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 52 } } }
					else_if = { limit = { $ag_trigger$ < 52 }
						if = { limit = { $ag_trigger$ = 50 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 50 } } }
						else_if = { limit = { $ag_trigger$ < 50 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 49 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 51 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 54 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 54 } } }
						else_if = { limit = { $ag_trigger$ < 54 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 53 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 55 } } }
					}
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 60 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 60 } } }
					else_if = { limit = { $ag_trigger$ < 60 }
						if = { limit = { $ag_trigger$ = 58 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 58 } } }
						else_if = { limit = { $ag_trigger$ < 58 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 57 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 59 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 62 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 62 } } }
						else_if = { limit = { $ag_trigger$ < 62 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 61 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 63 } } }
					}
				}
			}
		}
	}
	else_if = { limit = { always = yes }
		if = { limit = { $ag_trigger$ = 96 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 96 } } }
		else_if = { limit = { $ag_trigger$ < 96 }
			if = { limit = { $ag_trigger$ = 80 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 80 } } }
			else_if = { limit = { $ag_trigger$ < 80 }
				if = { limit = { $ag_trigger$ = 72 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 72 } } }
				else_if = { limit = { $ag_trigger$ < 72 }
					if = { limit = { $ag_trigger$ = 68 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 68 } } }
					else_if = { limit = { $ag_trigger$ < 68 }
						if = { limit = { $ag_trigger$ = 66 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 66 } } }
						else_if = { limit = { $ag_trigger$ < 66 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 65 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 67 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 70 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 70 } } }
						else_if = { limit = { $ag_trigger$ < 70 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 69 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 71 } } }
					}
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 76 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 76 } } }
					else_if = { limit = { $ag_trigger$ < 76 }
						if = { limit = { $ag_trigger$ = 74 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 74 } } }
						else_if = { limit = { $ag_trigger$ < 74 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 73 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 75 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 78 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 78 } } }
						else_if = { limit = { $ag_trigger$ < 78 } w$ag_scope$ = { set_variable = { which = $ag_variable$ value = 77 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 79 } } }
					}
				}
			}
			else_if = { limit = { always = yes }
				if = { limit = { $ag_trigger$ = 88 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 88 } } }
				else_if = { limit = { $ag_trigger$ < 88 }
					if = { limit = { $ag_trigger$ = 84 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 84 } } }
					else_if = { limit = { $ag_trigger$ < 84 }
						if = { limit = { $ag_trigger$ = 82 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 82 } } }
						else_if = { limit = { $ag_trigger$ < 82 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 81 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 83 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 86 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 86 } } }
						else_if = { limit = { $ag_trigger$ < 86 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 85 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 87 } } }
					}
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 92 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 92 } } }
					else_if = { limit = { $ag_trigger$ < 92 }
						if = { limit = { $ag_trigger$ = 90 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 90 } } }
						else_if = { limit = { $ag_trigger$ < 90 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 89 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 91 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 94 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 94 } } }
						else_if = { limit = { $ag_trigger$ < 94 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 93 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 95 } } }
					}
				}
			}
		}
		else_if = { limit = { always = yes }
			if = { limit = { $ag_trigger$ = 112 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 112 } } }
			else_if = { limit = { $ag_trigger$ < 112 }
				if = { limit = { $ag_trigger$ = 104 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 104 } } }
				else_if = { limit = { $ag_trigger$ < 104 }
					if = { limit = { $ag_trigger$ = 100 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 100 } } }
					else_if = { limit = { $ag_trigger$ < 100 }
						if = { limit = { $ag_trigger$ = 98 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 98 } } }
						else_if = { limit = { $ag_trigger$ < 98 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 97 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 99 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 102 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 102 } } }
						else_if = { limit = { $ag_trigger$ < 102 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 101 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 103 } } }
					}
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 108 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 108 } } }
					else_if = { limit = { $ag_trigger$ < 108 }
						if = { limit = { $ag_trigger$ = 106 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 106 } } }
						else_if = { limit = { $ag_trigger$ < 106 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 105 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 107 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 110 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 110 } } }
						else_if = { limit = { $ag_trigger$ < 110 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 109 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 111 } } }
					}
				}
			}
			else_if = { limit = { always = yes }
				if = { limit = { $ag_trigger$ = 120 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 120 } } }
				else_if = { limit = { $ag_trigger$ < 120 }
					if = { limit = { $ag_trigger$ = 116 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 116 } } }
					else_if = { limit = { $ag_trigger$ < 116 }
						if = { limit = { $ag_trigger$ = 114 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 114 } } }
						else_if = { limit = { $ag_trigger$ < 114 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 113 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 115 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 118 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 118 } } }
						else_if = { limit = { $ag_trigger$ < 118 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 117 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 119 } } }
					}
				}
				else_if = { limit = { always = yes }
					if = { limit = { $ag_trigger$ = 124 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 124 } } }
					else_if = { limit = { $ag_trigger$ < 124 }
						if = { limit = { $ag_trigger$ = 122 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 122 } } }
						else_if = { limit = { $ag_trigger$ < 122 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 121 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 123 } } }
					}
					else_if = { limit = { always = yes }
						if = { limit = { $ag_trigger$ = 126 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 126 } } }
						else_if = { limit = { $ag_trigger$ < 126 } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 125 } } }
						else_if = { limit = { always = yes } $ag_scope$ = { set_variable = { which = $ag_variable$ value = 127 } } }
					}
				}
			}
		}
	}
	if = {
		limit = { is_variable_set = $ag_variable$ }
		[[ag_multiplier]multiply_variable = { which = $ag_variable$ value = $ag_multiplier$ }]
		[[ag_offset]change_variable = { which = $ag_variable$ value = $ag_offset$ }]
	}
}

ag_spawned_system_effect = {
	add_event_chain_counter = {
		event_chain = "ag_hidden_system_chain"
		counter = "ag_ancient_system"
		amount = 1
	}
	country_event = { id = ag_spawn.1 }
	country_event = { id = ag_spawn.32 }
	every_country = {
		limit = { NOT = { is_same_value = event_target:ag_system_discover_country } }
		country_event = { id = ag_spawn.33 }
	}
}

ag_refresh_ancient_system_poi = {
	remove_point_of_interest = [[ag_system_id]$ag_system_id$]
	if = {
		limit = { NOT = { has_event_chain = "ag_hidden_system_chain" } }
		begin_event_chain = { event_chain = "ag_hidden_system_chain" target = root.owner }
	}
	create_point_of_interest = {
		id = [[ag_system_id]$ag_system_id$]_alt
		name = "[[ag_system_id]$ag_system_id$]"
		desc = "ag_ancient_coordinate"
		event_chain = "ag_hidden_system_chain"
		location = from
	}
}

ag_hostile_kill_counter = {
	if = {
		limit = {
			prev = {
				NOR = {
					ag_is_corvette_class_ship = yes
					ag_is_destroyer_class_ship = yes
					ag_is_cruiser_class_ship = yes
					ag_is_battleship_class_ship = yes
					ag_is_titan_class_ship = yes
					ag_is_colossus_class_ship = yes
					ag_is_constructor_class_ship = yes
					ag_is_colonizer_class_ship = yes
					ag_is_science_class_ship = yes
					ag_is_transport_class_ship = yes
					ag_is_defensive_station_class_ship = yes
					ag_is_starbase_class_ship = yes
					ag_is_civilian_station_class_ship = yes
					ag_is_ancient_ship = yes
					ag_is_ancient_ship_locked = yes
					ag_is_ancient_ship_unlocked = yes
				}
			}
		}
		if = {
			limit = {
				prev = {
					is_ship_class = shipclass_military
				}
			}
			random_list = {
				1 = {
					[[ag_effect_corvette_class]$ag_effect_corvette_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 4
					}
				}
				1 = {
					[[ag_effect_destroyer_class]$ag_effect_destroyer_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 8
					}
				}
				1 = {
					[[ag_effect_cruiser_class]$ag_effect_cruiser_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 16
					}
				}
				1 = {
					[[ag_effect_battleship_class]$ag_effect_battleship_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 32
					}
				}
				1 = {
					[[ag_effect_titan_class]$ag_effect_titan_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 64
					}
				}
				1 = {
					[[ag_effect_colossus_class]$ag_effect_colossus_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 128
					}
				}
				1 = {
					[[ag_effect_ancient_class]$ag_effect_ancient_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 150
					}
				}
			}
		}
		else_if = {
			limit = {
				prev = {
					is_ship_class = shipclass_constructor
				}
			}
			[[ag_effect_constructor_class]$ag_effect_constructor_class$ = yes]
			change_variable = {
				which = $ag_variable_name$
				value = 1
			}
		}
		else_if = {
			limit = {
				prev = {
					is_ship_class = shipclass_colonizer
				}
			}
			[[ag_effect_colonizer_class]$ag_effect_colonizer_class$ = yes]
			change_variable = {
				which = $ag_variable_name$
				value = 3
			}
		}
		else_if = {
			limit = {
				prev = {
					is_ship_class = shipclass_science_ship
				}
			}
			[[ag_effect_science_class]$ag_effect_science_class$ = yes]
			change_variable = {
				which = $ag_variable_name$
				value = 2
			}
		}
		else_if = {
			limit = {
				prev = {
					is_ship_class = shipclass_transport
				}
			}
			[[ag_effect_transport_class]$ag_effect_transport_class$ = yes]
			change_variable = {
				which = $ag_variable_name$
				value = 2
			}
		}
		else_if = {
			limit = {
				prev = {
					is_ship_class = shipclass_military_station
				}
			}
			[[ag_effect_defensive_station_class]$ag_effect_defensive_station_class$ = yes]
			change_variable = {
				which = $ag_variable_name$
				value = 16
			}
		}
		else_if = {
			limit = {
				prev = {
					is_ship_class = shipclass_starbase
				}
			}
			[[ag_effect_starbase_class]$ag_effect_starbase_class$ = yes]
			change_variable = {
				which = $ag_variable_name$
				value = 128
			}
		}
		else_if = {
			limit = {
				prev = {
					OR = {
						is_ship_class = shipclass_mining_station
						is_ship_class = shipclass_research_station
						is_ship_class = shipclass_observation_station
					}
				}
			}
			[[ag_effect_civilian_station_class]$ag_effect_civilian_station_class$ = yes]
			change_variable = {
				which = $ag_variable_name$
				value = 1
			}
		}
		else_if = {
			limit = {
				always = yes
			}
			random_list = {
				1 = {
					[[ag_effect_corvette_class]$ag_effect_corvette_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 4
					}
				}
				1 = {
					[[ag_effect_destroyer_class]$ag_effect_destroyer_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 8
					}
				}
				1 = {
					[[ag_effect_cruiser_class]$ag_effect_cruiser_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 16
					}
				}
				1 = {
					[[ag_effect_battleship_class]$ag_effect_battleship_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 32
					}
				}
				1 = {
					[[ag_effect_titan_class]$ag_effect_titan_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 64
					}
				}
				1 = {
					[[ag_effect_colossus_class]$ag_effect_colossus_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 128
					}
				}
				1 = {
					[[ag_effect_constructor_class]$ag_effect_constructor_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 1
					}
				}
				1 = {
					[[ag_effect_colonizer_class]$ag_effect_colonizer_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 3
					}
				}
				1 = {
					[[ag_effect_science_class]$ag_effect_science_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 2
					}
				}
				1 = {
					[[ag_effect_transport_class]$ag_effect_transport_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 2
					}
				}
				1 = {
					[[ag_effect_defensive_station_class]$ag_effect_defensive_station_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 16
					}
				}
				1 = {
					[[ag_effect_starbase_class]$ag_effect_starbase_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 128
					}
				}
				1 = {
					[[ag_effect_civilian_station_class]$ag_effect_civilian_station_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 1
					}
				}
				1 = {
					[[ag_effect_ancient_class]$ag_effect_ancient_class$ = yes]
					change_variable = {
						which = $ag_variable_name$
						value = 150
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			prev = {
				ag_is_corvette_class_ship = yes
			}
		}
		[[ag_effect_corvette_class]$ag_effect_corvette_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 4
		}
	}
	else_if = {
		limit = {
			prev = {
				ag_is_destroyer_class_ship = yes
			}
		}
		[[ag_effect_destroyer_class]$ag_effect_destroyer_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 8
		}
	}
	else_if = {
		limit = {
			prev = {
				ag_is_cruiser_class_ship = yes
			}
		}
		[[ag_effect_cruiser_class]$ag_effect_cruiser_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 16
		}
	}
	else_if = {
		limit = {
			prev = {
				ag_is_battleship_class_ship = yes
			}
		}
		[[ag_effect_battleship_class]$ag_effect_battleship_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 32
		}
	}
	else_if = {
		limit = {
			prev = {
				ag_is_titan_class_ship = yes
			}
		}
		[[ag_effect_titan_class]$ag_effect_titan_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 64
		}
	}
	else_if = {
		limit = {
			prev = {
				ag_is_colossus_class_ship = yes
			}
		}
		[[ag_effect_colossus_class]$ag_effect_colossus_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 128
		}
	}
	else_if = {
		limit = {
			prev = {
				ag_is_constructor_class_ship = yes
			}
		}
		[[ag_effect_constructor_class]$ag_effect_constructor_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 1
		}
	}
	else_if = {
		limit = {
			prev = {
				ag_is_colonizer_class_ship = yes
			}
		}
		[[ag_effect_colonizer_class]$ag_effect_colonizer_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 3
		}
	}
	else_if = {
		limit = {
			prev = {
				ag_is_transport_class_ship = yes
			}
		}
		[[ag_effect_science_class]$ag_effect_science_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 2
		}
	}
	else_if = {
		limit = {
			prev = {
				ag_is_defensive_station_class_ship = yes
			}
		}
		[[ag_effect_defensive_station_class]$ag_effect_defensive_station_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 16
		}
	}
	else_if = {
		limit = {
			prev = {
				ag_is_starbase_class_ship = yes
			}
		}
		[[ag_effect_starbase_class]$ag_effect_starbase_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 128
		}
	}
	else_if = {
		limit = {
			prev = {
				ag_is_civilian_station_class_ship = yes
			}
		}
		[[ag_effect_civilian_station_class]$ag_effect_civilian_station_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 1
		}
	}
	else_if = {
		limit = {
			prev = {
				OR = {
					ag_is_ancient_ship = yes
					ag_is_ancient_ship_locked = yes
					ag_is_ancient_ship_unlocked = yes
				}
			}
		}
		[[ag_effect_ancient_class]$ag_effect_ancient_class$ = yes]
		change_variable = {
			which = $ag_variable_name$
			value = 150
		}
	}
}

ag_scientist_gain_random_negative_trait = {
	random_list = {
		30 = {
			if = {
				limit = {
					owner = {
						is_machine_empire = no
						NOT = { has_country_flag = synthetic_empire }
					}
				}
				add_trait = leader_trait_maimed
			}
			else = { add_trait = ag_leader_trait_increase_upkeep }
		}
		30 = {
			if = {
				limit = {
					owner = {
						is_machine_empire = no
						NOT = { has_country_flag = synthetic_empire }
					}
				}
				add_trait = leader_trait_substance_abuser
			}
			else = { add_trait = ag_leader_trait_increase_upkeep }
		}
		30 = {
			if = {
				limit = {
					owner = {
						is_machine_empire = no
						NOT = { has_country_flag = synthetic_empire }
					}
				}
				add_trait = leader_trait_stubborn
			}
			else = { add_trait = leader_trait_rigid_programming }
		}
		10 = { add_trait = leader_trait_arrested_development }
	}
}

ag_all_archaeological_dig_failed_random_events = {
	random_list = {
		10 = {
			random_list = {
				10 = { fleet_event = { id = ag_arc_failed.11 } }
				10 = { fleet_event = { id = ag_arc_failed.12 } }
				10 = { fleet_event = { id = ag_arc_failed.13 } }
				10 = { fleet_event = { id = ag_arc_failed.14 } }
				10 = { fleet_event = { id = ag_arc_failed.15 } }
				10 = { fleet_event = { id = ag_arc_failed.16 } }
			}
		}
		10 = {
			modifier = {
				factor = 0
				from.planet = { is_planet_class = pc_gas_giant }
			}
			random_list = {
				10 = { fleet_event = { id = ag_arc_failed.21 } }
				10 = { fleet_event = { id = ag_arc_failed.22 } }
				10 = { fleet_event = { id = ag_arc_failed.23 } }
				10 = { fleet_event = { id = ag_arc_failed.24 } }
				10 = { fleet_event = { id = ag_arc_failed.25 } }
				10 = { fleet_event = { id = ag_arc_failed.26 } }
			}
		}
		10 = {
			random_list = {
				10 = { fleet_event = { id = ag_arc_failed.32 } }
				10 = { fleet_event = { id = ag_arc_failed.33 } }
				10 = { fleet_event = { id = ag_arc_failed.34 } }
				10 = { fleet_event = { id = ag_arc_failed.35 } }
				10 = { fleet_event = { id = ag_arc_failed.36 } }
			}
		}
		10 = {
			random_list = {
				10 = { fleet_event = { id = ag_arc_failed.42 } }
				10 = { fleet_event = { id = ag_arc_failed.43 } }
				10 = { fleet_event = { id = ag_arc_failed.44 } }
				10 = { fleet_event = { id = ag_arc_failed.45 } }
				10 = { fleet_event = { id = ag_arc_failed.46 } }
			}
		}
		10 = {
			modifier = {
				factor = 0
				from.planet.solar_system = { has_star_flag = ag_ancient_zeta_system }
			}
			random_list = {
				10 = { fleet_event = { id = ag_arc_failed.52 } }
				10 = { fleet_event = { id = ag_arc_failed.53 } }
				10 = { fleet_event = { id = ag_arc_failed.54 } }
				10 = { fleet_event = { id = ag_arc_failed.55 } }
				10 = { fleet_event = { id = ag_arc_failed.56 } }
			}
		}
		10 = {
			modifier = {
				factor = 0
				from.planet = { NOT = { is_planet_class = pc_gas_giant } }
			}
			random_list = {
				10 = { fleet_event = { id = ag_arc_failed.62 } }
				10 = { fleet_event = { id = ag_arc_failed.63 } }
				10 = { fleet_event = { id = ag_arc_failed.64 } }
				10 = { fleet_event = { id = ag_arc_failed.65 } }
				10 = { fleet_event = { id = ag_arc_failed.66 } }
			}
		}
		10 = {
			random_list = {
				10 = { fleet_event = { id = ag_arc_failed.71 } }
				10 = { fleet_event = { id = ag_arc_failed.72 } }
				10 = { fleet_event = { id = ag_arc_failed.73 } }
				10 = { fleet_event = { id = ag_arc_failed.74 } }
			}
		}
		10 = {
			random_list = {
				10 = {
					modifier = {
						factor = 0
						from.planet.solar_system = { has_star_flag = ag_ancient_zeta_system }
					}
					fleet_event = { id = ag_arc_failed.81 }
				}
				10 = { fleet_event = { id = ag_arc_failed.82 } }
				10 = { fleet_event = { id = ag_arc_failed.83 } }
			}
		}
	}
}

ag_remove_all_modifier_common = {
	if = { limit = { has_modifier = "hazardous_weather" } remove_modifier = "hazardous_weather" }
	if = { limit = { has_modifier = "dangerous_wildlife" } remove_modifier = "dangerous_wildlife" }
	if = { limit = { has_modifier = "wild_storms" } remove_modifier = "wild_storms" }
	if = { limit = { has_modifier = "titanic_life" } remove_modifier = "titanic_life" }
	if = { limit = { has_modifier = "eat_the_titans" } remove_modifier = "eat_the_titans" }
	if = { limit = { has_modifier = "natural_beauty" } remove_modifier = "natural_beauty" }
	if = { limit = { has_modifier = "atmospheric_aphrodisiac" } remove_modifier = "atmospheric_aphrodisiac" }
	if = { limit = { has_modifier = "atmospheric_hallucinogen" } remove_modifier = "atmospheric_hallucinogen" }
	if = { limit = { has_modifier = "atmospheric_hallucinogen_good" } remove_modifier = "atmospheric_hallucinogen_good" }
	if = { limit = { has_modifier = "lush_planet" } remove_modifier = "lush_planet" }
	if = { limit = { has_modifier = "bleak_planet" } remove_modifier = "bleak_planet" }
	if = { limit = { has_modifier = "bunkbeds_deployed" } remove_modifier = "bunkbeds_deployed" }
	if = { limit = { has_modifier = "tupperware_deployed" } remove_modifier = "tupperware_deployed" }
	if = { limit = { has_modifier = "atmospheric_deodorizer_deployed" } remove_modifier = "atmospheric_deodorizer_deployed" }
	if = { limit = { has_modifier = "racket_energy_extractor" } remove_modifier = "racket_energy_extractor" }
	if = { limit = { has_modifier = "racket_generator_regulator" } remove_modifier = "racket_generator_regulator" }
	if = { limit = { has_modifier = "criminal_underworld" } remove_modifier = "criminal_underworld" }
	if = { limit = { has_modifier = "drone_deviancy" } remove_modifier = "drone_deviancy" }
	if = { limit = { has_modifier = "drone_corruption" } remove_modifier = "drone_corruption" }
	if = { limit = { has_modifier = "gang_wars" } remove_modifier = "gang_wars" }
	if = { limit = { has_modifier = "center_of_drug_trade" } remove_modifier = "center_of_drug_trade" }
	if = { limit = { has_modifier = "mob_rule" } remove_modifier = "mob_rule" }
	if = { limit = { has_modifier = "bribed_officials" } remove_modifier = "bribed_officials" }
	if = { limit = { has_modifier = "substance_abuse" } remove_modifier = "substance_abuse" }
	if = { limit = { has_modifier = "smuggler_activity" } remove_modifier = "smuggler_activity" }
	if = { limit = { has_modifier = "crime_wave" } remove_modifier = "crime_wave" }
	if = { limit = { has_modifier = "travel_advisory" } remove_modifier = "travel_advisory" }
	if = { limit = { has_modifier = "cartel_war" } remove_modifier = "cartel_war" }
	if = { limit = { has_modifier = "protection_racket" } remove_modifier = "protection_racket" }
	if = { limit = { has_modifier = "corrupt_administration" } remove_modifier = "corrupt_administration" }
	if = { limit = { has_modifier = "trade_pilfering" } remove_modifier = "trade_pilfering" }
	if = { limit = { has_modifier = "crime_boss_arrested" } remove_modifier = "crime_boss_arrested" }
	if = { limit = { has_modifier = "deviant_interference" } remove_modifier = "deviant_interference" }
	if = { limit = { has_modifier = "drone_signal_interference" } remove_modifier = "drone_signal_interference" }
	if = { limit = { has_modifier = "ringleader_killed" } remove_modifier = "ringleader_killed" }
	if = { limit = { has_modifier = "corrupt_network_terminated" } remove_modifier = "corrupt_network_terminated" }
	if = { limit = { has_modifier = "anticrime_campaign" } remove_modifier = "anticrime_campaign" }
	if = { limit = { has_modifier = "crime_lord_deal" } remove_modifier = "crime_lord_deal" }
	if = { limit = { has_modifier = "crime_lord_deal_broken" } remove_modifier = "crime_lord_deal_broken" }
	if = { limit = { has_modifier = "unemployment_benefits" } remove_modifier = "unemployment_benefits" }
	if = { limit = { has_modifier = "activity_program" } remove_modifier = "activity_program" }
	if = { limit = { has_modifier = "standby_mode" } remove_modifier = "standby_mode" }
	if = { limit = { has_modifier = "numistic_magnetostrips" } remove_modifier = "numistic_magnetostrips" }
	if = { limit = { has_modifier = "planet_culture_shock" } remove_modifier = "planet_culture_shock" }
	if = { limit = { has_modifier = "martial_law" } remove_modifier = "martial_law" }
	if = { limit = { has_modifier = "hunter_killer_drones" } remove_modifier = "hunter_killer_drones" }
	if = { limit = { has_modifier = "compliance_protocols" } remove_modifier = "compliance_protocols" }
	if = { limit = { has_modifier = "planet_food_boost" } remove_modifier = "planet_food_boost" }
	if = { limit = { has_modifier = "planet_luxuries_boost" } remove_modifier = "planet_luxuries_boost" }
	if = { limit = { has_modifier = "pm_study_the_sea" } remove_modifier = "pm_study_the_sea" }
	if = { limit = { has_modifier = "living_sea" } remove_modifier = "living_sea" }
	if = { limit = { has_modifier = "predatory_plants" } remove_modifier = "predatory_plants" }
	if = { limit = { has_modifier = "brainslug_woes" } remove_modifier = "brainslug_woes" }
	if = { limit = { has_modifier = "brainslug_woes_phobe" } remove_modifier = "brainslug_woes_phobe" }
	if = { limit = { has_modifier = "watery_grave" } remove_modifier = "watery_grave" }
	if = { limit = { has_modifier = "exofungus" } remove_modifier = "exofungus" }
	if = { limit = { has_modifier = "planet_population_control" } remove_modifier = "planet_population_control" }
	if = { limit = { has_modifier = "planet_population_control_gestalt" } remove_modifier = "planet_population_control_gestalt" }
	if = { limit = { has_modifier = "planet_robot_assembly_control" } remove_modifier = "planet_robot_assembly_control" }
	if = { limit = { has_modifier = "planet_growth_discouraged" } remove_modifier = "planet_growth_discouraged" }
	if = { limit = { has_modifier = "planet_population_expelled" } remove_modifier = "planet_population_expelled" }
	if = { limit = { has_modifier = "mastery_of_nature" } remove_modifier = "mastery_of_nature" }
	if = { limit = { has_modifier = "divine_algorithm" } remove_modifier = "divine_algorithm" }
	if = { limit = { has_modifier = "criminal_gambling" } remove_modifier = "criminal_gambling" }
	if = { limit = { has_modifier = "festival_aftermath" } remove_modifier = "festival_aftermath" }
	if = { limit = { has_modifier = "slot_machine_bounty" } remove_modifier = "slot_machine_bounty" }
	if = { limit = { has_modifier = "heavy_metal" } remove_modifier = "heavy_metal" }
	if = { limit = { has_modifier = "alloy_relic" } remove_modifier = "alloy_relic" }
	if = { limit = { has_modifier = "minerals_relic" } remove_modifier = "minerals_relic" }
	if = { limit = { has_modifier = "energy_relic" } remove_modifier = "energy_relic" }
	if = { limit = { has_modifier = "artist_monument_erected" } remove_modifier = "artist_monument_erected" }
	if = { limit = { has_modifier = "tissue_growth_stimulants" } remove_modifier = "tissue_growth_stimulants" }
	if = { limit = { has_modifier = "explosive_fungifoam_housing" } remove_modifier = "explosive_fungifoam_housing" }
	if = { limit = { has_modifier = "pm_planetary_mechanocalibrator" } remove_modifier = "pm_planetary_mechanocalibrator" }
	if = { limit = { has_modifier = "planet_museum_exhibits" } remove_modifier = "planet_museum_exhibits" }
	if = { limit = { has_modifier = "planet_manager_awards" } remove_modifier = "planet_manager_awards" }
	if = { limit = { has_modifier = "planet_sanctuary_exhibits" } remove_modifier = "planet_sanctuary_exhibits" }
	if = { limit = { has_modifier = "planet_artifact_relays_hivemind" } remove_modifier = "planet_artifact_relays_hivemind" }
	if = { limit = { has_modifier = "planet_artifact_relays_machine" } remove_modifier = "planet_artifact_relays_machine" }
	if = { limit = { has_modifier = "lithoids_arc_site_minerals" } remove_modifier = "lithoids_arc_site_minerals" }
	if = { limit = { has_modifier = "oracle_software_integration" } remove_modifier = "oracle_software_integration" }
	if = { limit = { has_modifier = "pm_yuht_cleansing" } remove_modifier = "pm_yuht_cleansing" }
	if = { limit = { has_modifier = "the_memorex" } remove_modifier = "the_memorex" }
}

ag_destroy_habitable_ringworld = {
	change_pc = pc_ringworld_habitable_damaged
	if = {
		limit = {
			NOR = {
				has_planet_flag = ag_ancient_ringworld_blue
				has_planet_flag = ag_ancient_ringworld_red
				has_planet_flag = ag_ancient_ringworld_violet
			}
		}
		set_planet_entity = { entity = ringworld_habitable_damaged_entity }
	}
	else = {
		set_planet_entity = { entity = ag_ancient_ringworld_habitable_damaged_entity }
	}
}

ag_set_ancient_ringworld = {
	set_planet_entity = {
		[[ag_picture]picture = $ag_picture$]
		entity = "ag_ancient_ringworld_$ag_type$[[ag_surface_type]_$ag_surface_type$]_$ag_color$[[ag_shield_color]_shielded_$ag_shield_color$]_entity"
	}
	[[ag_set_flag]
		if = {
			limit = { always = $ag_set_flag$ }
			set_planet_flag = ag_ancient_ringworld_$ag_color$
			# [[ag_surface_type]set_planet_flag = ag_ancient_habitable_section]
		}
	]
	if = { limit = { has_deposit = ag_ancient_shield_deposit_green } remove_deposit = ag_ancient_shield_deposit_green }
	if = { limit = { has_deposit = ag_ancient_shield_deposit_blue } remove_deposit = ag_ancient_shield_deposit_blue }
	if = { limit = { has_deposit = ag_ancient_shield_deposit_red } remove_deposit = ag_ancient_shield_deposit_red }
	if = { limit = { has_modifier = ag_ancient_shield_deposit_green } remove_modifier = ag_ancient_shield_deposit_green }
	if = { limit = { has_modifier = ag_ancient_shield_deposit_blue } remove_modifier = ag_ancient_shield_deposit_blue }
	if = { limit = { has_modifier = ag_ancient_shield_deposit_red } remove_modifier = ag_ancient_shield_deposit_red }
	[[ag_shield_color]
		add_deposit = ag_ancient_shield_deposit_$ag_shield_color$
		add_modifier = {
			modifier = ag_ancient_shield_deposit_$ag_shield_color$
			days = -1
		}
	]
	[[ag_generate_ruins]
		if = {
			limit = { always = $ag_generate_ruins$ }
			while = {
				count = 8
				random_list = {
					50 = { }
					50 = { add_deposit = ag_ancient_ruins }
				}
			}
		}
	]
}

ag_ancient_country_friendly_to_each_other = {
	every_country = {
		limit = {
			NOT = { is_same_value = prev }
			ag_is_ancient_country = yes
		}
		if = {
			limit = { NOT = { has_communications = prev } }
			establish_communications_no_message = prev
		}
		if = {
			limit = { is_hostile = prev }
			set_faction_hostility = {
				target = prev
				set_hostile = no
				set_neutral = yes
				set_friendly = no
			}
		}
	}
}

ag_create_ancient_guardian = {
	create_country = {
		name = $ag_country_name$
		type = $ag_country_type$
		flag = {
			icon = {
				category = "special"
				file = "extradimensional_02.dds"
			}
			background = {
				category = "backgrounds"
				file = "circle.dds"
			}
			colors = {
				"dark_grey"
				"red"
				"null"
				"null"
			}
		}
		name_list = ag_ancients
		# ignore_initial_colony_error = yes
	}
}

ag_spawn_ancient_construction_section = {
	random_system_planet = {
		limit = { is_primary_star = yes }
		set_planet_flag = ag_ancient_construction_section_actived_star
		set_variable = {
			which = ag_construction_section_counter
			value = 0
		}
		prev = {
			every_system_planet = {
				limit = {
					OR = {
						has_planet_flag = ag_ancient_construction_section
						has_planet_flag = ag_ancient_construction_section_0
					}
				}
				if = {
					limit = { has_planet_flag = ag_ancient_construction_section_0 }
					remove_planet_flag = ag_ancient_construction_section_0
					set_planet_flag = ag_ancient_construction_section
					set_name = "NAME_ag_ancient_construction_section"
				}
				set_planet_flag = ag_ancient_construction_section_actived
				prev = {
					if = {
						limit = { exists = space_owner }
						spawn_megastructure = {
							type = ag_ancient_construction_section
							coords_from = prev
							owner = this.space_owner
						}
					}
					else = {
						spawn_megastructure = {
							type = ag_ancient_construction_section
							coords_from = prev
						}
					}
				}
				prevprev = {
					change_variable = {
						which = ag_construction_section_counter
						value = 1
					}
				}
			}
		}
	}
}
ag_despawn_ancient_construction_section = {
	random_system_planet = {
		limit = { is_primary_star = yes }
		remove_planet_flag = ag_ancient_construction_section_actived_star
	}
	every_system_planet = {
		limit = { has_planet_flag = ag_ancient_construction_section_actived }
		remove_planet_flag = ag_ancient_construction_section_actived
	}
	every_system_megastructure = {
		limit = { is_megastructure_type = ag_ancient_construction_section }
		remove_megastructure = this
	}
}

ag_ancient_random_system_gas_giant_size = {
	if = { limit = { is_planet_class = pc_gas_giant } change_planet_size = 16 }
}
ag_ancient_random_system_spawn_debris = {
	random_list = {
		20 = { create_ambient_object = { type = "small_debris_object" location = this } }
		20 = { create_ambient_object = { type = "medium_debris_01_object" location = this } }
		20 = { create_ambient_object = { type = "medium_debris_02_object" location = this } }
		10 = { create_ambient_object = { type = "large_debris_object" location = this } }
		70 = { }
	}
}
ag_ancient_random_system_dry_habitable_world_effect = {
	random_list = {
		10 = { change_pc = pc_broken }
		30 = { change_pc = pc_molten }
		25 = { change_pc = pc_toxic }
		25 = { change_pc = pc_barren }
		10 = { }
	}
}
ag_ancient_random_system_temperate_habitable_world_effect = {
	random_list = {
		15 = { change_pc = pc_broken }
		15 = { change_pc = pc_toxic }
		30 = { change_pc = pc_barren }
		30 = { change_pc = pc_barren_cold }
		10 = { }
	}
}
ag_ancient_random_system_cold_habitable_world_effect = {
	random_list = {
		10 = { change_pc = pc_broken }
		20 = { change_pc = pc_toxic }
		30 = { change_pc = pc_barren_cold }
		30 = { change_pc = pc_frozen }
		10 = { }
	}
}

ag_ancient_event_system_set_name = {
	save_event_target_as = ag_original_name
	set_name = "NAME_ag_event_system"
	random_system_planet = {
		limit = { is_primary_star = yes }
		set_name = "NAME_ag_event_system"
	}
}
ag_ancient_random_system_set_name = {
	save_event_target_as = ag_original_name
	set_name = "NAME_ag_random_system"
	random_system_planet = {
		limit = { is_primary_star = yes }
		set_name = "NAME_ag_random_system"
	}
}

ag_set_disable_at_health = {
	if = {
		limit = { event_target:global_event_country = { check_variable = { which = ag_zero_variable value > $ag_value$ } } }
		remove_ship_flag = ag_set_disable_at_health
		remove_ship_flag = ag_set_disable_at_health_1
		remove_ship_flag = ag_set_disable_at_health_2
		remove_ship_flag = ag_set_disable_at_health_3
		remove_ship_flag = ag_set_disable_at_health_4
		remove_ship_flag = ag_set_disable_at_health_5
		remove_ship_flag = ag_set_disable_at_health_6
		remove_ship_flag = ag_set_disable_at_health_7
		remove_ship_flag = ag_set_disable_at_health_8
		remove_ship_flag = ag_set_disable_at_health_9
		remove_ship_flag = ag_set_disable_at_health_10
		set_disable_at_health = -1
	}
	else = {
		set_ship_flag = ag_set_disable_at_health
		set_disable_at_health = $ag_value$
		if = { limit = { NOT = { has_ship_flag = ag_set_disable_at_health_1 } } set_ship_flag = ag_set_disable_at_health_1 }
		else_if = { limit = { NOT = { has_ship_flag = ag_set_disable_at_health_2 } } set_ship_flag = ag_set_disable_at_health_2 }
		else_if = { limit = { NOT = { has_ship_flag = ag_set_disable_at_health_3 } } set_ship_flag = ag_set_disable_at_health_3 }
		else_if = { limit = { NOT = { has_ship_flag = ag_set_disable_at_health_4 } } set_ship_flag = ag_set_disable_at_health_4 }
		else_if = { limit = { NOT = { has_ship_flag = ag_set_disable_at_health_5 } } set_ship_flag = ag_set_disable_at_health_5 }
		else_if = { limit = { NOT = { has_ship_flag = ag_set_disable_at_health_6 } } set_ship_flag = ag_set_disable_at_health_6 }
		else_if = { limit = { NOT = { has_ship_flag = ag_set_disable_at_health_7 } } set_ship_flag = ag_set_disable_at_health_7 }
		else_if = { limit = { NOT = { has_ship_flag = ag_set_disable_at_health_8 } } set_ship_flag = ag_set_disable_at_health_8 }
		else_if = { limit = { NOT = { has_ship_flag = ag_set_disable_at_health_9 } } set_ship_flag = ag_set_disable_at_health_9 }
		else_if = { limit = { NOT = { has_ship_flag = ag_set_disable_at_health_10 } } set_ship_flag = ag_set_disable_at_health_10 }
	}
}
ag_subtract_disable_level = {
	if = { limit = { has_ship_flag = ag_set_disable_at_health_10 } remove_ship_flag = ag_set_disable_at_health_10 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_9 } remove_ship_flag = ag_set_disable_at_health_9 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_8 } remove_ship_flag = ag_set_disable_at_health_8 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_7 } remove_ship_flag = ag_set_disable_at_health_7 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_6 } remove_ship_flag = ag_set_disable_at_health_6 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_5 } remove_ship_flag = ag_set_disable_at_health_5 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_4 } remove_ship_flag = ag_set_disable_at_health_4 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_3 } remove_ship_flag = ag_set_disable_at_health_3 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_2 } remove_ship_flag = ag_set_disable_at_health_2 }
	else_if = {
		limit = { has_ship_flag = ag_set_disable_at_health_1 }
		ag_set_disable_at_health = { ag_value = -1 }
	}
}
ag_increase_disable_level = {
	if = { limit = { has_ship_flag = ag_set_disable_at_health_1 } set_ship_flag = ag_set_disable_at_health_2 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_2 } set_ship_flag = ag_set_disable_at_health_3 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_3 } set_ship_flag = ag_set_disable_at_health_4 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_4 } set_ship_flag = ag_set_disable_at_health_5 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_5 } set_ship_flag = ag_set_disable_at_health_6 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_6 } set_ship_flag = ag_set_disable_at_health_7 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_7 } set_ship_flag = ag_set_disable_at_health_8 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_8 } set_ship_flag = ag_set_disable_at_health_9 }
	else_if = { limit = { has_ship_flag = ag_set_disable_at_health_9 } set_ship_flag = ag_set_disable_at_health_10 }
}

ag_crystalize_astroid = {
	change_pc = pc_ag_crystalized_asteroid_$ag_color$
	random_list = {
		36 = { }
		25 = { add_deposit = d_rare_crystals_1 }
		16 = { add_deposit = d_rare_crystals_2 }
		9 = { add_deposit = d_rare_crystals_3 }
		4 = { add_deposit = d_rare_crystals_4 }
		1 = { add_deposit = d_rare_crystals_5 }
	}
}

ag_destroy_ambient_object = {
	every_system_ambient_object = {
		if = {
			limit = {
				NOR = {
					has_ambient_object_flag = ag_ancient_station
					has_ambient_object_flag = ag_beta_station_1
					has_ambient_object_flag = ag_beta_station_2
					has_ambient_object_flag = ag_beta_station_3
					has_ambient_object_flag = ag_beta_station_source_1
					has_ambient_object_flag = ag_beta_station_source_2
					has_ambient_object_flag = ag_beta_station_source_3
					has_ambient_object_flag = ag_gamma_station_dirty
					has_ambient_object_flag = ag_gamma_station_active
					has_ambient_object_flag = ag_gamma_station_small_1
					has_ambient_object_flag = ag_gamma_station_small_2
					has_ambient_object_flag = ag_gamma_station_small_3
					has_ambient_object_flag = ag_ancient_delta_platform
					has_ambient_object_flag = ag_ancient_zeta_research_station
					is_ambient_object_type = ag_psionic_portal_stabled_object
					is_ambient_object_type = ag_beta_psionic_structure_object
					is_ambient_object_type = ag_beta_psionic_system_effect_1
					is_ambient_object_type = ag_beta_psionic_system_effect_2
					is_ambient_object_type = ag_beta_psionic_system_effect_3
					is_ambient_object_type = ag_beta_drone_type2_psi_object
				}
			}
			destroy_ambient_object = this
		}
	}
}
ag_destroy_megastructure = {
	every_system_megastructure = {
		limit = { exists = this }
		if = {
			limit = {
				OR = {
					is_megastructure_type = dyson_sphere_0
					is_megastructure_type = dyson_sphere_1
					is_megastructure_type = dyson_sphere_2
					is_megastructure_type = dyson_sphere_3
					is_megastructure_type = dyson_sphere_4
					is_megastructure_type = dyson_sphere_5
					is_megastructure_type = dyson_sphere_ruined
					is_megastructure_type = dyson_sphere_restored
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = orange }
			solar_system = {
				if = {
					limit = { has_star_flag = dyson_sphere_built }
					remove_star_flag = dyson_sphere_built
				}
				if = {
					limit = {
						prev = {
							OR = {
								is_megastructure_type = dyson_sphere_5
								is_megastructure_type = dyson_sphere_restored
							}
						}
					}
					spawn_megastructure = { type = "dyson_sphere_ruined" coords_from = prev }
				}
			}
			if = {
				limit = {
					exists = owner
					owner = { has_country_flag = built_dyson_sphere }
				}
				owner = { remove_country_flag = built_dyson_sphere }
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = spy_orb_0
					is_megastructure_type = spy_orb_1
					is_megastructure_type = spy_orb_2
					is_megastructure_type = spy_orb_3
					is_megastructure_type = spy_orb_4
					is_megastructure_type = spy_orb_ruined
					is_megastructure_type = spy_orb_restored
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = orange }
			solar_system = {
				if = {
					limit = { has_star_flag = spy_orb_built }
					remove_star_flag = spy_orb_built
				}
				if = {
					limit = {
						prev = {
							OR = {
								is_megastructure_type = spy_orb_4
								is_megastructure_type = spy_orb_restored
							}
						}
					}
					spawn_megastructure = { type = "spy_orb_permanently_ruined" coords_from = prev.planet }
				}
			}
			if = {
				limit = {
					exists = owner
					owner = { has_country_flag = built_spyorb }
				}
				owner = { remove_country_flag = built_spyorb }
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = think_tank_0
					is_megastructure_type = think_tank_1
					is_megastructure_type = think_tank_2
					is_megastructure_type = think_tank_3
					is_megastructure_type = think_tank_4
					is_megastructure_type = think_tank_ruined
					is_megastructure_type = think_tank_restored
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = orange }
			solar_system = {
				if = {
					limit = { has_star_flag = think_tank_built }
					remove_star_flag = think_tank_built
				}
				if = {
					limit = {
						prev = {
							OR = {
								is_megastructure_type = think_tank_3
								is_megastructure_type = think_tank_4
								is_megastructure_type = think_tank_restored
							}
						}
					}
					spawn_megastructure = { type = "think_tank_permanently_ruined" coords_from = prev.planet }
				}
			}
			planet = {
				if = {
					limit = { has_planet_flag = has_megastructure }
					remove_planet_flag = has_megastructure
				}
			}
			if = {
				limit = {
					exists = owner
					owner = { has_country_flag = built_think_tank }
				}
				owner = { remove_country_flag = built_think_tank }
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = matter_decompressor_0
					is_megastructure_type = matter_decompressor_1
					is_megastructure_type = matter_decompressor_2
					is_megastructure_type = matter_decompressor_3
					is_megastructure_type = matter_decompressor_4
					is_megastructure_type = matter_decompressor_ruined
					is_megastructure_type = matter_decompressor_restored
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = orange }
			solar_system = {
				if = {
					limit = { has_star_flag = matter_decompressor_built }
					remove_star_flag = matter_decompressor_built
				}
				if = {
					limit = {
						prev = {
							OR = {
								is_megastructure_type = matter_decompressor_4
								is_megastructure_type = matter_decompressor_restored
							}
						}
					}
					spawn_megastructure = { type = "matter_decompressor_permanently_ruined" coords_from = prev.planet }
				}
			}
			if = {
				limit = {
					exists = owner
					owner = { has_country_flag = built_matter_decompressor_site }
				}
				owner = { remove_country_flag = built_matter_decompressor_site }
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = strategic_coordination_center_0
					is_megastructure_type = strategic_coordination_center_1
					is_megastructure_type = strategic_coordination_center_2
					is_megastructure_type = strategic_coordination_center_3
					is_megastructure_type = strategic_coordination_center_ruined
					is_megastructure_type = strategic_coordination_center_restored
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = orange }
			solar_system = {
				if = {
					limit = { has_star_flag = strategic_coordination_center_built }
					remove_star_flag = strategic_coordination_center_built
				}
				if = {
					limit = {
						prev = {
							OR = {
								is_megastructure_type = strategic_coordination_center_3
								is_megastructure_type = strategic_coordination_center_restored
							}
						}
					}
					spawn_megastructure = { type = "strategic_coordination_center_permanently_ruined" coords_from = prev.planet }
				}
			}
			if = {
				limit = {
					exists = owner
					owner = { has_country_flag = built_strategic_coordination_center_site }
				}
				owner = { remove_country_flag = built_strategic_coordination_center_site }
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = mega_art_installation_0
					is_megastructure_type = mega_art_installation_1
					is_megastructure_type = mega_art_installation_2
					is_megastructure_type = mega_art_installation_3
					is_megastructure_type = mega_art_installation_4
					is_megastructure_type = mega_art_installation_ruined
					is_megastructure_type = mega_art_installation_restored
					is_megastructure_type = mega_art_installation_restored_2
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = orange }
			solar_system = {
				if = {
					limit = { has_star_flag = mega_art_installation_built }
					remove_star_flag = mega_art_installation_built
				}
				if = {
					limit = {
						prev = {
							OR = {
								is_megastructure_type = mega_art_installation_3
								is_megastructure_type = mega_art_installation_4
								is_megastructure_type = mega_art_installation_restored
								is_megastructure_type = mega_art_installation_restored_2
							}
						}
					}
					spawn_megastructure = { type = "mega_art_installation_permanently_ruined" coords_from = prev.planet }
				}
			}
			if = {
				limit = {
					exists = owner
					owner = { has_country_flag = built_mega_art_installation_site }
				}
				owner = { remove_country_flag = built_mega_art_installation_site }
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = interstellar_assembly_0
					is_megastructure_type = interstellar_assembly_1
					is_megastructure_type = interstellar_assembly_2
					is_megastructure_type = interstellar_assembly_3
					is_megastructure_type = interstellar_assembly_4
					is_megastructure_type = interstellar_assembly_ruined
					is_megastructure_type = interstellar_assembly_restored
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = orange }
			solar_system = {
				if = {
					limit = { has_star_flag = interstellar_assembly_built }
					remove_star_flag = interstellar_assembly_built
				}
				if = {
					limit = {
						prev = {
							OR = {
								is_megastructure_type = interstellar_assembly_4
								is_megastructure_type = interstellar_assembly_restored
							}
						}
					}
					spawn_megastructure = { type = "interstellar_assembly_permanently_ruined" coords_from = prev.planet }
				}
			}
			if = {
				limit = {
					exists = owner
					owner = { has_country_flag = built_interstellar_assembly_site }
				}
				owner = { remove_country_flag = built_interstellar_assembly_site }
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = mega_shipyard_0
					is_megastructure_type = mega_shipyard_1
					is_megastructure_type = mega_shipyard_2
					is_megastructure_type = mega_shipyard_3
					is_megastructure_type = mega_shipyard_ruined
					is_megastructure_type = mega_shipyard_restored
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = orange }
			solar_system = {
				if = {
					limit = { has_star_flag = mega_shipyard_built }
					remove_star_flag = mega_shipyard_built
				}
				if = {
					limit = {
						prev = {
							OR = {
								is_megastructure_type = mega_shipyard_3
								is_megastructure_type = mega_shipyard_restored
							}
						}
					}
					spawn_megastructure = { type = "mega_shipyard_permanently_ruined" coords_from = prev.planet }
				}
			}
			if = {
				limit = {
					exists = owner
					owner = { has_country_flag = built_mega_shipyard_site }
				}
				owner = { remove_country_flag = built_mega_shipyard_site }
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				is_megastructure_type = ring_world_1
				is_megastructure_type = ring_world_2
				is_megastructure_type = ring_world_ruined
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = orange }
			solar_system = {
				if = {
					limit = { has_star_flag = ring_world_built }
					remove_star_flag = ring_world_built
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = gateway_0
					is_megastructure_type = gateway_final
					is_megastructure_type = gateway_ruined
					is_megastructure_type = gateway_restored
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = orange }
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = ag_beta_station_type2_megastructure
					is_megastructure_type = ag_delta_titan_megastructure_0
					is_megastructure_type = ag_delta_titan_megastructure_1
					is_megastructure_type = ag_gamma_station_megastructure_0
					is_megastructure_type = ag_gamma_station_megastructure_1
					is_megastructure_type = ag_gamma_station_megastructure_2
					is_megastructure_type = ag_gamma_station_megastructure_3
					is_megastructure_type = ag_gamma_station_megastructure_4
					is_megastructure_type = ag_gamma_station_megastructure_5
					is_megastructure_type = ag_gamma_station_megastructure_6
					is_megastructure_type = ag_gamma_station_megastructure_7
					is_megastructure_type = ag_gamma_station_megastructure_8
					is_megastructure_type = ag_gamma_station_megastructure_9
					is_megastructure_type = ag_gamma_station_megastructure_10
					is_megastructure_type = ag_gamma_station_megastructure_11
					is_megastructure_type = ag_gamma_station_megastructure_12
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
			solar_system = {
				every_system_planet = {
					if = {
						limit = { has_planet_flag = ag_using_ancient_construction_section_system }
						remove_planet_flag = ag_using_ancient_construction_section_system
					}
					if = {
						limit = { has_planet_flag = has_megastructure }
						remove_planet_flag = has_megastructure
					}
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = ag_ancient_anchor_station_0
					is_megastructure_type = ag_ancient_anchor_station_1
					is_megastructure_type = ag_ancient_anchor_station_2
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
			if = {
				limit = {
					is_megastructure_type = ag_ancient_anchor_station_1
					exists = event_target:ag_ancient_wandering_ship_fleet
				}
				event_target:ag_ancient_wandering_ship_fleet = {
					change_variable = {
						which = ag_num_disabled_anchor_stations
						value = 1
					}
				}
			}
			every_country = {
				limit = { has_event_chain = ag_ancient_anchor_station_chain }
				add_event_chain_counter = {
					event_chain = ag_ancient_anchor_station_chain
					counter = ag_ancient_anchor_station
					amount = -1
				}
				if = {
					limit = { prev = { is_megastructure_type = ag_ancient_anchor_station_2 } }
					add_event_chain_counter = {
						event_chain = ag_ancient_anchor_station_chain
						counter = ag_ancient_anchor_station_modified
						amount = -1
					}
				}
			}
			solar_system = {
				remove_star_flag = ag_ancient_anchor_system
				if = {
					limit = { has_star_flag = ag_ancient_anchor_system_1 }
					remove_star_flag = ag_ancient_anchor_system_1
				}
				else_if = {
					limit = { has_star_flag = ag_ancient_anchor_system_2 }
					remove_star_flag = ag_ancient_anchor_system_2
				}
				else_if = {
					limit = { has_star_flag = ag_ancient_anchor_system_3 }
					remove_star_flag = ag_ancient_anchor_system_3
				}
				else_if = {
					limit = { has_star_flag = ag_ancient_anchor_system_4 }
					remove_star_flag = ag_ancient_anchor_system_4
				}
				else_if = {
					limit = { has_star_flag = ag_ancient_anchor_system_5 }
					remove_star_flag = ag_ancient_anchor_system_5
				}
				else_if = {
					limit = { has_star_flag = ag_ancient_anchor_system_6 }
					remove_star_flag = ag_ancient_anchor_system_6
				}
				else_if = {
					limit = { has_star_flag = ag_ancient_anchor_system_7 }
					remove_star_flag = ag_ancient_anchor_system_7
				}
				else_if = {
					limit = { has_star_flag = ag_ancient_anchor_system_8 }
					remove_star_flag = ag_ancient_anchor_system_8
				}
				else_if = {
					limit = { has_star_flag = ag_ancient_anchor_system_9 }
					remove_star_flag = ag_ancient_anchor_system_9
				}
				else_if = {
					limit = { has_star_flag = ag_ancient_anchor_system_10 }
					remove_star_flag = ag_ancient_anchor_system_10
				}
				random_system_planet = {
					limit = { has_planet_flag = ag_ancient_anchor_planet }
					remove_planet_flag = ag_ancient_anchor_planet
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = { is_megastructure_type = ag_ancient_construction_section }
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
			solar_system = {
				random_system_planet = {
					limit = { is_primary_star = yes }
					subtract_variable = {
						which = ag_construction_section_counter
						value = 1
					}
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				NOR = {
					is_megastructure_type = ag_psionic_portal_megastructure
					is_megastructure_type = ag_psionic_portal_stabled_megastructure
					is_megastructure_type = ag_ancient_anchor_station_0
					is_megastructure_type = ag_ancient_anchor_station_1
					is_megastructure_type = ag_ancient_anchor_station_2
					is_megastructure_type = ag_ancient_astronomy_station
					is_megastructure_type = lgate_base
				}
			}
			remove_megastructure = this
		}
	}
	every_system_planet = {
		limit = {
			OR = {
				is_planet_class = pc_ringworld_seam
				is_planet_class = pc_ringworld_tech
			}
		}
		if = {
			limit = {
				OR = {
					is_planet_class = pc_ringworld_seam
					AND = {
						is_planet_class = pc_ringworld_tech
						has_planet_flag = ag_ancient_resource_section_0
					}
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = orange }
			change_pc = pc_ringworld_seam_damaged
			if = {
				limit = { has_planet_flag = ag_ancient_resource_section_0 }
				remove_planet_flag = ag_ancient_resource_section_0
			}
		}
		else = {
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = orange }
			change_pc = pc_ringworld_tech_damaged
			if = {
				limit = { has_planet_flag = ag_ancient_construction_section_0 }
				remove_planet_flag = ag_ancient_construction_section_0
			}
			if = {
				limit = { has_planet_flag = ag_ancient_construction_section }
				remove_planet_flag = ag_ancient_construction_section
			}
		}
	}
}
ag_destroy_fleet = {
	every_owned_ship = {
		destroy_ship = this
		fire_on_action = {
			on_action = on_ship_disabled
			scopes = { from = $ag_killer_ship$ }
		}
		owner = {
			fire_on_action = {
				on_action = on_ship_destroyed_victim
				scopes = {
					from = $ag_killer_country$
					fromfrom = prevprev
					fromfromfrom = $ag_killer_ship$
				}
			}
		}
		$ag_killer_country$ = {
			fire_on_action = {
				on_action = on_ship_destroyed_perp
				scopes = {
					from = prevprev.owner
					fromfrom = $ag_killer_ship$
					fromfromfrom = prevprev
				}
			}
		}
	}
	owner = {
		fire_on_action = {
			on_action = on_fleet_destroyed_victim
			scopes = {
				from = $ag_killer_country$
				fromfrom = prevprev
				fromfromfrom = $ag_killer_fleet$
			}
		}
	}
	$ag_killer_country$ = {
		fire_on_action = {
			on_action = on_fleet_destroyed_perp
			scopes = {
				from = prevprev.owner
				fromfrom = $ag_killer_fleet$
				fromfromfrom = prevprev
			}
		}
	}
}
ag_destroy_ship = {
	if = {
		limit = { exists = fleet fleet = { num_ships = 1 } }
		destroy_ship = this
		fire_on_action = {
			on_action = on_ship_disabled
			scopes = { from = $ag_killer_ship$ }
		}
		owner = {
			fire_on_action = {
				on_action = on_ship_destroyed_victim
				scopes = {
					from = $ag_killer_country$
					fromfrom = prevprev
					fromfromfrom = $ag_killer_ship$
				}
			}
		}
		$ag_killer_country$ = {
			fire_on_action = {
				on_action = on_ship_destroyed_perp
				scopes = {
					from = prevprev.owner
					fromfrom = $ag_killer_ship$
					fromfromfrom = prevprev
				}
			}
		}
		owner = {
			fire_on_action = {
				on_action = on_fleet_destroyed_victim
				scopes = {
					from = $ag_killer_country$
					fromfrom = prevprev.fleet
					fromfromfrom = $ag_killer_ship$.fleet
				}
			}
		}
		$ag_killer_country$ = {
			fire_on_action = {
				on_action = on_fleet_destroyed_perp
				scopes = {
					from = prevprev.owner
					fromfrom = $ag_killer_ship$.fleet
					fromfromfrom = prevprev.fleet
				}
			}
		}
	}
	else = {
		destroy_ship = this
		fire_on_action = {
			on_action = on_ship_disabled
			scopes = { from = $ag_killer_ship$ }
		}
		owner = {
			fire_on_action = {
				on_action = on_ship_destroyed_victim
				scopes = {
					from = $ag_killer_country$
					fromfrom = prevprev
					fromfromfrom = $ag_killer_ship$
				}
			}
		}
		$ag_killer_country$ = {
			fire_on_action = {
				on_action = on_ship_destroyed_perp
				scopes = {
					from = prevprev.owner
					fromfrom = $ag_killer_ship$
					fromfromfrom = prevprev
				}
			}
		}
	}
}

ag_ship_action_button_effect = {
	if = {
		limit = { ag_any_ship_has_action = yes }
		custom_tooltip = "ag_action_button_title_desc"
		hidden_effect = { fleet_event = { id = ag_ship_action.1 } }
	}
	else = { custom_tooltip = "ag_action_empty" }
}

ag_reduce_hp_percent = {
	if = {
		limit = { has_hp > 9223372 }
		if = { limit = { has_hp > 80000000 }
			if = { limit = { has_hp > 200000000 }
				if = { limit = { has_hp > 400000000 }
					if = { limit = { has_hp > 800000000 } while = { count = $ag_value$ reduce_hp = 8000000 } }
					else = { while = { count = $ag_value$ reduce_hp = 4000000 } }
				}
				else = { while = { count = $ag_value$ reduce_hp = 2000000 } }
			}
			else = { while = { count = $ag_value$ reduce_hp = 1000000 } }
		}
		else_if = { limit = { has_hp > 20000000 }
			if = { limit = { has_hp > 40000000 } while = { count = $ag_value$ reduce_hp = 400000 } }
			else = { while = { count = $ag_value$ reduce_hp = 200000 } }
		}
		else_if = { limit = { has_hp > 10000000 } while = { count = $ag_value$ reduce_hp = 100000 } }
		else_if = { limit = { always = yes } while = { count = $ag_value$ reduce_hp = 92233 } }
	}
	else = { reduce_hp_percent = $ag_value$ }
}

#######################################
###				Beta
#######################################

ag_beta_zero_variable = {
	event_target:global_event_country = {
		set_variable = {
			which = ag_zero_variable
			value = 0
		}
	}
}
ag_beta_psionic_system_effect = {
	every_system_ambient_object = {
		limit = { has_ambient_object_flag = ag_beta_psionic_system_effect }
		destroy_ambient_object = this
	}
	if = { limit = { has_star_flag = ag_beta_psionic_system_1 } remove_star_flag = ag_beta_psionic_system_1 remove_modifier = ag_beta_psionic_environment_1 }
	if = { limit = { has_star_flag = ag_beta_psionic_system_2 } remove_star_flag = ag_beta_psionic_system_2 remove_modifier = ag_beta_psionic_environment_2 }
	if = { limit = { has_star_flag = ag_beta_psionic_system_3 } remove_star_flag = ag_beta_psionic_system_3 remove_modifier = ag_beta_psionic_environment_3 }
	if = {
		limit = { event_target:global_event_country = { check_variable = { which = ag_zero_variable value < $ag_level$ } } }
		set_star_flag = ag_beta_psionic_system_$ag_level$
		add_modifier = {
			modifier = ag_beta_psionic_environment_$ag_level$
			days = -1
		}
		star = {
			create_ambient_object = {
				type = ag_beta_psionic_system_effect_$ag_level$
				location = this
			}
			last_created_ambient_object = {
				set_ambient_object_flag = ag_beta_psionic_system_effect
				set_ambient_object_flag = ag_beta_psionic_system_effect_$ag_level$
				set_location = {
					target = prev
					distance = 0
					angle = random
				}
			}
		}
	}
	every_system_planet = {
		limit = { is_star = no is_asteroid = no }
		if = { limit = { has_modifier = ag_atmospheric_aphrodisiac_0 } remove_modifier = ag_atmospheric_aphrodisiac_0 }
		if = { limit = { has_modifier = ag_atmospheric_aphrodisiac_1 } remove_modifier = ag_atmospheric_aphrodisiac_1 }
		if = { limit = { has_modifier = ag_atmospheric_aphrodisiac_2 } remove_modifier = ag_atmospheric_aphrodisiac_2 }
		if = { limit = { has_modifier = ag_atmospheric_aphrodisiac_3 } remove_modifier = ag_atmospheric_aphrodisiac_3 }
		if = { limit = { has_planet_flag = ag_atmospheric_aphrodisiac_1 } remove_planet_flag = ag_atmospheric_aphrodisiac_1 }
		if = { limit = { has_planet_flag = ag_atmospheric_aphrodisiac_2 } remove_planet_flag = ag_atmospheric_aphrodisiac_2 }
		if = { limit = { has_planet_flag = ag_atmospheric_aphrodisiac_3 } remove_planet_flag = ag_atmospheric_aphrodisiac_3 }
		if = {
			limit = { event_target:global_event_country = { check_variable = { which = ag_zero_variable value < $ag_level$ } } }
			add_modifier = { modifier = ag_atmospheric_aphrodisiac_$ag_level$ days = -1 }
			set_planet_flag = ag_atmospheric_aphrodisiac_$ag_level$
			set_planet_flag = ag_beta_psionic_affected_planet
			if = {
				limit = {
					NOT = { is_same_value = event_target:ag_ancient_beta_shielded_world }
					exists = owner
					owner = {
						NOR = {
							has_country_flag = ag_beta_31_fired
							has_country_flag = ag_beta_31_banned
						}
					}
				}
				owner = {
					if = {
						limit = {
							NOT = { has_country_flag = ag_beta_31_fired }
						}
						prev = { planet_event = { id = ag_beta.31 } }
					}
					else = {
						prev = { planet_event = { id = ag_beta.32 } }
					}
				}
			}
		}
		else = { remove_planet_flag = ag_beta_psionic_affected_planet }
	}
}
ag_beta_set_blocker = {
	if = {
		limit = { AND = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no } }
		while = {
			count = $ag_num_blockers$
			add_deposit = ag_beta_dense_jungle_deposit_ringworld
		}
	}
	else_if = {
		limit = { ag_is_habitat = yes }
		while = {
			count = $ag_num_blockers$
			add_deposit = ag_beta_dense_jungle_deposit_habitat
		}
	}
	else_if = {
		limit = { always = yes }
		while = {
			count = $ag_num_blockers$
			add_deposit = ag_beta_dense_jungle_deposit
		}
	}
}
ag_beta_kill_pop = {
	random_list = {
		25 = { modifier = { factor = 0 NOT = { has_modifier = ag_beta_protection } } }
		75 = { random_owned_pop = { kill_pop = yes } }
	}
	change_variable = { which = ag_beta_num_victims_planet value = 1 }
	owner = { change_variable = { which = ag_beta_num_victims_country value = 1 } }
}
ag_beta_planet_debuff_check = {
	if = {
		limit = {
			exists = owner
			owner = {
				is_gestalt = no
				NOT = { has_country_flag = ag_beta_34_cooldown }
			}
		}
		random_list = {
			3 = {
				planet_event = { id = ag_beta.34 }
			}
			97 = { }
		}
	}
}
ag_beta_destroy_planet_check = {
	if = {
		limit = { num_pops < 3 }
		if = { limit = { has_modifier = ag_beta_planet_unstable } remove_modifier = ag_beta_planet_unstable }
		add_planet_devastation = -100
		remove_all_districts = yes
		if = {
			limit = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no }
			ag_beta_destroy_planet_set_blocker = { ag_planet_class = ringworld }
		}
		else_if = {
			limit = { ag_is_habitat = yes }
			ag_beta_destroy_planet_set_blocker = { ag_planet_class = habitat }
		}
		else_if = {
			limit = { always = yes }
			ag_beta_destroy_planet_set_blocker = yes
		}
		planet_event = { id = ag_beta.35 }
	}
}
ag_beta_destroy_planet_set_blocker = {
	if = { limit = { planet_size = 32 } while = { count = 32 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
	else_if = { limit = { planet_size < 32 }
		if = { limit = { planet_size = 16 } while = { count = 16 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
		else_if = { limit = { planet_size < 16 }
			if = { limit = { planet_size = 8 } while = { count = 8 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
			else_if = { limit = { planet_size < 8 }
				if = { limit = { planet_size = 4 } while = { count = 4 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				else_if = { limit = { planet_size < 4 }
					if = { limit = { planet_size = 2 } while = { count = 2 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 2 } while = { count = 1 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 3 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { planet_size = 6 } while = { count = 6 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 6 } while = { count = 5 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 7 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
			}
			else_if = { limit = { always = yes }
				if = { limit = { planet_size = 12 } while = { count = 12 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				else_if = { limit = { planet_size < 12 }
					if = { limit = { planet_size = 10 } while = { count = 10 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 10 } while = { count = 9 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 11 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { planet_size = 14 } while = { count = 14 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 14 } while = { count = 13 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 15 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
			}
		}
		else_if = { limit = { always = yes }
			if = { limit = { planet_size = 24 } while = { count = 24 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
			else_if = { limit = { planet_size < 24 }
				if = { limit = { planet_size = 20 } while = { count = 20 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				else_if = { limit = { planet_size < 20 }
					if = { limit = { planet_size = 18 } while = { count = 18 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 18 } while = { count = 17 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 19 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { planet_size = 22 } while = { count = 22 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 22 } while = { count = 21 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 23 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
			}
			else_if = { limit = { always = yes }
				if = { limit = { planet_size = 28 } while = { count = 28 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				else_if = { limit = { planet_size < 28 }
					if = { limit = { planet_size = 26 } while = { count = 26 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 26 } while = { count = 25 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 27 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { planet_size = 30 } while = { count = 30 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 30 } while = { count = 29 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 31 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
			}
		}
	}
	else_if = { limit = { always = yes }
		if = { limit = { planet_size = 48 } while = { count = 48 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
		else_if = { limit = { planet_size < 48 }
			if = { limit = { planet_size = 40 } while = { count = 40 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
			else_if = { limit = { planet_size < 40 }
				if = { limit = { planet_size = 36 } while = { count = 36 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				else_if = { limit = { planet_size < 36 }
					if = { limit = { planet_size = 34 } while = { count = 34 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 34 } while = { count = 33 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 35 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { planet_size = 38 } while = { count = 38 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 38 } while = { count = 37 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 39 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
			}
			else_if = { limit = { always = yes }
				if = { limit = { planet_size = 44 } while = { count = 44 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				else_if = { limit = { planet_size < 44 }
					if = { limit = { planet_size = 42 } while = { count = 42 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 42 } while = { count = 41 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 43 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { planet_size = 46 } while = { count = 46 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 46 } while = { count = 45 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 47 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
			}
		}
		else_if = { limit = { always = yes }
			if = { limit = { planet_size = 56 } while = { count = 56 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
			else_if = { limit = { planet_size < 56 }
				if = { limit = { planet_size = 52 } while = { count = 52 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				else_if = { limit = { planet_size < 52 }
					if = { limit = { planet_size = 50 } while = { count = 50 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 50 } while = { count = 49 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 51 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { planet_size = 54 } while = { count = 54 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 54 } while = { count = 53 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 55 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
			}
			else_if = { limit = { always = yes }
				if = { limit = { planet_size = 60 } while = { count = 60 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				else_if = { limit = { planet_size < 60 }
					if = { limit = { planet_size = 58 } while = { count = 58 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 58 } while = { count = 57 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 59 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
				else_if = { limit = { always = yes }
					if = { limit = { planet_size = 62 } while = { count = 62 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { planet_size < 62 } while = { count = 61 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
					else_if = { limit = { always = yes } while = { count = 63 add_deposit = ag_beta_dense_jungle_deposit[[ag_planet_class]_$ag_planet_class$] } }
				}
			}
		}
	}
}

ag_beta_spawn_signal_station = {
	if = {
		limit = {
			any_system = {
				ag_spawnsystem_trigger = yes
			}
		}
		random_system = {
			limit = {
				ag_spawnsystem_trigger = yes
			}
			spawn_system = {
				min_distance >= 20
				max_distance <= 50
				initializer = $ag_system_to_spawn$
			}
		}
	}
	else_if = {
		limit = {
			any_rim_system = {
				ag_spawnsystem_trigger_fallback_1 = yes
			}
		}
		random_rim_system = {
			limit = {
				ag_spawnsystem_trigger_fallback_1 = yes
			}
			spawn_system = {
				min_distance >= 20
				max_distance <= 50
				initializer = $ag_system_to_spawn$
			}
		}
	}
	else_if = {
		limit = {
			any_system = {
				ag_spawnsystem_trigger_fallback_2 = yes
			}
		}
		random_system = {
			limit = {
				ag_spawnsystem_trigger_fallback_2 = yes
			}
			spawn_system = {
				min_distance >= 20
				max_distance <= 50
				initializer = $ag_system_to_spawn$
			}
		}
	}
	else_if = {
		limit = { always = yes }
		random_system = {
			spawn_system = {
				min_distance >= 20
				max_distance <= 50
				initializer = $ag_system_to_spawn$
			}
		}
	}
}

ag_beta_signal_station_event_chain_check = {
	if = {
		limit = {
			NOT = {
				has_event_chain = "ag_hidden_system_chain"
			}
		}
		begin_event_chain = {
			event_chain = "ag_hidden_system_chain"
			target = root.owner
		}
	}
}

ag_beta_psionic_patten_chain_check = {
	if = {
		limit = { NOT = { has_event_chain = "ag_beta_station_chain" } }
		begin_event_chain = {
			event_chain = "ag_beta_station_chain"
			target = root
		}
		create_point_of_interest = {
			id = ag_beta_station_system_1
			name = "ag_beta_station_system_1"
			desc = "ag_beta_station_system_1_desc"
			event_chain = ag_beta_station_chain
			location = event_target:ag_beta_station_system_1_star
		}
		create_point_of_interest = {
			id = ag_beta_station_system_2
			name = "ag_beta_station_system_2"
			desc = "ag_beta_station_system_2_desc"
			event_chain = ag_beta_station_chain
			location = event_target:ag_beta_station_system_2_star
		}
		create_point_of_interest = {
			id = ag_beta_station_system_3
			name = "ag_beta_station_system_3"
			desc = "ag_beta_station_system_3_desc"
			event_chain = ag_beta_station_chain
			location = event_target:ag_beta_station_system_3_star
		}
	}
}
ag_beta_reset_poi = {
	save_event_target_as = ag_target_system
	switch = {
		trigger = has_star_flag
		ag_beta_station_system_1 = {
			root.owner = {
				set_country_flag = ag_beta_station_system_1_entered
				remove_point_of_interest = ag_beta_station_system_1
				create_point_of_interest = {
					id = ag_beta_station_system_1
					name = "ag_beta_station_system_1_alt"
					desc = "ag_ancient_coordinate"
					event_chain = "ag_hidden_system_chain"
					location = event_target:ag_beta_station_system_1_star
				}
			}
		}
		ag_beta_station_system_2 = {
			root.owner = {
				set_country_flag = ag_beta_station_system_2_entered
				remove_point_of_interest = ag_beta_station_system_2
				create_point_of_interest = {
					id = ag_beta_station_system_2
					name = "ag_beta_station_system_2_alt"
					desc = "ag_ancient_coordinate"
					event_chain = "ag_hidden_system_chain"
					location = event_target:ag_beta_station_system_2_star
				}
			}
		}
		ag_beta_station_system_3 = {
			root.owner = {
				set_country_flag = ag_beta_station_system_3_entered
				remove_point_of_interest = ag_beta_station_system_3
				create_point_of_interest = {
					id = ag_beta_station_system_3
					name = "ag_beta_station_system_3_alt"
					desc = "ag_ancient_coordinate"
					event_chain = "ag_hidden_system_chain"
					location = event_target:ag_beta_station_system_3_star
				}
			}
		}
	}
	root.owner = {
		add_event_chain_counter = {
			event_chain = "ag_hidden_system_chain"
			counter = ag_ancient_system
			amount = 1
		}
	}
}

#######################################
###				Gamma
#######################################

ag_gamma_station_colony_effect = {
	every_system_planet = {
		if = {
			limit = {
				is_colony = yes
				num_pops > 0
				NOR = {
					is_planet_class = pc_nuked
					ag_is_habitat = yes
					AND = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no }
				}
			}
			change_pc = pc_nuked
			if = {
				limit = {
					NOT = {
						has_modifier = "ag_ancient_gamma_station_in_system"
					}
				}
				add_modifier = {
					modifier = "ag_ancient_gamma_station_in_system"
					days = -1
				}
			}
		}
		if = {
			limit = {
				is_colony = yes
				num_pops > 0
				OR = {
					is_planet_class = pc_nuked
					ag_is_habitat = yes
					AND = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no }
				}
			}
			if = {
				limit = {
					NOT = {
						has_modifier = "ag_ancient_gamma_station_in_system"
					}
				}
				add_modifier = {
					modifier = "ag_ancient_gamma_station_in_system"
					days = -1
				}
			}
		}
	}
	every_country = {
		limit = {
			NOT = {
				is_same_value = event_target:ag_ancient_gamma_guardian_country
			}
			has_event_chain = ag_gamma_guardian_crisis_chain
		}
		add_event_chain_counter = {
			event_chain = "ag_gamma_guardian_crisis_chain"
			counter = "ag_gamma_station_small_deployed"
			amount = 1
		}
	}
}

ag_remove_all_modifier_gamma = {
	if = {
		limit = {
			has_modifier = "ag_ancient_gamma_station_in_system"
		}
		remove_modifier = "ag_ancient_gamma_station_in_system"
	}
	if = {
		limit = {
			has_modifier = "ag_ancient_bombardment_effect_1"
		}
		remove_modifier = "ag_ancient_bombardment_effect_1"
	}
	if = {
		limit = {
			has_modifier = "holy_planet"
		}
		remove_modifier = "holy_planet"
	}
}

ag_gamma_station_damage_ship_in_system = {
	every_fleet_in_system = {
		limit = {
			owner = {
				NOT = {
					is_same_value = event_target:ag_ancient_gamma_guardian_country
				}
			}
		}
		every_owned_ship = {
			limit = { NOT = { ag_is_ancient_ship = yes } }
			reduce_hp_percent = $ag_gamma_damage_percent$
			ag_spawn_explosion_effect = { ag_scale = l ag_color = red }
		}
	}
}

#######################################
###				Delta
#######################################

ag_deploy_ancient_turret_preparation = {
	add_modifier = { modifier = "ag_delta_platform_deploying" days = $ag_delay$ }
	set_fleet_flag = ag_delta_platform_deploying
	clear_orders = yes
	clear_fleet_actions = this
	fleet_event = { id = ag_delta.70 days = $ag_delay$ }
}
ag_deploy_ancient_turret_effect = {
	if = {
		limit = { owner = { NOT = { has_country_flag = ag_delta_ships_unlocked } } }
		create_fleet = {
			name = "NAME_ag_delta_platform_fleet"
			settings = {
				can_upgrade = no
				can_change_composition = no
				can_change_leader = no
				spawn_debris = no
			}
			effect = {
				ag_spawn_explosion_effect = { ag_scale = l ag_color = blue }
				set_owner = prev.owner
				create_ship = {
					name = "NAME_ag_delta_platform_ship"
					design = "NAME_ag_delta_platform_0"
					prefix = no
					effect = {
						if = {
							limit = { prevprev.owner = { has_country_flag = ag_ship_subsystem_enabled_402_15 } }
							add_modifier = { modifier = "ag_delta_platform_range_buff" days = -1 }
						}
						ag_difficulty_bonus = yes
					}
				}
				set_location = { target = prev distance = 0 angle = 0 }
			}
		}
	}
	else = {
		create_fleet = {
			name = "NAME_ag_delta_platform_fleet"
			settings = {
				can_upgrade = no
				can_change_composition = no
				can_change_leader = no
				spawn_debris = no
			}
			effect = {
				ag_spawn_explosion_effect = { ag_scale = l ag_color = red }
				set_owner = prev.owner
				create_ship = {
					name = "NAME_ag_delta_platform_ship"
					design = "NAME_ag_delta_platform_1"
					prefix = no
					effect = {
						if = {
							limit = { prevprev.owner = { has_country_flag = ag_ship_subsystem_enabled_402_15 } }
							add_modifier = { modifier = "ag_delta_platform_range_buff" days = -1 }
						}
						ag_difficulty_bonus = yes
					}
				}
				set_location = { target = prev distance = 0 angle = 0 }
			}
		}
	}
	delete_fleet = this
}

#######################################
###				Epsilon
#######################################

ag_set_fallen_empire_guardian_formation = {
	set_fleet_formation = {
		position = { x = 7.5 y = 12.99 }		# 4
		position = { x = 7.5 y = -12.99 }	# 3
		position = { x = -15 y = 0 }			# 2
		position = { x = 0.0 y = 0.0 }		# 1
	}
	set_formation_scale = 0.25
}

ag_set_epsilon_obelisk_code = {
	random_list = {
		10 = { set_planet_flag = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$_0 event_target:global_event_country = { set_variable = { which = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$ value = 0 } } }
		10 = { set_planet_flag = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$_1 event_target:global_event_country = { set_variable = { which = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$ value = 1 } } }
		10 = { set_planet_flag = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$_2 event_target:global_event_country = { set_variable = { which = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$ value = 2 } } }
		10 = { set_planet_flag = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$_3 event_target:global_event_country = { set_variable = { which = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$ value = 3 } } }
		10 = { set_planet_flag = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$_4 event_target:global_event_country = { set_variable = { which = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$ value = 4 } } }
		10 = { set_planet_flag = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$_5 event_target:global_event_country = { set_variable = { which = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$ value = 5 } } }
		10 = { set_planet_flag = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$_6 event_target:global_event_country = { set_variable = { which = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$ value = 6 } } }
		10 = { set_planet_flag = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$_7 event_target:global_event_country = { set_variable = { which = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$ value = 7 } } }
		10 = { set_planet_flag = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$_8 event_target:global_event_country = { set_variable = { which = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$ value = 8 } } }
		10 = { set_planet_flag = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$_9 event_target:global_event_country = { set_variable = { which = ag_epsilon_obelisk_$ag_obelisk_seq$_$ag_position$ value = 9 } } }
	}
}

ag_upgrade_epsilon_obelisk = {
	switch = {
		trigger = has_megastructure_flag
		ag_epsilon_obelisk_1 = { solar_system = {
			spawn_megastructure = {
				type = ag_epsilon_obelisk_$ag_target_level$
				coords_from = prev
				owner = prev.owner
				init_effect = { set_megastructure_flag = ag_epsilon_obelisk_1 }
			}
		} }
		ag_epsilon_obelisk_2 = { solar_system = {
			spawn_megastructure = {
				type = ag_epsilon_obelisk_$ag_target_level$
				coords_from = prev
				owner = prev.owner
				init_effect = { set_megastructure_flag = ag_epsilon_obelisk_2 }
			}
		} }
		ag_epsilon_obelisk_3 = { solar_system = {
			spawn_megastructure = {
				type = ag_epsilon_obelisk_$ag_target_level$
				coords_from = prev
				owner = prev.owner
				init_effect = { set_megastructure_flag = ag_epsilon_obelisk_3 }
			}
		} }
	}
	remove_megastructure = this
}
ag_upgrade_epsilon_titan_station = {
	solar_system = { spawn_megastructure = {
		type = ag_epsilon_titan_station_actived_$ag_target_level$
		coords_from = prev
		owner = prev.owner
	} }
	remove_megastructure = this
}

#######################################
###				Zeta
#######################################

ag_set_vanilla_shrouded_ringworld = {
	set_planet_entity = {
		entity = "ag_vanilla_ringworld_habitable_shrouded_$ag_graphical_culture$_entity"
	}
}

ag_spawn_ancient_debris = {
	ag_spawn_ancient_debris_1 = { ag_num = 1 }
	ag_spawn_ancient_debris_1 = { ag_num = 2 }
	ag_spawn_ancient_debris_1 = { ag_num = 3 }
	ag_spawn_ancient_debris_1 = { ag_num = 4 }
	ag_spawn_ancient_debris_1 = { ag_num = 5 }
	ag_spawn_ancient_debris_1 = { ag_num = 6 }
	if = {
		limit = { star = { check_variable = { which = ag_num_ancient_debris value < 1 } } }
		set_global_flag = ag_zeta_no_ancient_debris
	}
}
ag_spawn_ancient_debris_1 = {
	random_list = {
		90 = { }
		10 = {
			star = { change_variable = { which = ag_num_ancient_debris value = 1 } }
			create_ambient_object = {
				type = "ag_zeta_titan_debris_1_object"
				entity_offset_height = { min = 15 max = -15 }
				entity_offset_angle = { min = 0 max = 359 }
				location = solar_system
			}
			last_created_ambient_object = {
				ag_set_zeta_debris_object_flag = { ag_ship_class = titan ag_num = $ag_num$ }
			}
		}
		10 = {
			star = { change_variable = { which = ag_num_ancient_debris value = 1 } }
			create_ambient_object = {
				type = "ag_zeta_titan_debris_2_object"
				entity_offset_height = { min = 15 max = -15 }
				entity_offset_angle = { min = 0 max = 359 }
				location = solar_system
			}
			last_created_ambient_object = {
				ag_set_zeta_debris_object_flag = { ag_ship_class = titan ag_num = $ag_num$ }
			}
		}
		10 = {
			star = { change_variable = { which = ag_num_ancient_debris value = 1 } }
			create_ambient_object = {
				type = "ag_zeta_titan_debris_3_object"
				entity_offset_height = { min = 15 max = -15 }
				entity_offset_angle = { min = 0 max = 359 }
				location = solar_system
			}
			last_created_ambient_object = {
				ag_set_zeta_debris_object_flag = { ag_ship_class = titan ag_num = $ag_num$ }
			}
		}
		10 = {
			star = { change_variable = { which = ag_num_ancient_debris value = 1 } }
			create_ambient_object = {
				type = "ag_zeta_battleship_debris_1_object"
				entity_offset_height = { min = 15 max = -15 }
				entity_offset_angle = { min = 0 max = 359 }
				location = solar_system
			}
			last_created_ambient_object = {
				random_list = {
					10 = {
						create_ambient_object = {
							type = "ag_zeta_battleship_debris_1_object"
							entity_offset_height = { min = 15 max = -15 }
							entity_offset_angle = { min = 0 max = 359 }
							location = solar_system
						}
						last_created_ambient_object = {
							ag_set_zeta_debris_object_flag = { ag_ship_class = battleship ag_num = $ag_num$ }
							random_list = {
								25 = { set_location = { target = prev distance = 10 angle = random } }
								25 = { set_location = { target = prev distance = 15 angle = random } }
								25 = { set_location = { target = prev distance = 20 angle = random } }
								25 = { set_location = { target = prev distance = 25 angle = random } }
							}
						}
					}
					10 = {
						create_ambient_object = {
							type = "ag_zeta_battleship_debris_2_object"
							entity_offset_height = { min = 15 max = -15 }
							entity_offset_angle = { min = 0 max = 359 }
							location = solar_system
						}
						last_created_ambient_object = {
							ag_set_zeta_debris_object_flag = { ag_ship_class = battleship ag_num = $ag_num$ }
							random_list = {
								25 = { set_location = { target = prev distance = 10 angle = random } }
								25 = { set_location = { target = prev distance = 15 angle = random } }
								25 = { set_location = { target = prev distance = 20 angle = random } }
								25 = { set_location = { target = prev distance = 25 angle = random } }
							}
						}
					}
					10 = {
						create_ambient_object = {
							type = "ag_zeta_battleship_debris_3_object"
							entity_offset_height = { min = 15 max = -15 }
							entity_offset_angle = { min = 0 max = 359 }
							location = solar_system
						}
						last_created_ambient_object = {
							ag_set_zeta_debris_object_flag = { ag_ship_class = battleship ag_num = $ag_num$ }
							random_list = {
								25 = { set_location = { target = prev distance = 10 angle = random } }
								25 = { set_location = { target = prev distance = 15 angle = random } }
								25 = { set_location = { target = prev distance = 20 angle = random } }
								25 = { set_location = { target = prev distance = 25 angle = random } }
							}
						}
					}
				}
				ag_set_zeta_debris_object_flag = { ag_ship_class = battleship ag_num = $ag_num$ }
			}
		}
		10 = {
			star = { change_variable = { which = ag_num_ancient_debris value = 1 } }
			create_ambient_object = {
				type = "ag_zeta_battleship_debris_2_object"
				entity_offset_height = { min = 15 max = -15 }
				entity_offset_angle = { min = 0 max = 359 }
				location = solar_system
			}
			last_created_ambient_object = {
				random_list = {
					10 = {
						create_ambient_object = {
							type = "ag_zeta_battleship_debris_1_object"
							entity_offset_height = { min = 15 max = -15 }
							entity_offset_angle = { min = 0 max = 359 }
							location = solar_system
						}
						last_created_ambient_object = {
							ag_set_zeta_debris_object_flag = { ag_ship_class = battleship ag_num = $ag_num$ }
							random_list = {
								25 = { set_location = { target = prev distance = 10 angle = random } }
								25 = { set_location = { target = prev distance = 15 angle = random } }
								25 = { set_location = { target = prev distance = 20 angle = random } }
								25 = { set_location = { target = prev distance = 25 angle = random } }
							}
						}
					}
					10 = {
						create_ambient_object = {
							type = "ag_zeta_battleship_debris_2_object"
							entity_offset_height = { min = 15 max = -15 }
							entity_offset_angle = { min = 0 max = 359 }
							location = solar_system
						}
						last_created_ambient_object = {
							ag_set_zeta_debris_object_flag = { ag_ship_class = battleship ag_num = $ag_num$ }
							random_list = {
								25 = { set_location = { target = prev distance = 10 angle = random } }
								25 = { set_location = { target = prev distance = 15 angle = random } }
								25 = { set_location = { target = prev distance = 20 angle = random } }
								25 = { set_location = { target = prev distance = 25 angle = random } }
							}
						}
					}
					10 = {
						create_ambient_object = {
							type = "ag_zeta_battleship_debris_3_object"
							entity_offset_height = { min = 15 max = -15 }
							entity_offset_angle = { min = 0 max = 359 }
							location = solar_system
						}
						last_created_ambient_object = {
							ag_set_zeta_debris_object_flag = { ag_ship_class = battleship ag_num = $ag_num$ }
							random_list = {
								25 = { set_location = { target = prev distance = 10 angle = random } }
								25 = { set_location = { target = prev distance = 15 angle = random } }
								25 = { set_location = { target = prev distance = 20 angle = random } }
								25 = { set_location = { target = prev distance = 25 angle = random } }
							}
						}
					}
				}
				ag_set_zeta_debris_object_flag = { ag_ship_class = battleship ag_num = $ag_num$ }
			}
		}
		10 = {
			star = { change_variable = { which = ag_num_ancient_debris value = 1 } }
			create_ambient_object = {
				type = "ag_zeta_battleship_debris_3_object"
				entity_offset_height = { min = 15 max = -15 }
				entity_offset_angle = { min = 0 max = 359 }
				location = solar_system
			}
			last_created_ambient_object = {
				random_list = {
					10 = {
						create_ambient_object = {
							type = "ag_zeta_battleship_debris_1_object"
							entity_offset_height = { min = 15 max = -15 }
							entity_offset_angle = { min = 0 max = 359 }
							location = solar_system
						}
						last_created_ambient_object = {
							ag_set_zeta_debris_object_flag = { ag_ship_class = battleship ag_num = $ag_num$ }
							random_list = {
								25 = { set_location = { target = prev distance = 10 angle = random } }
								25 = { set_location = { target = prev distance = 15 angle = random } }
								25 = { set_location = { target = prev distance = 20 angle = random } }
								25 = { set_location = { target = prev distance = 25 angle = random } }
							}
						}
					}
					10 = {
						create_ambient_object = {
							type = "ag_zeta_battleship_debris_2_object"
							entity_offset_height = { min = 15 max = -15 }
							entity_offset_angle = { min = 0 max = 359 }
							location = solar_system
						}
						last_created_ambient_object = {
							ag_set_zeta_debris_object_flag = { ag_ship_class = battleship ag_num = $ag_num$ }
							random_list = {
								25 = { set_location = { target = prev distance = 10 angle = random } }
								25 = { set_location = { target = prev distance = 15 angle = random } }
								25 = { set_location = { target = prev distance = 20 angle = random } }
								25 = { set_location = { target = prev distance = 25 angle = random } }
							}
						}
					}
					10 = {
						create_ambient_object = {
							type = "ag_zeta_battleship_debris_3_object"
							entity_offset_height = { min = 15 max = -15 }
							entity_offset_angle = { min = 0 max = 359 }
							location = solar_system
						}
						last_created_ambient_object = {
							ag_set_zeta_debris_object_flag = { ag_ship_class = battleship ag_num = $ag_num$ }
							random_list = {
								25 = { set_location = { target = prev distance = 10 angle = random } }
								25 = { set_location = { target = prev distance = 15 angle = random } }
								25 = { set_location = { target = prev distance = 20 angle = random } }
								25 = { set_location = { target = prev distance = 25 angle = random } }
							}
						}
					}
				}
				ag_set_zeta_debris_object_flag = { ag_ship_class = battleship ag_num = $ag_num$ }
			}
		}
		10 = {
			star = { change_variable = { which = ag_num_ancient_debris value = 1 } }
			create_ambient_object = {
				type = "ag_zeta_destroyer_debris_1_object"
				entity_offset_height = { min = 15 max = -15 }
				entity_offset_angle = { min = 0 max = 359 }
				location = solar_system
			}
			last_created_ambient_object = {
				while = {
					count = 3
					random_list = {
						10 = {
							create_ambient_object = {
								type = "ag_zeta_destroyer_debris_1_object"
								entity_offset_height = { min = 15 max = -15 }
								entity_offset_angle = { min = 0 max = 359 }
								location = solar_system
							}
							last_created_ambient_object = {
								ag_set_zeta_debris_object_flag = { ag_ship_class = destroyer ag_num = $ag_num$ }
								random_list = {
									25 = { set_location = { target = prev distance = 10 angle = random } }
									25 = { set_location = { target = prev distance = 15 angle = random } }
									25 = { set_location = { target = prev distance = 20 angle = random } }
									25 = { set_location = { target = prev distance = 25 angle = random } }
								}
							}
						}
						10 = {
							create_ambient_object = {
								type = "ag_zeta_destroyer_debris_2_object"
								entity_offset_height = { min = 15 max = -15 }
								entity_offset_angle = { min = 0 max = 359 }
								location = solar_system
							}
							last_created_ambient_object = {
								ag_set_zeta_debris_object_flag = { ag_ship_class = destroyer ag_num = $ag_num$ }
								random_list = {
									25 = { set_location = { target = prev distance = 10 angle = random } }
									25 = { set_location = { target = prev distance = 15 angle = random } }
									25 = { set_location = { target = prev distance = 20 angle = random } }
									25 = { set_location = { target = prev distance = 25 angle = random } }
								}
							}
						}
						10 = {
							create_ambient_object = {
								type = "ag_zeta_destroyer_debris_3_object"
								entity_offset_height = { min = 15 max = -15 }
								entity_offset_angle = { min = 0 max = 359 }
								location = solar_system
							}
							last_created_ambient_object = {
								ag_set_zeta_debris_object_flag = { ag_ship_class = destroyer ag_num = $ag_num$ }
								random_list = {
									25 = { set_location = { target = prev distance = 10 angle = random } }
									25 = { set_location = { target = prev distance = 15 angle = random } }
									25 = { set_location = { target = prev distance = 20 angle = random } }
									25 = { set_location = { target = prev distance = 25 angle = random } }
								}
							}
						}
					}
				}
				ag_set_zeta_debris_object_flag = { ag_ship_class = destroyer ag_num = $ag_num$ }
			}
		}
		10 = {
			star = { change_variable = { which = ag_num_ancient_debris value = 1 } }
			create_ambient_object = {
				type = "ag_zeta_destroyer_debris_2_object"
				entity_offset_height = { min = 15 max = -15 }
				entity_offset_angle = { min = 0 max = 359 }
				location = solar_system
			}
			last_created_ambient_object = {
				while = {
					count = 3
					random_list = {
						10 = {
							create_ambient_object = {
								type = "ag_zeta_destroyer_debris_1_object"
								entity_offset_height = { min = 15 max = -15 }
								entity_offset_angle = { min = 0 max = 359 }
								location = solar_system
							}
							last_created_ambient_object = {
								ag_set_zeta_debris_object_flag = { ag_ship_class = destroyer ag_num = $ag_num$ }
								random_list = {
									25 = { set_location = { target = prev distance = 10 angle = random } }
									25 = { set_location = { target = prev distance = 15 angle = random } }
									25 = { set_location = { target = prev distance = 20 angle = random } }
									25 = { set_location = { target = prev distance = 25 angle = random } }
								}
							}
						}
						10 = {
							create_ambient_object = {
								type = "ag_zeta_destroyer_debris_2_object"
								entity_offset_height = { min = 15 max = -15 }
								entity_offset_angle = { min = 0 max = 359 }
								location = solar_system
							}
							last_created_ambient_object = {
								ag_set_zeta_debris_object_flag = { ag_ship_class = destroyer ag_num = $ag_num$ }
								random_list = {
									25 = { set_location = { target = prev distance = 10 angle = random } }
									25 = { set_location = { target = prev distance = 15 angle = random } }
									25 = { set_location = { target = prev distance = 20 angle = random } }
									25 = { set_location = { target = prev distance = 25 angle = random } }
								}
							}
						}
						10 = {
							create_ambient_object = {
								type = "ag_zeta_destroyer_debris_3_object"
								entity_offset_height = { min = 15 max = -15 }
								entity_offset_angle = { min = 0 max = 359 }
								location = solar_system
							}
							last_created_ambient_object = {
								ag_set_zeta_debris_object_flag = { ag_ship_class = destroyer ag_num = $ag_num$ }
								random_list = {
									25 = { set_location = { target = prev distance = 10 angle = random } }
									25 = { set_location = { target = prev distance = 15 angle = random } }
									25 = { set_location = { target = prev distance = 20 angle = random } }
									25 = { set_location = { target = prev distance = 25 angle = random } }
								}
							}
						}
					}
				}
				ag_set_zeta_debris_object_flag = { ag_ship_class = destroyer ag_num = $ag_num$ }
			}
		}
		10 = {
			star = { change_variable = { which = ag_num_ancient_debris value = 1 } }
			create_ambient_object = {
				type = "ag_zeta_destroyer_debris_3_object"
				entity_offset_height = { min = 15 max = -15 }
				entity_offset_angle = { min = 0 max = 359 }
				location = solar_system
			}
			last_created_ambient_object = {
				while = {
					count = 3
					random_list = {
						10 = {
							create_ambient_object = {
								type = "ag_zeta_destroyer_debris_1_object"
								entity_offset_height = { min = 15 max = -15 }
								entity_offset_angle = { min = 0 max = 359 }
								location = solar_system
							}
							last_created_ambient_object = {
								ag_set_zeta_debris_object_flag = { ag_ship_class = destroyer ag_num = $ag_num$ }
								random_list = {
									25 = { set_location = { target = prev distance = 10 angle = random } }
									25 = { set_location = { target = prev distance = 15 angle = random } }
									25 = { set_location = { target = prev distance = 20 angle = random } }
									25 = { set_location = { target = prev distance = 25 angle = random } }
								}
							}
						}
						10 = {
							create_ambient_object = {
								type = "ag_zeta_destroyer_debris_2_object"
								entity_offset_height = { min = 15 max = -15 }
								entity_offset_angle = { min = 0 max = 359 }
								location = solar_system
							}
							last_created_ambient_object = {
								ag_set_zeta_debris_object_flag = { ag_ship_class = destroyer ag_num = $ag_num$ }
								random_list = {
									25 = { set_location = { target = prev distance = 10 angle = random } }
									25 = { set_location = { target = prev distance = 15 angle = random } }
									25 = { set_location = { target = prev distance = 20 angle = random } }
									25 = { set_location = { target = prev distance = 25 angle = random } }
								}
							}
						}
						10 = {
							create_ambient_object = {
								type = "ag_zeta_destroyer_debris_3_object"
								entity_offset_height = { min = 15 max = -15 }
								entity_offset_angle = { min = 0 max = 359 }
								location = solar_system
							}
							last_created_ambient_object = {
								ag_set_zeta_debris_object_flag = { ag_ship_class = destroyer ag_num = $ag_num$ }
								random_list = {
									25 = { set_location = { target = prev distance = 10 angle = random } }
									25 = { set_location = { target = prev distance = 15 angle = random } }
									25 = { set_location = { target = prev distance = 20 angle = random } }
									25 = { set_location = { target = prev distance = 25 angle = random } }
								}
							}
						}
					}
				}
				ag_set_zeta_debris_object_flag = { ag_ship_class = destroyer ag_num = $ag_num$ }
			}
		}
	}
}
ag_set_zeta_debris_object_flag = {
	set_ambient_object_flag = ag_zeta_debris_object
	set_ambient_object_flag = ag_zeta_$ag_ship_class$_debris_object_$ag_num$
	set_ambient_object_flag = ag_zeta_debris_seq_$ag_num$
}
ag_clear_zeta_debris_object = {
	if = {
		limit = { has_ambient_object_flag = ag_zeta_debris_seq_1 }
		solar_system = {
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_zeta_debris_seq_1 }
				destroy_ambient_object = this
			}
		}
	}
	else_if = {
		limit = { has_ambient_object_flag = ag_zeta_debris_seq_2 }
		solar_system = {
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_zeta_debris_seq_2 }
				destroy_ambient_object = this
			}
		}
	}
	else_if = {
		limit = { has_ambient_object_flag = ag_zeta_debris_seq_3 }
		solar_system = {
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_zeta_debris_seq_3 }
				destroy_ambient_object = this
			}
		}
	}
	else_if = {
		limit = { has_ambient_object_flag = ag_zeta_debris_seq_4 }
		solar_system = {
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_zeta_debris_seq_4 }
				destroy_ambient_object = this
			}
		}
	}
	else_if = {
		limit = { has_ambient_object_flag = ag_zeta_debris_seq_5 }
		solar_system = {
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_zeta_debris_seq_5 }
				destroy_ambient_object = this
			}
		}
	}
	else_if = {
		limit = { has_ambient_object_flag = ag_zeta_debris_seq_6 }
		solar_system = {
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_zeta_debris_seq_6 }
				destroy_ambient_object = this
			}
		}
	}
}
ag_clear_zeta_debris_object_flag = {
	if = {
		limit = { has_ambient_object_flag = ag_zeta_debris_seq_1 }
		solar_system = {
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_zeta_debris_seq_1 }
				remove_ambient_object_flag = ag_zeta_debris_object
				remove_ambient_object_flag = ag_zeta_debris_seq_1
				remove_ambient_object_flag = ag_zeta_titan_debris_object_1
				remove_ambient_object_flag = ag_zeta_battleship_debris_object_1
				remove_ambient_object_flag = ag_zeta_destroyer_debris_object_1
			}
		}
	}
	else_if = {
		limit = { has_ambient_object_flag = ag_zeta_debris_seq_2 }
		solar_system = {
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_zeta_debris_seq_2 }
				remove_ambient_object_flag = ag_zeta_debris_object
				remove_ambient_object_flag = ag_zeta_debris_seq_2
				remove_ambient_object_flag = ag_zeta_titan_debris_object_2
				remove_ambient_object_flag = ag_zeta_battleship_debris_object_2
				remove_ambient_object_flag = ag_zeta_destroyer_debris_object_2
			}
		}
	}
	else_if = {
		limit = { has_ambient_object_flag = ag_zeta_debris_seq_3 }
		solar_system = {
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_zeta_debris_seq_3 }
				remove_ambient_object_flag = ag_zeta_debris_object
				remove_ambient_object_flag = ag_zeta_debris_seq_3
				remove_ambient_object_flag = ag_zeta_titan_debris_object_3
				remove_ambient_object_flag = ag_zeta_battleship_debris_object_3
				remove_ambient_object_flag = ag_zeta_destroyer_debris_object_3
			}
		}
	}
	else_if = {
		limit = { has_ambient_object_flag = ag_zeta_debris_seq_4 }
		solar_system = {
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_zeta_debris_seq_4 }
				remove_ambient_object_flag = ag_zeta_debris_object
				remove_ambient_object_flag = ag_zeta_debris_seq_4
				remove_ambient_object_flag = ag_zeta_titan_debris_object_4
				remove_ambient_object_flag = ag_zeta_battleship_debris_object_4
				remove_ambient_object_flag = ag_zeta_destroyer_debris_object_4
			}
		}
	}
	else_if = {
		limit = { has_ambient_object_flag = ag_zeta_debris_seq_5 }
		solar_system = {
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_zeta_debris_seq_5 }
				remove_ambient_object_flag = ag_zeta_debris_object
				remove_ambient_object_flag = ag_zeta_debris_seq_5
				remove_ambient_object_flag = ag_zeta_titan_debris_object_5
				remove_ambient_object_flag = ag_zeta_battleship_debris_object_5
				remove_ambient_object_flag = ag_zeta_destroyer_debris_object_5
			}
		}
	}
	else_if = {
		limit = { has_ambient_object_flag = ag_zeta_debris_seq_6 }
		solar_system = {
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_zeta_debris_seq_6 }
				remove_ambient_object_flag = ag_zeta_debris_object
				remove_ambient_object_flag = ag_zeta_debris_seq_6
				remove_ambient_object_flag = ag_zeta_titan_debris_object_6
				remove_ambient_object_flag = ag_zeta_battleship_debris_object_6
				remove_ambient_object_flag = ag_zeta_destroyer_debris_object_6
			}
		}
	}
}

ag_destroy_habitable_ringworld_psionics = {
	change_pc = pc_ag_ringworld_shrouded
	if = {
		limit = {
			NOR = {
				has_planet_flag = ag_ancient_ringworld_blue
				has_planet_flag = ag_ancient_ringworld_red
				has_planet_flag = ag_ancient_ringworld_violet
			}
		}
		if = {
			limit = { exists = owner }
			owner = {
				switch = {
					trigger = graphical_culture
					arthropoid_01 = { prev = { ag_set_vanilla_shrouded_ringworld = { ag_graphical_culture = arthropoid_01 } } }
					avian_01 = { prev = { ag_set_vanilla_shrouded_ringworld = { ag_graphical_culture = avian_01 } } }
					fungoid_01 = { prev = { ag_set_vanilla_shrouded_ringworld = { ag_graphical_culture = fungoid_01 } } }
					mammalian_01 = { prev = { ag_set_vanilla_shrouded_ringworld = { ag_graphical_culture = mammalian_01 } } }
					molluscoid_01 = { prev = { ag_set_vanilla_shrouded_ringworld = { ag_graphical_culture = molluscoid_01 } } }
					plantoid_01 = { prev = { ag_set_vanilla_shrouded_ringworld = { ag_graphical_culture = plantoid_01 } } }
					reptilian_01 = { prev = { ag_set_vanilla_shrouded_ringworld = { ag_graphical_culture = reptilian_01 } } }
					lithoid_01 = { prev = { ag_set_vanilla_shrouded_ringworld = { ag_graphical_culture = lithoid_01 } } }
					default = { prev = { ag_set_vanilla_shrouded_ringworld = { ag_graphical_culture = default } } }
				}
			}
		}
		else = { ag_set_vanilla_shrouded_ringworld = { ag_graphical_culture = default } }
	}
	else = {
		switch = {
			trigger = has_planet_flag
			ag_ancient_ringworld_blue = {
				set_planet_entity = { entity = ag_ancient_ringworld_habitable_shrouded_blue_entity }
			}
			ag_ancient_ringworld_red = {
				set_planet_entity = { entity = ag_ancient_ringworld_habitable_shrouded_red_entity }
			}
			ag_ancient_ringworld_violet = {
				set_planet_entity = { entity = ag_ancient_ringworld_habitable_shrouded_violet_entity }
			}
		}
	}
}

ag_ancient_zeta_guardian_ship_psi_warning = {
	if = {
		limit = {
			owner = {
				is_same_value = event_target:ag_ancient_zeta_guardian_country
			}
			solar_system = {
				has_star_flag = ag_ancient_zeta_system
				any_ship_in_system = {
					exists = owner
					owner = {
						NOR = {
							is_same_value = event_target:ag_ancient_zeta_guardian_country
							has_country_flag = ag_zeta_31_fired
						}
						has_country_flag = ag_ancient_zeta_guardian_hostility
					}
					fleet = {
						is_in_combat = yes
					}
				}
			}
		}
		solar_system = {
			every_fleet_in_system = {
				limit = {
					exists = owner
					owner = {
						is_ai = no
						has_country_flag = ag_ancient_zeta_guardian_hostility
						NOT = {
							has_country_flag = ag_ancient_zeta_guardian_country
						}
					}
					is_in_combat = yes
				}
				owner = {
					country_event = { id = ag_zeta.31 }
				}
			}
		}
	}
}

ag_zeta_crisis_core_system_ship_debuff_effect = {
	if = {
		limit = {
			NOR = {
				has_global_flag = ag_zeta_crisis_stage_2
				has_global_flag = ag_zeta_crisis_stage_3
			}
		}
		while = {
			limit = {
				any_owned_ship = {
					NOR = {
						has_ship_flag = ag_zeta_ship_has_modifier
						ag_is_ancient_ship = yes
						ag_is_ancient_ship_unlocked = yes
					}
				}
			}
			random_owned_ship = {
				limit = {
					NOR = {
						has_ship_flag = ag_zeta_ship_has_modifier
						ag_is_ancient_ship = yes
						ag_is_ancient_ship_unlocked = yes
					}
				}
				set_timed_ship_flag = {
					flag = ag_zeta_ship_has_modifier
					days = 2
				}
				remove_modifier = "ag_zeta_crisis_core_system_debuff_stage_1"
				remove_modifier = "ag_zeta_crisis_core_system_debuff_stage_2"
				remove_modifier = "ag_zeta_crisis_core_system_debuff_stage_3"
				add_modifier = {
					modifier = "ag_zeta_crisis_core_system_debuff_stage_1"
					days = 30
				}
			}
		}
	}
	if = {
		limit = {
			has_global_flag = ag_zeta_crisis_stage_2
			NOT = {
				has_global_flag = ag_zeta_crisis_stage_3
			}
		}
		while = {
			limit = {
				any_owned_ship = {
					NOR = {
						has_ship_flag = ag_zeta_ship_has_modifier
						ag_is_ancient_ship = yes
						ag_is_ancient_ship_unlocked = yes
					}
				}
			}
			random_owned_ship = {
				limit = {
					NOR = {
						has_ship_flag = ag_zeta_ship_has_modifier
						ag_is_ancient_ship = yes
						ag_is_ancient_ship_unlocked = yes
					}
				}
				set_timed_ship_flag = {
					flag = ag_zeta_ship_has_modifier
					days = 2
				}
				remove_modifier = "ag_zeta_crisis_core_system_debuff_stage_1"
				remove_modifier = "ag_zeta_crisis_core_system_debuff_stage_2"
				remove_modifier = "ag_zeta_crisis_core_system_debuff_stage_3"
				add_modifier = {
					modifier = "ag_zeta_crisis_core_system_debuff_stage_2"
					days = 30
				}
			}
		}
	}
	if = {
		limit = {
			has_global_flag = ag_zeta_crisis_stage_2
			has_global_flag = ag_zeta_crisis_stage_3
		}
		while = {
			limit = {
				any_owned_ship = {
					NOR = {
						has_ship_flag = ag_zeta_ship_has_modifier
						ag_is_ancient_ship = yes
						ag_is_ancient_ship_unlocked = yes
					}
				}
			}
			random_owned_ship = {
				limit = {
					NOR = {
						has_ship_flag = ag_zeta_ship_has_modifier
						ag_is_ancient_ship = yes
						ag_is_ancient_ship_unlocked = yes
					}
				}
				set_timed_ship_flag = {
					flag = ag_zeta_ship_has_modifier
					days = 2
				}
				remove_modifier = "ag_zeta_crisis_core_system_debuff_stage_1"
				remove_modifier = "ag_zeta_crisis_core_system_debuff_stage_2"
				remove_modifier = "ag_zeta_crisis_core_system_debuff_stage_3"
				add_modifier = {
					modifier = "ag_zeta_crisis_core_system_debuff_stage_3"
					days = 30
				}
			}
		}
	}
}

ag_zeta_crisis_controlled_planet_effect = {
	remove_all_armies = yes
	add_planet_devastation = -100
	if = {
		limit = { num_pops > 0 }
		every_owned_pop = { kill_pop = yes }
	}
	remove_all_buildings = yes
	remove_all_districts = yes
	clear_deposits = yes
	if = {
		limit = { is_colony = yes }
		destroy_colony = yes
	}
	if = {
		limit = { has_modifier = "ag_zeta_crisis_ship_in_system" }
		remove_modifier = "ag_zeta_crisis_ship_in_system"
	}
	ag_remove_all_modifier_common = yes
	if = {
		limit = {
			NOT = {
				event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
			}
		}
		random_list = {
			20 = {
				ag_zeta_crisis_avatar_t1_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 20
				}
			}
			20 = {
				ag_zeta_crisis_avatar_t1_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t1_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 20
				}
			}
			20 = {
				ag_zeta_crisis_avatar_t2_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 15
				}
			}
			20 = {
				ag_zeta_crisis_avatar_t1_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t2_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 20
				}
			}
			20 = {
			}
		}
	}
	else = {
		random_list = {
			20 = {
				ag_zeta_crisis_avatar_t1_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t2_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 20
				}
			}
			20 = {
				ag_zeta_crisis_avatar_t2_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t2_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 20
				}
			}
			20 = {
				ag_zeta_crisis_avatar_t2_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t3_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 20
				}
			}
			20 = {
				ag_zeta_crisis_avatar_t3_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t3_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 20
				}
			}
			20 = {
				ag_zeta_crisis_avatar_t3_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t4_fleet_spawn = {
					ag_target_name = prev
					ag_distance_to_target = 20
				}
			}
		}
	}
	planet_event = { id = ag_zeta_crisis.46 days = 180 random = 30 }
	if = {
		limit = {
			NOR = {
				ag_is_habitat = yes
				AND = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no }
				has_modifier = "holy_planet"
			}
		}
		change_pc = pc_ag_shrouded
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = violet }
		if = {
			limit = {
				NOT = { has_global_flag = ag_zeta_crisis_stage_3 }
			}
			set_planet_flag = ag_zeta_crisis_core_planet
			add_modifier = {
				modifier = "ag_zeta_crisis_core_planet"
				days = -1
			}
			solar_system = {
				set_star_flag = ag_zeta_crisis_core_system
			}
			event_target:ag_zeta_crisis_country = {
				change_variable = {
					which = ag_zeta_crisis_core_planet
					value = 1
				}
			}
		}
		if = {
			limit = {
				has_global_flag = ag_zeta_crisis_stage_3
			}
			set_owner = event_target:ag_zeta_crisis_country
			set_controller = event_target:ag_zeta_crisis_country
			set_colony_type = col_ag_zeta_crisis
			set_planet_flag = ag_zeta_crisis_controlled_world
			every_country = {
				limit = {
					has_event_chain = "ag_zeta_crisis_chain"
				}
				add_event_chain_counter = {
					event_chain = "ag_zeta_crisis_chain"
					counter = "ag_zeta_crisis_psionic_worlds"
					amount = 1
				}
			}
		}
	}
	else_if = {
		limit = { AND = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no } }
		ag_destroy_habitable_ringworld_psionics = yes
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = violet }
		if = {
			limit = {
				NOT = { has_global_flag = ag_zeta_crisis_stage_3 }
			}
			set_planet_flag = ag_zeta_crisis_core_planet
			add_modifier = {
				modifier = "ag_zeta_crisis_core_planet"
				days = -1
			}
			solar_system = {
				set_star_flag = ag_zeta_crisis_core_system
			}
			event_target:ag_zeta_crisis_country = {
				change_variable = {
					which = ag_zeta_crisis_core_planet
					value = 1
				}
			}
		}
		if = {
			limit = {
				has_global_flag = ag_zeta_crisis_stage_3
			}
			set_owner = event_target:ag_zeta_crisis_country
			set_controller = event_target:ag_zeta_crisis_country
			set_colony_type = col_ag_zeta_crisis
			set_planet_flag = ag_zeta_crisis_controlled_world
			every_country = {
				limit = {
					has_event_chain = "ag_zeta_crisis_chain"
				}
				add_event_chain_counter = {
					event_chain = "ag_zeta_crisis_chain"
					counter = "ag_zeta_crisis_psionic_worlds"
					amount = 1
				}
			}
		}
	}
	else_if = {
		limit = {
			has_modifier = "holy_planet"
		}
		change_pc = pc_shattered
		remove_modifier = "holy_planet"
		add_modifier = {
			modifier = "ag_shattered_holy_planet"
			days = -1
		}
	}
	else_if = {
		limit = {
			ag_is_habitat = yes
		}
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = violet }
		remove_planet = yes
	}
}

ag_zeta_crisis_gate_portal_spawn = {
	if = {
		limit = {
			any_galaxy_planet = {
				is_planet_class = pc_ag_shrouded
				has_planet_flag = ag_zeta_crisis_core_planet
				NOR = {
					has_planet_flag = ag_zeta_crisis_portal_1_planet
					has_planet_flag = ag_zeta_crisis_portal_2_planet
					has_planet_flag = ag_zeta_crisis_portal_3_planet
					has_planet_flag = ag_zeta_crisis_portal_4_planet
					has_planet_flag = ag_zeta_crisis_portal_5_planet
					has_planet_flag = ag_zeta_crisis_portal_6_planet
				}
			}
		}
		random_galaxy_planet  = {
			limit = {
				is_planet_class = pc_ag_shrouded
				has_planet_flag = ag_zeta_crisis_core_planet
				NOR = {
					has_planet_flag = ag_zeta_crisis_portal_1_planet
					has_planet_flag = ag_zeta_crisis_portal_2_planet
					has_planet_flag = ag_zeta_crisis_portal_3_planet
					has_planet_flag = ag_zeta_crisis_portal_4_planet
					has_planet_flag = ag_zeta_crisis_portal_5_planet
					has_planet_flag = ag_zeta_crisis_portal_6_planet
				}
			}
			save_event_target_as = $ag_portal_event_target_name$
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = violet }
			set_planet_flag = $ag_portal_planet_flag$
			change_pc = pc_ag_void_planet
			set_planet_size = 1
			remove_modifier = "ag_zeta_crisis_core_planet"
			every_moon = {
				limit = {
					exists = this
				}
				remove_planet = yes
			}
			create_fleet = {
				name = "NAME_ag_zeta_crisis_portal_fleet"
				settings = {
					spawn_debris = no
				}
				effect = {
					set_fleet_flag = ag_zeta_crisis_gate_portal
					set_fleet_flag = $ag_portal_fleet_flag$
					set_fleet_flag = ag_zeta_crisis_portal
					set_owner = event_target:ag_zeta_crisis_country
					create_ship = {
						name = "NAME_ag_zeta_crisis_portal_ship"
						design = "NAME_ag_zeta_crisis_portal"
						prefix = no
						effect = {
							ag_set_disable_at_health = { ag_value = 0.05 }
							ag_difficulty_bonus = yes
						}
					}
					set_location = {
						target = prev
						distance = 0
						angle = 0
					}
				}
			}
			ag_spawn_zeta_crisis_guardian_fleet = yes
			ag_spawn_zeta_crisis_assault_fleet = yes
			ag_spawn_zeta_crisis_construction_ship = yes
			ag_spawn_zeta_crisis_protector_fleet = yes
			if = {
				limit = { event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } } }
				ag_spawn_zeta_crisis_assault_fleet = yes
				random_list = {
					50 = { }
					50 = { ag_spawn_zeta_crisis_assault_fleet = yes }
				}
				random_list = {
					75 = { }
					25 = { ag_spawn_zeta_crisis_assault_fleet = yes }
				}
			}
			solar_system = {
				every_fleet_in_system = {
					limit = {
						exists = owner
						owner = { NOR = { is_country_type = ag_zeta_crisis_country is_country_type = ag_zeta_crisis_portal_holder } }
					}
					destroy_fleet = this
				}
				spawn_megastructure = {
					type = ag_psionic_portal_megastructure
					orbit_angle = 233
					orbit_distance = 0
					coords_from = event_target:$ag_portal_event_target_name$
				}
				ag_create_zeta_crisis_starbase = yes
			}
		}
	}
	else = {
		if = {
			limit = {
				any_system = {
					ag_zeta_crisis_fallback_system_spawn_trigger = yes
				}
			}
			random_system = {
				limit = {
					ag_zeta_crisis_fallback_system_spawn_trigger = yes
				}
				spawn_system = {
					min_distance >= 20
					max_distance <= 50
					initializer = ag_zeta_crisis_fallback_init
					hyperlane = yes
				}
			}
		}
		else = {
			if = {
				limit = {
					any_system = {
						ag_zeta_crisis_fallback_system_spawn_trigger_fallback = yes
					}
				}
				random_system = {
					limit = {
						ag_zeta_crisis_fallback_system_spawn_trigger_fallback = yes
					}
					spawn_system = {
						min_distance >= 20
						max_distance <= 50
						initializer = ag_zeta_crisis_fallback_init
					}
				}
			}
			else = {
				random_system = {
					spawn_system = {
						min_distance >= 20
						max_distance <= 50
						initializer = ag_zeta_crisis_fallback_init
					}
				}
			}
		}
		random_system = {
			limit = {
				has_star_flag = ag_zeta_crisis_core_system
				any_system_planet = {
					has_planet_flag = ag_zeta_crisis_core_planet
					is_planet_class = pc_ag_void_planet
				}
				NOT = {
					any_ship_in_system = {
						is_ship_size = ag_zeta_crisis_portal
					}
				}
			}
			random_system_planet = {
				limit = {
					has_planet_flag = ag_zeta_crisis_core_planet
					is_planet_class = pc_ag_void_planet
				}
				save_event_target_as = $ag_portal_event_target_name$
				ag_spawn_explosion_effect = { ag_scale = xl ag_color = violet }
				set_planet_flag = $ag_portal_planet_flag$
				create_fleet = {
					name = "NAME_ag_zeta_crisis_portal_fleet"
					settings = {
						spawn_debris = no
					}
					effect = {
						set_fleet_flag = ag_zeta_crisis_gate_portal
						set_fleet_flag = $ag_portal_fleet_flag$
						set_fleet_flag = ag_zeta_crisis_portal
						set_owner = event_target:ag_zeta_crisis_country
						create_ship = {
							name = "NAME_ag_zeta_crisis_portal_ship"
							design = "NAME_ag_zeta_crisis_portal"
							prefix = no
							effect = {
								ag_set_disable_at_health = { ag_value = 0.05 }
								ag_difficulty_bonus = yes
							}
						}
						set_location = {
							target = prev
							distance = 0
							angle = 0
						}
					}
				}
				ag_spawn_zeta_crisis_guardian_fleet = yes
				ag_spawn_zeta_crisis_assault_fleet = yes
				ag_spawn_zeta_crisis_construction_ship = yes
				ag_spawn_zeta_crisis_protector_fleet = yes
				if = {
					limit = { event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } } }
					ag_spawn_zeta_crisis_assault_fleet = yes
					random_list = {
						50 = { }
						50 = { ag_spawn_zeta_crisis_assault_fleet = yes }
					}
					random_list = {
						75 = { }
						25 = { ag_spawn_zeta_crisis_assault_fleet = yes }
					}
				}
				solar_system = {
					spawn_megastructure = {
						type = ag_psionic_portal_megastructure
						orbit_angle = 233
						orbit_distance = 0
						coords_from = event_target:$ag_portal_event_target_name$
					}
					ag_create_zeta_crisis_starbase = yes
				}
			}
		}
	}
	every_country = {
		limit = {
			NOT = {
				is_country_type = ag_zeta_crisis_country
			}
		}
		country_event = { id = $ag_portal_notification_event$ }
	}
}

ag_zeta_crisis_avatar_upgrade_flag_effect = {
	switch = {
		trigger = is_ship_size
		ag_zeta_crisis_avatar_t1 = {
			random_list = {
				50 = {
					if = {
						limit = {
							NOR = {
								has_ship_flag = ag_1_to_2
								has_ship_flag = ag_1_to_3
								has_ship_flag = ag_1_to_4
								has_ship_flag = ag_1_to_5
							}
						}
						set_ship_flag = ag_1_to_2
						break = yes
					}
					else_if = {
						limit = {
							has_ship_flag = ag_1_to_2
						}
						remove_ship_flag = ag_1_to_2
						set_ship_flag = ag_1_to_3
						break = yes
					}
					else_if = {
						limit = {
							has_ship_flag = ag_1_to_3
						}
						remove_ship_flag = ag_1_to_3
						set_ship_flag = ag_1_to_4
						break = yes
					}
					else_if = {
						limit = {
							has_ship_flag = ag_1_to_4
						}
						remove_ship_flag = ag_1_to_4
						set_ship_flag = ag_1_to_5
						break = yes
					}
					else_if = {
						limit = {
							has_ship_flag = ag_1_to_5
						}
						add_modifier = {
							modifier = "ag_zeta_crisis_avatar_ship_kill_buff"
							days = 30
						}
						break = yes
					}
				}
				50 = {
				}
			}
		}
		ag_zeta_crisis_avatar_t2 = {
			random_list = {
				50 = {
					if = {
						limit = {
							NOR = {
								has_ship_flag = ag_2_to_3
								has_ship_flag = ag_2_to_4
								has_ship_flag = ag_2_to_5
							}
						}
						set_ship_flag = ag_2_to_3
						break = yes
					}
					else_if = {
						limit = {
							has_ship_flag = ag_2_to_3
						}
						remove_ship_flag = ag_2_to_3
						set_ship_flag = ag_2_to_4
						break = yes
					}
					else_if = {
						limit = {
							has_ship_flag = ag_2_to_4
						}
						remove_ship_flag = ag_2_to_4
						set_ship_flag = ag_2_to_5
						break = yes
					}
					else_if = {
						limit = {
							has_ship_flag = ag_2_to_5
						}
						add_modifier = {
							modifier = "ag_zeta_crisis_avatar_ship_kill_buff"
							days = 30
						}
						break = yes
					}
				}
				50 = {
				}
			}
		}
		ag_zeta_crisis_avatar_t3 = {
			random_list = {
				50 = {
					if = {
						limit = {
							NOR = {
								has_ship_flag = ag_3_to_4
								has_ship_flag = ag_3_to_5
							}
						}
						set_ship_flag = ag_3_to_4
						break = yes
					}
					else_if = {
						limit = {
							has_ship_flag = ag_3_to_4
						}
						remove_ship_flag = ag_3_to_4
						set_ship_flag = ag_3_to_5
						break = yes
					}
					else_if = {
						limit = {
							has_ship_flag = ag_3_to_5
						}
						add_modifier = {
							modifier = "ag_zeta_crisis_avatar_ship_kill_buff"
							days = 30
						}
						break = yes
					}
				}
				50 = {
				}
			}
		}
		ag_zeta_crisis_avatar_t4 = {
			random_list = {
				50 = {
					if = {
						limit = {
							NOR = {
								has_ship_flag = ag_4_to_5
							}
						}
						set_ship_flag = ag_4_to_5
						break = yes
					}
					else_if = {
						limit = {
							has_ship_flag = ag_4_to_5
						}
						add_modifier = {
							modifier = "ag_zeta_crisis_avatar_ship_kill_buff"
							days = 30
						}
						break = yes
					}
				}
				50 = {
				}
			}
		}
		ag_zeta_crisis_avatar_t5 = {
			random_list = {
				50 = {
					add_modifier = {
						modifier = "ag_zeta_crisis_avatar_ship_kill_buff"
						days = 30
					}
					set_ship_flag = ag_zeta_crisis_avatar_t5_charged
					break = yes
				}
				50 = {
					add_modifier = {
						modifier = "ag_zeta_crisis_avatar_ship_kill_buff"
						days = 30
					}
					break = yes
				}
			}
		}
	}
}

ag_zeta_t1_class_target_effect = {
	root.fromfrom = {
		if = {
			limit = {
				fleet = {
					has_fleet_flag = ag_zeta_crisis_avatar_fleet
				}
			}
			fleet = {
				change_variable = {
					which = ag_zeta_crisis_ship_charge
					value = 1
				}
			}
			set_ship_flag = ag_zeta_crisis_avatar_kill_locked
			if = {
				limit = {
					fleet = {
						check_variable = {
							which = ag_zeta_crisis_ship_charge
							value >= 5
						}
					}
				}
				fleet = {
					set_variable = {
						which = ag_zeta_crisis_ship_charge
						value = 0
					}
				}
				ag_zeta_crisis_avatar_upgrade_flag_effect = yes
			}
		}
		random_list = {
			23 = {
				ag_zeta_crisis_avatar_t1_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
			}
			2 = {
				modifier = { add = 8 root.fromfrom.fleet = { has_fleet_flag = ag_zeta_crisis_leader_12 } }
				ag_zeta_crisis_avatar_t1_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t1_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 25
				}
			}
			0 = {
				modifier = { add = 5 root.fromfrom.fleet = { has_fleet_flag = ag_zeta_crisis_leader_12 } }
				ag_zeta_crisis_avatar_t1_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t1_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 25
				}
				ag_zeta_crisis_avatar_t1_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 50
				}
			}
			75 = {
				modifier = {
					factor = 0.6
					event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
				}
			}
		}
		random_list = {
			50 = {
				root.fromfromfrom.fleet = {
					if = {
						limit = { exists = this }
						while = {
							count = 5
							random_owned_ship = {
								limit = {
									NOR = {
										ag_is_ancient_ship = yes
										ag_is_ancient_ship_unlocked = yes
										has_ship_flag = ag_zeta_crisis_damaged
									}
								}
								random_list = {
									50 = {
										if = {
											limit = { has_hp > 9200000 }
											if = { limit = { has_hp > 920000000 } reduce_hp = 9200000 }
										}
										else = { ag_reduce_hp_percent = { ag_value = 1 } }
										ag_spawn_buff_effect = { ag_color = violet ag_scale = m }
									}
									50 = {
										modifier = {
											factor = 0.2
											event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
										}
									}
								}
								set_timed_ship_flag = {
									flag = ag_zeta_crisis_damaged
									days = 2
								}
							}
						}
					}
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
				}
			}
		}
	}
}
ag_zeta_t2_class_target_effect = {
	root.fromfrom = {
		if = {
			limit = {
				fleet = {
					has_fleet_flag = ag_zeta_crisis_avatar_fleet
				}
			}
			fleet = {
				change_variable = {
					which = ag_zeta_crisis_ship_charge
					value = 1
				}
			}
			set_ship_flag = ag_zeta_crisis_avatar_kill_locked
			if = {
				limit = {
					fleet = {
						check_variable = {
							which = ag_zeta_crisis_ship_charge
							value >= 5
						}
					}
				}
				fleet = {
					set_variable = {
						which = ag_zeta_crisis_ship_charge
						value = 0
					}
				}
				ag_zeta_crisis_avatar_upgrade_flag_effect = yes
			}
		}
		random_list = {
			23 = {
				ag_zeta_crisis_avatar_t2_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
			}
			2 = {
				modifier = { add = 8 root.fromfrom.fleet = { has_fleet_flag = ag_zeta_crisis_leader_12 } }
				ag_zeta_crisis_avatar_t2_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t2_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 25
				}
			}
			0 = {
				modifier = { add = 5 root.fromfrom.fleet = { has_fleet_flag = ag_zeta_crisis_leader_12 } }
				ag_zeta_crisis_avatar_t2_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t2_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 25
				}
				ag_zeta_crisis_avatar_t2_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 50
				}
			}
			75 = {
				modifier = {
					factor = 0.6
					event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
				}
			}
		}
		random_list = {
			50 = {
				root.fromfromfrom.fleet = {
					if = {
						limit = { exists = this }
						while = {
							count = 5
							random_owned_ship = {
								limit = {
									NOR = {
										ag_is_ancient_ship = yes
										ag_is_ancient_ship_unlocked = yes
										has_ship_flag = ag_zeta_crisis_damaged
									}
								}
								random_list = {
									33 = {
										ag_reduce_hp_percent = { ag_value = 2 }
										ag_spawn_buff_effect = { ag_color = violet ag_scale = m }
									}
									33 = {
										ag_reduce_hp_percent = { ag_value = 1 }
										ag_spawn_buff_effect = { ag_color = violet ag_scale = m }
									}
									33 = {
										modifier = {
											factor = 0.4
											event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
										}
									}
								}
								set_timed_ship_flag = {
									flag = ag_zeta_crisis_damaged
									days = 2
								}
							}
						}
					}
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
				}
			}
		}
	}
}
ag_zeta_t3_class_target_effect = {
	root.fromfrom = {
		if = {
			limit = {
				fleet = {
					has_fleet_flag = ag_zeta_crisis_avatar_fleet
				}
			}
			fleet = {
				change_variable = {
					which = ag_zeta_crisis_ship_charge
					value = 1
				}
			}
			set_ship_flag = ag_zeta_crisis_avatar_kill_locked
			if = {
				limit = {
					fleet = {
						check_variable = {
							which = ag_zeta_crisis_ship_charge
							value >= 5
						}
					}
				}
				fleet = {
					set_variable = {
						which = ag_zeta_crisis_ship_charge
						value = 0
					}
				}
				ag_zeta_crisis_avatar_upgrade_flag_effect = yes
			}
		}
		random_list = {
			23 = {
				ag_zeta_crisis_avatar_t3_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
			}
			2 = {
				modifier = { add = 8 root.fromfrom.fleet = { has_fleet_flag = ag_zeta_crisis_leader_12 } }
				ag_zeta_crisis_avatar_t3_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t3_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 25
				}
			}
			0 = {
				modifier = { add = 5 root.fromfrom.fleet = { has_fleet_flag = ag_zeta_crisis_leader_12 } }
				ag_zeta_crisis_avatar_t3_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t3_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 25
				}
				ag_zeta_crisis_avatar_t3_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 50
				}
			}
			75 = {
				modifier = {
					factor = 0.6
					event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
				}
			}
		}
		random_list = {
			50 = {
				root.fromfromfrom.fleet = {
					if = {
						limit = { exists = this }
						while = {
							count = 5
							random_owned_ship = {
								limit = {
									NOR = {
										ag_is_ancient_ship = yes
										ag_is_ancient_ship_unlocked = yes
										has_ship_flag = ag_zeta_crisis_damaged
									}
								}
								random_list = {
									33 = {
										ag_reduce_hp_percent = { ag_value = 3 }
										ag_spawn_buff_effect = { ag_color = violet ag_scale = m }
									}
									33 = {
										ag_reduce_hp_percent = { ag_value = 1 }
										ag_spawn_buff_effect = { ag_color = violet ag_scale = m }
									}
									33 = {
										modifier = {
											factor = 0.4
											event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
										}
									}
								}
								set_timed_ship_flag = {
									flag = ag_zeta_crisis_damaged
									days = 2
								}
							}
						}
					}
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
				}
			}
		}
	}
}
ag_zeta_t4_class_target_effect = {
	root.fromfrom = {
		if = {
			limit = {
				fleet = {
					has_fleet_flag = ag_zeta_crisis_avatar_fleet
				}
			}
			fleet = {
				change_variable = {
					which = ag_zeta_crisis_ship_charge
					value = 1
				}
			}
			set_ship_flag = ag_zeta_crisis_avatar_kill_locked
			if = {
				limit = {
					fleet = {
						check_variable = {
							which = ag_zeta_crisis_ship_charge
							value >= 5
						}
					}
				}
				fleet = {
					set_variable = {
						which = ag_zeta_crisis_ship_charge
						value = 0
					}
				}
				ag_zeta_crisis_avatar_upgrade_flag_effect = yes
			}
		}
		random_list = {
			23 = {
				ag_zeta_crisis_avatar_t4_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
			}
			2 = {
				modifier = { add = 8 root.fromfrom.fleet = { has_fleet_flag = ag_zeta_crisis_leader_12 } }
				ag_zeta_crisis_avatar_t4_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t4_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 25
				}
			}
			0 = {
				modifier = { add = 5 root.fromfrom.fleet = { has_fleet_flag = ag_zeta_crisis_leader_12 } }
				ag_zeta_crisis_avatar_t4_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t4_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 25
				}
				ag_zeta_crisis_avatar_t4_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 50
				}
			}
			75 = {
				modifier = {
					factor = 0.6
					event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
				}
			}
		}
		random_list = {
			50 = {
				root.fromfromfrom.fleet = {
					if = {
						limit = { exists = this }
						while = {
							count = 5
							random_owned_ship = {
								limit = {
									NOR = {
										ag_is_ancient_ship = yes
										ag_is_ancient_ship_unlocked = yes
										has_ship_flag = ag_zeta_crisis_damaged
									}
								}
								random_list = {
									33 = {
										reduce_hp_percent = 4
									}
									33 = {
										ag_reduce_hp_percent = { ag_value = 2 }
									}
									33 = {
										modifier = {
											factor = 0.4
											event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
										}
										ag_reduce_hp_percent = { ag_value = 1 }
									}
								}
								ag_spawn_buff_effect = { ag_color = violet ag_scale = m }
								set_timed_ship_flag = {
									flag = ag_zeta_crisis_damaged
									days = 2
								}
							}
						}
					}
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
				}
			}
		}
	}
}
ag_zeta_t5_class_target_effect = {
	root.fromfrom = {
		if = {
			limit = {
				fleet = {
					has_fleet_flag = ag_zeta_crisis_avatar_fleet
				}
			}
			fleet = {
				change_variable = {
					which = ag_zeta_crisis_ship_charge
					value = 1
				}
			}
			set_ship_flag = ag_zeta_crisis_avatar_kill_locked
			if = {
				limit = {
					fleet = {
						check_variable = {
							which = ag_zeta_crisis_ship_charge
							value >= 5
						}
					}
				}
				fleet = {
					set_variable = {
						which = ag_zeta_crisis_ship_charge
						value = 0
					}
				}
				ag_zeta_crisis_avatar_upgrade_flag_effect = yes
			}
		}
		random_list = {
			23 = {
				ag_zeta_crisis_avatar_t5_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
			}
			2 = {
				modifier = { add = 8 root.fromfrom.fleet = { has_fleet_flag = ag_zeta_crisis_leader_12 } }
				ag_zeta_crisis_avatar_t5_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t5_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 25
				}
			}
			0 = {
				modifier = { add = 5 root.fromfrom.fleet = { has_fleet_flag = ag_zeta_crisis_leader_12 } }
				ag_zeta_crisis_avatar_t5_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 15
				}
				ag_zeta_crisis_avatar_t5_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 25
				}
				ag_zeta_crisis_avatar_t5_fleet_spawn = {
					ag_target_name = event_target:ag_zeta_crisis_avatar_spawn_loc
					ag_distance_to_target = 50
				}
			}
			75 = {
				modifier = {
					factor = 0.6
					event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
				}
			}
		}
		random_list = {
			50 = {
				root.fromfromfrom.fleet = {
					if = {
						limit = { exists = this }
						while = {
							count = 5
							random_owned_ship = {
								limit = {
									NOR = {
										ag_is_ancient_ship = yes
										ag_is_ancient_ship_unlocked = yes
										has_ship_flag = ag_zeta_crisis_damaged
									}
								}
								random_list = {
									33 = {
										ag_reduce_hp_percent = { ag_value = 5 }
									}
									33 = {
										ag_reduce_hp_percent = { ag_value = 3 }
									}
									33 = {
										modifier = {
											factor = 0.4
											event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
										}
										ag_reduce_hp_percent = { ag_value = 1 }
									}
								}
								ag_spawn_buff_effect = { ag_color = violet ag_scale = m }
								set_timed_ship_flag = {
									flag = ag_zeta_crisis_damaged
									days = 2
								}
							}
						}
					}
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
				}
			}
		}
	}
}

ag_zeta_crisis_starbase_split_effect = {
	random_list = {
		33 = {
			ag_zeta_crisis_avatar_t5_fleet_spawn = {
				ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
				ag_distance_to_target = 15
			}
		}
		33 = {
			ag_zeta_crisis_avatar_t4_fleet_spawn = {
				ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
				ag_distance_to_target = 15
			}
			ag_zeta_crisis_avatar_t4_fleet_spawn = {
				ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
				ag_distance_to_target = 25
			}
		}
		33 = {
			modifier = {
				factor = 0
				event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
			}
		}
	}
}

ag_zeta_crisis_ship_split_effect = {
	switch = {
		trigger = is_ship_size
		ag_zeta_crisis_small_ship = {
			if = {
				limit = { exists = fleet }
				fleet = {
					random_list = {
						25 = {
							modifier = { factor = 1.5 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 3 ag_zeta_crisis_avatar_t1_spawn = yes }
						}
						25 = {
							modifier = { factor = 1.5 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 2 ag_zeta_crisis_avatar_t1_spawn = yes }
						}
						25 = {
							while = { count = 1 ag_zeta_crisis_avatar_t1_spawn = yes }
						}
						25 = {
							modifier = {
								factor = 0.2
								event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
							}
						}
					}
				}
			}
			else = {
				random_list = {
					25 = {
						while = {
							count = 3
							ag_zeta_crisis_avatar_t1_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					25 = {
						while = {
							count = 2
							ag_zeta_crisis_avatar_t1_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					25 = {
						while = {
							count = 1
							ag_zeta_crisis_avatar_t1_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					25 = {
						modifier = {
							factor = 0.2
							event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
						}
					}
				}
			}
		}
		ag_zeta_crisis_medium_ship = {
			if = {
				limit = { exists = fleet }
				fleet = {
					random_list = {
						0 = {
							modifier = { add = 10 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 4 ag_zeta_crisis_small_ship_spawn = yes }
						}
						0 = {
							modifier = { add = 10 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 3 ag_zeta_crisis_small_ship_spawn = yes }
						}
						0 = {
							modifier = { add = 10 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 2 ag_zeta_crisis_small_ship_spawn = yes }
						}
						0 = {
							modifier = { add = 10 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 1 ag_zeta_crisis_small_ship_spawn = yes }
						}
						20 = {
							modifier = { factor = 1.5 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 6 ag_zeta_crisis_avatar_t1_spawn = yes }
						}
						20 = {
							modifier = { factor = 1.5 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 3 ag_zeta_crisis_avatar_t2_spawn = yes }
						}
						20 = {
							modifier = { factor = 1.5 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 2 ag_zeta_crisis_avatar_t2_spawn = yes }
						}
						20 = {
							while = {
								count = 1
								ag_zeta_crisis_avatar_t2_spawn = yes
							}
						}
						20 = {
							modifier = {
								factor = 0.2
								event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
							}
						}
					}
				}
			}
			else = {
				random_list = {
					20 = {
						while = {
							count = 6
							ag_zeta_crisis_avatar_t1_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					20 = {
						while = {
							count = 3
							ag_zeta_crisis_avatar_t2_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					20 = {
						while = {
							count = 2
							ag_zeta_crisis_avatar_t2_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					20 = {
						while = {
							count = 1
							ag_zeta_crisis_avatar_t2_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					20 = {
						modifier = {
							factor = 0.2
							event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
						}
					}
				}
			}
		}
		ag_zeta_crisis_large_ship = {
			if = {
				limit = { exists = fleet }
				fleet = {
					random_list = {
						0 = {
							modifier = { add = 10 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 4 ag_zeta_crisis_medium_ship_spawn = yes }
						}
						0 = {
							modifier = { add = 10 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 3 ag_zeta_crisis_medium_ship_spawn = yes }
						}
						0 = {
							modifier = { add = 10 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 2 ag_zeta_crisis_medium_ship_spawn = yes }
						}
						0 = {
							modifier = { add = 10 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 1 ag_zeta_crisis_medium_ship_spawn = yes }
						}
						20 = {
							modifier = { factor = 1.5 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 6 ag_zeta_crisis_avatar_t2_spawn = yes }
						}
						20 = {
							modifier = { factor = 1.5 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 3 ag_zeta_crisis_avatar_t3_spawn = yes }
						}
						20 = {
							modifier = { factor = 1.5 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 2 ag_zeta_crisis_avatar_t3_spawn = yes }
						}
						20 = {
							while = {
								count = 1
								ag_zeta_crisis_avatar_t3_spawn = yes
							}
						}
						20 = {
							modifier = {
								factor = 0.2
								event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
							}
						}
					}
				}
			}
			else = {
				random_list = {
					20 = {
						while = {
							count = 6
							ag_zeta_crisis_avatar_t2_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					20 = {
						while = {
							count = 3
							ag_zeta_crisis_avatar_t3_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					20 = {
						while = {
							count = 2
							ag_zeta_crisis_avatar_t3_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					20 = {
						while = {
							count = 1
							ag_zeta_crisis_avatar_t3_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					20 = {
						modifier = {
							factor = 0.2
							event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
						}
					}
				}
			}
		}
		ag_zeta_crisis_support_ship = {
			if = {
				limit = { exists = fleet }
				fleet = {
					random_list = {
						0 = {
							modifier = { add = 20 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 1 ag_zeta_crisis_large_ship_spawn = yes }
						}
						0 = {
							modifier = { add = 20 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 4 ag_zeta_crisis_medium_ship_spawn = yes }
						}
						0 = {
							modifier = { add = 20 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 3 ag_zeta_crisis_medium_ship_spawn = yes }
						}
						20 = {
							modifier = { factor = 1.5 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 1 ag_zeta_crisis_avatar_t5_spawn = yes }
						}
						20 = {
							modifier = { factor = 1.5 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 1 ag_zeta_crisis_avatar_t4_spawn = yes }
						}
						20 = {
							modifier = { factor = 1.5 has_fleet_flag = ag_zeta_crisis_leader_12 }
							while = { count = 2 ag_zeta_crisis_avatar_t3_spawn = yes }
						}
						20 = {
							while = { count = 4 ag_zeta_crisis_avatar_t2_spawn = yes }
						}
						20 = {
							modifier = {
								factor = 0.2
								event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
							}
						}
					}
				}
			}
			else = {
				random_list = {
					20 = {
						while = {
							count = 1
							ag_zeta_crisis_avatar_t5_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					20 = {
						while = {
							count = 1
							ag_zeta_crisis_avatar_t4_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					20 = {
						while = {
							count = 2
							ag_zeta_crisis_avatar_t3_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					20 = {
						while = {
							count = 4
							ag_zeta_crisis_avatar_t2_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					20 = {
						modifier = {
							factor = 0.2
							event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
						}
					}
				}
			}
		}
		ag_zeta_crisis_avatar_t2 = {
			if = {
				limit = { exists = fleet }
				fleet = {
					random_list = {
						33 = {
							while = {
								count = 2
								ag_zeta_crisis_avatar_t1_spawn = yes
							}
						}
						33 = {
							while = {
								count = 1
								ag_zeta_crisis_avatar_t1_spawn = yes
							}
						}
						33 = {
							modifier = {
								factor = 0.2
								event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
							}
						}
					}
				}
			}
			else = {
				random_list = {
					33 = {
						while = {
							count = 2
							ag_zeta_crisis_avatar_t1_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					33 = {
						while = {
							count = 1
							ag_zeta_crisis_avatar_t1_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					33 = {
						modifier = {
							factor = 0.2
							event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
						}
					}
				}
			}
		}
		ag_zeta_crisis_avatar_t3 = {
			if = {
				limit = { exists = fleet }
				fleet = {
					random_list = {
						33 = {
							while = {
								count = 2
								ag_zeta_crisis_avatar_t2_spawn = yes
							}
						}
						33 = {
							while = {
								count = 1
								ag_zeta_crisis_avatar_t2_spawn = yes
							}
						}
						33 = {
							modifier = {
								factor = 0.2
								event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
							}
						}
					}
				}
			}
			else = {
				random_list = {
					33 = {
						while = {
							count = 2
							ag_zeta_crisis_avatar_t2_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					33 = {
						while = {
							count = 1
							ag_zeta_crisis_avatar_t2_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					33 = {
						modifier = {
							factor = 0.2
							event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
						}
					}
				}
			}
		}
		ag_zeta_crisis_avatar_t4 = {
			if = {
				limit = { exists = fleet }
				fleet = {
					random_list = {
						33 = {
							while = {
								count = 2
								ag_zeta_crisis_avatar_t3_spawn = yes
							}
						}
						33 = {
							while = {
								count = 1
								ag_zeta_crisis_avatar_t3_spawn = yes
							}
						}
						33 = {
							modifier = {
								factor = 0.2
								event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
							}
						}
					}
				}
			}
			else = {
				random_list = {
					33 = {
						while = {
							count = 2
							ag_zeta_crisis_avatar_t3_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					33 = {
						while = {
							count = 1
							ag_zeta_crisis_avatar_t3_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					33 = {
						modifier = {
							factor = 0.2
							event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
						}
					}
				}
			}
		}
		ag_zeta_crisis_avatar_t5 = {
			if = {
				limit = { exists = fleet }
				fleet = {
					random_list = {
						33 = {
							while = {
								count = 2
								ag_zeta_crisis_avatar_t4_spawn = yes
							}
						}
						33 = {
							while = {
								count = 1
								ag_zeta_crisis_avatar_t4_spawn = yes
							}
						}
						33 = {
							modifier = {
								factor = 0.2
								event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
							}
						}
					}
				}
			}
			else = {
				random_list = {
					33 = {
						while = {
							count = 2
							ag_zeta_crisis_avatar_t4_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					33 = {
						while = {
							count = 1
							ag_zeta_crisis_avatar_t4_fleet_spawn = {
								ag_target_name = event_target:ag_zeta_crisis_split_avatar_spawn_loc
								ag_distance_to_target = 15
							}
						}
					}
					33 = {
						modifier = {
							factor = 0.2
							event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
						}
					}
				}
			}
		}
	}
}

ag_zeta_crisis_gate_portal_destroyed_effect = {
	event_target:global_event_country = { change_variable = { which = ag_num_psionic_portals_destroyed value = 1 } }
	fleet = {
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = violet }
		solar_system = {
			random_system_megastructure = {
				limit = {
					is_megastructure_type = ag_psionic_portal_megastructure
				}
				upgrade_megastructure_to = ag_psionic_portal_stabled_megastructure
				finish_upgrade = yes
			}
			random_system_ambient_object = {
				limit = {
					has_ambient_object_flag = ag_zeta_crisis_system_effect_thick
				}
				destroy_ambient_object = this
			}
			every_system_planet = {
				limit = {
					has_planet_flag = ag_zeta_crisis_core_planet
				}
				remove_planet_flag = ag_zeta_crisis_core_planet
			}
		}
		create_ambient_object = {
			type = ag_psionic_portal_stabled_object
			location = this

			use_3d_location = yes
			
			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }
			
			entity_scale_to_size = yes
			scale = 1.0
		}
		owner = {
			change_variable = {
				which = ag_zeta_crisis_gate_portal_destroyed
				value = 1
			}
			if = {
				limit = {
					has_global_flag = ag_zeta_crisis_all_portal_spawned
					check_variable = {
						which = ag_zeta_crisis_gate_portal_destroyed
						value = 6
					}
				}
				event_target:ag_zeta_crisis_portal_holder = {
					every_owned_fleet = {
						limit = {
							has_fleet_flag = ag_zeta_crisis_home_portal
						}
						set_owner = event_target:ag_zeta_crisis_country
						set_event_locked = no
					}
					random_owned_fleet = {
						limit = {
							has_fleet_flag = ag_zeta_area_inhibitor
						}
						delete_fleet = this
					}
					destroy_country = yes
				}
				random_system = {
					limit = {
						has_star_flag = ag_ancient_zeta_system
					}
					random_system_megastructure = {
						limit = {
							is_megastructure_type = ag_psionic_portal_megastructure
						}
						upgrade_megastructure_to = ag_psionic_portal_stabled_megastructure
						finish_upgrade = yes
					}
					# remove_modifier = ag_zeta_area_no_entrance
				}
				every_country = {
					limit = {
						NOT = {
							is_country_type = ag_zeta_crisis_country
						}
					}
					country_event = { id = ag_zeta_crisis.1021 }
				}
			}
			else = {
				every_country = {
					limit = {
						NOT = {
							is_country_type = ag_zeta_crisis_country
						}
					}
					country_event = { id = ag_zeta_crisis.1020 }
				}
			}
		}
		switch = {
			trigger = has_fleet_flag
			ag_zeta_crisis_portal_1_fleet = {
				every_country = {
					limit = {
						has_event_chain = "ag_zeta_crisis_chain"
					}
					remove_point_of_interest = ag_zeta_crisis_gate_portal_1
					add_event_chain_counter = {
						event_chain = "ag_zeta_crisis_chain"
						counter = "ag_zeta_crisis_core_portal"
						amount = -1
					}
				}
				if = {
					limit = { has_global_flag = ag_zeta_crisis_all_portal_spawned }
					event_target:ag_zeta_crisis_country = {
						random_list = {
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_1"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_1"
										days = 360
									}
								}
							}
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_2"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_2"
										days = 360
									}
								}
							}
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_3"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_3"
										days = 360
									}
								}
							}
						}
					}
				}
			}
			ag_zeta_crisis_portal_2_fleet = {
				every_country = {
					limit = {
						has_event_chain = "ag_zeta_crisis_chain"
					}
					remove_point_of_interest = ag_zeta_crisis_gate_portal_2
					add_event_chain_counter = {
						event_chain = "ag_zeta_crisis_chain"
						counter = "ag_zeta_crisis_core_portal"
						amount = -1
					}
				}
				if = {
					limit = { has_global_flag = ag_zeta_crisis_all_portal_spawned }
					event_target:ag_zeta_crisis_country = {
						random_list = {
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_1"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_1"
										days = 360
									}
								}
							}
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_2"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_2"
										days = 360
									}
								}
							}
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_3"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_3"
										days = 360
									}
								}
							}
						}
					}
				}
			}
			ag_zeta_crisis_portal_3_fleet = {
				every_country = {
					limit = {
						has_event_chain = "ag_zeta_crisis_chain"
					}
					remove_point_of_interest = ag_zeta_crisis_gate_portal_3
					add_event_chain_counter = {
						event_chain = "ag_zeta_crisis_chain"
						counter = "ag_zeta_crisis_core_portal"
						amount = -1
					}
				}
				if = {
					limit = { has_global_flag = ag_zeta_crisis_all_portal_spawned }
					event_target:ag_zeta_crisis_country = {
						random_list = {
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_1"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_1"
										days = 360
									}
								}
							}
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_2"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_2"
										days = 360
									}
								}
							}
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_3"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_3"
										days = 360
									}
								}
							}
						}
					}
				}
			}
			ag_zeta_crisis_portal_4_fleet = {
				every_country = {
					limit = {
						has_event_chain = "ag_zeta_crisis_chain"
					}
					remove_point_of_interest = ag_zeta_crisis_gate_portal_4
					add_event_chain_counter = {
						event_chain = "ag_zeta_crisis_chain"
						counter = "ag_zeta_crisis_core_portal"
						amount = -1
					}
				}
				if = {
					limit = { has_global_flag = ag_zeta_crisis_all_portal_spawned }
					event_target:ag_zeta_crisis_country = {
						random_list = {
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_1"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_1"
										days = 360
									}
								}
							}
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_2"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_2"
										days = 360
									}
								}
							}
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_3"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_3"
										days = 360
									}
								}
							}
						}
					}
				}
			}
			ag_zeta_crisis_portal_5_fleet = {
				every_country = {
					limit = {
						has_event_chain = "ag_zeta_crisis_chain"
					}
					remove_point_of_interest = ag_zeta_crisis_gate_portal_5
					add_event_chain_counter = {
						event_chain = "ag_zeta_crisis_chain"
						counter = "ag_zeta_crisis_core_portal"
						amount = -1
					}
				}
				if = {
					limit = { has_global_flag = ag_zeta_crisis_all_portal_spawned }
					event_target:ag_zeta_crisis_country = {
						random_list = {
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_1"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_1"
										days = 360
									}
								}
							}
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_2"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_2"
										days = 360
									}
								}
							}
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_3"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_3"
										days = 360
									}
								}
							}
						}
					}
				}
			}
			ag_zeta_crisis_portal_6_fleet = {
				every_country = {
					limit = {
						has_event_chain = "ag_zeta_crisis_chain"
					}
					remove_point_of_interest = ag_zeta_crisis_gate_portal_6
					add_event_chain_counter = {
						event_chain = "ag_zeta_crisis_chain"
						counter = "ag_zeta_crisis_core_portal"
						amount = -1
					}
				}
				if = {
					limit = { has_global_flag = ag_zeta_crisis_all_portal_spawned }
					event_target:ag_zeta_crisis_country = {
						random_list = {
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_1"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_1"
										days = 360
									}
								}
							}
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_2"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_2"
										days = 360
									}
								}
							}
							33 = {
								if = {
									limit = {
										NOT = {
											has_modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_3"
										}
									}
									add_modifier = {
										modifier = "ag_zeta_crisis_gate_portal_destroyed_debuff_3"
										days = 360
									}
								}
							}
						}
					}
				}
			}
		}
		delete_fleet = this
	}
}
ag_zeta_crisis_home_portal_destroyed_effect = {
	fleet = {
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = violet }
		create_ambient_object = {
			type = ag_psionic_portal_stabled_object
			location = this

			use_3d_location = yes
			
			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }
			
			entity_scale_to_size = yes
			scale = 1.0
		}
		delete_fleet = this
	}
	every_country = {
		limit = {
			has_event_chain = "ag_zeta_crisis_chain"
		}
		remove_point_of_interest = ag_zeta_crisis_home_portal
		add_event_chain_counter = {
			event_chain = "ag_zeta_crisis_chain"
			counter = "ag_zeta_crisis_core_portal"
			amount = -1
		}
		add_event_chain_counter = {
			event_chain = "ag_zeta_crisis_chain"
			counter = "ag_zeta_crisis_psionic_worlds"
			amount = -1
		}
		add_event_chain_counter = {
			event_chain = "ag_zeta_crisis_chain"
			counter = "ag_zeta_crisis_psionic_worlds_cleansed"
			amount = 1
		}
		country_event = { id = ag_zeta_crisis.1022 }
		country_event = { id = ag_zeta_crisis.1025 }
	}
	set_global_flag = ag_zeta_crisis_all_portal_destroyed
	event_target:ag_zeta_crisis_country = {
		every_owned_fleet = {
			limit = {
				exists = this
				any_owned_ship = {
					OR = {
						is_ship_size = starbase_ag_zeta_crisis
						is_ship_size = ag_zeta_crisis_construction_ship
						is_ship_size = ag_zeta_crisis_defensive_platform
						is_ship_size = ag_zeta_crisis_psionic_storm
						is_ship_size = ag_zeta_crisis_psionic_singularity
					}
				}
			}
			destroy_fleet = this
		}
		every_owned_fleet = {
			limit = {
				exists = this
			}
			clear_orders = yes
			clear_fleet_actions = this
			# fleet_event = { id = ag_zeta_crisis.76 }
		}
		add_modifier = {
			modifier = "ag_zeta_crisis_no_portal_buff"
			days = -1
		}
	}
	event_target:ag_ancient_zeta_shielded_world = {
		solar_system = {
			random_system_ambient_object = {
				limit = {
					has_ambient_object_flag = ag_zeta_crisis_system_effect_thick
				}
				destroy_ambient_object = this
			}
			every_system_planet = {
				limit = {
					has_planet_flag = ag_zeta_crisis_core_planet
				}
				remove_planet_flag = ag_zeta_crisis_core_planet
			}
		}
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = violet }
		ag_destroy_habitable_ringworld = yes
		remove_modifier = "ag_zeta_crisis_core_planet"
		destroy_colony = yes
	}
	event_target:ag_zeta_shrouded_planet = {
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = violet }
		remove_modifier = "ag_zeta_crisis_core_planet"
		destroy_colony = yes
		change_pc = pc_nuked
		reroll_planet = yes
		add_deposit = ag_zeta_crisis_nuked_planet_deposit
		add_deposit = ag_zeta_crisis_nuked_planet_deposit
	}
}
ag_psionic_singularity_explode_fleet_effect = {
	# random_list = {
	# 	50 = {
	# 		every_owned_ship = {
	# 			limit = {
	# 				ag_is_special_ship = no
	# 			}
	# 			random_list = {
	# 				# 25 = { destroy_ship = this }
	# 				30 = { reduce_hp_percent = 30 }
	# 				40 = { reduce_hp_percent = 25 }
	# 				30 = { reduce_hp_percent = 20 }
	# 			}
	# 		}
	# 	}
	# 	25 = {
	# 		modifier = {
	# 			factor = 0.2
	# 			owner = {
	# 				OR = {
	# 					is_country_type = ag_zeta_crisis_country
	# 					is_country_type = ag_zeta_crisis_portal_holder
	# 					is_country_type = shroud
	# 					is_country_type = shroud_spirits
	# 				}
	# 			}
	# 		}
	# 		every_owned_ship = {
	# 			limit = {
	# 				ag_is_special_ship = no
	# 			}
				random_list = {
					# 25 = { destroy_ship = this }
					30 = { reduce_hp_percent = 30 }
					40 = { reduce_hp_percent = 25 }
					30 = { reduce_hp_percent = 20 }
				}
				random_list = {
					75 = { }
					20 = { remove_modifier = "ag_weapon_inhibition_modifier" add_modifier = { modifier = "ag_weapon_inhibition_modifier" days = 5 } }
					5 = { remove_modifier = "ag_weapon_inhibition_modifier" add_modifier = { modifier = "ag_weapon_inhibition_modifier" days = 15 } }
				}
	# 		}
	# 	}
	# 	25 = {
	# 		modifier = {
	# 			factor = 0
	# 			owner = {
	# 				OR = {
	# 					is_country_type = ag_zeta_crisis_country
	# 					is_country_type = ag_zeta_crisis_portal_holder
	# 					is_country_type = shroud
	# 					is_country_type = shroud_spirits
	# 					is_country_type = extradimensional
	# 					is_country_type = extradimensional_2
	# 					is_country_type = extradimensional_3
	# 				}
	# 			}
	# 		}
	# 		destroy_fleet = this
	# 	}
	# }
}
ag_zeta_crisis_relic_country_ckeck = {
	if = {
		limit = { NOT = { exists = event_target:ag_zeta_crisis_relic_country } }
		create_country = {
			name = "NAME_Creatures_of_the_Shroud"
			type = ag_zeta_crisis_relic_country
			flag = {
				icon = {
					category = "special"
					file = "the_shroud.dds"
				}
				background = {
					category = "backgrounds"
					file = "circle.dds"
				}
				colors={
					"black"
					"dark_purple"
					"null"
					"null"
				}
			}
		}
		last_created_country = {
			save_global_event_target_as = ag_zeta_crisis_relic_country
		}
	}
	every_country = {
		limit = {
			NOR = {
				is_same_value = event_target:ag_zeta_crisis_relic_country
				is_country_type = ag_zeta_crisis_country
				is_country_type = ag_zeta_crisis_portal_holder
			}
		}
		if = {
			limit = {
				NOT = {
					has_communications = event_target:ag_zeta_crisis_relic_country
				}
			}
			establish_communications_no_message = event_target:ag_zeta_crisis_relic_country
		}
		if = {
			limit = {
				NOT = {
					is_hostile = event_target:ag_zeta_crisis_relic_country
				}
			}
			set_faction_hostility = {
				target = event_target:ag_zeta_crisis_relic_country
				set_hostile = yes
				set_neutral = no
				set_friendly = no
			}
		}
	}
	if = {
		limit = {
			exists = event_target:ag_zeta_crisis_country
			event_target:ag_zeta_crisis_country = { is_hostile = event_target:ag_zeta_crisis_relic_country }
		}
		event_target:ag_zeta_crisis_country = {
			set_faction_hostility = {
				target = event_target:ag_zeta_crisis_relic_country
				set_hostile = no
				set_neutral = yes
				set_friendly = no
			}
		}
	}
	if = {
		limit = {
			exists = event_target:ag_zeta_crisis_portal_holder
			event_target:ag_zeta_crisis_portal_holder = { is_hostile = event_target:ag_zeta_crisis_relic_country }
		}
		event_target:ag_zeta_crisis_portal_holder = {
			set_faction_hostility = {
				target = event_target:ag_zeta_crisis_relic_country
				set_hostile = no
				set_neutral = yes
				set_friendly = no
			}
		}
	}
}

ag_psionic_storm_system_side_effect = {
	ag_destroy_ambient_object = yes
	ag_destroy_megastructure = yes
}

ag_zeta_crisis_relic_psionic_storm_destroy_planet_effect = {
	if = {
		limit = {
			exists = owner
			owner = { is_same_value = event_target:ag_source_country }
		}
		if = {
			limit = { owner = { is_gestalt = no } }
			owner = {
				remove_modifier = "ag_psionic_storm_destroyed_self_planet_debuff"
				add_modifier = {
					modifier = "ag_psionic_storm_destroyed_self_planet_debuff"
					days = 7200
				}
			}
		}
		every_country = {
			limit = {
				NOR = {
					is_same_value = event_target:ag_source_country
					is_country_type = fallen_empire
				}
			}
			add_opinion_modifier = {
				modifier = ag_opinion_psionic_storm_destroyed_self_planet
				who = event_target:ag_source_country
			}
		}
	}
	else_if = {
		limit = {
			exists = owner
			owner = {
				ag_is_common_country = yes
				NOT = { is_same_value = event_target:ag_source_country }
			}
		}
		every_country = {
			limit = {
				NOR = {
					is_same_value = event_target:ag_source_country
					is_same_value = prev.owner
					is_country_type = fallen_empire
				}
			}
			add_opinion_modifier = {
				modifier = ag_opinion_psionic_storm_destroyed_planet
				who = event_target:ag_source_country
			}
		}
		owner = {
			if = {
				limit = {
					is_gestalt = no
				}
				remove_modifier = "ag_psionic_storm_destroyed_planet_debuff"
				add_modifier = {
					modifier = "ag_psionic_storm_destroyed_planet_debuff"
					days = 7200
				}
			}
			create_message = {
				type = "PLANET_DESTROYED"
				localization = "ag_planet_destroyed_by_psionic_storm_desc"
				days = 30
				target = prev
				variable = {
					type = name
					localization = "ag_attacker"
					scope = event_target:ag_source_country
				}
				variable = {
					type = name
					localization = "ag_victim_system"
					scope = prev.solar_system
				}
				variable = {
					type = name
					localization = "ag_victim_planet"
					scope = prev
				}
			}
			add_opinion_modifier = {
				modifier = ag_opinion_psionic_storm_destroyed_my_planet
				who = event_target:ag_source_country
			}
			add_static_war_exhaustion = {
				attacker = event_target:ag_source_country
				location = prev
				value_for_planet_destruction = 1.0
			}
		}
		add_threat = { who = event_target:ag_source_country amount = 3 }
	}
	else_if = {
		limit = {
			exists = owner
			owner = { is_country_type = primitive }
		}
		every_country = {
			limit = {
				NOT = {
					is_country_type = fallen_empire
				}
			}
			if = {
				limit = {
					OR = {
						has_ethic = ethic_xenophile
						has_ethic = ethic_fanatic_xenophile
					}
				}
				add_opinion_modifier = {
					modifier = ag_opinion_psionic_storm_destroyed_primitive_xenophile
					who = event_target:ag_source_country
				}
			}
			else_if = {
				limit = {
					NOR = {
						has_ethic = ethic_xenophobe
						has_ethic = ethic_fanatic_xenophobe
					}
				}
				add_opinion_modifier = {
					modifier = ag_opinion_psionic_storm_destroyed_primitive
					who = event_target:ag_source_country
				}
			}
		}
		add_threat = { who = event_target:ag_source_country amount = 2 }
	}
	# Contingency Machine World
	if = {
		limit = { is_planet_class = pc_ai NOT = { has_planet_flag = machine_lair } }
		set_planet_flag = destroyed_by_colossus
		set_planet_flag = planet_godrayed
		planet_event = { id = crisis.2040 }
	}
	# Contingency Final Machine World
	if = {
		limit = { is_planet_class = pc_ai has_planet_flag = machine_lair }
		set_planet_flag = destroyed_by_colossus
		set_planet_flag = planet_godrayed
		root.owner = { save_event_target_as = final_machine_world_destroyer }
		stop_crisis_sound = yes
		planet_event = { id = crisis.2046 }
	}
	# Swarm Situation Log counter
	if = {
		limit = { exists = owner owner = { is_country_type = swarm } }
		every_country = {
			limit = { has_event_chain = "prethoryn_scourge_chain" }
			add_event_chain_counter = {
				event_chain = "prethoryn_scourge_chain"
				counter = "infested_worlds"
				amount = -1
			}
			add_event_chain_counter = {
				event_chain = "prethoryn_scourge_chain"
				counter = "infested_worlds_cleansed"
				amount = 1
			}
		}
	}
	if = {
		limit = {
			OR = {
				is_active_resolution = "resolution_rulesofwar_reverence_for_life"
				is_active_resolution = "resolution_rulesofwar_independent_tribunals"
				is_active_resolution = "resolution_rulesofwar_last_resort_doctrine"
				is_active_resolution = "resolution_rulesofwar_demobilization_initiative"
			}
		}
		root.owner = { set_timed_country_flag = { flag = resolution_breached_fired_cracker days = 3600 } }
	}
	if = {
		limit = { num_pops > 0 }
		every_owned_pop = { kill_pop = yes }
	}
	remove_all_buildings = yes
	remove_all_districts = yes
	clear_deposits = yes
	if = {
		limit = { is_colony = yes }
		destroy_colony = yes
	}
	ag_remove_all_modifier_common = yes
	if = {
		limit = {
			NOR = {
				is_planet_class = pc_ai
				AND = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no }
				ag_is_habitat = yes
				has_modifier = "holy_planet"
			}
		}
		change_pc = pc_ag_shrouded
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = violet }
	}
	else_if = {
		limit = { AND = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no } }
		ag_destroy_habitable_ringworld_psionics = yes
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = violet }
	}
	else_if = {
		limit = { ag_is_habitat = yes }
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = violet }
		remove_planet = yes
	}
	else_if = {
		limit = { has_modifier = "holy_planet" }
		change_pc = pc_shattered
		remove_modifier = "holy_planet"
		add_modifier = {
			modifier = "ag_shattered_holy_planet"
			days = -1
		}
		if = {
			limit = {
				NOT = {
					has_global_flag = ag_holy_guardian_to_awaken
				}
				any_country = {
					has_ai_personality_behaviour = holy_planets
					NOT = {
						is_at_war_with = event_target:ag_source_country
					}
				}
			}
			save_event_target_as = ag_destroyed_holy_planet
			set_global_flag = ag_holy_guardian_to_awaken
			random_country = {
				limit = {
					has_ai_personality_behaviour = holy_planets
					NOT = {
						is_at_war_with = event_target:ag_source_country
					}
				}
				save_event_target_as = ag_holy_guardian_empire
				add_opinion_modifier = {
					modifier = ag_opinion_destroyed_holy_planet
					who = event_target:ag_source_country
				}
			}
			event_target:ag_source_country = {
				country_event = { id = ag_ancient.1000 days = 2 random = 5 }
			}
		}
	}
}

ag_zeta_ship_change_weapon_effect = {
	if = {
		limit = { has_ship_flag = ag_zeta_ship_gravity_weapon }
		switch = {
			trigger = is_ship_size
			ag_zeta_titan = {
				fleet = {
					create_ship = {
						name = "NAME_ag_zeta_titan_ship"
						design = "NAME_ag_zeta_titan"
						prefix = no
						effect = {
							if = {
								limit = { prevprev = { has_ship_flag = ag_emergency_repair_system } }
								set_ship_flag = ag_emergency_repair_system
								ag_increase_disable_level = yes
							}
							else_if = {
								limit = { prevprev = { has_ship_flag = ag_emergency_repair_system_locked } }
								set_timed_ship_flag = { flag = ag_emergency_repair_system_locked days = 180 }
							}
							if = {
								limit = { prevprev = { has_ship_flag = ag_zeta_titan_player } }
								set_ship_flag = ag_zeta_titan_player
							}
							ag_set_disable_at_health = { ag_value = 0.02 }
							set_timed_ship_flag = {
								flag = ag_zeta_ship_change_weapon_cooldown
								days = 180
							}
							ag_difficulty_bonus = yes
						}
					}
				}
				delete_ship = this
			}
			ag_zeta_battleship = {
				fleet = {
					create_ship = {
						name = "NAME_ag_zeta_battleship_ship"
						design = "NAME_ag_zeta_battleship"
						prefix = no
						effect = {
							if = {
								limit = { prevprev = { has_ship_flag = ag_zeta_battleship_player } }
								set_ship_flag = ag_zeta_battleship_player
							}
							ag_set_disable_at_health = { ag_value = 0.02 }
							set_timed_ship_flag = {
								flag = ag_zeta_ship_change_weapon_cooldown
								days = 180
							}
							ag_difficulty_bonus = yes
						}
					}
				}
				delete_ship = this
			}
			ag_zeta_destroyer = {
				fleet = {
					create_ship = {
						name = "NAME_ag_zeta_destroyer_ship"
						design = "NAME_ag_zeta_destroyer"
						prefix = no
						effect = {
							if = {
								limit = { prevprev = { has_ship_flag = ag_zeta_destroyer_player } }
								set_ship_flag = ag_zeta_destroyer_player
							}
							ag_set_disable_at_health = { ag_value = 0.02 }
							set_timed_ship_flag = {
								flag = ag_zeta_ship_change_weapon_cooldown
								days = 180
							}
							ag_difficulty_bonus = yes
						}
					}
				}
				delete_ship = this
			}
			ag_zeta_military_station_small = {
				create_fleet = {
					name = "NAME_ag_zeta_military_station_small_fleet"
					settings = {
						spawn_debris = no
						is_boss = yes
					}
					effect = {
						set_owner = root.owner
						create_ship = {
							name = "NAME_ag_zeta_military_station_small_ship"
							design = "NAME_ag_zeta_military_station_small"
							prefix = no
							
							effect = {
								ag_set_disable_at_health = { ag_value = 0.02 }
								set_timed_ship_flag = {
									flag = ag_zeta_ship_change_weapon_cooldown
									days = 180
								}
								ag_difficulty_bonus = yes
							}
						}
						set_location = {
							target = root
							distance = 0
							angle = 0
						}
					}
				}
				delete_ship = this
			}
			ag_zeta_military_station_large = {
				create_fleet = {
					name = "NAME_ag_zeta_military_station_large_fleet"
					settings = {
						spawn_debris = no
						is_boss = yes
					}
					effect = {
						set_owner = root.owner
						create_ship = {
							name = "NAME_ag_zeta_military_station_large_ship"
							design = "NAME_ag_zeta_military_station_large"
							prefix = no
							
							effect = {
								ag_set_disable_at_health = { ag_value = 0.02 }
								set_timed_ship_flag = {
									flag = ag_zeta_ship_change_weapon_cooldown
									days = 180
								}
								ag_difficulty_bonus = yes
							}
						}
						set_location = {
							target = root
							distance = 0
							angle = 0
						}
					}
				}
				delete_ship = this
			}
		}
	}
	else = {
		switch = {
			trigger = is_ship_size
			ag_zeta_titan = {
				fleet = {
					create_ship = {
						name = "NAME_ag_zeta_titan_ship"
						design = "NAME_ag_zeta_titan_red_alt"
						prefix = no
						effect = {
							set_ship_flag = ag_zeta_ship_gravity_weapon
							ag_set_disable_at_health = { ag_value = 0.02 }
							if = {
								limit = { prevprev = { has_ship_flag = ag_emergency_repair_system } }
								set_ship_flag = ag_emergency_repair_system
								ag_increase_disable_level = yes
							}
							else_if = {
								limit = { prevprev = { has_ship_flag = ag_emergency_repair_system_locked } }
								set_timed_ship_flag = { flag = ag_emergency_repair_system_locked days = 180 }
							}
							if = {
								limit = { prevprev = { has_ship_flag = ag_zeta_titan_player } }
								set_ship_flag = ag_zeta_titan_player
							}
							set_timed_ship_flag = {
								flag = ag_zeta_ship_change_weapon_cooldown
								days = 180
							}
							ag_difficulty_bonus = yes
						}
					}
				}
				delete_ship = this
			}
			ag_zeta_battleship = {
				fleet = {
					create_ship = {
						name = "NAME_ag_zeta_battleship_ship"
						design = "NAME_ag_zeta_battleship_red_alt"
						prefix = no
						effect = {
							set_ship_flag = ag_zeta_ship_gravity_weapon
							ag_set_disable_at_health = { ag_value = 0.02 }
							if = {
								limit = { prevprev = { has_ship_flag = ag_zeta_battleship_player } }
								set_ship_flag = ag_zeta_battleship_player
							}
							set_timed_ship_flag = {
								flag = ag_zeta_ship_change_weapon_cooldown
								days = 180
							}
							ag_difficulty_bonus = yes
						}
					}
				}
				delete_ship = this
			}
			ag_zeta_destroyer = {
				fleet = {
					create_ship = {
						name = "NAME_ag_zeta_destroyer_ship"
						design = "NAME_ag_zeta_destroyer_red_alt"
						prefix = no
						effect = {
							set_ship_flag = ag_zeta_ship_gravity_weapon
							ag_set_disable_at_health = { ag_value = 0.02 }
							if = {
								limit = { prevprev = { has_ship_flag = ag_zeta_destroyer_player } }
								set_ship_flag = ag_zeta_destroyer_player
							}
							set_timed_ship_flag = {
								flag = ag_zeta_ship_change_weapon_cooldown
								days = 180
							}
							ag_difficulty_bonus = yes
						}
					}
				}
				delete_ship = this
			}
			ag_zeta_military_station_small = {
				create_fleet = {
					name = "NAME_ag_zeta_military_station_small_fleet"
					settings = {
						spawn_debris = no
						is_boss = yes
					}
					effect = {
						set_owner = root.owner
						create_ship = {
							name = "NAME_ag_zeta_military_station_small_ship"
							design = "NAME_ag_zeta_military_station_small_red_alt"
							prefix = no
							
							effect = {
								set_ship_flag = ag_zeta_ship_gravity_weapon
								ag_set_disable_at_health = { ag_value = 0.02 }
								set_timed_ship_flag = {
									flag = ag_zeta_ship_change_weapon_cooldown
									days = 180
								}
								ag_difficulty_bonus = yes
							}
						}
						set_location = {
							target = root
							distance = 0
							angle = 0
						}
					}
				}
				delete_ship = this
			}
			ag_zeta_military_station_large = {
				create_fleet = {
					name = "NAME_ag_zeta_military_station_large_fleet"
					settings = {
						spawn_debris = no
						is_boss = yes
					}
					effect = {
						set_owner = root.owner
						create_ship = {
							name = "NAME_ag_zeta_military_station_large_ship"
							design = "NAME_ag_zeta_military_station_large_red_alt"
							prefix = no
							
							effect = {
								set_ship_flag = ag_zeta_ship_gravity_weapon
								ag_set_disable_at_health = { ag_value = 0.02 }
								set_timed_ship_flag = {
									flag = ag_zeta_ship_change_weapon_cooldown
									days = 180
								}
								ag_difficulty_bonus = yes
							}
						}
						set_location = {
							target = root
							distance = 0
							angle = 0
						}
					}
				}
				delete_ship = this
			}
		}
	}
}

#######################################
###				Theta
#######################################

ag_ancient_primitive_country_destroyed_effect = {
	set_global_flag = ag_ancient_primitive_country_destroyed
	every_galaxy_planet = {
		limit = {
			has_planet_flag = ag_ancient_primitive_country_transfer_completed
		}
		if = {
			limit = {
				OR = {
					has_building = ag_ancient_primitive_control_center
					has_building = ag_ancient_primitive_slave_house
				}
			}
			remove_all_buildings = yes
			add_building = building_capital
		}
		add_planet_devastation = -100
		if = {
			limit = {
				exists = owner
				owner = {
					NOT = {
						is_same_value = controller
					}
				}
			}
			set_controller = owner
		}
		remove_planet_flag = ag_ancient_primitive_country_transfer_completed
	}
	every_country = {
		if = {
			limit = { 
				has_modifier = ag_ancient_primitive_country_weakness
			}
			remove_modifier = "ag_ancient_primitive_country_weakness"
		}
		if = {
			limit = {
				has_special_project = ag_find_ancient_primitive_country_weakness
			}
			abort_special_project = {
				type = "ag_find_ancient_primitive_country_weakness"
				location = capital_scope
			}
		}
	}
	event_target:ag_ancient_primitive_country = {
		destroy_country = yes
	}
}

ag_ancient_primitive_reward_effect = {
	owner = {
		random_list = {
			20 = { add_resource = { minor_artifacts = 30 } }
			20 = { add_resource = { minor_artifacts = 25 } }
			20 = { add_resource = { minor_artifacts = 20 } }
			20 = { add_resource = { minor_artifacts = 15 } }
			20 = { add_resource = { minor_artifacts = 10 } }
		}
	}
}

#######################################
###				Iota
#######################################

ag_remove_all_recently_flag = {
	remove_country_flag = ag_recently_support_iota_enclave
	remove_country_flag = ag_recently_cancel_support_iota_enclave
	remove_country_flag = ag_recently_living_metal_trade_iota_enclave
	remove_country_flag = ag_recently_nanites_trade_iota_enclave
	remove_country_flag = ag_recently_dark_matter_trade_iota_enclave
	remove_country_flag = ag_recently_cancel_living_metal_trade_iota_enclave
	remove_country_flag = ag_recently_cancel_nanites_trade_iota_enclave
	remove_country_flag = ag_recently_cancel_dark_matter_trade_iota_enclave
	remove_country_flag = ag_recently_ask_for_building_iota_enclave
}

#######################################
###				Wanderer
#######################################

ag_ancient_habitable_planet_effect = {
	random_list = {
		30 = { change_pc = pc_toxic }
		20 = { change_pc = pc_barren  add_modifier = { modifier = terraforming_candidate days = -1 } }
		20 = { change_pc = pc_barren_cold  add_modifier = { modifier = terraforming_candidate days = -1 } }
		30 = {
			while = {
				count = 6
				random_list = {
					40 = { }
					15 = { add_deposit = d_city_ruins }
					15 = { add_deposit = d_radioactive_wasteland }
					10 = { add_deposit = d_ancient_bombardment_craters }
					10 = { add_deposit = d_active_volcano }
					5 = { add_deposit = d_crystalline_caverns }
					5 = { add_deposit = d_crystal_forest }
					5 = { add_deposit = d_crystal_reef }
					5 = { add_deposit = d_dust_caverns }
					5 = { add_deposit = d_dust_desert }
					5 = { add_deposit = d_bubbling_swamp }
					5 = { add_deposit = d_fuming_bog }
					5 = { add_deposit = d_betharian_deposit }
					5 = { add_deposit = d_alien_pets_deposit }
					5 = { add_deposit = ag_living_metal_spring }
					5 = { add_deposit = ag_living_metal_lake }
					5 = { add_deposit = ag_nanites_caverns }
					5 = { add_deposit = ag_nanites_desert }
					5 = { add_deposit = ag_dark_matter_crater }
					5 = { add_deposit = ag_dark_matter_source }
					5 = { add_deposit = ag_ancient_ruins }
				}
			}
			random_list = {
				90 = { }
				10 = { generate_primitives_on_planet = yes }
			}
		}
	}
}
ag_anchor_system_spawned = {
	set_global_flag = ag_ancient_anchor_station_$ag_number$_spawned
	if = {
		limit = {
			calc_true_if = {
				amount >= 5
				has_global_flag = ag_ancient_anchor_station_1_spawned
				has_global_flag = ag_ancient_anchor_station_2_spawned
				has_global_flag = ag_ancient_anchor_station_3_spawned
				has_global_flag = ag_ancient_anchor_station_4_spawned
				has_global_flag = ag_ancient_anchor_station_5_spawned
				has_global_flag = ag_ancient_anchor_station_6_spawned
				has_global_flag = ag_ancient_anchor_station_7_spawned
				has_global_flag = ag_ancient_anchor_station_8_spawned
				has_global_flag = ag_ancient_anchor_station_9_spawned
				has_global_flag = ag_ancient_anchor_station_10_spawned
			}
		}
		random_list = {
			25 = { }
			30 = {
				modifier = {
					add = 5
					calc_true_if = {
						amount >= 6
						has_global_flag = ag_ancient_anchor_station_1_spawned
						has_global_flag = ag_ancient_anchor_station_2_spawned
						has_global_flag = ag_ancient_anchor_station_3_spawned
						has_global_flag = ag_ancient_anchor_station_4_spawned
						has_global_flag = ag_ancient_anchor_station_5_spawned
						has_global_flag = ag_ancient_anchor_station_6_spawned
						has_global_flag = ag_ancient_anchor_station_7_spawned
						has_global_flag = ag_ancient_anchor_station_8_spawned
						has_global_flag = ag_ancient_anchor_station_9_spawned
						has_global_flag = ag_ancient_anchor_station_10_spawned
					}
				}
				modifier = {
					add = 5
					calc_true_if = {
						amount >= 7
						has_global_flag = ag_ancient_anchor_station_1_spawned
						has_global_flag = ag_ancient_anchor_station_2_spawned
						has_global_flag = ag_ancient_anchor_station_3_spawned
						has_global_flag = ag_ancient_anchor_station_4_spawned
						has_global_flag = ag_ancient_anchor_station_5_spawned
						has_global_flag = ag_ancient_anchor_station_6_spawned
						has_global_flag = ag_ancient_anchor_station_7_spawned
						has_global_flag = ag_ancient_anchor_station_8_spawned
						has_global_flag = ag_ancient_anchor_station_9_spawned
						has_global_flag = ag_ancient_anchor_station_10_spawned
					}
				}
				modifier = {
					add = 5
					calc_true_if = {
						amount >= 8
						has_global_flag = ag_ancient_anchor_station_1_spawned
						has_global_flag = ag_ancient_anchor_station_2_spawned
						has_global_flag = ag_ancient_anchor_station_3_spawned
						has_global_flag = ag_ancient_anchor_station_4_spawned
						has_global_flag = ag_ancient_anchor_station_5_spawned
						has_global_flag = ag_ancient_anchor_station_6_spawned
						has_global_flag = ag_ancient_anchor_station_7_spawned
						has_global_flag = ag_ancient_anchor_station_8_spawned
						has_global_flag = ag_ancient_anchor_station_9_spawned
						has_global_flag = ag_ancient_anchor_station_10_spawned
					}
				}
				modifier = {
					add = 5
					calc_true_if = {
						amount >= 9
						has_global_flag = ag_ancient_anchor_station_1_spawned
						has_global_flag = ag_ancient_anchor_station_2_spawned
						has_global_flag = ag_ancient_anchor_station_3_spawned
						has_global_flag = ag_ancient_anchor_station_4_spawned
						has_global_flag = ag_ancient_anchor_station_5_spawned
						has_global_flag = ag_ancient_anchor_station_6_spawned
						has_global_flag = ag_ancient_anchor_station_7_spawned
						has_global_flag = ag_ancient_anchor_station_8_spawned
						has_global_flag = ag_ancient_anchor_station_9_spawned
						has_global_flag = ag_ancient_anchor_station_10_spawned
					}
				}
				set_global_flag = ag_anchor_system_spawn_completed
			}
		}
	}
}

ag_remove_anchor_station_poi = {
	if = {
		limit = {
			$ag_target_loc$ = {
				is_point_of_interest = {
					id = ag_ancient_anchor_station_1
					event_chain = ag_ancient_anchor_station_chain
					owner = root
				}
			}
		}
		remove_point_of_interest = ag_ancient_anchor_station_1
	}
	else_if = {
		limit = {
			$ag_target_loc$ = {
				is_point_of_interest = {
					id = ag_ancient_anchor_station_2
					event_chain = ag_ancient_anchor_station_chain
					owner = root
				}
			}
		}
		remove_point_of_interest = ag_ancient_anchor_station_2
	}
	else_if = {
		limit = {
			$ag_target_loc$ = {
				is_point_of_interest = {
					id = ag_ancient_anchor_station_3
					event_chain = ag_ancient_anchor_station_chain
					owner = root
				}
			}
		}
		remove_point_of_interest = ag_ancient_anchor_station_3
	}
	else_if = {
		limit = {
			$ag_target_loc$ = {
				is_point_of_interest = {
					id = ag_ancient_anchor_station_4
					event_chain = ag_ancient_anchor_station_chain
					owner = root
				}
			}
		}
		remove_point_of_interest = ag_ancient_anchor_station_4
	}
	else_if = {
		limit = {
			$ag_target_loc$ = {
				is_point_of_interest = {
					id = ag_ancient_anchor_station_5
					event_chain = ag_ancient_anchor_station_chain
					owner = root
				}
			}
		}
		remove_point_of_interest = ag_ancient_anchor_station_5
	}
	else_if = {
		limit = {
			$ag_target_loc$ = {
				is_point_of_interest = {
					id = ag_ancient_anchor_station_6
					event_chain = ag_ancient_anchor_station_chain
					owner = root
				}
			}
		}
		remove_point_of_interest = ag_ancient_anchor_station_6
	}
	else_if = {
		limit = {
			$ag_target_loc$ = {
				is_point_of_interest = {
					id = ag_ancient_anchor_station_7
					event_chain = ag_ancient_anchor_station_chain
					owner = root
				}
			}
		}
		remove_point_of_interest = ag_ancient_anchor_station_7
	}
	else_if = {
		limit = {
			$ag_target_loc$ = {
				is_point_of_interest = {
					id = ag_ancient_anchor_station_8
					event_chain = ag_ancient_anchor_station_chain
					owner = root
				}
			}
		}
		remove_point_of_interest = ag_ancient_anchor_station_8
	}
	else_if = {
		limit = {
			$ag_target_loc$ = {
				is_point_of_interest = {
					id = ag_ancient_anchor_station_9
					event_chain = ag_ancient_anchor_station_chain
					owner = root
				}
			}
		}
		remove_point_of_interest = ag_ancient_anchor_station_9
	}
	else_if = {
		limit = {
			$ag_target_loc$ = {
				is_point_of_interest = {
					id = ag_ancient_anchor_station_10
					event_chain = ag_ancient_anchor_station_chain
					owner = root
				}
			}
		}
		remove_point_of_interest = ag_ancient_anchor_station_10
	}
}
ag_add_blocker_on_wanderer_gaia = {
	add_deposit = d_city_ruins
	add_deposit = d_city_ruins
	add_deposit = d_ruined_arcology
	add_deposit = d_active_volcano
	add_deposit = d_mountain_range
	random_list = { 50 = { } 50 = { add_deposit = d_active_volcano } }
	random_list = { 50 = { } 50 = { add_deposit = d_active_volcano } }
	random_list = { 50 = { } 50 = { add_deposit = d_mountain_range } }
	random_list = { 25 = { } 25 = { add_deposit = d_crystal_forest } 25 = { add_deposit = d_crystal_reef } 25 = { add_deposit = d_crystalline_caverns } }
	random_list = { 25 = { } 25 = { add_deposit = d_crystal_forest } 25 = { add_deposit = d_crystal_reef } 25 = { add_deposit = d_crystalline_caverns } }
	if = { limit = { planet_size > 12 } add_deposit = d_mountain_range }
	if = { limit = { planet_size > 16 } add_deposit = d_ruined_arcology }
	if = { limit = { planet_size > 20 } add_deposit = d_city_ruins }
	if = { limit = { planet_size > 24 } add_deposit = d_mountain_range }
	if = { limit = { planet_size > 28 } add_deposit = d_active_volcano }
	add_deposit = ag_ancient_obelisk
	while = { count = 4 random_list = { 50 = { } 50 = { add_deposit = ag_ancient_ruins } } }
}

#######################################
###				Others
#######################################

ag_lost_ancient_ship_debuff = {
	set_variable = { which = ag_scaled_difficulty_temp value = { variable = ag_scaled_difficulty scope = event_target:global_event_country } }
	set_variable = { which = ag_scaled_difficulty_2x_temp value = { variable = ag_scaled_difficulty_2x scope = event_target:global_event_country } }
	remove_modifier = ag_lost_ancient_ship_debuff_1x
	remove_modifier = ag_lost_ancient_ship_debuff_2x
	if = {
		limit = { check_variable = { which = ag_scaled_difficulty_temp value > 0 } }
		add_modifier = { modifier = ag_lost_ancient_ship_debuff_1x multiplier = ag_scaled_difficulty_temp days = -1 }
		add_modifier = { modifier = ag_lost_ancient_ship_debuff_2x multiplier = ag_scaled_difficulty_2x_temp days = -1 }
	}
	clear_variable = ag_scaled_difficulty_temp
	clear_variable = ag_scaled_difficulty_2x_temp
}

ag_create_precursor_databank_site = {
	solar_system = {
		if = {
			limit = {
				any_system_planet = {
					NOT = {
						is_same_value = from.planet
					}
					OR = {
						is_planet_class = pc_barren
						is_planet_class = pc_barren_cold
						is_planet_class = pc_frozen
					}
				}
			}
			random_system_planet = {
				limit = {
					NOT = {
						is_same_value = from.planet
					}
					OR = {
						is_planet_class = pc_barren
						is_planet_class = pc_barren_cold
						is_planet_class = pc_frozen
					}
				}
				create_archaeological_site = ag_precursor_databank_site
			}
		}
		else_if = {
			limit = {
				any_neighbor_system = {
					any_system_planet = {
						OR = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
							is_planet_class = pc_frozen
						}
					}
				}
			}
			random_neighbor_system = {
				limit = {
					any_system_planet = {
						OR = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
							is_planet_class = pc_frozen
						}
					}
				}
				random_system_planet = {
					limit = {
						OR = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
							is_planet_class = pc_frozen
						}
					}
					create_archaeological_site = ag_precursor_databank_site
				}
			}
		}
		else_if = {
			limit = { always = yes }
			from.planet = {
				create_archaeological_site = ag_precursor_databank_site
			}
		}
	}
}

ag_set_beacon_of_prosperity_relic = {
	change_pc = pc_relic
	clear_deposits = yes
	add_deposit = d_city_ruins
	add_deposit = d_city_ruins
	add_deposit = d_city_ruins
	add_deposit = d_city_ruins
	add_deposit = d_city_ruins
	add_deposit = d_ruined_arcology
	add_deposit = d_ruined_arcology
	add_deposit = d_ruined_arcology
	add_deposit = d_ruined_arcology
	add_deposit = d_ruined_arcology
	add_deposit = d_ruined_arcology
	add_deposit = d_ruined_arcology
	add_deposit = d_ruined_arcology
	add_deposit = d_ruined_arcology
	add_deposit = d_ruined_arcology
	add_deposit = d_relic_dense_ruins
	add_deposit = d_collapsed_spire
	add_deposit = d_massive_crevice
	add_deposit = d_shattered_solar_array
	add_deposit = d_flooded_reactor_pits
	add_deposit = d_crumbling_mining_tunnels
	add_deposit = d_relic_metal_boneyard
}
ag_set_beacon_of_prosperity_barren = {
	change_pc = pc_barren
}
ag_set_kae_interaction_ringworlds = {
	star = { ag_spawn_buff_effect = { ag_scale = xl ag_color = red } }
	random_list = {
		25 = {
			modifier = { factor = 0 has_star_flag = ag_ringworld_color_changed_1 }
			set_star_flag = ag_ringworld_color_changed_1
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_1 }
				switch = {
					trigger = is_planet_class
					pc_ringworld_habitable = {
						ag_set_ancient_ringworld = {
							ag_set_flag = yes
							ag_color = red
							ag_type = habitable
							ag_surface_type = gaia
						}
					}
					pc_ringworld_tech = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = tech } }
					default = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = seam } }
				}
			}
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_2 }
				switch = {
					trigger = is_planet_class
					pc_ringworld_habitable = {
						ag_set_ancient_ringworld = {
							ag_set_flag = yes
							ag_color = red
							ag_type = habitable
							ag_surface_type = gaia
						}
					}
					pc_ringworld_tech = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = tech } }
					default = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = seam } }
				}
			}
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_3 }
				switch = {
					trigger = is_planet_class
					pc_ringworld_habitable = {
						ag_set_ancient_ringworld = {
							ag_set_flag = yes
							ag_color = red
							ag_type = habitable
							ag_surface_type = gaia
						}
					}
					pc_ringworld_tech = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = tech } }
					default = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = seam } }
				}
			}
		}
		25 = {
			modifier = { factor = 0 has_star_flag = ag_ringworld_color_changed_2 }
			set_star_flag = ag_ringworld_color_changed_2
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_4 }
				switch = {
					trigger = is_planet_class
					pc_ringworld_habitable = {
						ag_set_ancient_ringworld = {
							ag_set_flag = yes
							ag_color = red
							ag_type = habitable
							ag_surface_type = gaia
						}
					}
					pc_ringworld_tech = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = tech } }
					default = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = seam } }
				}
			}
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_5 }
				switch = {
					trigger = is_planet_class
					pc_ringworld_habitable = {
						ag_set_ancient_ringworld = {
							ag_set_flag = yes
							ag_color = red
							ag_type = habitable
							ag_surface_type = gaia
						}
					}
					pc_ringworld_tech = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = tech } }
					default = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = seam } }
				}
			}
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_6 }
				switch = {
					trigger = is_planet_class
					pc_ringworld_habitable = {
						ag_set_ancient_ringworld = {
							ag_set_flag = yes
							ag_color = red
							ag_type = habitable
							ag_surface_type = gaia
						}
					}
					pc_ringworld_tech = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = tech } }
					default = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = seam } }
				}
			}
		}
		25 = {
			modifier = { factor = 0 has_star_flag = ag_ringworld_color_changed_3 }
			set_star_flag = ag_ringworld_color_changed_3
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_7 }
				switch = {
					trigger = is_planet_class
					pc_ringworld_habitable = {
						ag_set_ancient_ringworld = {
							ag_set_flag = yes
							ag_color = red
							ag_type = habitable
							ag_surface_type = gaia
						}
					}
					pc_ringworld_tech = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = tech } }
					default = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = seam } }
				}
			}
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_8 }
				switch = {
					trigger = is_planet_class
					pc_ringworld_habitable = {
						ag_set_ancient_ringworld = {
							ag_set_flag = yes
							ag_color = red
							ag_type = habitable
							ag_surface_type = gaia
						}
					}
					pc_ringworld_tech = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = tech } }
					default = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = seam } }
				}
			}
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_9 }
				switch = {
					trigger = is_planet_class
					pc_ringworld_habitable = {
						ag_set_ancient_ringworld = {
							ag_set_flag = yes
							ag_color = red
							ag_type = habitable
							ag_surface_type = gaia
						}
					}
					pc_ringworld_tech = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = tech } }
					default = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = seam } }
				}
			}
		}
		25 = {
			modifier = { factor = 0 has_star_flag = ag_ringworld_color_changed_4 }
			set_star_flag = ag_ringworld_color_changed_4
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_10 }
				switch = {
					trigger = is_planet_class
					pc_ringworld_habitable = {
						ag_set_ancient_ringworld = {
							ag_set_flag = yes
							ag_color = red
							ag_type = habitable
							ag_surface_type = gaia
						}
					}
					pc_ringworld_tech = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = tech } }
					default = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = seam } }
				}
			}
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_11 }
				switch = {
					trigger = is_planet_class
					pc_ringworld_habitable = {
						ag_set_ancient_ringworld = {
							ag_set_flag = yes
							ag_color = red
							ag_type = habitable
							ag_surface_type = gaia
						}
					}
					pc_ringworld_tech = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = tech } }
					default = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = seam } }
				}
			}
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_12 }
				switch = {
					trigger = is_planet_class
					pc_ringworld_habitable = {
						ag_set_ancient_ringworld = {
							ag_set_flag = yes
							ag_color = red
							ag_type = habitable
							ag_surface_type = gaia
						}
					}
					pc_ringworld_tech = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = tech } }
					default = { ag_set_ancient_ringworld = { ag_set_flag = yes ag_color = red ag_type = seam } }
				}
			}
		}
	}
}

ag_lost_ancient_ship_clear_failed_flags = {
	remove_country_flag = ag_lost_ancient_ship_target_guardian_dragon_failed
	remove_country_flag = ag_lost_ancient_ship_target_guardian_fortress_failed
	remove_country_flag = ag_lost_ancient_ship_target_guardian_stellarite_failed
	remove_country_flag = ag_lost_ancient_ship_target_guardian_horror_failed
	remove_country_flag = ag_lost_ancient_ship_target_guardian_hiver_failed
	remove_country_flag = ag_lost_ancient_ship_target_guardian_sphere_failed
	remove_country_flag = ag_lost_ancient_ship_target_guardian_dreadnought_failed
	remove_country_flag = ag_lost_ancient_ship_target_guardian_wraith_failed
	remove_country_flag = ag_lost_ancient_ship_target_guardian_hatchling_failed
	remove_country_flag = ag_lost_ancient_ship_target_guardian_scavenger_bot_failed
	remove_country_flag = ag_lost_ancient_ship_target_guardian_elderly_tiyanki_failed
}
ag_lost_ancient_ship_clear_guardians_flags = {
	remove_country_flag = ag_exists_guardian_dragon
	remove_country_flag = ag_exists_guardian_fortress
	remove_country_flag = ag_exists_guardian_stellarite
	remove_country_flag = ag_exists_guardian_horror
	remove_country_flag = ag_exists_guardian_hiver
	remove_country_flag = ag_exists_guardian_sphere
	remove_country_flag = ag_exists_guardian_dreadnought
	remove_country_flag = ag_exists_guardian_wraith
	remove_country_flag = ag_exists_guardian_hatchling
	remove_country_flag = ag_exists_guardian_scavenger_bot
	remove_country_flag = ag_exists_guardian_elderly_tiyanki
}
ag_lost_ancient_ship_set_guardians_flag = {
	every_country = {
		if = { limit = { is_country_type = guardian_dragon has_communications = prev.owner } prev.owner = { set_country_flag = ag_exists_guardian_dragon } }
		else_if = { limit = { is_country_type = guardian_fortress has_communications = prev.owner } prev.owner = { set_country_flag = ag_exists_guardian_fortress } }
		else_if = { limit = { is_country_type = guardian_stellarite has_communications = prev.owner } prev.owner = { set_country_flag = ag_exists_guardian_stellarite } }
		else_if = { limit = { is_country_type = guardian_horror has_communications = prev.owner } prev.owner = { set_country_flag = ag_exists_guardian_horror } }
		else_if = { limit = { is_country_type = guardian_hiver has_communications = prev.owner } prev.owner = { set_country_flag = ag_exists_guardian_hiver } }
		else_if = { limit = { is_country_type = guardian_sphere has_communications = prev.owner } prev.owner = { set_country_flag = ag_exists_guardian_sphere } }
		else_if = { limit = { is_country_type = guardian_dreadnought has_communications = prev.owner } prev.owner = { set_country_flag = ag_exists_guardian_dreadnought } }
		else_if = { limit = { is_country_type = guardian_wraith has_communications = prev.owner } prev.owner = { set_country_flag = ag_exists_guardian_wraith } }
		else_if = { limit = { is_country_type = guardian_hatchling has_communications = prev.owner } prev.owner = { set_country_flag = ag_exists_guardian_hatchling } }
		else_if = { limit = { is_country_type = guardian_scavenger_bot has_communications = prev.owner } prev.owner = { set_country_flag = ag_exists_guardian_scavenger_bot } }
		else_if = { limit = { is_country_type = guardian_elderly_tiyanki has_communications = prev.owner } prev.owner = { set_country_flag = ag_exists_guardian_elderly_tiyanki } }
	}
}
ag_lost_ancient_ship_change_guardians_protection = {
	if = {
		limit = { has_country_flag = ag_lost_ancient_ship_target_$ag_target_guardian$_protected }
		remove_country_flag = ag_lost_ancient_ship_target_$ag_target_guardian$_protected
	}
	else = { set_country_flag = ag_lost_ancient_ship_target_$ag_target_guardian$_protected }
}