###	防御AP_通用	############################################################

#	AAR防御参数DB
#	AAR防御星基修正DB




###_[AAR防御参数DB]	
#_evt	<aar初始化/aar读档debug	/fw年检>
##_var输出	|AAR_var_cntr_ATK_vigilance|
AAR_eft_cntr_VIGILANCE_var_DB = {
	## 伤害参数
	set_variable = { which = AAR_var_cntr_ATK_vigilance		value = 0 }	# |AAR星基ATK|
	
	# 类型ATK
	export_modifier_to_variable = { modifier = weapon_type_explosive_weapon_damage_mult				 variable = TEMP_var_AAR }
	multiply_variable = { which = TEMP_var_AAR				value = 0.33 }
	change_variable = { which = AAR_var_cntr_ATK_vigilance	value = TEMP_var_AAR }
	export_modifier_to_variable = { modifier = weapon_type_kinetic_weapon_damage_mult				 variable = TEMP_var_AAR }
	multiply_variable = { which = TEMP_var_AAR				value = 0.33 }
	change_variable = { which = AAR_var_cntr_ATK_vigilance	value = TEMP_var_AAR }
	export_modifier_to_variable = { modifier = weapon_type_energy_weapon_damage_mult				 variable = TEMP_var_AAR }
	multiply_variable = { which = TEMP_var_AAR				value = 0.33 }
	change_variable = { which = AAR_var_cntr_ATK_vigilance	value = TEMP_var_AAR }
	# 全ATK
	export_modifier_to_variable = { modifier = ship_weapon_damage									 variable = TEMP_var_AAR }
	change_variable = { which = AAR_var_cntr_ATK_vigilance	value = TEMP_var_AAR }
	# 防御ATK
	export_modifier_to_variable = { modifier = shipclass_starbase_damage_mult						 variable = TEMP_var_AAR }
	multiply_variable = { which = TEMP_var_AAR				value = 0.5 }
	change_variable = { which = AAR_var_cntr_ATK_vigilance	value = TEMP_var_AAR }
	export_modifier_to_variable = { modifier = shipclass_military_station_damage_mult				 variable = TEMP_var_AAR }
	multiply_variable = { which = TEMP_var_AAR				value = 0.5 }
	change_variable = { which = AAR_var_cntr_ATK_vigilance	value = TEMP_var_AAR }
	
	# AAR星基ATK_权重	60%
	multiply_variable = { which = AAR_var_cntr_ATK_vigilance	value = 0.6 }
	change_variable = { which = AAR_var_cntr_ATK_vigilance		value = 1 }

	# clear
	if = { limit = { is_variable_set = TEMP_var_AAR }		clear_variable = TEMP_var_AAR }
}




###_[AAR防御星基修正DB]		|所有防御飞升|包含|进阶飞升/护国神盾|
#_evt	<aar防御ap星基init/aar防御ap星基易主>
#_ap	<AP星基防御>
AAR_eft_sstm_VIGILANCE_starbase_mod_DB = {
	##	添加强化		|AP星基防御_存在|
	if = {
		limit = { exists = space_owner
			space_owner = { has_country_flag = AAR_flg_cntr_AP_VIGILANCE }	# |AAR防御飞升添加|
		}
		every_ship_in_system = {
			limit = {
				OR = {
					is_ship_class = shipclass_military_station
					is_ship_class = shipclass_starbase
				}
			}
			# 星基
			if = {
				limit = {
					NOT = { has_modifier = AAR_mod_ship_VIGILANCE_starbase }
					is_ship_class = shipclass_starbase
					#	|仅原版星基|
					OR = {
						##	星基
						is_ship_size = starbase_outpost
						is_ship_size = starbase_starport
						is_ship_size = starbase_starhold
						is_ship_size = starbase_starfortress
						is_ship_size = starbase_citadel
						##	星环
						is_ship_size = orbital_ring_tier_1
						is_ship_size = orbital_ring_tier_2
						is_ship_size = orbital_ring_tier_3
						##	AAR神堡
						is_ship_size = AAR_ship_AP_void_fortress_1
						is_ship_size = AAR_ship_AP_void_fortress_2
						is_ship_size = AAR_ship_AP_void_fortress_3
					}
				}
				add_modifier = { modifier = AAR_mod_ship_VIGILANCE_starbase		 days = -1 }
			}
			# 防御平台
			else_if = {
				limit = {
					is_ship_size = military_station_small
					NOT = { has_modifier = AAR_mod_ship_VIGILANCE_platform }
				}
				add_modifier = { modifier = AAR_mod_ship_VIGILANCE_platform	 days = -1 }
			}
			# 离子炮
			else_if = {
				limit = {
					is_ship_size = ion_cannon
					NOT = { has_modifier = AAR_mod_ship_VIGILANCE_ion }
				}
				add_modifier = { modifier = AAR_mod_ship_VIGILANCE_ion	 days = -1 }
			}
			# 防御站/其他
			else_if = {
				limit = { NOT = { has_modifier = AAR_mod_ship_VIGILANCE_station } }
				add_modifier = { modifier = AAR_mod_ship_VIGILANCE_station	 days = -1 }
			}
		}
	}
	##	清理强化		|AP星基防御_无|
	else = {
		every_ship_in_system = {
			limit = {
				OR = {
					has_modifier = AAR_mod_ship_VIGILANCE_starbase
					has_modifier = AAR_mod_ship_VIGILANCE_platform
					has_modifier = AAR_mod_ship_VIGILANCE_station
					has_modifier = AAR_mod_ship_VIGILANCE_ion
				}
			}
			remove_modifier = AAR_mod_ship_VIGILANCE_starbase
			remove_modifier = AAR_mod_ship_VIGILANCE_platform
			remove_modifier = AAR_mod_ship_VIGILANCE_station
			remove_modifier = AAR_mod_ship_VIGILANCE_ion
		}
	}
}

