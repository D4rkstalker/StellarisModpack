set_stellar_cornucopia_terraforming_candidate_size = {
	random_list = {
		5 = { set_planet_size = 15 }
		7 = { set_planet_size = 16 }
		10 = { set_planet_size = 17 }
		11 = { set_planet_size = 18 }
		16 = { set_planet_size = 19 }
		19 = { set_planet_size = 20 }
		13 = { set_planet_size = 21 }
		9 = { set_planet_size = 22 }
		8 = { set_planet_size = 23 }
		2 = { set_planet_size = 24 }
	}
}

add_planetary_features_with_planet_size = {
	random_list = {
		10 = { # + 3 feature
			random_list = {
				10 = {
					modifier = {
						factor = 0
						NOR = {
							is_planet_class = pc_continental
							is_planet_class = pc_savannah
						}
					}
					modifier = {
						factor = 0.25
						OWNER = {
							OR = {
								is_lithoid_empire = yes
								is_machine_empire = yes
							}
						}
					}
					add_deposit = d_black_soil
				}
				10 = {
					modifier = {
						factor = 0
						is_cold = no
					}
					modifier = {
						factor = 0.25
						OWNER = {
							OR = {
								is_lithoid_empire = yes
								is_machine_empire = yes
							}
						}
					}
					add_deposit = d_fungal_forest
				}
				10 = {
					modifier = {
						factor = 0
						NOR = {
							is_planet_class = pc_arid
							is_planet_class = pc_desert
						}
					}
					modifier = {
						factor = 0.25
						OWNER = {
							OR = {
								is_lithoid_empire = yes
								is_machine_empire = yes
							}
						}
					}
					add_deposit = d_marvelous_oasis
				}
				10 = {
					modifier = {
						factor = 0
						NOT = {
							is_planet_class = pc_ocean
						}
					}
					modifier = {
						factor = 0.25
						OWNER = {
							OR = {
								is_lithoid_empire = yes
								is_machine_empire = yes
							}
						}
					}
					add_deposit = d_teeming_reef
				}
				10 = {
					modifier = {
						factor = 0
						NOR = {
							is_planet_class = pc_arid
							is_planet_class = pc_desert
							is_planet_class = pc_tropical
						}
					}
					modifier = {
						factor = 0.25
						OWNER = {
							OR = {
								is_lithoid_empire = yes
								is_machine_empire = yes
							}
						}
					}
					add_deposit = d_tropical_island
				}
				10 = {
					modifier = {
						factor = 0
						NOR = {
							is_planet_class = pc_arctic
							is_planet_class = pc_tundra
							is_planet_class = pc_savannah
							is_planet_class = pc_desert
							is_planet_class = pc_arid
						}
					}
					add_deposit = d_geothermal_vent
				}
				10 = {
					modifier = {
						factor = 0
						NOR = {
							is_planet_class = pc_tropical
							is_planet_class = pc_alpine
							is_planet_class = pc_continental
						}
					}
					add_deposit = d_tempestous_mountain
				}
				10 = {
					modifier = {
						factor = 0
						NOT = {
							is_planet_class = pc_ocean
						}
					}
					add_deposit = d_underwater_vent
				}
				10 = {
					modifier = {
						factor = 0
						NOR = {
							is_planet_class = pc_continental
							is_planet_class = pc_desert
							is_planet_class = pc_alpine
							is_planet_class = pc_arctic
							is_planet_class = pc_arid
							is_planet_class = pc_tundra
						}
					}
					add_deposit = d_rich_mountain
				}
				10 = {
					modifier = {
						factor = 0
						NOR = {
							is_planet_class = pc_ocean
							is_planet_class = pc_tropical
							is_planet_class = pc_savannah
						}
					}
					add_deposit = d_submerged_ore_veins
				}
			}
		}
		10 = { # + 2 + 1 features
			random_list = {
				10 = {
					modifier = {
						factor = 0
						NOR = {
							is_planet_class = pc_savannah
							is_planet_class = pc_continental
							is_planet_class = pc_arid
						}
					}
					modifier = {
						factor = 0.25
						OWNER = {
							OR = {
								is_lithoid_empire = yes
								is_machine_empire = yes
							}
						}
					}
					add_deposit = d_fertile_lands
				}
				10 = {
					modifier = {
						factor = 0
						is_cold = no
					}
					modifier = {
						factor = 0.25
						OWNER = {
							OR = {
								is_lithoid_empire = yes
								is_machine_empire = yes
							}
						}
					}
					add_deposit = d_fungal_caves
				}
				10 = {
					modifier = {
						factor = 0
						NOR = {
							is_planet_class = pc_arid
							is_planet_class = pc_desert
						}
					}
					modifier = {
						factor = 0.25
						OWNER = {
							OR = {
								is_lithoid_empire = yes
								is_machine_empire = yes
							}
						}
					}
					add_deposit = d_great_river
				}
				10 = {
					modifier = {
						factor = 0
						NOR = {
							is_planet_class = pc_tropical
							is_planet_class = pc_ocean
						}
					}
					modifier = {
						factor = 0.25
						OWNER = {
							OR = {
								is_lithoid_empire = yes
								is_machine_empire = yes
							}
						}
					}
					add_deposit = d_lush_jungle
				}
				10 = {
					modifier = {
						factor = 0
						is_cold = no
					}
					add_deposit = d_frozen_gas_lake
				}
				10 = {
					modifier = {
						factor = 0
						is_wet = no
					}
					add_deposit = d_rushing_waterfalls
				}
				10 = {
					modifier = {
						factor = 0
						is_dry = no
					}
					add_deposit = d_searing_desert
				}
				10 = {
					modifier = {
						factor = 0
						NOR = {
							is_planet_class = pc_continental
							is_planet_class = pc_tropical
							is_planet_class = pc_savannah
							is_planet_class = pc_desert
						}
					}
					add_deposit = d_prosperous_mesa
				}
				10 = {
					modifier = {
						factor = 0
						NOR = {
							is_planet_class = pc_ocean
							is_planet_class = pc_alpine
							is_planet_class = pc_arctic
							is_planet_class = pc_arid
							is_planet_class = pc_tundra
						}
					}
					add_deposit = d_ore_rich_caverns
				}
			}
			add_plus_one_feature = yes
		}
		10 = { # + 1 + 1 + 1 features
			while = {
				count = 3
				add_plus_one_feature = yes
			}
		}
	}
}

add_plus_one_feature = {
	random_list = {
		10 = {
			modifier = {
				factor = 0
				NOT = {
					is_planet_class = pc_ocean
				}
			}
			modifier = {
				factor = 0.25
				OWNER = {
					OR = {
						is_lithoid_empire = yes
						is_machine_empire = yes
					}
				}
			}
			add_deposit = d_boggy_fens
		}
		10 = {
			modifier = {
				factor = 0
				NOR = {
					is_planet_class = pc_arid
					is_planet_class = pc_savannah
				}
			}
			modifier = {
				factor = 0.25
				OWNER = {
					OR = {
						is_lithoid_empire = yes
						is_machine_empire = yes
					}
				}
			}
			add_deposit = d_bountiful_plains
		}
		10 = {
			modifier = {
				factor = 0
				NOR = {
					is_planet_class = pc_alpine
					is_planet_class = pc_tundra
				}
			}
			modifier = {
				factor = 0.25
				OWNER = {
					OR = {
						is_lithoid_empire = yes
						is_machine_empire = yes
					}
				}
			}
			add_deposit = d_forgiving_tundra
		}
		10 = {
			modifier = {
				factor = 0
				NOR = {
					is_planet_class = pc_ocean
					is_planet_class = pc_tropical
				}
			}
			modifier = {
				factor = 0.25
				OWNER = {
					OR = {
						is_lithoid_empire = yes
						is_machine_empire = yes
					}
				}
			}
			add_deposit = d_green_hills
		}
		10 = {
			modifier = {
				factor = 0
				NOT = {
					is_planet_class = pc_arctic
				}
			}
			modifier = {
				factor = 0.25
				OWNER = {
					OR = {
						is_lithoid_empire = yes
						is_machine_empire = yes
					}
				}
			}
			add_deposit = d_lichen_fields
		}
		10 = {
			modifier = {
				factor = 0
				NOT = {
					is_planet_class = pc_desert
				}
			}
			modifier = {
				factor = 0.25
				OWNER = {
					OR = {
						is_lithoid_empire = yes
						is_machine_empire = yes
					}
				}
			}
			add_deposit = d_nutritious_mudland
		}
		10 = {
			modifier = {
				factor = 0
				NOT = {
					is_planet_class = pc_continental
				}
			}
			modifier = {
				factor = 0.25
				OWNER = {
					OR = {
						is_lithoid_empire = yes
						is_machine_empire = yes
					}
				}
			}
			add_deposit = d_rugged_woods
		}
		10 = {
			modifier = {
				factor = 0
				is_dry = no
			}
			add_deposit = d_arid_highlands
		}
		10 = {
			modifier = {
				factor = 0
				NOR = {
					is_cold = yes
					is_wet = yes
				}
			}
			add_deposit = d_hot_springs
		}
		10 = {
			modifier = {
				factor = 0
				NOR = {
					is_planet_class = pc_tropical
					is_planet_class = pc_savannah
					is_planet_class = pc_desert
					is_planet_class = pc_ocean
					is_planet_class = pc_tundra
				}
			}
			add_deposit = d_mineral_fields
		}
		10 = {
			modifier = {
				factor = 0
				NOR = {
					is_planet_class = pc_alpine
					is_planet_class = pc_arctic
					is_planet_class = pc_arid
					is_planet_class = pc_continental
				}
			}
			add_deposit = d_veiny_cliffs
		}
		10 = {
			modifier = {
				factor = 0
				NOR = {
					is_planet_class = pc_alpine
					is_planet_class = pc_arctic
					is_planet_class = pc_arid
					is_planet_class = pc_continental
				}
			}
			add_deposit = d_veiny_cliffs
		}
	}
}

eo_assign_terraforming_candidates = {
	if = {
		limit = {
			any_system_planet = {
				OR = {
					is_planet_class = pc_barren
					is_planet_class = pc_barren_cold
				}
				NOT = { has_modifier = terraforming_candidate }
				is_asteroid = no
				is_star = no
			}
		}
		random_system_planet = {
			limit = {
				OR = {
					is_planet_class = pc_barren
					is_planet_class = pc_barren_cold
				}
				NOT = { has_modifier = terraforming_candidate }
				is_asteroid = no
				is_star = no
			}
			set_stellar_cornucopia_terraforming_candidate_size = yes
			add_modifier = {
				modifier = terraforming_candidate
			}
			save_event_target_as = terraforming_candidate
		}
	}
	else_if = {
		limit = {
			any_system_planet = {
				OR = {
					is_planet_class = pc_toxic
					is_planet_class = pc_frozen
					is_planet_class = pc_molten
				}
				NOT = { has_modifier = terraforming_candidate }
				is_asteroid = no
				is_star = no
			}
		}
		random_system_planet = {
			limit = {
				OR = {
					is_planet_class = pc_toxic
					is_planet_class = pc_frozen
					is_planet_class = pc_molten
				}
				NOT = { has_modifier = terraforming_candidate }
				is_asteroid = no
				is_star = no
			}
			random_list = {
				50 = { change_pc = pc_barren }
				50 = { change_pc = pc_barren_cold }
			}
			set_stellar_cornucopia_terraforming_candidate_size = yes
			add_modifier = {
				modifier = terraforming_candidate
			}
			save_event_target_as = terraforming_candidate
		}
	}
	else = {
		random_system_planet = {
			limit = {
				is_planet_class = pc_gas_giant
				NOT = { has_modifier = terraforming_candidate }
				is_asteroid = no
				is_star = no
			}
			random_list = {
				50 = { change_pc = pc_barren }
				50 = { change_pc = pc_barren_cold }
			}
			set_stellar_cornucopia_terraforming_candidate_size = yes
			add_modifier = {
				modifier = terraforming_candidate
			}
			save_event_target_as = terraforming_candidate
		}
	}
	event_target:terraforming_candidate = {
		if = {
			limit = {
				has_deposit = yes
			}
			solar_system = {
				if = {
					limit = {
						any_system_planet = {
							has_deposit = no
							is_homeworld = no
						}
						always = no #################################################################################################
					}
					random_system_planet = {
						limit = {
							has_deposit = no
							is_homeworld = no
						}
						save_event_target_as = resource_deposit_target
					}
				}
				else = {
					spawn_new_asteroid = yes
				}
			}
		#Energy
			if = {
				limit = {
					OR = {
						has_deposit = d_energy_2
						has_deposit = d_energy_3
					}
				}
				event_target:resource_deposit_target = {
					set_deposit = d_energy_2
				}
			}
			if = {
				limit = {
					has_deposit = d_energy_5
				}
				event_target:resource_deposit_target = {
					set_deposit = d_energy_5
				}
			}
		#Minerals
			if = {
				limit = {
					OR = {
						has_deposit = d_minerals_2
						has_deposit = d_minerals_3
					}
				}
				event_target:resource_deposit_target = {
					set_deposit = d_minerals_2
				}
			}
			if = {
				limit = {
					has_deposit = d_minerals_5
				}
				event_target:resource_deposit_target = {
					set_deposit = d_minerals_5
				}
			}
		#Physics
			if = {
				limit = {
					OR = {
						has_deposit = d_physics_2
						has_deposit = d_physics_3
					}
				}
				event_target:resource_deposit_target = {
					set_deposit = d_physics_2
				}
			}
		#Society
			if = {
				limit = {
					OR = {
						has_deposit = d_society_2
						has_deposit = d_society_3
					}
				}
				event_target:resource_deposit_target = {
					set_deposit = d_society_2
				}
			}
		#Engineering
			if = {
				limit = {
					OR = {
						has_deposit = d_engineering_2
						has_deposit = d_engineering_3
					}
				}
				event_target:resource_deposit_target = {
					set_deposit = d_engineering_2
				}
			}
		}
	}
}

spawn_new_asteroid = {
	random_system_planet = {
		limit = {
			is_asteroid = yes
		}
		save_event_target_as = new_asteroid_spawn_reference
	}
	spawn_planet = {
		class = "pc_asteroid"
		size = 5
		location = event_target:new_asteroid_spawn_reference
		orbit_angle_offset = 60
		init_effect = {
			save_event_target_as = resource_deposit_target
			random_list = {
				1 = {
					set_name = "NAME_stellar_cornucopia_asteroid_1"
				}
				1 = {
					set_name = "NAME_stellar_cornucopia_asteroid_2"
				}
				1 = {
					set_name = "NAME_stellar_cornucopia_asteroid_3"
				}
				1 = {
					set_name = "NAME_stellar_cornucopia_asteroid_4"
				}
				1 = {
					set_name = "NAME_stellar_cornucopia_asteroid_5"
				}
				1 = {
					set_name = "NAME_stellar_cornucopia_asteroid_6"
				}
				1 = {
					set_name = "NAME_stellar_cornucopia_asteroid_7"
				}
				1 = {
					set_name = "NAME_stellar_cornucopia_asteroid8"
				}
				1 = {
					set_name = "NAME_stellar_cornucopia_asteroid_9"
				}
				1 = {
					set_name = "NAME_stellar_cornucopia_asteroid_10"
				}
			}
		}
	}
}