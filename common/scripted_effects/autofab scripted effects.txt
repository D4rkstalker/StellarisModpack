add_autofab_mine = {
	remove_planet_flag = factory_expanding
	add_deposit = autofab_mine
	change_variable = { which = autofab_mine value = 1 }
}

add_autofab_farm = {
	add_deposit = autofab_farm
	change_variable = { which = autofab_farm value = 1 }
	remove_planet_flag = factory_expanding
}

add_autofab_power = {
	add_deposit = autofab_power
	change_variable = { which = autofab_power value = 1 }
	remove_planet_flag = factory_expanding
}

add_autofab_foundry = {
	remove_planet_flag = factory_expanding
	add_deposit = autofab_foundry
	change_variable = { which = autofab_foundry value = 1 }
	remove_planet_flag = foundry_expanding
}

add_autofab_factory = {
	remove_planet_flag = factory_expanding
	add_deposit = autofab_factory
	change_variable = { which = autofab_factory value = 1 }
}

add_autofab_extractor = {
	add_deposit = autofab_refinery_extractor
	remove_planet_flag = factory_expanding
	set_planet_flag = has_autofab_extractor
}

add_autofab_refinery = {
	remove_planet_flag = factory_expanding
	add_deposit = autofab_gases_refinery
	change_variable = { which = autofab_refinery value = 1 }
}

add_autofab_chemical = {
	remove_planet_flag = factory_expanding
	add_deposit = autofab_motes_refinery
	change_variable = { which = autofab_chemical value = 1 }
}

add_autofab_translucer = {
	remove_planet_flag = factory_expanding
	add_deposit = autofab_crystals_refinery
	change_variable = { which = autofab_translucer value = 1 }
}

retooling_bonus = {
	add_resource = {
		alloys = @factoryalloycost
	}
}

upgrade_foundry = {
	if = {
		limit = {
			exists = owner
			owner = { has_technology = tech_alloys_2 }
			has_deposit = autofab_foundry_2
		}
		planet_event = { id = autofab_automation.14 days = 360 }
		add_modifier = { modifier = factory_expansion days = 360 }
	}
	else = {
		planet_event = { id = autofab_automation.13 days = 360 }
		add_modifier = { modifier = factory_expansion days = 360 }
	}
}

upgrade_factory = {
	if = {
		limit = {
			exists = owner
			owner = { has_technology = tech_luxuries_2 }
			has_deposit = autofab_factory_2
		}
		planet_event = { id = autofab_automation.12 days = 360 }
		add_modifier = { modifier = factory_expansion days = 360 }
	}
	else = {
		planet_event = { id = autofab_automation.11 days = 360 }
		add_modifier = { modifier = factory_expansion days = 360 }
	}
}

country_energy_check = {
	if = {
		limit = {
			num_owned_planets > 2
			resource_income_compare = { resource = energy  value < 50 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_energy_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			num_owned_planets > 2
			resource_income_compare = { resource = energy  value < 40 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_energy_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			num_owned_planets > 1
			resource_income_compare = { resource = energy  value < 30 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_energy_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = energy  value < 20 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_energy_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = energy  value < 10 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_energy_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = energy  value < 0 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_energy_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = energy  value < -10 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_energy_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
}

country_food_check = {
	if = {
		limit = {
			resource_income_compare = { resource = food  value > 100 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_food_need value = -1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = food  value > 90 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_food_need value = -1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = food  value > 80 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_food_need value = -1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = food  value > 70 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_food_need value = -1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = food  value > 60 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_food_need value = -1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = food  value < 20 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_food_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = food  value < 10 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_food_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = food  value < 0 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_food_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = food  value < -10 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_food_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
}

country_minerals_check = {
	if = {
		limit = {
			num_owned_planets > 4
			resource_income_compare = { resource = minerals  value < 90 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_minerals_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			num_owned_planets > 4
			resource_income_compare = { resource = minerals  value < 80 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_minerals_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			num_owned_planets > 3
			resource_income_compare = { resource = minerals  value < 70 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_minerals_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			num_owned_planets > 3
			resource_income_compare = { resource = minerals  value < 60 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_minerals_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			num_owned_planets > 2
			resource_income_compare = { resource = minerals  value < 50 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_minerals_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			num_owned_planets > 2
			resource_income_compare = { resource = minerals  value < 40 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_minerals_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = minerals  value < 30 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_minerals_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = minerals  value < 20 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_minerals_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = minerals  value < 10 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_minerals_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = minerals  value < 0 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_minerals_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = minerals  value < -10 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_minerals_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
}

country_consumer_goods_check = {
	if = {
		limit = {
			num_owned_planets < 3
			resource_income_compare = { resource = consumer_goods  value > 100 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_consumer_goods_need value = -1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			num_owned_planets < 3
			resource_income_compare = { resource = consumer_goods  value > 90 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_consumer_goods_need value = -1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			num_owned_planets < 3
			resource_income_compare = { resource = consumer_goods  value > 80 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_consumer_goods_need value = -1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			num_owned_planets > 2
			resource_income_compare = { resource = consumer_goods  value < 50 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_consumer_goods_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			num_owned_planets > 2
			resource_income_compare = { resource = consumer_goods  value < 40 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_consumer_goods_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			num_owned_planets > 1
			resource_income_compare = { resource = consumer_goods  value < 30 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_consumer_goods_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = consumer_goods  value < 20 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_consumer_goods_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = consumer_goods  value < 10 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_consumer_goods_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = consumer_goods  value < 0 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_consumer_goods_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
	if = {
		limit = {
			resource_income_compare = { resource = consumer_goods  value < -10 }
			check_variable = { which = autofab_auto_planets value > 0 }
		}
		change_variable = { which = country_consumer_goods_need value = 1 }
		change_variable = { which = autofab_auto_planets value = -1 }
	}
}