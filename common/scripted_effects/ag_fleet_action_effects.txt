
#################################################
###                                           ###
###                Gamam Area                 ###
###                                           ###
#################################################

ag_gamma_small_station_1_find_target_action = {
	optimize_memory
	if = {
		limit = { any_system = {
			NOT = { ag_is_ancient_system = yes }
			ag_is_normal_system = yes
			any_system_planet = { is_colony = yes }
		} }
		closest_system = {
			use_bypasses = yes
			limit = {
				NOT = { ag_is_ancient_system = yes }
				ag_is_normal_system = yes
				any_system_planet = { is_colony = yes }
			}
			random_system_planet = {
				limit = { is_primary_star = yes }
				save_global_event_target_as = ag_gamma_target_star_loc_1
			}
			save_global_event_target_as = ag_gamma_target_loc_1
		}
	}
	if = {
		limit = { exists = event_target:ag_gamma_target_loc_1 }
		event_target:ag_ancient_gamma_guardian_country = {
			if = {
				limit = { any_controlled_fleet = { is_same_value = event_target:ag_gamma_station_small_1 } }
				random_controlled_fleet = {
					limit = { is_same_value = event_target:ag_gamma_station_small_1 }
					queue_actions = {
						repeat = {
							find_closest_system = {
								trigger = {
									id = ag_gamma_station_small_1_find_system
									is_same_value = event_target:ag_gamma_target_loc_1
								}
								found_system = {
									move_to = this
									find_closest_planet = {
										trigger = {
											id = ag_gamma_station_small_1_find_star
											is_same_value = event_target:ag_gamma_target_star_loc_1
										}
										found_planet = {
											move_to = this
											orbit_planet = this
											wait = 60
											effect = {
												id = ag_gamma_station_small_1_deploy
												prevprev = {
													fleet_event = { id = ag_gamma.351 days = 1 }
													clear_orders = yes
													clear_fleet_actions = this
												}
											}
										}
									}
								}
							}
						}
					}
				}
				every_playable_country = {
					limit = { NOT = { is_same_value = event_target:ag_ancient_gamma_guardian_country } }
					create_point_of_interest = {
						id = ag_gamma_target_system_1
						name = "ag_gamma_target_system_1"
						desc = "ag_gamma_target_system_1_desc"
						event_chain = ag_gamma_guardian_crisis_chain
						location = event_target:ag_gamma_target_loc_1
					}
				}
			}
		}
	}
}

ag_gamma_small_station_2_find_target_action = {
	optimize_memory
	if = {
		limit = { any_system = {
			NOT = { ag_is_ancient_system = yes }
			ag_is_normal_system = yes
			any_system_planet = { is_colony = yes }
			NOR = {
				is_same_value = event_target:ag_gamma_target_loc_1
				any_system_planet = { is_same_value = event_target:ag_gamma_target_star_loc_1 }
			}
		} }
		closest_system = {
			use_bypasses = yes
			limit = {
				NOT = { ag_is_ancient_system = yes }
				ag_is_normal_system = yes
				any_system_planet = { is_colony = yes }
				NOR = {
					is_same_value = event_target:ag_gamma_target_loc_1
					any_system_planet = { is_same_value = event_target:ag_gamma_target_star_loc_1 }
				}
			}
			random_system_planet = {
				limit = { is_primary_star = yes }
				save_global_event_target_as = ag_gamma_target_star_loc_2
			}
			save_global_event_target_as = ag_gamma_target_loc_2
		}
	}
	if = {
		limit = { exists = event_target:ag_gamma_target_loc_2 }
		event_target:ag_ancient_gamma_guardian_country = {
			if = {
				limit = { any_controlled_fleet = { is_same_value = event_target:ag_gamma_station_small_2 } }
				random_controlled_fleet = {
					limit = { is_same_value = event_target:ag_gamma_station_small_2 }
					queue_actions = {
						repeat = {
							find_closest_system = {
								trigger = {
									id = ag_gamma_station_small_2_fsystem
									is_same_value = event_target:ag_gamma_target_loc_2
								}
								found_system = {
									move_to = this
									find_closest_planet = {
										trigger = {
											id = ag_gamma_station_small_2_fstar
											is_same_value = event_target:ag_gamma_target_star_loc_2
										}
										found_planet = {
											move_to = this
											orbit_planet = this
											wait = 60
											effect = {
												id = ag_gamma_station_small_2_deploy
												prevprev = {
													fleet_event = { id = ag_gamma.352 days = 1 }
													clear_orders = yes
													clear_fleet_actions = this
												}
											}
										}
									}
								}
							}
						}
					}
				}
				every_playable_country = {
					limit = { NOT = { is_same_value = event_target:ag_ancient_gamma_guardian_country } }
					create_point_of_interest = {
						id = ag_gamma_target_system_2
						name = "ag_gamma_target_system_2"
						desc = "ag_gamma_target_system_2_desc"
						event_chain = ag_gamma_guardian_crisis_chain
						location = event_target:ag_gamma_target_loc_2
					}
				}
			}
		}
	}
}

ag_gamma_small_station_3_find_target_action = {
	optimize_memory
	if = {
		limit = { any_system = {
			NOT = { ag_is_ancient_system = yes }
			ag_is_normal_system = yes
			any_system_planet = { is_colony = yes }
			NOR = {
				is_same_value = event_target:ag_gamma_target_loc_1
				is_same_value = event_target:ag_gamma_target_loc_2
				any_system_planet = { OR = {
					is_same_value = event_target:ag_gamma_target_star_loc_1
					is_same_value = event_target:ag_gamma_target_star_loc_2
				} }
			}
		} }
		closest_system = {
			use_bypasses = yes
			limit = {
				NOT = { ag_is_ancient_system = yes }
				ag_is_normal_system = yes
				any_system_planet = { is_colony = yes }
				NOR = {
					is_same_value = event_target:ag_gamma_target_loc_1
					is_same_value = event_target:ag_gamma_target_loc_2
					any_system_planet = {
						OR = {
							is_same_value = event_target:ag_gamma_target_star_loc_1
							is_same_value = event_target:ag_gamma_target_star_loc_2
						}
					}
				}
			}
			random_system_planet = {
				limit = { is_primary_star = yes }
				save_global_event_target_as = ag_gamma_target_star_loc_3
			}
			save_global_event_target_as = ag_gamma_target_loc_3
		}
	}
	if = {
		limit = { exists = event_target:ag_gamma_target_loc_3 }
		event_target:ag_ancient_gamma_guardian_country = {
			if = {
				limit = { any_controlled_fleet = { is_same_value = event_target:ag_gamma_station_small_3 } }
				random_controlled_fleet = {
					limit = { is_same_value = event_target:ag_gamma_station_small_3 }
					queue_actions = {
						repeat = {
							find_closest_system = {
								trigger = {
									id = ag_gamma_station_small_3_fsystem
									is_same_value = event_target:ag_gamma_target_loc_3
								}
								found_system = {
									move_to = this
									find_closest_planet = {
										trigger = {
											id = ag_gamma_station_small_3_fstar
											is_same_value = event_target:ag_gamma_target_star_loc_3
										}
										found_planet = {
											move_to = this
											orbit_planet = this
											wait = 60
											effect = {
												id = ag_gamma_station_small_3_deploy
												prevprev = {
													fleet_event = { id = ag_gamma.353 days = 1 }
													clear_orders = yes
													clear_fleet_actions = this
												}
											}
										}
									}
								}
							}
						}
					}
				}
				every_playable_country = {
					limit = { NOT = { is_same_value = event_target:ag_ancient_gamma_guardian_country } }
					create_point_of_interest = {
						id = ag_gamma_target_system_3
						name = "ag_gamma_target_system_3"
						desc = "ag_gamma_target_system_3_desc"
						event_chain = ag_gamma_guardian_crisis_chain
						location = event_target:ag_gamma_target_loc_3
					}
				}
			}
		}
	}
}

ag_gamma_crisis_fleet_jumpdrive_to_target = {
	optimize_memory
	ag_spawn_jumpdrive_effect = { ag_color = red }
	set_location = { target = prev distance = @ag_gamma_crisis_fleet_jumpdrive_to_target_distance angle = random }
	ag_spawn_jumpdrive_effect = { ag_color = red }
	if = {
		limit = { NOT = { event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } } } }
		every_controlled_ship = {
			set_timed_ship_flag = { flag = ag_jump_drive_cooldown days = 50 }
			add_modifier = { modifier = "ag_jump_drive_cooldown_ancient_ship" days = 50 }
		}
	}
	if = {
		limit = { prev = { is_scope_type = planet } }
		auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes }
	}
	else_if = {
		limit = { prev = { is_scope_type = fleet } }
		auto_follow_fleet = { target = prev attack_fleet = yes }
	}
}

ag_gamma_crisis_fleet_wandering_action = {
	optimize_memory
	clear_orders = yes
	clear_fleet_actions = this
	random_list = {
		60 = {
			solar_system = { random_neighbor_system = { save_event_target_as = ag_gamma_crisis_fleet_wandering_action_target } }
			if = {
				limit = {
					exists = event_target:ag_gamma_crisis_fleet_wandering_action_target
				}
				event_target:ag_gamma_crisis_fleet_wandering_action_target = {
					random_system_planet = {
						limit = {
							is_primary_star = yes
						}
						prevprev = {
							auto_move_to_planet = {
								target = prev
								clear_auto_move_on_arrival = yes
							}
						}
					}
				}
			}
			else = {
				fleet_event = { id = ag_gamma.27 days = 2 random = 5 }
			}
		}
		40 = {
			modifier = {
				factor = 0
				any_controlled_ship = {
					has_ship_flag = ag_jump_drive_cooldown
				}
			}
			modifier = {
				factor = 3
				event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
			}
			random_system = {
				limit = {
					NOT = { is_same_value = prev.solar_system }
					# distance = {
					# 	source = prev.solar_system
					# 	type = hyperlane
					# 	use_bypasses = yes
					# 	min_jumps = 1
					# 	max_jumps = 125
					# }
					NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
					OR = {
						AND = {
							exists = starbase
							starbase = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_ancient_gamma_guardian_country
								}
							}
						}
						any_system_planet = {
							exists = owner
							owner = {
								is_hostile = event_target:ag_ancient_gamma_guardian_country
							}
							OR = {
								is_colony = yes
								is_under_colonization = yes
							}
						}
						any_ship_in_system = {
							is_disabled = no
							is_ship_class = shipclass_military
							exists = owner
							owner = {
								is_hostile = event_target:ag_ancient_gamma_guardian_country
							}
						}
					}
				}
				save_event_target_as = ag_gamma_crisis_fleet_wandering_action_target
			}
			if = {
				limit = {
					exists = event_target:ag_gamma_crisis_fleet_wandering_action_target
				}
				event_target:ag_gamma_crisis_fleet_wandering_action_target = {
					random_system_planet = {
						limit = {
							is_primary_star = yes
						}
						prevprev = {
							ag_gamma_crisis_fleet_jumpdrive_to_target = yes
						}
					}
				}
			}
			else = {
				fleet_event = { id = ag_gamma.27 days = 2 random = 5 }
			}
		}
	}
}

ag_gamma_crisis_fleet_reinforcement_action = {
	optimize_memory
	if = {
		limit = {
			event_target:ag_ancient_gamma_guardian_country = {
				NOT = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_gamma_station_hostile
							is_ship_size = ag_gamma_station_small_hostile
						}
					}
				}
			}
		}
		remove_fleet_flag = ag_ancient_gamma_guardian_need_reinforcement_flag
		fleet_event = { id = ag_gamma.27 days = 2 random = 5 }
	}
	else = {
		closest_system = {
			use_bypasses = yes
			limit = {
				any_ship_in_system = {
					OR = {
						is_ship_size = ag_gamma_station_hostile
						is_ship_size = ag_gamma_station_small_hostile
					}
				}
				prev = { can_access_system = prev }
			}
			save_event_target_as = ag_gamma_crisis_reinforcement_system
		}
		if = {
			limit = {
				exists = event_target:ag_gamma_crisis_reinforcement_system
			}
			event_target:ag_gamma_crisis_reinforcement_system = {
				random_system_planet = {
					limit = {
						is_primary_star = yes
					}
					prevprev = {
						auto_move_to_planet = {
							target = prev
							clear_auto_move_on_arrival = yes
						}
					}
				}
			}
		}
		else = {
			random_system = {
				limit = {
					any_ship_in_system = {
						OR = {
							is_ship_size = ag_gamma_station_hostile
							is_ship_size = ag_gamma_station_small_hostile
						}
					}
				}
				save_event_target_as = ag_gamma_crisis_reinforcement_system
			}
			if = {
				limit = {
					exists = event_target:ag_gamma_crisis_reinforcement_system
				}
				event_target:ag_gamma_crisis_reinforcement_system = {
					random_system_planet = {
						limit = {
							is_primary_star = yes
						}
						prevprev = {
							every_controlled_ship = {
								remove_ship_flag = ag_jump_drive_cooldown
								remove_modifier = "ag_jump_drive_cooldown_ancient_ship"
							}
							ag_gamma_crisis_fleet_jumpdrive_to_target = yes
						}
					}
				}
			}
			else = {
				remove_fleet_flag = ag_ancient_gamma_guardian_need_reinforcement_flag
				fleet_event = { id = ag_gamma.27 days = 2 random = 5 }
			}
		}
	}
}

ag_gamma_crisis_fleet_attack_action = {
	optimize_memory
	if = {
		limit = {
			root = {
				exists = solar_system
				solar_system = {
					any_system_planet = {
						exists = owner
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = {
							any_fleet_in_orbit = {
								exists = owner
								owner = {
									is_same_value = event_target:ag_ancient_gamma_guardian_country
								}
								NOT = { is_same_value = root }
							}
						}
					}
				}
			}
		}
		root = {
			solar_system = {
				random_system_planet = {
					limit = {
						exists = owner
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = {
							any_fleet_in_orbit = {
								exists = owner
								owner = {
									is_same_value = event_target:ag_ancient_gamma_guardian_country
								}
								NOT = { is_same_value = root }
							}
						}
					}
					prevprev = {
						auto_move_to_planet = {
							target = prev
							clear_auto_move_on_arrival = yes
						}
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			root = {
				exists = solar_system
				solar_system = {
					any_ship_in_system = {
						is_disabled = no
						is_ship_class = shipclass_military
						exists = owner
						owner = {
							is_hostile = event_target:ag_ancient_gamma_guardian_country
						}
					}
				}
			}
		}
		root = {
			solar_system = {
				random_fleet_in_system = {
					limit = {
						exists = owner
						owner = {
							is_hostile = event_target:ag_ancient_gamma_guardian_country
						}
						any_controlled_ship = {
							is_disabled = no
							is_ship_class = shipclass_military
						}
					}
					prevprev = {
						auto_follow_fleet = {
							target = prev
							attack_fleet = yes
						}
					}
				}
			}
		}
	}
	else_if = {
		limit = { always = yes }
		random_list = {
			25 = {
				closest_system = {
					use_bypasses = yes
					max_steps = 10
					limit = {
						NOT = { is_same_value = root.solar_system }
						NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
						OR = {
							AND = {
								exists = starbase
								starbase = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_ancient_gamma_guardian_country
									}
								}
							}
							any_system_planet = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_ancient_gamma_guardian_country
								}
								OR = {
									is_colony = yes
									is_under_colonization = yes
								}
								NOT = {
									any_fleet_in_orbit = {
										exists = owner
										owner = {
											is_same_value = event_target:ag_ancient_gamma_guardian_country
										}
										NOT = { is_same_value = root }
									}
								}
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_gamma_crisis_fleet_attack_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_gamma_crisis_fleet_attack_action_target
					}
					event_target:ag_gamma_crisis_fleet_attack_action_target = {
						if = {
							limit = {
								any_system_planet = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_ancient_gamma_guardian_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_ancient_gamma_guardian_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
							}
							random_system_planet = {
								limit = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_ancient_gamma_guardian_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_ancient_gamma_guardian_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
								random_list = {
									90 = {
										prevprev = {
											auto_move_to_planet = {
												target = prev
												clear_auto_move_on_arrival = yes
											}
										}
									}
									10 = {
										modifier = {
											factor = 0
											prevprev = {
												any_controlled_ship = {
													has_ship_flag = ag_jump_drive_cooldown
												}
											}
										}
										prevprev = {
											ag_gamma_crisis_fleet_jumpdrive_to_target = yes
										}
									}
								}
							}
						}
						else = {
							random_system_planet = {
								limit = {
									is_primary_star = yes
								}
								prevprev = {
									auto_move_to_planet = {
										target = prev
										clear_auto_move_on_arrival = yes
									}
								}
							}
						}
					}
				}
				else = {
					closest_system = {
						use_bypasses = yes
						max_steps = 10
						limit = {
							NOT = { is_same_value = root.solar_system }
							NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
							OR = {
								AND = {
									exists = starbase
									starbase = {
										exists = owner
										owner = {
											is_hostile = event_target:ag_ancient_gamma_guardian_country
										}
									}
								}
								any_system_planet = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_ancient_gamma_guardian_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_ancient_gamma_guardian_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
							}
						}
						save_event_target_as = ag_gamma_crisis_fleet_attack_action_target
					}
					if = {
						limit = {
							exists = event_target:ag_gamma_crisis_fleet_attack_action_target
						}
						random_list = {
							75 = {
								modifier = {
									factor = 0
									any_controlled_ship = {
										has_ship_flag = ag_jump_drive_cooldown
									}
								}
								event_target:ag_gamma_crisis_fleet_attack_action_target = {
									if = {
										limit = {
											any_system_planet = {
												exists = owner
												owner = {
													is_hostile = event_target:ag_ancient_gamma_guardian_country
												}
												OR = {
													is_colony = yes
													is_under_colonization = yes
												}
												NOT = {
													any_fleet_in_orbit = {
														exists = owner
														owner = {
															is_same_value = event_target:ag_ancient_gamma_guardian_country
														}
														NOT = { is_same_value = root }
													}
												}
											}
										}
										random_system_planet = {
											limit = {
												exists = owner
												owner = {
													is_hostile = event_target:ag_ancient_gamma_guardian_country
												}
												OR = {
													is_colony = yes
													is_under_colonization = yes
												}
												NOT = {
													any_fleet_in_orbit = {
														exists = owner
														owner = {
															is_same_value = event_target:ag_ancient_gamma_guardian_country
														}
														NOT = { is_same_value = root }
													}
												}
											}
											prevprev = {
												ag_gamma_crisis_fleet_jumpdrive_to_target = yes
											}
										}
									}
									else = {
										random_system_planet = {
											limit = {
												is_primary_star = yes
											}
											prevprev = {
												ag_gamma_crisis_fleet_jumpdrive_to_target = yes
											}
										}
									}
								}
							}
							25 = {
								ag_gamma_crisis_fleet_wandering_action = yes
							}
						}
					}
					else = {
						ag_gamma_crisis_fleet_wandering_action = yes
					}
				}
			}
			25 = {
				random_system = {
					limit = {
						NOT = { is_same_value = root.solar_system }
						NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
						distance = {
							source = root.solar_system
							type = hyperlane
							use_bypasses = yes
							min_jumps = 1
							max_jumps = 10
						}
						OR = {
							AND = {
								exists = starbase
								starbase = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_ancient_gamma_guardian_country
									}
								}
							}
							any_system_planet = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_ancient_gamma_guardian_country
								}
								OR = {
									is_colony = yes
									is_under_colonization = yes
								}
								NOT = {
									any_fleet_in_orbit = {
										exists = owner
										owner = {
											is_same_value = event_target:ag_ancient_gamma_guardian_country
										}
										NOT = { is_same_value = root }
									}
								}
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_gamma_crisis_fleet_attack_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_gamma_crisis_fleet_attack_action_target
					}
					event_target:ag_gamma_crisis_fleet_attack_action_target = {
						if = {
							limit = {
								any_system_planet = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_ancient_gamma_guardian_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_ancient_gamma_guardian_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
							}
							random_system_planet = {
								limit = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_ancient_gamma_guardian_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_ancient_gamma_guardian_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
								random_list = {
									90 = {
										prevprev = {
											auto_move_to_planet = {
												target = prev
												clear_auto_move_on_arrival = yes
											}
										}
									}
									10 = {
										modifier = {
											factor = 0
											prevprev = {
												any_controlled_ship = {
													has_ship_flag = ag_jump_drive_cooldown
												}
											}
										}
										prevprev = {
											ag_gamma_crisis_fleet_jumpdrive_to_target = yes
										}
									}
								}
							}
						}
						else = {
							random_system_planet = {
								limit = {
									is_primary_star = yes
								}
								prevprev = {
									auto_move_to_planet = {
										target = prev
										clear_auto_move_on_arrival = yes
									}
								}
							}
						}
					}
				}
				else = {
					random_system = {
						limit = {
							NOT = { is_same_value = root.solar_system }
							NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
							distance = {
								source = root.solar_system
								type = hyperlane
								use_bypasses = yes
								min_jumps = 1
								max_jumps = 10
							}
							OR = {
								AND = {
									exists = starbase
									starbase = {
										exists = owner
										owner = {
											is_hostile = event_target:ag_ancient_gamma_guardian_country
										}
									}
								}
								any_system_planet = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_ancient_gamma_guardian_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_ancient_gamma_guardian_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
							}
						}
						save_event_target_as = ag_gamma_crisis_fleet_attack_action_target
					}
					if = {
						limit = {
							exists = event_target:ag_gamma_crisis_fleet_attack_action_target
						}
						random_list = {
							75 = {
								modifier = {
									factor = 0
									any_controlled_ship = {
										has_ship_flag = ag_jump_drive_cooldown
									}
								}
								event_target:ag_gamma_crisis_fleet_attack_action_target = {
									if = {
										limit = {
											any_system_planet = {
												exists = owner
												owner = {
													is_hostile = event_target:ag_ancient_gamma_guardian_country
												}
												OR = {
													is_colony = yes
													is_under_colonization = yes
												}
												NOT = {
													any_fleet_in_orbit = {
														exists = owner
														owner = {
															is_same_value = event_target:ag_ancient_gamma_guardian_country
														}
														NOT = { is_same_value = root }
													}
												}
											}
										}
										random_system_planet = {
											limit = {
												exists = owner
												owner = {
													is_hostile = event_target:ag_ancient_gamma_guardian_country
												}
												OR = {
													is_colony = yes
													is_under_colonization = yes
												}
												NOT = {
													any_fleet_in_orbit = {
														exists = owner
														owner = {
															is_same_value = event_target:ag_ancient_gamma_guardian_country
														}
														NOT = { is_same_value = root }
													}
												}
											}
											prevprev = {
												ag_gamma_crisis_fleet_jumpdrive_to_target = yes
											}
										}
									}
									else = {
										random_system_planet = {
											limit = {
												is_primary_star = yes
											}
											prevprev = {
												ag_gamma_crisis_fleet_jumpdrive_to_target = yes
											}
										}
									}
								}
							}
							25 = {
								ag_gamma_crisis_fleet_wandering_action = yes
							}
						}
					}
					else = {
						ag_gamma_crisis_fleet_wandering_action = yes
					}
				}
			}
			25 = {
				closest_system = {
					use_bypasses = yes
					max_steps = 10
					limit = {
						NOT = { is_same_value = root.solar_system }
						NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
						any_ship_in_system = {
							is_disabled = no
							is_ship_class = shipclass_military
							exists = owner
							owner = {
								is_hostile = event_target:ag_ancient_gamma_guardian_country
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_gamma_crisis_fleet_attack_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_gamma_crisis_fleet_attack_action_target
					}
					event_target:ag_gamma_crisis_fleet_attack_action_target = {
						random_fleet_in_system = {
							limit = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_ancient_gamma_guardian_country
								}
								any_controlled_ship = {
									is_disabled = no
									is_ship_class = shipclass_military
								}
							}
							random_list = {
								80 = {
									prevprev = {
										auto_follow_fleet = {
											target = prev
											attack_fleet = yes
										}
									}
								}
								20 = {
									modifier = {
										factor = 0
										prevprev = {
											any_controlled_ship = {
												has_ship_flag = ag_jump_drive_cooldown
											}
										}
									}
									prevprev = {
										ag_gamma_crisis_fleet_jumpdrive_to_target = yes
									}
								}
							}
						}
					}
				}
				else = {
					closest_system = {
						use_bypasses = yes
						max_steps = 10
						limit = {
							NOT = { is_same_value = root.solar_system }
							NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
							any_ship_in_system = {
								is_disabled = no
								is_ship_class = shipclass_military
								exists = owner
								owner = {
									is_hostile = event_target:ag_ancient_gamma_guardian_country
								}
							}
						}
						save_event_target_as = ag_gamma_crisis_fleet_attack_action_target
					}
					if = {
						limit = {
							exists = event_target:ag_gamma_crisis_fleet_attack_action_target
						}
						random_list = {
							75 = {
								modifier = {
									factor = 0
									any_controlled_ship = {
										has_ship_flag = ag_jump_drive_cooldown
									}
								}
								event_target:ag_gamma_crisis_fleet_attack_action_target = {
									random_fleet_in_system = {
										limit = {
											exists = owner
											owner = {
												is_hostile = event_target:ag_ancient_gamma_guardian_country
											}
											any_controlled_ship = {
												is_disabled = no
												is_ship_class = shipclass_military
											}
										}
										random_list = {
											80 = {
												prevprev = {
													auto_follow_fleet = {
														target = prev
														attack_fleet = yes
													}
												}
											}
											20 = {
												modifier = {
													factor = 0
													prevprev = {
														any_controlled_ship = {
															has_ship_flag = ag_jump_drive_cooldown
														}
													}
												}
												prevprev = {
													ag_gamma_crisis_fleet_jumpdrive_to_target = yes
												}
											}
										}
									}
								}
							}
							25 = {
								ag_gamma_crisis_fleet_wandering_action = yes
							}
						}
					}
					else = {
						ag_gamma_crisis_fleet_wandering_action = yes
					}
				}
			}
			25 = {
				random_system = {
					limit = {
						NOT = { is_same_value = root.solar_system }
						NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
						distance = {
							source = root.solar_system
							type = hyperlane
							use_bypasses = yes
							min_jumps = 1
							max_jumps = 10
						}
						any_ship_in_system = {
							is_disabled = no
							is_ship_class = shipclass_military
							exists = owner
							owner = {
								is_hostile = event_target:ag_ancient_gamma_guardian_country
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_gamma_crisis_fleet_attack_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_gamma_crisis_fleet_attack_action_target
					}
					event_target:ag_gamma_crisis_fleet_attack_action_target = {
						random_fleet_in_system = {
							limit = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_ancient_gamma_guardian_country
								}
								any_controlled_ship = {
									is_disabled = no
									is_ship_class = shipclass_military
								}
							}
							random_list = {
								80 = {
									prevprev = {
										auto_follow_fleet = {
											target = prev
											attack_fleet = yes
										}
									}
								}
								20 = {
									modifier = {
										factor = 0
										prevprev = {
											any_controlled_ship = {
												has_ship_flag = ag_jump_drive_cooldown
											}
										}
									}
									prevprev = {
										ag_gamma_crisis_fleet_jumpdrive_to_target = yes
									}
								}
							}
						}
					}
				}
				else = {
					random_system = {
						limit = {
							NOT = { is_same_value = root.solar_system }
							NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
							distance = {
								source = root.solar_system
								type = hyperlane
								use_bypasses = yes
								min_jumps = 1
								max_jumps = 10
							}
							any_ship_in_system = {
								is_disabled = no
								is_ship_class = shipclass_military
								exists = owner
								owner = {
									is_hostile = event_target:ag_ancient_gamma_guardian_country
								}
							}
						}
						save_event_target_as = ag_gamma_crisis_fleet_attack_action_target
					}
					if = {
						limit = {
							exists = event_target:ag_gamma_crisis_fleet_attack_action_target
						}
						random_list = {
							75 = {
								modifier = {
									factor = 0
									any_controlled_ship = {
										has_ship_flag = ag_jump_drive_cooldown
									}
								}
								event_target:ag_gamma_crisis_fleet_attack_action_target = {
									random_fleet_in_system = {
										limit = {
											exists = owner
											owner = {
												is_hostile = event_target:ag_ancient_gamma_guardian_country
											}
											any_controlled_ship = {
												is_disabled = no
												is_ship_class = shipclass_military
											}
										}
										random_list = {
											80 = {
												prevprev = {
													auto_follow_fleet = {
														target = prev
														attack_fleet = yes
													}
												}
											}
											20 = {
												modifier = {
													factor = 0
													prevprev = {
														any_controlled_ship = {
															has_ship_flag = ag_jump_drive_cooldown
														}
													}
												}
												prevprev = {
													ag_gamma_crisis_fleet_jumpdrive_to_target = yes
												}
											}
										}
									}
								}
							}
							25 = {
								ag_gamma_crisis_fleet_wandering_action = yes
							}
						}
					}
					else = {
						ag_gamma_crisis_fleet_wandering_action = yes
					}
				}
			}
		}
	}
}

#################################################
###                                           ###
###                Delta Area                 ###
###                                           ###
#################################################

ag_delta_titan_action = {
	optimize_memory
	queue_actions = {
		repeat = {
			find_closest_planet = {
				trigger = {
					id = ag_ancient_delta_shielded_world
					is_planet = event_target:ag_ancient_delta_shielded_world
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_delta_ring_1
					is_planet = event_target:ag_delta_ring_1
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_delta_ring_2
					is_planet = event_target:ag_delta_ring_2
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_delta_ring_3
					is_planet = event_target:ag_delta_ring_3
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_delta_ring_4
					is_planet = event_target:ag_delta_ring_4
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_delta_ring_5
					is_planet = event_target:ag_delta_ring_5
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_delta_ring_6
					is_planet = event_target:ag_delta_ring_6
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_delta_ring_7
					is_planet = event_target:ag_delta_ring_7
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_delta_ring_8
					is_planet = event_target:ag_delta_ring_8
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_delta_ring_9
					is_planet = event_target:ag_delta_ring_9
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_delta_ring_10
					is_planet = event_target:ag_delta_ring_10
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_delta_ring_11
					is_planet = event_target:ag_delta_ring_11
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
		}
	}
}

#################################################
###                                           ###
###               Epsilon Area                ###
###                                           ###
#################################################

ag_epsilon_titan_action = {
	optimize_memory
	if = {
		limit = { any_system = { has_star_flag = ag_epsilon_titan_target prev = { can_access_system = prev } } }
		ag_epsilon_titan_action_3 = yes
	}
	else_if = {
		limit = { exists = solar_system solar_system = { NOT = { has_star_flag = ag_ancient_epsilon_system } } }
		ag_epsilon_titan_action_4 = yes
	}
	else_if = {
		limit = { OR = {
			AND = {
				exists = event_target:ag_ancient_epsilon_shielded_world
				event_target:ag_ancient_epsilon_shielded_world = {
					is_colony = yes
					num_pops > 0
				}
			}
			AND = {
				exists = event_target:ag_ancient_epsilon_shielded_world_2
				event_target:ag_ancient_epsilon_shielded_world_2 = {
					is_colony = yes
					num_pops > 0
				}
			}
			AND = {
				exists = event_target:ag_ancient_epsilon_shielded_world_3
				event_target:ag_ancient_epsilon_shielded_world_3 = {
					is_colony = yes
					num_pops > 0
				}
			}
		} }
		ag_epsilon_titan_action_2 = yes
	}
	else_if = { limit = { always = yes } ag_epsilon_titan_action_1 = yes }
}
ag_epsilon_titan_action_1 = {
	optimize_memory
	clear_orders = yes
	clear_fleet_actions = this
	queue_actions = {
		repeat = {
			find_closest_planet = {
				trigger = { id = ag_ancient_epsilon_shielded_world is_planet = event_target:ag_ancient_epsilon_shielded_world }
				found_planet = { move_to = this orbit_planet = this }
			}
			find_closest_planet = {
				trigger = { id = ag_epsilon_ring_1 is_planet = event_target:ag_epsilon_ring_1 }
				found_planet = { move_to = this orbit_planet = this }
			}
			find_closest_planet = {
				trigger = { id = ag_epsilon_ring_2 is_planet = event_target:ag_epsilon_ring_2 }
				found_planet = { move_to = this orbit_planet = this }
			}
			find_closest_planet = {
				trigger = { id = ag_epsilon_ring_3 is_planet = event_target:ag_epsilon_ring_3 }
				found_planet = { move_to = this orbit_planet = this }
			}
			find_closest_planet = {
				trigger = { id = ag_epsilon_ring_4 is_planet = event_target:ag_epsilon_ring_4 }
				found_planet = { move_to = this orbit_planet = this }
			}
			find_closest_planet = {
				trigger = { id = ag_epsilon_ring_5 is_planet = event_target:ag_epsilon_ring_5 }
				found_planet = { move_to = this orbit_planet = this }
			}
			find_closest_planet = {
				trigger = { id = ag_epsilon_ring_6 is_planet = event_target:ag_epsilon_ring_6 }
				found_planet = { move_to = this orbit_planet = this }
			}
			find_closest_planet = {
				trigger = { id = ag_epsilon_ring_7 is_planet = event_target:ag_epsilon_ring_7 }
				found_planet = { move_to = this orbit_planet = this }
			}
			find_closest_planet = {
				trigger = { id = ag_epsilon_ring_8 is_planet = event_target:ag_epsilon_ring_8 }
				found_planet = { move_to = this orbit_planet = this }
			}
			find_closest_planet = {
				trigger = { id = ag_epsilon_ring_9 is_planet = event_target:ag_epsilon_ring_9 }
				found_planet = { move_to = this orbit_planet = this }
			}
			find_closest_planet = {
				trigger = { id = ag_epsilon_ring_10 is_planet = event_target:ag_epsilon_ring_10 }
				found_planet = { move_to = this orbit_planet = this }
			}
			find_closest_planet = {
				trigger = { id = ag_epsilon_ring_11 is_planet = event_target:ag_epsilon_ring_11 }
				found_planet = { move_to = this orbit_planet = this }
			}
		}
	}
}
ag_epsilon_titan_action_2 = {
	optimize_memory
	solar_system = {
		random_system_planet = {
			limit = {
				OR = {
					is_same_value = event_target:ag_ancient_epsilon_shielded_world
					is_same_value = event_target:ag_ancient_epsilon_shielded_world_2
					is_same_value = event_target:ag_ancient_epsilon_shielded_world_3
				}
				planet_devastation <= 64
				num_pops > 0
			}
			save_event_target_as = ag_epsilon_titan_bombardment_planet
		}
		if = {
			limit = { NOT = { exists = event_target:ag_epsilon_titan_bombardment_planet } }
			random_system_planet = {
				limit = {
					OR = {
						is_same_value = event_target:ag_ancient_epsilon_shielded_world
						is_same_value = event_target:ag_ancient_epsilon_shielded_world_2
						is_same_value = event_target:ag_ancient_epsilon_shielded_world_3
					}
					num_pops > 0
				}
				save_event_target_as = ag_epsilon_titan_bombardment_planet
			}
			if = {
				limit = { NOT = { exists = event_target:ag_epsilon_titan_bombardment_planet } }
				prev = {
					fleet_event = { id = ag_epsilon.62 days = 10 random = 10 }
					clear_orders = yes
					clear_fleet_actions = this
				}
			}
		}
	}
	if = {
		limit = { exists = event_target:ag_epsilon_titan_bombardment_planet }
		clear_orders = yes
		clear_fleet_actions = this
		auto_move_to_planet = { target = event_target:ag_epsilon_titan_bombardment_planet clear_auto_move_on_arrival = yes }
	}
}
ag_epsilon_titan_action_3 = {
	optimize_memory
	closest_system = {
		limit = { has_star_flag = ag_epsilon_titan_target prev = { can_access_system = prev } }
		use_bypasses = yes
		if = { limit = { exists = event_target:ag_ancient_epsilon_titan_target } clear_global_event_target = ag_ancient_epsilon_titan_target }
		save_global_event_target_as = ag_ancient_epsilon_titan_target
	}
	if = {
		limit = { exists = event_target:ag_ancient_epsilon_titan_target }
		if = { limit = { has_global_flag = ag_epsilon_titan_returning } remove_global_flag = ag_epsilon_titan_returning }
		event_target:ag_ancient_epsilon_titan_target = { every_fleet_in_system = {
			limit = { exists = owner has_fleet_flag = ag_epsilon_titan_target_station_fleet }
			owner = { country_event = { id = ag_epsilon.65 } }
		} }
		clear_orders = yes
		clear_fleet_actions = this
		auto_move_to_planet = { target = event_target:ag_ancient_epsilon_titan_target.star clear_auto_move_on_arrival = yes }
	}
	else = {
		fleet_event = { id = ag_epsilon.62 days = 10 random = 10 }
		clear_orders = yes
		clear_fleet_actions = this
	}
}
ag_epsilon_titan_action_4 = {
	optimize_memory
	clear_orders = yes
	clear_fleet_actions = this
	if = {
		limit = { exists = event_target:ag_ancient_epsilon_star can_access_system = event_target:ag_ancient_epsilon_star.solar_system }
		set_global_flag = ag_epsilon_titan_returning
		every_playable_country = { country_event = { id = ag_epsilon.65 } }
		auto_move_to_planet = { target = event_target:ag_ancient_epsilon_star clear_auto_move_on_arrival = yes }
	}
	else = {
		reroll_random = yes
		random_list = {
			50 = { set_location = event_target:ag_ancient_epsilon_star fleet_event = { id = ag_epsilon.62 days = 2 } }
			50 = {
				if = {
					limit = { solar_system = { any_neighbor_system = { exists = this } } }
					solar_system = { random_neighbor_system = { save_event_target_as = ag_target_system } }
					auto_move_to_planet = { target = event_target:ag_target_system.star clear_auto_move_on_arrival = yes }
					fleet_event = { id = ag_epsilon.62 days = 30 random = 30 }
				}
				else = { set_location = event_target:ag_ancient_epsilon_star fleet_event = { id = ag_epsilon.62 days = 2 } }
			}
		}
	}
}

#################################################
###                                           ###
###                  Eta Area                 ###
###                                           ###
#################################################

ag_eta_titan_jumpdrive_to_target = {
	optimize_memory
	if = { limit = { has_fleet_flag = ag_eta_titan_building_starbase } remove_fleet_flag = ag_eta_titan_building_starbase }
	ag_spawn_jumpdrive_effect = { ag_color = red }
	solar_system = { if = {
		limit = { has_star_flag = ag_eta_titan_in_system }
		remove_star_flag = ag_eta_titan_in_system
		every_system_ambient_object = {
			limit = { has_ambient_object_flag = ag_eta_system_effect_1 }
			destroy_ambient_object = this
		}
	} }
	set_location = { target = prev distance = @ag_eta_titan_jumpdrive_to_target_distance angle = random }
	solar_system = { if = {
		limit = { NOT = { has_star_flag = ag_eta_titan_in_system } }
		set_star_flag = ag_eta_titan_in_system
		if = {
			limit = { NAND = {
				exists = space_owner
				space_owner = { is_same_value = prevprev.owner }
			} }
			random_system_planet = {
				limit = { is_primary_star = yes }
				create_ambient_object = { type = "ag_eta_system_effect_1_object" location = this }
				last_created_ambient_object = {
					set_ambient_object_flag = ag_eta_system_effect_1
					set_location = { target = prev distance = 0 angle = random }
				}
			}
		}
	} }
	ag_spawn_jumpdrive_effect = { ag_color = red }
	if = {
		limit = { NOT = { event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } } } }
		every_controlled_ship = {
			set_timed_ship_flag = { flag = ag_jump_drive_cooldown days = 50 }
			add_modifier = { modifier = "ag_jump_drive_cooldown_ancient_ship" days = 50 }
		}
	}
	if = {
		limit = { prev = { is_scope_type = planet } }
		auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes }
	}
	else_if = {
		limit = { prev = { is_scope_type = fleet } }
		auto_follow_fleet = { target = prev attack_fleet = yes }
	}
	ag_refresh_eta_titans_tracker = yes
	if = {
		limit = { has_global_flag = ag_eta_titan_stage_2 NOT = { has_global_flag = ag_eta_titan_event_ended } }
		while = {
			limit = { count_controlled_ship = {
				limit = { is_ship_size = ag_eta_drone_hostile }
				count < ag_num_eta_titan_drone_escorts
			} }
			create_ship = { name = "NAME_ag_eta_drone_ship" design = "NAME_ag_eta_drone_hostile" prefix = no effect = { ag_difficulty_bonus = yes } }
		}
	}
}

ag_eta_titan_wandering_action = {
	optimize_memory
	clear_orders = yes
	clear_fleet_actions = this
	random_list = {
		60 = {
			solar_system = { random_neighbor_system = { save_event_target_as = ag_eta_titan_wandering_action_target } }
			if = {
				limit = { exists = event_target:ag_eta_titan_wandering_action_target }
				event_target:ag_eta_titan_wandering_action_target.star = { prev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
			}
			else = { fleet_event = { id = ag_eta.31 days = 2 random = 5 } }
		}
		40 = {
			modifier = { factor = 0 any_controlled_ship = { has_ship_flag = ag_jump_drive_cooldown } }
			modifier = { factor = 3 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } } }
			random_system = {
				limit = {
					NOT = { is_same_value = prev.solar_system }
					NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
					OR = {
						AND = { exists = starbase starbase = { exists = owner owner = { is_hostile = root.owner } } }
						any_system_planet = {
							exists = owner owner = { is_hostile = root.owner }
							OR = { is_colony = yes is_under_colonization = yes }
						}
						any_ship_in_system = {
							is_disabled = no
							exists = owner owner = { is_hostile = root.owner }
							OR = {
								is_ship_class = shipclass_military
								is_ship_class = shipclass_military_station
								is_ship_class = shipclass_military_special
							}
						}
					}
				}
				save_event_target_as = ag_eta_titan_wandering_action_target
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_wandering_action_target }
				event_target:ag_eta_titan_wandering_action_target.star = { prev = { ag_eta_titan_jumpdrive_to_target = yes } }
			}
			else = { fleet_event = { id = ag_eta.31 days = 2 random = 5 } }
		}
	}
}

ag_eta_titan_stage_1_action = {
	optimize_memory
	random_list = {
		25 = {
			solar_system = { closest_system = {
				use_bypasses = yes
				max_steps = 20
				limit = {
					NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
					any_system_planet = {
						exists = owner
						owner = { ag_is_common_country = yes NOT = { is_hostile = prevprevprevprev.owner } }
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
					}
					prevprev = { can_access_system = prev }
				}
				save_event_target_as = ag_eta_titan_stage_1_action_target
			} }
			if = {
				limit = { exists = event_target:ag_eta_titan_stage_1_action_target }
				event_target:ag_eta_titan_stage_1_action_target = { random_system_planet = {
					limit = {
						exists = owner
						owner = { ag_is_common_country = yes NOT = { is_hostile = prevprevprev.owner } }
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
					}
					prevprev = { auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					} }
				} }
			}
			else = {
				solar_system = { closest_system = {
					use_bypasses = yes
					max_steps = 20
					limit = { NOT = { has_star_flag = ag_beta_psionic_station_effect_5 } any_system_planet = {
						exists = owner
						owner = { ag_is_common_country = yes NOT = { is_hostile = prevprevprevprev.owner } }
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
					} }
					save_event_target_as = ag_eta_titan_stage_1_action_target
				} }
				if = {
					limit = { exists = event_target:ag_eta_titan_stage_1_action_target }
					event_target:ag_eta_titan_stage_1_action_target = { random_system_planet = {
						limit = {
							exists = owner
							owner = { ag_is_common_country = yes NOT = { is_hostile = prevprevprev.owner } }
							OR = {
								is_colony = yes
								is_under_colonization = yes
							}
							NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
						}
						prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
					} }
				}
				else = { random_system = {
					limit = {
						NOT = { is_same_value = prev.solar_system }
						ag_is_ancient_system = no
					}
					random_system_planet = {
						limit = { is_primary_star = yes }
						prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
					}
				} }
			}
		}
		25 = {
			random_system = {
				limit = {
					NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
					distance = {
						source = prev.solar_system
						type = hyperlane
						min_jumps = 0
						max_jumps = 20
					}
					any_system_planet = {
						exists = owner
						owner = { ag_is_common_country = yes NOT = { is_hostile = prevprevprev.owner } }
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
					}
					prev = { can_access_system = prev }
				}
				save_event_target_as = ag_eta_titan_stage_1_action_target
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_stage_1_action_target }
				event_target:ag_eta_titan_stage_1_action_target = { random_system_planet = {
					limit = {
						exists = owner
						owner = { ag_is_common_country = yes NOT = { is_hostile = prevprevprev.owner } }
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
					}
					prevprev = { auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					} }
				} }
			}
			else = {
				random_system = {
					limit = {
						NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
						distance = {
							source = prev.solar_system
							type = hyperlane
							min_jumps = 0
							max_jumps = 20
						}
						any_system_planet = {
							exists = owner
							owner = { ag_is_common_country = yes NOT = { is_hostile = prevprevprev.owner } }
							OR = {
								is_colony = yes
								is_under_colonization = yes
							}
							NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
						}
					}
					save_event_target_as = ag_eta_titan_stage_1_action_target
				}
				if = {
					limit = { exists = event_target:ag_eta_titan_stage_1_action_target }
					event_target:ag_eta_titan_stage_1_action_target = { random_system_planet = {
						limit = {
							exists = owner
							owner = { ag_is_common_country = yes NOT = { is_hostile = prevprevprev.owner } }
							OR = {
								is_colony = yes
								is_under_colonization = yes
							}
							NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
						}
						prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
					} }
				}
				else = { random_system = {
					limit = {
						NOT = { is_same_value = prev.solar_system }
						ag_is_ancient_system = no
					}
					random_system_planet = {
						limit = { is_primary_star = yes }
						prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
					}
				} }
			}
		}
		25 = {
			solar_system = { closest_system = {
				use_bypasses = yes
				max_steps = 20
				limit = {
					NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
					any_system_planet = {
						exists = owner
						owner = { is_ai = no NOT = { is_hostile = prevprevprevprev.owner } }
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
					}
					prevprev = { can_access_system = prev }
				}
				save_event_target_as = ag_eta_titan_stage_1_action_target
			} }
			if = {
				limit = { exists = event_target:ag_eta_titan_stage_1_action_target }
				event_target:ag_eta_titan_stage_1_action_target = { random_system_planet = {
					limit = {
						exists = owner
						owner = { is_ai = no NOT = { is_hostile = prevprevprev.owner } }
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
					}
					prevprev = { auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					} }
				} }
			}
			else = {
				solar_system = { closest_system = {
					use_bypasses = yes
					max_steps = 20
					limit = { NOT = { has_star_flag = ag_beta_psionic_station_effect_5 } any_system_planet = {
						exists = owner
						owner = { is_ai = no NOT = { is_hostile = prevprevprevprev.owner } }
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
					} }
					save_event_target_as = ag_eta_titan_stage_1_action_target
				} }
				if = {
					limit = { exists = event_target:ag_eta_titan_stage_1_action_target }
					event_target:ag_eta_titan_stage_1_action_target = { random_system_planet = {
						limit = {
							exists = owner
							owner = { is_ai = no NOT = { is_hostile = prevprevprev.owner } }
							OR = {
								is_colony = yes
								is_under_colonization = yes
							}
							NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
						}
						prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
					} }
				}
				else = { random_system = {
					limit = {
						NOT = { is_same_value = prev.solar_system }
						ag_is_ancient_system = no
					}
					random_system_planet = {
						limit = { is_primary_star = yes }
						prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
					}
				} }
			}
		}
		25 = {
			random_system = {
				limit = {
					NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
					distance = {
						source = prev.solar_system
						type = hyperlane
						min_jumps = 0
						max_jumps = 20
					}
					any_system_planet = {
						exists = owner
						owner = { is_ai = no NOT = { is_hostile = prevprevprev.owner } }
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
					}
					prev = { can_access_system = prev }
				}
				save_event_target_as = ag_eta_titan_stage_1_action_target
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_stage_1_action_target }
				event_target:ag_eta_titan_stage_1_action_target = { random_system_planet = {
					limit = {
						exists = owner
						owner = { is_ai = no NOT = { is_hostile = prevprevprev.owner } }
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
					}
					prevprev = { auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					} }
				} }
			}
			else = {
				random_system = {
					limit = {
						NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
						distance = {
							source = prev.solar_system
							type = hyperlane
							min_jumps = 0
							max_jumps = 20
						}
						any_system_planet = {
							exists = owner
							owner = { is_ai = no NOT = { is_hostile = prevprevprev.owner } }
							OR = {
								is_colony = yes
								is_under_colonization = yes
							}
							NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
						}
					}
					save_event_target_as = ag_eta_titan_stage_1_action_target
				}
				if = {
					limit = { exists = event_target:ag_eta_titan_stage_1_action_target }
					event_target:ag_eta_titan_stage_1_action_target = { random_system_planet = {
						limit = {
							exists = owner
							owner = { is_ai = no NOT = { is_hostile = prevprevprev.owner } }
							OR = {
								is_colony = yes
								is_under_colonization = yes
							}
							NOT = { has_planet_flag = ag_eta_titan_scanned_planet }
						}
						prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
					} }
				}
				else = { random_system = {
					limit = {
						NOT = { is_same_value = prev.solar_system }
						ag_is_ancient_system = no
					}
					random_system_planet = {
						limit = { is_primary_star = yes }
						prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
					}
				} }
			}
		}
	}
}
ag_eta_titan_stage_2_action = {
	optimize_memory
	if = {
		limit = { exists = solar_system }
		if = {
			limit = { has_fleet_flag = ag_eta_titan_building_starbase }
			solar_system.star = { prev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
		}
		else_if = {
			limit = { solar_system = { any_system_planet = {
				exists = owner
				OR = { is_colony = yes is_under_colonization = yes }
				NOT = { any_fleet_in_orbit = {
					exists = owner
					owner = { is_same_value = root.owner }
					NOT = { is_same_value = root }
				} }
			} } }
			solar_system = { random_system_planet = {
				limit = {
					exists = owner
					OR = { is_colony = yes is_under_colonization = yes }
					NOT = { any_fleet_in_orbit = {
						exists = owner owner = { is_same_value = root.owner }
						NOT = { is_same_value = root }
					} }
				}
				prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } }
			} }
		}
		else_if = {
			limit = { solar_system = { any_ship_in_system = {
				is_disabled = no is_ship_class = shipclass_military
				exists = owner owner = { is_hostile = root.owner }
			} } }
			solar_system = { random_fleet_in_system = {
				limit = {
					exists = owner owner = { is_hostile = root.owner }
					any_controlled_ship = { is_disabled = no is_ship_class = shipclass_military }
				}
				prevprev = { auto_follow_fleet = { target = prev attack_fleet = yes } }
			} }
		}
		else_if = {
			limit = { solar_system = { NAND = { exists = space_owner space_owner = { is_same_value = root.owner } } } }
			auto_move_to_planet = { target = solar_system.star clear_auto_move_on_arrival = yes }
		}
		else_if = {
			limit = { solar_system = { any_neighbor_system = {
				has_hyperlane_to = prev.solar_system
				NAND = { exists = space_owner space_owner = { is_same_value = root.owner } }
			} } }
			solar_system = { random_neighbor_system = {
				limit = {
					has_hyperlane_to = prev.solar_system
					NAND = { exists = space_owner space_owner = { is_same_value = root.owner } }
				}
				if = {
					limit = { any_system_planet = {
						exists = owner owner = { is_hostile = root.owner }
						OR = { is_colony = yes is_under_colonization = yes }
						NOT = { any_fleet_in_orbit = {
							exists = owner
							owner = { is_same_value = root.owner }
							NOT = { is_same_value = root }
						} }
					} }
					random_system_planet = {
						limit = {
							exists = owner owner = { is_hostile = root.owner }
							OR = { is_colony = yes is_under_colonization = yes }
							NOT = { any_fleet_in_orbit = {
								exists = owner
								owner = { is_same_value = root.owner }
								NOT = { is_same_value = root }
							} }
						}
						prevprevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } }
					}
				}
				else = { random_system_planet = {
					limit = { is_primary_star = yes }
					prevprevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } }
				} }
			} }
		}
		else_if = {
			limit = { always = yes }
			owner = { random_system_within_border = {
				limit = { any_neighbor_system = { has_hyperlane_to = prev NAND = { exists = space_owner space_owner = { is_same_value = root.owner } } } }
				save_event_target_as = ag_eta_titan_stage_2_action_target
			} }
			if = {
				limit = { exists = event_target:ag_eta_titan_stage_2_action_target }
				event_target:ag_eta_titan_stage_2_action_target.star = { prev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
			}
			else = { random_list = {
				25 = {
					solar_system = { closest_system = {
						use_bypasses = yes
						max_steps = 10
						limit = {
							NOT = { is_same_value = root.solar_system }
							NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
							OR = {
								AND = { exists = starbase starbase = { exists = owner owner = { is_hostile = root.owner } } }
								any_system_planet = {
									exists = owner owner = { is_hostile = root.owner }
									OR = { is_colony = yes is_under_colonization = yes }
									NOT = { any_fleet_in_orbit = {
										exists = owner
										owner = { is_same_value = root.owner }
										NOT = { is_same_value = root }
									} }
								}
							}
							prevprev = { can_access_system = prev }
						}
						save_event_target_as = ag_eta_titan_stage_2_action_target
					} }
					if = {
						limit = { exists = event_target:ag_eta_titan_stage_2_action_target }
						event_target:ag_eta_titan_stage_2_action_target = {
							if = {
								limit = { any_system_planet = {
									exists = owner owner = { is_hostile = root.owner }
									OR = { is_colony = yes is_under_colonization = yes }
									NOT = { any_fleet_in_orbit = {
										exists = owner
										owner = { is_same_value = root.owner }
										NOT = { is_same_value = root }
									} }
								} }
								random_system_planet = {
									limit = {
										exists = owner owner = { is_hostile = root.owner }
										OR = { is_colony = yes is_under_colonization = yes }
										NOT = { any_fleet_in_orbit = {
											exists = owner
											owner = { is_same_value = root.owner }
											NOT = { is_same_value = root }
										} }
									}
									random_list = {
										95 = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
										10 = {
											modifier = { factor = 0 prevprev = { any_controlled_ship = { has_ship_flag = ag_jump_drive_cooldown } } }
											prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
										}
									}
									reroll_random = yes
								}
							}
							else = { random_system_planet = {
								limit = { is_primary_star = yes }
								random_list = {
									95 = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
									10 = {
										modifier = { factor = 0 prevprev = { any_controlled_ship = { has_ship_flag = ag_jump_drive_cooldown } } }
										prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
									}
								}
								reroll_random = yes
							} }
						}
					}
					else = {
						solar_system = { closest_system = {
							use_bypasses = yes
							max_steps = 10
							limit = {
								NOT = { is_same_value = root.solar_system }
								NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
								OR = {
									AND = { exists = starbase starbase = { exists = owner owner = { is_hostile = root.owner } } }
									any_system_planet = {
										exists = owner owner = { is_hostile = root.owner }
										OR = { is_colony = yes is_under_colonization = yes }
										NOT = { any_fleet_in_orbit = {
											exists = owner
											owner = { is_same_value = root.owner }
											NOT = { is_same_value = root }
										} }
									}
								}
							}
							save_event_target_as = ag_eta_titan_stage_2_action_target
						} }
						if = {
							limit = { exists = event_target:ag_eta_titan_stage_2_action_target }
							event_target:ag_eta_titan_stage_2_action_target = {
								if = {
									limit = { any_system_planet = {
										exists = owner owner = { is_hostile = root.owner }
										OR = { is_colony = yes is_under_colonization = yes }
										NOT = { any_fleet_in_orbit = {
											exists = owner
											owner = { is_same_value = root.owner }
											NOT = { is_same_value = root }
										} }
									} }
									random_system_planet = {
										limit = {
											exists = owner owner = { is_hostile = root.owner }
											OR = { is_colony = yes is_under_colonization = yes }
											NOT = { any_fleet_in_orbit = {
												exists = owner
												owner = { is_same_value = root.owner }
												NOT = { is_same_value = root }
											} }
										}
										random_list = {
											75 = { prevprev = { ag_eta_titan_wandering_action = yes } }
											25 = {
												modifier = { factor = 0 prevprev = { any_controlled_ship = { has_ship_flag = ag_jump_drive_cooldown } } }
												prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
											}
										}
										reroll_random = yes
									}
								}
								else = { random_system_planet = {
									limit = { is_primary_star = yes }
									random_list = {
										75 = { prevprev = { ag_eta_titan_wandering_action = yes } }
										25 = {
											modifier = { factor = 0 prevprev = { any_controlled_ship = { has_ship_flag = ag_jump_drive_cooldown } } }
											prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
										}
									}
									reroll_random = yes
								} }
							}
						}
						else = { ag_eta_titan_wandering_action = yes }
					}
				}
				25 = {
					random_system = {
						limit = {
							distance = { source = root.solar_system type = hyperlane use_bypasses = yes min_jumps >= 0 max_jumps <= 10 }
							NOT = { is_same_value = root.solar_system }
							NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
							OR = {
								AND = { exists = starbase starbase = { exists = owner owner = { is_hostile = root.owner } } }
								any_system_planet = {
									exists = owner owner = { is_hostile = root.owner }
									OR = { is_colony = yes is_under_colonization = yes }
									NOT = { any_fleet_in_orbit = {
										exists = owner
										owner = { is_same_value = root.owner }
										NOT = { is_same_value = root }
									} }
								}
							}
							prev = { can_access_system = prev }
						}
						save_event_target_as = ag_eta_titan_stage_2_action_target
					}
					if = {
						limit = { exists = event_target:ag_eta_titan_stage_2_action_target }
						event_target:ag_eta_titan_stage_2_action_target = {
							if = {
								limit = { any_system_planet = {
									exists = owner owner = { is_hostile = root.owner }
									OR = { is_colony = yes is_under_colonization = yes }
									NOT = { any_fleet_in_orbit = {
										exists = owner
										owner = { is_same_value = root.owner }
										NOT = { is_same_value = root }
									} }
								} }
								random_system_planet = {
									limit = {
										exists = owner owner = { is_hostile = root.owner }
										OR = { is_colony = yes is_under_colonization = yes }
										NOT = { any_fleet_in_orbit = {
											exists = owner
											owner = { is_same_value = root.owner }
											NOT = { is_same_value = root }
										} }
									}
									random_list = {
										95 = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
										10 = {
											modifier = { factor = 0 prevprev = { any_controlled_ship = { has_ship_flag = ag_jump_drive_cooldown } } }
											prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
										}
									}
									reroll_random = yes
								}
							}
							else = { random_system_planet = {
								limit = { is_primary_star = yes }
								random_list = {
									95 = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
									10 = {
										modifier = { factor = 0 prevprev = { any_controlled_ship = { has_ship_flag = ag_jump_drive_cooldown } } }
										prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
									}
								}
								reroll_random = yes
							} }
						}
					}
					else = {
						random_system = {
							limit = {
								distance = { source = root.solar_system type = hyperlane use_bypasses = yes min_jumps >= 0 max_jumps <= 10 }
								NOT = { is_same_value = root.solar_system }
								NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
								OR = {
									AND = { exists = starbase starbase = { exists = owner owner = { is_hostile = root.owner } } }
									any_system_planet = {
										exists = owner owner = { is_hostile = root.owner }
										OR = { is_colony = yes is_under_colonization = yes }
										NOT = { any_fleet_in_orbit = {
											exists = owner
											owner = { is_same_value = root.owner }
											NOT = { is_same_value = root }
										} }
									}
								}
							}
							save_event_target_as = ag_eta_titan_stage_2_action_target
						}
						if = {
							limit = { exists = event_target:ag_eta_titan_stage_2_action_target }
							event_target:ag_eta_titan_stage_2_action_target = {
								if = {
									limit = { any_system_planet = {
										exists = owner owner = { is_hostile = root.owner }
										OR = { is_colony = yes is_under_colonization = yes }
										NOT = { any_fleet_in_orbit = {
											exists = owner
											owner = { is_same_value = root.owner }
											NOT = { is_same_value = root }
										} }
									} }
									random_system_planet = {
										limit = {
											exists = owner owner = { is_hostile = root.owner }
											OR = { is_colony = yes is_under_colonization = yes }
											NOT = { any_fleet_in_orbit = {
												exists = owner
												owner = { is_same_value = root.owner }
												NOT = { is_same_value = root }
											} }
										}
										random_list = {
											75 = { prevprev = { ag_eta_titan_wandering_action = yes } }
											25 = {
												modifier = { factor = 0 prevprev = { any_controlled_ship = { has_ship_flag = ag_jump_drive_cooldown } } }
												prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
											}
										}
										reroll_random = yes
									}
								}
								else = { random_system_planet = {
									limit = { is_primary_star = yes }
									random_list = {
										75 = { prevprev = { ag_eta_titan_wandering_action = yes } }
										25 = {
											modifier = { factor = 0 prevprev = { any_controlled_ship = { has_ship_flag = ag_jump_drive_cooldown } } }
											prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
										}
									}
									reroll_random = yes
								} }
							}
						}
						else = { ag_eta_titan_wandering_action = yes }
					}
				}
				25 = {
					solar_system = { closest_system = {
						use_bypasses = yes
						max_steps = 10
						limit = {
							NOT = { is_same_value = root.solar_system }
							NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
							any_ship_in_system = {
								is_disabled = no
								OR = {
									is_ship_class = shipclass_military
									is_ship_class = shipclass_military_station
									is_ship_class = shipclass_military_special
								}
								exists = owner owner = { is_hostile = root.owner }
							}
							prevprev = { can_access_system = prev }
						}
						save_event_target_as = ag_eta_titan_stage_2_action_target
					} }
					if = {
						limit = { exists = event_target:ag_eta_titan_stage_2_action_target }
						event_target:ag_eta_titan_stage_2_action_target = { random_fleet_in_system = {
							limit = {
								exists = owner owner = { is_hostile = root.owner }
								any_controlled_ship = {
									is_disabled = no
									OR = {
										is_ship_class = shipclass_military
										is_ship_class = shipclass_military_station
										is_ship_class = shipclass_military_special
									}
								}
							}
							random_list = {
								95 = { prevprev = { auto_follow_fleet = { target = prev attack_fleet = yes } } }
								5 = {
									modifier = { factor = 0 prevprev = { any_controlled_ship = { has_ship_flag = ag_jump_drive_cooldown } } }
									prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
								}
							}
							reroll_random = yes
						} }
					}
					else = { ag_eta_titan_wandering_action = yes }
				}
				25 = {
					random_system = {
						limit = {
							distance = { source = root.solar_system type = hyperlane use_bypasses = yes min_jumps >= 0 max_jumps <= 10 }
							NOT = { is_same_value = root.solar_system }
							NOT = { has_star_flag = ag_beta_psionic_station_effect_5 }
							any_ship_in_system = {
								is_disabled = no
								OR = {
									is_ship_class = shipclass_military
									is_ship_class = shipclass_military_station
									is_ship_class = shipclass_military_special
								}
								exists = owner owner = { is_hostile = root.owner }
							}
							prev = { can_access_system = prev }
						}
						save_event_target_as = ag_eta_titan_stage_2_action_target
					}
					if = {
						limit = { exists = event_target:ag_eta_titan_stage_2_action_target }
						event_target:ag_eta_titan_stage_2_action_target = { random_fleet_in_system = {
							limit = {
								exists = owner owner = { is_hostile = root.owner }
								any_controlled_ship = {
									is_disabled = no
									OR = {
										is_ship_class = shipclass_military
										is_ship_class = shipclass_military_station
										is_ship_class = shipclass_military_special
									}
								}
							}
							random_list = {
								95 = { prevprev = { auto_follow_fleet = { target = prev attack_fleet = yes } } }
								5 = {
									modifier = { factor = 0 prevprev = { any_controlled_ship = { has_ship_flag = ag_jump_drive_cooldown } } }
									prevprev = { ag_eta_titan_jumpdrive_to_target = yes }
								}
							}
							reroll_random = yes
						} }
					}
					else = { ag_eta_titan_wandering_action = yes }
				}
			} reroll_random = yes }
		}
	}
	else = { fleet_event = { id = ag_eta.31 days = 5 random = 5 } }
}
ag_eta_titan_event_ended_action = {
	optimize_memory
	random_list = {
		50 = {
			solar_system = { closest_system = {
				use_bypasses = yes
				max_steps = 128
				limit = {
					NOR = {
						is_same_value = root.solar_system
						has_star_flag = ag_beta_psionic_station_effect_5
						has_star_flag = ag_eta_titan_recently_visited
					}
					prevprev = { can_access_system = prev }
				}
				save_event_target_as = ag_eta_titan_event_ended_action_target
			} }
			if = {
				limit = { exists = event_target:ag_eta_titan_event_ended_action_target }
				event_target:ag_eta_titan_event_ended_action_target.star = { prev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
			}
			else = { ag_eta_titan_wandering_action = yes }
		}
		50 = {
			random_system = {
				limit = {
					NOR = {
						is_same_value = root.solar_system
						has_star_flag = ag_beta_psionic_station_effect_5
						has_star_flag = ag_eta_titan_recently_visited
					}
					prev = { can_access_system = prev }
				}
				save_event_target_as = ag_eta_titan_event_ended_action_target
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_event_ended_action_target }
				event_target:ag_eta_titan_event_ended_action_target.star = { prev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
			}
			else = { ag_eta_titan_wandering_action = yes }
		}
	}
	reroll_random = yes
}

#################################################
###                                           ###
###                 Zeta Area                 ###
###                                           ###
#################################################

ag_zeta_titan_action_0 = {
	optimize_memory
	queue_actions = {
		repeat = {
			find_closest_planet = {
				trigger = {
					id = ag_ancient_zeta_shielded_world_a
					is_planet = event_target:ag_ancient_zeta_shielded_world
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_1_a
					is_planet = event_target:ag_zeta_ring_1
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_2_a
					is_planet = event_target:ag_zeta_ring_2
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_3_a
					is_planet = event_target:ag_zeta_ring_3
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_4_a
					is_planet = event_target:ag_zeta_ring_4
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_5_a
					is_planet = event_target:ag_zeta_ring_5
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_6_a
					is_planet = event_target:ag_zeta_ring_6
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_7_a
					is_planet = event_target:ag_zeta_ring_7
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_8_a
					is_planet = event_target:ag_zeta_ring_8
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_9_a
					is_planet = event_target:ag_zeta_ring_9
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_10_a
					is_planet = event_target:ag_zeta_ring_10
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_11_a
					is_planet = event_target:ag_zeta_ring_11
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
		}
	}
}

ag_zeta_titan_action_1 = {
	optimize_memory
	queue_actions = {
		repeat = {
			find_closest_planet = {
				trigger = {
					id = ag_ancient_zeta_shielded_world_b
					is_planet = event_target:ag_ancient_zeta_shielded_world
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_1_b
					is_planet = event_target:ag_zeta_ring_1
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_2_b
					is_planet = event_target:ag_zeta_ring_2
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_3_b
					is_planet = event_target:ag_zeta_ring_3
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_4_b
					is_planet = event_target:ag_zeta_ring_4
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_5_b
					is_planet = event_target:ag_zeta_ring_5
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_6_b
					is_planet = event_target:ag_zeta_ring_6
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_7_b
					is_planet = event_target:ag_zeta_ring_7
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_8_b
					is_planet = event_target:ag_zeta_ring_8
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_9_b
					is_planet = event_target:ag_zeta_ring_9
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_10_b
					is_planet = event_target:ag_zeta_ring_10
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_zeta_ring_11_b
					is_planet = event_target:ag_zeta_ring_11
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
		}
	}
}

ag_zeta_crisis_jumpdrive_to_target = {
	optimize_memory
	ag_spawn_psi_jumpdrive_effect = yes
	set_location = {
		target = prev
		distance = @ag_zeta_crisis_fleet_jumpdrive_to_target_distance
		angle = random
	}
	ag_spawn_psi_jumpdrive_effect = yes
	if = {
		limit = {
			NOT = {
				event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
			}
		}
		every_controlled_ship = {
			set_timed_ship_flag = {
				flag = ag_jump_drive_cooldown
				days = 40
			}
			add_modifier = {
				modifier = "ag_jump_drive_cooldown_ancient_ship"
				days = 40
			}
		}
	}
	if = {
		limit = {
			prev = {
				is_scope_type = planet
			}
		}
		auto_move_to_planet = {
			target = prev
			clear_auto_move_on_arrival = yes
		}
	}
	else_if = {
		limit = {
			prev = {
				is_scope_type = fleet
			}
		}
		auto_follow_fleet = {
			target = prev
			attack_fleet = yes
		}
	}
}

ag_zeta_crisis_ship_wandering_action = {
	optimize_memory
	clear_orders = yes
	clear_fleet_actions = this
	random_list = {
		50 = {
			solar_system = {
				random_neighbor_system = {
					save_event_target_as = ag_zeta_crisis_ship_wandering_action_target
				}
			}
			if = {
				limit = {
					exists = event_target:ag_zeta_crisis_ship_wandering_action_target
					NOT = {
						has_fleet_flag = ag_zeta_crisis_construction_ship_fleet
					}
				}
				event_target:ag_zeta_crisis_ship_wandering_action_target = {
					random_system_planet = {
						limit = {
							is_primary_star = yes
						}
						prevprev = {
							auto_move_to_planet = {
								target = prev
								clear_auto_move_on_arrival = yes
							}
						}
					}
				}
			}
			else = {
				switch = {
					trigger = has_fleet_flag
					ag_zeta_crisis_assault_fleet = {
						fleet_event = { id = ag_zeta_crisis.71 days = 10 random = 2 }
					}
					ag_zeta_crisis_patrol_fleet = {
						fleet_event = { id = ag_zeta_crisis.72 days = 10 random = 2 }
					}
					ag_zeta_crisis_protector_fleet = {
						fleet_event = { id = ag_zeta_crisis.73 days = 10 random = 2 }
					}
					ag_zeta_crisis_construction_ship_fleet = {
						fleet_event = { id = ag_zeta_crisis.81 days = 10 random = 2 }
					}
				}
			}
		}
		50 = {
			modifier = {
				factor = 3
				event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
			}
			modifier = {
				factor = 0
				any_controlled_ship = {
					has_ship_flag = ag_jump_drive_cooldown
				}
			}
			if = {
				limit = {
					has_fleet_flag = ag_zeta_crisis_assault_fleet
				}
				random_system = {
					limit = {
						NOT = { is_same_value = prev.solar_system }
						# distance = {
						# 	source = prev.solar_system
						# 	type = hyperlane
						# 	use_bypasses = yes
						# 	min_jumps = 1
						# 	max_jumps = 125
						# }
						OR = {
							AND = {
								exists = starbase
								starbase = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
								}
							}
							any_system_planet = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_zeta_crisis_country
								}
								OR = {
									is_colony = yes
									is_under_colonization = yes
								}
							}
							any_ship_in_system = {
								is_disabled = no
								is_ship_class = shipclass_military
								exists = owner
								owner = {
									is_hostile = event_target:ag_zeta_crisis_country
								}
							}
						}
					}
					save_event_target_as = ag_zeta_crisis_ship_wandering_action_target
				}
			}
			else = {
				random_system = {
					limit = {
						NOT = { is_same_value = prev.solar_system }
						# distance = {
						# 	source = prev.solar_system
						# 	type = hyperlane
						# 	use_bypasses = yes
						# 	min_jumps = 1
						# 	max_jumps = 125
						# }
						exists = starbase
						starbase = {
							owner = {
								is_country_type = ag_zeta_crisis_country
							}
						}
					}
					save_event_target_as = ag_zeta_crisis_ship_wandering_action_target
				}
			}
			if = {
				limit = {
					exists = event_target:ag_zeta_crisis_ship_wandering_action_target
					NOT = {
						has_fleet_flag = ag_zeta_crisis_construction_ship_fleet
					}
				}
				event_target:ag_zeta_crisis_ship_wandering_action_target = {
					random_system_planet = {
						limit = {
							is_primary_star = yes
						}
						prevprev = {
							ag_zeta_crisis_jumpdrive_to_target = yes
						}
					}
				}
			}
			else = {
				switch = {
					trigger = has_fleet_flag
					ag_zeta_crisis_assault_fleet = {
						fleet_event = { id = ag_zeta_crisis.71 days = 10 random = 2 }
					}
					ag_zeta_crisis_patrol_fleet = {
						fleet_event = { id = ag_zeta_crisis.72 days = 10 random = 2 }
					}
					ag_zeta_crisis_protector_fleet = {
						fleet_event = { id = ag_zeta_crisis.73 days = 10 random = 2 }
					}
					ag_zeta_crisis_construction_ship_fleet = {
						fleet_event = { id = ag_zeta_crisis.81 days = 10 random = 2 }
					}
				}
			}
		}
	}
}
ag_zeta_crisis_assault_fleet_action = {
	optimize_memory
	if = {
		limit = {
			root = {
				exists = solar_system
				solar_system = {
					any_system_planet = {
						exists = owner
						owner = {
							is_hostile = event_target:ag_zeta_crisis_country
						}
						exists = controller
						controller = {
							is_hostile = event_target:ag_zeta_crisis_country
						}
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = {
							any_fleet_in_orbit = {
								exists = owner
								owner = {
									is_same_value = event_target:ag_zeta_crisis_country
								}
								NOT = { is_same_value = root }
							}
						}
					}
				}
			}
		}
		root.solar_system = {
			random_system_planet = {
				limit = {
					exists = owner
					owner = {
						is_hostile = event_target:ag_zeta_crisis_country
					}
					exists = controller
					controller = {
						is_hostile = event_target:ag_zeta_crisis_country
					}
					OR = {
						is_colony = yes
						is_under_colonization = yes
					}
					NOT = {
						any_fleet_in_orbit = {
							exists = owner
							owner = {
								is_same_value = event_target:ag_zeta_crisis_country
							}
							NOT = { is_same_value = root }
						}
					}
				}
				prevprev = {
					auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			root = {
				exists = solar_system
				solar_system = {
					any_ship_in_system = {
						is_disabled = no
						is_ship_class = shipclass_military
						exists = owner
						owner = {
							is_hostile = event_target:ag_zeta_crisis_country
						}
					}
				}
			}
		}
		root.solar_system = {
			random_fleet_in_system = {
				limit = {
					exists = owner
					owner = {
						is_hostile = event_target:ag_zeta_crisis_country
					}
					any_controlled_ship = {
						is_disabled = no
						is_ship_class = shipclass_military
					}
				}
				prevprev = {
					auto_follow_fleet = {
						target = prev
						attack_fleet = yes
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			root = { exists = solar_system }
			root.solar_system = {
				has_star_flag = ag_ancient_zeta_system
			}
			any_system = {
				NOT = {
					has_star_flag = ag_ancient_zeta_system
				}
				any_ship_in_system = {
					is_ship_size = ag_zeta_crisis_portal
				}
			}
		}
		random_system = {
			limit = {
				NOT = {
					has_star_flag = ag_ancient_zeta_system
				}
				any_ship_in_system = {
					is_ship_size = ag_zeta_crisis_portal
				}
			}
			random_system_planet = {
				limit = {
					is_primary_star = yes
				}
				prevprev = {
					auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			root = { exists = solar_system }
			root.solar_system = {
				any_neighbor_system = {
					exists = starbase
					starbase = {
						exists = owner
						owner = {
							is_hostile = event_target:ag_zeta_crisis_country
						}
					}
				}
			}
		}
		root.solar_system = {
			random_neighbor_system = {
				limit = {
					exists = starbase
					starbase = {
						exists = owner
						owner = {
							is_hostile = event_target:ag_zeta_crisis_country
						}
					}
				}
				random_system_planet = {
					limit = {
						is_primary_star = yes
					}
					prevprevprev = {
						auto_move_to_planet = {
							target = prev
							clear_auto_move_on_arrival = yes
						}
					}
				}
			}
		}
	}
	else_if = {
		limit = { always = yes }
		random_list = {
			25 = {
				closest_system = {
					use_bypasses = yes
					max_steps = 15
					limit = {
						NOT = { is_same_value = root.solar_system }
						OR = {
							AND = {
								exists = starbase
								starbase = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
								}
							}
							any_system_planet = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_zeta_crisis_country
								}
								exists = controller
								controller = {
									is_hostile = event_target:ag_zeta_crisis_country
								}
								OR = {
									is_colony = yes
									is_under_colonization = yes
								}
								NOT = {
									any_fleet_in_orbit = {
										exists = owner
										owner = {
											is_same_value = event_target:ag_zeta_crisis_country
										}
										NOT = { is_same_value = root }
									}
								}
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_zeta_crisis_assault_fleet_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_zeta_crisis_assault_fleet_action_target
					}
					event_target:ag_zeta_crisis_assault_fleet_action_target = {
						if = {
							limit = {
								any_system_planet = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
									exists = controller
									controller = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_zeta_crisis_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
							}
							random_system_planet = {
								limit = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
									exists = controller
									controller = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_zeta_crisis_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
								random_list = {
									80 = {
										prevprev = {
											auto_move_to_planet = {
												target = prev
												clear_auto_move_on_arrival = yes
											}
										}
									}
									20 = {
										modifier = {
											factor = 0
											prevprev = {
												any_controlled_ship = {
													has_ship_flag = ag_jump_drive_cooldown
												}
											}
										}
										prevprev = {
											ag_zeta_crisis_jumpdrive_to_target = yes
										}
									}
								}
							}
						}
						else = {
							random_system_planet = {
								limit = {
									is_primary_star = yes
								}
								prevprev = {
									auto_move_to_planet = {
										target = prev
										clear_auto_move_on_arrival = yes
									}
								}
							}
						}
					}
				}
				else = {
					closest_system = {
						use_bypasses = yes
						max_steps = 15
						limit = {
							NOT = { is_same_value = root.solar_system }
							OR = {
								AND = {
									exists = starbase
									starbase = {
										exists = owner
										owner = {
											is_hostile = event_target:ag_zeta_crisis_country
										}
									}
								}
								any_system_planet = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
									exists = controller
									controller = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_zeta_crisis_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
							}
						}
						save_event_target_as = ag_zeta_crisis_assault_fleet_action_target
					}
					if = {
						limit = {
							exists = event_target:ag_zeta_crisis_assault_fleet_action_target
						}
						random_list = {
							80 = {
								modifier = {
									factor = 0
									any_controlled_ship = {
										has_ship_flag = ag_jump_drive_cooldown
									}
								}
								event_target:ag_zeta_crisis_assault_fleet_action_target = {
									if = {
										limit = {
											any_system_planet = {
												exists = owner
												owner = {
													is_hostile = event_target:ag_zeta_crisis_country
												}
												exists = controller
												controller = {
													is_hostile = event_target:ag_zeta_crisis_country
												}
												OR = {
													is_colony = yes
													is_under_colonization = yes
												}
												NOT = {
													any_fleet_in_orbit = {
														exists = owner
														owner = {
															is_same_value = event_target:ag_zeta_crisis_country
														}
														NOT = { is_same_value = root }
													}
												}
											}
										}
										random_system_planet = {
											limit = {
												exists = owner
												owner = {
													is_hostile = event_target:ag_zeta_crisis_country
												}
												exists = controller
												controller = {
													is_hostile = event_target:ag_zeta_crisis_country
												}
												OR = {
													is_colony = yes
													is_under_colonization = yes
												}
												NOT = {
													any_fleet_in_orbit = {
														exists = owner
														owner = {
															is_same_value = event_target:ag_zeta_crisis_country
														}
														NOT = { is_same_value = root }
													}
												}
											}
											prevprev = {
												ag_zeta_crisis_jumpdrive_to_target = yes
											}
										}
									}
									else = {
										random_system_planet = {
											limit = {
												is_primary_star = yes
											}
											prevprev = {
												ag_zeta_crisis_jumpdrive_to_target = yes
											}
										}
									}
								}
							}
							20 = {
								ag_zeta_crisis_ship_wandering_action = yes
							}
						}
					}
					else = {
						ag_zeta_crisis_ship_wandering_action = yes
					}
				}
			}
			25 = {
				random_system = {
					limit = {
						NOT = { is_same_value = root.solar_system }
						distance = {
							source = root.solar_system
							type = hyperlane
							use_bypasses = yes
							min_jumps = 1
							max_jumps = 15
						}
						OR = {
							AND = {
								exists = starbase
								starbase = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
								}
							}
							any_system_planet = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_zeta_crisis_country
								}
								exists = controller
								controller = {
									is_hostile = event_target:ag_zeta_crisis_country
								}
								OR = {
									is_colony = yes
									is_under_colonization = yes
								}
								NOT = {
									any_fleet_in_orbit = {
										exists = owner
										owner = {
											is_same_value = event_target:ag_zeta_crisis_country
										}
										NOT = { is_same_value = root }
									}
								}
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_zeta_crisis_assault_fleet_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_zeta_crisis_assault_fleet_action_target
					}
					event_target:ag_zeta_crisis_assault_fleet_action_target = {
						if = {
							limit = {
								any_system_planet = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
									exists = controller
									controller = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_zeta_crisis_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
							}
							random_system_planet = {
								limit = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
									exists = controller
									controller = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_zeta_crisis_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
								random_list = {
									80 = {
										prevprev = {
											auto_move_to_planet = {
												target = prev
												clear_auto_move_on_arrival = yes
											}
										}
									}
									20 = {
										modifier = {
											factor = 0
											prevprev = {
												any_controlled_ship = {
													has_ship_flag = ag_jump_drive_cooldown
												}
											}
										}
										prevprev = {
											ag_zeta_crisis_jumpdrive_to_target = yes
										}
									}
								}
							}
						}
						else = {
							random_system_planet = {
								limit = {
									is_primary_star = yes
								}
								prevprev = {
									auto_move_to_planet = {
										target = prev
										clear_auto_move_on_arrival = yes
									}
								}
							}
						}
					}
				}
				else = {
					random_system = {
						limit = {
							NOT = { is_same_value = root.solar_system }
							distance = {
								source = root.solar_system
								type = hyperlane
								use_bypasses = yes
								min_jumps = 1
								max_jumps = 15
							}
							OR = {
								AND = {
									exists = starbase
									starbase = {
										exists = owner
										owner = {
											is_hostile = event_target:ag_zeta_crisis_country
										}
									}
								}
								any_system_planet = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
									exists = controller
									controller = {
										is_hostile = event_target:ag_zeta_crisis_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_zeta_crisis_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
							}
						}
						save_event_target_as = ag_zeta_crisis_assault_fleet_action_target
					}
					if = {
						limit = {
							exists = event_target:ag_zeta_crisis_assault_fleet_action_target
						}
						random_list = {
							80 = {
								modifier = {
									factor = 0
									any_controlled_ship = {
										has_ship_flag = ag_jump_drive_cooldown
									}
								}
								event_target:ag_zeta_crisis_assault_fleet_action_target = {
									if = {
										limit = {
											any_system_planet = {
												exists = owner
												owner = {
													is_hostile = event_target:ag_zeta_crisis_country
												}
												exists = controller
												controller = {
													is_hostile = event_target:ag_zeta_crisis_country
												}
												OR = {
													is_colony = yes
													is_under_colonization = yes
												}
												NOT = {
													any_fleet_in_orbit = {
														exists = owner
														owner = {
															is_same_value = event_target:ag_zeta_crisis_country
														}
														NOT = { is_same_value = root }
													}
												}
											}
										}
										random_system_planet = {
											limit = {
												exists = owner
												owner = {
													is_hostile = event_target:ag_zeta_crisis_country
												}
												exists = controller
												controller = {
													is_hostile = event_target:ag_zeta_crisis_country
												}
												OR = {
													is_colony = yes
													is_under_colonization = yes
												}
												NOT = {
													any_fleet_in_orbit = {
														exists = owner
														owner = {
															is_same_value = event_target:ag_zeta_crisis_country
														}
														NOT = { is_same_value = root }
													}
												}
											}
											prevprev = {
												ag_zeta_crisis_jumpdrive_to_target = yes
											}
										}
									}
									else = {
										random_system_planet = {
											limit = {
												is_primary_star = yes
											}
											prevprev = {
												ag_zeta_crisis_jumpdrive_to_target = yes
											}
										}
									}
								}
							}
							20 = {
								ag_zeta_crisis_ship_wandering_action = yes
							}
						}
					}
					else = {
						ag_zeta_crisis_ship_wandering_action = yes
					}
				}
			}
			25 = {
				closest_system = {
					use_bypasses = yes
					max_steps = 15
					limit = {
						NOT = { is_same_value = root.solar_system }
						any_ship_in_system = {
							is_disabled = no
							is_ship_class = shipclass_military
							exists = owner
							owner = {
								is_hostile = event_target:ag_zeta_crisis_country
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_zeta_crisis_assault_fleet_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_zeta_crisis_assault_fleet_action_target
					}
					event_target:ag_zeta_crisis_assault_fleet_action_target = {
						random_fleet_in_system = {
							limit = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_zeta_crisis_country
								}
								any_controlled_ship = {
									is_disabled = no
									is_ship_class = shipclass_military
								}
							}
							random_list = {
								75 = {
									prevprev = {
										auto_follow_fleet = {
											target = prev
											attack_fleet = yes
										}
									}
								}
								25 = {
									modifier = {
										factor = 0
										prevprev = {
											any_controlled_ship = {
												has_ship_flag = ag_jump_drive_cooldown
											}
										}
									}
									prevprev = {
										ag_zeta_crisis_jumpdrive_to_target = yes
									}
								}
							}
						}
					}
				}
				else = {
					closest_system = {
						use_bypasses = yes
						max_steps = 15
						limit = {
							NOT = { is_same_value = root.solar_system }
							any_ship_in_system = {
								is_disabled = no
								is_ship_class = shipclass_military
								exists = owner
								owner = {
									is_hostile = event_target:ag_zeta_crisis_country
								}
							}
						}
						save_event_target_as = ag_zeta_crisis_assault_fleet_action_target
					}
					if = {
						limit = {
							exists = event_target:ag_zeta_crisis_assault_fleet_action_target
						}
						random_list = {
							80 = {
								modifier = {
									factor = 0
									any_controlled_ship = {
										has_ship_flag = ag_jump_drive_cooldown
									}
								}
								event_target:ag_zeta_crisis_assault_fleet_action_target = {
									random_fleet_in_system = {
										limit = {
											exists = owner
											owner = {
												is_hostile = event_target:ag_zeta_crisis_country
											}
											any_controlled_ship = {
												is_disabled = no
												is_ship_class = shipclass_military
											}
										}
										prevprev = {
											ag_zeta_crisis_jumpdrive_to_target = yes
										}
									}
								}
							}
							20 = {
								ag_zeta_crisis_ship_wandering_action = yes
							}
						}
					}
					else = {
						ag_zeta_crisis_ship_wandering_action = yes
					}
				}
			}
			25 = {
				random_system = {
					limit = {
						NOT = { is_same_value = root.solar_system }
						distance = {
							source = root.solar_system
							type = hyperlane
							use_bypasses = yes
							min_jumps = 1
							max_jumps = 15
						}
						any_ship_in_system = {
							is_disabled = no
							is_ship_class = shipclass_military
							exists = owner
							owner = {
								is_hostile = event_target:ag_zeta_crisis_country
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_zeta_crisis_assault_fleet_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_zeta_crisis_assault_fleet_action_target
					}
					event_target:ag_zeta_crisis_assault_fleet_action_target = {
						random_fleet_in_system = {
							limit = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_zeta_crisis_country
								}
								any_controlled_ship = {
									is_disabled = no
									is_ship_class = shipclass_military
								}
							}
							random_list = {
								75 = {
									prevprev = {
										auto_follow_fleet = {
											target = prev
											attack_fleet = yes
										}
									}
								}
								25 = {
									modifier = {
										factor = 0
										prevprev = {
											any_controlled_ship = {
												has_ship_flag = ag_jump_drive_cooldown
											}
										}
									}
									prevprev = {
										ag_zeta_crisis_jumpdrive_to_target = yes
									}
								}
							}
						}
					}
				}
				else = {
					random_system = {
						limit = {
							NOT = { is_same_value = root.solar_system }
							distance = {
								source = root.solar_system
								type = hyperlane
								use_bypasses = yes
								min_jumps = 1
								max_jumps = 15
							}
							any_ship_in_system = {
								is_disabled = no
								is_ship_class = shipclass_military
								exists = owner
								owner = {
									is_hostile = event_target:ag_zeta_crisis_country
								}
							}
						}
						save_event_target_as = ag_zeta_crisis_assault_fleet_action_target
					}
					if = {
						limit = {
							exists = event_target:ag_zeta_crisis_assault_fleet_action_target
						}
						random_list = {
							80 = {
								modifier = {
									factor = 0
									any_controlled_ship = {
										has_ship_flag = ag_jump_drive_cooldown
									}
								}
								event_target:ag_zeta_crisis_assault_fleet_action_target = {
									random_fleet_in_system = {
										limit = {
											exists = owner
											owner = {
												is_hostile = event_target:ag_zeta_crisis_country
											}
											any_controlled_ship = {
												is_disabled = no
												is_ship_class = shipclass_military
											}
										}
										prevprev = {
											ag_zeta_crisis_jumpdrive_to_target = yes
										}
									}
								}
							}
							20 = {
								ag_zeta_crisis_ship_wandering_action = yes
							}
						}
					}
					else = {
						ag_zeta_crisis_ship_wandering_action = yes
					}
				}
			}
		}
	}
}
ag_zeta_crisis_assault_fleet_attack_fleet_action = {
	optimize_memory
	if = {
		limit = {
			exists = solar_system
			solar_system = {
				any_ship_in_system = {
					is_disabled = no
					is_ship_class = shipclass_military
					exists = owner
					owner = {
						is_hostile = event_target:ag_zeta_crisis_country
					}
				}
			}
		}
		solar_system = {
			random_fleet_in_system = {
				limit = {
					exists = owner
					owner = {
						is_hostile = event_target:ag_zeta_crisis_country
					}
					any_controlled_ship = {
						is_disabled = no
						is_ship_class = shipclass_military
					}
				}
				prevprev = {
					auto_follow_fleet = {
						target = prev
						attack_fleet = yes
					}
				}
			}
		}
	}
	else = {
		ag_zeta_crisis_ship_wandering_action = yes
	}
}

ag_zeta_crisis_patrol_fleet_action = {
	optimize_memory
	if = {
		limit = {
			exists = solar_system
			solar_system = {
				has_star_flag = ag_ancient_zeta_system
			}
			any_system = {
				NOT = {
					has_star_flag = ag_ancient_zeta_system
				}
				any_ship_in_system = {
					is_ship_size = ag_zeta_crisis_portal
				}
			}
		}
		random_system = {
			limit = {
				NOT = {
					has_star_flag = ag_ancient_zeta_system
				}
				any_ship_in_system = {
					is_ship_size = ag_zeta_crisis_portal
				}
			}
			random_system_planet = {
				limit = {
					is_primary_star = yes
				}
				prevprev = {
					auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			exists = solar_system
			solar_system = {
				any_neighbor_system = {
					exists = space_owner
					space_owner = {
						is_country_type = ag_zeta_crisis_country
					}
				}
			}
		}
		solar_system = {
			random_neighbor_system = {
				limit = {
					exists = space_owner
					space_owner = {
						is_country_type = ag_zeta_crisis_country
					}
				}
				random_system_planet = {
					limit = {
						is_primary_star = yes
					}
					prevprevprev = {
						auto_move_to_planet = {
							target = prev
							clear_auto_move_on_arrival = yes
						}
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			exists = solar_system
		}
		closest_system = {
			use_bypasses = yes
			limit = {
				NOT = { is_same_value = prev.solar_system }
				exists = space_owner
				space_owner = {
					is_country_type = ag_zeta_crisis_country
				}
			}
			save_event_target_as = ag_zeta_crisis_patrol_fleet_action_target
		}
		if = {
			limit = {
				exists = event_target:ag_zeta_crisis_patrol_fleet_action_target
			}
			event_target:ag_zeta_crisis_patrol_fleet_action_target = {
				random_system_planet = {
					limit = {
						is_primary_star = yes
					}
					prevprev = {
						auto_move_to_planet = {
							target = prev
							clear_auto_move_on_arrival = yes
						}
					}
				}
			}
		}
		else = {
			ag_zeta_crisis_ship_wandering_action = yes
		}
	}
	else_if = {
		limit = {
			always = yes
		}
		ag_zeta_crisis_ship_wandering_action = yes
	}
}

ag_zeta_crisis_protector_fleet_action = {
	optimize_memory
	if = {
		limit = {
			solar_system = {
				has_star_flag = ag_ancient_zeta_system
			}
			any_system = {
				NOT = {
					has_star_flag = ag_ancient_zeta_system
				}
				any_ship_in_system = {
					is_ship_size = ag_zeta_crisis_portal
				}
			}
		}
		random_system = {
			limit = {
				NOT = {
					has_star_flag = ag_ancient_zeta_system
				}
				any_ship_in_system = {
					is_ship_size = ag_zeta_crisis_portal
				}
			}
			random_system_planet = {
				limit = {
					is_primary_star = yes
				}
				prevprev = {
					auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			owner = {
				any_controlled_fleet = {
					has_fleet_flag = ag_zeta_crisis_construction_ship_fleet
					NOT = {
						has_fleet_flag = ag_zeta_crisis_construction_ship_has_protector
					}
				}
			}
		}
		closest_system = {
			use_bypasses = yes
			limit = {
				any_ship_in_system = {
					fleet = {
						has_fleet_flag = ag_zeta_crisis_construction_ship_fleet
						NOT = {
							has_fleet_flag = ag_zeta_crisis_construction_ship_has_protector
						}
					}
				}
			}
			save_event_target_as = ag_zeta_crisis_protector_fleet_action_target
		}
		if = {
			limit = {
				exists = event_target:ag_zeta_crisis_protector_fleet_action_target
			}
			event_target:ag_zeta_crisis_protector_fleet_action_target = {
				random_fleet_in_system = {
					limit = {
						has_fleet_flag = ag_zeta_crisis_construction_ship_fleet
						NOT = {
							has_fleet_flag = ag_zeta_crisis_construction_ship_has_protector
						}
					}
					set_fleet_flag = ag_zeta_crisis_construction_ship_has_protector
					prevprev = {
						remove_fleet_flag = ag_zeta_crisis_protector_fleet_without_target
						auto_follow_fleet = {
							target = prev
							attack_fleet = no
						}
					}
				}
			}
		}
		else = {
			random_system = {
				limit = {
					any_ship_in_system = {
						fleet = {
							has_fleet_flag = ag_zeta_crisis_construction_ship_fleet
							NOT = {
								has_fleet_flag = ag_zeta_crisis_construction_ship_has_protector
							}
						}
					}
				}
				random_fleet_in_system = {
					limit = {
						has_fleet_flag = ag_zeta_crisis_construction_ship_fleet
						NOT = {
							has_fleet_flag = ag_zeta_crisis_construction_ship_has_protector
						}
					}
					set_fleet_flag = ag_zeta_crisis_construction_ship_has_protector
					prevprevprev = {
						remove_fleet_flag = ag_zeta_crisis_protector_fleet_without_target
						auto_follow_fleet = {
							target = prev
							attack_fleet = no
						}
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			always = yes
		}
		set_fleet_flag = ag_zeta_crisis_protector_fleet_without_target
		fleet_event = { id = ag_zeta_crisis.72 days = 2 random = 3 }
	}
}

ag_zeta_crisis_constructor_fleet_action = {
	optimize_memory
	if = {
		limit = {
			exists = solar_system
			solar_system = {
				has_star_flag = ag_ancient_zeta_system
			}
			any_system = {
				NOT = {
					has_star_flag = ag_ancient_zeta_system
				}
				any_ship_in_system = {
					is_ship_size = ag_zeta_crisis_portal
				}
			}
		}
		random_system = {
			limit = {
				NOT = {
					has_star_flag = ag_ancient_zeta_system
				}
				any_ship_in_system = {
					is_ship_size = ag_zeta_crisis_portal
				}
			}
			random_system_planet = {
				limit = {
					is_primary_star = yes
				}
				prevprev = {
					auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			any_system = {
				any_ship_in_system = {
					fleet = {
						has_fleet_flag = ag_zeta_crisis_portal
					}
				}
				NOR = {
					exists = starbase
					any_system_planet = {
						is_primary_star = yes
						has_planet_flag = ag_zeta_crisis_star_to_build_starbase
						any_fleet_in_orbit = {
							has_fleet_flag = ag_zeta_crisis_construction_ship_fleet
							NOT = {
								is_same_value = root
							}
						}
					}
					any_ship_in_system = {
						is_disabled = no
						is_ship_class = shipclass_military
						exists = owner
						owner = {
							is_hostile = event_target:ag_zeta_crisis_country
						}
					}
				}
			}
		}
		random_system = {
			limit = {
				any_ship_in_system = {
					fleet = {
						has_fleet_flag = ag_zeta_crisis_portal
					}
				}
				NOR = {
					exists = starbase
					any_system_planet = {
						is_primary_star = yes
						has_planet_flag = ag_zeta_crisis_star_to_build_starbase
						any_fleet_in_orbit = {
							has_fleet_flag = ag_zeta_crisis_construction_ship_fleet
							NOT = {
								is_same_value = root
							}
						}
					}
					any_ship_in_system = {
						is_disabled = no
						is_ship_class = shipclass_military
						exists = owner
						owner = {
							is_hostile = event_target:ag_zeta_crisis_country
						}
					}
				}
			}
			random_system_planet = {
				limit = {
					is_primary_star = yes
				}
				prevprev = {
					auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			exists = solar_system
			solar_system = {
				NOR = {
					exists = starbase
					any_system_planet = {
						is_primary_star = yes
						has_planet_flag = ag_zeta_crisis_star_to_build_starbase
						solar_system = {
							any_ship_in_system = {
								fleet = {
									NOT = {
										is_same_value = root
									}
									exists = orbit
									orbit = {
										is_same_value = prevprevprevprev
									}
								}
							}
						}
					}
					any_ship_in_system = {
						is_disabled = no
						is_ship_class = shipclass_military
						exists = owner
						owner = {
							is_hostile = event_target:ag_zeta_crisis_country
						}
					}
				}
			}
		}
		solar_system = {
			random_system_planet = {
				limit = {
					is_primary_star = yes
				}
				prevprev = {
					auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			always = yes
		}
		random_list = {
			50 = {
				random_system = {
					limit = {
						NOR = {
							exists = starbase
							any_system_planet = {
								is_primary_star = yes
								has_planet_flag = ag_zeta_crisis_star_to_build_starbase
								solar_system = {
									any_ship_in_system = {
										NOT = {
											is_same_value = root
										}
										exists = orbit
										orbit = {
											is_same_value = prevprevprev
										}
									}
								}
							}
							any_ship_in_system = {
								is_disabled = no
								is_ship_class = shipclass_military
								exists = owner
								owner = {
									is_hostile = event_target:ag_zeta_crisis_country
								}
							}
						}
						OR = {
							AND = {
								exists = space_owner
								space_owner = {
									is_country_type = ag_zeta_crisis_country
								}
							}
							AND = {
								NOT = {
									exists = space_owner
								}
								any_neighbor_system = {
									exists = starbase
									starbase = {
										exists = owner
										owner = {
											is_country_type = ag_zeta_crisis_country
										}
									}
								}
							}
						}
					}
					save_event_target_as = ag_zeta_crisis_constructor_fleet_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_zeta_crisis_constructor_fleet_action_target
					}
					event_target:ag_zeta_crisis_constructor_fleet_action_target = {
						random_system_planet = {
							limit = {
								is_primary_star = yes
							}
							prevprev = {
								auto_move_to_planet = {
									target = prev
									clear_auto_move_on_arrival = yes
								}
							}
						}
					}
				}
				else = {
					ag_zeta_crisis_ship_wandering_action = yes
				}
			}
			50 = {
				closest_system = {
					use_bypasses = yes
					max_steps = 5
					limit = {
						NOR = {
							exists = starbase
							any_system_planet = {
								is_primary_star = yes
								has_planet_flag = ag_zeta_crisis_star_to_build_starbase
								solar_system = {
									any_ship_in_system = {
										NOT = {
											is_same_value = root
										}
										exists = orbit
										orbit = {
											is_same_value = prevprevprev
										}
									}
								}
							}
							any_ship_in_system = {
								is_disabled = no
								exists = owner
								owner = {
									is_hostile = event_target:ag_zeta_crisis_country
								}
							}
						}
						OR = {
							AND = {
								exists = space_owner
								space_owner = {
									is_country_type = ag_zeta_crisis_country
								}
							}
							AND = {
								NOT = {
									exists = space_owner
								}
								any_neighbor_system = {
									exists = starbase
									starbase = {
										exists = owner
										owner = {
											is_country_type = ag_zeta_crisis_country
										}
									}
								}
							}
						}
					}
					save_event_target_as = ag_zeta_crisis_constructor_fleet_action_target
				}
				if = {
					limit = { exists = event_target:ag_zeta_crisis_constructor_fleet_action_target }
					event_target:ag_zeta_crisis_constructor_fleet_action_target = {
						random_system_planet = {
							limit = {
								is_primary_star = yes
							}
							prevprev = {
								auto_move_to_planet = {
									target = prev
									clear_auto_move_on_arrival = yes
								}
							}
						}
					}
				}
				else = { ag_zeta_crisis_ship_wandering_action = yes }
			}
		}
	}
}

ag_zeta_crisis_avatar_action = {
	optimize_memory
	random_list = {
		50 = {
			queue_actions = {
				repeat = {
					find_random_system = {
						trigger = {
							id = ag_zeta_crisis_avatar_action_1a
							NOT = { is_same_value = prev.solar_system }
							has_hyperlane_to = prev.solar_system
							OR = {
								NOT = { exists = space_owner }
								AND = {
									exists = space_owner
									space_owner = { is_hostile = event_target:ag_zeta_crisis_country }
								}
							}
						}
						found_system = {
							move_to = this
							find_random_planet = {
								trigger = {
									id = ag_zeta_crisis_avatar_action_1b
									OR = {
										AND = {
											exists = owner
											owner = { is_hostile = event_target:ag_zeta_crisis_country }
										}
										is_primary_star = yes
									}
								}
								found_planet = {
									move_to = this
									orbit_planet = this
									wait = { duration = 20 random = 15 }
								}
							}
						}
						failed = {
							find_random_planet = {
								trigger = {
									id = ag_zeta_crisis_avatar_action_1c
									solar_system = { is_same_value = prevprev.solar_system }
									NAND = {
										prev = { exists = orbit }
										is_same_value = prev.orbit
									}
								}
								found_planet = {
									move_to = this
									orbit_planet = this
									wait = { duration = 20 random = 15 }
								}
							}
						}
					}
				}
			}
		}
		50 = {
			queue_actions = {
				repeat = {
					find_random_planet = {
						trigger = {
							id = ag_zeta_crisis_avatar_action_2a
							solar_system = { is_same_value = prevprev.solar_system }
							NAND = {
								prev = { exists = orbit }
								is_same_value = prev.orbit
							}
						}
						found_planet = {
							move_to = this
							orbit_planet = this
							wait = { duration = 20 random = 15 }
						}
					}
				}
			}
		}
	}
}

ag_zeta_crisis_ships_berserk_action = {
	optimize_memory
	queue_actions = {
		repeat = {
			find_random_system = {
				trigger = {
					id = ag_zeta_crisis_ships_berserk_action_1
					NOT = { is_same_value = prev.solar_system }
					has_hyperlane_to = prev.solar_system
				}
				found_system = {
					move_to = this
					find_random_planet = {
						trigger = {
							id = ag_zeta_crisis_ships_berserk_action_2
							is_primary_star = yes
						}
						found_planet = {
							move_to = this
							wait = { duration = 5 random = 20 }
						}
					}
				}
				failed = {
					find_random_planet = {
						trigger = {
							id = ag_zeta_crisis_ships_berserk_action_3
							solar_system = { is_same_value = prevprev.solar_system }
							NAND = {
								prev = { exists = orbit }
								is_same_value = prev.orbit
							}
						}
						found_planet = {
							move_to = this
							wait = { duration = 5 random = 20 }
						}
					}
				}
			}
		}
	}
}

ag_zeta_crisis_psionic_singularity_action = {
	optimize_memory
	queue_actions = {
		repeat = {
			find_random_planet = {
				trigger = {
					id = ag_zeta_crisis_psionic_singularity_action_1
					solar_system = { is_same_value = prevprev.solar_system }
				}
				found_planet = {
					move_to = this
					orbit_planet = this
					wait = {
						duration = 5
						random = 15
					}
				}
			}
		}
	}
}

ag_psi_titan_action = {
	optimize_memory
	queue_actions = {
		repeat = {
			find_closest_planet = {
				trigger = {
					id = ag_ancient_psi_machine_world
					is_planet = event_target:ag_ancient_psi_machine_world
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_psi_ring_1
					is_planet = event_target:ag_psi_ring_1
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_psi_ring_2
					is_planet = event_target:ag_psi_ring_2
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_psi_ring_3
					is_planet = event_target:ag_psi_ring_3
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_psi_ring_4
					is_planet = event_target:ag_psi_ring_4
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_psi_ring_5
					is_planet = event_target:ag_psi_ring_5
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_psi_ring_6
					is_planet = event_target:ag_psi_ring_6
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_psi_ring_7
					is_planet = event_target:ag_psi_ring_7
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_psi_ring_8
					is_planet = event_target:ag_psi_ring_8
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_psi_ring_9
					is_planet = event_target:ag_psi_ring_9
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_psi_ring_10
					is_planet = event_target:ag_psi_ring_10
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
			find_closest_planet = {
				trigger = {
					id = ag_psi_ring_11
					is_planet = event_target:ag_psi_ring_11
				}
				found_planet = {
					move_to = this
					orbit_planet = this
				}
			}
		}
	}
}

#################################################
###                                           ###
###                 Wanderer                  ###
###                                           ###
#################################################

ag_ancient_wandering_ship_action = {
	optimize_memory
	if = {
		limit = {
			check_variable = {
				which = ag_ancient_wandering_current_anchor
				value = 1
			}
		}
		if = {
			limit = { has_global_flag = ag_ancient_anchor_station_2_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 2 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_3_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 3 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_4_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_5_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 5 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_6_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 6 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_7_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 7 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_8_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 8 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_9_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 9 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_10_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 10 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_1_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 1 }
		}
		else_if = {
			limit = { always = yes }
			ag_ancient_wandering_ship_idle_action = yes
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = ag_ancient_wandering_current_anchor
				value = 2
			}
		}
		if = {
			limit = { has_global_flag = ag_ancient_anchor_station_3_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 3 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_4_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_5_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 5 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_6_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 6 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_7_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 7 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_8_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 8 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_9_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 9 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_10_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 10 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_1_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 1 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_2_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 2 }
		}
		else_if = {
			limit = { always = yes }
			ag_ancient_wandering_ship_idle_action = yes
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = ag_ancient_wandering_current_anchor
				value = 3
			}
		}
		if = {
			limit = { has_global_flag = ag_ancient_anchor_station_4_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_5_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 5 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_6_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 6 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_7_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 7 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_8_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 8 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_9_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 9 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_10_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 10 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_1_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 1 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_2_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 2 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_3_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 3 }
		}
		else_if = {
			limit = { always = yes }
			ag_ancient_wandering_ship_idle_action = yes
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = ag_ancient_wandering_current_anchor
				value = 4
			}
		}
		if = {
			limit = { has_global_flag = ag_ancient_anchor_station_5_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 5 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_6_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 6 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_7_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 7 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_8_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 8 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_9_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 9 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_10_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 10 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_1_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 1 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_2_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 2 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_3_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 3 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_4_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 4 }
		}
		else_if = {
			limit = { always = yes }
			ag_ancient_wandering_ship_idle_action = yes
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = ag_ancient_wandering_current_anchor
				value = 5
			}
		}
		if = {
			limit = { has_global_flag = ag_ancient_anchor_station_6_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 6 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_7_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 7 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_8_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 8 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_9_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 9 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_10_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 10 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_1_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 1 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_2_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 2 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_3_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 3 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_4_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_5_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 5 }
		}
		else_if = {
			limit = { always = yes }
			ag_ancient_wandering_ship_idle_action = yes
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = ag_ancient_wandering_current_anchor
				value = 6
			}
		}
		if = {
			limit = { has_global_flag = ag_ancient_anchor_station_7_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 7 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_8_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 8 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_9_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 9 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_10_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 10 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_1_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 1 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_2_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 2 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_3_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 3 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_4_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_5_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 5 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_6_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 6 }
		}
		else_if = {
			limit = { always = yes }
			ag_ancient_wandering_ship_idle_action = yes
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = ag_ancient_wandering_current_anchor
				value = 7
			}
		}
		if = {
			limit = { has_global_flag = ag_ancient_anchor_station_8_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 8 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_9_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 9 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_10_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 10 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_1_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 1 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_2_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 2 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_3_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 3 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_4_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_5_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 5 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_6_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 6 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_7_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 7 }
		}
		else_if = {
			limit = { always = yes }
			ag_ancient_wandering_ship_idle_action = yes
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = ag_ancient_wandering_current_anchor
				value = 8
			}
		}
		if = {
			limit = { has_global_flag = ag_ancient_anchor_station_9_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 9 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_10_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 10 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_1_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 1 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_2_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 2 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_3_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 3 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_4_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_5_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 5 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_6_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 6 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_7_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 7 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_8_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 8 }
		}
		else_if = {
			limit = { always = yes }
			ag_ancient_wandering_ship_idle_action = yes
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = ag_ancient_wandering_current_anchor
				value = 9
			}
		}
		if = {
			limit = { has_global_flag = ag_ancient_anchor_station_10_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 10 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_1_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 1 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_2_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 2 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_3_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 3 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_4_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_5_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 5 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_6_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 6 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_7_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 7 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_8_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 8 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_9_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 9 }
		}
		else_if = {
			limit = { always = yes }
			ag_ancient_wandering_ship_idle_action = yes
		}
	}
	else_if = {
		limit = { always = yes }
		if = {
			limit = { has_global_flag = ag_ancient_anchor_station_1_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 1 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_2_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 2 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_3_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 3 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_4_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_5_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 5 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_6_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 6 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_7_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 7 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_8_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 8 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_9_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 9 }
		}
		else_if = {
			limit = { has_global_flag = ag_ancient_anchor_station_10_spawned }
			ag_ancient_wandering_ship_to_anchor_station = { ag_target = 10 }
		}
		else_if = {
			limit = { always = yes }
			ag_ancient_wandering_ship_idle_action = yes
		}
	}
}
ag_ancient_wandering_ship_to_anchor_station = {
	optimize_memory
	random_system = {
		limit = { has_star_flag = ag_ancient_anchor_system_$ag_target$ }
		random_system_planet = {
			limit = { is_primary_star = yes }
			prevprev = {
				auto_move_to_planet = {
					target = prev
					clear_auto_move_on_arrival = yes
				}
			}
		}
	}
}
ag_ancient_wandering_ship_idle_action = {
	optimize_memory
	random_system = {
		limit = {
			ag_is_ancient_system = no
			distance = {
				source = prev.solar_system
				use_bypasses = yes
				min_jumps = 10
				max_jumps = 125
			}
			prev = { can_access_system = prev }
		}
		save_event_target_as = ag_ancient_wandering_ship_idle_action_target
	}
	if = {
		limit = { exists = event_target:ag_ancient_wandering_ship_idle_action_target }
		event_target:ag_ancient_wandering_ship_idle_action_target = {
			random_system_planet = {
				limit = { is_primary_star = yes }
				prevprev = {
					auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					}
				}
			}
		}
	}
	else = {
		random_system = {
			limit = {
				ag_is_ancient_system = no
				prev = { can_access_system = prev }
			}
			save_event_target_as = ag_ancient_wandering_ship_idle_action_target
		}
	}
	if = {
		limit = { exists = event_target:ag_ancient_wandering_ship_idle_action_target }
		event_target:ag_ancient_wandering_ship_idle_action_target = {
			random_system_planet = {
				limit = { is_primary_star = yes }
				prevprev = {
					auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					}
				}
			}
		}
	}
	else = {
		random_system = { save_event_target_as = ag_ancient_wandering_ship_idle_action_target }
		event_target:ag_ancient_wandering_ship_idle_action_target = {
			random_system_planet = {
				limit = { is_primary_star = yes }
				prevprev = {
					ag_spawn_jumpdrive_effect = { ag_color = red }
					set_location = { target = prev distance = 300 angle = random }
					ag_spawn_jumpdrive_effect = { ag_color = red }
					auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					}
				}
			}
		}
	}
}

#################################################
###                                           ###
###               Starlight II                ###
###                                           ###
#################################################

ag_lost_ancient_ship_find_guardians = {
	optimize_memory
	random_list = {
		10 = {
			modifier = { factor = 0 owner = { ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_dragon } } }
			ag_lost_ancient_ship_find_guardians_1 = { ag_target_guardian = guardian_dragon }
		}
		10 = {
			modifier = { factor = 0 owner = { ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_fortress } } }
			ag_lost_ancient_ship_find_guardians_1 = { ag_target_guardian = guardian_fortress }
		}
		10 = {
			modifier = { factor = 0 owner = { ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_stellarite } } }
			ag_lost_ancient_ship_find_guardians_1 = { ag_target_guardian = guardian_stellarite }
		}
		10 = {
			modifier = { factor = 0 owner = { ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_horror } } }
			ag_lost_ancient_ship_find_guardians_1 = { ag_target_guardian = guardian_horror }
		}
		10 = {
			modifier = { factor = 0 owner = { ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_hiver } } }
			ag_lost_ancient_ship_find_guardians_1 = { ag_target_guardian = guardian_hiver }
		}
		10 = {
			modifier = { factor = 0 owner = { ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_sphere } } }
			ag_lost_ancient_ship_find_guardians_1 = { ag_target_guardian = guardian_sphere }
		}
		10 = {
			modifier = { factor = 0 owner = { ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_dreadnought } } }
			ag_lost_ancient_ship_find_guardians_1 = { ag_target_guardian = guardian_dreadnought }
		}
		10 = {
			modifier = { factor = 0 owner = { ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_wraith } } }
			ag_lost_ancient_ship_find_guardians_1 = { ag_target_guardian = guardian_wraith }
		}
		10 = {
			modifier = { factor = 0 owner = { ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_hatchling } } }
			ag_lost_ancient_ship_find_guardians_1 = { ag_target_guardian = guardian_hatchling }
		}
		10 = {
			modifier = { factor = 0 owner = { ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_scavenger_bot } } }
			ag_lost_ancient_ship_find_guardians_1 = { ag_target_guardian = guardian_scavenger_bot }
		}
		10 = {
			modifier = { factor = 0 owner = { ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_elderly_tiyanki } } }
			ag_lost_ancient_ship_find_guardians_1 = { ag_target_guardian = guardian_elderly_tiyanki }
		}
		0 = {
			modifier = {
				add = 1000
				owner = { AND = {
					ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_dragon }
					ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_fortress }
					ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_stellarite }
					ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_horror }
					ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_hiver }
					ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_sphere }
					ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_dreadnought }
					ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_wraith }
					ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_hatchling }
					ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_scavenger_bot }
					ag_lost_ancient_ship_guaridan_check = { ag_target_guardian = guardian_elderly_tiyanki }
				} }
			}
			remove_fleet_flag = ag_lost_ancient_ship_targeting_guardians
			clear_orders = yes
			clear_fleet_actions = this
			auto_move_to_planet = { target = owner.capital_scope clear_auto_move_on_arrival = yes }
			owner = {
				create_message = {
					type = message_ag_starlight_cannot_reach
					localization = "message_ag_starlight_cannot_reach_desc"
					days = 20
					target = this
				}
			}
		}
	}
}
ag_lost_ancient_ship_find_guardians_1 = {
	optimize_memory
	random_country = {
		limit = { is_country_type = $ag_target_guardian$ has_communications = prev.owner }
		random_controlled_fleet = {
			limit = {
				exists = solar_system
				prevprev = { can_access_system = prev.solar_system }
			}
			save_event_target_as = ag_lost_ancient_ship_target
		}
	}
	if = {
		limit = { exists = event_target:ag_lost_ancient_ship_target }
		auto_move_to_planet = { target = event_target:ag_lost_ancient_ship_target.solar_system.star clear_auto_move_on_arrival = yes }
	}
	else = {
		owner = { set_country_flag = ag_lost_ancient_ship_target_$ag_target_guardian$_failed }
		fleet_event = { id = ag_side.38 days = 5 random = 5 }
	}
}

#################################################
###                                           ###
###                Theta Area                 ###
###                                           ###
#################################################

ag_ancient_primitive_fleet_find_target_fleet_action = {
	optimize_memory
	if = {
		limit = { has_fleet_flag = ag_ancient_primitive_country_fleet_1 }
		closest_system = {
			use_bypasses = yes
			limit = {
				OR = {
					AND = {
						exists = starbase
						starbase = {
							exists = owner
							owner = { NOT = { is_same_value = event_target:ag_ancient_primitive_country } }
						}
					}
					any_system_planet = {
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_ancient_primitive_country_transfer_completed }
					}
				}
				prev = { can_access_system = prev }
			}
			if = {
				limit = {
					any_system_planet = {
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_ancient_primitive_country_transfer_completed }
					}
				}
				random_system_planet = {
					limit = {
						exists = owner
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_ancient_primitive_country_transfer_completed }
					}
					prevprev = {
						auto_move_to_planet = {
							target = prev
							clear_auto_move_on_arrival = yes
						}
					}
				}
			}
			else = {
				random_system_planet = {
					limit = { is_star = yes }
					prevprev = {
						auto_move_to_planet = {
							target = prev
							clear_auto_move_on_arrival = yes
						}
					}
				}
			}
		}
	}
	if = {
		limit = { has_fleet_flag = ag_ancient_primitive_country_fleet_2 }
		closest_system = {
			use_bypasses = yes
			limit = {
				OR = {
					AND = {
						exists = starbase
						starbase = {
							exists = owner
							owner = { NOT = { is_same_value = event_target:ag_ancient_primitive_country } }
						}
					}
					any_system_planet = {
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_ancient_primitive_country_transfer_completed }
					}
				}
				prev = { can_access_system = prev }
			}
			if = {
				limit = {
					any_system_planet = {
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_ancient_primitive_country_transfer_completed }
					}
				}
				random_system_planet = {
					limit = {
						exists = owner
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_ancient_primitive_country_transfer_completed }
					}
					prevprev = {
						auto_move_to_planet = {
							target = prev
							clear_auto_move_on_arrival = yes
						}
					}
				}
			}
			else = {
				random_system_planet = {
					limit = { is_star = yes }
					prevprev = {
						auto_move_to_planet = {
							target = prev
							clear_auto_move_on_arrival = yes
						}
					}
				}
			}
		}
	}
	if = {
		limit = { has_fleet_flag = ag_ancient_primitive_country_fleet_3 }
		closest_system = {
			use_bypasses = yes
			limit = {
				OR = {
					AND = {
						exists = starbase
						starbase = {
							exists = owner
							owner = { NOT = { is_same_value = event_target:ag_ancient_primitive_country } }
						}
					}
					any_system_planet = {
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_ancient_primitive_country_transfer_completed }
					}
				}
				prev = { can_access_system = prev }
			}
			if = {
				limit = {
					any_system_planet = {
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_ancient_primitive_country_transfer_completed }
					}
				}
				random_system_planet = {
					limit = {
						exists = owner
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { has_planet_flag = ag_ancient_primitive_country_transfer_completed }
					}
					prevprev = {
						auto_move_to_planet = {
							target = prev
							clear_auto_move_on_arrival = yes
						}
					}
				}
			}
			else = {
				random_system_planet = {
					limit = { is_star = yes }
					prevprev = {
						auto_move_to_planet = {
							target = prev
							clear_auto_move_on_arrival = yes
						}
					}
				}
			}
		}
	}
}