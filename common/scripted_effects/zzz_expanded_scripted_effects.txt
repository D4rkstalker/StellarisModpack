### MODDED ###
# gain_possitive_media_coverage
# gain_negative_media_coverage
# add_observer_clue
# finish_observer_event
# create_human_infiltrated_spiritual_primitives
# create_human_infiltrated_materialist_primitives
# create_human_infiltrated_pacifist_primitives
# dportal_planet_random_event
# dportal_empire_victory_increase
# dportal_empire_crisis_increase

# Fallen Empire Gift
# FallenEmpireTaskOrigin is the fallen empire
give_fe_tech_gift = {
	# tier 2
	if = {
		limit = {
			NAND = {
				has_technology = tech_experimental_subspace_navigation
				has_technology = tech_modular_engineering
				has_technology = tech_defense_platform_hull_1
				OR = {
					has_technology = tech_subdermal_stimulation
					event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_xenophile } }
				}
				OR = {
					NOT = { has_global_flag = expanded_megastructures_installed }
					has_technology = tech_hyperlane_mapping_mod
					event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_materialist } }
				}
				OR = {
					has_technology = tech_gene_banks
					NOT = { can_research_technology = tech_gene_banks }
				}
				OR = {
					has_technology = tech_arcane_deciphering
					NOT = { can_research_technology = tech_arcane_deciphering }
					has_ancrel = no
				}
			}
		}
		locked_random_list = {
			3 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_gene_banks
						NOT = { can_research_technology = tech_gene_banks }
					}
				}
				give_technology = { tech = tech_gene_banks }
			}
			2 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_arcane_deciphering
						NOT = { can_research_technology = tech_arcane_deciphering }
						has_ancrel = no
					}
				}
				give_technology = { tech = tech_arcane_deciphering }
			}
			2 = {
				modifier = {
					factor = 0
					has_technology = tech_modular_engineering
				}
				give_technology = { tech = tech_modular_engineering }
			}
			1 = {
				modifier = {
					factor = 0
					has_technology = tech_experimental_subspace_navigation
				}
				give_technology = { tech = tech_experimental_subspace_navigation }
			}
			1 = {
				modifier = {
					factor = 0
					has_technology = tech_defense_platform_hull_1
				}
				give_technology = { tech = tech_defense_platform_hull_1 }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_subdermal_stimulation
						event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_xenophile } }
					}
				}
				give_technology = { tech = tech_subdermal_stimulation }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_global_flag = expanded_megastructures_installed }
						has_technology = tech_hyperlane_mapping_mod
						event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_materialist } }
					}
				}
				give_technology = { tech = tech_hyperlane_mapping_mod }
			}
		}
	}
	# tier 3
	else_if = {
		limit = {
			NAND = {
				has_technology = tech_planetary_shield_generator
				has_technology = tech_wormhole_stabilization
				has_technology = tech_construction_templates
				has_technology = tech_space_defense_station_improvement
				OR = {
					has_technology = tech_selected_lineages
					NOT = { can_research_technology = tech_selected_lineages }
				}
				OR = {
					NOT = { has_global_flag = starbase_expanded_installed }
					has_technology = tech_starbase_hull_1
				}
				OR = {
					has_technology = tech_tomb_world_adaption
					NOT = { can_research_technology = tech_tomb_world_adaption }
					event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_xenophile } }
				}
				OR = {
					has_technology = tech_habitat_1
					NOT = { can_research_technology = tech_habitat_1 }
				}
				OR = {
					has_technology = tech_resort_colonies
					NOT = { can_research_technology = tech_resort_colonies }
					event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_xenophile } }
				}
				OR = {
					has_technology = tech_psionic_theory
					has_ethic = "ethic_materialist"
					has_ethic = "ethic_fanatic_materialist"
					is_gestalt = yes
					event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_spiritualist } }
				}
				OR = {
					has_technology = tech_mine_zro
					has_ethic = "ethic_materialist"
					has_ethic = "ethic_fanatic_materialist"
					is_gestalt = yes
					event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_spiritualist } }
				}
				OR = {
					NOT = { has_global_flag = expanded_megastructures_installed }
					has_technology = tech_selected_lineages_machine
					NOT = { can_research_technology = tech_selected_lineages }
					event_target:FallenEmpireTaskOrigin = {
						NOR = {
							has_ethic = ethic_fanatic_materialist
							has_authority = auth_machine_intelligence
						}
					}
				}
			}
		}
		locked_random_list = {
			4 = {
				modifier = {
					factor = 0
					has_technology = tech_planetary_shield_generator
				}
				give_technology = { tech = tech_planetary_shield_generator }
			}
			3 = {
				modifier = {
					factor = 0
					has_technology = tech_space_defense_station_improvement
				}
				give_technology = { tech = tech_space_defense_station_improvement }
			}
			2 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_selected_lineages
						NOT = { can_research_technology = tech_selected_lineages }
					}
				}
				give_technology = { tech = tech_selected_lineages }
			}
			2 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_global_flag = expanded_megastructures_installed }
						has_technology = tech_selected_lineages_machine
						NOT = { can_research_technology = tech_selected_lineages_machine }
						event_target:FallenEmpireTaskOrigin = {
							NOR = {
								has_ethic = ethic_fanatic_materialist
								has_authority = auth_machine_intelligence
							}
						}
					}
				}
				give_technology = { tech = tech_selected_lineages_machine }
			}
			1 = {
				modifier = {
					factor = 0
					has_technology = tech_construction_templates
				}
				give_technology = { tech = tech_construction_templates }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_tomb_world_adaption
						NOT = { can_research_technology = tech_tomb_world_adaption }
						event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_xenophile } }
					}
				}
				give_technology = { tech = tech_tomb_world_adaption }
			}
			1 = {
				modifier = {
					factor = 0
					has_technology = tech_wormhole_stabilization
				}
				modifier = {
					factor = 0.1
					NOR = {
						has_seen_any_bypass = wormhole 
						any_relation = {
							is_country_type = default
							has_communications = ROOT
							has_technology = tech_wormhole_stabilization
						}
					}
				}
				give_technology = { tech = tech_wormhole_stabilization }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_global_flag = starbase_expanded_installed }
						has_technology = tech_starbase_hull_1
					}
				}
				give_technology = { tech = tech_starbase_hull_1 }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_habitat_1
						NOT = { can_research_technology = tech_habitat_1 }
					}
				}
				give_technology = { tech = tech_habitat_1 }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_resort_colonies
						NOT = { can_research_technology = tech_resort_colonies }
						event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_xenophile } }
					}
				}
				give_technology = { tech = tech_resort_colonies }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_psionic_theory
						has_ethic = "ethic_materialist"
						has_ethic = "ethic_fanatic_materialist"
						is_gestalt = yes
						event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_spiritualist } }
					}
				}
				give_technology = { tech = tech_psionic_theory }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_mine_zro
						NOT = { has_technology = tech_psionic_theory }
						has_ethic = "ethic_materialist"
						has_ethic = "ethic_fanatic_materialist"
						is_gestalt = yes
						event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_spiritualist } }
					}
				}
				give_technology = { tech = tech_mine_zro }
			}
		}
	}
	# tier 4
	else_if = {
		limit = {
			NAND = {
				has_technology = tech_synchronized_defences
				has_technology = tech_gateway_activation
				has_technology = tech_encryption_3
				OR = {
					has_technology = tech_capacity_boosters
					NOT = { can_research_technology = tech_capacity_boosters }
				}
				OR = {
					NOT = { has_global_flag = starbase_expanded_installed }
					has_technology = tech_starbase_hull_2
				}
				OR = {
					has_technology = tech_galactic_markets
					NOT = { can_research_technology = tech_galactic_markets }
					event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_xenophile } }
				}
				OR = {
					has_technology = tech_nutrient_replication
					NOT = { can_research_technology = tech_nutrient_replication }
				}
				OR = {
					has_technology = tech_habitat_2
					NOT = { can_research_technology = tech_habitat_2 }
				}
				OR = {
					has_technology = tech_habitat_3
					NOT = { can_research_technology = tech_habitat_3 }
				}
				OR = {
					NOT = { has_global_flag = starbase_expanded_installed }
					has_technology = tech_galactic_trading_companies
					NOT = { can_research_technology = tech_galactic_trading_companies }
					event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_xenophile } }
				}
				OR = {
					has_technology = tech_mega_assembly
					NOT = { can_research_technology = tech_mega_assembly }
					event_target:FallenEmpireTaskOrigin = {
						NOR = {
							has_ethic = ethic_fanatic_materialist
							has_authority = auth_machine_intelligence
						}
					}
				}
				OR = {
					NOT = { has_global_flag = expanded_megastructures_installed }
					has_technology = tech_capacity_boosters_machine
					NOT = { can_research_technology = tech_capacity_boosters_machine }
					event_target:FallenEmpireTaskOrigin = {
						NOR = {
							has_ethic = ethic_fanatic_materialist
							has_authority = auth_machine_intelligence
						}
					}
				}
				OR = {
					has_technology = tech_tracking_implants
					is_gestalt = yes
					event_target:FallenEmpireTaskOrigin = {
						NOR = {
							has_ethic = ethic_fanatic_materialist
							has_ethic = ethic_fanatic_xenophile
						}
					}
				}
			}
		}
		locked_random_list = {
			4 = {
				modifier = {
					factor = 0
					has_technology = tech_synchronized_defences
				}
				give_technology = { tech = tech_synchronized_defences }
			}
			3 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_capacity_boosters
						NOT = { can_research_technology = tech_capacity_boosters }
					}
				}
				give_technology = { tech = tech_capacity_boosters }
			}
			3 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_global_flag = expanded_megastructures_installed }
						has_technology = tech_capacity_boosters_machine
						NOT = { can_research_technology = tech_capacity_boosters_machine }
						event_target:FallenEmpireTaskOrigin = {
							NOR = {
								has_ethic = ethic_fanatic_materialist
								has_authority = auth_machine_intelligence
							}
						}
					}
				}
				give_technology = { tech = tech_capacity_boosters_machine }
			}
			2 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_habitat_2
						NOT = { can_research_technology = tech_habitat_2 }
					}
				}
				give_technology = { tech = tech_habitat_2 }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_technology = tech_habitat_2 }
						has_technology = tech_habitat_3
						NOT = { can_research_technology = tech_habitat_3 }
					}
				}
				give_technology = { tech = tech_habitat_3 }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_global_flag = starbase_expanded_installed }
						has_technology = tech_starbase_hull_2
					}
				}
				give_technology = { tech = tech_starbase_hull_2 }
			}
			1 = {
				modifier = {
					factor = 0
					has_technology = tech_gateway_activation
				}
				give_technology = { tech = tech_gateway_activation }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_galactic_markets
						NOT = { can_research_technology = tech_galactic_markets }
						event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_xenophile } }
					}
				}
				give_technology = { tech = tech_galactic_markets }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_nutrient_replication
						NOT = { can_research_technology = tech_nutrient_replication }
					}
				}
				give_technology = { tech = tech_nutrient_replication }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_mega_assembly
						NOT = { can_research_technology = tech_mega_assembly }
						event_target:FallenEmpireTaskOrigin = {
							NOR = {
								has_ethic = ethic_fanatic_materialist
								has_authority = auth_machine_intelligence
							}
						}
					}
				}
				give_technology = { tech = tech_mega_assembly }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_global_flag = starbase_expanded_installed }
						has_technology = tech_galactic_trading_companies
						NOT = { can_research_technology = tech_galactic_trading_companies }
						event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_xenophile } }
					}
				}
				give_technology = { tech = tech_galactic_trading_companies }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_tracking_implants
						is_gestalt = yes
						event_target:FallenEmpireTaskOrigin = {
							NOR = {
								has_ethic = ethic_fanatic_materialist
								has_ethic = ethic_fanatic_xenophile
							}
						}
					}
				}
				give_technology = { tech = tech_tracking_implants }
			}
			1 = {
				modifier = {
					factor = 0
					has_technology = tech_encryption_3
				}
				give_technology = { tech = tech_encryption_3 }
			}
		}
	}
	# tier 5
	else_if = {
		limit = {
			NAND = {
				has_technology = tech_gateway_construction
				OR = {
					has_technology = tech_battleship_hull_2
					NOT = { has_technology = tech_battleships }
				}
				OR = {
					has_technology = tech_titan_hull_1
					NOT = { has_technology = tech_titans }
				}
				OR = {
					has_technology = tech_titan_hull_2
					NOT = { has_technology = tech_titan_hull_1 }
				}
				OR = {
					NOT = { has_global_flag = expanded_megastructures_installed }
					has_technology = tech_matter_generator
				}
				OR = {
					NOT = { has_global_flag = starbase_expanded_installed }
					has_technology = tech_starbase_hull_3
				}
				OR = {
					NOT = { has_global_flag = tech_science_nexus }
					NOT = { host_has_dlc = "Utopia" }
					event_target:FallenEmpireTaskOrigin = {
						NOR = {
							has_ethic = ethic_fanatic_materialist
							has_authority = auth_machine_intelligence
						}
					}
				}
				OR = {
					NOT = { has_global_flag = tech_sentry_array }
					NOT = { host_has_dlc = "Utopia" }
				}
				OR = {
					NOT = { has_global_flag = tech_interstellar_assembly }
					NOT = { host_has_dlc = "Megacorp" }
					event_target:FallenEmpireTaskOrigin = {
						NOT = { has_ethic = ethic_fanatic_xenophile }
					}
				}
				OR = {
					NOT = { has_global_flag = tech_mega_art }
					NOT = { host_has_dlc = "Megacorp" }
					event_target:FallenEmpireTaskOrigin = {
						NOT = { has_ethic = ethic_fanatic_spiritualist }
					}
				}
			}
		}
		locked_random_list = {
			2 = {
				modifier = {
					factor = 0
					has_technology = tech_gateway_construction
				}
				give_technology = { tech = tech_gateway_construction }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_battleship_hull_2
						NOT = { has_technology = tech_battleships }
					}
				}
				give_technology = { tech = tech_battleship_hull_2 }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_titan_hull_1
						NOT = { has_technology = tech_titans }
					}
				}
				give_technology = { tech = tech_titan_hull_1 }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_titan_hull_2
						NOT = { has_technology = tech_titan_hull_1 }
					}
				}
				give_technology = { tech = tech_titan_hull_2 }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_global_flag = starbase_expanded_installed }
						has_technology = tech_starbase_hull_3
						NOT = { has_technology = tech_starbase_hull_2 }
					}
				}
				give_technology = { tech = tech_starbase_hull_3 }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_global_flag = expanded_megastructures_installed }
						has_technology = tech_matter_generator
					}
				}
				modifier = {
					factor = 0.1
					NOT = { has_technology = tech_zero_point_power }
				}
				give_technology = { tech = tech_matter_generator }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_global_flag = tech_science_nexus }
						NOT = { host_has_dlc = "Utopia" }
						event_target:FallenEmpireTaskOrigin = {
							NOR = {
								has_ethic = ethic_fanatic_materialist
								has_authority = auth_machine_intelligence
							}
						}
					}
				}
				modifier = {
					factor = 0.1
					NOR = {
						has_technology = tech_starbase_5
						has_technology = tech_battleships
						has_technology = tech_zero_point_power
					}
				}
				give_technology = { tech = tech_science_nexus }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_global_flag = tech_sentry_array }
						NOT = { host_has_dlc = "Utopia" }
					}
				}
				modifier = {
					factor = 0.1
					NOR = {
						has_technology = tech_starbase_5
						has_technology = tech_battleships
						has_technology = tech_zero_point_power
					}
				}
				give_technology = { tech = tech_sentry_array }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_global_flag = tech_interstellar_assembly }
						NOT = { host_has_dlc = "Megacorp" }
						event_target:FallenEmpireTaskOrigin = {
							NOT = { has_ethic = ethic_fanatic_xenophile }
						}
					}
				}
				modifier = {
					factor = 0.1
					NOR = {
						has_technology = tech_starbase_5
						has_technology = tech_battleships
						has_technology = tech_zero_point_power
					}
				}
				give_technology = { tech = tech_interstellar_assembly }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_global_flag = tech_mega_art }
						NOT = { host_has_dlc = "Megacorp" }
						event_target:FallenEmpireTaskOrigin = {
							NOT = { has_ethic = ethic_fanatic_spiritualist }
						}
					}
				}
				modifier = {
					factor = 0.1
					NOR = {
						has_technology = tech_starbase_5
						has_technology = tech_battleships
						has_technology = tech_zero_point_power
					}
				}
				give_technology = { tech = tech_mega_art }
			}
		}
	}
	# Back-Up
	else = {
		# Just give databanks instead
		add_modifier = {
			modifier = fallen_empire_gift_databanks
			days = 3600
		}
	}
}

gain_possitive_media_coverage = {
	if = {
		limit = { is_gestalt = no }
		if = {
			limit = {
				owner = {
					OR = {
						has_modifier = media_coverage_positive_high
					}
				}
			}
			owner = {
				remove_modifier = media_coverage_positive_high
				add_modifier = {
					modifier = media_coverage_positive_high
					days = 7200
				}
			}
		}
		if = {
			limit = {
				owner = {
					OR = {
						has_modifier = media_coverage_positive_medium
					}
				}
			}
			owner = {
				remove_modifier = media_coverage_positive_medium
				add_modifier = {
					modifier = media_coverage_positive_high
					days = 7200
				}
			}
		}
		if = {
			limit = {
				owner = {
					has_modifier = media_coverage_positive_low
				}
			}
			owner = {
				remove_modifier = media_coverage_positive_low
				add_modifier = {
					modifier = media_coverage_positive_medium
					days = 7200
				}
			}
		}
		if = {
			limit = {
				owner = {
					NOR = {
						has_modifier = media_coverage_negative_high
						has_modifier = media_coverage_negative_medium
						has_modifier = media_coverage_negative_low
						has_modifier = media_coverage_positive_low
						has_modifier = media_coverage_positive_medium
						has_modifier = media_coverage_positive_high
					}
				}
			}
			owner = {
				add_modifier = {
					modifier = media_coverage_positive_low
					days = 7200
				}
			}
		}
		if = {
			limit = {
				owner = {
					has_modifier = media_coverage_negative_low
				}
			}
			owner = {
				remove_modifier = media_coverage_negative_low
			}
		}
		if = {
			limit = {
				owner = {
					has_modifier = media_coverage_negative_medium
				}
			}
			owner = {
				remove_modifier = media_coverage_negative_medium
				add_modifier = {
					modifier = media_coverage_negative_low
					days = 7200
				}
			}
		}
		if = {
			limit = {
				owner = {
					has_modifier = media_coverage_negative_high
				}
			}
			owner = {
				remove_modifier = media_coverage_negative_high
				add_modifier = {
					modifier = media_coverage_negative_medium
					days = 7200
				}
			}
		}
	}
}

gain_negative_media_coverage = {
	if = {
		limit = { is_gestalt = no }
		if = {
			limit = {
				has_modifier = media_coverage_negative_high
			}
			remove_modifier = "media_coverage_negative_high"
			add_modifier = {
				modifier = media_coverage_negative_high
				days = 7200
			}
		}
		if = {
			limit = {
				has_modifier = media_coverage_negative_medium
			}
			remove_modifier = "media_coverage_negative_medium"
			add_modifier = {
				modifier = media_coverage_negative_high
				days = 7200
			}
		}
		if = {
			limit = {
				has_modifier = media_coverage_negative_low
			}
			remove_modifier = "media_coverage_negative_low"
			add_modifier = {
				modifier = media_coverage_negative_medium
				days = 7200
			}
		}
		if = {
			limit = {
				NOR = {
					has_modifier = media_coverage_positive_high
					has_modifier = media_coverage_positive_medium
					has_modifier = media_coverage_positive_low
					has_modifier = media_coverage_negative_low
					has_modifier = media_coverage_negative_medium
					has_modifier = media_coverage_negative_high
				}
			}
			add_modifier = {
				modifier = media_coverage_negative_low
				days = 7200
			}
		}
		if = {
			limit = {
				has_modifier = media_coverage_positive_low
			}
			remove_modifier = media_coverage_positive_low
		}
		if = {
			limit = {
				has_modifier = media_coverage_positive_medium
			}
			remove_modifier = media_coverage_positive_medium
			add_modifier = {
				modifier = media_coverage_positive_low
				days = 7200
			}
		}
		if = {
			limit = {
				has_modifier = media_coverage_positive_high
			}
			remove_modifier = media_coverage_positive_high
			add_modifier = {
				modifier = media_coverage_positive_medium
				days = 7200
			}
		}
	}
}

add_observer_clue = {
	if = {
		limit = { is_observation_chain_active = yes }
		add_event_chain_counter = { 
			event_chain = "ancient_observer_chain" 
			counter = "observer_clues_found" 
			amount = 1 
		}
		hidden_effect = {
			country_event = { id = countryexpanded.321 days = 1 }
		}
	}
}

finish_observer_event = {
	end_event_chain = "ancient_observer_chain"
	add_monthly_resource_mult = {
		resource = unity
		value = @tier5unityreward
	}
	# give technology depending on source
	switch = {
		trigger = has_country_flag
		watchers_fe_xenophiles = {
			if = {
				limit = { NOT = { has_technology = tech_space_science_1 } }
				give_technology = { tech = tech_space_science_1 }
			}
			else_if = {
				limit = { NOT = { has_technology = tech_space_science_2 } }
				give_technology = { tech = tech_space_science_2 }
			}
			else_if = {
				limit = { NOT = { has_technology = tech_space_science_3 } }
				give_technology = { tech = tech_space_science_3 }
			}
			else_if = {
				limit = { NOT = { has_technology = tech_space_science_4 } }
				add_research_option = tech_space_science_4
				add_tech_progress = {
					tech = tech_space_science_4
					progress = 0.75
				}
			}
			else_if = {
				limit = { NOT = { has_technology = tech_space_science_5 } }
				add_research_option = tech_space_science_5
				add_tech_progress = {
					tech = tech_space_science_5
					progress = 0.5
				}
			}
			else = {
				add_monthly_resource_mult = {
					resource = physics_research
					value = @tier4researchreward
					min = @tier4researchmin
					max = @tier4researchmax
				}
			}
		}
		watchers_fe_xenophobes = {
			if = {
				limit = {
					NOT = { has_technology = tech_neural_implants }
					allows_slavery = yes
					is_gestalt = no
				}
				give_technology = { tech = tech_neural_implants }
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_alloys_1 }
				}
				give_technology = { tech = tech_alloys_1 }
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_alloys_2 }
				}
				add_research_option = tech_alloys_2
				add_tech_progress = {
					tech = tech_alloys_2
					progress = 0.75
				}
			}
			else = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier3researchreward
					min = @tier3researchmin
					max = @tier3researchmax
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
		}
		watchers_fe_materialists = {
			if = {
				limit = {
					NOT = { has_technology = tech_artificial_moral_codes }
					is_gestalt = no
				}
				add_research_option = tech_artificial_moral_codes
				add_tech_progress = {
					tech = tech_artificial_moral_codes
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_unity_of_purpose }
					is_gestalt = yes
				}
				add_research_option = tech_unity_of_purpose
				add_tech_progress = {
					tech = tech_unity_of_purpose
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_synthetic_thought_patterns }
					is_gestalt = no
				}
				add_research_option = tech_synthetic_thought_patterns
				add_tech_progress = {
					tech = tech_synthetic_thought_patterns
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_collective_production_methods }
					is_gestalt = yes
				}
				add_research_option = tech_collective_production_methods
				add_tech_progress = {
					tech = tech_collective_production_methods
					progress = 0.5
				}
			}
			else = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier4researchreward
					min = @tier4researchmin
					max = @tier4researchmax
				}
			}
		}
		watchers_fe_spiritualists = {
			if = {
				limit = {
					NOT = { has_technology = tech_genome_mapping }
					OR = {
						NOT = { has_authority = auth_machine_intelligence }
						has_civic = civic_machine_assimilator
						has_civic = civic_machine_servitor	
					}
				}
				give_technology = { tech = tech_genome_mapping }
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_gene_tailoring }
					OR = {
						NOT = { has_authority = auth_machine_intelligence }
						has_civic = civic_machine_assimilator
						has_civic = civic_machine_servitor	
					}
				}
				add_research_option = tech_gene_tailoring
				add_tech_progress = {
					tech = tech_gene_tailoring
					progress = 0.5
				}
			}
			else = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier4researchreward
					min = @tier4researchmin
					max = @tier4researchmax
				}
			}
		}
		watchers_curators = {
			if = {
				limit = { NOT = { has_technology = tech_space_science_1 } }
				give_technology = { tech = tech_space_science_1 }
			}
			else_if = {
				limit = { NOT = { has_technology = tech_space_science_2 } }
				give_technology = { tech = tech_space_science_2 }
			}
			else_if = {
				limit = { NOT = { has_technology = tech_space_science_3 } }
				add_research_option = tech_space_science_3
				add_tech_progress = {
					tech = tech_space_science_3
					progress = 0.75
				}
			}
			else_if = {
				limit = { NOT = { has_technology = tech_space_science_4 } }
				add_research_option = tech_space_science_4
				add_tech_progress = {
					tech = tech_space_science_4
					progress = 0.5
				}
			}
			else_if = {
				limit = { NOT = { has_technology = tech_space_science_5 } }
				add_research_option = tech_space_science_5
				add_tech_progress = {
					tech = tech_space_science_5
					progress = 0.25
				}
			}
			else = {
				add_monthly_resource_mult = {
					resource = physics_research
					value = @tier4researchreward
					min = @tier4researchmin
					max = @tier4researchmax
				}
			}
		}
		watchers_dead_slavers = {
			if = {
				limit = {
					NOT = { has_technology = tech_neural_implants }
					allows_slavery = yes
					is_gestalt = no
				}
				give_technology = { tech = tech_neural_implants }
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_alloys_1 }
				}
				give_technology = { tech = tech_alloys_1 }
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_alloys_2 }
				}
				add_research_option = tech_alloys_2
				add_tech_progress = {
					tech = tech_alloys_2
					progress = 0.75
				}
			}
			else = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier3researchreward
					min = @tier3researchmin
					max = @tier3researchmax
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
		}
		watchers_dead_experimentors = {
			if = {
				limit = {
					NOT = { has_technology = tech_artificial_moral_codes }
					is_gestalt = no
				}
				add_research_option = tech_artificial_moral_codes
				add_tech_progress = {
					tech = tech_artificial_moral_codes
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_unity_of_purpose }
					is_gestalt = yes
				}
				add_research_option = tech_unity_of_purpose
				add_tech_progress = {
					tech = tech_unity_of_purpose
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_synthetic_thought_patterns }
					is_gestalt = no
				}
				add_research_option = tech_synthetic_thought_patterns
				add_tech_progress = {
					tech = tech_synthetic_thought_patterns
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_collective_production_methods }
					is_gestalt = yes
				}
				add_research_option = tech_collective_production_methods
				add_tech_progress = {
					tech = tech_collective_production_methods
					progress = 0.5
				}
			}
			else = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier4researchreward
					min = @tier4researchmin
					max = @tier4researchmax
				}
			}
		}
		watchers_dead_watchers = {
			if = {
				limit = { NOT = { has_technology = tech_space_science_1 } }
				give_technology = { tech = tech_space_science_1 }
			}
			else_if = {
				limit = { NOT = { has_technology = tech_space_science_2 } }
				give_technology = { tech = tech_space_science_2 }
			}
			else_if = {
				limit = { NOT = { has_technology = tech_space_science_3 } }
				add_research_option = tech_space_science_3
				add_tech_progress = {
					tech = tech_space_science_3
					progress = 0.75
				}
			}
			else_if = {
				limit = { NOT = { has_technology = tech_space_science_4 } }
				add_research_option = tech_space_science_4
				add_tech_progress = {
					tech = tech_space_science_4
					progress = 0.5
				}
			}
			else_if = {
				limit = { NOT = { has_technology = tech_space_science_5 } }
				add_research_option = tech_space_science_5
				add_tech_progress = {
					tech = tech_space_science_5
					progress = 0.375
				}
			}
			else = {
				add_monthly_resource_mult = {
					resource = physics_research
					value = @tier4researchreward
					min = @tier4researchmin
					max = @tier4researchmax
				}
			}
		}
		watchers_dead_indoctrination = {
			if = {
				limit = { NOT = { has_technology = tech_genome_mapping } }
				give_technology = { tech = tech_genome_mapping }
			}
			else_if = {
				limit = { NOT = { has_technology = tech_gene_tailoring } }
				add_research_option = tech_gene_tailoring
				add_tech_progress = {
					tech = tech_gene_tailoring
					progress = 0.5
				}
			}
			else = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier4researchreward
					min = @tier4researchmin
					max = @tier4researchmax
				}
			}
		}
	}
}

create_human_infiltrated_spiritual_primitives = {
	random_country = {
		limit = {
			has_country_flag = human_1
		}
		owner_species = {
			save_event_target_as = human_species
		}
	}
	solar_system = { set_star_flag = primitive_system }
	create_species = {
		name = random
		class = random_non_machine
		portrait = random
		homeworld = THIS
		traits = {
			trait = trait_charismatic
			trait = random_traits
		}
	}
	last_created_species = {
		save_event_target_as = primitive_species
	}
	create_country = {
		name = random
		authority = random
		civics = {
			civic = civic_increasing_urbanization
			civic = civic_atmospheric_pollution
		}
		species = last_created_species
		ethos = {
			ethic = "ethic_egalitarian"
			ethic = "ethic_xenophile"
			ethic = "ethic_spiritualist"
		}
		origin = "origin_enlightened"
		flag = {
			icon = {
				category = "spherical"
				file = "flag_spherical_22.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"turquoise"
				"green"
				"null"
				"null"
			}
		}
		type = primitive
	}
	last_created_country = {
		set_graphical_culture = industrial_01
		set_country_flag = acquired_tech
		set_country_flag = human_primitive
		save_event_target_as = primitive_civ
		random_list = {
			33 = { 
				set_country_flag = machine_age
				set_primitive_age = machine_age
				change_country_flag = {
					icon = {
						category = "special"
						file = "primitive.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"yellow"
						"orange"
						"null"
						"null"
					}
				}
			}
			33 = { 
				set_country_flag = atomic_age 
				set_primitive_age = atomic_age
				change_country_flag = {
					icon = {
						category = "special"
						file = "primitive.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"beige"
						"brown"
						"null"
						"null"
					}
				}
			}
			34 = { 
				set_country_flag = early_space_age 
				set_primitive_age = early_space_age
				change_country_flag = {
					icon = {
						category = "special"
						file = "primitive.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"grey"
						"dark_grey"
						"null"
						"null"
					}
				}
			}
		}
	}
	create_colony = {
		owner = last_created_country
		species = last_created_species
		ethos = owner
	}
	last_created_country = {
		if = {
			limit = { has_country_flag = machine_age }
			prev = {
				while = {
					count = 18
					create_pop = {
						species = last_created_species
					}					
				}
				add_building = building_primitive_farm
				add_building = building_primitive_factory
				add_building = building_primitive_mine
				add_building = building_primitive_power_plant
				add_building = building_primitive_capital
				add_building = building_urban_dwellings
				remove_building = building_colony_shelter
			}
		}
		if = {
			limit = { has_country_flag = atomic_age }
			prev = {
				while = {
					count = 20
					create_pop = {
						species = last_created_species
					}					
				}
				add_building = building_primitive_farm
				add_building = building_primitive_factory
				add_building = building_primitive_mine

				add_building = building_primitive_power_plant
				add_building = building_primitive_capital
				add_building = building_urban_dwellings
				remove_building = building_colony_shelter
			}
		}
		if = {
			limit = { has_country_flag = early_space_age }
			prev = {
				while = {
					count = 22
					create_pop = {
						species = last_created_species
					}					
				}
				add_building = building_primitive_farm
				add_building = building_primitive_factory
				add_building = building_primitive_mine

				add_building = building_primitive_power_plant
				add_building = building_primitive_capital
				add_building = building_urban_dwellings
				remove_building = building_colony_shelter
				create_fleet = {
					name = "NAME_Space_Station"
					effect = {
						set_owner = PREV.owner
						create_ship = {
							name = "NAME_Space_Station"
							design = "NAME_Space_Station"
						}
						set_location = PREV
					}
				}
			}
		}
	}
	while = {
		count = 6
		create_pop = {
			species = event_target:human_species
		}					
	}
	create_primitive_blockers = yes
}

create_human_infiltrated_materialist_primitives = {
	random_country = {
		limit = {
			has_country_flag = human_1
		}
		owner_species = {
			save_event_target_as = human_species
		}
	}
	solar_system = { set_star_flag = primitive_system }
	create_species = {
		name = random
		class = random_non_machine
		portrait = random
		homeworld = THIS
		traits = {
			trait = trait_charismatic
			trait = random_traits
		}
	}
	last_created_species = {
		save_event_target_as = primitive_species
	}
	create_country = {
		name = random
		authority = random
		civics = {
			civic = civic_increasing_urbanization
			civic = civic_atmospheric_pollution
		}
		species = last_created_species
		ethos = {
			ethic = "ethic_egalitarian"
			ethic = "ethic_xenophile"
			ethic = "ethic_materialist"
		}
		origin = "origin_enlightened"
		flag = {
			icon = {
				category = "spherical"
				file = "flag_spherical_22.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"turquoise"
				"green"
				"null"
				"null"
			}
		}
		type = primitive
	}
	last_created_country = {
		set_graphical_culture = industrial_01
		set_country_flag = acquired_tech
		set_country_flag = human_primitive
		save_event_target_as = primitive_civ
		random_list = {
			33 = { 
				set_country_flag = machine_age
				set_primitive_age = machine_age
				change_country_flag = {
					icon = {
						category = "special"
						file = "primitive.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"yellow"
						"orange"
						"null"
						"null"
					}
				}
			}
			33 = { 
				set_country_flag = atomic_age 
				set_primitive_age = atomic_age
				change_country_flag = {
					icon = {
						category = "special"
						file = "primitive.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"beige"
						"brown"
						"null"
						"null"
					}
				}
			}
			34 = { 
				set_country_flag = early_space_age 
				set_primitive_age = early_space_age
				change_country_flag = {
					icon = {
						category = "special"
						file = "primitive.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"grey"
						"dark_grey"
						"null"
						"null"
					}
				}
			}
		}
	}
	create_colony = {
		owner = last_created_country
		species = last_created_species
		ethos = owner
	}
	last_created_country = {
		if = {
			limit = { has_country_flag = machine_age }
			prev = {
				while = {
					count = 18
					create_pop = {
						species = last_created_species
					}					
				}
				add_building = building_primitive_farm
				add_building = building_primitive_factory
				add_building = building_primitive_mine

				add_building = building_primitive_power_plant
				add_building = building_primitive_capital
				add_building = building_urban_dwellings
				remove_building = building_colony_shelter
			}
		}
		if = {
			limit = { has_country_flag = atomic_age }
			prev = {
				while = {
					count = 20
					create_pop = {
						species = last_created_species
					}					
				}
				add_building = building_primitive_farm
				add_building = building_primitive_factory
				add_building = building_primitive_mine

				add_building = building_primitive_power_plant
				add_building = building_primitive_capital
				add_building = building_urban_dwellings
				remove_building = building_colony_shelter
			}
		}
		if = {
			limit = { has_country_flag = early_space_age }
			prev = {
				while = {
					count = 22
					create_pop = {
						species = last_created_species
					}					
				}
				add_building = building_primitive_farm
				add_building = building_primitive_factory
				add_building = building_primitive_mine

				add_building = building_primitive_power_plant
				add_building = building_primitive_capital
				add_building = building_urban_dwellings
				remove_building = building_colony_shelter
				create_fleet = {
					name = "NAME_Space_Station"
					effect = {
						set_owner = PREV.owner
						create_ship = {
							name = "NAME_Space_Station"
							design = "NAME_Space_Station"
						}
						set_location = PREV
					}
				}
			}
		}
	}
	while = {
		count = 6
		create_pop = {
			species = event_target:human_species
		}					
	}
	create_primitive_blockers = yes
}

create_human_infiltrated_pacifist_primitives = {
	random_country = {
		limit = {
			has_country_flag = human_1
		}
		owner_species = {
			save_event_target_as = human_species
		}
	}
	solar_system = { set_star_flag = primitive_system }
	create_species = {
		name = random
		class = random_non_machine
		portrait = random
		homeworld = THIS
		traits = {
			trait = trait_charismatic
			trait = random_traits
		}
	}
	last_created_species = {
		save_event_target_as = primitive_species
	}
	create_country = {
		name = random
		authority = random
		civics = {
			civic = civic_increasing_urbanization
			civic = civic_atmospheric_pollution
		}
		species = last_created_species
		ethos = {
			ethic = "ethic_egalitarian"
			ethic = "ethic_xenophile"
			ethic = "ethic_pacifist"
		}
		origin = "origin_enlightened"
		flag = {
			icon = {
				category = "spherical"
				file = "flag_spherical_22.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"turquoise"
				"green"
				"null"
				"null"
			}
		}
		type = primitive
	}
	last_created_country = {
		set_graphical_culture = industrial_01
		set_country_flag = acquired_tech
		set_country_flag = human_primitive
		save_event_target_as = primitive_civ
		random_list = {
			33 = { 
				set_country_flag = machine_age
				set_primitive_age = machine_age
				change_country_flag = {
					icon = {
						category = "special"
						file = "primitive.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"yellow"
						"orange"
						"null"
						"null"
					}
				}
			}
			33 = { 
				set_country_flag = atomic_age 
				set_primitive_age = atomic_age
				change_country_flag = {
					icon = {
						category = "special"
						file = "primitive.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"beige"
						"brown"
						"null"
						"null"
					}
				}
			}
			34 = { 
				set_country_flag = early_space_age 
				set_primitive_age = early_space_age
				change_country_flag = {
					icon = {
						category = "special"
						file = "primitive.dds"
					}
					background= {
						category = "backgrounds"
						file = "new_dawn.dds"
					}
					colors={
						"grey"
						"dark_grey"
						"null"
						"null"
					}
				}
			}
		}
	}
	create_colony = {
		owner = last_created_country
		species = last_created_species
		ethos = owner
	}
	last_created_country = {
		if = {
			limit = { has_country_flag = machine_age }
			prev = {
				while = {
					count = 18
					create_pop = {
						species = last_created_species
					}					
				}
				add_building = building_primitive_farm
				add_building = building_primitive_factory
				add_building = building_primitive_mine

				add_building = building_primitive_power_plant
				add_building = building_primitive_capital
				add_building = building_urban_dwellings
				remove_building = building_colony_shelter
			}
		}
		if = {
			limit = { has_country_flag = atomic_age }
			prev = {
				while = {
					count = 20
					create_pop = {
						species = last_created_species
					}					
				}
				add_building = building_primitive_farm
				add_building = building_primitive_factory
				add_building = building_primitive_mine

				add_building = building_primitive_power_plant
				add_building = building_primitive_capital
				add_building = building_urban_dwellings
				remove_building = building_colony_shelter
			}
		}
		if = {
			limit = { has_country_flag = early_space_age }
			prev = {
				while = {
					count = 22
					create_pop = {
						species = last_created_species
					}					
				}
				add_building = building_primitive_farm
				add_building = building_primitive_factory
				add_building = building_primitive_mine

				add_building = building_primitive_power_plant
				add_building = building_primitive_capital
				add_building = building_urban_dwellings
				remove_building = building_colony_shelter
				create_fleet = {
					name = "NAME_Space_Station"
					effect = {
						set_owner = PREV.owner
						create_ship = {
							name = "NAME_Space_Station"
							design = "NAME_Space_Station"
						}
						set_location = PREV
					}
				}
			}
		}
	}
	while = {
		count = 6
		create_pop = {
			species = event_target:human_species
		}					
	}
	create_primitive_blockers = yes
}

# dportal, chance for random event
dportal_planet_random_event = {
	random_list = {
		100 = { }
		# unemployed volunteers
		5 = { planet_event = { id = colonyexpanded.503 days = 60 random = 180 } }
		# Asks for alloys
		5 = {
			modifier = {
				factor = 0.5
				owner = { has_country_flag = dportal_empire_precursor_alloys }
			}
			planet_event = { id = colonyexpanded.504 days = 60 random = 180 }
		}
		# Asks for food
		3 = { planet_event = { id = colonyexpanded.505 days = 60 random = 180 } }
		# Live Warp Beast
		3 = { planet_event = { id = colonyexpanded.506 days = 60 random = 180 } }
		# Gas for Plasma
		4 = { planet_event = { id = colonyexpanded.508 days = 60 random = 180 } }
		# Asks for consumer goods / minerals
		5 = { planet_event = { id = colonyexpanded.509 days = 60 random = 180 } }
		# Weapons Research
		5 = { planet_event = { id = colonyexpanded.510 days = 60 random = 180 } }
		# Crystals for Lasers
		4 = { planet_event = { id = colonyexpanded.512 days = 60 random = 180 } }
		# Find precursor foundry
		2 = { planet_event = { id = colonyexpanded.513 days = 60 random = 180 } }
		# Mirror criminals flee justice
		3 = { planet_event = { id = colonyexpanded.514 days = 60 random = 180 } }
		# Warp beast counterattack
		4 = { planet_event = { id = colonyexpanded.515 days = 60 random = 180 } }
		# Mirror universe counterattack
		3 = { planet_event = { id = colonyexpanded.516 days = 60 random = 180 } }
		# Plan attack on Warp beast stronghold
		# Close a portal (rare, requires warp breach research event)
		# Another portal opens (requires warp breach research event)
		# Prevent portals reopening (requires warp breach research event)
	}
}

# dportal, root is planet
dportal_empire_victory_increase = {
	planet_event = { id = colony.3031 days = 60 random = 360 } # trade up
}
dportal_empire_crisis_increase = {
	planet_event = { id = colony.3032 days = 60 random = 360 } # trade down
}