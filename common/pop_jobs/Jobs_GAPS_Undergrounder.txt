#[8:51 PM] AlienFromBeyond: btw just in case it wasn't clear, I think just the regular resource + research underground jobs should be workers, the alloy + consumer goods should definitely be specialists (that's what both of what it takes from are), and the functionaries are fine as specialists because you don't need to build that many of them (you focus on them in the same way when specializing a planet), the soldier ones I guess can stay specialists too because of how much unity you can make with them

#EDIT: Add in a one-time fixer event that gives a temporary -100% pop demotion time when you do the change so that current specialist pops can go back to work as workers.
GAPS_undergrounder_technician = {
	category = worker
	condition_string = WORKER_JOB_TRIGGER
	building_icon = GAPS_Underground_Energy_Grid
	clothes_texture_index = 2
	
	possible = {
		hidden_trigger = { exists = owner }
		complex_specialist_job_check_trigger = yes
		owner = { 
			is_gestalt = no
			is_fallen_empire_spiritualist = no
		}
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		}
	}

	resources = {
		category = planet_GAPS_UndergrounderJobs
		produces = {
			energy = 3
			physics_research = 9
		}
		produces = {
			trigger = { 
				owner = { has_valid_civic = civic_technocracy }
			}
			unity = 1
		}
		upkeep = {
			consumer_goods = 0.5
		}
	}	
	planet_modifier = {
		planet_GAPS_UndergrounderJobs_energy_produces_mult = 0.025
		planet_GAPS_UndergrounderJobs_physics_research_produces_mult = 0.025
	}
	#research
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_enigmatic_intelligence 
		}
		modifier = {
			planet_jobs_produces_mult = 0.1
		}
	}
	#research
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_erudite 
		}
		modifier = {
			planet_jobs_produces_mult = 0.2
		}
	}
	
	weight = {
		weight = @worker_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 2
			OR = {
				has_trait = trait_robot_superconductive
				has_trait = trait_ingenious
				has_trait = trait_nuumismatic_administration
			}
		}
		modifier = {
			factor = 8
			is_enslaved = yes
			can_take_servant_job = no
			NOR = {
				has_trait = trait_syncretic_proles
				has_trait = trait_nuumismatic_administration
				has_trait = trait_robot_superconductive
				has_trait = trait_ingenious
			}
		}
		modifier = {
			factor = 2
			OR = {
				is_non_sapient_robot = yes
				is_shackled_robot = yes
			}
			can_take_servant_job = no
		}
		modifier = {
			factor = 0.25
			can_take_servant_job = yes
		}
		modifier = {
			factor = 1.5
			has_trait = trait_syncretic_proles
		}
		modifier = {
			factor = 4
			species = {
				has_species_flag = racket_species_flag
			}
		}
		modifier = {
			factor = 1.2
			has_trait = trait_very_strong
		}
		modifier = {
			factor = 1.1
			has_trait = trait_strong
		}
		modifier = {
			factor = 0.9
			has_trait = trait_weak
		}
		modifier = {
			factor = 1.3
			has_trait = trait_psionic
		}
		modifier = {
			factor = 1.2
			has_trait = trait_latent_psionic
		}
		modifier = {
			factor = 1.5
			has_trait = trait_presapient_earthbound
		}
		modifier = {
			factor = 1.1
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 1.1
			has_trait = trait_nerve_stapled
		}
		modifier = {
			factor = 1.5
			has_trait = trait_void_dweller_1
		}

		#modifier = {
		#	factor = 500
		#	planet = {
		#		owner = {
		#			is_megacorp = yes
		#		}
		#	}
		#}

		# low income modifier
		modifier = {
			factor = 1.2

			OR = {
				is_unemployed = yes
				has_job = "technician"
			}
			exists = planet
			planet = {
				has_available_jobs = "technician"
			}
			owner = {
				has_monthly_income = {
					resource = energy
					value < 0
				}
			}
		}
		modifier = {
			factor = 0.2
			has_citizenship_rights = no
			NOT = { has_trait = trait_mechanical }
		}
		modifier = {
			factor = 2
			has_living_standard = { type = living_standard_academic_privilege }
		}
		modifier = {
			factor = 3
			has_trait = trait_erudite
		}
		modifier = {
			factor = 2
			OR = {
				has_trait = trait_robot_logic_engines
				has_trait = trait_intelligent
			}
		}
		modifier = {
			factor = 2
			has_trait = trait_brainslug
		}
		modifier = {
			factor = 1.5
			OR = {
				has_trait = trait_natural_engineers
				has_trait = trait_natural_physicists
				has_trait = trait_natural_sociologists
			}
		}
		modifier = {
			factor = 0.1
			can_take_servant_job = yes
		}
		modifier = {
			factor = 0.65
			has_trait = trait_presapient_proles
		}
		modifier = {
			factor = 1.5
			has_job = researcher
		}
		modifier = {
			factor = 1.5
			has_trait = trait_latent_psionic
		}
		modifier = {
			factor = 2
			has_trait = trait_psionic
		}
		modifier = {
			factor = 0.1
			has_trait = trait_enigmatic_intelligence_failed
		}
		modifier = {
			factor = 2
			OR = {
				has_trait = trait_enigmatic_intelligence
				has_trait = trait_enigmatic_intelligence_poor
			}
		}
		modifier = {
			factor = 2
			has_trait = trait_presapient_natural_intellectuals
		}
		modifier = {
			factor = 1.5
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 0.8
			is_enslaved = yes
			has_slavery_type = { type = slavery_indentured }
		}
		modifier = {
			factor = 1.5
			has_trait = trait_void_dweller_1
		}			
	}
}

GAPS_undergrounder_miner = {	
	category = worker
	condition_string = WORKER_JOB_TRIGGER
	building_icon = GAPS_Underground_Mineral_Production
	clothes_texture_index = 2

	possible = {
		hidden_trigger = { exists = owner }
		specialist_job_check_trigger = yes
		owner = { 
			is_gestalt = no
			is_fallen_empire_spiritualist = no
		}
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		}
	}

	resources = {
		category = planet_GAPS_UndergrounderJobs
		produces = {
			minerals = 3
			engineering_research = 9
		}
		produces = {
			trigger = { 
				owner = { has_valid_civic = civic_technocracy }
			}
			unity = 1
		}
	}	
	
	planet_modifier = {
		planet_GAPS_UndergrounderJobs_minerals_produces_mult = 0.025
		planet_GAPS_UndergrounderJobs_engineering_research_produces_mult = 0.025
	}
	#research
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_enigmatic_intelligence 
		}
		modifier = {
			planet_jobs_produces_mult = 0.1
		}
	}
	#research
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_erudite 
		}
		modifier = {
			planet_jobs_produces_mult = 0.2
		}
	}
	
	weight = {
		weight = @worker_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 3
			OR = {
				has_trait = trait_industrious
				has_trait = trait_robot_power_drills
			}
		}
		modifier = {
			factor = 10
			is_enslaved = yes
			can_take_servant_job = no
		}
		modifier = {
			factor = 3
			OR = {
				is_non_sapient_robot = yes
				is_shackled_robot = yes
			}
			can_take_servant_job = no
			owner = { has_technology = tech_droid_workers }
		}
		modifier = {
			factor = 200
			OR = {
				is_non_sapient_robot = yes
				is_shackled_robot = yes
			}
			can_take_servant_job = no
			owner = { NOT = { has_technology = tech_droid_workers } }
		}
		modifier = {
			factor = 0.25
			can_take_servant_job = yes
		}
		modifier = {
			factor = 2
			species = {
				has_species_flag = racket_species_flag
			}
		}
		modifier = {
			factor = 1.2
			has_trait = trait_very_strong
		}
		modifier = {
			factor = 1.1
			has_trait = trait_strong
		}
		modifier = {
			factor = 0.9
			has_trait = trait_weak
		}
		modifier = {
			factor = 1.5
			has_trait = trait_syncretic_proles
		}
		modifier = {
			factor = 1.4
			has_trait = trait_presapient_proles
		}
		modifier = {
			factor = 1.1
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 1.1
			has_trait = trait_nerve_stapled
		}
		modifier = {
			factor = 1.5
			has_trait = trait_void_dweller_1
		}

		# low income modifier
		modifier = {
			factor = 1.1

			OR = {
				is_unemployed = yes
				has_job = "miner"
			}
			exists = planet
			planet = {
				has_available_jobs = "miner"
			}
			owner = {
				has_monthly_income = {
					resource = minerals
					value < 30
				}
			}
		}
		modifier = {
			factor = 0.2
			has_citizenship_rights = no
			NOT = { has_trait = trait_mechanical }
		}
		modifier = {
			factor = 2
			has_living_standard = { type = living_standard_academic_privilege }
		}
		modifier = {
			factor = 3
			has_trait = trait_erudite
		}
		modifier = {
			factor = 2
			OR = {
				has_trait = trait_robot_logic_engines
				has_trait = trait_intelligent
			}
		}
		modifier = {
			factor = 2
			has_trait = trait_brainslug
		}
		modifier = {
			factor = 1.5
			OR = {
				has_trait = trait_natural_engineers
				has_trait = trait_natural_physicists
				has_trait = trait_natural_sociologists
			}
		}
		modifier = {
			factor = 0.1
			can_take_servant_job = yes
		}
		modifier = {
			factor = 0.65
			has_trait = trait_presapient_proles
		}
		modifier = {
			factor = 1.5
			has_job = researcher
		}
		modifier = {
			factor = 1.5
			has_trait = trait_latent_psionic
		}
		modifier = {
			factor = 2
			has_trait = trait_psionic
		}
		modifier = {
			factor = 0.1
			has_trait = trait_enigmatic_intelligence_failed
		}
		modifier = {
			factor = 2
			OR = {
				has_trait = trait_enigmatic_intelligence
				has_trait = trait_enigmatic_intelligence_poor
			}
		}
		modifier = {
			factor = 2
			has_trait = trait_presapient_natural_intellectuals
		}
		modifier = {
			factor = 1.5
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 0.8
			is_enslaved = yes
			has_slavery_type = { type = slavery_indentured }
		}
		modifier = {
			factor = 1.5
			has_trait = trait_void_dweller_1
		}			
	}
}
GAPS_undergrounder_farmer = {
	category = worker
	condition_string = WORKER_JOB_TRIGGER
	building_icon = GAPS_Subterrestrial_City
	clothes_texture_index = 2
	
	possible = {
		hidden_trigger = { exists = owner }
		specialist_job_check_trigger = yes
		owner = { 
			is_gestalt = no
			is_fallen_empire_spiritualist = no
		}
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		} 
	}

	resources = {
		category = planet_GAPS_UndergrounderJobs
		produces = {
			food = 4
			society_research = 9
		}
		produces = {
			trigger = {
				exists = owner
				owner = { has_valid_civic = civic_technocracy }
			}
			unity = 1
		}
		produces = {
			trigger = {
				exists = owner
				owner = {
					is_robot_empire = yes
				}
			}
			food = -1
		}
		upkeep = {
			consumer_goods = 0.5
		}
	}	
	planet_modifier = {
		planet_amenities_add = 1
	}
	
	planet_modifier = {
		planet_GAPS_UndergrounderJobs_food_produces_mult = 0.025
		planet_GAPS_UndergrounderJobs_society_research_produces_mult = 0.025
	}
	#research
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_enigmatic_intelligence 
		}
		modifier = {
			planet_jobs_produces_mult = 0.1
		}
	}
	#research
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_erudite 
		}
		modifier = {
			planet_jobs_produces_mult = 0.2
		}
	}
	triggered_planet_modifier = {
		potential = {
			owner = { has_valid_civic = civic_agrarian_idyll }
		}
		modifier = {
			planet_amenities_add = 2
		}
	}
	triggered_planet_modifier = {
		potential = {
			owner = { has_valid_civic = civic_agrarian_idyll }
			OR = {
				has_trait = trait_robot_domestic_protocols
				has_trait = trait_charismatic
			}			
		}
		modifier = {
			planet_amenities_add = 0.4
		}
	}	
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { has_valid_civic = civic_agrarian_idyll }
		}
		modifier = {
			planet_amenities_add = 2
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { has_valid_civic = civic_agrarian_idyll }
			OR = {
				has_trait = trait_robot_domestic_protocols
				has_trait = trait_charismatic
			}
		}
		modifier = {
			planet_amenities_add = 0.4
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { has_valid_civic = civic_agrarian_idyll }
			has_trait = trait_repugnant
		}
		modifier = {
			planet_amenities_add = -0.4
		}
	}
	
	weight = {
		weight = @worker_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 3
			OR = {
				has_trait = trait_robot_harvesters
				has_trait = trait_agrarian
			}
		}
		modifier = {
			factor = 1.1
			owner = { has_valid_civic = civic_agrarian_idyll }
		}
		modifier = {
			factor = 10
			is_enslaved = yes
			can_take_servant_job = no
		}
		modifier = {
			factor = 3
			OR = {
				is_non_sapient_robot = yes
				is_shackled_robot = yes
			}
			can_take_servant_job = no
			owner = { has_technology = tech_droid_workers }
		}
		modifier = {
			factor = 200
			OR = {
				is_non_sapient_robot = yes
				is_shackled_robot = yes
			}
			can_take_servant_job = no
			owner = { NOT = { has_technology = tech_droid_workers } }
		}
		modifier = {
			factor = 0.25
			can_take_servant_job = yes
		}
		modifier = {
			factor = 2
			has_trait = trait_syncretic_proles
		}
		modifier = {
			factor = 1.2
			has_trait = trait_very_strong
		}
		modifier = {
			factor = 1.1
			has_trait = trait_strong
		}
		modifier = {
			factor = 0.9
			has_trait = trait_weak
		}
		modifier = {
			factor = 1.5
			has_trait = trait_syncretic_proles
		}
		modifier = {
			factor = 1.4
			has_trait = trait_presapient_proles
		}
		modifier = {
			factor = 1.1
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 1.1
			has_trait = trait_nerve_stapled
		}
		modifier = {
			factor = 1.5
			owner = { has_valid_civic = civic_agrarian_idyll }
			OR = {
				has_trait = trait_robot_domestic_protocols
				has_trait = trait_charismatic
			}
		}
		modifier = {
			factor = 0.5
			owner = { has_valid_civic = civic_agrarian_idyll }
			has_trait = trait_repugnant
		}
		modifier = {
			factor = 1.5
			has_trait = trait_void_dweller_1
		}

		# low income modifier
		modifier = {
			factor = 1.2

			OR = {
				is_unemployed = yes
				has_job = farmer
			}
			exists = planet
			planet = {
				has_available_jobs = farmer
			}
			owner = {
				has_monthly_income = {
					resource = food
					value < 0
				}
			}
		}

		modifier = {
			factor = 0.5
			has_trait = trait_lithoid

			owner = {
				is_lithoid_empire = yes
				has_monthly_income = {
					resource = food
					value >= 0
				}
			}
		}
		modifier = {
			factor = 0.2
			has_citizenship_rights = no
			NOT = { has_trait = trait_mechanical }
		}
		modifier = {
			factor = 2
			has_living_standard = { type = living_standard_academic_privilege }
		}
		modifier = {
			factor = 3
			has_trait = trait_erudite
		}
		modifier = {
			factor = 2
			OR = {
				has_trait = trait_robot_logic_engines
				has_trait = trait_intelligent
			}
		}
		modifier = {
			factor = 2
			has_trait = trait_brainslug
		}
		modifier = {
			factor = 1.5
			OR = {
				has_trait = trait_natural_engineers
				has_trait = trait_natural_physicists
				has_trait = trait_natural_sociologists
			}
		}
		modifier = {
			factor = 0.1
			can_take_servant_job = yes
		}
		modifier = {
			factor = 0.65
			has_trait = trait_presapient_proles
		}
		modifier = {
			factor = 1.5
			has_job = researcher
		}
		modifier = {
			factor = 1.5
			has_trait = trait_latent_psionic
		}
		modifier = {
			factor = 2
			has_trait = trait_psionic
		}
		modifier = {
			factor = 0.1
			has_trait = trait_enigmatic_intelligence_failed
		}
		modifier = {
			factor = 2
			OR = {
				has_trait = trait_enigmatic_intelligence
				has_trait = trait_enigmatic_intelligence_poor
			}
		}
		modifier = {
			factor = 2
			has_trait = trait_presapient_natural_intellectuals
		}
		modifier = {
			factor = 1.5
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 0.8
			is_enslaved = yes
			has_slavery_type = { type = slavery_indentured }
		}
		modifier = {
			factor = 1.5
			has_trait = trait_void_dweller_1
		}
	}
}

GAPS_undergrounder_soldier = {
	category = specialist
	condition_string = SPECIALIST_JOB_TRIGGER	
	building_icon = GAPS_Underground_Stronghold
	clothes_texture_index = 4
	
	
	possible = {
		hidden_trigger = { exists = owner }
		specialist_job_check_trigger = yes
		owner = { is_gestalt = no }
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		}
	}
	
	resources = {
		category = planet_GAPS_UndergrounderJobs
		produces = {
			trigger = {
				exists = owner
			}
			unity = 3
		}
		produces = {
			trigger = {
				exists = owner
				owner = { has_valid_civic = civic_citizen_service }
			}
			unity = 2
		}
		produces = {
			trigger = {
				exists = owner
				owner = { has_valid_civic = civic_police_state }
			}
			unity = 1
		}
		upkeep = {
			trigger = {
				exists = planet
				planet = { has_modifier = anticrime_campaign }
			}
			energy = 2
		}
	}
	
	planet_modifier = {
		planet_GAPS_UndergrounderJobs_unity_produces_mult = 0.025
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_weak 
		}
		modifier = {
			planet_jobs_produces_mult = -0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_strong
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_very_strong 
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	country_modifier = {
		country_naval_cap_add = 3
	}
	
	triggered_country_modifier = {
		potential = {
			planet = {
				exists = owner 
				owner = { has_technology = "tech_ground_defense_planning" }
			}
		}
		modifier = {
			country_naval_cap_add = 2
		}
	}	
	
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { has_non_swapped_tradition = tr_domination_judgment_corps }
		}
		modifier = {
			planet_crime_add = -5
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet
			planet = { has_modifier = anticrime_campaign }
		}
		modifier = {
			planet_crime_add = -10
		}
	}
	pop_modifier = {
		pop_defense_armies_add = 3
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet
			planet = {
				has_modifier = martial_law
			}
		}
		modifier = {
			planet_stability_add = 5
		}
	}
	
	weight = {
		weight = @soldier_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 10
			exists = planet
			planet = { has_modifier = martial_law }
		}
		modifier = {
			factor = 2
			has_trait = trait_resilient
		}
		modifier = {
			factor = 2
			has_trait = trait_very_strong
		}
		modifier = {
			factor = 1.5
			has_trait = trait_strong
		}
		modifier = {
			factor = 0.5
			has_trait = trait_weak
		}
		modifier = {
			factor = 0.1
			is_enslaved = yes
			NOT = { has_slavery_type = { type = slavery_military } }
		}
		modifier = {
			factor = 10
			is_enslaved = yes
			has_slavery_type = { type = slavery_military }
		}
		modifier = {
			factor = 0.1
			can_take_servant_job = yes
		}
		modifier = {
			factor = 1.1
			has_trait = trait_cybernetic
		}
		modifier = {
			factor = 2
			has_trait = trait_presapient_earthbound
		}
		modifier = {
			factor = 1.1
			has_trait = trait_limited_regeneration
		}
		modifier = {
			factor = 1.1
			has_trait = trait_presapient_proles
		}
		modifier = {
			factor = 1.1
			has_trait = trait_brainslug
		}
		modifier = {
			factor = 1.05
			has_trait = trait_presapient_natural_intellectuals
		}
		modifier = {
			factor = 1.05
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 1.05
			has_trait = trait_nerve_stapled
		}
		modifier = {
			factor = 1.1
			OR = {
				has_trait = trait_robot_propaganda_machines
				has_trait = trait_traditional
			}
		}
		modifier = {
			factor = 0.9
			has_trait = trait_quarrelsome
		}
		modifier = {
			factor = 0
			can_be_soldier = no
		}
		modifier = {
			factor = 0.2
			has_citizenship_rights = no
			NOT = { has_trait = trait_mechanical }
		}
		modifier = {
			factor = 2
			has_trait = trait_resilient
		}
		modifier = {
			factor = 2
			has_trait = trait_very_strong
		}
		modifier = {
			factor = 1.5
			has_trait = trait_strong
		}
		modifier = {
			factor = 10
			is_enslaved = yes
			has_slavery_type = { type = slavery_military }
		}
		modifier = {
			factor = 0.50
			has_trait = trait_weak
		}
		modifier = {
			factor = 0.1
			can_take_servant_job = yes
		}
		modifier = {
			factor = 10
			has_job = enforcer
		}
		modifier = {
			factor = 1.1
			has_trait = trait_cybernetic
		}
		modifier = {
			factor = 2
			has_trait = trait_presapient_earthbound
		}
		modifier = {
			factor = 1.1
			has_trait = trait_limited_regeneration
		}
		modifier = {
			factor = 1.1
			has_trait = trait_presapient_proles
		}
		modifier = {
			factor = 1.1
			has_trait = trait_brainslug
			exists = owner
			owner = { has_valid_civic = civic_police_state }
		}
		modifier = {
			factor = 1.05
			has_trait = trait_presapient_natural_intellectuals
			exists = owner
			owner = { has_valid_civic = civic_police_state }
		}
		modifier = {
			factor = 20
			has_job = enforcer
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 1.1
			OR = {
				has_trait = trait_robot_propaganda_machines
				has_trait = trait_traditional
			}
			exists = owner
			owner = { has_valid_civic = civic_police_state }
		}
		modifier = {
			factor = 0.9
			has_trait = trait_quarrelsome
		}
		modifier = {
			factor = 0.8
			is_enslaved = yes
			has_slavery_type = { type = slavery_indentured }
		}
	}
}

GAPS_undergrounder_foundry = {
	category = specialist
	condition_string = SPECIALIST_JOB_TRIGGER
	building_icon = GAPS_Underground_Foundry
	clothes_texture_index = 3

	possible = {
		specialist_job_check_trigger = yes
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		}
	}
	
	resources = {
		category = planet_GAPS_UndergrounderJobs
		produces = {
			alloys = 3
			consumer_goods = 3
		}
		upkeep = {
			minerals = 9
		}
	}
	planet_modifier = {
		planet_GAPS_UndergrounderJobs_consumer_goods_produces_mult = 0.01
		planet_GAPS_UndergrounderJobs_alloys_produces_mult = 0.01
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_weak 
		}
		modifier = {
			planet_jobs_produces_mult = -0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_strong
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_very_strong 
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	
	weight = {
		weight = @specialist_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 0.2
			has_citizenship_rights = no
			NOT = { has_trait = trait_mechanical }
		}
		modifier = {
			factor = 0.1
			can_take_servant_job = yes
		}
		modifier = {
			factor = 2
			species = {
				has_species_flag = racket_species_flag
			}
		}
		modifier = {
			factor = 5
			has_job = foundry
		}
		modifier = {
			factor = 15
			has_job = foundry
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 1.2
			is_enslaved = yes
			has_slavery_type = { type = slavery_indentured }
		}
		modifier = {
			factor = 1.5
			has_trait = trait_void_dweller_1
		}
		modifier = {
			factor = 0.2
			has_citizenship_rights = no
			NOT = { has_trait = trait_mechanical }
		}
		modifier = {
			factor = 0.1
			can_take_servant_job = yes
		}
		modifier = {
			factor = 5
			has_job = artisan
		}
		modifier = {
			factor = 10
			has_job = artisan
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 1.2
			is_enslaved = yes
			has_slavery_type = { type = slavery_indentured }
		}
		modifier = {
			factor = 1.5
			has_trait = trait_void_dweller_1
		}
	}
}
GAPS_undergrounder_cubical = {
	category = specialist
	condition_string = SPECIALIST_JOB_TRIGGER	
	building_icon = GAPS_Underground_Stronghold
	clothes_texture_index = 4
	
	possible = {
		hidden_trigger = { exists = owner }
		specialist_job_check_trigger = yes
		owner = { is_gestalt = no }
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		}
	}

	country_modifier = {
		country_admin_cap_add = 7.5
	}

	resources = {
		category = planet_GAPS_UndergrounderJobs
		upkeep = {
			consumer_goods = 0.5
		}
		produces = {
			trigger = {
				exists = owner
				owner = { has_valid_civic = civic_byzantine_bureaucracy }
			}
			unity = 1
		}
	}
	planet_modifier = {
		planet_amenities_add = 1.5
		trade_value_add = 1.5
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_weak 
		}
		modifier = {
			planet_jobs_produces_mult = -0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_strong
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_very_strong 
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	triggered_planet_modifier = {
		potential = {
			OR = {
				has_trait = trait_robot_domestic_protocols
				has_trait = trait_charismatic
			}
		}
		modifier = {
			planet_amenities_add = 0.4
		}
	}

	triggered_country_modifier = {
		potential = {
			exists = planet
			planet = {
				exists = sector
				sector = {
					exists = leader
					leader = { has_trait = leader_trait_bureaucrat }
				}
			}
		}
		modifier = {
			country_admin_cap_add = 1
		}
	}

	triggered_country_modifier = {
		potential = {
			exists = planet
			planet = { has_designation = col_bureau }
		}
		modifier = {
			country_admin_cap_add = 2
		}
	}
	triggered_planet_modifier = {
		potential = {
			has_trait = trait_repugnant
		}
		modifier = {
			planet_amenities_add = -0.4
		}
	}
	triggered_planet_modifier = {
		potential = {
			OR = {
				has_trait = trait_thrifty
				has_trait = trait_nuumismatic_administration
			}
		}
		modifier = {
			trade_value_add = 0.5
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { has_valid_civic = civic_byzantine_bureaucracy }
		}
		modifier = {
			planet_stability_add = 1
		}
	}
	
	weight = {
		weight = @specialist_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 0.2
			has_citizenship_rights = no
			NOT = { has_trait = trait_mechanical }
		}
		modifier = {
			factor = 2
			has_trait = trait_robot_propaganda_machines
			OR = {
				is_non_sapient_robot = yes
				is_shackled_robot = yes
			}
		}
		modifier = {
			factor = 1.5
			OR = {
				has_trait = trait_robot_propaganda_machines
				has_trait = trait_traditional
			}
		}
		modifier = {
			factor = 0.5
			has_trait = trait_quarrelsome
		}
		modifier = {
			factor = 0.1
			can_take_servant_job = yes
		}
		modifier = {
			factor = 1.5
			has_job = bureaucrat
		}
		modifier = {
			factor = 0.5
			has_trait = trait_presapient_proles
		}
		modifier = {
			factor = 1.1
			has_trait = trait_latent_psionic
		}
		modifier = {
			factor = 1.2
			has_trait = trait_psionic
		}
		modifier = {
			factor = 0.5
			has_trait = trait_enigmatic_intelligence_failed
		}
		modifier = {
			factor = 0.25
			is_enslaved = yes
			can_take_servant_job = no
			NOR = {
				has_trait = trait_nuumismatic_administration
				has_trait = trait_thrifty
			}
		}
		modifier = {
			factor = 2
			OR = {
				is_non_sapient_robot = yes
				is_shackled_robot = yes
			}
			can_take_servant_job = no
		}
		modifier = {
			factor = 1.5
			OR = {
				has_trait = trait_thrifty
				has_trait = trait_nuumismatic_administration
			}
		}
		modifier = {
			factor = 0.1
			can_take_servant_job = yes
		}
		modifier = {
			factor = 1.5
			OR = {
				has_trait = trait_robot_domestic_protocols
				has_trait = trait_charismatic
			}
		}
		modifier = {
			factor = 0.5
			has_trait = trait_repugnant
		}
	}
}
GAPS_undergrounder_refiner = {
	category = specialist
	condition_string = SPECIALIST_JOB_TRIGGER
	building_icon = GAPS_Underground_Foundry
	clothes_texture_index = 3

	possible = {
		specialist_job_check_trigger = yes
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		}
	}
	
	resources = {
		category = planet_GAPS_UndergrounderJobs
		produces = {
			volatile_motes = 1
			rare_crystals = 1
			exotic_gases = 1
		}
		upkeep = {
			minerals = 15
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_weak 
		}
		modifier = {
			planet_jobs_produces_mult = -0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_strong
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_very_strong 
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	weight = {
		weight = @specialist_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 0.2
			has_citizenship_rights = no
			NOT = { has_trait = trait_mechanical }
		}
		modifier = {
			factor = 0.1
			can_take_servant_job = yes
		}
		modifier = {
			factor = 7
			has_job = chemist
		}
		modifier = {
			factor = 15
			has_job = chemist
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 2
			has_trait = trait_void_dweller_1
		}
		modifier = {
			factor = 0.2
			has_citizenship_rights = no
			NOT = { has_trait = trait_mechanical }
		}
		modifier = {
			factor = 0.1
			can_take_servant_job = yes
		}
		modifier = {
			factor = 2
			species = {
				has_species_flag = racket_species_flag
			}
		}
		modifier = {
			factor = 7
			has_job = translucer
		}
		modifier = {
			factor = 15
			has_job = translucer
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 1.2
			is_enslaved = yes
			has_slavery_type = { type = slavery_indentured }
		}
		modifier = {
			factor = 2
			has_trait = trait_void_dweller_1
		}
		modifier = {
			factor = 0.2
			has_citizenship_rights = no
			NOT = { has_trait = trait_mechanical }
		}
		modifier = {
			factor = 0.1
			can_take_servant_job = yes
		}
		modifier = {
			factor = 2
			species = {
				has_species_flag = racket_species_flag
			}
		}
		modifier = {
			factor = 7
			has_job = gas_refiner
		}
		modifier = {
			factor = 15
			has_job = gas_refiner
			OR = {
				has_trait = trait_robust
				has_trait = trait_robot_efficient_processors
			}
		}
		modifier = {
			factor = 1.2
			is_enslaved = yes
			has_slavery_type = { type = slavery_indentured }
		}
		modifier = {
			factor = 2
			has_trait = trait_void_dweller_1
		}
	}
}
GAPS_undergrounder_mining_drone = {
	category = simple_drone
	condition_string = DRONE_JOB_TRIGGER
	building_icon = GAPS_Underground_Mineral_Production
	
	possible = {
		drone_job_check_trigger = yes
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		} 
	}
	
	resources = {
		category = planet_GAPS_UndergrounderJobs
		produces = {
			minerals = 3
			engineering_research = 9
		}
	}	
	
	planet_modifier = {
		planet_GAPS_UndergrounderJobs_minerals_produces_mult = 0.025
		planet_GAPS_UndergrounderJobs_engineering_research_produces_mult = 0.025
	}
	#research
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_enigmatic_intelligence 
		}
		modifier = {
			planet_jobs_produces_mult = 0.1
		}
	}
	#research
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_erudite 
		}
		modifier = {
			planet_jobs_produces_mult = 0.2
		}
	}
	
	weight = {
		weight = @simple_drone_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 3
			has_trait = trait_erudite
		}
		modifier = {
			factor = 2
			has_trait = trait_intelligent
		}
		modifier = {
			factor = 1.5
			OR = {
				has_trait = trait_natural_engineers
				has_trait = trait_natural_physicists
				has_trait = trait_natural_sociologists
			}
		}
		modifier = {
			factor = 0.65
			OR = {
				has_trait = trait_syncretic_proles
				has_trait = trait_presapient_proles
			}
		}
		modifier = {
			factor = 0.9
			exists = owner
			years_passed < 1
			owner = { has_valid_civic = civic_machine_assimilator }
			has_trait = trait_cybernetic
		}
		modifier = {
			factor = 0
			planet = {
				owner = {
					is_ai = yes
					has_resource = { type = minerals amount < 500 }
					has_monthly_income = {
						resource = minerals
						value < 25
					}
				}
			}
		}	
		modifier = {
			factor = 2
			OR = {
				has_trait = trait_industrious
				has_trait = trait_robot_power_drills
			}
		}
		modifier = {
			factor = 1.1
			exists = owner
			years_passed < 1
			owner = { has_valid_civic = civic_machine_assimilator }
			has_trait = trait_cybernetic
		}
		modifier = {
			factor = 1.2
			has_job = mining_drone
		}
		modifier = {
			factor = 0.9
			NOT = { has_job = mining_drone }
			owner = {
				has_monthly_income = {
					resource = minerals
					value > 85
				}
			}
		}	
	}
}
GAPS_undergrounder_agri_drone = {
	category = simple_drone
	condition_string = DRONE_JOB_TRIGGER
	building_icon = GAPS_Subterrestrial_City
	
	possible = {
		drone_job_check_trigger = yes
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		}
	}

	resources = {
		category = planet_GAPS_UndergrounderJobs
		produces = {
			food = 4
			society_research = 9
		}
		produces = {
			trigger = {
				exists = owner
				owner = {
					is_robot_empire = yes
				}
			}
			food = -1
		}
	}	
	
	planet_modifier = {
		planet_GAPS_UndergrounderJobs_food_produces_mult = 0.025
		planet_GAPS_UndergrounderJobs_society_research_produces_mult = 0.025
	}
	#research
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_enigmatic_intelligence 
		}
		modifier = {
			planet_jobs_produces_mult = 0.1
		}
	}
	#research
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_erudite 
		}
		modifier = {
			planet_jobs_produces_mult = 0.2
		}
	}
	
	weight = {
		weight = @simple_drone_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 3
			has_trait = trait_erudite
		}
		modifier = {
			factor = 2
			has_trait = trait_intelligent
		}
		modifier = {
			factor = 1.5
			OR = {
				has_trait = trait_natural_engineers
				has_trait = trait_natural_physicists
				has_trait = trait_natural_sociologists
			}
		}
		modifier = {
			factor = 0.65
			OR = {
				has_trait = trait_syncretic_proles
				has_trait = trait_presapient_proles
			}
		}
		modifier = {
			factor = 0.9
			exists = owner
			years_passed < 1
			owner = { has_valid_civic = civic_machine_assimilator }
			has_trait = trait_cybernetic
		}
		modifier = {
			factor = 0
			planet = {
				owner = {
					is_ai = yes
					has_resource = { type = minerals amount < 500 }
					has_monthly_income = {
						resource = minerals
						value < 25
					}
				}
			}
		}
		modifier = {
			factor = 2
			OR = {
				has_trait = trait_agrarian
				has_trait = trait_robot_harvesters
			}
		}
		modifier = {
			factor = 0.9
			NOT = { has_job = mining_drone }
			owner = {
				has_monthly_income = {
					resource = food
					value > 50
				}
			}
		}
		modifier = {
			factor = 1.2
			has_job = agri_drone
		}
		modifier = {
			factor = 0.9
			owner = {
				is_robot_empire = yes
			}
		}
		modifier = {
			factor = 1.1
			exists = owner
			years_passed < 1
			owner = { has_valid_civic = civic_machine_assimilator }
			has_trait = trait_cybernetic
		}

		modifier = {
			factor = 0.5
			has_trait = trait_lithoid

			owner = {
				is_lithoid_empire = yes
				has_monthly_income = {
					resource = food
					value >= 0
				}
			}
		}
	}
}

GAPS_undergrounder_technician_drone = {
	category = simple_drone
	condition_string = DRONE_JOB_TRIGGER
	building_icon = GAPS_Underground_Energy_Grid
	
	possible = {
		drone_job_check_trigger = yes
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		}
	}

	resources = {
		category = planet_GAPS_UndergrounderJobs
		produces = {
			energy = 3
			physics_research = 9
		}
		produces = {
			trigger = {
				exists = owner
				owner = {
					is_robot_empire = yes
				}
			}
			energy = 2
		}
	}	
	
	planet_modifier = {
		planet_GAPS_UndergrounderJobs_energy_produces_mult = 0.025
		planet_GAPS_UndergrounderJobs_physics_research_produces_mult = 0.025
	}
	#research
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_enigmatic_intelligence 
		}
		modifier = {
			planet_jobs_produces_mult = 0.1
		}
	}
	#research
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_erudite 
		}
		modifier = {
			planet_jobs_produces_mult = 0.2
		}
	}
	
	weight = {
		weight = @simple_drone_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 3
			has_trait = trait_erudite
		}
		modifier = {
			factor = 2
			has_trait = trait_intelligent
		}
		modifier = {
			factor = 1.5
			OR = {
				has_trait = trait_natural_engineers
				has_trait = trait_natural_physicists
				has_trait = trait_natural_sociologists
			}
		}
		modifier = {
			factor = 0.65
			OR = {
				has_trait = trait_syncretic_proles
				has_trait = trait_presapient_proles
			}
		}
		modifier = {
			factor = 0.9
			exists = owner
			years_passed < 1
			owner = { has_valid_civic = civic_machine_assimilator }
			has_trait = trait_cybernetic
		}
		modifier = {
			factor = 0
			planet = {
				owner = {
					is_ai = yes
					has_resource = { type = minerals amount < 500 }
					has_monthly_income = {
						resource = minerals
						value < 25
					}
				}
			}
		}
		modifier = {
			factor = 2
			OR = {
				has_trait = trait_robot_superconductive
				has_trait = trait_ingenious
			}
		}
		modifier = {
			factor = 0.9
			NOT = { has_job = mining_drone }
			owner = {
				has_monthly_income = {
					resource = energy
					value > 50
				}
			}
		}
		modifier = {
			factor = 1.2
			has_job = technician_drone
		}
		modifier = {
			factor = 1.1
			exists = owner
			years_passed < 1
			owner = { has_valid_civic = civic_machine_assimilator }
			has_trait = trait_cybernetic
		}
	}
}
GAPS_undergrounder_warrior_drone = {
	category = simple_drone
	condition_string = DRONE_JOB_TRIGGER
	building_icon = GAPS_Underground_Stronghold
	possible = {
		drone_job_check_trigger = yes
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		}
	}
	
	resources = {
		category = planet_GAPS_UndergrounderJobs
		produces = {
			trigger = {
				exists = owner
			}
			unity = 3
		}
	}
	country_modifier = {
		country_naval_cap_add = 3
	}

	planet_modifier = {
		planet_GAPS_UndergrounderJobs_unity_produces_mult = 0.025
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_weak 
		}
		modifier = {
			planet_jobs_produces_mult = -0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_strong
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_very_strong 
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	triggered_country_modifier = {
		potential = {
			planet = {
				exists = owner
				owner = { has_technology = "tech_ground_defense_planning" }
			}
		}
		modifier = {
			country_naval_cap_add = 2
		}
	}

	pop_modifier = {
		pop_defense_armies_add = 3
	}

	triggered_planet_modifier = {
		potential = {
			planet = {
				OR = {
					has_modifier = compliance_protocols
					has_modifier = hunter_killer_drones
				}
			}
		}
		modifier = {
			planet_stability_add = 5
		}
	}
	
	weight = {
		weight = 5
		modifier = {
			factor = 2
		}
		modifier = {
			weight = 100
			exists = owner
			owner = { is_at_war = yes }
		}
		modifier = {
			factor = 10
			planet = {
				OR = {
					has_modifier = compliance_protocols
					has_modifier = hunter_killer_drones
				}
			}
		}
		modifier = {
			factor = 4
			has_trait = trait_resilient
		}
		modifier = {
			factor = 4
			has_trait = trait_very_strong
		}
		modifier = {
			factor = 3
			has_trait = trait_strong
		}
		modifier = {
			factor = 0.5
			has_trait = trait_weak
		}
		modifier = {
			factor = 0.9
			exists = owner
			years_passed < 1
			owner = { has_valid_civic = civic_machine_assimilator }
			has_trait = trait_cybernetic
		}
		modifier = {
			factor = 0
			planet = { count_pops = { limit = { } count < 12 } }
			owner = { is_ai = yes }
		}
	}
}
GAPS_undergrounder_alloy_drone = {
	category = complex_drone
	condition_string = DRONE_JOB_TRIGGER
	building_icon = GAPS_Underground_Foundry
	
	possible = {
		drone_job_check_trigger = yes
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		}
	}

	planet_modifier = {
		planet_amenities_no_happiness_add = 3
	}
	resources = {
		category = planet_GAPS_UndergrounderJobs
		produces = {
			alloys = 3
		}
		upkeep = {
			minerals = 9
		}
	}
	
	planet_modifier = {
		planet_GAPS_UndergrounderJobs_alloys_produces_mult = 0.01
		planet_GAPS_UndergrounderJobs_consumer_goods_produces_mult = 0.01
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_weak 
		}
		modifier = {
			planet_jobs_produces_mult = -0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_strong
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_very_strong 
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	triggered_planet_modifier = {
		potential = {
			OR = {
				has_trait = trait_robot_emotion_emulators
				has_trait = trait_charismatic
			}
		}
		modifier = {
			planet_amenities_no_happiness_add = 1
		}
	}
	triggered_planet_modifier = {
		potential = {
			OR = {
				has_trait = trait_robot_uncanny
				has_trait = trait_repugnant
			}
		}
		modifier = {
			planet_amenities_no_happiness_add = -1
		}
	}
	weight = {
		weight = @complex_drone_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 2
			OR = {
				has_trait = trait_robot_emotion_emulators
				has_trait = trait_charismatic
			}
		}
		modifier = {
			factor = 0.5
			OR = {
				has_trait = trait_robot_uncanny
				has_trait = trait_repugnant
			}
		}
		modifier = {
			factor = 1.1
			exists = owner
			years_passed < 1
			owner = { has_valid_civic = civic_machine_assimilator }
			has_trait = trait_cybernetic
		}
		modifier = {
			factor = 0.1
			NOT = { has_job = maintenance_drone }
			planet = {
				free_amenities > 5
			}
		}
	}
}

GAPS_undergrounder_refiner_drone = {
	category = complex_drone
	condition_string = DRONE_JOB_TRIGGER
	building_icon = building_chemical_plant

	possible_pre_triggers = {
		has_owner = yes
		is_enslaved = no
		is_being_purged = no
		is_being_assimilated = no
	}
	possible = {
		drone_job_check_trigger = yes
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		}
	}
	
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_weak 
		}
		modifier = {
			planet_jobs_produces_mult = -0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_strong
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_very_strong 
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	resources = {
		category = planet_GAPS_UndergrounderJobs
		produces = {
			volatile_motes = 1
			rare_crystals = 1
			exotic_gases = 1
		}
		upkeep = {
			minerals = 15
		}
	}
	
	weight = {
		weight = @complex_drone_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 0.9
			exists = owner
			years_passed < 1
			owner = { has_valid_civic = civic_machine_assimilator }
			has_trait = trait_cybernetic
		}
	}
}

GAPS_undergrounder_cubical_drone = {
	category = complex_drone
	condition_string = DRONE_JOB_TRIGGER
	building_icon = building_robot_assembly_plant
	
	
	possible = {
		hidden_trigger = { exists = owner }
		drone_job_check_trigger = yes
		OR = {
			has_trait = Trait_GAPS_Undergrounder 
			has_trait = Trait_GAPS_Undergrounder_Added
		}
	}

	country_modifier = {
		country_admin_cap_add = 7.5
	}

	resources = {
		category = planet_GAPS_UndergrounderJobs
		upkeep = {
			energy = 3
		}
	}
	planet_modifier = {
		planet_amenities_add = 3
		trade_value_add = 0
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_weak 
		}
		modifier = {
			planet_jobs_produces_mult = -0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_strong
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	#any
	triggered_pop_modifier = {
		potential = {
			has_trait = trait_very_strong 
		}
		modifier = {
			planet_jobs_produces_mult = 0.025
		}
	}
	triggered_planet_modifier = {
		potential = {
			OR = {
				has_trait = trait_robot_emotion_emulators
				has_trait = trait_charismatic
			}
		}
		modifier = {
			planet_amenities_no_happiness_add = 1
		}
	}
	triggered_planet_modifier = {
		potential = {
			OR = {
				has_trait = trait_robot_uncanny
				has_trait = trait_repugnant
			}
		}
		modifier = {
			planet_amenities_no_happiness_add = -1
		}
	}
	triggered_planet_modifier = {
		potential = {
			planet = { has_modifier = planet_artifact_relays_machine }
		}
		modifier = {
			planet_stability_add = 2
			planet_jobs_simple_drone_produces_mult = 0.01
		}
	}

	triggered_country_modifier = {
		potential = {
			exists = owner
			owner = {
				has_swapped_tradition = tr_synchronicity_integrated_preservation
			}
		}
		modifier = {
			country_admin_cap_add = 3
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_swapped_tradition = tr_synchronicity_integrated_preservation
			}
		}
		modifier = {
			planet_crime_no_happiness_add = -2
		}
	}

	
	weight = {
		weight = @complex_drone_job_weight
		modifier = {
			factor = 2
		}
		modifier = {
			factor = 2
			OR = {
				has_trait = trait_robot_emotion_emulators
				has_trait = trait_charismatic
			}
		}
		modifier = {
			factor = 0.5
			OR = {
				has_trait = trait_robot_uncanny
				has_trait = trait_repugnant
			}
		}
		modifier = {
			factor = 1.1
			exists = owner
			years_passed < 1
			owner = { has_valid_civic = civic_machine_assimilator }
			has_trait = trait_cybernetic
		}
		modifier = {
			factor = 0.1
			NOT = { has_job = maintenance_drone }
			planet = {
				free_amenities > 5
			}
		}
		modifier = {
			factor = 0.9
			exists = owner
			years_passed < 1
			owner = { has_valid_civic = civic_machine_assimilator }
			has_trait = trait_cybernetic
		}
	}
}