#############
# Resource buildings
#############
building_foundry_1 = {
	base_buildtime = @b1_time

	category = manufacturing

	potential = {
		exists = owner
		NOT = { has_modifier = resort_colony }
		NOT = { has_modifier = slave_colony }
			owner = {
				or = {
				is_ai = no
				resource_stockpile_compare = {
					resource = alloys
					value < 3000
				}
				used_naval_capacity_percent < 0.95
				resource_income_compare = {
					resource = alloys
					value < 100
				} 
			}
		}
	}

	destroy_trigger = {
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			AND = {
				exists = owner
				owner = {
					is_ai = yes
					has_monthly_income = {
						resource = alloys
						value > 200
					}
				}#Need to check alloy income to make sure that the AI has built a couple of alloy plants on the new city world.
				is_planet_class = pc_city
			}
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		modifier = {
			job_alloy_drone_add = @b1_jobs
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		modifier = {
			job_fabricator_add = @b1_jobs
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		modifier = {
			job_foundry_add = @b1_jobs
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b1_minerals
		}
		upkeep = {
			energy = @b1_upkeep
		}
	}

	upgrades = {
		building_foundry_2
	}

	prerequisites = {
		tech_basic_industry
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		text = job_foundry_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		text = job_alloy_drone_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		text = job_fabricator_effect_desc
	}

	ai_weight = {
		weight = 1.2
		
		modifier = {
			factor = 1.5
			str_good_alloys = yes
		}


		modifier = {
			factor = 0.005
			free_building_slots <  3
			owner = {
			is_gestalt = yes
			resource_income_compare = {
						resource = minerals
						value < 80
					}
			or = {
				resource_income_compare = {
							resource = minerals
							value < 60
						}
				num_owned_planets > 2
			}
			resource_income_compare = {
				resource = alloys
				value > 10
			}
			}
		}
		
		modifier = {
			factor = 2
			or = { 
			has_designation = col_foundry
			has_designation = col_mac_foundry
			has_designation = col_hiv_foundry
			} 
		}

		modifier = {
			factor = 0.5
			or = { 
			has_designation = col_research
			has_designation = col_factory
			is_planet_class = pc_habitat
			is_planet_class = pc_ringworld_habitable
			} 
		}

		modifier = {
			factor = 2
			has_planet_flag = str_alloy
		}
		modifier = {
			factor = 0.5
			or = {
				has_planet_flag = str_research
				has_planet_flag = str_consgoods
			}
		}

		modifier = {
			factor = 10
			owner = {
				has_country_flag = ferocious_rusher
				has_origin = origin_life_seeded
			}
		}


		modifier = {
			factor = 3
			owner = {
				resource_income_compare = {
					resource = alloys
					value < 35
				}
				resource_stockpile_compare = {
					resource = alloys
					value < 2000
				}
			}
		}

		modifier = {
			factor = 3
			owner = {
				resource_income_compare = {
					resource = alloys
					value < 20
				}
			
			}
		}

		modifier = {
			factor = 2
			owner = {
				resource_income_compare = {
					resource = alloys
					value < 15
				}
				resource_stockpile_compare = {
					resource = alloys
					value < 3000
				}
			}
		}

		modifier = {
			factor = 2
			owner = {
				resource_income_compare = {
					resource = alloys
					value < 25
				}
		
			}
		}

		modifier = {
			factor = 4
			years_passed < 15
			owner = {
				resource_income_compare = {
					resource = alloys
					value < 30
				}
			}
		}

		modifier = {
			factor = 2
			years_passed > 50
			free_building_slots > 0
			owner = {
			resource_income_compare = {
				resource = minerals
				value > 100
			}
			resource_stockpile_compare = {
				resource = minerals
				value > 1000
			} }
		}

		modifier = {
			factor = 0.2
			owner = { resource_stockpile_compare = {
				resource = minerals
				value < 2000
			} 
			resource_income_compare = {
				resource = minerals
				value < 100
			} 
			}
			not = {
				has_planet_flag = just_destroyed_building
			}
			owner = {
				 has_country_flag = terrible_mineral_economy  
			}
			or = {
			free_building_slots = 0
			free_building_slots = 1 
			}
		}

		modifier = {
			factor = 0.8
			owner = {
				not = { has_country_flag = fine_mineral_economy } 
			}
		}

		modifier = {
			factor = 0.6
			owner = {
				not = { has_country_flag = acceptable_mineral_economy } 
			}
		}		
		modifier = {
			factor = 0.1
			owner = {
				resource_income_compare = {
					resource = minerals
					value < 20
				}
				resource_stockpile_compare = {
					resource = minerals
					value < 1000
				}
			}
		}

		modifier = {
			factor = 0.6
			owner = {
				has_country_flag = has_ecumenopolis 
				is_regular_empire = yes
			}
		}



		modifier = {
			factor = 0.107
		owner = {has_country_flag = alloy_4 } }
		modifier = {
			factor = 9.358
		owner = {has_country_flag = research_4 } }
		modifier = {
			factor = 0.327
		owner = {has_country_flag = alloy_3 } }
		modifier = {
			factor = 3.059
		owner = {has_country_flag = research_3 } }
		modifier = {
			factor = 0.572
		owner = {has_country_flag = alloy_2 } }
		modifier = {
			factor = 1.749
		owner = {has_country_flag = research_2 } }
		modifier = {
			factor = 0.756
		owner = {has_country_flag = alloy_1 } }
		modifier = {
			factor = 1.322
		owner = {has_country_flag = research_1 } }
		modifier = {
			factor = 0.87
		owner = {has_country_flag = alloy_0 } }
		modifier = {
			factor = 1.15
		owner = {has_country_flag = research_0 } }


		modifier = {
			factor = 4
			lategame = yes
			owner = {
			resource_stockpile_compare = {
				resource = alloys
				value < 10000
			} }
		}

		modifier = {
			factor = 0.5
			owner = {
				has_country_flag = acceptable_mineral_economy
				not = {
					has_country_flag = fine_mineral_economy
				}
			}
		}

		modifier = {
			factor = 2
			owner = {
			resource_stockpile_compare = {
				resource = alloys
				value < 4000
			} 
			used_naval_capacity_percent < 0.95
			}
		}




			modifier = {
				factor = 0.8
				owner = { turtler = yes }
			}
			modifier = {
				factor = 1.25
				owner = { rusher = yes }
			}
			modifier = {
				factor = 0.8
				owner = { turtler2 = yes }
			}
			modifier = {
				factor = 1.25
				owner = { rusher2 = yes }
			}
			modifier = {
				factor = 0.4
				owner = { turtler3 = yes }
			}
			modifier = {
				factor = 1.6
				owner = { rusher3 = yes }
			}

			modifier = {
				factor = 10
				lategame = yes
			}

			modifier = {
				factor = 0.2
				lategame = no
				owner = {
				used_naval_capacity_percent > 0.95
				or = {
					and = {
					resource_income_compare = {
						resource = alloys
						value > 30
					}
					resource_stockpile_compare = {
						resource = alloys
						value > 3000
					}
					years_passed < 20 
					}
					and = {
					resource_income_compare = {
						resource = alloys
						value > 40
					}
					resource_stockpile_compare = {
						resource = alloys
						value > 4000
					}
					years_passed < 50 
					}
					and = {
					resource_income_compare = {
						resource = alloys
						value > 50
					}
					resource_stockpile_compare = {
						resource = alloys
						value > 5000
					}
					years_passed < 100 
					}
					and = {
					resource_income_compare = {
						resource = alloys
						value > 70
					}
					resource_stockpile_compare = {
						resource = alloys
						value > 7000
					}
					}

				} }
			}


			modifier = {
				factor = 0.2
				lategame = no
				owner = {
				used_naval_capacity_percent > 0.95
				or = {
					and = {
					resource_income_compare = {
						resource = alloys
						value > 40
					}
					resource_stockpile_compare = {
						resource = alloys
						value > 4000
					}
					years_passed < 20 
					}
					and = {
					resource_income_compare = {
						resource = alloys
						value > 50
					}
					resource_stockpile_compare = {
						resource = alloys
						value > 6000
					}
					years_passed < 50 
					}
					and = {
					resource_income_compare = {
						resource = alloys
						value > 70
					}
					resource_stockpile_compare = {
						resource = alloys
						value > 8000
					}
					years_passed < 100 
					}
					and = {
					resource_income_compare = {
						resource = alloys
						value > 80
					}
					resource_stockpile_compare = {
						resource = alloys
						value > 10000
					}
					}

				} }
			}


			modifier = {
			factor = 3
			free_building_slots > 0
			years_passed > 20
			owner = {
				good_economy_trigger = yes
			}
			}


			modifier = {
				factor = 4
				owner = { can_kill_turtles = yes }
			}
			modifier = {
				factor = 2
				owner = {prepare_for_war = yes }
			}
			modifier = {
				factor = 0.25
				owner = { safespace = yes }
			}
			modifier = {
				factor = 1.6
				owner = { scared_of_neighbour = yes }
			}
			modifier = {
				factor = 0.25
				owner = { stalemate = yes }
			}
			modifier = {
				factor = 4
				or = {
				has_building = building_ministry_production
				has_building = building_production_center }
			}
			modifier = {
				factor = 0.2
				or = { has_building = building_institute
				has_building = building_supercomputer }
			}
			modifier = {
				factor = 0.9
				owner = {
					resource_stockpile_compare = {
						resource = alloys
						value > 1000
					}
				}
			}
			modifier = {
				factor = 0.8
				owner = {
					resource_stockpile_compare = {
						resource = alloys
						value > 2000
					}
				}
			}
			modifier = {
				factor = 0.7
				owner = {
					resource_stockpile_compare = {
						resource = alloys
						value > 3000
					}
				}
			}
			modifier = {
				factor = 0.7
				owner = {
					resource_stockpile_compare = {
						resource = alloys
						value > 4000
					}
				}
			}
			modifier = {
				factor = 0.7
				owner = {
					resource_stockpile_compare = {
						resource = alloys
						value > 5000
					}
				}
			}
			modifier = {
				factor = 0.6
				owner = {
					resource_stockpile_compare = {
						resource = alloys
						value > 6000
					}
				}
			}
			modifier = {
				factor = 0.6
				owner = {
					resource_stockpile_compare = {
						resource = alloys
						value > 7000
					}
				}
			}
			modifier = {
				factor = 0.6
				owner = {
					resource_stockpile_compare = {
						resource = alloys
						value > 8000
					}
				}
			}
			modifier = {
				factor = 0.5
				owner = {
					resource_stockpile_compare = {
						resource = alloys
						value > 9000
					}
				}
			}

			modifier = {
				factor = 2
				years_passed < 12
			}

		modifier = {
			factor = 0.02
			years_passed > 2
			not = {
				has_planet_flag = just_destroyed_building
			}
			not = {
				any_owned_pop = {
					is_unemployed = yes
				}
			}
			owner = {
					 not = { 
						 has_country_flag = acceptable_mineral_economy 
					} }
			has_planet_flag = supervisor
				owner = { 
					resource_income_compare = {
						resource = minerals
						value < 100
					} 
					resource_stockpile_compare = {
						resource = minerals
						value < 1000
					} }
			owner = { resource_income_compare = {
				resource = alloys
				value > 40
			}
			}
			free_building_slots = 1
	}

		modifier = {
			factor = 2
			any_owned_pop = {
				is_unemployed = yes
			}
		}


		modifier = {
			factor = 0.001
			years_passed > 2
			not = {
				has_planet_flag = just_destroyed_building
			}
			lategame = no
			supervised_destruction = yes
			owner = { resource_income_compare = {
				resource = alloys
				value > 40 }
			}
		}

		modifier = {
			factor = 0.2
			free_amenities < -10
		}

		modifier = {
			factor = 0.05
			years_passed > 2
			not = {
				has_planet_flag = just_destroyed_building
			}
			OR = { 
				free_amenities < -15
				owner = {
					resource_income_compare = {
						resource = minerals
						value < 30
					}
				}
			}
			free_building_slots < 1
		}


		modifier = {
			factor = 2
			years_passed > 12
			owner = {
				used_naval_capacity_percent < 0.7
				resource_stockpile_compare = {
					resource = alloys
					value < 1000
				}
			}
			}
	
				modifier = {
					factor = 2
					years_passed > 10
					owner = { resource_stockpile_compare = {
						resource = alloys
						value < 800
						
					} }
					owner = { used_naval_capacity_percent < 0.8 }
				}
	
				modifier = {
					factor = 2
					years_passed > 10
					owner = { resource_stockpile_compare = {
						resource = alloys
						value < 1500
						
					} }
					owner = { used_naval_capacity_percent < 0.7 }
				}
				modifier = {
					factor = 2
					years_passed > 10
					owner = { resource_stockpile_compare = {
						resource = alloys
						value < 1500
						
					} }
					owner = { used_naval_capacity_percent < 0.6 }
				}
				modifier = {
					factor = 2
					years_passed > 10
					owner = { resource_stockpile_compare = {
						resource = alloys
						value < 800
						
					} }
					owner = { used_naval_capacity_percent < 0.5 }
				}
	
				modifier = {
					factor = 0.2
					owner = { resource_stockpile_compare = {
						resource = alloys
						value > 2500
						
					} }
					owner = { used_naval_capacity_percent > 0.95 }
				}
	
	
				modifier = {
					factor = 0.5
					owner = { resource_stockpile_compare = {
						resource = alloys
						value > 4500
						
					} }
					owner = { used_naval_capacity_percent > 0.95 }
				}
	
				modifier = {
					factor = 0.5
					owner = { resource_stockpile_compare = {
						resource = alloys
						value > 5500
						
					} }
					owner = { used_naval_capacity_percent > 0.95 }
				}
	
	
				modifier = {
					factor = 0.5
					owner = { resource_stockpile_compare = {
						resource = alloys
						value > 7500
						
					} }
					owner = { used_naval_capacity_percent > 0.95 }
				}
	
				
				modifier = {
					factor = 0.5
					owner = { resource_stockpile_compare = {
						resource = alloys
						value > 12000
						
					} }
					owner = { used_naval_capacity_percent > 0.95 }
				}
	

		modifier = {
			factor = 2
			free_building_slots > 0
			owner = {
				good_economy_trigger = yes
			}
		}
	
		modifier = {
			factor = 4
			owner = {
			resource_income_compare = {
				resource = consumer_goods
				value > 5
			} }
			any_owned_pop = {
				is_unemployed = yes 
				is_pop_category = specialist
			}
		}
	}

	on_built = {
		if = {
			limit = {
				free_housing < 0
				free_district_slots = 0
			}
			city_district_check = yes
		}
	}

	on_destroy = {
		set_timed_planet_flag = {
			flag = just_destroyed_building
			days = 36
		}
	}
	ai_resource_production = {
		alloys = 1
		trigger = {
			always = yes
		}
	}
}

building_foundry_2 = {
	base_buildtime = @b2_time
	can_build = no

	category = manufacturing

	potential = {
		exists = owner
		NOT = { has_modifier = resort_colony }
		NOT = { has_modifier = slave_colony }
			owner = {
				or = {
			is_ai = no
				resource_stockpile_compare = {
					resource = alloys
					value < 3000
				}
				used_naval_capacity_percent < 0.95
				resource_income_compare = {
					resource = alloys
					value < 100
				} 
			}

			
		}
	}

	allow = {
		has_upgraded_capital = yes
		buildings_upgrade_allow = yes
	}

	destroy_trigger = {
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			AND = {
				exists = owner
				buildings_no_motes = yes
			}
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		modifier = {
			job_alloy_drone_add = @b2_jobs
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		modifier = {
			job_fabricator_add = @b2_jobs
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		modifier = {
			job_foundry_add = @b2_jobs
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b2_minerals
			volatile_motes = @b2_rare_cost
		}
		upkeep = {
			energy = @b2_upkeep
			volatile_motes = @b2_rare_upkeep
		}
	}

	upgrades = {
		building_foundry_3
	}

	prerequisites = {
		tech_alloys_1
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		text = job_foundry_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		text = job_alloy_drone_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		text = job_fabricator_effect_desc
	}	
	ai_weight = {
		weight = 2
		modifier = {
			factor = 0.5
			nor = {
				has_designation = col_foundry
				has_designation = col_mac_foundry
				has_designation = col_hiv_foundry
			}
		}
		modifier = {
			factor = 0.25
			owner = {
					 not = { has_country_flag = good_mineral_economy }
					}
		}
#		modifier = {
			#factor = 0.5
			#owner = {
				#has_country_flag = has_ecumenopolis 
			#}
		#}
		modifier = {
			factor = 0.6
			free_building_slots > 0
		}

		modifier = {
			factor = 4
			free_building_slots = 0
			owner = {
					 has_country_flag = fine_mineral_economy 
					}
			owner = { resource_income_compare = {
				resource = volatile_motes
				value > 2 }
			}
		}
		modifier = {
			factor = 1.5
			or = { has_building = building_ministry_production 
			has_building = building_production_center }
		}

		modifier = {
			factor = 30
			free_building_slots = 0
			owner = {
					 has_country_flag = good_mineral_economy 
					}
			owner = { resource_income_compare = {
				resource = volatile_motes
				value > 3 }
				resource_stockpile_compare = {
					resource = volatile_motes
					value > 70
				}
				resource_stockpile_compare = {
					resource = minerals
					value > 2000
				}
				resource_stockpile_compare = {
					resource = energy
					value > 2000
				}
				resource_income_compare = {
					resource = minerals
					value > 100
				}
				resource_income_compare = {
					resource = minerals
					value > 20
				}
			}
		}
		modifier ={
			factor = 0.1
			or = {
			free_building_slots > 0
			owner = { resource_income_compare = {
				resource = volatile_motes
				value < 1 }
			}
			nor = { has_building = building_ministry_production 
			has_building = building_production_center }
		}
		}
		modifier = {
			factor = 0.05
			owner = {
				has_country_flag = adv_foundry_queued
			}
		}


#		modifier = {
			#factor = 0
			#unsupervised_destruction = yes
			#owner = {
				#not = {
					#has_country_flag = fine_mineral_economy
				#}
				#not = {
				#has_country_flag = adv_foundry_destroyed
			#}
			#has_country_flag = has_ecumenopolis 
			#resource_stockpile_compare = {
				#resource = alloys
				#value > 2000
			#}
			#resource_stockpile_compare = {
				#resource = minerals
				#value < 20000
			#}
		#}
		#}

		modifier = {
			factor = 0.01
			owner = { resource_income_compare = {
				resource = volatile_motes
				value < 2 } 
				resource_stockpile_compare = {
					resource = volatile_motes
					value < 200
				}
			not = {
				has_country_flag = adv_foundry_queued
			}
			}
		}

		modifier = {
			factor = 0
			owner = { resource_income_compare = {
				resource = volatile_motes
				value < 0 } 
				resource_stockpile_compare = {
					resource = volatile_motes
					value < 200
				}
			not = {
				has_country_flag = adv_foundry_destroyed
			}
			}
		}
		
	}
	on_queued = {
		owner = { set_timed_country_flag = {
			flag = adv_foundry_queued
			days = 1000 }
		}
	}

	on_destroy = {
		set_timed_planet_flag = {
			flag = just_destroyed_building
			days = 36
		}
		owner = { set_timed_country_flag = {
			flag = adv_foundry_destroyed
			days = 50 }
		}
	}

	ai_resource_production = {
		alloys = 1
		trigger = {
			always = yes
		}
	}
}

building_foundry_3 = {
	base_buildtime = @b3_time
	can_build = no

	category = manufacturing

	potential = {
		or = {
			exists = owner 
			owner = {
				is_ai = no
				resource_stockpile_compare = {
					resource = alloys
					value < 3000
				}
				used_naval_capacity_percent < 0.95
				resource_income_compare = {
					resource = alloys
					value < 100
				} 
			}
		
		}
	}
	allow = {
		has_major_upgraded_capital = yes
		buildings_upgrade_allow = yes
	}

	destroy_trigger = {
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			AND = {
				exists = owner
				buildings_no_motes = yes
			}
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		modifier = {
			job_alloy_drone_add = @b3_jobs
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		modifier = {
			job_fabricator_add = @b3_jobs
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		modifier = {
			job_foundry_add = @b3_jobs
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b3_minerals
			volatile_motes = @b3_rare_cost
		}
		upkeep = {
			energy = @b3_upkeep
			volatile_motes = @b3_rare_upkeep
		}
	}

	prerequisites = {
		tech_alloys_2
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		text = job_foundry_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		text = job_alloy_drone_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		text = job_fabricator_effect_desc
	}
	ai_weight = {
		weight = 3
		

		modifier = {
			factor = 0.5
			nor = {
				has_designation = col_foundry
				has_designation = col_mac_foundry
				has_designation = col_hiv_foundry
			}
		}

		modifier = {
			factor = 0.5
			free_building_slots > 0
		}
		modifier = {
			factor = 4
			free_building_slots = 0
			owner = {
					 has_country_flag = fine_mineral_economy 
					}
			owner = { resource_income_compare = {
				resource = volatile_motes
				value > 2 }
				resource_stockpile_compare = {
					resource = volatile_motes
					value > 70
				}
			}
		}
		modifier = {
			factor = 1.5
			or = { has_building = building_ministry_production 
			has_building = building_production_center }
		}
		modifier = {
			factor = 100
			free_building_slots = 0
			owner = {
					 has_country_flag = good_mineral_economy 
					}
			owner = { resource_income_compare = {
				resource = volatile_motes
				value > 3 }
			resource_stockpile_compare = {
				resource = minerals
				value > 2000
			}
			resource_stockpile_compare = {
				resource = energy
				value > 2000
			}
			resource_income_compare = {
				resource = minerals
				value > 100
			}
			resource_income_compare = {
				resource = minerals
				value > 20
			} }
		}
		modifier ={
			factor = 0.2
			or = {
			free_building_slots > 0
			owner = { resource_income_compare = {
				resource = volatile_motes
				value < 1 }
			}
			not = { has_building = building_ministry_production }
		}
		}
		modifier = {
			factor = 0.05
			owner = {
				has_country_flag = adv_foundry_queued
			}
		}
		

#		modifier = {
			#factor = 0
			#unsupervised_destruction = yes
			#owner = {
				#not = {
					#has_country_flag = fine_mineral_economy
				#}
				#not = {
				#has_country_flag = adv_foundry_destroyed
			#}
			#has_country_flag = has_ecumenopolis 
			#resource_stockpile_compare = {
				#resource = minerals
				#value < 20000
			#}
			#resource_stockpile_compare = {
				#resource = alloys
				#value > 4000
				
			#}
		#}
		#}

		modifier = {
			factor = 0.01
			owner = { resource_income_compare = {
				resource = volatile_motes
				value < 2 } 
				resource_stockpile_compare = {
					resource = volatile_motes
					value < 200
				}
			not = {
				has_country_flag = adv_foundry_queued
			}
			}
		}

		modifier = {
			factor = 0
			not = {
				owner = { has_country_flag = adv_foundry_destroyed }
			}
			owner = {
				not = { has_country_flag = acceptable_mineral_economy }
				resource_income_compare = {
					resource = volatile_motes
					value < 0
				}
				resource_stockpile_compare = {
					resource = volatile_motes
					value < 100
				}
			}
		}
	}
	on_queued = {
		owner = { set_timed_country_flag = {
			flag = adv_foundry_queued
			days = 1000 }
		}
	}

	
	on_destroy = {
		set_timed_planet_flag = {
			flag = just_destroyed_building
			days = 36
		}
		owner = { set_timed_country_flag = {
			flag = adv_foundry_destroyed
			days = 50 }
		}
	}

	ai_resource_production = {
		alloys = 1
		trigger = {
			always = yes
		}
	}

}

building_factory_1 = {
	base_buildtime = @b1_time

	category = manufacturing

	potential = {
		exists = owner
		owner = {
			OR = {
				is_gestalt = no
				has_valid_civic = civic_machine_servitor
			}
		}
		NOT = { has_modifier = resort_colony }
		NOT = { has_modifier = slave_colony }
			owner = {
				or = {
				is_ai = no
				resource_income_compare = {
					resource = consumer_goods
					value < 2
				} 
			}
		}
	}

	destroy_trigger = {
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony

			AND = {
				exists = owner
				owner = {
					is_ai = yes
					is_gestalt = yes
					NOT = { has_valid_civic = civic_machine_servitor }
				}
			}
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		modifier = {
			job_artisan_add = @b1_jobs
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		modifier = {
			job_artisan_drone_add = @b1_jobs
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b1_minerals
		}
		upkeep = {
			energy = @b1_upkeep
		}
	}

	prerequisites = {
		tech_basic_industry
	}

	upgrades = {
		building_factory_2
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		text = job_artisan_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		text = job_artisan_drone_effect_desc
	}

	
	ai_weight = {
		weight = 0.9
	
		modifier = {
			factor = 2.2
			free_building_slots > 1
			years_passed > 25
		}
		modifier = {
			factor = 0
			owner = { has_origin = origin_shattered_ring }
			planet = { is_planet_class = pc_ringworld_habitable is_capital = yes has_district = district_rw_commercial }
			years_passed < 10
		}

		modifier = {
			factor = 2
			owner = {
			resource_income_compare = {
				resource = consumer_goods
				value < 5
			} }
			years_passed > 30
		}
		
		modifier = {
			factor = 0.01
			owner = {
				or = {
					has_country_flag = just_queued_consgoods2
				and = {
					resource_income_compare = {
						resource = rare_crystals
						value < 2
					}
					resource_stockpile_compare = {
						resource = rare_crystals
						value < 2000
					} } 
				}
			}
		}
		modifier = {
			factor = 4
			free_building_slots > 2
			years_passed > 20
			owner = {
			resource_income_compare = {
				resource = consumer_goods
				value < 20
			} }
		}

		modifier = {
			factor = 6
			years_passed > 8
			owner = {
				resource_stockpile_compare = {
					resource = consumer_goods
					value < 500
				}
				resource_income_compare = {
					resource = consumer_goods
					value < 8
				}
				or = {
					resource_income_compare = {
						resource = consumer_goods
						value < 0
					}
					not = {
						has_country_flag = just_queued_consgoods
					}
				}
			}
		}

		modifier = {
			factor = 4
			owner = {
			resource_income_compare = {
				resource = consumer_goods
				value < 5
			} }
			any_owned_pop = {
				is_unemployed = yes 
				is_pop_category = specialist
			}
		}

		modifier = {
			factor = 3000
			owner = {
			or = {
				resource_income_compare = {
					resource = consumer_goods
					value < -2
				}
			and = {
				resource_income_compare = {
					resource = consumer_goods
					value < 1
				}
				resource_stockpile_compare = {
					resource = consumer_goods
					value <1000
				}
			} } }
		}
		modifier = {
		factor = 0.5
			owner = {
				resource_income_compare = {
					resource = consumer_goods
					value > 20
				}
			}
		}
		modifier = {
			factor = 0
			owner = {
				resource_income_compare = {
					resource = consumer_goods
					value > 60
				}
				not = {
					has_country_flag = just_destroyed_consgoods
				}
			}
			supervised_destruction = yes
		}

#	modifier = {
			#factor = 2
			#or = { 
			#has_designation = col_factory
			#has_designation = col_ecu_factory
			#} 
		#}

		#modifier = {
			#factor = 0.5
			#or = { 
			#has_designation = col_research
			#has_designation = col_foundry
			#is_planet_class = pc_habitat
			#is_planet_class = pc_ringworld_habitable
			#} 
		#}

		#modifier = {
			#factor = 3
			#has_planet_flag = str_consgoods
		#}
		#modifier = {
			#factor = 0.4
			#or = {
				#has_planet_flag = str_research
				#has_planet_flag = str_alloy
			#}
		#}

		#modifier ={
			#factor = 0.5
			#free_amenities < -10
		#}
		#modifier = {
			#factor = 3
			#any_owned_pop = {
				#is_unemployed = yes
			#}
		#}
		#modifier = {
			#factor = 0.5
			#owner = {
				#resource_income_compare = {
					#resource = minerals
					#value < 50
				#}
			#}
		#}

		#modifier = {
			#factor = 10
			#owner = {
				#resource_income_compare = {
					#resource = consumer_goods
					#value < 0
				#}
				#resource_stockpile_compare = {
					#resource = consumer_goods
					#value < 1000
				#}
			#}
		#}
		#modifier = {
			#factor = 10
			#owner = {
				#resource_income_compare = {
					#resource = consumer_goods
					#value < -15
				#}
			#}
		#}
		#modifier = {
			#factor = 5
			#owner = {
				#resource_income_compare = {
					#resource = consumer_goods
					#value < -10
				#}
			#}
		#}
		#modifier = {
			#factor = 5
			#owner = {
				#resource_income_compare = {
					#resource = consumer_goods
					#value < -5
				#}
			#}
		#}
		#modifier = {
			#factor = 20
			#owner = {
				#resource_income_compare = {
					#resource = consumer_goods
					#value < 0
				#}
				#resource_stockpile_compare = {
					#resource = consumer_goods
					#value < 400
				#}
			#}
		#}
		
		#modifier = {
			#factor = 0.1
			#owner = {
				#resource_income_compare = {
					#resource = consumer_goods
					#value > 60
				#}
			#}
		#}
		#modifier = {
			#factor = 10
			#owner = {
				#resource_income_compare = {
					#resource = consumer_goods
					#value < 0
				#}
			#}
		#}
		#modifier = {
			#factor = 0.5
			#or = {
			#years_passed < 4
			#owner = { needs_goods = no }
			#}
		#} 
		#modifier = {
			#factor = 10
			#owner = { has_deficit = consumer_goods }
		#}
		#modifier = {
			#factor = 10
			#owner = { really_needs_goods = yes }
		#}
		#modifier = {
			#factor = 0.1
			#owner = { excess_goods = yes }
		#}

		#modifier = {
			#factor = 0.4
			#not = {
				#any_owned_pop = {
					#is_unemployed = yes
				#}
			#}
			#owner = {
					 #not = { has_country_flag = acceptable_mineral_economy }
					#}
			#owner = { resource_income_compare = {
				#resource = alloys
				#value > 20
			#}
			#owner = { resource_income_compare = {
				#resource = consumer_goods
				#value > 5
			#} }
			#}
			#free_building_slots = 1
		#}



		modifier = {
			factor = 10
			years_passed > 40
			free_building_slots > 1
			owner = {
				good_economy_trigger = yes
			}
		}
		
	}

	on_built = {
		if = {
			limit = {
				free_housing < 0
				free_district_slots = 0
			}
			city_district_check = yes
		}
	}
	on_queued = {
		owner = {
			set_timed_country_flag = {
				flag = just_queued_consgoods
				days = 400
			}
			set_timed_country_flag = {
				flag = just_queued_consgoods2
				days = 400
			}
		}
	}
	on_destroy = {
		set_timed_planet_flag = {
			flag = just_destroyed_building
			days = 36
		}
		owner = {
			set_timed_country_flag = {
				flag = just_destroyed_consgoods
				days = 100
			}
		}
	}

	ai_resource_production = {
		consumer_goods = 1
		trigger = {
			always = yes
		}
	}
}

building_factory_2 = {
	base_buildtime = @b2_time
	can_build = no

	category = manufacturing

	allow = {
		has_upgraded_capital = yes
		buildings_upgrade_allow = yes
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_gestalt = no
				has_valid_civic = civic_machine_servitor
			}
		}
		NOT = { has_modifier = resort_colony }
		NOT = { has_modifier = slave_colony }
			owner = {
				or = {
				is_ai = no
				resource_income_compare = {
					resource = consumer_goods
					value < 5
				}
			}
		}
	}

	destroy_trigger = {
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony

			AND = {
				exists = owner
				owner = {
					is_ai = yes
					is_gestalt = yes
					NOT = { has_valid_civic = civic_machine_servitor }
				}
			}
			buildings_no_crystals = yes
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		modifier = {
			job_artisan_add = 5
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		modifier = {
			job_artisan_drone_add = 5
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b2_minerals
			rare_crystals = @b2_rare_cost
		}
		upkeep = {
			energy = @b2_upkeep
			rare_crystals = @b2_rare_upkeep
		}
	}

	prerequisites = {
		tech_luxuries_1
	}

	upgrades = {
		building_factory_3
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		text = job_artisan_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		text = job_artisan_drone_effect_desc
	}
	
	ai_weight = {
		weight = 0.8
		modifier = {
			factor = 0.5
			not = {
				has_designation = col_factory
			}
		}
		modifier = {
			factor = 0.25
			owner = {
					 not = { has_country_flag = fine_mineral_economy }
					}
		}
		
		modifier = {
			factor = 4
			free_building_slots = 0
			owner = {
					 has_country_flag = fine_mineral_economy 
					}
			owner = { resource_income_compare = {
				resource = rare_crystals
				value > 2 }
				resource_income_compare = {
					resource = consumer_goods
					value < 10
				}
				resource_stockpile_compare = {
					resource = rare_crystals
					value > 10
				}
			}
		}
		modifier = {
			factor = 1.5
			or = { has_building = building_ministry_production 
			has_building = building_production_center }
		}

		modifier = {
			factor = 40
			free_building_slots = 0
			owner = {
					 has_country_flag = good_mineral_economy 
					}
			owner = { resource_income_compare = {
				resource = rare_crystals
				value > 3 }
				resource_income_compare = {
					resource = consumer_goods
					value < 10
				}
				resource_stockpile_compare = {
					resource = rare_crystals
					value > 70
				}
				resource_stockpile_compare = {
					resource = minerals
					value > 2000
				}
				resource_stockpile_compare = {
					resource = energy
					value > 2000
				}
				resource_income_compare = {
					resource = minerals
					value > 100
				}
				resource_income_compare = {
					resource = minerals
					value > 20
				}
			}
		}
		modifier ={
			factor = 0.1
			or = {
			free_building_slots > 0
			owner = { resource_income_compare = {
				resource = rare_crystals
				value < 1 }
			}
			not = { has_building = building_ministry_production }
		}
		}
		modifier = {
			factor = 0
			owner = { resource_income_compare = {
				resource = rare_crystals
				value < 0 } 
			not = {
				has_country_flag = adv_factory_destroyed
			}
			}
		}
		
#		modifier = {
			#factor = 0
			#unsupervised_destruction = yes
			#owner = {
				#not = {
					#has_country_flag = fine_mineral_economy
				#}
				#not = {
				#has_country_flag = adv_factory_destroyed
			#}
			#has_country_flag = has_ecumenopolis 
			#resource_stockpile_compare = {
				#resource = minerals
				#value < 20000
			#}
			#resource_income_compare = {
				#resource = consumer_goods
				#value > 20
				
			#}
			#resource_stockpile_compare = {
				#resource = consumer_goods
				#value > 1000
				
			#}
		#}
		#}
		modifier = {
			factor = 10
			owner = {
				resource_income_compare = {
					resource = consumer_goods
					value < 10
				}
				not = { has_country_flag = acceptable_mineral_economy }
				resource_income_compare = {
					resource = rare_crystals
					value < 0
				}
				resource_stockpile_compare = {
					resource = rare_crystals
					value < 50
				}
			}
		}
		
	}

	on_destroy = {
		set_timed_planet_flag = {
			flag = just_destroyed_building
			days = 36
		}
		owner = { set_timed_country_flag = {
			flag = adv_factory_destroyed
			days = 50 }
		}
	}

	ai_resource_production = {
		consumer_goods = 1
		trigger = {
			always = yes
		}
	}

	on_queued = {
		IF = {
			limit = {
				owner = { has_technology = tech_construction_templates }
			}
			owner = { set_timed_country_flag = { flag = buildings_new_crystal_building days = 270 } }
		}
		ELSE_IF = {
			limit = {
				owner = { has_technology = tech_assembly_pattern }
			}
			owner = { set_timed_country_flag = { flag = buildings_new_crystal_building days = 390 } }
		}
		ELSE = {
			planet = {
				owner = { set_timed_country_flag = { flag = buildings_new_crystal_building days = 510 } }
			}
		}
	}
}

building_factory_3 = {
	base_buildtime = @b3_time
	can_build = no

	category = manufacturing

	allow = {
		has_major_upgraded_capital = yes
		buildings_upgrade_allow = yes
	}

	potential = {
		exists = owner
		owner = {
			OR = {
				is_gestalt = no
				has_valid_civic = civic_machine_servitor
			}
		}
		NOT = { has_modifier = resort_colony }
		NOT = { has_modifier = slave_colony }
			owner = {
				or = {
				is_ai = no
				resource_income_compare = {
					resource = consumer_goods
					value < 5
				}
			}
		}
	}

	destroy_trigger = {
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony

			AND = {
				exists = owner
				owner = {
					is_ai = yes
					is_gestalt = yes
					NOT = { has_valid_civic = civic_machine_servitor }
				}
			}
			buildings_no_crystals = yes
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		modifier = {
			job_artisan_add = @b3_jobs
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		modifier = {
			job_artisan_drone_add = @b3_jobs
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b3_minerals
			rare_crystals = @b3_rare_cost
		}
		upkeep = {
			energy = @b3_upkeep
			rare_crystals = @b3_rare_upkeep
		}
	}

	prerequisites = {
		tech_luxuries_2
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		text = job_artisan_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		text = job_artisan_drone_effect_desc
	}
	ai_weight = {
		weight = 0.8
	
		modifier = {
			factor = 0.5
			not = {
				has_designation = col_factory
			}
		}

		modifier = {
			factor = 0
			is_planet_class = pc_city
			nor = {
				any_owned_pop = {
					is_unemployed = yes
				}
				any_owned_pop ={ 
					has_job = clerk
				}
				any_owned_pop = {
					has_job = maintenance_drone
				}				
			}
		}
		modifier = {
			factor = 0.25
			owner = {
					 not = { has_country_flag = fine_mineral_economy }
					}
		}
		

		modifier = {
			factor = 4
			free_building_slots = 0
			owner = {
					 has_country_flag = fine_mineral_economy 
					}
			owner = { resource_income_compare = {
				resource = rare_crystals
				value > 2 }
				resource_income_compare = {
					resource = consumer_goods
					value < 10
				}
			}
		}
		modifier = {
			factor = 1.5
			or = { has_building = building_ministry_production 
			has_building = building_production_center }
		}

		modifier = {
			factor = 40
			free_building_slots = 0
			owner = {
					 has_country_flag = good_mineral_economy 
					}
			owner = { resource_income_compare = {
				resource = rare_crystals
				value > 3 }
				resource_income_compare = {
					resource = consumer_goods
					value < 10
				}
				resource_stockpile_compare = {
					resource = rare_crystals
					value > 70
				}
				resource_stockpile_compare = {
					resource = minerals
					value > 2000
				}
				resource_stockpile_compare = {
					resource = energy
					value > 2000
				}
				resource_income_compare = {
					resource = minerals
					value > 100
				}
				resource_income_compare = {
					resource = minerals
					value > 20
				}
			}
		}
		modifier ={
			factor = 0.25
			or = {
			free_building_slots = 0
			owner = { resource_income_compare = {
				resource = rare_crystals
				value < 1 }
			}
			not = { has_building = building_ministry_production }
		}
		}
		modifier = {
			factor = 0.05
			owner = {
				has_country_flag = adv_factory_queued
			}
		}

		modifier = {
			factor = 20
			free_building_slots = 0
			owner = {
				resource_income_compare = {
					resource = minerals
					value > 200
				}
				resource_income_compare = {
					resource = consumer_goods
					value < 10
				}
				resource_stockpile_compare = {
					resource = minerals
					value > 12000
				}
				resource_income_compare = {
					resource = rare_crystals
					value > 3
				}
			}
		}
#		modifier = {
			#factor = 0
			#unsupervised_destruction = yes
			#owner = {
				#not = {
					#has_country_flag = fine_mineral_economy
				#}
				#not = {
				#has_country_flag = adv_factory_destroyed
			#}
			#has_country_flag = has_ecumenopolis
			#resource_stockpile_compare = {
				#resource = minerals
				#value < 20000
			#} 
			#resource_income_compare = {
				#resource = consumer_goods
				#value > 40
				
			#}
			#resource_stockpile_compare = {
				#resource = consumer_goods
				#value > 1000
				
			#}
		#}
		#}
		
		modifier = {
			factor = 0
			not = {
				has_planet_flag = just_destroyed_building
			}
			not = {
				owner = { has_country_flag = adv_foundry_destroyed }
			}
			owner = {
				not = { has_country_flag = acceptable_mineral_economy }
				resource_income_compare = {
					resource = rare_crystals
					value < 0
				}
				resource_stockpile_compare = {
					resource = rare_crystals
					value < 50
				}
			}
		}


	}
	on_queued = {
		owner = { set_timed_country_flag = {
			flag = adv_factory_queued
			days = 1000 }
		}
	}

	
	on_destroy = {
		set_timed_planet_flag = {
			flag = just_destroyed_building
			days = 36
		}
		owner = { set_timed_country_flag = {
			flag = adv_factory_destroyed
			days = 50 }
		}
	}

	ai_resource_production = {
		consumer_goods = 1
		trigger = {
			always = yes
		}
	}

	on_queued = {
		IF = {
			limit = {
				owner = { has_technology = tech_construction_templates }
			}
			owner = { set_timed_country_flag = { flag = buildings_new_crystal_building days = 270 } }
		}
		ELSE_IF = {
			limit = {
				owner = { has_technology = tech_assembly_pattern }
			}
			owner = { set_timed_country_flag = { flag = buildings_new_crystal_building days = 390 } }
		}
		ELSE = {
			planet = {
				owner = { set_timed_country_flag = { flag = buildings_new_crystal_building days = 510 } }
			}
		}
	}
}

building_refinery = {
	base_buildtime = @b2_time

	category = manufacturing

	potential = {
		NOT = { has_modifier = resort_colony }
		NOT = { has_modifier = slave_colony }
	}

	allow = {
		has_upgraded_capital = yes
	}

	destroy_trigger = {
		free_building_slots = 0
		exists = owner
		supervised_destruction = yes
		owner = {
			is_ai = yes
			has_monthly_income = {
				resource = exotic_gases
				value > 11
			}
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_gestalt = no }
		}
		modifier = {
			job_gas_refiner_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		modifier = {
			job_gas_refiner_drone_add = 1
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = 500
		}
		upkeep = {
			energy = 3
		}
	}

	prerequisites = {
		"tech_exotic_gases"
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_gestalt = no }
		}
		text = job_gas_refiner_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		text = job_gas_refiner_drone_effect_desc
	}
	ai_weight = {
		weight = 0.5
		modifier = {
			factor = 3
			has_designation = col_refinery
		}
		modifier = {
			factor = 0.03
				owner = { 
					resource_income_compare = {
						resource = exotic_gases
						value > 0 
					}
					nor = {
					has_technology = tech_energy_torpedoes_1
					has_technology = tech_basic_science_lab_2
				} 
			}
		}
		modifier = {
			factor = 6
			owner = {
				NOT = {
				has_country_flag = adv_refinery_queued
				}
				has_technology = tech_lasers_4
				resource_income_compare = {
					resource = exotic_gases
					value < 1
				}
			}
		}
		
		modifier = {
			factor = 0.01
			owner = { has_country_flag = just_destroyed_gas }
			owner = {
				resource_income_compare	= {
					resource = exotic_gases
					value > 6
				}
			}
			OR = {
				free_amenities < -10
				owner = {
					resource_income_compare	= {
						resource = exotic_gases
						value > 5
					}
				resource_stockpile_compare = {
					resource = exotic_gases
					value > 1000
				}
			}
			}
		}

		modifier = {
			factor = 0
			not = {
				owner = { has_country_flag = just_destroyed_gas }
			}
			owner = {
				resource_income_compare	= {
					resource = exotic_gases
					value > 6
				}
			}
			OR = {
				free_amenities < -10
				owner = {
					resource_income_compare	= {
						resource = exotic_gases
						value > 5
					}
				resource_stockpile_compare = {
					resource = exotic_gases
					value > 1000
				}
			}
			}
		}	
		modifier = {
			factor = 50
			owner = { 
				resource_income_compare = {
					resource = exotic_gases
					value < 2
				}
				or = {
				has_technology = tech_energy_torpedoes_1
				has_technology = tech_basic_science_lab_2
			} 
		}
			owner = {
				not = {
					has_country_flag = adv_refinery_queued
				}
				resource_income_compare = {
					resource = consumer_goods
					value > 5
				}
			}
			owner = {
				has_country_flag = good_mineral_economy
				resource_income_compare = {
					resource = exotic_gases
					value < 4
				}
				resource_stockpile_compare = {
					resource = exotic_gases
					value < 500
				}
			}
		}
		modifier = {
			factor = 10
			owner = { 
				nor = {
				has_technology = tech_energy_torpedoes_1
				has_technology = tech_basic_science_lab_2
			} 
			resource_income_compare = {
				resource = consumer_goods
				value > 5
			}
		}
			owner = {
				not = {
					has_country_flag = adv_refinery_queued
				}
			}
			owner = {
				has_country_flag = fine_mineral_economy
				resource_income_compare = {
					resource = exotic_gases
					value < 3
				}
				resource_stockpile_compare = {
					resource = exotic_gases
					value < 500
				}
			}
		}
	
		modifier = {
			factor = 5
			owner = {
				not = {
					has_country_flag = adv_refinery_queued
				}
			}
			owner = {
				has_country_flag = acceptable_mineral_economy
				resource_income_compare = {
					resource = exotic_gases
					value < 2
				}
				resource_stockpile_compare = {
					resource = exotic_gases
					value < 200
				}
				resource_income_compare = {
					resource = consumer_goods
					value > 5
				}
			}
		}
		modifier = {
			factor = 0.3
			owner = {
				has_country_flag = adv_refinery_queued
			}
		}
		modifier = {
			factor = 5
			owner = { 
				nor = {
				has_technology = tech_energy_torpedoes_1
				has_technology = tech_basic_science_lab_2
			} 
		}
			owner = {
				not = {
					has_country_flag = adv_refinery_queued
				}
			}
			owner = {
				resource_income_compare = {
					resource = minerals
					value > 100
				}
				resource_stockpile_compare = {
					resource = minerals
					value > 5000
				}
				resource_income_compare = {
					resource = exotic_gases
					value < 3
				}
				resource_stockpile_compare = {
					resource = exotic_gases
					value < 500
				}
				resource_income_compare = {
					resource = consumer_goods
					value > 5
				}
			}
		}
	}



	on_queued = {
		owner = { set_timed_country_flag = {
			flag = adv_refinery_queued
			days = 40 }
		}
	}

	on_destroy = {
		set_timed_planet_flag = {
			flag = just_destroyed_building
			days = 36
		}
		owner = { set_timed_country_flag = {
			flag = just_destroyed_gas
			days = 36
		} }
	}
	ai_resource_production = {
		exotic_gases = 1
		trigger = {
			always = yes
		}
	}

	on_queued = {
		IF = {
			limit = {
				owner = { has_technology = tech_construction_templates }
			}
			owner = { set_timed_country_flag = { flag = buildings_new_exotic_gases_plant days = 270 } }
		}
		ELSE_IF = {
			limit = {
				owner = { has_technology = tech_assembly_pattern }
			}
			owner = { set_timed_country_flag = { flag = buildings_new_exotic_gases_plant days = 390 } }
		}
		ELSE = {
			planet = {
				owner = { set_timed_country_flag = { flag = buildings_new_exotic_gases_plant days = 510 } }
			}
		}
	}
}

building_chemical_plant = {
	base_buildtime = @b2_time

	category = manufacturing

	potential = {
		NOT = { has_modifier = resort_colony }
		NOT = { has_modifier = slave_colony }
	}

	allow = {
		has_upgraded_capital = yes
	}
	destroy_trigger = {
		free_building_slots = 0
		exists = owner
		supervised_destruction = yes
		owner = {
			is_ai = yes
			has_monthly_income = {
				resource = volatile_motes
				value > 9
			}
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_gestalt = no }
		}
		modifier = {
			job_chemist_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		modifier = {
			job_chemist_drone_add = 1
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b2_minerals
		}
		upkeep = {
			energy = 3
		}
	}

	prerequisites = {
		"tech_volatile_motes"
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_gestalt = no }
		}
		text = job_chemist_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		text = job_chemist_drone_effect_desc
	}

	ai_weight = {
		weight = 0.5
		modifier = {
			factor = 4
			has_designation = col_refinery
		}
		modifier = {
			factor = 3
			owner = {
				NOT = {
				has_country_flag = adv_motes_queued
				}
				has_technology = tech_lasers_4
				resource_income_compare = {
					resource = volatile_motes
					value < 1
				}
			}
		}
		modifier = {
			factor = 0.05
			owner = {
				resource_income_compare = {
					resource = volatile_motes
					value > 0 
				}
			}
			not = {
				owner = { 
					has_technology = tech_alloys_1 
				}
			}
		}
		modifier = {
			factor = 0.01
			owner = {
				resource_income_compare	= {
					resource = volatile_motes
					value > 6
				}
					has_country_flag = just_destroyed_motes
				resource_stockpile_compare = {
					resource = volatile_motes
					value > 1000
				}
			}
			OR = {
				free_amenities < -10
				owner = {
					resource_income_compare	= {
						resource = volatile_motes
						value > 5
					}
				}
			}
		}	
		modifier = {
			factor = 0
			owner = {
				resource_income_compare	= {
					resource = volatile_motes
					value > 6
				}
				not = {
					has_country_flag = just_destroyed_motes
				}
				resource_stockpile_compare = {
					resource = volatile_motes
					value > 1000
				}
			}
			OR = {
				free_amenities < -10
				owner = {
					resource_income_compare	= {
						resource = volatile_motes
						value > 5
					}
				}
			}
		}		
		modifier = {
			factor = 10
			owner = {
				not = {
					has_country_flag = adv_motes_queued
				}
			}
			owner = {
				has_country_flag = good_mineral_economy
				resource_income_compare = {
					resource = volatile_motes
					value < 4
				}
				resource_stockpile_compare = {
					resource = volatile_motes
					value < 500
				}
				resource_income_compare = {
					resource = consumer_goods
					value > 5
				}
			}
		}
		modifier = {
			factor = 10
			owner = { 
				has_technology = tech_alloys_1 
			}
			owner = {
				not = {
					has_country_flag = adv_motes_queued
				}
			}
			owner = {
				has_country_flag = fine_mineral_economy
				resource_income_compare = {
					resource = volatile_motes
					value < 3
				}
				resource_stockpile_compare = {
					resource = volatile_motes
					value < 500
				}
				resource_income_compare = {
					resource = consumer_goods
					value > 5
				}
			}
		}
	
		modifier = {
			factor = 10
			owner = { 
				has_technology = tech_alloys_1 
			}
			owner = {
				not = {
					has_country_flag = adv_motes_queued
				}
			}
			owner = {
				has_country_flag = acceptable_mineral_economy
				resource_income_compare = {
					resource = volatile_motes
					value < 2
				}
				resource_stockpile_compare = {
					resource = volatile_motes
					value < 500
				}
				resource_income_compare = {
					resource = consumer_goods
					value > 5
				}
			}
		}
		
		modifier = {
			factor = 0.3
			owner = {
				has_country_flag = adv_motes_queued
			}
		}
		modifier = {
			factor = 20
			owner = { 
				has_technology = tech_alloys_1 
			}
			owner = {
				not = {
					has_country_flag = adv_motes_queued
				}
			}
			owner = {
				resource_income_compare = {
					resource = minerals
					value > 100
				}
				resource_stockpile_compare = {
					resource = minerals
					value > 5000
				}
				resource_income_compare = {
					resource = volatile_motes
					value < 3
				}
				resource_stockpile_compare = {
					resource = volatile_motes
					value < 500
				}
				resource_income_compare = {
					resource = consumer_goods
					value > 5
				}
			}
		}
	}
	on_queued = {
		owner = { set_timed_country_flag = {
			flag = adv_motes_queued
			days = 40 }
		}
	}
	
	on_destroy = {
		set_timed_planet_flag = {
			flag = just_destroyed_building
			days = 36
		}
		owner = { set_timed_country_flag = {
			flag = just_destroyed_motes
			days = 36
		} }
	}
	ai_resource_production = {
		volatile_motes = 1
		trigger = {
			always = yes
		}
	}

	on_queued = {
		IF = {
			limit = {
				owner = { has_technology = tech_construction_templates }
			}
			owner = { set_timed_country_flag = { flag = buildings_new_mote_plant days = 270 } }
		}
		ELSE_IF = {
			limit = {
				owner = { has_technology = tech_assembly_pattern }
			}
			owner = { set_timed_country_flag = { flag = buildings_new_mote_plant days = 390 } }
		}
		ELSE = {
			planet = {
				owner = { set_timed_country_flag = { flag = buildings_new_mote_plant days = 510 } }
			}
		}
	}
}

building_crystal_plant = {
	base_buildtime = @b2_time

	category = manufacturing

	potential = {
		NOT = { has_modifier = resort_colony }
		NOT = { has_modifier = slave_colony }
	}

	allow = {
		has_upgraded_capital = yes
	}

	destroy_trigger = {
		free_building_slots = 0
		exists = owner
		supervised_destruction = yes
		owner = {
			is_ai = yes
			has_monthly_income = {
				resource = rare_crystals
				value > 9
			}
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_gestalt = no }
		}
		modifier = {
			job_translucer_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		modifier = {
			job_translucer_drone_add = 1
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b2_minerals
		}
		upkeep = {
			energy = 3
		}
	}

	prerequisites = {
		"tech_rare_crystals"
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_gestalt = no }
		}
		text = job_translucer_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		text = job_translucer_drone_effect_desc
	}

	upgrades = {
		"building_crystal_plant_2"
	}
	ai_weight = {
		weight = 0.5
		modifier = {
			factor = 3
			has_designation = col_refinery
		}
		modifier = {
			factor = 3
			owner = {
				NOT = {
				has_country_flag = adv_crystals_queued
				}
				has_technology = tech_lasers_4
				resource_income_compare = {
					resource = rare_crystals
					value < 1
				}
			}
		}
		modifier = {
			factor = 0.03
			owner = {
				resource_income_compare = {
					resource = rare_crystals
					value > 0 
				}
			}
			not = {
				owner = { has_technology = tech_luxuries_2 }
			}
		}
		
		modifier = {
			factor = 0
			owner = {
				or = {
				resource_income_compare	= {
					resource = rare_crystals
					value > 8
				}
				and = {
					resource_stockpile_compare = {
						resource = rare_crystals
						value > 1000
					}
					resource_income_compare = {
						resource = rare_crystals
						value > 5
					}
					resource_income_compare = {
						resource = consumer_goods
						value > 5
					}
				}
			}
				not = {
					has_country_flag = just_destroyed_crystals
				}
			}
			OR = {
				free_amenities < -10
				owner = {
					resource_income_compare	= {
						resource = rare_crystals
						value > 5
					}
				}
			}
		}		
		
		modifier = {
			factor = 10
			owner = { has_technology = tech_luxuries_2 }
			owner = {
				not = {
					has_country_flag = adv_crystals_queued
				}
			}
			owner = {
				has_country_flag = good_mineral_economy
				resource_income_compare = {
					resource = rare_crystals
					value < 4
				}
				resource_stockpile_compare = {
					resource = rare_crystals
					value < 200
				}
			}
		}
		modifier = {
			factor = 10
			owner = {
				not = {
					has_country_flag = adv_crystals_queued
				}
			}
			owner = {
				has_country_flag = fine_mineral_economy
				resource_income_compare = {
					resource = rare_crystals
					value < 3
				}
				resource_stockpile_compare = {
					resource = rare_crystals
					value < 500
				}
			}
		}
	
		modifier = {
			factor = 10
			owner = { has_technology = tech_luxuries_2 }
			owner = {
				not = {
					has_country_flag = adv_crystals_queued
				}
			}
			owner = {
				resource_stockpile_compare = {
					resource = minerals
					value > 5000
				}
				resource_income_compare = {
					resource = minerals
					value > 100
				}
				resource_income_compare = {
					resource = rare_crystals
					value < 1
				}
				resource_income_compare = {
					resource = consumer_goods
					value > 5
				}
			}
		}
		
		modifier = {
			factor = 0
			is_planet_class = pc_city
			nor = {
				any_owned_pop = {
					is_unemployed = yes
				}
				any_owned_pop ={ 
					has_job = clerk
				}
				any_owned_pop = {
					has_job = maintenance_drone
				}				
			}
		}

		modifier = {
			factor = 10
			owner = {
				not = {
					has_country_flag = adv_crystals_queued
				}
			}
			owner = {
				has_country_flag = acceptable_mineral_economy
				resource_income_compare = {
					resource = rare_crystals
					value < 3
				}
		}
	}

		modifier = {
			factor = 0.3
			owner = {
				has_country_flag = adv_crystals_queued
			}
		}
	}
	on_queued = {
		owner = { set_timed_country_flag = {
			flag = adv_crystals_queued
			days = 100 }
		}
	}

	on_destroy = {
		set_timed_planet_flag = {
			flag = just_destroyed_building
			days = 36
		}
		owner = { set_timed_country_flag = {
			flag = just_destroyed_crystals
			days = 36
		} }
	}
	ai_resource_production = {
		rare_crystals = 1
		trigger = {
			always = yes
		}
	}

	on_queued = {
		IF = {
			limit = {
				owner = { has_technology = tech_construction_templates }
			}
			owner = { set_timed_country_flag = { flag = buildings_new_crystal_plant days = 270 } }
		}
		ELSE_IF = {
			limit = {
				owner = { has_technology = tech_assembly_pattern }
			}
			owner = { set_timed_country_flag = { flag = buildings_new_crystal_plant days = 390 } }
		}
		ELSE = {
			planet = {
				owner = { set_timed_country_flag = { flag = buildings_new_crystal_plant days = 510 } }
			}
		}
	}
}

building_nanite_transmuter = {
	base_buildtime = @b3_time

	category = manufacturing

	potential = {
		exists = owner
		OWNER = {
			OR = {
				has_monthly_income = {
					resource = nanites
					value > 0
				}
				AND = {
					is_ai = no
					has_resource = {
						type = nanites
						amount > 0
					}
				}
			}
		}
		NOR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
		}
	}

	allow = {
		has_upgraded_capital = yes
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = 1000
		}
		produces = {
			trigger = {
				owner = {
					NOT = {
						has_deficit = nanites
					}
				}
			}
			rare_crystals = 2
			volatile_motes = 2
			exotic_gases = 2
		}
		upkeep = {
			nanites = 1
			energy = 5
		}
	}

	prerequisites = {
		"tech_nanite_transmutation"
	}

	ai_weight = {
		weight = 0
		modifier = {
			weight = 10
			buildings_build_building = yes
			owner = {
				has_monthly_income = {
					resource = nanites
					value > 5
				}
			}
		}#Nothing else uses the monthly income but new starships. As such the only important check is the number of nanites coming into the country.
	}

	ai_resource_production = {
		rare_crystals = @b3_rare_upkeep
		volatile_motes = @b3_rare_upkeep
		exotic_gases = @b3_rare_upkeep
		trigger = {
			always = yes
		}
	}
}

building_ministry_production = {
	base_buildtime = @b2_time
	base_cap_amount = 1
	icon = building_production_center

	category = manufacturing

	potential = {
		exists = owner
		owner = { is_regular_empire = yes }
		NOR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
		}
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = { is_regular_empire = no }
			has_modifier = resort_colony
			has_modifier = slave_colony
			buildings_no_motes = yes
		}
	}

	allow = {
		has_major_upgraded_capital = yes
	}

	planet_modifier = {
		job_administrator_add = 1
		planet_metallurgists_produces_mult = 0.15
		planet_artisans_produces_mult = 0.15
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b2_minerals
			volatile_motes = @b2_rare_cost
		}
		upkeep = {
			energy = @b2_upkeep
			volatile_motes = @b2_rare_upkeep
		}
	}

	prerequisites = {
		"tech_global_production_strategy"
	}

	triggered_desc = {
		text = job_administrator_effect_desc
	}

	show_tech_unlock_if = {
		is_regular_empire = yes
	}
	ai_weight = {
		weight = 0.5
		modifier = {
			factor = 0
			has_building = building_institute
		}

		modifier = {
			factor = 9999
			has_planet_flag = ecumen
		}
		modifier = {
			factor = 0.5
			free_amenities < -10
		}
		modifier = {
			factor = 4
			count_pops = { limit ={ 
				OR = {
					has_job = artisan
					has_job = artisan_drone 
				}
			}
			count > 5
		}
		}
		modifier = {
			factor = 4
			count_pops = { limit ={ 
				OR = {
					has_job = foundry
					has_job = alloy_drone 
					has_job = fabricator
				}
			}
			count > 5
		}
		}
		modifier = {
			factor = 0
			unsupervised_destruction = yes
			count_pops = { limit ={ 
				OR = {
					has_job = foundry
					has_job = alloy_drone 
					has_job = fabricator
				}
			}
			count < 3
		}
		}
		modifier = {
			factor = 5
			count_pops = { limit ={ 
				OR = {
					has_job = artisan
					has_job = artisan_drone 
				}
			}
			count > 10
		}
		}
		modifier = {
			factor = 5
			count_pops = { limit ={ 
				OR = {
					has_job = foundry
					has_job = alloy_drone 
					has_job = fabricator
				}
			}
			count > 10
		}
		}

	}

}

building_production_center = {
	base_buildtime = @b2_time
	base_cap_amount = 1

	category = manufacturing

	potential = {
		exists = owner
		owner = { is_gestalt = yes }
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = { is_gestalt = no }
			buildings_no_motes = yes
		}
	}

	allow = {
		has_major_upgraded_capital = yes
	}

	planet_modifier = {
		planet_metallurgists_produces_mult = 0.15
		planet_artisans_produces_mult = 0.15
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b2_minerals
			volatile_motes = @b2_rare_cost
		}
		upkeep = {
			energy = @b2_upkeep
			volatile_motes = @b2_rare_upkeep
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		job_alloy_drone_add = 2
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		job_fabricator_add = 1
	}

	prerequisites = {
		"tech_global_production_strategy"
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		text = job_alloy_drone_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		text = job_fabricator_effect_desc
	}

	show_tech_unlock_if = {
		is_gestalt = yes
	}
	ai_weight = {
		weight = 0.5
		modifier = {
			factor = 0
			has_building = building_institute
		}

		modifier = {
			factor = 9999
			has_planet_flag = ecumen
		}
		modifier = {
			factor = 0.5
			free_amenities < -10
		}
		modifier = {
			factor = 4
			count_pops = { limit ={ 
				OR = {
					has_job = artisan
					has_job = artisan_drone 
				}
			}
			count > 5
		}
		}
		
		modifier = {
			factor = 0
			unsupervised_destruction = yes
			count_pops = { limit ={ 
				OR = {
					has_job = foundry
					has_job = alloy_drone 
					has_job = fabricator
				}
			}
			count < 3
		}
		}
		modifier = {
			factor = 4
			count_pops = { limit ={ 
				OR = {
					has_job = foundry
					has_job = alloy_drone 
					has_job = fabricator
				}
			}
			count > 5
		}
		}
		modifier = {
			factor = 5
			count_pops = { limit ={ 
				OR = {
					has_job = artisan
					has_job = artisan_drone 
				}
			}
			count > 10
		}
		}
		modifier = {
			factor = 5
			count_pops = { limit ={ 
				OR = {
					has_job = foundry
					has_job = alloy_drone 
					has_job = fabricator
				}
			}
			count > 10
		}
		}

	}

}
