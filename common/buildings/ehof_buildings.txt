#############
# Resource buildings
#############
building_ehof_sm_forge_1 = {
	base_buildtime = @b3_time
	category = manufacturing
	upgrades = { building_ehof_sm_forge_2 }
	prerequisites = { tech_ehof_sentient_tier_1 }

	potential = {
		owner = { has_country_flag = extracted_sentient_metal }
		NOT = { has_modifier = resort_colony }
		NOT = { has_modifier = slave_colony }
		OR = {
			building_relaxed_basic_income_check = yes
			AND = {
				num_buildings = { type = building_ehof_sm_forge_1 value < 5 }
				is_capital = yes
				owner = {
					OR = {
						country_uses_consumer_goods = no
						country_uses_food = no
					}
				}
			}
		}
	}

	destroy_trigger = { OR = { has_modifier = resort_colony has_modifier = slave_colony } }

	triggered_planet_modifier = { potential = { exists = owner owner = { is_hive_empire = yes } }		modifier = { job_ehof_cultivation_drone_add = @b1_jobs } }
	triggered_planet_modifier = { potential = { exists = owner owner = { is_machine_empire = yes } }	modifier = { job_ehof_cultivation_drone_add = @b1_jobs } }
	triggered_planet_modifier = { potential = { exists = owner owner = { is_regular_empire = yes } }	modifier = { job_ehof_cultivator_add = @b1_jobs } }

	triggered_desc = { trigger = { exists = owner owner = { is_hive_empire = yes } }	text = job_ehof_cultivation_drone_effect_desc }
	triggered_desc = { trigger = { exists = owner owner = { is_machine_empire = yes } }	text = job_ehof_cultivation_drone_effect_desc }
	triggered_desc = { trigger = { exists = owner owner = { is_regular_empire = yes } }	text = job_ehof_cultivator_effect_desc }

	resources = {
		category = planet_buildings
		cost = { minerals = @b3_minerals }
		upkeep = { energy = @b3_upkeep }
	}

	ai_weight = {
		weight = 0
		modifier = {
			weight = 10
			OR = {
				planet_crime < 15
				has_building = building_hall_judgment
			}
			is_capital = no
			free_amenities > 2
			owner = {
				has_monthly_income = {
					resource = alloys
					value > 100
				}
				has_monthly_income = {
					resource = ehof_sr_sentient_metal
					value < 100
				}
				has_monthly_income = {
					resource = ehof_sr_sentient_metal
					value > 6
				}
			}
		}
		modifier = {
			weight = 200
			planet = {
				is_capital = yes
				NOT = { has_building = building_ehof_sm_forge_2 }
				num_buildings = { type = building_ehof_sm_forge_1 value < 3 }
				has_building_construction = no
			}
		}
		modifier = {
			weight = 400
			OR = {
				AND = {
					owner = {
						OR = {
							has_monthly_income = {
								resource = consumer_goods
								value > 0
							}
							country_uses_consumer_goods = no
						}
					}
					NOR = {
						num_buildings = { type = building_ehof_sm_forge_1 value > 1 }
						has_building = building_ehof_sm_forge_2
					}
					owner = {
						has_ai_personality_behaviour = conqueror
						OR = {
							has_ai_personality_behaviour = opportunist
							has_ai_personality_behaviour = purger
							has_ai_personality_behaviour = propagator
						}
					}
				}
				NOR = {
					has_building = building_ehof_sm_forge_1
					has_building = building_ehof_sm_forge_2
				}
			}
		}
		modifier = {
			factor = 0.5
			free_jobs > 3
		}
		modifier = {
			weight = 500
			has_building = building_ehof_sm_forge_1
			free_building_slots = 0
		}
	}

	ai_resource_production = {
		ehof_sr_sentient_metal = 1
		trigger = { always = yes }
	}
}

building_ehof_sm_forge_2 = {
	base_buildtime = @b4_time
	can_build = no
	category = manufacturing
	prerequisites = { tech_ehof_sentient_tier_5 }

	allow = {
		has_upgraded_capital = yes
		buildings_upgrade_allow = yes
	}

	destroy_trigger = {
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			AND = {
				exists = owner
				buildings_no_motes = yes
			}
		}
	}

	triggered_planet_modifier = { potential = { exists = owner owner = { is_hive_empire = yes } }		modifier = { job_ehof_cultivation_drone_add = @b2_jobs } }
	triggered_planet_modifier = { potential = { exists = owner owner = { is_machine_empire = yes } }	modifier = { job_ehof_cultivation_drone_add = @b2_jobs } }
	triggered_planet_modifier = { potential = { exists = owner owner = { is_regular_empire = yes } }	modifier = { job_ehof_cultivator_add = @b2_jobs } }

	triggered_desc = { trigger = { exists = owner owner = { is_hive_empire = yes } }	text = job_ehof_cultivation_drone_effect_desc }
	triggered_desc = { trigger = { exists = owner owner = { is_machine_empire = yes } }	text = job_ehof_cultivation_drone_effect_desc }
	triggered_desc = { trigger = { exists = owner owner = { is_regular_empire = yes } }	text = job_ehof_cultivator_effect_desc }

	resources = {
		category = planet_buildings
		cost = { minerals = @b4_minerals }
		upkeep = { energy = @b4_upkeep }
	}

	ai_weight = {
		weight = 0
		modifier = {
			weight = 10
			buildings_has_motes = yes
		}
		modifier = {
			factor = 2
			exists = owner
			owner = {
				has_monthly_income = {
					resource = ehof_sr_sentient_metal
					value < 200
				}
			}
		}
	}

	ai_resource_production = {
		ehof_sr_sentient_metal = 1
		trigger = { always = yes }
	}

	on_queued = {
		planet.owner = {
			if = {		limit = { has_technology = tech_construction_templates }	set_timed_country_flag = { flag = buildings_new_mote_building days = 270 } }
			else_if = {	limit = { has_technology = tech_assembly_pattern }			set_timed_country_flag = { flag = buildings_new_mote_building days = 390 } }
			else = {																set_timed_country_flag = { flag = buildings_new_mote_building days = 510 } }
		}
	}
}