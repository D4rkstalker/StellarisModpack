# Mod by Terak_Lapis

@buildtime_diplo_1 = 300
@buildtime_diplo_2 = 450
@buildtime_diplo_3 = 700
@buildtime_diplo_4 = 1000

building_envoy_school_1 = {
	can_build = yes
	can_be_disabled = yes
	can_be_ruined = yes
	can_demolish = yes

	base_buildtime = @buildtime_diplo_1

	category = government

	potential = {
		exists = owner
		owner = {
			is_fallen_empire = no
			is_hive_empire = no
			is_machine_empire = no 
			has_technology = tech_envoy_school_1
		}	
		NOT = {
			planet = {
				has_building = building_envoy_school_1
				has_building = building_envoy_school_2
				has_building = building_envoy_school_3
			}
		}
		NOT = { has_modifier = slave_colony }
			
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = 400
			alloys = 300
			influence = 50
		}
		upkeep = {
			consumer_goods = 5
			energy = 5
		}
	}


	planet_modifier = {
		job_envoystudent_add = 2
	}

	allow = {
		has_upgraded_capital = yes
		owner = { 
			has_technology = tech_envoy_school_1
		}		
	}

	upgrades = {
		"building_envoy_school_2"
	}

	prerequisites =   { tech_envoy_school_1 } 

	ai_weight = {
		weight = 2
		modifier = {
			weight  = 50
			free_amenities > 5
			num_pops >= 25
			owner = {
				OR = {
					country_uses_consumer_goods = no
					has_monthly_income = {
						resource = consumer_goods
						value > 6
					}
				}	
			}
		}
		modifier = {
			weight = 10
			free_building_slots = 1
			has_building_construction = no
		}#Repairs
		modifier = {
			weight = 70
			NOT = { has_building = building_envoy_school_1 }
			owner = {
				any_neighbor_country = {
					count >= 2
					is_country_type = default
					is_subject = no
					is_fallen_empire = no
					is_country_type_with_subjects = yes
					prev = {
						relative_power = {
							who = prev
							value < superior
							category = all
						}
					}
				}
			}
		}
	}
}

building_envoy_school_2 = {
	can_build = no
	can_be_ruined = yes
	can_be_disabled = yes
	can_demolish = yes

	base_buildtime = @buildtime_diplo_2

	category = government
	potential = {
		exists = owner
		owner = {
			is_fallen_empire = no
			is_hive_empire = no
			is_machine_empire = no
			has_technology = tech_envoy_school_2
		}	
		NOT = {
			planet = {
				has_building = building_envoy_school_1
				has_building = building_envoy_school_2
				has_building = building_envoy_school_3
			}
		}
			
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = 200
			alloys = 300
			influence = 50
		}
		upkeep = {
			consumer_goods = 5
			energy = 5
		}
	}

	allow = {
		has_upgraded_capital = yes
		owner = { 
			has_technology = tech_envoy_school_2
		}		
	}

	planet_modifier = {
		job_envoystudent_add = 4
	}

	upgrades = {
		"building_envoy_school_3"
	}

	prerequisites =   { tech_envoy_school_2 }

	ai_weight = {
		weight = 2
		modifier = {
			weight  = 50
			free_amenities > 5
			num_pops >= 25
			owner = {
				OR = {
					country_uses_consumer_goods = no
					has_monthly_income = {
						resource = consumer_goods
						value > 6
					}
				}	
			}
		}
		modifier = {
			weight = 10
			free_building_slots = 1
			has_building_construction = no
		}#Repairs
		modifier = {
			weight = 70
			NOT = { has_building = building_envoy_school_1 }
			owner = {
				any_neighbor_country = {
					count >= 2
					is_country_type = default
					is_subject = no
					is_fallen_empire = no
					is_country_type_with_subjects = yes
					prev = {
						relative_power = {
							who = prev
							value < superior
							category = all
						}
					}
				}
			}
		}
	}
	
}

building_envoy_school_3 = {
	can_build = no
	can_be_ruined = yes
	can_be_disabled = yes
	can_demolish = yes

	base_buildtime = @buildtime_diplo_3

	category = government
	potential = {
		exists = owner
		owner = {
			is_fallen_empire = no
			is_hive_empire = no
			is_machine_empire = no
			has_technology = tech_envoy_school_3
		}	
		NOT = {
			planet = {
				has_building = building_envoy_school_1
				has_building = building_envoy_school_2
				has_building = building_envoy_school_3
			}
		}
			
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = 200
			alloys = 300
			influence = 50
		}
		upkeep = {
			consumer_goods = 5
			energy = 5
		}
	}

	allow = {
		has_upgraded_capital = yes
		owner = { 
			has_technology = tech_envoy_school_3
		}		
	}

	planet_modifier = {
		job_envoystudent_add = 8
	}

	country_modifier = {
		envoys_add = 2
		diplo_weight_mult = 0.25
	}# Mod by Terak_Lapis

	prerequisites =   { tech_envoy_school_3 }

	ai_weight = {
		weight = 2
		modifier = {
			weight  = 50
			free_amenities > 5
			num_pops >= 25
			owner = {
				OR = {
					country_uses_consumer_goods = no
					has_monthly_income = {
						resource = consumer_goods
						value > 6
					}
				}	
			}
		}
		modifier = {
			weight = 10
			free_building_slots = 1
			has_building_construction = no
		}#Repairs
		modifier = {
			weight = 70
			NOT = { has_building = building_envoy_school_1 }
			owner = {
				any_neighbor_country = {
					count >= 2
					is_country_type = default
					is_subject = no
					is_fallen_empire = no
					is_country_type_with_subjects = yes
					prev = {
						relative_power = {
							who = prev
							value < superior
							category = all
						}
					}
				}
			}
		}
	}
	
}

building_diplodrugs_synt_1 = {
	can_build = yes
	can_be_ruined = yes
	can_be_disabled = yes
	can_demolish = yes

	base_buildtime = @buildtime_diplo_1
	base_cap_amount = 1

	category = resource

	potential = {
		exists = owner
		owner = {
			has_technology = tech_diplodrugs_synt
			is_fallen_empire = no
		}
		NOT = {
			any_planet = {
				OR = {
					has_building = building_diplodrugs_synt_2
					has_building = building_diplodrugs_synt_3
					has_building = building_diplodrugs_synt_1					
				}
			}
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			rare_crystals = 40
			sr_dark_matter = 4
			alloys = 50
		}
		upkeep = {
			food = 10
			energy = 5
		}
	}

	planet_modifier = {
		job_diplodrugger_add = 4
	}

	allow = {
		has_upgraded_capital = yes
		owner = {
			has_technology = tech_diplodrugs_synt
		}
	}

	upgrades = {
		"building_diplodrugs_synt_2"
	}

	prerequisites = {
		tech_diplodrugs_synt
	}

	ai_weight = {
		weight = 2
		modifier = {
			weight = 10
			free_building_slots = 1
			has_building_construction = no
		}#Repairs
		modifier = {
			weight = 70
			#	NOT = { has_building = building_diplodrugs_synt_1 }
			owner = {
				any_neighbor_country = {
					count >= 2
					is_country_type = default
					is_subject = no
					is_fallen_empire = no
					is_country_type_with_subjects = yes
					prev = {
						relative_power = {
							who = prev
							value < superior
							category = all
						}
					}
				}
			}
		}
		modifier = {
			weight = 100
			owner = {
				OR = {
					#country_uses_diplodrugs = yes
					AND = {
						has_monthly_income = {
						resource = diplodrugs
						value > 5
						}
						has_policy_flag = free_usage
					}
					
				}
			}
		}
	}
}

building_diplodrugs_synt_2 = {
	can_build = no
	can_be_ruined = yes
	can_be_disabled = yes
	can_demolish = yes
	base_cap_amount = 1

	base_buildtime = @buildtime_diplo_2

	category = resource

	potential = {
		exists = owner
		owner = {
			has_technology = tech_diplodrugs_synt
			is_fallen_empire = no
		}
		NOT = {
			any_planet = {
				has_building = building_diplodrugs_synt_3
				has_building = building_diplodrugs_synt_2
			}
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			rare_crystals = 40
			sr_dark_matter = 4
			alloys = 50
		}
		upkeep = {
			food = 10
			energy = 5
		}
	}

	planet_modifier = {
		job_diplodrugger_add = 8
	}

	allow = {
		has_upgraded_capital = yes
		owner = {
			has_technology = tech_diplodrugs_synt
		}
	}

	upgrades = {
		"building_diplodrugs_synt_3"
	}

	prerequisites = {
		tech_diplodrugs_synt_2
	}

	ai_weight = {
		weight = 2
		modifier = {
			weight = 10
			free_building_slots = 1
			has_building_construction = no
		}#Repairs
		modifier = {
			weight = 70
			NOT = { has_building = building_diplodrugs_synt_2 }
			owner = {
				any_neighbor_country = {
					count >= 2
					is_country_type = default
					is_subject = no
					is_fallen_empire = no
					is_country_type_with_subjects = yes
					prev = {
						relative_power = {
							who = prev
							value < superior
							category = all
						}
					}
				}
			}
		}
		modifier = {
			weight = 100
			owner = {
				OR = {
					AND = {
						has_monthly_income = {
						resource = diplodrugs
						value > 5
						}
						has_policy_flag = free_usage
					}
					
				}
			}
		}
	}
}

building_diplodrugs_synt_3 = { # Mod by Terak_Lapis
	can_build = no
	can_be_ruined = yes
	can_be_disabled = yes
	can_demolish = yes
	base_cap_amount = 1

	base_buildtime = @buildtime_diplo_3

	category = resource

	potential = {
		exists = owner
		owner = {
			has_technology = tech_diplodrugs_synt
			is_fallen_empire = no
		}
		NOT = {
			any_planet = {
				OR = {
					has_building = building_diplodrugs_synt_3
					has_building = building_diplodrugs_synt_1
				}
				
			}
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			rare_crystals = 40
			sr_dark_matter = 4
			alloys = 50
		}
		upkeep = {
			food = 10
			energy = 5
		}
	}

	planet_modifier = {
		job_diplodrugger_add = 10
	}

	allow = {
		has_upgraded_capital = yes
		owner = {
			has_technology = tech_diplodrugs_synt
		}
	}

	#upgrades = {
	#	"building_diplodrugs_synth_2"
	#}

	prerequisites = {
		tech_diplodrugs_synt_3
	}

	ai_weight = {
		weight = 2
		modifier = {
			weight = 10
			free_building_slots = 1
			has_building_construction = no
		}#Repairs
		modifier = {
			weight = 70
			NOT = { has_building = building_diplodrugs_synt_3 }
			owner = {
				any_neighbor_country = {
					count >= 2
					is_country_type = default
					is_subject = no
					is_fallen_empire = no
					is_country_type_with_subjects = yes
					prev = {
						relative_power = {
							who = prev
							value < superior
							category = all
						}
					}
				}
			}
		}
		modifier = {
			weight = 100
			owner = {
				OR = {
					AND = {
						has_monthly_income = {
						resource = diplodrugs
						value > 5
						}
						has_policy_flag = free_usage
					}
					
				}
			}
		}
	}
}

building_palace_diplo = {
	can_build = yes
	can_be_ruined = yes
	can_be_disabled = yes
	can_demolish = yes
	base_buildtime = @buildtime_diplo_4
	category = manufacturing
	base_cap_amount = 1
	potential = {
		exists = owner
		owner = {
			has_technology = tech_force_applyed
			is_fallen_empire = no
		}
	}
	resources = {
		category = planet_buildings
		cost = {
			alloys = 200
			minerals = 1000
			energy = 300
			rare_crystals = 40
			diplodrugs = 100
		}
		upkeep = { # Expersive but worth it
			influence = 2
			diplodrugs = 10
		}
	}
	planet_modifier = { job_diplomaster_add = 2 }
	allow = {
		has_upgraded_capital = yes
		owner = {
			has_technology = tech_force_applyed
		}
	}
	prerequisites = { tech_force_applyed }
	ai_weight = { # Custom Weight Tree by Terak_Lapis
		weight = 1000
		modifier = {
			factor = 0.1
			exists = owner
			owner = {
				has_origin = origin_churl
			}
			
		}
		modifier = {
			factor = 0.01
			exists = owner
			OR = {
				owner = {
					is_fallen_empire = yes
				is_subject = yes
				}
			}
		}
	}
	
	
}

building_peke_shield = {
	can_build = yes
	can_be_ruined = yes
	can_be_disabled = yes
	can_demolish = yes
	base_buildtime = @buildtime_diplo_4
	category = army
	base_cap_amount = 1
	add_to_first_building_slot = yes
	planetary_ftl_inhibitor = yes
	allow = {
		has_upgraded_capital = yes
		owner = { is_ai = no } # As in Vanilla - seems AI isn´t supposed to use planetary shielding at all????!
	}
	destroy_trigger = {
		exists = owner
		owner = { is_ai = yes } # As in Vanilla - seems AI isn´t supposed to use planetary shielding at all????!
	}
	prerequisites = {
		"tech_peke_shield_planetary"
	}
	resources = {
		category = planet_buildings
		cost = {
			alloys = 750
			diplodrugs = 100
			diploforce = 30
		}
		upkeep = {
			energy = 2
			alloys = 0.02
			diploforce = 0.01
		}
	}
	planet_modifier = {
		planet_orbital_bombardment_damage = -0.95
	}
	ai_weight = {
		weight = 0 # As in Vanilla - seems AI isn´t supposed to use planetary shielding at all????!
	}
}

building_peke_garnison = {
	can_build = yes
	can_be_ruined = yes
	category = army
	base_buildtime = @buildtime_diplo_4
	base_cap_amount = 1
	allow = {
		has_upgraded_capital = yes
		owner = { is_ai = no } 
		owner = {
			OR = {
				has_origin = origin_peke_guard_player
				has_ascension_perk = ap_guardian_techt
				federation = {
					has_federation_type = peke_federation # Mod by Terak_Lapis
				}
			}
		}
	}
	destroy_trigger = {
		exists = owner
		owner = { is_ai = yes }
	}
	prerequisites = {
		"tech_peke_garnison" # TODO
	}
	resources = {
		category = planet_buildings
		cost = {
			alloys = 500
			rare_crystals = 10
			volatile_motes = 10
			diploforce = 50
		}
		upkeep = {
			food = 2
			energy = 2
		}
	}
	planet_modifier = {
		job_enforcer_add = 2
		pop_defense_armies_add = 3
		planet_crime_add = -20
		planet_housing_add = 4
	}
}