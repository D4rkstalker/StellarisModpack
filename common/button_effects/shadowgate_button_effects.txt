# feast your eyes

banish_shadowrift = {
	potential = {
		from = {
			has_country_flag = shadowgate_accessed
			NOR = {
				has_country_flag = shadowgate_force_destabilization
				switch = {
					trigger = has_country_flag
					shadowgate_a_accessed = { event_target:shadowgate_planet_a = { OR = { has_modifier = pm_shadowgate_banishing has_planet_flag = shadowrift_queued has_planet_flag = shadowgate_dup_on } } }
					shadowgate_b_accessed = { event_target:shadowgate_planet_b = { OR = { has_modifier = pm_shadowgate_banishing has_planet_flag = shadowrift_queued has_planet_flag = shadowgate_dup_on } } }
					shadowgate_c_accessed = { event_target:shadowgate_planet_c = { OR = { has_modifier = pm_shadowgate_banishing has_planet_flag = shadowrift_queued has_planet_flag = shadowgate_dup_on } } }
					shadowgate_d_accessed = { event_target:shadowgate_planet_d = { OR = { has_modifier = pm_shadowgate_banishing has_planet_flag = shadowrift_queued has_planet_flag = shadowgate_dup_on } } }
					shadowgate_e_accessed = { event_target:shadowgate_planet_e = { OR = { has_modifier = pm_shadowgate_banishing has_planet_flag = shadowrift_queued has_planet_flag = shadowgate_dup_on } } }
				}
			}
		}
	}
	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
			if = { limit = { event_target:shadowgate_planet_a = { NOR = { has_planet_flag = shadowrift_active shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.banish.shadowrift.button.none always = no }
			}
			else_if = { limit = { event_target:shadowgate_planet_a = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_a = { OR = { controller = { has_country_flag = shadowgate_a_accessed } has_planet_flag = shadowgate_ashen_pilgrimage } } }
				custom_tooltip = { fail_text = shadowgate.fail.ap.last.summoner event_target:shadowgate_planet_a = { if = { limit = { has_planet_flag = shadowgate_ashen_pilgrimage exists = event_target:shadowgate_ap_last_summoner } from = { is_same_value = event_target:shadowgate_ap_last_summoner } } } }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
			if = { limit = { event_target:shadowgate_planet_b = { NOR = { has_planet_flag = shadowrift_active shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.banish.shadowrift.button.none always = no }
			}
			else_if = { limit = { event_target:shadowgate_planet_b = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_b = { OR = { controller = { has_country_flag = shadowgate_b_accessed } has_planet_flag = shadowgate_ashen_pilgrimage } } }
				custom_tooltip = { fail_text = shadowgate.fail.ap.last.summoner event_target:shadowgate_planet_b = { if = { limit = { has_planet_flag = shadowgate_ashen_pilgrimage exists = event_target:shadowgate_ap_last_summoner } from = { is_same_value = event_target:shadowgate_ap_last_summoner } } } }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
			if = { limit = { event_target:shadowgate_planet_c = { NOR = { has_planet_flag = shadowrift_active shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.banish.shadowrift.button.none always = no }
			}
			else_if = { limit = { event_target:shadowgate_planet_c = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_c = { OR = { controller = { has_country_flag = shadowgate_c_accessed } has_planet_flag = shadowgate_ashen_pilgrimage } } }
				custom_tooltip = { fail_text = shadowgate.fail.ap.last.summoner event_target:shadowgate_planet_c = { if = { limit = { has_planet_flag = shadowgate_ashen_pilgrimage exists = event_target:shadowgate_ap_last_summoner } from = { is_same_value = event_target:shadowgate_ap_last_summoner } } } }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
			if = { limit = { event_target:shadowgate_planet_d = { NOR = { has_planet_flag = shadowrift_active shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.banish.shadowrift.button.none always = no }
			}
			else_if = { limit = { event_target:shadowgate_planet_d = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_d = { OR = { controller = { has_country_flag = shadowgate_d_accessed } has_planet_flag = shadowgate_ashen_pilgrimage } } }
				custom_tooltip = { fail_text = shadowgate.fail.ap.last.summoner event_target:shadowgate_planet_d = { if = { limit = { has_planet_flag = shadowgate_ashen_pilgrimage exists = event_target:shadowgate_ap_last_summoner } from = { is_same_value = event_target:shadowgate_ap_last_summoner } } } }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
			if = { limit = { event_target:shadowgate_planet_e = { NOR = { has_planet_flag = shadowrift_active shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.banish.shadowrift.button.none always = no }
			}
			else_if = { limit = { event_target:shadowgate_planet_e = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_e = { OR = { controller = { has_country_flag = shadowgate_e_accessed } has_planet_flag = shadowgate_ashen_pilgrimage } } }
				custom_tooltip = { fail_text = shadowgate.fail.ap.last.summoner event_target:shadowgate_planet_e = { if = { limit = { has_planet_flag = shadowgate_ashen_pilgrimage exists = event_target:shadowgate_ap_last_summoner } from = { is_same_value = event_target:shadowgate_ap_last_summoner } } } }
			}
		}
	}
	
	effect = {
		from = {
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_a_accessed = { event_target:shadowgate_planet_a = { save_event_target_as = shadowgate_planet } }
					shadowgate_b_accessed = { event_target:shadowgate_planet_b = { save_event_target_as = shadowgate_planet } }
					shadowgate_c_accessed = { event_target:shadowgate_planet_c = { save_event_target_as = shadowgate_planet } }
					shadowgate_d_accessed = { event_target:shadowgate_planet_d = { save_event_target_as = shadowgate_planet } }
					shadowgate_e_accessed = { event_target:shadowgate_planet_e = { save_event_target_as = shadowgate_planet } }
				}
			}
			switch = {
				trigger = has_country_flag
				shadowgate_a_accessed = { custom_tooltip = shadowgate.banish.shadowrift.button.destination.a hidden_effect = { event_target:shadowrift_current_origin_a = { save_event_target_as = shadowgate_origin_system } event_target:shadowrift_current_terminus_a = { save_event_target_as = shadowgate_destination_system } } }
				shadowgate_b_accessed = { custom_tooltip = shadowgate.banish.shadowrift.button.destination.b hidden_effect = { event_target:shadowrift_current_origin_b = { save_event_target_as = shadowgate_origin_system } event_target:shadowrift_current_terminus_b = { save_event_target_as = shadowgate_destination_system } } }
				shadowgate_c_accessed = { custom_tooltip = shadowgate.banish.shadowrift.button.destination.c hidden_effect = { event_target:shadowrift_current_origin_c = { save_event_target_as = shadowgate_origin_system } event_target:shadowrift_current_terminus_c = { save_event_target_as = shadowgate_destination_system } } }
				shadowgate_d_accessed = { custom_tooltip = shadowgate.banish.shadowrift.button.destination.d hidden_effect = { event_target:shadowrift_current_origin_d = { save_event_target_as = shadowgate_origin_system } event_target:shadowrift_current_terminus_d = { save_event_target_as = shadowgate_destination_system } } }
				shadowgate_e_accessed = { custom_tooltip = shadowgate.banish.shadowrift.button.destination.e hidden_effect = { event_target:shadowrift_current_origin_e = { save_event_target_as = shadowgate_origin_system } event_target:shadowrift_current_terminus_e = { save_event_target_as = shadowgate_destination_system } } }
			}
			if = { limit = { event_target:shadowgate_planet = { num_districts = { type = district_shadow_pulse_condenser value = 3 } } } custom_tooltip = shadowgate.banish.shadowrift.button.time.3 }
			else_if = { limit = { event_target:shadowgate_planet = { num_districts = { type = district_shadow_pulse_condenser value = 2 } } } custom_tooltip = shadowgate.banish.shadowrift.button.time.2 }
			else_if = { limit = { event_target:shadowgate_planet = { num_districts = { type = district_shadow_pulse_condenser value = 1 } } } custom_tooltip = shadowgate.banish.shadowrift.button.time.1 }
			else = { custom_tooltip = shadowgate.banish.shadowrift.button.time.0 }
			hidden_effect = {
				event_target:shadowgate_planet = {
					switch = {
						trigger = has_planet_flag
						shadowgate_a = { banish_active_shadowrift = { SHADOWGATE = a } }
						shadowgate_b = { banish_active_shadowrift = { SHADOWGATE = b } }
						shadowgate_c = { banish_active_shadowrift = { SHADOWGATE = c } }
						shadowgate_d = { banish_active_shadowrift = { SHADOWGATE = d } }
						shadowgate_e = { banish_active_shadowrift = { SHADOWGATE = e } }
						
					}
				}
			}
		}
	}
}

pre_destabilize_shadowrift = {
	potential = {
		from = {
			has_country_flag = shadowgate_accessed
			NOT = { has_country_flag = shadowgate_force_destabilization }
			switch = {
				trigger = has_country_flag
				shadowgate_a_accessed = { event_target:shadowgate_planet_a = { NOT = { has_planet_flag = shadowgate_dup_on } OR = { has_planet_flag = shadowrift_queued has_modifier = pm_shadowgate_banishing } } }
				shadowgate_b_accessed = { event_target:shadowgate_planet_b = { NOT = { has_planet_flag = shadowgate_dup_on } OR = { has_planet_flag = shadowrift_queued has_modifier = pm_shadowgate_banishing } } }
				shadowgate_c_accessed = { event_target:shadowgate_planet_c = { NOT = { has_planet_flag = shadowgate_dup_on } OR = { has_planet_flag = shadowrift_queued has_modifier = pm_shadowgate_banishing } } }
				shadowgate_d_accessed = { event_target:shadowgate_planet_d = { NOT = { has_planet_flag = shadowgate_dup_on } OR = { has_planet_flag = shadowrift_queued has_modifier = pm_shadowgate_banishing } } }
				shadowgate_e_accessed = { event_target:shadowgate_planet_e = { NOT = { has_planet_flag = shadowgate_dup_on } OR = { has_planet_flag = shadowrift_queued has_modifier = pm_shadowgate_banishing } } }
			}
		}
	}
	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_ap_accessed } }
			custom_tooltip = { fail_text = shadowgate.fail.ap.banishing always = no }
		}
		else = {
			if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
				if = { limit = { event_target:shadowgate_planet_a = { shadowgate_is_disabled = yes } }
					custom_tooltip = { fail_text = shadowgate.error.all always = no }
				}
				else = {
					custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_a = { controller = { has_country_flag = shadowgate_a_accessed } } }
				}
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
				if = { limit = { event_target:shadowgate_planet_b = { shadowgate_is_disabled = yes } }
					custom_tooltip = { fail_text = shadowgate.error.all always = no }
				}
				else = {
					custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_b = { controller = { has_country_flag = shadowgate_b_accessed } } }
				}
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
				if = { limit = { event_target:shadowgate_planet_c = { shadowgate_is_disabled = yes } }
					custom_tooltip = { fail_text = shadowgate.error.all always = no }
				}
				else = {
					custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_c = { controller = { has_country_flag = shadowgate_c_accessed } } }
				}
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
				if = { limit = { event_target:shadowgate_planet_d = { shadowgate_is_disabled = yes } }
					custom_tooltip = { fail_text = shadowgate.error.all always = no }
				}
				else = {
					custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_d = { controller = { has_country_flag = shadowgate_d_accessed } } }
				}
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
				if = { limit = { event_target:shadowgate_planet_e = { shadowgate_is_disabled = yes } }
					custom_tooltip = { fail_text = shadowgate.error.all always = no }
				}
				else = {
					custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_e = { controller = { has_country_flag = shadowgate_e_accessed } } }
				}
			}
		}
	}
	
	effect = {
		from = {
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_a_accessed = { event_target:shadowgate_planet_a = { save_event_target_as = shadowgate_planet } }
					shadowgate_b_accessed = { event_target:shadowgate_planet_b = { save_event_target_as = shadowgate_planet } }
					shadowgate_c_accessed = { event_target:shadowgate_planet_c = { save_event_target_as = shadowgate_planet } }
					shadowgate_d_accessed = { event_target:shadowgate_planet_d = { save_event_target_as = shadowgate_planet } }
					shadowgate_e_accessed = { event_target:shadowgate_planet_e = { save_event_target_as = shadowgate_planet } }
				}
			}
			if = { limit = { event_target:shadowgate_planet = { has_planet_flag = shadowrift_queued } }
				switch = {
					trigger = has_country_flag
					shadowgate_a_accessed = { custom_tooltip = shadowgate.remove.queued.shadowrift.button.destination.a }
					shadowgate_b_accessed = { custom_tooltip = shadowgate.remove.queued.shadowrift.button.destination.b }
					shadowgate_c_accessed = { custom_tooltip = shadowgate.remove.queued.shadowrift.button.destination.c }
					shadowgate_d_accessed = { custom_tooltip = shadowgate.remove.queued.shadowrift.button.destination.d }
					shadowgate_e_accessed = { custom_tooltip = shadowgate.remove.queued.shadowrift.button.destination.e }
				}
				hidden_effect = {
					event_target:shadowgate_planet = {
						change_variable = { which = ShadowgateEther value = ShadowgateEtherCostLocked }
						remove_planet_flag = shadowrift_queued
					}
				}
			}
			else = {
				switch = {
					trigger = has_country_flag
					shadowgate_a_accessed = { custom_tooltip = shadowgate.prime.destabilization.shadowrift.button.destination.a hidden_effect = { event_target:shadowgate_planet_a = { remove_planet_flag = shadowgate_rp_notified send_shadowgate_ruinous_potency_message = yes } } }
					shadowgate_b_accessed = { custom_tooltip = shadowgate.prime.destabilization.shadowrift.button.destination.b hidden_effect = { event_target:shadowgate_planet_b = { remove_planet_flag = shadowgate_rp_notified send_shadowgate_ruinous_potency_message = yes } } }
					shadowgate_c_accessed = { custom_tooltip = shadowgate.prime.destabilization.shadowrift.button.destination.c hidden_effect = { event_target:shadowgate_planet_c = { remove_planet_flag = shadowgate_rp_notified send_shadowgate_ruinous_potency_message = yes } } }
					shadowgate_d_accessed = { custom_tooltip = shadowgate.prime.destabilization.shadowrift.button.destination.d hidden_effect = { event_target:shadowgate_planet_d = { remove_planet_flag = shadowgate_rp_notified send_shadowgate_ruinous_potency_message = yes } } }
					shadowgate_e_accessed = { custom_tooltip = shadowgate.prime.destabilization.shadowrift.button.destination.e hidden_effect = { event_target:shadowgate_planet_e = { remove_planet_flag = shadowgate_rp_notified send_shadowgate_ruinous_potency_message = yes } } }
				}
				hidden_effect = { set_timed_country_flag = { flag = shadowgate_force_destabilization days = 3 } }
			}
		}
	}
}

destabilize_shadowrift = {
	potential = {
		from = {
			has_country_flag = shadowgate_accessed
			OR = {
				has_country_flag = shadowgate_force_destabilization
				switch = {
					trigger = has_country_flag
					shadowgate_a_accessed = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_dup_on } }
					shadowgate_b_accessed = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_dup_on } }
					shadowgate_c_accessed = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_dup_on } }
					shadowgate_d_accessed = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_dup_on } }
					shadowgate_e_accessed = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_dup_on } }
				}
			}
		}
	}
	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
			if = { limit = { event_target:shadowgate_planet_a = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_a = { if = { limit = { NOT = { shadowgate_is_disabled = yes } } controller = { has_country_flag = shadowgate_a_accessed } } } }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
			if = { limit = { event_target:shadowgate_planet_b = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_b = { if = { limit = { NOT = { shadowgate_is_disabled = yes } } controller = { has_country_flag = shadowgate_b_accessed } } } }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
			if = { limit = { event_target:shadowgate_planet_c = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_c = { if = { limit = { NOT = { shadowgate_is_disabled = yes } } controller = { has_country_flag = shadowgate_c_accessed } } } }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
			if = { limit = { event_target:shadowgate_planet_c = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_c = { if = { limit = { NOT = { shadowgate_is_disabled = yes } } controller = { has_country_flag = shadowgate_c_accessed } } } }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
			if = { limit = { event_target:shadowgate_planet_e = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_e = { if = { limit = { NOT = { shadowgate_is_disabled = yes } } controller = { has_country_flag = shadowgate_e_accessed } } } }
			}
		}
	}
	
	effect = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_a_accessed = { custom_tooltip = shadowgate.destabilize.shadowrift.button.destination.a }
				shadowgate_b_accessed = { custom_tooltip = shadowgate.destabilize.shadowrift.button.destination.b }
				shadowgate_c_accessed = { custom_tooltip = shadowgate.destabilize.shadowrift.button.destination.c }
				shadowgate_d_accessed = { custom_tooltip = shadowgate.destabilize.shadowrift.button.destination.d }
				shadowgate_e_accessed = { custom_tooltip = shadowgate.destabilize.shadowrift.button.destination.e }
			}
			hidden_effect = {
				event_target:global_event_country = { country_event = { id = shadowgate_galactic.215 } }
				switch = {
					trigger = has_country_flag
					shadowgate_a_accessed = { event_target:shadowrift_current_terminus_a = { save_event_target_as = shadowrift_vd_rift_system } event_target:shadowgate_planet_a = { planet_event = { id = shadowgate_galactic.230 } } }
					shadowgate_b_accessed = { event_target:shadowrift_current_terminus_b = { save_event_target_as = shadowrift_vd_rift_system } event_target:shadowgate_planet_b = { planet_event = { id = shadowgate_galactic.230 } } }
					shadowgate_c_accessed = { event_target:shadowrift_current_terminus_c = { save_event_target_as = shadowrift_vd_rift_system } event_target:shadowgate_planet_c = { planet_event = { id = shadowgate_galactic.230 } } }
					shadowgate_d_accessed = { event_target:shadowrift_current_terminus_d = { save_event_target_as = shadowrift_vd_rift_system } event_target:shadowgate_planet_d = { planet_event = { id = shadowgate_galactic.230 } } }
					shadowgate_e_accessed = { event_target:shadowrift_current_terminus_e = { save_event_target_as = shadowrift_vd_rift_system } event_target:shadowgate_planet_e = { planet_event = { id = shadowgate_galactic.230 } } }
				}
				remove_country_flag = shadowgate_force_destabilization
			}
		}
	}
}

shadowgate_eth_gauge = {
	potential = {
		from = {
			has_country_flag = shadowgate_accessed
			NOT = { has_country_flag = shadowgate_ap_accessed }
		}
	}
	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
			if = { limit = { event_target:shadowgate_planet_a = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.ether.error.a always = no }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
			if = { limit = { event_target:shadowgate_planet_b = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.ether.error.b always = no }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
			if = { limit = { event_target:shadowgate_planet_c = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.ether.error.c always = no }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
			if = { limit = { event_target:shadowgate_planet_d = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.ether.error.d always = no }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
			if = { limit = { event_target:shadowgate_planet_e = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.ether.error.e always = no }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
	}

	effect = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_a_accessed = { custom_tooltip = shadowgate.ether.a }
				shadowgate_b_accessed = { custom_tooltip = shadowgate.ether.b }
				shadowgate_c_accessed = { custom_tooltip = shadowgate.ether.c }
				shadowgate_d_accessed = { custom_tooltip = shadowgate.ether.d }
				shadowgate_e_accessed = { custom_tooltip = shadowgate.ether.e }
			}
			custom_tooltip = shadowgate.ether
		}
	}
}

shadowgate_rp_gauge = {
	potential = {
		from = { has_country_flag = shadowgate_accessed }
	}
	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
			if = { limit = { event_target:shadowgate_planet_a = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.ruinous.potency.error.a always = no }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
			if = { limit = { event_target:shadowgate_planet_b = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.ruinous.potency.error.b always = no }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
			if = { limit = { event_target:shadowgate_planet_c = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.ruinous.potency.error.c always = no }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
			if = { limit = { event_target:shadowgate_planet_d = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.ruinous.potency.error.d always = no }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
			if = { limit = { event_target:shadowgate_planet_e = { shadowgate_is_disabled = yes } }
				custom_tooltip = { fail_text = shadowgate.ruinous.potency.error.e always = no }
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
	}

	effect = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_a_accessed = { custom_tooltip = shadowgate.ruinous.potency.a hidden_effect = { event_target:shadowgate_planet_a = { if = { limit = { NOT = { has_planet_flag = shadowgate_rp_notifications } } set_planet_flag = shadowgate_rp_notifications remove_planet_flag = shadowgate_rp_notified send_shadowgate_ruinous_potency_message = yes } else = { remove_planet_flag = shadowgate_rp_notifications } } } }
				shadowgate_b_accessed = { custom_tooltip = shadowgate.ruinous.potency.b hidden_effect = { event_target:shadowgate_planet_b = { if = { limit = { NOT = { has_planet_flag = shadowgate_rp_notifications } } set_planet_flag = shadowgate_rp_notifications remove_planet_flag = shadowgate_rp_notified send_shadowgate_ruinous_potency_message = yes } else = { remove_planet_flag = shadowgate_rp_notifications } } } }
				shadowgate_c_accessed = { custom_tooltip = shadowgate.ruinous.potency.c hidden_effect = { event_target:shadowgate_planet_c = { if = { limit = { NOT = { has_planet_flag = shadowgate_rp_notifications } } set_planet_flag = shadowgate_rp_notifications remove_planet_flag = shadowgate_rp_notified send_shadowgate_ruinous_potency_message = yes } else = { remove_planet_flag = shadowgate_rp_notifications } } } }
				shadowgate_d_accessed = { custom_tooltip = shadowgate.ruinous.potency.d hidden_effect = { event_target:shadowgate_planet_d = { if = { limit = { NOT = { has_planet_flag = shadowgate_rp_notifications } } set_planet_flag = shadowgate_rp_notifications remove_planet_flag = shadowgate_rp_notified send_shadowgate_ruinous_potency_message = yes } else = { remove_planet_flag = shadowgate_rp_notifications } } } }
				shadowgate_e_accessed = { custom_tooltip = shadowgate.ruinous.potency.e hidden_effect = { event_target:shadowgate_planet_e = { if = { limit = { NOT = { has_planet_flag = shadowgate_rp_notifications } } set_planet_flag = shadowgate_rp_notifications remove_planet_flag = shadowgate_rp_notified send_shadowgate_ruinous_potency_message = yes } else = { remove_planet_flag = shadowgate_rp_notifications } } } }
			}
			custom_tooltip = shadowgate.ruinous.potency
		}
	}
}

fortify_shadowrift_core = {
	potential = {
		from = {
			has_country_flag = shadowgate_accessed
			NOT = { has_country_flag = shadowgate_ap_accessed }
		}
	}
	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
			if = { limit = { event_target:shadowgate_planet_a = { NOT = { shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_a = { controller = { has_country_flag = shadowgate_a_accessed } } }
				custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_a = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
			if = { limit = { event_target:shadowgate_planet_b = { NOT = { shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_b = { controller = { has_country_flag = shadowgate_b_accessed } } }
				custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_b = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
			if = { limit = { event_target:shadowgate_planet_c = { NOT = { shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_c = { controller = { has_country_flag = shadowgate_c_accessed } } }
				custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_c = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
			if = { limit = { event_target:shadowgate_planet_d = { NOT = { shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_d = { controller = { has_country_flag = shadowgate_d_accessed } } }
				custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_d = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
			if = { limit = { event_target:shadowgate_planet_e = { NOT = { shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_e = { controller = { has_country_flag = shadowgate_e_accessed } } }
				custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_e = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
	}

	effect = {
		from = {
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_a_accessed = { event_target:shadowgate_planet_a = { save_event_target_as = shadowgate_planet_core_f } }
					shadowgate_b_accessed = { event_target:shadowgate_planet_b = { save_event_target_as = shadowgate_planet_core_f } }
					shadowgate_c_accessed = { event_target:shadowgate_planet_c = { save_event_target_as = shadowgate_planet_core_f } }
					shadowgate_d_accessed = { event_target:shadowgate_planet_d = { save_event_target_as = shadowgate_planet_core_f } }
					shadowgate_e_accessed = { event_target:shadowgate_planet_e = { save_event_target_as = shadowgate_planet_core_f } }
				}
			}
			event_target:shadowgate_planet_core_f = {
				if = { limit = { has_planet_flag = shadowgate_a } custom_tooltip = shadowgate.fortify.shadowrift.core.button.a }
				else_if = { limit = { has_planet_flag = shadowgate_b } custom_tooltip = shadowgate.fortify.shadowrift.core.button.b }
				else_if = { limit = { has_planet_flag = shadowgate_c } custom_tooltip = shadowgate.fortify.shadowrift.core.button.c }
				else_if = { limit = { has_planet_flag = shadowgate_d } custom_tooltip = shadowgate.fortify.shadowrift.core.button.d }
				else_if = { limit = { has_planet_flag = shadowgate_e } custom_tooltip = shadowgate.fortify.shadowrift.core.button.e }
				hidden_effect = {
					prev = {
						export_resource_stockpile_to_variable = { resource = sr_dark_matter variable = TerminusFortifyReserve }
						if = { limit = { check_variable_arithmetic = { which = TerminusFortifyReserve by = { scope = prev variable = TerminusCoreBoostCost } mode = subtract value >= 0 } }
							set_variable = { which = TerminusCoreBoostCost value = prev }
							add_resource = { sr_dark_matter = -1 mult = TerminusCoreBoostCost }
							clear_variable = TerminusCoreBoostCost
							prev = { apply_shadowrift_core_fortification = yes }
						}
						else = { prev = { set_timed_planet_flag = { flag = shadowgate_fortify_core_failed days = 1 } } }
						clear_variable = TerminusFortifyReserve
					}
				}
				custom_tooltip = shadowgate.fortify.shadowrift.core.button.effect
				if = { limit = { has_planet_flag = shadowgate_a }
					custom_tooltip = shadowgate.fortify.shadowrift.core.button.amount.a
					if = { limit = { check_variable = { which = TerminusCoreFortifyCount value > 0 } } custom_tooltip = shadowgate.fortify.shadowrift.core.button.instances.a }
				}
				else_if = { limit = { has_planet_flag = shadowgate_b }
					custom_tooltip = shadowgate.fortify.shadowrift.core.button.amount.b
					if = { limit = { check_variable = { which = TerminusCoreFortifyCount value > 0 } } custom_tooltip = shadowgate.fortify.shadowrift.core.button.instances.b }
				}
				else_if = { limit = { has_planet_flag = shadowgate_c }
					custom_tooltip = shadowgate.fortify.shadowrift.core.button.amount.c
					if = { limit = { check_variable = { which = TerminusCoreFortifyCount value > 0 } } custom_tooltip = shadowgate.fortify.shadowrift.core.button.instances.c }
				}
				else_if = { limit = { has_planet_flag = shadowgate_d }
					custom_tooltip = shadowgate.fortify.shadowrift.core.button.amount.d
					if = { limit = { check_variable = { which = TerminusCoreFortifyCount value > 0 } } custom_tooltip = shadowgate.fortify.shadowrift.core.button.instances.d }
				}
				else_if = { limit = { has_planet_flag = shadowgate_e }
					custom_tooltip = shadowgate.fortify.shadowrift.core.button.amount.e
					if = { limit = { check_variable = { which = TerminusCoreFortifyCount value > 0 } } custom_tooltip = shadowgate.fortify.shadowrift.core.button.instances.e }
				}
				if = { limit = { has_planet_flag = shadowgate_fortify_core_failed } custom_tooltip = shadowgate.fortify.shadowrift.core.insufficient }
			}
		}
	}
}

fortify_shadowrift_barrier = {
	potential = {
		from = {
			has_country_flag = shadowgate_accessed
			NOT = { has_country_flag = shadowgate_ap_accessed }
		}
	}
	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
			if = { limit = { event_target:shadowgate_planet_a = { NOT = { shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_a = { controller = { has_country_flag = shadowgate_a_accessed } } }
				custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_a = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
			if = { limit = { event_target:shadowgate_planet_b = { NOT = { shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_b = { controller = { has_country_flag = shadowgate_b_accessed } } }
				custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_b = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
			if = { limit = { event_target:shadowgate_planet_c = { NOT = { shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_c = { controller = { has_country_flag = shadowgate_c_accessed } } }
				custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_c = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
			if = { limit = { event_target:shadowgate_planet_d = { NOT = { shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_d = { controller = { has_country_flag = shadowgate_d_accessed } } }
				custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_d = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
			if = { limit = { event_target:shadowgate_planet_e = { NOT = { shadowgate_is_disabled = yes } } }
				custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_e = { controller = { has_country_flag = shadowgate_e_accessed } } }
				custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_e = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
			}
			else = {
				custom_tooltip = { fail_text = shadowgate.error.all always = no }
			}
		}
	}

	effect = {
		from = {
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_a_accessed = { event_target:shadowgate_planet_a = { save_event_target_as = shadowgate_planet_barrier_f } }
					shadowgate_b_accessed = { event_target:shadowgate_planet_b = { save_event_target_as = shadowgate_planet_barrier_f } }
					shadowgate_c_accessed = { event_target:shadowgate_planet_c = { save_event_target_as = shadowgate_planet_barrier_f } }
					shadowgate_d_accessed = { event_target:shadowgate_planet_d = { save_event_target_as = shadowgate_planet_barrier_f } }
					shadowgate_e_accessed = { event_target:shadowgate_planet_e = { save_event_target_as = shadowgate_planet_barrier_f } }
				}
			}
			event_target:shadowgate_planet_barrier_f = {
				if = { limit = { has_planet_flag = shadowgate_a } custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.a }
				else_if = { limit = { has_planet_flag = shadowgate_b } custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.b }
				else_if = { limit = { has_planet_flag = shadowgate_c } custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.c }
				else_if = { limit = { has_planet_flag = shadowgate_d } custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.d }
				else_if = { limit = { has_planet_flag = shadowgate_e } custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.e }
				hidden_effect = {
					prev = {
						export_resource_stockpile_to_variable = { resource = sr_zro variable = TerminusFortifyReserve }
						if = { limit = { check_variable_arithmetic = { which = TerminusFortifyReserve by = { scope = prev variable = TerminusBarrierBoostCost } mode = subtract value >= 0 } }
							set_variable = { which = TerminusBarrierBoostCost value = prev }
							add_resource = { sr_zro = -1 mult = TerminusBarrierBoostCost }
							clear_variable = TerminusBarrierBoostCost
							prev = { apply_shadowrift_barrier_fortification = yes }
						}
						else = { prev = { set_timed_planet_flag = { flag = shadowgate_fortify_barrier_failed days = 1 } } }
						clear_variable = TerminusFortifyReserve
					}
				}
				custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.effect
				if = { limit = { has_planet_flag = shadowgate_a }
					custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.amount.a
					if = { limit = { check_variable = { which = TerminusBarrierFortifyCount value > 0 } } custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.instances.a }
				}
				else_if = { limit = { has_planet_flag = shadowgate_b }
					custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.amount.b
					if = { limit = { check_variable = { which = TerminusBarrierFortifyCount value > 0 } } custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.instances.b }
				}
				else_if = { limit = { has_planet_flag = shadowgate_c }
					custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.amount.c
					if = { limit = { check_variable = { which = TerminusBarrierFortifyCount value > 0 } } custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.instances.c }
				}
				else_if = { limit = { has_planet_flag = shadowgate_d }
					custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.amount.d
					if = { limit = { check_variable = { which = TerminusBarrierFortifyCount value > 0 } } custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.instances.d }
				}
				else_if = { limit = { has_planet_flag = shadowgate_e }
					custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.amount.e
					if = { limit = { check_variable = { which = TerminusBarrierFortifyCount value > 0 } } custom_tooltip = shadowgate.fortify.shadowrift.barrier.button.instances.e }
				}
				if = { limit = { has_planet_flag = shadowgate_fortify_barrier_failed } custom_tooltip = shadowgate.fortify.shadowrift.barrier.insufficient }
			}
		}
	}
}

# Bazaar Buttons
shadowgate_bazaar_refresh = { # unused, as buttons no longer update whatever the random_lists use to select randomly
	potential = { exists = event_target:shadowgate_ap_country }
	allow = {
		hidden_trigger = { exists = event_target:shadowgate_ap_country }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.refresh.stock from = { has_resource = { type = influence amount >= 50 } } event_target:shadowgate_ap_country = { trust = { who = from value >= 50 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.refresh.stock.fail.button from = { has_resource = { type = influence amount >= 50 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.fail.button.50 event_target:shadowgate_ap_country = { trust = { who = from value >= 50 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate.pilgrimage.bazaar.refresh.stock
			hidden_effect = {
				add_resource = { influence = -50 }
				event_target:shadowgate_ap_country = {
					set_shadowgate_bazaar = { SLOT = Left }
					set_shadowgate_bazaar = { SLOT = Mid }
					set_shadowgate_bazaar = { SLOT = Right }
				}
			}
		}
	}
}

shadowgate_bazaar_left_consumer_goods = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftItem value = 1 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_left from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_cg_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_cg_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_left
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_cg_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_cg_cost }
				add_resource = { consumer_goods = @shadowgate_ap_bazaar_very_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_cg_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_cg_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarLeftStock value = @shadowgate_ap_bazaar_very_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_mid_consumer_goods = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 1 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_mid from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_cg_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_cg_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_mid
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_cg_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_cg_cost }
				add_resource = { consumer_goods = @shadowgate_ap_bazaar_very_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_cg_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_cg_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_very_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_right_consumer_goods = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightItem value = 1 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_right from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_cg_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_cg_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_right
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_cg_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_cg_cost }
				add_resource = { consumer_goods = @shadowgate_ap_bazaar_very_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_cg_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_cg_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarRightStock value = @shadowgate_ap_bazaar_very_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_left_alloys = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftItem value = 2 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_left from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_alloys_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_alloys_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_left
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_alloys_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_alloys_cost }
				add_resource = { alloys = @shadowgate_ap_bazaar_very_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_alloys_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_alloys_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarLeftStock value = @shadowgate_ap_bazaar_very_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_mid_alloys = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 2 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_mid from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_alloys_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_alloys_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_mid
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_alloys_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_alloys_cost }
				add_resource = { alloys = @shadowgate_ap_bazaar_very_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_alloys_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_alloys_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_very_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_right_alloys = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightItem value = 2 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_right from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_alloys_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_alloys_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_right
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_alloys_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_alloys_cost }
				add_resource = { alloys = @shadowgate_ap_bazaar_very_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_alloys_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_alloys_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarRightStock value = @shadowgate_ap_bazaar_very_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_left_exotic_gases = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftItem value = 3 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_left from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_left
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_low_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_low }
				add_resource = { exotic_gases = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_low_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_low_p }
					subtract_variable = { which = ShadowgateAPBazaarLeftStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_mid_exotic_gases = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 3 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_mid from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_mid
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_low_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_low }
				add_resource = { exotic_gases = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_low_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_low_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_right_exotic_gases = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightItem value = 3 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_right from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_right
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_low_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_low }
				add_resource = { exotic_gases = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_low_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_low_p }
					subtract_variable = { which = ShadowgateAPBazaarRightStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_left_rare_crystals = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftItem value = 4 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_left from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_left
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_low_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_low }
				add_resource = { rare_crystals = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_low_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_low_p }
					subtract_variable = { which = ShadowgateAPBazaarLeftStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_mid_rare_crystals = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 4 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_mid from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_mid
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_low_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_low }
				add_resource = { rare_crystals = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_low_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_low_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_right_rare_crystals = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightItem value = 4 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_right from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_right
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_low_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_low }
				add_resource = { rare_crystals = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_low_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_low_p }
					subtract_variable = { which = ShadowgateAPBazaarRightStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_left_volatile_motes = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftItem value = 5 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_left from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_left
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_low_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_low }
				add_resource = { volatile_motes = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_low_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_low_p }
					subtract_variable = { which = ShadowgateAPBazaarLeftStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_mid_volatile_motes = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 5 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_mid from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_mid
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_low_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_low }
				add_resource = { volatile_motes = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_low_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_low_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_right_volatile_motes = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightItem value = 5 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_right from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_low_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_right
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_low_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_low }
				add_resource = { volatile_motes = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_low_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_low_p }
					subtract_variable = { which = ShadowgateAPBazaarRightStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_left_dark_matter = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftItem value = 6 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_left from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_left
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_high_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_high }
				add_resource = { sr_dark_matter = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_high_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_high_p }
					subtract_variable = { which = ShadowgateAPBazaarLeftStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_mid_dark_matter = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 6 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_mid from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_mid
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_high_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_high }
				add_resource = { sr_dark_matter = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_high_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_high_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_right_dark_matter = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightItem value = 6 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_right from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_right
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_high_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_high }
				add_resource = { sr_dark_matter = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_high_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_high_p }
					subtract_variable = { which = ShadowgateAPBazaarRightStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_left_living_metal = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftItem value = 7 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_left from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_left
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_high_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_high }
				add_resource = { sr_living_metal = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_high_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_high_p }
					subtract_variable = { which = ShadowgateAPBazaarLeftStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_mid_living_metal = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 7 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_mid from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_mid
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_high_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_high }
				add_resource = { sr_living_metal = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_high_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_high_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_right_living_metal = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightItem value = 7 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_right from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_right
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_high_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_high }
				add_resource = { sr_living_metal = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_high_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_high_p }
					subtract_variable = { which = ShadowgateAPBazaarRightStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_left_zro = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftItem value = 8 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_left from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_left
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_high_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_high }
				add_resource = { sr_zro = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_high_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_high_p }
					subtract_variable = { which = ShadowgateAPBazaarLeftStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_mid_zro = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 8 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_mid from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_mid
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_high_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_high }
				add_resource = { sr_zro = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_high_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_high_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_right_zro = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightItem value = 8 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_right from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_common_cost_high_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_right
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_common_trust_high_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_common_cost_high }
				add_resource = { sr_zro = @shadowgate_ap_bazaar_common_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_common_cost_high_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_common_cost_high_p }
					subtract_variable = { which = ShadowgateAPBazaarRightStock value = @shadowgate_ap_bazaar_common_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_left_minor_artifacts = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftItem value = 9 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_left from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_minor_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_minor_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_left
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_minor_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_minor_cost }
				add_resource = { sr_zro = @shadowgate_ap_bazaar_minor_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_minor_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_minor_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarLeftStock value = @shadowgate_ap_bazaar_minor_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_mid_minor_artifacts = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 9 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_mid from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_minor_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_minor_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_mid
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_minor_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_minor_cost }
				add_resource = { minor_artifacts = @shadowgate_ap_bazaar_minor_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_minor_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_minor_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_minor_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_right_minor_artifacts = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightItem value = 9 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_right from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_minor_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_minor_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_right
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_minor_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_minor_cost }
				add_resource = { minor_artifacts = @shadowgate_ap_bazaar_minor_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_minor_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_minor_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarRightStock value = @shadowgate_ap_bazaar_minor_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_left_shadowgate_dl = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftItem value = 10 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_left from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_lesser_relic_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_lesser_relic_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarLeftStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_left
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_lesser_relic_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_lesser_relic_cost }
				change_variable = { which = ShadowgateLodestonesOwned value = @shadowgate_ap_bazaar_relic_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_lesser_relic_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_lesser_relic_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarLeftStock value = @shadowgate_ap_bazaar_relic_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_mid_shadowgate_dl = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 10 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_mid from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_lesser_relic_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_lesser_relic_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_mid
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_lesser_relic_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_lesser_relic_cost }
				change_variable = { which = ShadowgateLodestonesOwned value = @shadowgate_ap_bazaar_relic_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_lesser_relic_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_lesser_relic_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_relic_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_right_shadowgate_dl = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightItem value = 10 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_right from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_lesser_relic_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_lesser_relic_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarRightStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_right
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_lesser_relic_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_lesser_relic_cost }
				change_variable = { which = ShadowgateLodestonesOwned value = @shadowgate_ap_bazaar_relic_amount }
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_lesser_relic_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_lesser_relic_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarRightStock value = @shadowgate_ap_bazaar_relic_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_songstone = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 11 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_songstone from = { NOT = { has_relic = r_shadowgate_es } has_resource = { type = energy amount >= @shadowgate_ap_bazaar_lesser_relic_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.fail.relic.owned from = { NOT = { has_relic = r_shadowgate_es } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_lesser_relic_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_songstone
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_lesser_relic_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_lesser_relic_cost }
				add_relic = r_shadowgate_es
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_lesser_relic_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_lesser_relic_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_relic_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_talisman = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 12 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_talisman from = { NOT = { has_relic = r_shadowgate_st } has_resource = { type = energy amount >= @shadowgate_ap_bazaar_lesser_relic_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.fail.relic.owned from = { NOT = { has_relic = r_shadowgate_st } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_lesser_relic_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_talisman
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_lesser_relic_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_lesser_relic_cost }
				add_relic = r_shadowgate_st
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_lesser_relic_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_lesser_relic_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_relic_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_transmitter = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 13 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_transmitter from = { NOT = { has_relic = r_shadowgate_crwt } has_resource = { type = energy amount >= @shadowgate_ap_bazaar_relic_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.fail.relic.owned from = { NOT = { has_relic = r_shadowgate_crwt } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_relic_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_transmitter
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_relic_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_relic_cost }
				set_global_flag = shadowgate_transmitter_acquired
				add_relic = r_shadowgate_crwt
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_relic_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_relic_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_relic_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_converter = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 14 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_converter from = { NOT = { has_relic = r_shadowgate_cpc } has_resource = { type = energy amount >= @shadowgate_ap_bazaar_relic_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.fail.relic.owned from = { NOT = { has_relic = r_shadowgate_cpc } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_relic_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_converter
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_relic_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_relic_cost }
				set_global_flag = shadowgate_converter_acquired
				add_relic = r_shadowgate_cpc
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_relic_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_relic_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_relic_amount }
				}
			}
		}
	}
}

shadowgate_bazaar_edict = {
	potential = { exists = event_target:shadowgate_ap_country event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidItem value = 15 } } }
	allow = {
		custom_tooltip = { fail_text = shadowgate_bazaar_edict from = { NOT = { has_relic = r_shadowgate_ae } has_resource = { type = energy amount >= @shadowgate_ap_bazaar_relic_cost_p } } event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.fail.relic.owned from = { NOT = { has_relic = r_shadowgate_ae } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.cost from = { has_resource = { type = energy amount >= @shadowgate_ap_bazaar_relic_cost_p } } }
		custom_tooltip = { fail_text = shadowgate.pilgrimage.bazaar.fail.stock event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPBazaarMidStock value > 0 } } }
	}
	effect = {
		from = {
			custom_tooltip = shadowgate_bazaar_edict
			hidden_effect = {
				if = { limit = { NOT = { has_country_flag = shadowgate_ap_bazaar_trust } } set_country_flag = shadowgate_ap_bazaar_trust event_target:shadowgate_ap_country = { add_trust = { who = prev amount = @shadowgate_ap_bazaar_purchase_trust } } }
				change_variable = { which = ShadowgateAPTrustBuffer value = @shadowgate_ap_bazaar_relic_trust_buffer }
				add_resource = { energy = @shadowgate_ap_bazaar_relic_cost }
				set_global_flag = shadowgate_edict_acquired
				add_relic = r_shadowgate_ae
				change_variable = { which = ShadowgateAPDonated value = @shadowgate_ap_bazaar_relic_cost_p }
				event_target:shadowgate_ap_country = {
					change_variable = { which = ShadowgateAPProgress value = @shadowgate_ap_bazaar_relic_cost_p }
					subtract_variable = { which = ShadowgateAPBazaarMidStock value = @shadowgate_ap_bazaar_relic_amount }
				}
			}
		}
	}
}

# Ashen Pilgrimage Progress Bars

shadowgate_ap_progress_0 = {
	potential = {
		exists = event_target:shadowgate_ap_country
		event_target:shadowgate_ap_country = {
			OR = {
				check_variable = { which = ShadowgateAPProgress value = 0 }
				check_variable_arithmetic = { which = ShadowgateAPProgress by = ShadowgateAPUpgrade mode = divide value < 0.2 }
			}
		}
	}
	allow = {
		hidden_trigger = { always = no }
		if = { limit = { NOT = { has_global_flag = shadowgate_ap_restored } }
			if = { limit = { event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPProgress value = 0 } } } custom_tooltip = shadowgate.ap.upgrade.progress.zero }
			else = { custom_tooltip = shadowgate.ap.upgrade.progress.amount }
			custom_tooltip = shadowgate.ap.upgrade.progress.desc
		}
		else = {
			if = { limit = { event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPProgress value = 0 } } } custom_tooltip = shadowgate.ap.upgrade.restored.zero }
			else = { custom_tooltip = shadowgate.ap.upgrade.restored.amount }
			custom_tooltip = shadowgate.ap.upgrade.restored.desc
		}
	}
}

shadowgate_ap_progress_20 = {
	potential = {
		exists = event_target:shadowgate_ap_country
		event_target:shadowgate_ap_country = {
			check_variable_arithmetic = { which = ShadowgateAPProgress by = ShadowgateAPUpgrade mode = divide value >= 0.2 }
			check_variable_arithmetic = { which = ShadowgateAPProgress by = ShadowgateAPUpgrade mode = divide value < 0.4 }
		}
	}
	allow = {
		hidden_trigger = { always = no }
		if = { limit = { NOT = { has_global_flag = shadowgate_ap_restored } }
			custom_tooltip = shadowgate.ap.upgrade.progress.amount
			custom_tooltip = shadowgate.ap.upgrade.progress.desc
		}
		else = {
			custom_tooltip = shadowgate.ap.upgrade.restored.amount
			custom_tooltip = shadowgate.ap.upgrade.restored.desc
		}
	}
}

shadowgate_ap_progress_40 = {
	potential = {
		exists = event_target:shadowgate_ap_country
		event_target:shadowgate_ap_country = {
			check_variable_arithmetic = { which = ShadowgateAPProgress by = ShadowgateAPUpgrade mode = divide value >= 0.4 }
			check_variable_arithmetic = { which = ShadowgateAPProgress by = ShadowgateAPUpgrade mode = divide value < 0.6 }
		}
	}
	allow = {
		hidden_trigger = { always = no }
		if = { limit = { NOT = { has_global_flag = shadowgate_ap_restored } }
			custom_tooltip = shadowgate.ap.upgrade.progress.amount
			custom_tooltip = shadowgate.ap.upgrade.progress.desc
		}
		else = {
			custom_tooltip = shadowgate.ap.upgrade.restored.amount
			custom_tooltip = shadowgate.ap.upgrade.restored.desc
		}
	}
}

shadowgate_ap_progress_60 = {
	potential = {
		exists = event_target:shadowgate_ap_country
		event_target:shadowgate_ap_country = {
			check_variable_arithmetic = { which = ShadowgateAPProgress by = ShadowgateAPUpgrade mode = divide value >= 0.6 }
			check_variable_arithmetic = { which = ShadowgateAPProgress by = ShadowgateAPUpgrade mode = divide value < 0.8 }
		}
	}
	allow = {
		hidden_trigger = { always = no }
		if = { limit = { NOT = { has_global_flag = shadowgate_ap_restored } }
			custom_tooltip = shadowgate.ap.upgrade.progress.amount
			custom_tooltip = shadowgate.ap.upgrade.progress.desc
		}
		else = {
			custom_tooltip = shadowgate.ap.upgrade.restored.amount
			custom_tooltip = shadowgate.ap.upgrade.restored.desc
		}
	}
}

shadowgate_ap_progress_80 = {
	potential = {
		exists = event_target:shadowgate_ap_country
		event_target:shadowgate_ap_country = {
			check_variable_arithmetic = { which = ShadowgateAPProgress by = ShadowgateAPUpgrade mode = divide value >= 0.8 }
			check_variable_arithmetic = { which = ShadowgateAPProgress by = ShadowgateAPUpgrade mode = divide value < 1 }
		}
	}
	allow = {
		hidden_trigger = { always = no }
		if = { limit = { NOT = { has_global_flag = shadowgate_ap_restored } }
			custom_tooltip = shadowgate.ap.upgrade.progress.amount
			custom_tooltip = shadowgate.ap.upgrade.progress.desc
		}
		else = {
			custom_tooltip = shadowgate.ap.upgrade.restored.amount
			custom_tooltip = shadowgate.ap.upgrade.restored.desc
		}
	}
}

shadowgate_ap_progress_100 = {
	potential = {
		exists = event_target:shadowgate_ap_country
		event_target:shadowgate_ap_country = { check_variable = { which = ShadowgateAPProgress value >= ShadowgateAPUpgrade } }
	}
	allow = {
		hidden_trigger = { always = no }
		if = { limit = { NOT = { has_global_flag = shadowgate_ap_restored } }
			custom_tooltip = shadowgate.ap.upgrade.progress.amount
			custom_tooltip = shadowgate.ap.upgrade.progress.desc
			if = { limit = { event_target:shadowgate_ap_country = { has_country_flag = shadowgate_ap_restoring_district } } custom_tooltip = shadowgate.ap.upgrade.in.progress }
		}
		else = {
			custom_tooltip = shadowgate.ap.upgrade.restored.amount
			custom_tooltip = shadowgate.ap.upgrade.restored.desc
		}
	}
}

# Dimensional Compass Buttons

open_shadowgate_dimensional_compass = {
	potential = { from = { has_country_flag = shadowgate_accessed NOT = { has_country_flag = shadowgate_ap_accessed } } }

	allow = {
		if = { limit = { from = { NOT = { has_country_flag = shadowgate_d_compass_open } } }
			if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
				if = { limit = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_d_compass_unlocked NOR = { has_planet_flag = shadowgate_d_compass_open has_planet_flag = shadowgate_d_compass_cooldown } } }
					if = { limit = { event_target:shadowgate_planet_a = { NOT = { shadowgate_is_disabled = yes } } }
						custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_a = { controller = { has_country_flag = shadowgate_a_accessed } } }
						custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_a = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
					}
					else = { custom_tooltip = { fail_text = shadowgate.error.all always = no } }
				}
				else = { hidden_trigger = { always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
				if = { limit = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_d_compass_unlocked NOR = { has_planet_flag = shadowgate_d_compass_open has_planet_flag = shadowgate_d_compass_cooldown } } }
					if = { limit = { event_target:shadowgate_planet_b = { NOT = { shadowgate_is_disabled = yes } } }
						custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_b = { controller = { has_country_flag = shadowgate_b_accessed } } }
						custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_b = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
					}
					else = { custom_tooltip = { fail_text = shadowgate.error.all always = no } }
				}
				else = { hidden_trigger = { always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
				if = { limit = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_d_compass_unlocked NOR = { has_planet_flag = shadowgate_d_compass_open has_planet_flag = shadowgate_d_compass_cooldown } } }
					if = { limit = { event_target:shadowgate_planet_c = { NOT = { shadowgate_is_disabled = yes } } }
						custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_c = { controller = { has_country_flag = shadowgate_c_accessed } } }
						custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_c = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
					}
					else = { custom_tooltip = { fail_text = shadowgate.error.all always = no } }
				}
				else = { hidden_trigger = { always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
				if = { limit = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_d_compass_unlocked NOR = { has_planet_flag = shadowgate_d_compass_open has_planet_flag = shadowgate_d_compass_cooldown } } }
					if = { limit = { event_target:shadowgate_planet_d = { NOT = { shadowgate_is_disabled = yes } } }
						custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_d = { controller = { has_country_flag = shadowgate_d_accessed } } }
						custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_d = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
					}
					else = { custom_tooltip = { fail_text = shadowgate.error.all always = no } }
				}
				else = { hidden_trigger = { always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
				if = { limit = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_d_compass_unlocked NOR = { has_planet_flag = shadowgate_d_compass_open has_planet_flag = shadowgate_d_compass_cooldown } } }
					if = { limit = { event_target:shadowgate_planet_e = { NOT = { shadowgate_is_disabled = yes } } }
						custom_tooltip = { fail_text = shadowgate.fail.ownership event_target:shadowgate_planet_e = { controller = { has_country_flag = shadowgate_e_accessed } } }
						custom_tooltip = { fail_text = shadowgate.shadowrift.under.assault.fail event_target:shadowgate_planet_e = { NOT = { shadowgate_shadowrift_is_under_assault = yes } } }
					}
					else = { custom_tooltip = { fail_text = shadowgate.error.all always = no } }
				}
				else = { hidden_trigger = { always = no } }
			}
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate.compass.open
			hidden_effect = {
				set_country_flag = shadowgate_d_compass_open
				set_country_flag = shadowgate_dl_knowledge
				switch = {
					trigger = has_country_flag
					shadowgate_a_accessed = { event_target:shadowgate_planet_a = { set_planet_flag = shadowgate_d_compass_open planet_event = { id = shadowgate_a.3010 } } }
					shadowgate_b_accessed = { event_target:shadowgate_planet_b = { set_planet_flag = shadowgate_d_compass_open planet_event = { id = shadowgate_b.3010 } } }
					shadowgate_c_accessed = { event_target:shadowgate_planet_c = { set_planet_flag = shadowgate_d_compass_open planet_event = { id = shadowgate_c.3010 } } }
					shadowgate_d_accessed = { event_target:shadowgate_planet_d = { set_planet_flag = shadowgate_d_compass_open planet_event = { id = shadowgate_d.3010 } } }
					shadowgate_e_accessed = { event_target:shadowgate_planet_e = { set_planet_flag = shadowgate_d_compass_open planet_event = { id = shadowgate_e.3010 } } }
				}
			}
		}
	}
}

shadowgate_d_compass_save_changes = {
	potential = { always = yes }

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOT = { has_country_flag = shadowgate_d_compass_finalized } } }
			custom_tooltip = {
				fail_text = shadowgate_d_compass_nochanges_tooltip
				from = {
					OR = {
						switch = {
							trigger = has_country_flag
							shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { check_variable = { which = ShadowgatePendingChanges value > 0 } } }
							shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { check_variable = { which = ShadowgatePendingChanges value > 0 } } }
							shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { check_variable = { which = ShadowgatePendingChanges value > 0 } } }
							shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { check_variable = { which = ShadowgatePendingChanges value > 0 } } }
							shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { check_variable = { which = ShadowgatePendingChanges value > 0 } } }
						}
						has_country_flag = shadowgate_d_compass_saved
					}
				}
			}
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			if = { limit = { NOT = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = shadowgate_d_compass_save_button }
			if = { limit = { has_country_flag = shadowgate_d_compass_open_a } shadowgate_d_compass_save_changes_effect = { SHADOWGATE = a } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_b } shadowgate_d_compass_save_changes_effect = { SHADOWGATE = b } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_c } shadowgate_d_compass_save_changes_effect = { SHADOWGATE = c } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_d } shadowgate_d_compass_save_changes_effect = { SHADOWGATE = d } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_e } shadowgate_d_compass_save_changes_effect = { SHADOWGATE = e } }
		}
	}
}

# Dimensional Convergence - Center

shadowgate_d_compass_dc_e = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { NOR = { has_planet_flag = shadowgate_dc_effect has_planet_flag = shadowgate_dc } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { NOR = { has_planet_flag = shadowgate_dc_effect has_planet_flag = shadowgate_dc } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { NOR = { has_planet_flag = shadowgate_dc_effect has_planet_flag = shadowgate_dc } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { NOR = { has_planet_flag = shadowgate_dc_effect has_planet_flag = shadowgate_dc } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { NOR = { has_planet_flag = shadowgate_dc_effect has_planet_flag = shadowgate_dc } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			custom_tooltip = { fail_text = shadowgate_d_compass_dc_l shadowgate_d_compass_dc_unlocked = yes }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_dc always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_all_pending_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_dc_e
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { shadowgate_d_compass_dc_e_d_effect = yes } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { shadowgate_d_compass_dc_e_d_effect = yes } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { shadowgate_d_compass_dc_e_d_effect = yes } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { shadowgate_d_compass_dc_e_d_effect = yes } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { shadowgate_d_compass_dc_e_d_effect = yes } }
				}
			}
		}
	}
}

shadowgate_d_compass_dc_f = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_dc } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_dc } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_dc } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_dc } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_dc } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOT = { has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
				if = { limit = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_dc_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_dc_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_dc_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
				if = { limit = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_dc_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_dc_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_dc_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
				if = { limit = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_dc_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_dc_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_dc_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
				if = { limit = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_dc_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_dc_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_dc_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
				if = { limit = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_dc_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_dc_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_dc_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			if = { limit = { has_country_flag = shadowgate_d_compass_open_a } shadowgate_d_compass_dc_f_effect = { SHADOWGATE = a } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_b } shadowgate_d_compass_dc_f_effect = { SHADOWGATE = b } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_c } shadowgate_d_compass_dc_f_effect = { SHADOWGATE = c } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_d } shadowgate_d_compass_dc_f_effect = { SHADOWGATE = d } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_e } shadowgate_d_compass_dc_f_effect = { SHADOWGATE = e } }
		}
	}
}

shadowgate_d_compass_dc_d = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_dc_effect NOT = { has_planet_flag = shadowgate_dc } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_dc_effect NOT = { has_planet_flag = shadowgate_dc } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_dc_effect NOT = { has_planet_flag = shadowgate_dc } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_dc_effect NOT = { has_planet_flag = shadowgate_dc } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_dc_effect NOT = { has_planet_flag = shadowgate_dc } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			custom_tooltip = { fail_text = shadowgate_d_compass_dc_l shadowgate_d_compass_dc_unlocked = yes }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_dc_r always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_dc_r
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { shadowgate_d_compass_dc_e_d_effect = yes } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { shadowgate_d_compass_dc_e_d_effect = yes } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { shadowgate_d_compass_dc_e_d_effect = yes } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { shadowgate_d_compass_dc_e_d_effect = yes } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { shadowgate_d_compass_dc_e_d_effect = yes } }
				}
			}
		}
	}
}

# Retrograde Counterpoint Harmonics - Bottom Middle

shadowgate_d_compass_rch_e = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { NOR = { has_planet_flag = shadowgate_rch_effect has_planet_flag = shadowgate_rch } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { NOR = { has_planet_flag = shadowgate_rch_effect has_planet_flag = shadowgate_rch } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { NOR = { has_planet_flag = shadowgate_rch_effect has_planet_flag = shadowgate_rch } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { NOR = { has_planet_flag = shadowgate_rch_effect has_planet_flag = shadowgate_rch } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { NOR = { has_planet_flag = shadowgate_rch_effect has_planet_flag = shadowgate_rch } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { NOT = { shadowgate_d_compass_rch_unlocked = yes } } custom_tooltip = { fail_text = shadowgate_d_compass_rch_l always = no } }
			else = { custom_tooltip = { fail_text = shadowgate_d_compass_rch_m shadowgate_d_compass_outer_limit = yes } }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_rch always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_all_pending_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_rch_e
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { set_d_compass_lodestone = { LODESTONE = rch } } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { set_d_compass_lodestone = { LODESTONE = rch } } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { set_d_compass_lodestone = { LODESTONE = rch } } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { set_d_compass_lodestone = { LODESTONE = rch } } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { set_d_compass_lodestone = { LODESTONE = rch } } }
				}
			}
		}
	}
}

shadowgate_d_compass_rch_f = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_rch } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_rch } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_rch } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_rch } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_rch } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOT = { has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
				if = { limit = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_rch_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_rch_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_rch_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
				if = { limit = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_rch_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_rch_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_rch_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
				if = { limit = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_rch_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_rch_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_rch_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
				if = { limit = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_rch_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_rch_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_rch_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
				if = { limit = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_rch_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_rch_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_rch_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			if = { limit = { has_country_flag = shadowgate_d_compass_open_a } shadowgate_d_compass_general_f_effect = { SHADOWGATE = a LODESTONE = rch } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_b } shadowgate_d_compass_general_f_effect = { SHADOWGATE = b LODESTONE = rch } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_c } shadowgate_d_compass_general_f_effect = { SHADOWGATE = c LODESTONE = rch } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_d } shadowgate_d_compass_general_f_effect = { SHADOWGATE = d LODESTONE = rch } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_e } shadowgate_d_compass_general_f_effect = { SHADOWGATE = e LODESTONE = rch } }
		}
	}
}

shadowgate_d_compass_rch_d = {
	potential = { 
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_rch_effect NOT = { has_planet_flag = shadowgate_rch } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_rch_effect NOT = { has_planet_flag = shadowgate_rch } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_rch_effect NOT = { has_planet_flag = shadowgate_rch } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_rch_effect NOT = { has_planet_flag = shadowgate_rch } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_rch_effect NOT = { has_planet_flag = shadowgate_rch } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { NOT = { shadowgate_d_compass_rch_unlocked = yes } } custom_tooltip = { fail_text = shadowgate_d_compass_rch_l always = no } }
			else = { custom_tooltip = { fail_text = shadowgate_d_compass_rch_m shadowgate_d_compass_outer_limit = yes } }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_rch_r always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_rch_r
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { set_d_compass_lodestone = { LODESTONE = rch } } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { set_d_compass_lodestone = { LODESTONE = rch } } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { set_d_compass_lodestone = { LODESTONE = rch } } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { set_d_compass_lodestone = { LODESTONE = rch } } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { set_d_compass_lodestone = { LODESTONE = rch } } }
				}
			}
		}
	}
}

# Decrescent Umbral Projection - Top Left

shadowgate_d_compass_dup_e = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { NOR = { has_planet_flag = shadowgate_dup_effect has_planet_flag = shadowgate_dup } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { NOR = { has_planet_flag = shadowgate_dup_effect has_planet_flag = shadowgate_dup } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { NOR = { has_planet_flag = shadowgate_dup_effect has_planet_flag = shadowgate_dup } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { NOR = { has_planet_flag = shadowgate_dup_effect has_planet_flag = shadowgate_dup } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { NOR = { has_planet_flag = shadowgate_dup_effect has_planet_flag = shadowgate_dup } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { NOT = { shadowgate_d_compass_dup_unlocked = yes } } custom_tooltip = { fail_text = shadowgate_d_compass_dup_l always = no } }
			else = { custom_tooltip = { fail_text = shadowgate_d_compass_dup_m shadowgate_d_compass_outer_limit = yes } }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_dup always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_all_pending_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_dup_e
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { set_d_compass_lodestone = { LODESTONE = dup } } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { set_d_compass_lodestone = { LODESTONE = dup } } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { set_d_compass_lodestone = { LODESTONE = dup } } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { set_d_compass_lodestone = { LODESTONE = dup } } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { set_d_compass_lodestone = { LODESTONE = dup } } }
				}
			}
		}
	}
}

shadowgate_d_compass_dup_f = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_dup } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_dup } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_dup } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_dup } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_dup } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOT = { has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
				if = { limit = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_dup_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_dup_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_dup_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
				if = { limit = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_dup_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_dup_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_dup_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
				if = { limit = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_dup_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_dup_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_dup_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
				if = { limit = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_dup_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_dup_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_dup_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
				if = { limit = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_dup_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_dup_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_dup_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			if = { limit = { has_country_flag = shadowgate_d_compass_open_a } shadowgate_d_compass_general_f_effect = { SHADOWGATE = a LODESTONE = dup } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_b } shadowgate_d_compass_general_f_effect = { SHADOWGATE = b LODESTONE = dup } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_c } shadowgate_d_compass_general_f_effect = { SHADOWGATE = c LODESTONE = dup } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_d } shadowgate_d_compass_general_f_effect = { SHADOWGATE = d LODESTONE = dup } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_e } shadowgate_d_compass_general_f_effect = { SHADOWGATE = e LODESTONE = dup } }
		}
	}
}

shadowgate_d_compass_dup_d = {
	potential = { 
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_dup_effect NOT = { has_planet_flag = shadowgate_dup } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_dup_effect NOT = { has_planet_flag = shadowgate_dup } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_dup_effect NOT = { has_planet_flag = shadowgate_dup } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_dup_effect NOT = { has_planet_flag = shadowgate_dup } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_dup_effect NOT = { has_planet_flag = shadowgate_dup } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { NOT = { shadowgate_d_compass_dup_unlocked = yes } } custom_tooltip = { fail_text = shadowgate_d_compass_dup_l always = no } }
			else = { custom_tooltip = { fail_text = shadowgate_d_compass_dup_m shadowgate_d_compass_outer_limit = yes } }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_dup_r always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_dup_r
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { set_d_compass_lodestone = { LODESTONE = dup } } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { set_d_compass_lodestone = { LODESTONE = dup } } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { set_d_compass_lodestone = { LODESTONE = dup } } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { set_d_compass_lodestone = { LODESTONE = dup } } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { set_d_compass_lodestone = { LODESTONE = dup } } }
				}
			}
		}
	}
}

# Shadowed Path - Top Right

shadowgate_d_compass_sp_e = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { NOR = { has_planet_flag = shadowgate_sp_effect has_planet_flag = shadowgate_sp } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { NOR = { has_planet_flag = shadowgate_sp_effect has_planet_flag = shadowgate_sp } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { NOR = { has_planet_flag = shadowgate_sp_effect has_planet_flag = shadowgate_sp } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { NOR = { has_planet_flag = shadowgate_sp_effect has_planet_flag = shadowgate_sp } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { NOR = { has_planet_flag = shadowgate_sp_effect has_planet_flag = shadowgate_sp } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { NOT = { shadowgate_d_compass_sp_unlocked = yes } } custom_tooltip = { fail_text = shadowgate_d_compass_sp_l always = no } }
			else = { custom_tooltip = { fail_text = shadowgate_d_compass_sp_m shadowgate_d_compass_outer_limit = yes } }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_sp always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_all_pending_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_sp_e
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { set_d_compass_lodestone = { LODESTONE = sp } } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { set_d_compass_lodestone = { LODESTONE = sp } } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { set_d_compass_lodestone = { LODESTONE = sp } } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { set_d_compass_lodestone = { LODESTONE = sp } } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { set_d_compass_lodestone = { LODESTONE = sp } } }
				}
			}
		}
	}
}

shadowgate_d_compass_sp_f = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_sp } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_sp } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_sp } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_sp } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_sp } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOT = { has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
				if = { limit = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_sp_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_sp_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_sp_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
				if = { limit = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_sp_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_sp_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_sp_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
				if = { limit = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_sp_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_sp_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_sp_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
				if = { limit = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_sp_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_sp_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_sp_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
				if = { limit = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_sp_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_sp_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_sp_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			if = { limit = { has_country_flag = shadowgate_d_compass_open_a } shadowgate_d_compass_general_f_effect = { SHADOWGATE = a LODESTONE = sp } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_b } shadowgate_d_compass_general_f_effect = { SHADOWGATE = b LODESTONE = sp } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_c } shadowgate_d_compass_general_f_effect = { SHADOWGATE = c LODESTONE = sp } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_d } shadowgate_d_compass_general_f_effect = { SHADOWGATE = d LODESTONE = sp } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_e } shadowgate_d_compass_general_f_effect = { SHADOWGATE = e LODESTONE = sp } }
		}
	}
}

shadowgate_d_compass_sp_d = {
	potential = { 
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_sp_effect NOT = { has_planet_flag = shadowgate_sp } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_sp_effect NOT = { has_planet_flag = shadowgate_sp } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_sp_effect NOT = { has_planet_flag = shadowgate_sp } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_sp_effect NOT = { has_planet_flag = shadowgate_sp } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_sp_effect NOT = { has_planet_flag = shadowgate_sp } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { NOT = { shadowgate_d_compass_sp_unlocked = yes } } custom_tooltip = { fail_text = shadowgate_d_compass_sp_l always = no } }
			else = { custom_tooltip = { fail_text = shadowgate_d_compass_sp_m shadowgate_d_compass_outer_limit = yes } }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_sp_r always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_sp_r
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { set_d_compass_lodestone = { LODESTONE = sp } } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { set_d_compass_lodestone = { LODESTONE = sp } } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { set_d_compass_lodestone = { LODESTONE = sp } } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { set_d_compass_lodestone = { LODESTONE = sp } } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { set_d_compass_lodestone = { LODESTONE = sp } } }
				}
			}
		}
	}
}

# Vestigial Conjuration - Bottom Left

shadowgate_d_compass_vc_e = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { NOR = { has_planet_flag = shadowgate_vc_effect has_planet_flag = shadowgate_vc } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { NOR = { has_planet_flag = shadowgate_vc_effect has_planet_flag = shadowgate_vc } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { NOR = { has_planet_flag = shadowgate_vc_effect has_planet_flag = shadowgate_vc } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { NOR = { has_planet_flag = shadowgate_vc_effect has_planet_flag = shadowgate_vc } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { NOR = { has_planet_flag = shadowgate_vc_effect has_planet_flag = shadowgate_vc } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { NOT = { shadowgate_d_compass_vc_unlocked = yes } } custom_tooltip = { fail_text = shadowgate_d_compass_vc_l always = no } }
			else = { custom_tooltip = { fail_text = shadowgate_d_compass_vc_m shadowgate_d_compass_outer_limit = yes } }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_vc always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_all_pending_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_vc_e
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { set_d_compass_lodestone = { LODESTONE = vc } } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { set_d_compass_lodestone = { LODESTONE = vc } } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { set_d_compass_lodestone = { LODESTONE = vc } } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { set_d_compass_lodestone = { LODESTONE = vc } } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { set_d_compass_lodestone = { LODESTONE = vc } } }
				}
			}
		}
	}
}

shadowgate_d_compass_vc_f = {
	potential = { 
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_vc } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_vc } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_vc } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_vc } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_vc } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOT = { has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
				if = { limit = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_vc_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_vc_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_vc_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
				if = { limit = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_vc_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_vc_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_vc_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
				if = { limit = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_vc_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_vc_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_vc_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
				if = { limit = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_vc_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_vc_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_vc_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
				if = { limit = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_vc_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_vc_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_vc_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			if = { limit = { has_country_flag = shadowgate_d_compass_open_a } shadowgate_d_compass_general_f_effect = { SHADOWGATE = a LODESTONE = vc } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_b } shadowgate_d_compass_general_f_effect = { SHADOWGATE = b LODESTONE = vc } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_c } shadowgate_d_compass_general_f_effect = { SHADOWGATE = c LODESTONE = vc } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_d } shadowgate_d_compass_general_f_effect = { SHADOWGATE = d LODESTONE = vc } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_e } shadowgate_d_compass_general_f_effect = { SHADOWGATE = e LODESTONE = vc } }
		}
	}
}

shadowgate_d_compass_vc_d = {
	potential = { 
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_vc_effect NOT = { has_planet_flag = shadowgate_vc } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_vc_effect NOT = { has_planet_flag = shadowgate_vc } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_vc_effect NOT = { has_planet_flag = shadowgate_vc } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_vc_effect NOT = { has_planet_flag = shadowgate_vc } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_vc_effect NOT = { has_planet_flag = shadowgate_vc } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { NOT = { shadowgate_d_compass_vc_unlocked = yes } } custom_tooltip = { fail_text = shadowgate_d_compass_vc_l always = no } }
			else = { custom_tooltip = { fail_text = shadowgate_d_compass_vc_m shadowgate_d_compass_outer_limit = yes } }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_vc_r always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_vc_r
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { set_d_compass_lodestone = { LODESTONE = vc } } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { set_d_compass_lodestone = { LODESTONE = vc } } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { set_d_compass_lodestone = { LODESTONE = vc } } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { set_d_compass_lodestone = { LODESTONE = vc } } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { set_d_compass_lodestone = { LODESTONE = vc } } }
				}
			}
		}
	}
}

# Augmentative Shadow Pulse - Top Middle

shadowgate_d_compass_asp_e = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { NOR = { has_planet_flag = shadowgate_asp_effect has_planet_flag = shadowgate_asp } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { NOR = { has_planet_flag = shadowgate_asp_effect has_planet_flag = shadowgate_asp } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { NOR = { has_planet_flag = shadowgate_asp_effect has_planet_flag = shadowgate_asp } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { NOR = { has_planet_flag = shadowgate_asp_effect has_planet_flag = shadowgate_asp } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { NOR = { has_planet_flag = shadowgate_asp_effect has_planet_flag = shadowgate_asp } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { NOT = { shadowgate_d_compass_asp_unlocked = yes } } custom_tooltip = { fail_text = shadowgate_d_compass_asp_l always = no } }
			else = { custom_tooltip = { fail_text = shadowgate_d_compass_asp_m shadowgate_d_compass_outer_limit = yes } }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_asp always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_all_pending_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_asp_e
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { set_d_compass_lodestone = { LODESTONE = asp } } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { set_d_compass_lodestone = { LODESTONE = asp } } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { set_d_compass_lodestone = { LODESTONE = asp } } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { set_d_compass_lodestone = { LODESTONE = asp } } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { set_d_compass_lodestone = { LODESTONE = asp } } }
				}
			}
		}
	}
}

shadowgate_d_compass_asp_f = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_asp } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_asp } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_asp } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_asp } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_asp } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOT = { has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
				if = { limit = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_asp_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_asp_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_asp_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
				if = { limit = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_asp_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_asp_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_asp_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
				if = { limit = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_asp_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_asp_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_asp_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
				if = { limit = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_asp_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_asp_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_asp_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
				if = { limit = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_asp_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_asp_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_asp_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			if = { limit = { has_country_flag = shadowgate_d_compass_open_a } shadowgate_d_compass_general_f_effect = { SHADOWGATE = a LODESTONE = asp } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_b } shadowgate_d_compass_general_f_effect = { SHADOWGATE = b LODESTONE = asp } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_c } shadowgate_d_compass_general_f_effect = { SHADOWGATE = c LODESTONE = asp } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_d } shadowgate_d_compass_general_f_effect = { SHADOWGATE = d LODESTONE = asp } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_e } shadowgate_d_compass_general_f_effect = { SHADOWGATE = e LODESTONE = asp } }
		}
	}
}

shadowgate_d_compass_asp_d = {
	potential = { 
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_asp_effect NOT = { has_planet_flag = shadowgate_asp } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_asp_effect NOT = { has_planet_flag = shadowgate_asp } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_asp_effect NOT = { has_planet_flag = shadowgate_asp } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_asp_effect NOT = { has_planet_flag = shadowgate_asp } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_asp_effect NOT = { has_planet_flag = shadowgate_asp } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { NOT = { shadowgate_d_compass_asp_unlocked = yes } } custom_tooltip = { fail_text = shadowgate_d_compass_asp_l always = no } }
			else = { custom_tooltip = { fail_text = shadowgate_d_compass_asp_m shadowgate_d_compass_outer_limit = yes } }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_asp_r always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_asp_r
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { set_d_compass_lodestone = { LODESTONE = asp } } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { set_d_compass_lodestone = { LODESTONE = asp } } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { set_d_compass_lodestone = { LODESTONE = asp } } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { set_d_compass_lodestone = { LODESTONE = asp } } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { set_d_compass_lodestone = { LODESTONE = asp } } }
				}
			}
		}
	}
}

# Shadow Mooring - Bottom Right

shadowgate_d_compass_sm_e = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { NOR = { has_planet_flag = shadowgate_sm_effect has_planet_flag = shadowgate_sm } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { NOR = { has_planet_flag = shadowgate_sm_effect has_planet_flag = shadowgate_sm } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { NOR = { has_planet_flag = shadowgate_sm_effect has_planet_flag = shadowgate_sm } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { NOR = { has_planet_flag = shadowgate_sm_effect has_planet_flag = shadowgate_sm } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { NOR = { has_planet_flag = shadowgate_sm_effect has_planet_flag = shadowgate_sm } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { NOT = { shadowgate_d_compass_sm_unlocked = yes } } custom_tooltip = { fail_text = shadowgate_d_compass_sm_l always = no } }
			else = { custom_tooltip = { fail_text = shadowgate_d_compass_sm_m shadowgate_d_compass_outer_limit = yes } }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_sm always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_all_pending_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_sm_e
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { set_d_compass_lodestone = { LODESTONE = sm } } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { set_d_compass_lodestone = { LODESTONE = sm } } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { set_d_compass_lodestone = { LODESTONE = sm } } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { set_d_compass_lodestone = { LODESTONE = sm } } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { set_d_compass_lodestone = { LODESTONE = sm } } }
				}
			}
		}
	}
}

shadowgate_d_compass_sm_f = {
	potential = {
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_sm } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_sm } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_sm } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_sm } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_sm } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOT = { has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { from = { has_country_flag = shadowgate_a_accessed } }
				if = { limit = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_sm_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_sm_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_sm_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_b_accessed } }
				if = { limit = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_sm_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_sm_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_sm_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_c_accessed } }
				if = { limit = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_sm_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_sm_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_sm_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_d_accessed } }
				if = { limit = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_sm_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_sm_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_sm_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
			else_if = { limit = { from = { has_country_flag = shadowgate_e_accessed } }
				if = { limit = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_sm_effect } } custom_tooltip = { fail_text = shadowgate_d_compass_sm_f_a from = { NOT = { has_country_flag = shadowgate_d_compass_saved } } } }
				else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } } custom_tooltip = { fail_text = shadowgate_d_compass_sm_f_p always = no } custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no } }
			}
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			if = { limit = { has_country_flag = shadowgate_d_compass_open_a } shadowgate_d_compass_general_f_effect = { SHADOWGATE = a LODESTONE = sm } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_b } shadowgate_d_compass_general_f_effect = { SHADOWGATE = b LODESTONE = sm } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_c } shadowgate_d_compass_general_f_effect = { SHADOWGATE = c LODESTONE = sm } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_d } shadowgate_d_compass_general_f_effect = { SHADOWGATE = d LODESTONE = sm } }
			else_if = { limit = { has_country_flag = shadowgate_d_compass_open_e } shadowgate_d_compass_general_f_effect = { SHADOWGATE = e LODESTONE = sm } }
		}
	}
}

shadowgate_d_compass_sm_d = {
	potential = { 
		from = {
			switch = {
				trigger = has_country_flag
				shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { has_planet_flag = shadowgate_sm_effect NOT = { has_planet_flag = shadowgate_sm } } }
				shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { has_planet_flag = shadowgate_sm_effect NOT = { has_planet_flag = shadowgate_sm } } }
				shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { has_planet_flag = shadowgate_sm_effect NOT = { has_planet_flag = shadowgate_sm } } }
				shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { has_planet_flag = shadowgate_sm_effect NOT = { has_planet_flag = shadowgate_sm } } }
				shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { has_planet_flag = shadowgate_sm_effect NOT = { has_planet_flag = shadowgate_sm } } }
			}
		}
	}

	allow = {
		if = { limit = { from = { has_country_flag = shadowgate_accessed NOR = { has_country_flag = shadowgate_d_compass_saved has_country_flag = shadowgate_d_compass_finalized } } }
			if = { limit = { NOT = { shadowgate_d_compass_sm_unlocked = yes } } custom_tooltip = { fail_text = shadowgate_d_compass_sm_l always = no } }
			else = { custom_tooltip = { fail_text = shadowgate_d_compass_sm_m shadowgate_d_compass_outer_limit = yes } }
		}
		else_if = { limit = { from = { has_country_flag = shadowgate_d_compass_saved } }
			custom_tooltip = { fail_text = shadowgate_d_compass_sm_r always = no }
			custom_tooltip = { fail_text = shadowgate_d_compass_lodestone_finalize_tooltip always = no }
		}
		else = { hidden_trigger = { always = no } }
	}

	effect = {
		from = {
			custom_tooltip = shadowgate_d_compass_sm_r
			custom_tooltip = shadowgate_d_compass_lodestone_alteration_tooltip
			hidden_effect = {
				switch = {
					trigger = has_country_flag
					shadowgate_d_compass_open_a = { event_target:shadowgate_planet_a = { set_d_compass_lodestone = { LODESTONE = sm } } }
					shadowgate_d_compass_open_b = { event_target:shadowgate_planet_b = { set_d_compass_lodestone = { LODESTONE = sm } } }
					shadowgate_d_compass_open_c = { event_target:shadowgate_planet_c = { set_d_compass_lodestone = { LODESTONE = sm } } }
					shadowgate_d_compass_open_d = { event_target:shadowgate_planet_d = { set_d_compass_lodestone = { LODESTONE = sm } } }
					shadowgate_d_compass_open_e = { event_target:shadowgate_planet_e = { set_d_compass_lodestone = { LODESTONE = sm } } }
				}
			}
		}
	}
}