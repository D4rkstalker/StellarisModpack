

# In planet scope
harvester_is_crackable = {
	AND = {
		OR = {
			num_minerals >= 1
			# Will always treat colonies as crackable, unless they are habitats or ringworlds
			AND = {
				is_colony = yes
				is_artificial = no
			}
		}
		NOR = {
			is_star = yes
			is_asteroid = yes
			is_planet_class = pc_shattered #Prevent Overcracking
		}
		is_content_world = no
	}
}

# In planet scope. Tries to avoid blowing up worlds with content or event chains
is_content_world = {
	OR = {
		AND = {
			has_owner = no # We want to avoid deleting content, but if you own it, tough luck, you've had your chance.
			is_preventing_anomaly = yes
		}
		has_planet_flag = "Holy World" # Ancient mining drone warrantee is voided if we blow up Zarqlan's house
		has_planet_flag = "crisis_vital_planet"
		AND = {
			exists = space_owner
			space_owner = {
				OR = {
					is_country_type = caravaneer_home
					is_country_type = dormant_marauders 
					is_country_type = ruined_marauders 
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire 
				}
			}
		}
	}
}

# In Planet Scope
planet_harvested = {
	has_planet_modifier = "harvested_stage_4"
}

# In Planet Scope
planet_partially_harvested = {
	OR = {
		has_planet_modifier = "harvested_stage_1"
		has_planet_modifier = "harvested_stage_2"
		has_planet_modifier = "harvested_stage_3"
	}
}

# In country scope
is_harvester_country = {
	is_country_type = harvester_country_type
}

# In fleet scope
harvester_need_rcu = {
	count_owned_ship = {
		count < 1
		limit = { is_ship_size = harvest_rcu }
	}
}

# In fleet scope
harvester_need_beamcage = {	
	if = {
		limit = { this = { has_fleet_flag = harvest_engine } }
		count_owned_ship = {
			count < owner.beamcage_boss_scaling
			limit = { is_ship_size = harvest_beamcage }
		}
	}
	else = {
		count_owned_ship = {
			count < owner.beamcage_scaling
			limit = { is_ship_size = harvest_beamcage }
		}
	}
}

# In fleet scope
harvester_need_escorts = {
	if = {
		limit = { this = { has_fleet_flag = harvest_engine } }
		count_owned_ship = {
			count < owner.escort_boss_scaling
			limit = { is_ship_size = harvest_escort }
		}
	}
	else = {
		count_owned_ship = {
			count < owner.escort_boss_scaling
			limit = { is_ship_size = harvest_escort }
		}
	}
}

# In fleet scope
harvester_need_destroyers = {
	if = {
		limit = { this = { has_fleet_flag = harvest_engine } }
		count_owned_ship = {
			count < owner.destroyer_boss_scaling
			limit = { is_ship_size = harvest_destroyer }
		}
	}
	else = {
		count_owned_ship = {
			count < owner.destroyer_scaling
			limit = { is_ship_size = harvest_destroyer }
		}
	}
}

# In fleet scope
harvester_need_corvettes = {
	if = {
		limit = { this = { has_fleet_flag = harvest_engine } }
		count_owned_ship = {
			count < owner.corvette_boss_scaling
			limit = { is_ship_size = harvest_corvette }
		}
	}
	else = {
		count_owned_ship = {
			count < owner.corvette_scaling
			limit = { is_ship_size = harvest_corvette }
		}
	}
}

# In country scope
harvester_need_fleets = {
	count_owned_fleet = {
		count < harvester_fleet_scaling
		limit = { has_fleet_flag = "harvest_rcu" }
	}
}

harvester_urgent_need_fleets = {
	count_owned_fleet = {
		count < @harvester_starting_rcu_fleet_count
		limit = { has_fleet_flag = "harvest_rcu" }
	}
}

# In country scope
harvester_need_fleets_start = {
	count_owned_fleet = {
		count < @harvester_starting_rcu_fleet_count
		limit = { has_fleet_flag = "harvest_rcu" }
	}
}

# In fleet scope
is_harvest_leviathan = {
	has_fleet_flag = harvest_engine
}

# In fleet scope
is_harvest_rcu = {
	has_fleet_flag = harvest_rcu
}

# In country scope
can_remove_beacons = {
	OR = {
		has_modifier = harvester_nemesis
		any_situation = {
			is_situation_type = situation_harvester_analysis
			situation_progress >= 0 # Lol
		}
	}
}

# In country scope
can_hack_fleets = {
	OR = {
		has_modifier = harvester_nemesis
		any_situation = {
			is_situation_type = situation_harvester_analysis
			situation_progress >= 20
		}
	}
}
# In country scope
has_beacons_unlocked = {
	OR = {
		has_modifier = harvester_nemesis
		any_situation = {
			is_situation_type = situation_harvester_analysis
			situation_progress >= 40
		}
	}
}

# In country scope
has_shiva_diplo_unlocked = {
	OR = {
		has_modifier = harvester_nemesis
		any_situation = {
			is_situation_type = situation_harvester_analysis
			situation_progress >= 40
		}
	}
}

# In country scope
has_shiva_resolutions_unlocked = {
	OR = {
		has_modifier = harvester_nemesis
		any_situation = {
			is_situation_type = situation_harvester_analysis
			situation_progress >= 60
		}
	}
}

# In country scope
can_spawn_harvester_analysis = {
	NOR = {
		any_situation = {
			is_situation_type = situation_harvester_analysis
		}
		has_modifier = harvester_nemesis
	}
}