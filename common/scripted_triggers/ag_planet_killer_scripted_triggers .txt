
can_destroy_planet_with_ag_ancient_epsilon_planet_killer_weapon = {
	optimize_memory
	custom_tooltip = {
		fail_text = "ag_requires_a_star_star_killer" 
		NOR = {
			is_planet_class = pc_ag_void_star
			is_planet_class = pc_ag_void_planet
		}
	}
	custom_tooltip = {
		fail_text = "ag_requires_is_star_star_killer" 
		OR = {
			AND = {
				from.owner = {
					has_country_flag = ag_ship_subsystem_enabled_501_19
					OR = {
						has_country_flag = ag_epsilon_star_killer_planet_killer_mode
						has_country_flag = ag_epsilon_star_killer_planet_sweeper_mode
					}
				}
				is_star = no
			}
			is_star = yes
		}
	}
	custom_tooltip = {
		fail_text = "ag_requires_no_compact_star_star_killer"
		NOT = { is_planet_class = pc_black_hole }
	}
	custom_tooltip = {
		fail_text = "ag_requires_outside_border_star_killer"
		NOR = {
			AND = {
				from.owner = {
					NOR = {
						has_country_flag = ag_epsilon_star_killer_planet_killer_mode
						has_country_flag = ag_epsilon_star_killer_planet_sweeper_mode
					}
				}
				is_inside_border = from.owner
				solar_system = {
					any_system_planet = {
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
					}
				}
			}
			AND = {
				from.owner = {
					OR = {
						has_country_flag = ag_epsilon_star_killer_planet_killer_mode
						has_country_flag = ag_epsilon_star_killer_planet_sweeper_mode
					}
				}
				exists = owner
				owner = { is_same_value = from.owner }
			}
		}
	}
	custom_tooltip = {
		fail_text = "ag_requires_declares_war_star_killer"
		OR = {
			AND = {
				from.owner = {
					NOR = {
						has_country_flag = ag_epsilon_star_killer_planet_killer_mode
						has_country_flag = ag_epsilon_star_killer_planet_sweeper_mode
					}
				}
				OR = {
					is_inside_border = from.owner
					solar_system = { NOT = { exists = space_owner } }
					solar_system = { exists = space_owner space_owner = { is_hostile = from.owner } }
				}
			}
			AND = {
				from.owner = {
					OR = {
						has_country_flag = ag_epsilon_star_killer_planet_killer_mode
						has_country_flag = ag_epsilon_star_killer_planet_sweeper_mode
					}
				}
				NAND = {
					exists = owner
					owner = { NOT = { is_hostile = from.owner } }
				}
			}
		}
	}
	custom_tooltip = {
		fail_text = "ag_requires_no_pacifist_star_killer"
		from.owner = {
			NOR = {
				has_ethic = ethic_fanatic_pacifist
				has_ethic = ethic_pacifist
			}
		}
	}
	custom_tooltip = {
		fail_text = "ag_requires_no_ancient_system" 
		ag_is_ancient_system = no
	}
	custom_tooltip = {
		fail_text = "ag_requires_no_zeta_crisis_system" 
		NOT = { has_star_flag = ag_zeta_crisis_core_system }
	}
	custom_tooltip = {
		fail_text = "ag_requires_no_special_system" 
		ag_is_star_killer_special_system = no
	}
	custom_tooltip = {
		fail_text = "ag_requires_no_charging_star_killer"
		from = { NOT = { any_controlled_ship = {
			is_ship_size = ag_epsilon_titan_1
			has_ship_flag = ag_epsilon_firing_star_killer_weapon
		} } }
	}
}

ag_epsilon_planet_killer_weapon_selector_trigger = {
	optimize_memory
	OR = {
		hidden_trigger = { root = { NOT = { has_country_flag = ag_enabled_epsilon_planet_killer_selector } } }
		AND = {
			custom_tooltip = {
				fail_text = "ag_requires_a_star_star_killer" 
				event_target:ag_system_selector_marked_system_[[ag_system_seq]$ag_system_seq$] = { NOT = { is_star_class = sc_ag_void } }
			}
			custom_tooltip = {
				fail_text = "ag_requires_no_compact_star_star_killer"
				event_target:ag_system_selector_marked_system_[[ag_system_seq]$ag_system_seq$] = { NOT = { is_star_class = sc_black_hole } }
			}
			custom_tooltip = {
				fail_text = "ag_requires_outside_border_star_killer"
				event_target:ag_system_selector_marked_system_[[ag_system_seq]$ag_system_seq$] = { NAND = {
					is_inside_border = root
					any_system_planet = {
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
					}
				} }
			}
			# custom_tooltip = {
			# 	fail_text = "ag_requires_declares_war_star_killer"
			# 	event_target:ag_system_selector_marked_system_[[ag_system_seq]$ag_system_seq$] = { OR = {
			# 		is_inside_border = root
			# 		NOT = { exists = space_owner }
			# 		AND = { exists = space_owner space_owner = { is_hostile = root } }
			# 	} }
			# }
			custom_tooltip = {
				fail_text = "ag_requires_no_ancient_system" 
				event_target:ag_system_selector_marked_system_[[ag_system_seq]$ag_system_seq$] = {
					ag_is_ancient_system = no
					NOT = { any_ship_in_system = { OR = {
						is_ship_size = ag_gamma_station_hostile
						is_ship_size = ag_gamma_station_small_hostile
						is_ship_size = ag_gamma_station_small_moving_hostile
					} } }
				}
			}
			custom_tooltip = {
				fail_text = "ag_requires_no_zeta_crisis_system" 
				event_target:ag_system_selector_marked_system_[[ag_system_seq]$ag_system_seq$] = { NOT = {
					any_ship_in_system = { OR = {
						is_ship_size = ag_zeta_crisis_portal
						is_ship_size = ag_zeta_crisis_psionic_storm
						is_ship_size = ag_zeta_crisis_psionic_singularity
					} }
				} }
			}
			custom_tooltip = {
				fail_text = "ag_requires_no_exd_system" 
				event_target:ag_system_selector_marked_system_[[ag_system_seq]$ag_system_seq$] = { NOT = {
					any_ship_in_system = { is_ship_size = dimensional_portal_ed }
				} }
			}
			custom_tooltip = {
				fail_text = "ag_requires_no_contingency_system" 
				event_target:ag_system_selector_marked_system_[[ag_system_seq]$ag_system_seq$] = { NOT = {
					any_system_planet = {
						is_planet_class = pc_ai
						exists = owner
						owner = { is_country_type = ai_empire }
					}
				} }
			}
			custom_tooltip = {
				fail_text = "ag_requires_no_special_system" 
				event_target:ag_system_selector_marked_system_[[ag_system_seq]$ag_system_seq$] = { ag_is_star_killer_special_system = no }
			}
			custom_tooltip = {
				fail_text = "ag_requires_no_too_many_targets" 
				OR = {
					ag_system_selector_system_selected_trigger = { ag_system_seq = $ag_system_seq$ }
					root = { check_variable = { which = ag_num_system_selector_selected_systems value < 5 } }
				}
			}
		}
	}
}

ag_epsilon_star_killer_weapon_confirm = {
	optimize_memory
	OR = {
		custom_tooltip = { fail_text = "ag_using_epsilon_star_killer_weapon" root = { NOT = { has_country_flag = ag_enabled_epsilon_planet_killer_selector } } }
		AND = {
			resource_stockpile_compare = { resource = energy value >= 10000 mult = ag_num_system_selector_selected_systems }
			resource_stockpile_compare = { resource = sr_dark_matter value >= 1000 mult = ag_num_system_selector_selected_systems }
		}
	}
}

can_destroy_planet_with_ag_ancient_alpha_planet_killer_weapon = {
	optimize_memory
	custom_tooltip = { fail_text = "is_not_a_habitable_planet_or_megastructure" is_a_habitable_planet_megastructure = yes }
	custom_tooltip = {
		fail_text = "is_shielded"
		NOR = {
			is_planet_class = pc_shielded
			is_planet_class = pc_ringworld_shielded
			is_planet_class = pc_habitat_shielded
		}
	}
	custom_tooltip = {
		fail_text = "is_not_hostile"
		OR = {
			planet_is_hostile_or_crisis = yes
			AND = {
				exists = owner
				owner = { is_country_type = primitive }
				from.owner = { OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
				} }
			}
			AND = {
				exists = space_owner
				exists = owner
				owner = { is_primitive = yes }
				space_owner = { OR = {
					is_at_war_with = from.owner
					is_country_type = swarm
					is_country_type = extradimensional
					is_country_type = extradimensional_2
					is_country_type = extradimensional_3
					is_country_type = ai_empire
				} }
			}
		}
	}
	custom_tooltip = { fail_text = "is_unpopulated" OR = { num_pops > 0 is_planet_class = pc_infested } }
}
