
#################################################################################################
# New Research Project: (6) Create research project's extra requirements in scripted triggers.
#################################################################################################

ag_research_project_trigger = {
	optimize_memory
	custom_tooltip = {
		fail_text = "ag_research_project_trigger_fail_text"
		AND = {
			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_locate_ancient_system_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_locate_ancient_system_project_id }
					exists = event_target:ag_ancient_theta_shielded_world
					event_target:ag_ancient_theta_shielded_world = {
						exists = owner
						owner = { is_same_value = prevprev }
						exists = controller
						controller = { is_same_value = prevprev }
					}
					NOT = { ag_all_ancient_system_exists_or_known = yes }
					has_technology = tech_sensors_4
					OR = {
						has_country_flag = ag_locate_ancient_system_project_actived
						AND = {
							NOT = { has_country_flag = ag_locate_ancient_system_project_actived }
							resource_stockpile_compare = { resource = minor_artifacts value >= 5 }
						}
					}
				}
			}

			OR = {
				NOR = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_ship_hull_upgrade_project_id }
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_ship_bow_upgrade_project_id }
				}
				AND = {
					OR = {
						check_variable = { which = ag_research_$ag_research_number$_id value = @ag_ship_hull_upgrade_project_id }
						check_variable = { which = ag_research_$ag_research_number$_id value = @ag_ship_bow_upgrade_project_id }
					}
					resource_stockpile_compare = { resource = minor_artifacts value >= 1 }
					any_controlled_ship = {
						OR = {
							ag_is_ancient_ship_locked = yes
							ag_is_ancient_ship_unlocked = yes
						}
						exists = fleet
						fleet = { is_in_combat = no }
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_construction_sections_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_construction_sections_project_id }
					any_owned_megastructure = { ag_megashipyard_can_recv_construction_section = yes }
					any_planet_within_border = { has_planet_flag = ag_ancient_construction_section }
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_alpha_psionic_star_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_alpha_psionic_star_project_id }
					exists = event_target:ag_alpha_station_system_1_star
					has_technology = "tech_ag_adv_psionic_control"
					event_target:ag_alpha_station_system_1_star = { exists = space_owner space_owner = { is_same_value = prevprev } }
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_beta_psionic_source_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_beta_psionic_source_project_id }
					exists = event_target:ag_ancient_beta_shielded_world
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_beta_psionic_station_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_beta_psionic_station_project_id }
					any_owned_megastructure = { is_megastructure_type = ag_beta_station_type2_megastructure }
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_epsilon_first_building_unlock_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_epsilon_first_building_unlock_project_id }
					exists = event_target:ag_epsilon_first_ringworld
					event_target:ag_epsilon_first_ringworld = {
						exists = owner
						owner = { is_same_value = prevprev }
						OR = {
							has_building = ag_epsilon_outpost_0
							has_building = ag_epsilon_outpost_1
						}
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_eta_control_station_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_eta_control_station_project_id }
					exists = event_target:ag_ancient_eta_star
					event_target:ag_ancient_eta_star.solar_system = {
						exists = space_owner
						space_owner = { is_same_value = prevprev }
						OR = {
							any_system_ambient_object = {
								is_ambient_object_type = ag_eta_damaged_gateway_control_station
								has_ambient_object_flag = ag_eta_damaged_gateway_control_station
							}
							any_system_megastructure = { OR = {
								is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_3
								is_megastructure_type = ag_ancient_eta_gateway_control_damaged
								is_megastructure_type = ag_ancient_eta_gateway_control_restored
							} }
						}
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_eta_gateway_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_eta_gateway_project_id }
					OR = {
						any_owned_megastructure = { OR = {
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_0
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_1
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_2
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_3
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_4
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_5
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_burst
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_closed
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_closed_alt
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_damaged
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_damaged_alt
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_opening
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_opening_blue
							is_megastructure_type = ag_ancient_eta_gateway_megastructure_closing
						} }
						any_controlled_ship = { OR = {
							is_ship_size = ag_eta_gateway_0
							is_ship_size = ag_eta_gateway_1
						} }
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_disable_ancient_shield_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_disable_ancient_shield_project_id }
					exists = event_target:ag_primitive_shielded_moon
					event_target:ag_primitive_shielded_moon = {
						is_planet_class = pc_shielded
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_repair_starfish_ship_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_repair_starfish_ship_project_id }
					exists = event_target:ag_ancient_starfish_ship
					event_target:ag_ancient_starfish_ship = {
						exists = owner
						owner = { is_same_value = prevprev }
						is_in_combat = no
						has_ship_flag = ag_experiment_ship_damaged
					}
					OR = {
						has_country_flag = ag_repair_starfish_ship_project_actived
						resource_stockpile_compare = { resource = minor_artifacts value >= 30 }
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_repair_starlight_2_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_repair_starlight_2_project_id }
					exists = event_target:ag_starlight_2_ship
					event_target:ag_starlight_2_ship = {
						exists = owner
						owner = { is_same_value = prevprev }
						OR = {
							is_scope_type = leader
							AND = { is_scope_type = ship is_in_combat = no }
						}
					}
					NOT = { has_country_flag = ag_lost_ancient_ship_restored }
					resource_stockpile_compare = { resource = minor_artifacts value >= 30 }
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_reverse_engineering_wandering_ship_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_reverse_engineering_wandering_ship_project_id }
					any_controlled_ship = { has_ship_flag =  ag_ancient_wandering_ship_player is_in_combat = no }
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_reverse_engineering_anchor_station_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_reverse_engineering_anchor_station_project_id }
					has_global_flag = ag_ancient_wandering_ship_destroyed
					any_owned_megastructure = { OR = {
						is_megastructure_type = ag_ancient_anchor_station_0
						is_megastructure_type = ag_ancient_anchor_station_1
						is_megastructure_type = ag_ancient_anchor_station_2
						is_megastructure_type = ag_ancient_anchor_station_player
					} }
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_kag_annihilator_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_kag_annihilator_project_id }
					has_global_flag = install_kuat_mod
					any_system_within_border = {
						OR = {
							has_star_flag = Kuat_system
							has_star_flag = Kuat_system_1
							has_star_flag = Kuat_system_2
							has_star_flag = Kuat_system_3
						}
						any_system_planet = {
							NOT = { is_planet_class = pc_ringworld_habitable_damaged }
							OR = {
								has_planet_flag = kuat_system_ring_3
								has_planet_flag = kuat_system_ring_6
								has_planet_flag = kuat_system_ring_9
								has_planet_flag = kuat_system_ring_12
							}
						}
					}
				}
			}
			
		}
	}
}