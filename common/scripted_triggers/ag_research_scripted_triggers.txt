
#################################################################################################
# New Research Project: (6) Create research project's extra requirements in scripted triggers.
#################################################################################################

ag_research_project_trigger = {
	custom_tooltip = {
		fail_text = "ag_research_project_trigger_fail_text"
		AND = {
			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_locate_ancient_system_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_locate_ancient_system_project_id }
					exists = event_target:ag_ancient_theta_shielded_world
					event_target:ag_ancient_theta_shielded_world = {
						exists = owner
						owner = { is_same_value = prevprev }
						exists = controller
						controller = { is_same_value = prevprev }
					}
					NOT = { ag_all_ancient_system_exists_or_known = yes }
					has_technology = tech_sensors_4
					OR = {
						has_country_flag = ag_locate_ancient_system_project_actived
						AND = {
							NOT = { has_country_flag = ag_locate_ancient_system_project_actived }
							resource_stockpile_compare = { resource = minor_artifacts value >= 5 }
						}
					}
				}
			}

			OR = {
				NOR = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_ship_hull_upgrade_project_id }
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_ship_bow_upgrade_project_id }
				}
				AND = {
					OR = {
						check_variable = { which = ag_research_$ag_research_number$_id value = @ag_ship_hull_upgrade_project_id }
						check_variable = { which = ag_research_$ag_research_number$_id value = @ag_ship_bow_upgrade_project_id }
					}
					resource_stockpile_compare = { resource = minor_artifacts value >= 1 }
					any_owned_ship = {
						OR = {
							ag_is_ancient_ship_locked = yes
							ag_is_ancient_ship_unlocked = yes
						}
						exists = fleet
						fleet = { is_in_combat = no }
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_beta_ship_unlock_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_beta_ship_unlock_project_id }
					exists = event_target:ag_ancient_beta_shielded_world
					event_target:ag_ancient_beta_shielded_world = {
						exists = owner
						owner = { is_same_value = prevprev }
						has_building = ag_ancient_beta_archive
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_beta_psionic_source_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_beta_psionic_source_project_id }
					exists = event_target:ag_ancient_beta_shielded_world
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_gamma_ship_unlock_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_gamma_ship_unlock_project_id }
					exists = event_target:ag_ancient_gamma_shielded_world
					event_target:ag_ancient_gamma_shielded_world = {
						exists = owner
						owner = { is_same_value = prevprev }
						has_building = ag_ancient_gamma_nexus_1
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_delta_ship_unlock_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_delta_ship_unlock_project_id }
					exists = event_target:ag_ancient_delta_shielded_world
					event_target:ag_ancient_delta_shielded_world = {
						exists = owner
						owner = { is_same_value = prevprev }
						has_building = ag_ancient_delta_archive
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_epsilon_first_building_unlock_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_epsilon_first_building_unlock_project_id }
					exists = event_target:ag_epsilon_first_ringworld
					event_target:ag_epsilon_first_ringworld = {
						exists = owner
						owner = { is_same_value = prevprev }
						OR = {
							has_building = ag_epsilon_outpost_0
							has_building = ag_epsilon_outpost_1
						}
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_epsilon_ship_unlock_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_epsilon_ship_unlock_project_id }
					OR = {
						AND = {
							exists = event_target:ag_ancient_epsilon_shielded_world
							event_target:ag_ancient_epsilon_shielded_world = {
								exists = owner
								owner = { is_same_value = prevprev }
								has_building = ag_epsilon_outpost_1
							}
						}
						AND = {
							exists = event_target:ag_ancient_epsilon_shielded_world_2
							event_target:ag_ancient_epsilon_shielded_world_2 = {
								exists = owner
								owner = { is_same_value = prevprev }
								has_building = ag_epsilon_outpost_1
							}
						}
						AND = {
							exists = event_target:ag_ancient_epsilon_shielded_world_3
							event_target:ag_ancient_epsilon_shielded_world_3 = {
								exists = owner
								owner = { is_same_value = prevprev }
								has_building = ag_epsilon_outpost_1
							}
						}
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_disable_ancient_shield_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_disable_ancient_shield_project_id }
					exists = event_target:ag_primitive_shielded_moon
					event_target:ag_primitive_shielded_moon = {
						is_planet_class = pc_shielded
					}
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_repair_starfish_ship_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_repair_starfish_ship_project_id }
					exists = event_target:ag_ancient_starfish_ship
					event_target:ag_ancient_starfish_ship = {
						exists = owner
						owner = { is_same_value = prevprev }
						is_in_combat = no
						has_ship_flag = ag_experiment_ship_damaged
					}
					resource_stockpile_compare = { resource = minor_artifacts value >= 30 }
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_repair_starlight_2_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_repair_starlight_2_project_id }
					exists = event_target:ag_starlight_2_ship
					event_target:ag_starlight_2_ship = {
						exists = owner
						owner = { is_same_value = prevprev }
						is_in_combat = no
					}
					NOT = { has_country_flag = ag_lost_ancient_ship_restored }
					resource_stockpile_compare = { resource = minor_artifacts value >= 30 }
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_reverse_engineering_wandering_ship_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_reverse_engineering_wandering_ship_project_id }
					any_owned_ship = { has_ship_flag =  ag_ancient_wandering_ship_player is_in_combat = no }
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_wandering_ship_unlock_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_wandering_ship_unlock_project_id }
					any_owned_ship = { has_ship_flag =  ag_ancient_wandering_ship_player is_in_combat = no }
				}
			}

			OR = {
				NOT = { check_variable = { which = ag_research_$ag_research_number$_id value = @ag_kag_annihilator_project_id } }
				AND = {
					check_variable = { which = ag_research_$ag_research_number$_id value = @ag_kag_annihilator_project_id }
					has_global_flag = install_kuat_mod
					any_system_within_border = {
						OR = {
							has_star_flag = Kuat_system
							has_star_flag = Kuat_system_1
							has_star_flag = Kuat_system_2
							has_star_flag = Kuat_system_3
						}
						any_system_planet = {
							NOT = { is_planet_class = pc_ringworld_habitable_damaged }
							OR = {
								has_planet_flag = kuat_system_ring_3
								has_planet_flag = kuat_system_ring_6
								has_planet_flag = kuat_system_ring_9
								has_planet_flag = kuat_system_ring_12
							}
						}
					}
				}
			}
			
		}
	}
}