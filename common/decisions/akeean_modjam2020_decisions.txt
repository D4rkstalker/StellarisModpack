######################################################
#                                                     
#              akeean's Shielded Origin   
#              Contributors: akeean                 
######################################################

# Shield the Homeworld
decision_akeean_enable_shield = {
	owned_planets_only = yes
	sound = dyson_sphere_bass_hum_partial
	icon = decision_planet_beam

	# enactment_time = 15 # Enabling should be quick, disabling will take a month

	resources = {
		category = decisions
		cost = {
			energy = 2000
		}
	}

	potential = {
		any_moon = {
					has_planet_flag = akeean_planetary_shielding_device
					NOT = { is_planet_class = pc_shattered }
					NOT = { is_planet_class = pc_shielded }
					is_controlled_by = FROM
		}
	}

	allow = {
		has_modifier = akeean_shield_inactive
		any_moon = {
					has_planet_flag = akeean_planetary_shielding_device
					is_controlled_by = FROM
		}
	}


	effect = {
			remove_modifier = akeean_shield_inactive
			remove_planet_flag = akeean_shield_inactive
			add_modifier = { modifier = "akeean_shield_active" days = -1 }
			set_planet_flag = akeean_shield_active
			set_planet_entity = { entity = "shielded_planet_01_entity" }
	}

	ai_weight = {
		weight = 10
		modifier = {
			factor = 0.1
			has_orbital_bombardment = no
		}
		modifier = {
			factor = 5
			solar_system = { any_fleet_in_system = { owner = { is_hostile = root.owner } } }
		}
		modifier = {
			factor = 2
			CONTROLLER = { 
				has_monthly_income = {
					resource = energy
					value > 300
				}
			}
		}
		modifier = {
			factor = 0.1
			CONTROLLER = { 
				has_monthly_income = {
					resource = energy
					value < 20
				}
			}
		}
		modifier = {
			factor = 4
			CONTROLLER = { has_deficit = food }
		}
		modifier = {
			factor = 100
			has_orbital_bombardment = yes
		}
	}
}


# UnShield the Homeworld
decision_akeean_disable_shield = {
	owned_planets_only = yes
	sound = dyson_sphere_bass_hum_partial
	icon = decision_planet_beam

	enactment_time = 30 # Enabling should be quick, disabling will take a month

	resources = {
		category = decisions
		cost = {
			influence = 50
		}
	}

	potential = {
		any_moon = {
					has_planet_flag = akeean_planetary_shielding_device
					NOT = { is_planet_class = pc_shattered }
					NOT = { is_planet_class = pc_shielded }
					is_controlled_by = FROM
		}
	}

	allow = {
		has_modifier = akeean_shield_active
		any_moon = {
					has_planet_flag = akeean_planetary_shielding_device
					is_controlled_by = FROM
		}
	}

	effect = {
			set_planet_entity = { entity = "relic_world_01_entity" }
			remove_modifier = akeean_shield_active
			remove_planet_flag = akeean_shield_active
			add_modifier = { modifier = "akeean_shield_inactive" days = -1 }
			set_planet_flag = akeean_shield_inactive
			owner = {
				add_modifier = { modifier = "akeean_shield_reactor_refund" days = 300 }
			}
	}


	ai_weight = {
		weight = 10
		modifier = {
			factor = 5
			CONTROLLER = { has_deficit = energy }
		}
		modifier = {
			factor = 0.1
			NOT = { solar_system = { any_fleet_in_system = { owner = { is_hostile = root.owner } } } }
		}
		modifier = {
			factor = 0
			has_modifier = akeean_shield_reactor_refund
		}
		modifier = {
			factor = 0
			has_orbital_bombardment = yes
		}
	}
}


# Add Veil seed to a moon in order to shield the planet that it is orbting
decision_akeean_shield_seed = {
	owned_planets_only = yes
	sound = dyson_sphere_bass_hum_partial
	icon = decision_planet_beam

	 # enactment_time = 60

	resources = {
		category = decisions
		cost = {
			minerals = 1000
		}
	}

	potential = {
			owner = {
				has_country_flag = akeean_shielded
			}
				is_planet_class = pc_habitat
				NOT = { has_planet_flag = akeean_planetary_shielding_device }
				is_controlled_by = FROM
	}

	allow = {
		# has_technology = akeean_shield_seed
		# or just check an empire flag instead
	}


	effect = {
				custom_tooltip = decision_akeean_shield_seed_long
				set_planet_flag = akeean_planetary_shielding_device
	}

	ai_weight = {
		weight = 10
	}
}

# Planet with shield habitat: charge the device (sets required flag to enable the raising)
decision_akeean_enable_shield_control = {
	owned_planets_only = yes
	sound = dyson_sphere_bass_hum_partial
	icon = decision_planet_beam

	# enactment_time = 15 # Enabling should be quick, disabling will take a month

	resources = {
		category = decisions
		cost = {
			energy = 1000
		}
	}

	potential = {
		this = {	NOT = { has_planet_flag = akeean_planetary_shield_controller }
					NOT = { has_planet_flag = akeean_shielded_homeworld }
					NOT = { has_planet_flag = akeean_shield_active }
					NOT = { has_planet_flag = akeean_shield_inactive }
		}
		owner = {
			has_country_flag = akeean_shielded
		}
		any_moon = {
					has_planet_flag = akeean_planetary_shielding_device
					NOT = { is_planet_class = pc_shattered }
					NOT = { is_planet_class = pc_shielded }
					is_controlled_by = FROM
		}
	}

	allow = {
		any_moon = {
					has_planet_flag = akeean_planetary_shielding_device
					is_controlled_by = FROM
		}
	}

	effect = {
			add_modifier = { modifier = "akeean_shield_active" days = -1 }
			set_planet_flag = akeean_shield_active
			set_planet_flag = akeean_planetary_shield_controller
			set_planet_entity = { entity = "shielded_planet_01_entity" }
	}

	ai_weight = {
		weight = 10
		modifier = {
			factor = 0.1
			has_orbital_bombardment = no
		}
		modifier = {
			factor = 2
			solar_system = { any_fleet_in_system = { owner = { is_hostile = root.owner } } }
		}
		modifier = {
			factor = 2
			CONTROLLER = { 
				has_monthly_income = {
					resource = energy
					value > 300
				}
			}
		}
		modifier = {
			factor = 0.2
			CONTROLLER = { 
				has_monthly_income = {
					resource = energy
					value < 300
				}
			}
		}
		modifier = {
			factor = 0.2
			CONTROLLER = { has_deficit = energy }
		}
		modifier = {
			factor = 5
			CONTROLLER = { has_deficit = food }
		}
		modifier = {
			factor = 40
			has_orbital_bombardment = yes
		}
	}
}