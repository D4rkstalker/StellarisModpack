
decision_ag_theta_restore_weather_system = {
	owned_planets_only = yes
	icon = decision_resort_colony
	
	enactment_time = 1800
	
	resources = {
		category = decisions
		cost = {
			energy = 10000
			alloys = 2500
		}
	}
	
	potential = {
		has_planet_flag = ag_theta_111_fired
		is_planet_class = pc_ag_ringworld_machine
	}
	
	allow = {
		owner = {
			OR = {
				has_technology = "tech_sapient_ai"
				has_technology = "tech_positronic_implants"
			}
			has_technology = "tech_terrestrial_sculpting"
			has_technology = "tech_ecological_adaptation"
			has_technology = "tech_ring_world"
		}
	}
	
	effect = {
		custom_tooltip = decision_ag_theta_restore_weather_system_custom
		hidden_effect = {
			event_target:ag_ancient_theta_shielded_world = {
				if = {
					limit = { exists = owner }
					remove_modifier = "ag_ancient_theta_ringworld_debuff"
					remove_modifier = "ag_theta_protection"
					if = {
						limit = { has_planet_flag = ag_theta_unstable_weather_flag }
						remove_planet_flag = ag_theta_unstable_weather_flag
					}
					ag_change_pc = { ag_planet_class = pc_ag_ringworld_gaia }
					ag_set_ancient_ringworld = {
						ag_picture = pc_ringworld
						ag_color = red
						ag_type = habitable
						ag_surface_type = gaia
					}
					owner = { country_event = { id = ag_theta.133 } }
				}
			}
		}
	}
	
	ai_weight = { weight = 1000 }
}

decision_ag_theta_protection = {
	owned_planets_only = yes
	icon = decision_drilling_for_gas
	sound = event_air_raid_siren

	resources = {
		category = decisions
		cost = { energy = 1000 }
		cost = {
			trigger = { owner = { is_gestalt = no } }
			consumer_goods = 100
			multiplier = trigger:num_pops
		}
		cost = {
			trigger = { owner = { is_gestalt = yes } }
			alloys = 50
			multiplier = trigger:num_pops
		}
	}
	
	potential = {
		has_planet_flag = ag_theta_111_fired
		has_modifier = "ag_ancient_theta_ringworld_debuff"
		NOT = {
			has_modifier = "ag_theta_protection"
		}
	}
	
	effect = {
		custom_tooltip = decision_ag_theta_protection_custom
		hidden_effect = {
			add_modifier = {
				modifier = "ag_theta_protection"
				days = -1
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}
decision_ag_theta_protection_cancel = {
	owned_planets_only = yes
	sound = event_air_raid_siren

	resources = {
		category = decisions
		cost = {
			influence = 75
		}
	}
	
	potential = {
		has_planet_flag = ag_theta_111_fired
		has_modifier = "ag_ancient_theta_ringworld_debuff"
		has_modifier = "ag_theta_protection"
	}
	
	effect = {
		custom_tooltip = decision_ag_theta_protection_cancel_custom
		hidden_effect = {
			remove_modifier = "ag_theta_protection"
		}
	}
	
	ai_weight = {
		weight = 1
	}
}

decision_ag_create_starfish_battleship = {
	owned_planets_only = yes
	enactment_time = 750
	resources = {
		category = decisions
		cost = { influence = 50 }
	}
	prerequisites = { "tech_ag_starfish_battleship" }
	potential = { hidden_trigger = { NOT = { has_planet_flag = ag_cancel_starfish_battleship_construction } } }
	allow = { hidden_trigger = { NOT = { has_planet_flag = ag_cancel_starfish_battleship_construction } } }
	abort_trigger = { hidden_trigger = { has_planet_flag = ag_cancel_starfish_battleship_construction } }
	abort_effect = { hidden_effect = {
		if = {
			limit = { has_planet_flag = ag_theta_starfish_battleship_settings_opened }
			remove_planet_flag = ag_theta_starfish_battleship_settings_opened
			remove_planet_flag = ag_create_starfish_battleship_@this
		}
		if = { limit = { has_planet_flag = ag_create_starfish_battleship_on_progress } remove_planet_flag = ag_create_starfish_battleship_on_progress }
	} }
	on_queued = { hidden_effect = {
		if = {
			limit = { NOT = { has_planet_flag = ag_theta_starfish_battleship_settings_opened } }
			set_planet_flag = ag_theta_starfish_battleship_settings_opened
			set_planet_flag = ag_create_starfish_battleship_@this
		}
		if = { limit = { NOT = { has_planet_flag = ag_create_starfish_battleship_on_progress } } set_planet_flag = ag_create_starfish_battleship_on_progress }
		planet_event = { id = ag_theta.400 }
	} }
	on_unqueued = { hidden_effect = {
		if = {
			limit = { has_planet_flag = ag_theta_starfish_battleship_settings_opened }
			remove_planet_flag = ag_theta_starfish_battleship_settings_opened
			remove_planet_flag = ag_create_starfish_battleship_@this
		}
		if = { limit = { has_planet_flag = ag_create_starfish_battleship_on_progress } remove_planet_flag = ag_create_starfish_battleship_on_progress }
	} }
	effect = {
		custom_tooltip = "decision_ag_create_starfish_battleship_effect"
		hidden_effect = {
			if = { limit = { has_planet_flag = ag_create_starfish_battleship_on_progress } remove_planet_flag = ag_create_starfish_battleship_on_progress }
			if = {
				limit = { is_variable_set = ag_num_theta_starfish_battleships check_variable = { which = ag_num_theta_starfish_battleships value > 0 } }
				create_fleet = {
					name = "NAME_ag_ancient_primitive_country_fleet"
					settings = { spawn_debris = no }
					effect = {
						set_owner = root.owner
						while = {
							count = root.ag_num_theta_starfish_battleships
							if = {
								limit = { root = { any_owned_pop = { has_trait = ag_trait_very_delicious } } }
								create_ship = {
									name = "NAME_ag_ancient_primitive_country_ship"
									design = "NAME_ag_experiment_ship_hostile"
									prefix = no
									effect = { ag_difficulty_bonus = yes }
								}
								root = {
									random_list = {
										50 = {
											modifier = { add = 50 owner = { has_ethic = ethic_fanatic_xenophile } }
											modifier = { add = 25 owner = { has_ethic = ethic_xenophile } }
											modifier = { add = 20 owner = { has_ethic = ethic_fanatic_materialist } }
											modifier = { add = 10 owner = { has_ethic = ethic_materialist } }
											modifier = { add = 20 owner = { has_ethic = ethic_fanatic_egalitarian } }
											modifier = { add = 10 owner = { has_ethic = ethic_egalitarian } }
											modifier = { factor = 2 owner = { has_country_flag = ag_ship_subsystem_enabled_801_37 } }
											modifier = { factor = 0 owner = { OR = {
												has_valid_civic = civic_fanatic_purifiers
												has_valid_civic = civic_hive_devouring_swarm
												has_valid_civic = civic_fanatic_purifiers
											} } }
										}
										100 = {
											modifier = { add = 100 owner = { has_ethic = ethic_fanatic_xenophobe } }
											modifier = { add = 50 owner = { has_ethic = ethic_xenophobe } }
											modifier = { add = 50 owner = { has_ethic = ethic_fanatic_militarist } }
											modifier = { add = 25 owner = { has_ethic = ethic_militarist } }
											modifier = { factor = 0.8 owner = { has_ascension_perk = ap_engineered_evolution } }
											modifier = { factor = 0.8 owner = { has_ascension_perk = ap_evolutionary_mastery } }
											modifier = { factor = 2 owner = { has_ascension_perk = ap_become_the_crisis } }
											random_owned_pop = { limit = { has_trait = ag_trait_very_delicious } kill_pop = yes }
											every_playable_country = {
												limit = { has_communications = root.owner }
												add_opinion_modifier = { modifier = ag_opinion_purged_starfish who = root.owner }
											}
										}
									}
									reroll_random = yes
								}
							}
							else = { owner = {
								if = {
									limit = { NOT = { has_country_flag = ag_starfish_battleship_noti_@root } }
									set_timed_country_flag = { flag = ag_starfish_battleship_noti_@root days = 2 }
									create_message = {
										type = message_ag_build_order_failed
										localization = message_ag_build_order_failed_desc
										days = 20
										target = prev
										variable = { type = name localization = ag_planet scope = root }
									}
								}
							} }
						}
						set_location = { target = prev distance = 45 angle = random }
						set_variable = { which = ag_num_theta_starfish_battleships value = trigger:num_ships }
						owner = { create_message = {
							type = CONSTRUCTION_MESSAGE_TYPE
							localization = message_ag_starfish_battleship_construction_completed_desc
							days = 20
							target = prev
							variable = { type = name localization = ag_planet scope = root }
							variable = { type = variable varname = prev.ag_num_theta_starfish_battleships localization = "ag_num_starfish_battleships" scope = prev }
						} }
					}
				}
				clear_variable = ag_num_theta_starfish_battleships
			}
		}
	}
	ai_weight = { weight = 0 }
}
