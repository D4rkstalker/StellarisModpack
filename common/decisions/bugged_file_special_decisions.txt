##########################################################################
# Decisions
##########################################################################
decision_lithoid_swarm_consume_world = {
	icon = decision_burning_settlement
	sound = event_structural_collapse

	enactment_time = 360
	resources = {
		category = decisions
	}
	owned_planets_only = yes

	potential = {
		owner = {
			has_valid_civic = civic_hive_terravore
		}
		can_have_habitable_deposits = yes
		is_capital = no
	}

	allow = {
		num_free_districts = { type = any value > 0 }
	}

	effect = {
		custom_tooltip = decision_lithoid_swarm_consume_world_effect_desc

		if = {
			limit = { num_districts = { type = any value > 0 } }
			custom_tooltip = decision_lithoid_swarm_consume_world_destroy_district_desc

			hidden_effect = {
				random_list = {
					1 = {
						modifier = {
							factor = 0
							num_districts = { type = district_hive value = 0 }
						}
						remove_district = district_hive
					}
					1 = {
						modifier = {
							factor = 0
							num_districts = { type = district_generator value = 0 }
						}
						remove_district = district_generator
					}
					1 = {
						modifier = {
							factor = 0
							num_districts = { type = district_mining value = 0 }
						}
						remove_district = district_mining
					}
					3 = {
						modifier = {
							factor = 0
							num_districts = { type = district_farming value = 0 }
						}
						remove_district = district_farming
					}
				}
			}
		}

		hidden_effect = {
			random_list = {
				10 = {
					modifier = {
						factor = 0
						num_free_districts = { type = any value < 2 }
					}
					add_deposit = d_lithoid_devastation
					add_deposit = d_lithoid_devastation
					create_pop = {
						species = owner_main_species
					}
					add_planet_devastation = 20

					if = {
						limit = { owner = { is_ai = yes } }
						random_pop = {
							resettle_pop = {
								pop = this
								planet = owner.capital_scope
							}
						}
					}

					create_message = {
						type = MESSAGE_TERRAVORE_CONSUME_WORLD
						localization = MESSAGE_TERRAVORE_CONSUME_WORLD_POP_TEXT
						days = 30
						target = this

						variable = {
							type = name
							localization = PLANET
							scope = this
						}
					}
				}
				10 = {
					modifier = {
						factor = 0
						num_free_districts = { type = any value < 2 }
					}
					add_deposit = d_lithoid_devastation
					add_deposit = d_lithoid_devastation
					owner = {
						add_monthly_resource_mult = {
							resource = minerals
							value = 5
							min = @tier1materialmin
							max = @tier1materialmax
						}
					}
					add_planet_devastation = 20

					create_message = {
						type = MESSAGE_TERRAVORE_CONSUME_WORLD
						localization = MESSAGE_TERRAVORE_CONSUME_WORLD_MINERALS_TEXT
						days = 30
						target = this

						variable = {
							type = name
							localization = PLANET
							scope = this
						}
					}
				}
				10 = {
					modifier = {
						factor = 0
						num_free_districts = { type = any value < 2 }
					}
					add_deposit = d_lithoid_devastation
					add_deposit = d_lithoid_devastation
					owner = {
						add_monthly_resource_mult = {
							resource = alloys
							value = 3
							min = @tier1materialmin
							max = @tier1materialmax
						}
					}
					add_planet_devastation = 20

					create_message = {
						type = MESSAGE_TERRAVORE_CONSUME_WORLD
						localization = MESSAGE_TERRAVORE_CONSUME_WORLD_ALLOYS_TEXT
						days = 30
						target = this

						variable = {
							type = name
							localization = PLANET
							scope = this
						}
					}
				}
				10 = {
					# There's only one district slot left on the planet
					modifier = {
						factor = 0
						num_free_districts = { type = any value >= 2 }
					}
					add_deposit = d_lithoid_devastation
					owner = {
						add_monthly_resource_mult = {
							resource = minerals
							value = 3
							min = @tier1materialmin
							max = @tier1materialmax
						}
					}
					add_planet_devastation = 10

					create_message = {
						type = MESSAGE_TERRAVORE_CONSUME_WORLD
						localization = MESSAGE_TERRAVORE_CONSUME_WORLD_MINERALS_TEXT
						days = 30
						target = this

						variable = {
							type = name
							localization = PLANET
							scope = this
						}
					}
				}
			}

			# If I'm an AI, abandon the planet if we've finished consuming the planet
			if = {
				limit = { owner = { is_ai = yes } }
				owner = { country_event = { id = colony.185 days = 1 } }
			}
		}
	}

	ai_weight = {
		weight = 5

		# don't wreck worlds you want to keep
		modifier = {
			factor = 0
			is_lithoid_devouring_swarm_consumption_world = no
		}
	}
}


#Cure the Planet
decision_planet_voice = {
	owned_planets_only = yes

	enactment_time = 360

	resources = {
		category = decisions
		cost = {
			unity = 200
		}
	}

	potential = {
		owner = { is_regular_empire = yes }
		owner = { OR = { has_valid_civic = civic_keepers_of_harmony has_valid_civic = civic_keepers_of_harmony_corpo } }
	}


	effect = {
		custom_tooltip = edict_voice_planet_1.tooltip
		planet_event = { id = voice_planet.1 }
		}

		ai_weight = {
		weight = 1
		modifier = {
			factor = 0
			NOR = {
			has_modifier = "dangerous_wildlife"
			has_modifier = "bleak_planet"
			has_modifier = "wild_storms"
			has_modifier = "hazardous_weather"
			has_modifier = "damaged_ecology"
			has_modifier = "wasteland_radiation"
			has_modifier = "irradiated_planet"
			}
		}
	}
}




#Environmental Restoration
decision_environment_fix = {
	owned_planets_only = yes

	enactment_time = 360

	resources = {
		category = decisions
		cost = {
			energy = 400
		}
	}

	potential = {
		owner = { is_regular_empire = yes }
		owner = {
			OR = {
				has_valid_civic = civic_environmental_engineers
				has_valid_civic = civic_environmental_engineers_corpo
			}
		}
	}


	effect = {
		custom_tooltip = edict_voice_planet_2.tooltip
		planet_event = { id = voice_planet.2 }
		}

		ai_weight = {
		weight = 1
		modifier = {
			factor = 0
			NOR = {
			has_modifier = "unstable_tectonics"
			has_modifier = "weak_magnetic_field"
			has_modifier = "tidal_locked"
			has_modifier = "irradiated_planet"
			has_modifier = "damaged_ecology"
			has_modifier = "wasteland_radiation"
			has_modifier = "abandoned_terraforming"
			}
		}
	}
}





# Market Candidate Nomination
decision_market_nomination = {
	owned_planets_only = yes

	# instant

	resources = {
		category = decisions

        cost = {
		   	trigger = {
				owner = { not = { has_valid_civic = civic_globalism has_valid_civic = civic_globalism_corpo } }
			}
			energy = 1000
			influence = 150
		}
        cost = {
		   	trigger = {
				owner = { has_valid_civic = civic_globalism has_valid_civic = civic_globalism_corpo }
			}
			energy = 1000
			influence = 50
		}
	}

	potential = {
		has_global_flag = ongoing_market_nomination
		#from = { has_communications = event_target:50percentcomms } # should include self
		from = { has_country_flag = market_nomination_eligible }
	}

	allow = {
		num_pops > 20
		custom_tooltip = {
			fail_text = already_market_nominated
			from = {
				NOT = {
					any_owned_planet = {
						OR = {
							has_modifier = market_nominee_level_1
							has_modifier = market_nominee_level_2
							has_modifier = market_nominee_level_3
							has_modifier = market_nominee_level_4 # boosted once
							has_modifier = market_nominee_level_5 # boosted twice
						}
					}
				}
			}
		}
	}

	effect = {
		custom_tooltip = decision_market_nomination_effects
		hidden_effect = {
			from = {
				set_variable = {
					which = market_rating
					value = 0
				}
			}
			random_list = {
				9 = {
					add_modifier = {
						modifier = market_nominee_level_1
						days = -1
					}
					from = {
						change_variable = {
							which = market_rating
							value = 1
						}
					}
					modifier = {
						factor = 0.33
						from = { has_authority = auth_corporate }
					}
					modifier = {
						factor = 0.33
						from = { has_valid_civic = civic_globalism has_valid_civic = civic_globalism_corpo }
					}
					modifier = {
						factor = 0.33
						from = { trade_income >= 100 }
					}
					modifier = {
						factor = 2
						from = { trade_income <= 50 }
					}
					modifier = {
						factor = 1.5
						from = { has_ethic = ethic_gestalt_consciousness }
					}
				}
				6 = {
					add_modifier = {
						modifier = market_nominee_level_2
						days = -1
					}
					from = {
						change_variable = {
							which = market_rating
							value = 2
						}
					}
				}
				1 = {
					modifier = {
						factor = 200
						is_planet_class = pc_city
					}
					modifier = {
						factor = 9
						from = { has_authority = auth_corporate }
					}
					modifier = {
						factor = 2
						from = { trade_income >= 120 }
					}
					modifier = {
						factor = 0.5
						from = { trade_income <= 50 }
					}
					modifier = {
						factor = 9
						from = { has_valid_civic = civic_globalism has_valid_civic = civic_globalism_corpo }
					}
					modifier = {
						factor = 0.75
						from = { has_ethic = ethic_gestalt_consciousness }
					}
					add_modifier = {
						modifier = market_nominee_level_3
						days = -1
					}

					from = {
						change_variable = {
							which = market_rating
							value = 3
						}
					}
				}
			}
		}
	}

	ai_weight = {
		weight = 10
		modifier = {
			factor = 0
			num_pops < 20
		}
		modifier = {
			factor = 1.5
			from = {
				resource_stockpile_compare = {
					resource = energy
					value > 12000
				}
				resource_stockpile_compare = {
					resource = influence
					value > 400
				}
			}
		}
		modifier = {
			factor = 0.8
			from = { is_xenophobe = yes }
		}
		modifier = {
			factor = 2
			from = { has_authority = auth_corporate }
		}
		modifier = {
			factor = 2
			from = { has_valid_civic = civic_globalism has_valid_civic = civic_globalism_corpo }
		}
	}
}

decision_boost_market_nomination = {
	owned_planets_only = yes
	resources = {
		category = decisions

        cost = {
		   	trigger = {
				owner = { not = { has_valid_civic = civic_globalism has_valid_civic = civic_globalism_corpo } }
			}
			energy = 2000
			influence = 300
		}
        cost = {
		   	trigger = {
				owner = { has_valid_civic = civic_globalism has_valid_civic = civic_globalism_corpo }
			}
			energy = 2000
			influence = 100
		}
	}

	potential = {
		has_global_flag = ongoing_market_nomination
		#from = { has_communications = event_target:50percentcomms } # should include self
		from = { has_country_flag = market_nomination_eligible }
		OR = {
			has_modifier = market_nominee_level_1
			has_modifier = market_nominee_level_2
			has_modifier = market_nominee_level_3
			has_modifier = market_nominee_level_4 # maxed out and boosted once
			has_modifier = market_nominee_level_5 # maxed out and boosted twice
		}
	}

	allow = {
		custom_tooltip = {
			fail_text = max_boosted
			NOT = { has_planet_flag = boosted_twice }
		}
	}

	effect = {
		custom_tooltip = decision_boost_market_nomination_effects
		hidden_effect = {
			# boost counter
			if = {
				limit = { has_planet_flag = boosted_once }
				set_planet_flag = boosted_twice
			}
			else = {
				set_planet_flag = boosted_once
			}
			# boost rating
			if = {
				limit = { has_modifier = market_nominee_level_1 }
				remove_modifier = market_nominee_level_1
				add_modifier = {
					modifier = market_nominee_level_2
					days = -1
				}
			}
			else_if = {
				limit = { has_modifier = market_nominee_level_2 }
				remove_modifier = market_nominee_level_2
				add_modifier = {
					modifier = market_nominee_level_3
					days = -1
				}
			}
			else_if = {
				limit = { has_modifier = market_nominee_level_3 }
				remove_modifier = market_nominee_level_3
				add_modifier = {
					modifier = market_nominee_level_4
					days = -1
				}
			}
			else_if = {
				limit = { has_modifier = market_nominee_level_4 }
				remove_modifier = market_nominee_level_4
				add_modifier = {
					modifier = market_nominee_level_5
					days = -1
				}
			}
			from = {
				change_variable = {
					which = market_rating
					value = 1
				}
			}
		}
	}

	ai_weight = {
		weight = 10
		modifier = {
			factor = 0
			num_pops < 20
		}
		modifier = {
			factor = 1.5
			from = {
				resource_stockpile_compare = {
					resource = energy
					value > 11000
				}
				resource_stockpile_compare = {
					resource = influence
					value > 350
				}
			}
		}
		modifier = {
			factor = 0.8
			from = { is_xenophobe = yes }
		}
		modifier = {
			factor = 2
			from = { has_authority = auth_corporate }
		}
		modifier = {
			factor = 2
			from = { has_valid_civic = civic_globalism has_valid_civic = civic_globalism_corpo }
		}
	}
}

decision_terravore_final = {
	icon = decision_burning_settlement
	sound = event_structural_collapse

	enactment_time = 360
	resources = {
		category = decisions
		cost = {
			influence = 100
		}
	}
	owned_planets_only = yes

	potential = {
		owner = {
			has_valid_civic = civic_hive_terravore
		}
		can_have_habitable_deposits = yes
		is_capital = no
		num_free_districts = { type = any value <= 0 }
		num_districts = { type = district_farming value = 0 }
		num_districts = { type = district_mining value = 0 }
		num_districts = { type = district_generator value = 0 }
		num_districts = { type = district_hive value = 0 }
	}

	allow = {
		num_free_districts = { type = any value <= 0 }
	}

	effect = {
		custom_tooltip = decision_terravore_final_1.tooltip
		hidden_effect = {
			planet_event = { id = terravore_final.1 }
		}
		owner = {
			add_resource = {
				minerals = @bugged_planet_size
			}
		}
	}
	ai_weight = {
		weight = 5

		# don't wreck worlds you want to keep
		modifier = {
			factor = 0
			is_lithoid_devouring_swarm_consumption_world = no
		}
	}
}

decision_symbiotic_relations = {
	icon = decision_unity_symbol
	sound = event_factions_01

	enactment_time = 360
	resources = {
		category = decisions
	}
	owned_planets_only = yes

	potential = {
		owner = {
			has_valid_civic = civic_hive_symbiotic_relations
		}
		can_have_habitable_deposits = yes
		NOT = {
			has_planet_flag = decision_symbiotic_relations_true
		}
	}

	allow = {
		num_free_districts = { type = any value > 0 }
		num_pops >= 20
		NOT = {
			has_planet_flag = decision_symbiotic_relations_true
		}
	}

	effect = {
		custom_tooltip = decision_symbiotic_relations_1.tooltip
		hidden_effect = {
			planet_event = { id = symbiotic_relations.1 }
			set_planet_flag = decision_symbiotic_relations_true
		}
	}
	ai_weight = {
		weight = 1000
	}
}

decision_symbiotic_relations_remove = {
	icon = decision_unity_symbol
	sound = event_factions_01

	enactment_time = 360
	resources = {
		category = decisions
	}
	owned_planets_only = yes

	potential = {
		owner = {
			has_valid_civic = civic_hive_symbiotic_relations
		}
		can_have_habitable_deposits = yes
		has_planet_flag = decision_symbiotic_relations_true

	}

	allow = {
		num_pops >= 20
		has_planet_flag = decision_symbiotic_relations_true
	}

	effect = {
		custom_tooltip = decision_symbiotic_relations_2.tooltip
		hidden_effect = {
			planet_event = { id = symbiotic_relations.2 }
			remove_planet_flag = decision_symbiotic_relations_true
		}
	}
	ai_weight = {
		weight = 0
	}
}

decision_stripmine_final = {
	icon = decision_burning_settlement
	sound = event_structural_collapse

	enactment_time = 360
	resources = {
		category = decisions
		cost = {
			influence = 100
		}
	}
	owned_planets_only = yes

	potential = {
		owner = {
			has_valid_civic = civic_machine_stripmine
		}
		can_have_habitable_deposits = yes
		is_capital = no
		num_free_districts = { type = any value <= 0 }
		num_districts = { type = district_farming value = 0 }
		num_districts = { type = district_mining value = 0 }
		num_districts = { type = district_generator value = 0 }
		num_districts = { type = district_hive value = 0 }
	}

	allow = {
		num_free_districts = { type = any value <= 0 }
	}

	effect = {
		custom_tooltip = decision_stripmine_final_1.tooltip
		hidden_effect = {
			planet_event = { id = terravore_final.1 }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = minerals
				value = 5
				min = @tier1materialmin
				max = @tier5materialmax
			}
		}
	}
	ai_weight = {
		weight = 5

		# don't wreck worlds you want to keep
		modifier = {
			factor = 0
			is_lithoid_devouring_swarm_consumption_world = no
		}
	}
}

decision_stripmining_machines_mine_world = {
	icon = decision_burning_settlement
	sound = event_structural_collapse

	enactment_time = 360
	resources = {
		category = decisions
	}
	owned_planets_only = yes

	potential = {
		owner = {
			has_valid_civic = civic_machine_stripmine
		}
		can_have_habitable_deposits = yes
		is_capital = no
	}

	allow = {
		num_free_districts = { type = any value > 0 }
	}

	effect = {
		custom_tooltip = decision_lithoid_swarm_consume_world_effect_desc

		if = {
			limit = { num_districts = { type = any value > 0 } }
			custom_tooltip = decision_lithoid_swarm_consume_world_destroy_district_desc

			hidden_effect = {
				random_list = {
					1 = {
						modifier = {
							factor = 0
							num_districts = { type = district_hive value = 0 }
						}
						remove_district = district_hive
					}
					1 = {
						modifier = {
							factor = 0
							num_districts = { type = district_generator value = 0 }
						}
						remove_district = district_generator
					}
					1 = {
						modifier = {
							factor = 0
							num_districts = { type = district_mining value = 0 }
						}
						remove_district = district_mining
					}
					3 = {
						modifier = {
							factor = 0
							num_districts = { type = district_farming value = 0 }
						}
						remove_district = district_farming
					}
				}
			}
		}

		hidden_effect = {
			random_list = {
				10 = {
					modifier = {
						factor = 0
						num_free_districts = { type = any value < 2 }
					}
					add_deposit = d_lithoid_devastation
					add_deposit = d_lithoid_devastation
					create_pop = {
						species = owner_main_species
					}
					add_planet_devastation = 20

					if = {
						limit = { owner = { is_ai = yes } }
						random_pop = {
							resettle_pop = {
								pop = this
								planet = owner.capital_scope
							}
						}
					}

					create_message = {
						type = MESSAGE_TERRAVORE_CONSUME_WORLD
						localization = MESSAGE_MACHINE_STRIPMINE_WORLD_POP_TEXT
						days = 30
						target = this

						variable = {
							type = name
							localization = PLANET
							scope = this
						}
					}
				}
				10 = {
					modifier = {
						factor = 0
						num_free_districts = { type = any value < 2 }
					}
					add_deposit = d_lithoid_devastation
					add_deposit = d_lithoid_devastation
					owner = {
						add_monthly_resource_mult = {
							resource = minerals
							value = 5
							min = @tier1materialmin
							max = @tier1materialmax
						}
					}
					add_planet_devastation = 20

					create_message = {
						type = MESSAGE_TERRAVORE_CONSUME_WORLD
						localization = MESSAGE_MACHINE_STRIPMINE_WORLD_MINERALS_TEXT
						days = 30
						target = this

						variable = {
							type = name
							localization = PLANET
							scope = this
						}
					}
				}
				10 = {
					modifier = {
						factor = 0
						num_free_districts = { type = any value < 2 }
					}
					add_deposit = d_lithoid_devastation
					add_deposit = d_lithoid_devastation
					owner = {
						add_monthly_resource_mult = {
							resource = alloys
							value = 3
							min = @tier1materialmin
							max = @tier1materialmax
						}
					}
					add_planet_devastation = 20

					create_message = {
						type = MESSAGE_TERRAVORE_CONSUME_WORLD
						localization = MESSAGE_MACHINE_STRIPMINE_WORLD_ALLOYS_TEXT
						days = 30
						target = this

						variable = {
							type = name
							localization = PLANET
							scope = this
						}
					}
				}
				10 = {
					# There's only one district slot left on the planet
					modifier = {
						factor = 0
						num_free_districts = { type = any value >= 2 }
					}
					add_deposit = d_lithoid_devastation
					owner = {
						add_monthly_resource_mult = {
							resource = minerals
							value = 3
							min = @tier1materialmin
							max = @tier1materialmax
						}
					}
					add_planet_devastation = 10

					create_message = {
						type = MESSAGE_TERRAVORE_CONSUME_WORLD
						localization = MESSAGE_MACHINE_STRIPMINE_WORLD_MINERALS_TEXT
						days = 30
						target = this

						variable = {
							type = name
							localization = PLANET
							scope = this
						}
					}
				}
			}

			# If I'm an AI, abandon the planet if we've finished consuming the planet
			if = {
				limit = { owner = { is_ai = yes } }
				owner = { country_event = { id = colony.185 days = 1 } }
			}
		}
	}

	ai_weight = {
		weight = 5

		# don't wreck worlds you want to keep
		modifier = {
			factor = 0
			is_lithoid_devouring_swarm_consumption_world = no
		}
	}
}