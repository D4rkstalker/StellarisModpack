##########################################################################
# Insecticon Decisions
##########################################################################

###INSECTICONS###

#TURN WORLD INTO A INSECTICON HIVE WORLD
decision_insecticon_hive_stage_1 = {
	owned_planets_only = yes
	icon = decision_insecticon_hive_project
	sound = decision_animal_wildlife
	
	enactment_time = 360
	resources = {
		category = decisions
		cost = {
			minerals = 1000
			energon = 500
		}
	}
	prerequisites = {
		"tech_energon_mining_1"
	}
	potential = {	
		NOR = {
			is_planet_class = pc_damaged_cybertron
			is_planet_class = pc_restored_cybertron
			is_planet_class = pc_corrupted_cybertron
			is_planet_class = pc_dead_cybertron
			is_planet_class = pc_insecticon_hive
			is_planet_class = pc_city
			is_planet_class = pc_relic
			is_planet_class = pc_habitat
			is_planet_class = pc_ringworld_habitable
		}
		habitable_structure = no
		is_colony = yes
		owner = {
			has_origin = origin_insecticon_hive
		}
	}
	
	allow = {
		owner = {
			has_origin = origin_insecticon_hive
		}
	}
	
	effect = {
		set_planet_entity = {
			entity = "insecticon_hive_planet_02_entity"
		}
		set_planet_flag = insecticon_hive_stage_1
		remove_modifier = insecticon_hive_stage_0
		add_modifier = {
			modifier = insecticon_hive_stage_1
			days = -1
		}
		add_deposit = d_insecticon_hive
		change_pc = pc_insecticon_hive
		clear_deposits = yes
	}
	ai_weight = {
		weight = 20
		modifier = {
			factor = 0
			num_pops < 10
		}
	}
}

 ### Stage 2
decision_insecticon_hive_stage_2 = {
	owned_planets_only = yes
	icon = decision_build_insecticon_hive

	enactment_time = 900
	resources = {
		category = decisions
		cost = {
			minerals = 1000 
			energon = 250
		}
	}
	
	potential = {
		is_planet_class = pc_insecticon_hive
		has_planet_flag = insecticon_hive_stage_1
		habitable_structure = no
		is_colony = yes
		owner = {
			has_origin = origin_insecticon_hive
		}
		NOR = {
			has_planet_flag = insecticon_hive_stage_2
			has_planet_flag = insecticon_hive_stage_3
		}
	}

	allow = {
		owner = {
			has_origin = origin_insecticon_hive
		}
		is_colony = yes
	}
	
	effect = {
		set_planet_entity = {
			entity = "insecticon_hive_planet_03_entity"
		}
		remove_planet_flag = insecticon_hive_stage_1
		set_planet_flag = insecticon_hive_stage_2
		remove_modifier = insecticon_hive_stage_1
		add_modifier = {
			modifier = insecticon_hive_stage_2
			days = -1
		}
		add_deposit = d_insecticon_hive
	}
	ai_weight = {
		weight = 20
		modifier = {
			factor = 0
			num_pops < 20
		}
	}
}
### Stage 3
decision_insecticon_hive_stage_3 = {
	owned_planets_only = yes
	icon = decision_build_insecticon_hive

	enactment_time = 1800
	resources = {
		category = decisions
		cost = {
			minerals = 3000 
			energon = 300
		}
	}
	
	potential = {
		is_planet_class = pc_insecticon_hive
		has_planet_flag = insecticon_hive_stage_2
		habitable_structure = no
		is_colony = yes
		owner = {
			has_origin = origin_insecticon_hive
		}
		NOR = {
			has_planet_flag = insecticon_hive_stage_1
			has_planet_flag = insecticon_hive_stage_3
		}
	}

	allow = {
		owner = {
			has_origin = origin_insecticon_hive
		}
		is_colony = yes
	}
	
	effect = {
		set_planet_entity = {
			entity = "insecticon_hive_planet_04_entity"
		}
		remove_planet_flag = insecticon_hive_stage_2
		set_planet_flag = insecticon_hive_stage_3
		remove_modifier = insecticon_hive_stage_2
		add_modifier = {
			modifier = insecticon_hive_stage_3
			days = -1
		}
		add_deposit = d_cybertronian_world_core
		add_deposit = d_energon_crystals
		add_deposit = d_insecticon_hive
	}
	ai_weight = {
		weight = 20
		modifier = {
			factor = 0
			num_pops < 30
		}
	}
}

### Remove Insecticon Hive
decision_remove_insecticon_hive = {
	owned_planets_only = yes
	icon = decision_build_insecticon_hive

	enactment_time = 1800
	resources = {
		category = decisions
		cost = {
			energy = 2000
		}
	}
	
	potential = {
		is_planet_class = pc_insecticon_hive
		habitable_structure = no
		is_colony = yes
		NOT = {
			owner = {
				has_origin = origin_insecticon_hive
			}
		}
	}

	allow = {
		NOT = {
			owner = {
				has_origin = origin_insecticon_hive
			}
		}
		is_colony = yes
	}
	
	effect = {
		change_pc = pc_nuked	
		reset_planet = yes
		remove_planet_flag = insecticon_hive_stage_1
		remove_planet_flag = insecticon_hive_stage_2
		remove_planet_flag = insecticon_hive_stage_3
		remove_modifier = insecticon_hive_stage_1
		remove_modifier = insecticon_hive_stage_2
		remove_modifier = insecticon_hive_stage_3
		remove_deposit = d_insecticon_hive
		remove_deposit = d_insecticon_hive
		remove_deposit = d_insecticon_hive
		remove_deposit = d_energon_crystals
		remove_deposit = d_cybertronian_world_core
		owner = {
			add_resource = {
				minerals = 2500
				alloys = 2500
				energon = 2500
			}
		}
	}
	ai_weight = {
		weight = 10000
	}
}
#CONSUMING A PLANET VIA INSECTICONS
decision_insecticon_consume_world = {
	icon = decision_insecticon_consume_world
	sound = event_structural_collapse
	
	enactment_time = 180
	
	resources = {
		category = decisions
	}
	owned_planets_only = yes
	
	prerequisites = {
		
	}
	potential = {	
		owner = {
			has_valid_civic = civic_insecticon_hive
		}
		can_have_habitable_deposits = yes
		is_capital = no
	}
	
	allow = {
		owner = {
			has_origin = origin_insecticon_hive
		}
		num_free_districts = { type = any value > 0 }
	}
	
	effect = {
		if = {
			limit = { num_districts = { type = any value > 0 } }
			custom_tooltip = decision_insecticon_consume_world_desc

			hidden_effect = {
				random_list = {
					1 = {
						modifier = {
							factor = 0
							num_districts = { type = district_hive value = 0 }
						}
						remove_district = district_hive
					}
					1 = {
						modifier = {
							factor = 0
							num_districts = { type = district_generator value = 0 }
						}
						remove_district = district_generator
					}
					1 = {
						modifier = {
							factor = 0
							num_districts = { type = district_mining value = 0 }
						}
						remove_district = district_mining
					}
					3 = {
						modifier = {
							factor = 0
							num_districts = { type = district_farming value = 0 }
						}
						remove_district = district_farming
					}
				}
			}
		}
		
		hidden_effect = {
			random_list = {
				10 = {
					modifier = {
						factor = 0
						num_free_districts = { type = any value < 2 }
					}
					add_deposit = d_insecticon_devastation
					add_deposit = d_insecticon_devastation
					create_pop = {
						species = owner_main_species
					}
					add_planet_devastation = 20

					if = {
						limit = { owner = { is_ai = yes } }
						random_owned_pop = {
							resettle_pop = {
								pop = this
								planet = owner.capital_scope
							}
						}
					}

					create_message = {
						type = MESSAGE_INSECTICON_CONSUME_WORLD
						localization = MESSAGE_INSECTICON_CONSUME_WORLD_POP_TEXT
						days = 30
						target = this

						variable = {
							type = name
							localization = PLANET
							scope = this
						}
					}
				}
				10 = {
					modifier = {
						factor = 0
						num_free_districts = { type = any value < 2 }
					}
					add_deposit = d_insecticon_devastation
					add_deposit = d_insecticon_devastation
					owner = {
						add_monthly_resource_mult = {
							resource = minerals
							value = 5
							min = @tier1materialmin
							max = @tier1materialmax
						}
						add_monthly_resource_mult = {
							resource = energon
							value = 5
							min = @tier1materialmin
							max = @tier1materialmax
						}
					}
					add_planet_devastation = 20

					create_message = {
						type = MESSAGE_INSECTICON_CONSUME_WORLD
						localization = MESSAGE_INSECTICON_CONSUME_WORLD_MINERALS_TEXT
						days = 30
						target = this

						variable = {
							type = name
							localization = PLANET
							scope = this
						}
					}
				}
				10 = {
					modifier = {
						factor = 0
						num_free_districts = { type = any value < 2 }
					}
					add_deposit = d_insecticon_devastation
					add_deposit = d_insecticon_devastation
					owner = {
						add_monthly_resource_mult = {
							resource = alloys
							value = 3
							min = @tier1materialmin
							max = @tier1materialmax
						}
						add_monthly_resource_mult = {
							resource = energon
							value = 5
							min = @tier1materialmin
							max = @tier1materialmax
						}
					}
					add_planet_devastation = 20

					create_message = {
						type = MESSAGE_INSECTICON_CONSUME_WORLD
						localization = MESSAGE_INSECTICON_CONSUME_WORLD_ALLOYS_TEXT
						days = 30
						target = this

						variable = {
							type = name
							localization = PLANET
							scope = this
						}
					}
				}
				10 = {
					# There's only one district slot left on the planet
					modifier = {
						factor = 0
						num_free_districts = { type = any value >= 2 }
					}
					add_deposit = d_insecticon_devastation
					owner = {
						add_monthly_resource_mult = {
							resource = minerals
							value = 3
							min = @tier1materialmin
							max = @tier1materialmax
						}
						add_monthly_resource_mult = {
							resource = energon
							value = 5
							min = @tier1materialmin
							max = @tier1materialmax
						}
					}
					add_planet_devastation = 10

					create_message = {
						type = MESSAGE_INSECTICON_CONSUME_WORLD
						localization = MESSAGE_INSECTICON_CONSUME_WORLD_MINERALS_TEXT
						days = 30
						target = this

						variable = {
							type = name
							localization = PLANET
							scope = this
						}
					}
				}
			}

			# Abandon the planet if we've finished consuming the planet
			if = {
				owner = { country_event = { id = insecticon_hive_planet.185 days = 1 } }
			}
		}
	}

	ai_weight = {
		weight = 5

		# don't wreck worlds you want to keep
		modifier = {
			factor = 0
			is_insecticon_swarm_consumption_world = no
		}
	}
}

decision_send_insecticon_stasis_pods = {
	owned_planets_only = no
	enactment_time = 120
	resources = {
		category = decisions
		cost = {
			energy = 750
			energon = 500
		}
	}
	
	potential = {
		exists = space_owner 
		space_owner = { is_same_value = from }
		from = {
			has_valid_civic = civic_insecticon_hive
		}
		NOR = {
			has_deposit = d_insecticon_nest
		}
		OR = {
			is_colonizable = yes
		}
	}
	
	allow = {
		is_under_colonization = no
	}
	
	effect = {
		custom_tooltip = decision_send_insecticon_stasis_pods_effects
		add_deposit = d_insecticon_nest
	}
	
	ai_weight = {
		weight = 1000
	}
}

### Remove Insecticon Nest on Uncolonized Planet #
#decision_remove_insecticon_stasis_pods = {
#	owned_planets_only = yes
#	
#	enactment_time = 120
#	resources = {
#		category = decisions
#		cost = {
#			energy = 1000
#		}
#	}
#	
#	potential = {
#		OR = {
#			has_despoit = d_insecticon_nest
#		}
#	}
#	
#	allow = {
#		OR = {
#			has_deposit = d_insecticon_nest
#		}
#	}
#	
#	effect = {
#		custom_tooltip = decision_remove_insecticon_stasis_pods_effects
#		remove_deposit = d_insecticon_nest
#		owner = {
#			add_resource = {
#				alloys = 250
#				energon = 50
#			}
#		}
#	}
#	
#	ai_weight = {
#		weight = 0
#	}
#}

### Colonize planet by hatching Insecticon Stasis Pods
decision_hatch_insecticon_stasis_pods = {
	enactment_time = 120
	resources = {
		category = decisions
		cost = {
			energy = 350
			unity = 100
		}
	}
	
	potential = {
		exists = space_owner
		space_owner = { is_same_value = from }
		from = {
			has_valid_civic = civic_insecticon_hive
		}
		is_colonizable = yes
	}
	
	allow = {
		has_deposit = d_insecticon_nest
		is_under_colonization = no
	}
	
	effect = {
		custom_tooltip = decision_hatch_insecticon_stasis_pods_effects
		remove_deposit = d_insecticon_nest
		add_deposit = d_insecticon_hive
		add_deposit = d_energon_crystals
		create_colony = {
			owner = from
			species = owner
			ethos = random
		}
	}	
}