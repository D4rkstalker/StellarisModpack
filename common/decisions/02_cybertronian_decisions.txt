##########################################################################
# Cybertronian Decisions
##########################################################################


# Restoring Omega Lock Project
decision_omega_lock_project = {
	owned_planets_only = yes
	icon = decision_omega_lock_project
	
	enactment_time = 3600
	resources = {
		category = decisions
		cost = {
			influence = 200
			energon = 15000
			sr_living_metal = 5000
		}
	}
	potential = {
		OR = {
			is_planet_class = pc_dead_cybertron
			is_planet_class = pc_damaged_cybertron
			is_planet_class = pc_corrupted_cybertron
		}
		habitable_structure = no
		exists = owner
	}
	
	allow = {
		num_uncleared_blockers < 5
		owner = { has_technology = "tech_housing_2" }
		owner = { has_technology = "tech_energon_mining_2" }
	}
	
	effect = {
		# Repair Cybertron
		remove_modifier = core_shutdown_0
		remove_modifier = core_shutdown_1
		remove_modifier = core_shutdown_2
		remove_modifier = core_shutdown_3
		remove_modifier = core_shutdown_4
		remove_modifier = core_shutdown_5
		remove_modifier = cybertron_aftermath
		remove_modifier = great_war
		remove_modifier = cybertron_corrupted
		remove_modifier = cybertron_at_war
		add_modifier = { modifier = "cybertron_restored" days = 3600 }
		custom_tooltip = decision_omega_lock_project_effects
		hidden_effect = {
			clear_blockers = yes
			clear_deposits = yes
			change_pc = pc_restored_cybertron
			add_deposit = d_iacon_city
			add_deposit = d_kaon_city
			add_deposit = d_crystal_city
			add_deposit = d_restored_cybertron_city
			add_deposit = d_restored_cybertron_city
			add_deposit = d_restored_cybertron_city
			add_deposit = d_teletraan_one
			add_deposit = d_restored_cybertron_core
			add_deposit = d_space_bridge
			add_deposit = d_active_well_of_all_sparks
			add_deposit = d_energon_bridge
			add_deposit = d_energon_crystals
			set_planet_entity = {
				entity = "restored_cybertron_planet_01_entity"
				picture = pc_restored_cybertron
			}
			owner = {
				country_event = { id = cybertron_shutdown.6 }
			}
		}
	}
	ai_weight = {
		weight = 0
		modifier = {
			factor = 500
			from = { is_cybertronian = yes }
		}
	}
}

# Corrupting the Omega Lock Project
decision_corrupt_omega_lock_project = {
	owned_planets_only = yes
	icon = decision_corrupt_omega_lock_project
	
	enactment_time = 3600
	resources = {
		category = decisions
		cost = {
			influence = 200
			dark_energon = 15000
			sr_living_metal = 5000
		}
	}
	prerequisites = {
		"tech_dark_energon_mining"
	}
	potential = {
		OR = {
			is_planet_class = pc_dead_cybertron
			is_planet_class = pc_damaged_cybertron
			is_planet_class = pc_restored_cybertron
		}
		habitable_structure = no
		exists = owner
	}
	
	allow = {
		num_uncleared_blockers < 5
		owner = { has_technology = "tech_housing_2" }
		owner = { has_technology = "tech_dark_energon_mining" }
	}
	
	effect = {
		# Repair and Corrupt Cybertron with Dark Energon
		remove_modifier = core_shutdown_0
		remove_modifier = core_shutdown_1
		remove_modifier = core_shutdown_2
		remove_modifier = core_shutdown_3
		remove_modifier = core_shutdown_4
		remove_modifier = core_shutdown_5
		remove_modifier = cybertron_aftermath
		remove_modifier = great_war
		remove_modifier = cybertron_restored
		remove_modifier = cybertron_at_war
		add_modifier = { modifier = "cybertron_corrupted" days = -1 }
		custom_tooltip = decision_corrupt_omega_lock_project_effects
		hidden_effect = {
			clear_blockers = yes
			clear_deposits = yes
			change_pc = pc_corrupted_cybertron
			add_deposit = d_dark_energon_core
			add_deposit = d_corrupted_well_of_all_sparks
			add_deposit = d_dead_iacon_city
			add_deposit = d_kaon_city
			add_deposit = d_dark_energon_city
			add_deposit = d_dark_energon_city
			add_deposit = d_dark_energon_city
			add_deposit = d_insecticon_infestation
			add_deposit = d_space_bridge
			add_deposit = d_energon_bridge
			add_deposit = d_energon_crystals
			add_deposit = d_dark_energon_crystals
			set_planet_entity = {
				entity = "corrupted_cybertron_planet_01_entity"
				picture = pc_corrupted_cybertron
			}
			owner = {
				country_event = { id = cybertron_shutdown.7 }
			}
		}
	}
	ai_weight = {
		weight = 0
		modifier = {
			factor = 50
			from = {
				OR = {
					has_trait = trait_robot_decepticon
					has_trait = trait_robot_predacon
				}
			}
		}
	}
}

# TURN WORLD INTO A CYBERTRONIAN PLANET
decision_cybertronian_project = {
	owned_planets_only = yes
	icon = decision_cybertron_project
	
	enactment_time = 3600
	resources = {
		category = decisions
		cost = {
			influence = 100
			energon = 5000
			sr_living_metal = 2500
		}
	}
	prerequisites = {
		"tech_energon_mining_2"
	}
	potential = {	
		NOR = {
			is_planet_class = pc_damaged_cybertron
			is_planet_class = pc_restored_cybertron
			is_planet_class = pc_corrupted_cybertron
			is_planet_class = pc_dead_cybertron
			is_planet_class = pc_cybertronian_world
			is_planet_class = pc_city
			is_planet_class = pc_relic
			has_modifier = resort_colony
			has_modifier = penal_colony
			has_modifier = slave_colony
			has_modifier = pm_wenkwort_custodian
		}
		is_artificial = no 
		exists = owner
		owner = { has_ascension_perk = ap_cybertronian_worlds }
	}
	
	allow = {
		owner = { has_technology = tech_housing_2 }
	}
	
	effect = {
		# Make Cybertronian Planet
		custom_tooltip = decision_cybertronian_project_effects
		hidden_effect = {
			clear_deposits = yes
			clear_blockers = yes 
			change_pc = pc_cybertronian_world
			set_planet_entity = {
				entity = "cybertronian_planet_01_entity"
				picture = pc_cybertronian_world
			}
			remove_modifier = cybertron_corrupted
			remove_modifier = dark_energon_corruption
			add_deposit = d_well_of_all_sparks_duplicate
			add_deposit = d_cybertronian_world_core
			add_deposit = d_cybertronian_city
			add_deposit = d_cybertronian_city
			add_deposit = d_space_bridge
			add_deposit = d_energon_bridge
			add_deposit = d_energon_crystals
			planet_event = { id = cybertron_start.14 }
			if = {
				limit = {
					OR = {
						is_active_resolution = "resolution_ecology_environmental_control_board"
						is_active_resolution = "resolution_ecology_paradise_initiative"
					}
				}
				owner = {
					set_timed_country_flag = { flag = resolution_breached_terraformed days = 3600 }
				}
			}
		}
	}
	ai_weight = {
		weight = 10
		modifier = {
			factor = 50
			from = { is_cybertronian = yes }
		}
		modifier = {
			factor = 20
			from = {
				OR = {
					has_trait = trait_robot_autobot
					has_trait = trait_robot_maximal
				}
			}
		}
		modifier = {
			factor = 0
			has_resource = { type = energon amount < 5500 } 
		}
		modifier = {
			factor = 0
			has_resource = { type = living_metal amount < 3000 }
		}
	}
}
# TURN WORLD INTO A CYBERTRONIAN PLANET USING DARK ENERGON
decision_corrupt_cybertronian_project = {
	owned_planets_only = yes
	icon = decision_corrupt_cybertronian_project
	
	enactment_time = 1800
	resources = {
		category = decisions
		cost = {
			influence = 100
			dark_energon = 5000
		}
	}
	prerequisites = {
		"tech_dark_energon_mining"
	}
	potential = {
		OR = {
			is_planet_class = pc_cybertronian_world
			is_planet_class = pc_aquatic_cybertronian_world
		}
		exists = owner
		owner = { has_ascension_perk = ap_cybertronian_worlds }
	}
	
	allow = {
		owner = { has_technology = tech_housing_2 }
	}
	
	effect = {
		# Make Dark Energon Cybertronian Planet
		custom_tooltip = decision_corrupt_cybertronian_project_effects
		hidden_effect = {
			clear_deposits = yes
			clear_blockers = yes 
			change_pc = pc_corrupted_cybertronian_world
			add_deposit = d_dark_energon_core
			add_deposit = d_dark_energon_city
			add_deposit = d_dark_energon_city
			add_deposit = d_insecticon_infestation
			add_deposit = d_corrupted_well_of_all_sparks_duplicate
			add_deposit = d_space_bridge
			add_deposit = d_energon_bridge
			add_deposit = d_dark_energon_crystals
			add_modifier = { modifier = "cybertron_corrupted" days = -1 }
			set_planet_entity = {
				entity = "corrupted_cybertronian_planet_01_entity"
				picture = pc_corrupted_cybertronian_world
			}
			planet_event = { id = cybertron_start.15 }
			if = {
				limit = {
					OR = {
						is_active_resolution = "resolution_ecology_environmental_control_board"
						is_active_resolution = "resolution_ecology_paradise_initiative"
					}
				}
				owner = {
					set_timed_country_flag = { flag = resolution_breached_terraformed days = 3600 }
				}
			}
		}
	}
	ai_weight = {
		weight = 10
		modifier = {
			factor = 50
			from = {
				OR = {
					has_trait = trait_robot_decepticon
					has_trait = trait_robot_predacon
				}
			}
		}
		modifier = {
			factor = 0
			from = {
				OR = {
					has_trait = trait_robot_autobot
					has_trait = trait_robot_maximal
				}
			}
		}
		modifier = {
			factor = 0
			has_resource = { type = dark_energon amount < 5500 } 
		}
		modifier = {
			factor = 0
			has_resource = { type = influence amount < 150 }
		}
	}
}
# TURN WORLD INTO AQUATIC CYBERTRONIAN WORLD
decision_aquatic_cybertronian_project = {
	owned_planets_only = yes
	icon = decision_cybertron_project
	
	enactment_time = 1800
	resources = {
		category = decisions
		cost = {
			influence = 100
			energon = 5000
			sr_living_metal = 2500
		}
	}
	prerequisites = {
		"tech_energon_mining_2"
	}
	potential = {	
		is_planet_class = pc_ocean
		exists = owner
		owner = {
			has_ascension_perk = ap_cybertronian_worlds
			has_trait = trait_robot_aquatronian
		}
	}
	
	allow = {
		num_uncleared_blockers < 1
		owner = { has_technology = tech_terrestrial_sculpting }
	}
	
	effect = {
		# Make Aquatic Cybertronian Planet
		custom_tooltip = decision_cybertronian_project_effects
		hidden_effect = {
			clear_deposits = yes
			change_pc = pc_aquatic_cybertronian_world
			set_planet_entity = {
				entity = "aquatronian_planet_01_entity"
				picture = pc_aquatron
			}
			remove_modifier = cybertron_corrupted
			remove_modifier = dark_energon_corruption
			add_deposit = d_well_of_all_sparks_duplicate
			add_deposit = d_automated_energon_refineries
			add_deposit = d_cybertronian_city
			add_deposit = d_cybertronian_city
			add_deposit = d_space_bridge
			add_deposit = d_energon_bridge
			add_deposit = d_underwater_vent
			add_deposit = d_submerged_ore_veins
			add_deposit = d_teeming_reef
			add_deposit = d_energon_crystals
			
			planet_event = { id = cybertron_start.22 }
			if = {
				limit = {
					OR = {
						is_active_resolution = "resolution_ecology_environmental_control_board"
						is_active_resolution = "resolution_ecology_paradise_initiative"
					}
				}
				owner = {
					set_timed_country_flag = { flag = resolution_breached_terraformed days = 3600 }
				}
			}
		}
	}
	ai_weight = {
		weight = 1
		modifier = {
			factor = 100
			from = {
				has_trait = trait_robot_aquatronian
			}
		}
		modifier = {
			factor = 50
			from = { is_cybertronian = yes }
		}	
		modifier = {
			factor = 0
			has_resource = { type = energon amount < 5500 } 
		}
		modifier = {
			factor = 0
			has_resource = { type = living_metal amount < 3000 }
		}
	}
}

# SEEDING RAW ENERGON
decision_seed_energon = {
	icon = decision_seed_energon
	owned_planets_only = yes
	sound = event_ship_bridge
	
	enactment_time = 360
	
	prerequisites = {
		"tech_energon_mining_1"
	}
	
	resources = {
		category = decisions
		cost = {
			energy = 1000
			energon = 500
			influence = 50
		}
	}
	
	
	potential = {
		habitable_structure = no
		NOR = { 
			is_planet_class = pc_damaged_cybertron 
			is_planet_class = pc_dead_cybertron
			is_planet_class = pc_restored_cybertron 			
			is_planet_class = pc_cybertronian_world 
			is_planet_class = pc_corrupted_cybertronian_world
			is_planet_class = pc_corrupted_cybertron
			has_modifier = resort_colony 
			has_deposit = d_energon_crystals 
		}
		exists = owner
	}
	
	effect = {
		add_deposit = d_energon_crystals
		hidden_effect = {
			set_planet_flag = energon_crystals
		}
	}
	
	ai_weight = {
		weight = 10
		modifier = {
			factor = 100
			from = { is_cybertronian = yes }
		}
		modifier = {
			factor = 0
			has_resource = { type = energy amount < 1500 }
		}
		modifier = {
			factor = 0
			has_resource = { type = energon amount < 550 }
		}
	}
}
# REMOVING RAW ENERGON
decision_energon_clearing = {
	owned_planets_only = yes
	sound = event_ship_bridge
	icon = decision_seed_energon
	
	enactment_time = 720
	
	resources = {
		category = decisions
		cost = {
			energy = 3000
		}
	}
	
	potential = {
		has_deposit = d_energon_crystals
		NOR = {
			is_planet_class = pc_damaged_cybertron 
			is_planet_class = pc_dead_cybertron
			is_planet_class = pc_restored_cybertron 			
			is_planet_class = pc_cybertronian_world 
			is_planet_class = pc_corrupted_cybertronian_world
			is_planet_class = pc_corrupted_cybertron
		}
		exists = owner
	}
	
	effect = {
		remove_deposit = d_energon_crystals
		owner = {
			add_resource = {
				energon = 250
			}
		}
		if = {
			limit = {
				OR = {
					has_building = building_energon_refinery
					has_building = building_cybertronian_energon_refinery
					has_building = building_energon_mine
				}
			}
			remove_building = building_energon_refinery
			remove_building = building_cybertronian_energon_refinery
			remove_building = building_energon_mine
		}
	}
	
	ai_weight = {
		weight = 10
		modifier = {
			factor = 10
			from = {
				OR = {
					has_trait = trait_robot_autobot
					has_trait = trait_robot_maximal
				}
			}
		}
		modifier = {
			factor = 0
			from = {
				OR = {
					has_trait = trait_robot_decepticon
					has_trait = trait_robot_predacon
				}
			}
		}
		modifier = {
			factor = 0
			exists = owner
			owner = {
				NOT = {
					has_technology = tech_energon_mining_2
				}
			}
		}
	}
}

# SEEDING DARK ENERGON
decision_seed_dark_energon = {
	icon = decision_seed_dark_energon
	owned_planets_only = yes
	sound = event_ship_bridge
	
	enactment_time = 360
	
	prerequisites = {
		"tech_dark_energon_mining"
	}
	
	resources = {
		category = decisions
		cost = {
			energy = 1000
			dark_energon = 500
			influence = 100
		}
	}
	
	
	potential = {
		habitable_structure = no
		NOR = { 
			has_deposit = d_dark_energon_crystals 
			is_planet_class = pc_damaged_cybertron 
			is_planet_class = pc_restored_cybertron 
			is_planet_class = pc_dead_cybertron 
			is_planet_class = pc_corrupted_cybertronian_world
		}
		exists = owner
	}
	
	effect = {
		add_deposit = d_dark_energon_crystals
		add_modifier = { modifier = "dark_energon_corruption" days = -1 }
		hidden_effect = {
			set_planet_flag = dark_energon_crystals
		}
	}
	
	ai_weight = {
		weight = 5
		modifier = {
			factor = 0
			exists = owner
			owner = {
				NOT = {
					has_technology = tech_dark_energon_mining
				}
			}
		}
		modifier = {
			factor = 10
			from = {
				OR = {
					has_trait = trait_robot_decepticon
					has_trait = trait_robot_predacon
				}
			}
		}
		modifier = {
			factor = 0
			from = {
				OR = {
					has_trait = trait_robot_autobot
					has_trait = trait_robot_maximal
				}
			}
		}
		modifier = {
			factor = 0
			has_resource = { type = energy amount < 1500 }
		}
		modifier = {
			factor = 0
			has_resource = { type = dark_energon amount < 550 }
		}
	}
}

# REMOVING DARK ENERGON
decision_dark_energon_clearing = {
	owned_planets_only = yes
	sound = event_ship_bridge
	icon = decision_seed_dark_energon
	
	enactment_time = 800
	
	resources = {
		category = decisions
		cost = {
			energy = 3000
		}
	}
	
	potential = {
		has_deposit = d_dark_energon_crystals
		NOR = {
			is_planet_class = pc_corrupted_cybertron
			is_planet_class = pc_corrupted_cybertronian_world
			is_planet_class = pc_damaged_cybertron
			is_planet_class = pc_dead_cybertron
			is_planet_class = pc_restored_cybertron
		}
		exists = owner
	}
	
	effect = {
		remove_modifier = dark_energon_corruption
		remove_deposit = d_dark_energon_crystals
		owner = {
			add_resource = {
				dark_energon = 250
			}
		}
		if = {
			limit = {
				OR = {
					has_building = building_dark_energon_refinery
					has_building = building_cybertronian_dark_energon_refinery
					has_building = building_dark_energon_mine
				}
			}
			remove_building = building_dark_energon_refinery
			remove_building = building_cybertronian_dark_energon_refinery
			remove_building = building_dark_energon_mine
		}
	}
	
	ai_weight = {
		weight = 10
		modifier = {
			factor = 0
			exists = owner
			owner = {
				has_technology = tech_dark_energon_mining
			}
		}
	}
}

decision_install_groundbridge = {
	owned_planets_only = yes
	sound = event_ship_bridge
	icon = decision_install_groundbridge
	
	enactment_time = 360
	
	resources = {
		category = decisions
		cost = {
			energy = 1000
			alloys = 1000
		}
	}
	
	potential = {
		exists = owner 
		owner = { is_cybertronian = yes }
		NOR = {
			has_deposit = d_ground_bridge
			has_deposit = d_space_bridge
		}
	}
	
	effect = {
		add_deposit = d_ground_bridge
	}
	
	ai_weight = {
		weight = 10
	}
}


decision_build_cybertronian_world = {
	icon = decision_build_cybertronian_world
	sound = event_activating_unknown_technology
	owned_planets_only = no
	
	enactment_time = 1800
	
	resources = {
		category = decisions
		cost = {
			influence = 100
			energon = 5000
		}
	}
	prerequisites = {
		"tech_energon_mining_2"
	}
	potential = {	
		is_planet_class = "pc_primordial_cybertronian_world"
		exists = space_owner
		space_owner = { has_ascension_perk = ap_cybertronian_worlds }
	}
	
	allow = {
		space_owner = { has_technology = tech_terrestrial_sculpting }
	}
	
	effect = {
		# Make Cybertronian Planet from Raw Cybermatter-World
		custom_tooltip = decision_build_cybertronian_world_effects
		hidden_effect = {
			clear_deposits = yes
			change_pc = pc_cybertronian_world
			set_planet_entity = {
				entity = "cybertronian_planet_01_entity"
				picture = pc_cybertronian_world
			}
			remove_deposit = d_primordial_cybertronian_planet_deposit
			add_deposit = d_well_of_all_sparks_duplicate
			add_deposit = d_cybertronian_world_core
			add_deposit = d_cybertronian_city
			add_deposit = d_cybertronian_city
			add_deposit = d_space_bridge
			add_deposit = d_energon_bridge
			add_deposit = d_energon_crystals
			planet_event = { id = cybertron_start.14 }
			if = {
				limit = {
					OR = {
						is_active_resolution = "resolution_ecology_environmental_control_board"
						is_active_resolution = "resolution_ecology_paradise_initiative"
					}
				}
				owner = {
					set_timed_country_flag = { flag = resolution_breached_terraformed days = 3600 }
				}
			}
		}
	}
	ai_weight = {
		weight = 10
	}
}

@expand_cybertronian_world_length = 720

decision_expand_cybertronian_world = {
	owned_planets_only = yes
	icon = decision_build_cybertronian_world
	sound = event_activating_unknown_technology

	enactment_time = @expand_cybertronian_world_length

	potential = {
		OR = {
			is_planet_class = pc_cybertronian_world
			is_planet_class = pc_corrupted_cybertronian_world
		}
		exists = owner
		owner = {
			has_ascension_perk = ap_cybertronian_worlds
		}
	}

	allow = {
		if = {
			limit = {
				is_variable_set = cybertonian_world_expansion_happened
			}
			custom_tooltip = {
				fail_text = requires_max_5_times_fail_simple
				success_text = requires_max_5_times_cybertronian_world_expansion
				check_variable = {
					which = cybertonian_world_expansion_happened
					value < 5
				}
			}
		}
		else = {
			custom_tooltip = {
				text = requires_max_5_times_pass_simple
				always = yes
			}
		}
	}

	resources = {
		category = decisions
		cost = {
			influence = 50
			sr_living_metal = 2000
			energon = 1000
		}
	}

	on_queued = {
		set_variable = {
			which = decision_length
			value = @expand_cybertronian_world_length
		}
		export_modifier_to_variable = {
			modifier = planet_decision_enact_speed_mult
			variable = decision_mult_var
		}
		change_variable = {
			which = decision_mult_var
			value = 1
		}
		divide_variable = {
			which = decision_length
			value = decision_mult_var
		}
		change_variable = { #ideally, may as well refer to this in the final effect
			which = decision_length
			value = 1
		}
		clear_variable = decision_length
		clear_variable = decision_mult_var
	}

	effect = {
		change_planet_size = 1
		custom_tooltip = decision_expand_cybertronian_world_tooltip
		if = {
			limit = {
				is_planet_class = pc_corrupted_cybertronian_world
			}
			add_deposit = d_dark_energon_city
		}
		else = {
			add_deposit = d_cybertronian_city
		}
		hidden_effect = {
			change_variable = {
				which = cybertonian_world_expansion_happened
				value = 1
			}
		}
	}

	ai_weight = {
		weight = 1
		modifier = {
			factor = 2
			num_pops > 25
		}
		modifier = {
			factor = 3
			num_pops > 50
		}
	}
}


# REPAIR CYBERTRONIAN PLANET
decision_repair_cybertronian_world = {
	owned_planets_only = yes
	icon = decision_repair_cybertronian_world
	
	enactment_time = 1800
	resources = {
		category = decisions
		cost = {
			influence = 100
			sr_living_metal = 2500
			energon = 2500
		}
	}
	prerequisites = {
		"tech_energon_mining_2"
	}
	potential = {	
		OR = {
			is_planet_class = pc_damaged_cybertronian_world
		}
		exists = owner
		owner = { has_ascension_perk = ap_cybertronian_worlds }
	}
	
	allow = {
		owner = { has_technology = tech_housing_2 }
	}
	
	effect = {
		# Repair Cybertronian Planet
		custom_tooltip = decision_repair_cybertronian_world_effects
		hidden_effect = {
			clear_deposits = yes
			change_pc = pc_cybertronian_world
			set_planet_entity = {
				entity = "restored_cybertronian_planet_01_entity"
				picture = pc_cybertronian_world
			}
			remove_modifier = cybertron_corrupted
			remove_modifier = dark_energon_corruption
			add_deposit = d_well_of_all_sparks_duplicate
			add_deposit = d_cybertronian_world_core
			add_deposit = d_cybertronian_city
			add_deposit = d_cybertronian_city
			add_deposit = d_space_bridge
			add_deposit = d_energon_bridge
			add_deposit = d_energon_crystals
			planet_event = { id = cybertron_start.14 }
			if = {
				limit = {
					OR = {
						is_active_resolution = "resolution_ecology_environmental_control_board"
						is_active_resolution = "resolution_ecology_paradise_initiative"
					}
				}
				owner = {
					set_timed_country_flag = { flag = resolution_breached_terraformed days = 3600 }
				}
			}
		}
	}
	ai_weight = {
		weight = 10
	}
}