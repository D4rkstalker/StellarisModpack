
@entity_x = 0
@entity_y = 0

ag_epsilon_titan_station_actived_0 = {
	entity = "ag_epsilon_titan_station_1_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
ag_epsilon_titan_station_actived_1 = {
	entity = "ag_epsilon_titan_station_1_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { ag_epsilon_titan_station_actived_0 }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
ag_epsilon_titan_station_actived_2 = {
	entity = "ag_epsilon_titan_station_1_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 10
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { ag_epsilon_titan_station_actived_1 }
	
	potential = {
		NOT = { has_global_flag = ag_epsilon_obelisk_working }
		exists = owner
		owner = { OR = {
			has_country_flag = ag_epsilon_ringworld_1_site_completed
			has_country_flag = ag_epsilon_ringworld_2_site_completed
			has_country_flag = ag_epsilon_ringworld_3_site_completed
		} }
	}
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_epsilon_obelisk_1_upgraded"
			from = { has_country_flag = ag_epsilon_obelisk_1_upgraded }
		}
		custom_tooltip = {
			fail_text = "ag_requires_epsilon_obelisk_2_upgraded"
			from = { has_country_flag = ag_epsilon_obelisk_2_upgraded }
		}
		custom_tooltip = {
			fail_text = "ag_requires_epsilon_obelisk_3_upgraded"
			from = { has_country_flag = ag_epsilon_obelisk_3_upgraded }
		}
	}

	on_build_complete = {
		from = { country_event = { id = ag_epsilon.33 } }
		spawn_megastructure = { type = ag_epsilon_titan_station_actived_1 coords_from = star owner = from }
		fromfrom = { remove_megastructure = this }
	}

	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
ag_epsilon_titan_station_actived_3 = {
	entity = "ag_epsilon_titan_station_1_alt_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { ag_epsilon_titan_station_actived_2 }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}

ag_epsilon_obelisk_0 = {
	entity = "ag_epsilon_obelisk_base_closed_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
ag_epsilon_obelisk_1 = {
	entity = "ag_epsilon_obelisk_base_0_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { ag_epsilon_obelisk_0 }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
ag_epsilon_obelisk_2 = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 20
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { ag_epsilon_obelisk_1 }

	resources = {
		category = megastructures
		cost = { energy = 500 sr_dark_matter = 100 }
	}
	
	potential = {
		NOT = { has_global_flag = ag_epsilon_guardian_awaken }
		exists = owner
		owner = { NOT = { has_country_flag = ag_epsilon_31_actived } }
	}

	construction_blocked_by_others = no
	construction_blocks_others = no

	on_build_complete = {
		fromfrom = {
			switch = {
				trigger = has_megastructure_flag
				ag_epsilon_obelisk_1 = { root.from = { set_country_flag = ag_epsilon_obelisk_1_flag } }
				ag_epsilon_obelisk_2 = { root.from = { set_country_flag = ag_epsilon_obelisk_2_flag } }
				ag_epsilon_obelisk_3 = { root.from = { set_country_flag = ag_epsilon_obelisk_3_flag } }
			}
		}
		from = { set_country_flag = ag_epsilon_31_actived country_event = { id = ag_epsilon.31 } }
		spawn_megastructure = {
			type = ag_epsilon_obelisk_1
			coords_from = fromfrom
			owner = from
			init_effect = {
				if = {
					limit = { root.fromfrom = { has_megastructure_flag = ag_epsilon_obelisk_1 } }
					set_megastructure_flag = ag_epsilon_obelisk_1
				}
				else_if = {
					limit = { root.fromfrom = { has_megastructure_flag = ag_epsilon_obelisk_2 } }
					set_megastructure_flag = ag_epsilon_obelisk_2
				}
				else_if = {
					limit = { root.fromfrom = { has_megastructure_flag = ag_epsilon_obelisk_3 } }
					set_megastructure_flag = ag_epsilon_obelisk_3
				}
			}
		}
		remove_megastructure = fromfrom
	}

	ai_weight = { weight = 0 }
}
ag_epsilon_obelisk_3 = {
	# Obelisk turn red.
	entity = "ag_epsilon_obelisk_base_1_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { ag_epsilon_obelisk_2 }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
ag_epsilon_obelisk_4 = {
	# Obelisk opening.
	entity = "ag_epsilon_obelisk_base_activated_opening_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { ag_epsilon_obelisk_3 }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
ag_epsilon_obelisk_5 = {
	# Obelisk closing.
	entity = "ag_epsilon_obelisk_base_activated_closing_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { ag_epsilon_obelisk_4 }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}

ag_epsilon_titan_megastructure_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 1080
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 150
		}
		upkeep = { energy = 5 }
	}
	
	potential = {
		has_technology = tech_ag_epsilon_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}		
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_system_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_epsilon_titan"
			from = { has_technology = tech_ag_epsilon_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_epsilon_titan"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_epsilon_titan_0
							is_ship_size = ag_epsilon_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_epsilon_titan_megastructure_0
							is_megastructure_type = ag_epsilon_titan_megastructure_1
							is_megastructure_type = ag_epsilon_titan_megastructure_2
							is_megastructure_type = ag_epsilon_titan_megastructure_3
						}
					}
					has_special_project = ag_structural_protection_system_501
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	placement_rules = {
		planet_possible = {
			custom_tooltip = {
				fail_text = "ag_requires_ancient_construction_section"
				has_planet_flag = ag_ancient_construction_section
			}
			custom_tooltip = {
				fail_text = "ag_requires_usable_ancient_construction_section"
				NOT = {
					has_planet_flag = has_megastructure
				}
			}
		}
	}
	
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		fromfrom.planet = { set_planet_flag = has_megastructure }
		from = {
			country_event = { id = ag_epsilon.111 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
		every_country = {
			limit = { NOT = { is_same_value = from } }
			country_event = { id = ag_epsilon.115 }
		}
	}

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}
ag_epsilon_titan_megastructure_1 = {
	entity = "ag_epsilon_titan_part_1_entity"
	construction_entity = "ag_epsilon_titan_part_1_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 2880
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_epsilon_titan_megastructure_0
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = 7500
			nanites = 1500
			sr_dark_matter = 1200
		}
		upkeep = { energy = 30 }
	}
	
	potential = {
		has_technology = tech_ag_epsilon_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_epsilon_titan"
			from = { has_technology = tech_ag_epsilon_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_epsilon_titan"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_epsilon_titan_0
							is_ship_size = ag_epsilon_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_epsilon_titan_megastructure_1
							is_megastructure_type = ag_epsilon_titan_megastructure_2
							is_megastructure_type = ag_epsilon_titan_megastructure_3
						}
					}
					has_special_project = ag_structural_protection_system_501
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		from = {
			country_event = { id = ag_epsilon.112 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
	}

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}
ag_epsilon_titan_megastructure_2 = {
	entity = "ag_epsilon_titan_part_2_entity"
	construction_entity = "ag_epsilon_titan_part_2_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 2160
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_epsilon_titan_megastructure_1
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = 4000
			nanites = 800
			sr_dark_matter = 1000
		}
		upkeep = { energy = 40 }
	}
	
	potential = {
		has_technology = tech_ag_epsilon_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_epsilon_titan"
			from = { has_technology = tech_ag_epsilon_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_epsilon_titan"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_epsilon_titan_0
							is_ship_size = ag_epsilon_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_epsilon_titan_megastructure_0
							is_megastructure_type = ag_epsilon_titan_megastructure_2
							is_megastructure_type = ag_epsilon_titan_megastructure_3
						}
					}
					has_special_project = ag_structural_protection_system_501
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		from = {
			country_event = { id = ag_epsilon.113 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
	}

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}
ag_epsilon_titan_megastructure_3 = {
	entity = "ag_epsilon_titan_part_3_entity"
	construction_entity = "ag_epsilon_titan_part_3_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 1440
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_epsilon_titan_megastructure_2
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = 3000
			nanites = 800
			sr_dark_matter = 800
		}
		upkeep = { energy = 50 }
	}
	
	potential = {
		has_technology = tech_ag_epsilon_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_epsilon_titan"
			from = { has_technology = tech_ag_epsilon_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_epsilon_titan"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_epsilon_titan_0
							is_ship_size = ag_epsilon_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_epsilon_titan_megastructure_0
							is_megastructure_type = ag_epsilon_titan_megastructure_1
							is_megastructure_type = ag_epsilon_titan_megastructure_3
						}
					}
					has_special_project = ag_structural_protection_system_501
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		fromfrom.planet = { remove_planet_flag = has_megastructure }
		from = {
			country_event = { id = ag_epsilon.114 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
		add_threat = { who = from amount = 50 }
		if = {
			limit = { from = { NOT = { has_country_flag = ag_epsilon_ships_unlocked } } }
			ag_epsilon_titan_player_spawn = {
				ag_unlock_ship = no
				ag_owner = from
				ag_location_target = fromfrom
			}
		}
		else = {
			ag_epsilon_titan_player_spawn = {
				ag_unlock_ship = yes
				ag_owner = from
				ag_location_target = fromfrom
			}
		}
		remove_megastructure = fromfrom
		every_country = {
			limit = { NOT = { is_same_value = from } }
			country_event = { id = ag_epsilon.116 }
		}
	}

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}

ag_epsilon_psionic_beacon = {
	entity = "ag_void_entity"
	construction_entity = "starbase_outpost_section_entity"
	portrait = "GFX_megastructure_construction_background"

	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 360
	
	upgrade_desc = hide
	
	entity_offset = { x = @entity_x y = @entity_y }
	
	resources = {
		category = megastructures
		cost = { alloys = 800 }
		upkeep = { energy = 20 }
	}

	potential = { has_technology = tech_ag_epsilon_station_1 }
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_not_inside_other_border"
			NAND = {
				exists = space_owner
				space_owner = { NOT = { is_same_value = from } }
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_epsilon_station_1"
			from = { has_technology = tech_ag_epsilon_station_1 }
		}
	}
	placement_rules = {
		planet_possible = {
			custom_tooltip = {
				fail_text = "requires_not_star"
				is_star = no
			}
			custom_tooltip = {
				fail_text = "ag_requires_no_other_station"
				NOT = { solar_system = { any_fleet_in_system = {
					has_fleet_flag = ag_space_station@prevprev
				} } }
			}
		}
	}
	
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		set_star_flag = ag_epsilon_titan_target
		if = {
			limit = { NOT = { any_fleet_in_system = { has_fleet_flag = ag_space_station@fromfrom.planet } } }
			random_ship_in_system = { limit = { is_ship_size = constructor } owner = { save_event_target_as = ag_station_owner } }
			create_fleet = {
				name = "NAME_ag_psionic_beacon_fleet"
				settings = { spawn_debris = no }
				effect = {
					set_fleet_flag = ag_space_station@fromfrom.planet
					set_fleet_flag = ag_epsilon_titan_target_station_fleet
					set_owner = event_target:ag_station_owner
					create_ship = {
						name = "NAME_ag_psionic_beacon_ship"
						design = "NAME_ag_psionic_beacon"
						prefix = no
						effect = { ag_difficulty_bonus = yes }
					}
					set_location = {
						target = root.fromfrom
						distance = 0
						angle = random
					}
				}
			}
		}
		if = {
			limit = {
				exists = event_target:ag_ancient_epsilon_guardian_country
				event_target:ag_ancient_epsilon_guardian_country = {
					any_owned_ship = {
						is_ship_size = ag_epsilon_titan_hostile
						fleet = { is_in_combat = no }
					}
				}
			}
			event_target:ag_ancient_epsilon_guardian_country = {
				every_owned_fleet = {
					limit = { is_in_combat = no any_owned_ship = { is_ship_size = ag_epsilon_titan_hostile } }
					clear_orders = yes
					clear_fleet_actions = this
					fleet_event = { id = ag_epsilon.62 days = 5 random = 5 }
				}
			}
		}
		remove_megastructure = fromfrom
	}
	construction_blocks_others = no
	construction_blocked_by_others = no
		
	ai_weight = { weight = 0 }
}
ag_epsilon_suppression_station = {
	entity = "ag_void_entity"
	construction_entity = "thinktank_phase_01_entity"
	portrait = "GFX_megastructure_construction_background"

	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 720
	
	upgrade_desc = hide
	
	entity_offset = { x = @entity_x y = @entity_y }
	
	resources = {
		category = megastructures
		cost = { energy = 500 alloys = 2500 }
		upkeep = { energy = 20 }
	}

	potential = { has_technology = tech_ag_epsilon_station_2 }
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_not_inside_other_border"
			NAND = {
				exists = space_owner
				space_owner = { NOT = { is_same_value = from } }
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_epsilon_station_2"
			from = { has_technology = tech_ag_epsilon_station_2 }
		}
	}
	placement_rules = {
		planet_possible = {
			custom_tooltip = {
				fail_text = "requires_not_star"
				is_star = no
			}
			custom_tooltip = {
				fail_text = "ag_requires_no_other_station"
				NOT = { solar_system = { any_fleet_in_system = {
					has_fleet_flag = ag_space_station@prevprev
				} } }
			}
		}
	}
	
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		if = {
			limit = { NOT = { any_fleet_in_system = { has_fleet_flag = ag_space_station@fromfrom.planet } } }
			random_ship_in_system = { limit = { is_ship_size = constructor } owner = { save_event_target_as = ag_station_owner } }
			create_fleet = {
				name = "NAME_ag_suppression_station_fleet"
				settings = { spawn_debris = no }
				effect = {
					set_fleet_flag = ag_space_station@fromfrom.planet
					set_fleet_flag = ag_epsilon_titan_killer_fleet
					set_owner = event_target:ag_station_owner
					create_ship = {
						name = "NAME_ag_suppression_station_ship"
						design = "NAME_ag_suppression_station"
						prefix = no
						effect = { ag_difficulty_bonus = yes }
					}
					set_location = {
						target = root.fromfrom
						distance = 0
						angle = random
					}
				}
			}
		}
		from = { country_event = { id = ag_epsilon.76 } }
		remove_megastructure = fromfrom
	}
	construction_blocks_others = no
	construction_blocked_by_others = no
		
	ai_weight = { weight = 0 }
}
