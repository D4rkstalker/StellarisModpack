
@entity_x = 0
@entity_y = 0

ag_epsilon_lock_actived_0 = {
	entity = "ag_epsilon_lock_1_hull_entity"
	construction_entity = ""
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
ag_epsilon_lock_actived_1 = {
	entity = "ag_epsilon_lock_1_hull_entity"
	construction_entity = ""
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { ag_epsilon_lock_actived_0 }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}

ag_epsilon_obelisk_0 = {
	# Testing entity
	# entity = "ag_epsilon_obelisk_base_activated_alt_entity"
	entity = "ag_epsilon_obelisk_base_closed_hull_entity"
	construction_entity = ""
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}

ag_epsilon_titan_megastructure_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 1080
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 150
		}
		upkeep = { energy = 5 }
	}
	
	potential = {
		has_technology = tech_ag_epsilon_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}		
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_system_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_epsilon_titan"
			from = { has_technology = tech_ag_epsilon_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_epsilon_titan"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_epsilon_titan_0
							is_ship_size = ag_epsilon_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_epsilon_titan_megastructure_0
							is_megastructure_type = ag_epsilon_titan_megastructure_1
							is_megastructure_type = ag_epsilon_titan_megastructure_2
							is_megastructure_type = ag_epsilon_titan_megastructure_3
						}
					}
					has_special_project = ag_structural_protection_system_501
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	placement_rules = {
		planet_possible = {
			custom_tooltip = {
				fail_text = "ag_requires_ancient_construction_section"
				has_planet_flag = ag_ancient_construction_section
			}
			custom_tooltip = {
				fail_text = "ag_requires_usable_ancient_construction_section"
				NOT = {
					has_planet_flag = has_megastructure
				}
			}
		}
	}
	
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		fromfrom.planet = { set_planet_flag = has_megastructure }
		from = {
			country_event = { id = ag_ancient_knowledge.26 }
		}
		# TODO
	}

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}
ag_epsilon_titan_megastructure_1 = {
	entity = "ag_epsilon_titan_part_1_entity"
	construction_entity = "ag_epsilon_titan_part_1_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 2880
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_epsilon_titan_megastructure_0
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = 7500
			nanites = 1500
			sr_dark_matter = 1200
		}
		upkeep = { energy = 30 }
	}
	
	potential = {
		has_technology = tech_ag_epsilon_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_epsilon_titan"
			from = { has_technology = tech_ag_epsilon_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_epsilon_titan"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_epsilon_titan_0
							is_ship_size = ag_epsilon_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_epsilon_titan_megastructure_1
							is_megastructure_type = ag_epsilon_titan_megastructure_2
							is_megastructure_type = ag_epsilon_titan_megastructure_3
						}
					}
					has_special_project = ag_structural_protection_system_501
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		from = {
			country_event = { id = ag_ancient_knowledge.26 }
		}
		# TODO
	}

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}
ag_epsilon_titan_megastructure_2 = {
	entity = "ag_epsilon_titan_part_2_entity"
	construction_entity = "ag_epsilon_titan_part_2_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 2160
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_epsilon_titan_megastructure_1
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = 4000
			nanites = 800
			sr_dark_matter = 1000
		}
		upkeep = { energy = 40 }
	}
	
	potential = {
		has_technology = tech_ag_epsilon_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_epsilon_titan"
			from = { has_technology = tech_ag_epsilon_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_epsilon_titan"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_epsilon_titan_0
							is_ship_size = ag_epsilon_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_epsilon_titan_megastructure_0
							is_megastructure_type = ag_epsilon_titan_megastructure_2
							is_megastructure_type = ag_epsilon_titan_megastructure_3
						}
					}
					has_special_project = ag_structural_protection_system_501
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		from = {
			country_event = { id = ag_ancient_knowledge.26 }
		}
		# TODO
	}

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}
ag_epsilon_titan_megastructure_3 = {
	entity = "ag_epsilon_titan_part_3_entity"
	construction_entity = "ag_epsilon_titan_part_3_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 1440
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_epsilon_titan_megastructure_2
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = 3000
			nanites = 800
			sr_dark_matter = 800
		}
		upkeep = { energy = 50 }
	}
	
	potential = {
		has_technology = tech_ag_epsilon_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_epsilon_titan"
			from = { has_technology = tech_ag_epsilon_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_epsilon_titan"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_epsilon_titan_0
							is_ship_size = ag_epsilon_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_epsilon_titan_megastructure_0
							is_megastructure_type = ag_epsilon_titan_megastructure_1
							is_megastructure_type = ag_epsilon_titan_megastructure_3
						}
					}
					has_special_project = ag_structural_protection_system_501
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		fromfrom.planet = { remove_planet_flag = has_megastructure }
		from = {
			country_event = { id = ag_ancient_knowledge.26 }
		}
		add_threat = { who = from amount = 50 }
		if = {
			limit = { from = { NOT = { has_country_flag = ag_epsilon_ships_unlocked } } }
			ag_epsilon_titan_player_spawn = {
				ag_unlock_ship = no
				ag_owner = from
				ag_location_target = fromfrom
			}
		}
		else = {
			ag_epsilon_titan_player_spawn = {
				ag_unlock_ship = yes
				ag_owner = from
				ag_location_target = fromfrom
			}
		}
		remove_megastructure = fromfrom
		every_country = {
			limit = { NOT = { is_same_value = from } }
			# TODO
		}
	}

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}