
@entity_x = 0
@entity_y = 0

ag_ancient_alpha_megastructure = {
	entity = "ag_alpha_megastructure_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_alpha_psionic_conduit"
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = 1
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	potential = { always = no }
	possible = { always = no }
	placement_rules = { always = no }
	
	resources = {
		category = megastructures
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_energy_percent check_variable = { which = ag_alpha_psionic_conduit_energy_percent value > 0 } } energy = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|energy| }
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_minerals_percent check_variable = { which = ag_alpha_psionic_conduit_minerals_percent value > 0 } } minerals = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|minerals| }
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_food_percent check_variable = { which = ag_alpha_psionic_conduit_food_percent value > 0 } } food = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|food| }
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_consumer_goods_percent check_variable = { which = ag_alpha_psionic_conduit_consumer_goods_percent value > 0 } } consumer_goods = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|consumer_goods| }
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_alloys_percent check_variable = { which = ag_alpha_psionic_conduit_alloys_percent value > 0 } } alloys = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|alloys| }
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_volatile_motes_percent check_variable = { which = ag_alpha_psionic_conduit_volatile_motes_percent value > 0 } } volatile_motes = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|volatile_motes| }
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_exotic_gases_percent check_variable = { which = ag_alpha_psionic_conduit_exotic_gases_percent value > 0 } } exotic_gases = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|exotic_gases| }
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_rare_crystals_percent check_variable = { which = ag_alpha_psionic_conduit_rare_crystals_percent value > 0 } } rare_crystals = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|rare_crystals| }
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_sr_living_metal_percent check_variable = { which = ag_alpha_psionic_conduit_sr_living_metal_percent value > 0 } } sr_living_metal = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|sr_living_metal| }
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_nanites_percent check_variable = { which = ag_alpha_psionic_conduit_nanites_percent value > 0 } } nanites = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|nanites| }
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_sr_dark_matter_percent check_variable = { which = ag_alpha_psionic_conduit_sr_dark_matter_percent value > 0 } } sr_dark_matter = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|sr_dark_matter| }
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_sr_zro_percent check_variable = { which = ag_alpha_psionic_conduit_sr_zro_percent value > 0 } } sr_zro = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|sr_zro| }
		produces = { trigger = { exists = owner is_variable_set = ag_alpha_psionic_conduit_minor_artifacts_percent check_variable = { which = ag_alpha_psionic_conduit_minor_artifacts_percent value > 0 } } minor_artifacts = 1 mult = value:ag_alpha_psionic_conduit_produce|ag_resource|minor_artifacts| }
	}
	
	construction_blocks_and_blocked_by = self_type
	ai_weight = { weight = 0 }
}
ag_ancient_alpha_megastructure_closed = {
	entity = "ag_alpha_megastructure_closed_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = yes
	show_in_outliner = yes
	build_time = 1
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	potential = { always = no }
	possible = { always = no }
	placement_rules = { always = no }
	resources = { category = megastructures upkeep = { energy = 50 } }
	construction_blocks_and_blocked_by = self_type
	ai_weight = { weight = 0 }
}
ag_ancient_alpha_megastructure_damaged = {
	entity = "ag_alpha_megastructure_damaged_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = yes
	show_in_outliner = yes
	build_time = 1
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	potential = { always = no }
	possible = { always = no }
	placement_rules = { always = no }
	construction_blocks_and_blocked_by = self_type
	ai_weight = { weight = 0 }
}

ag_alpha_titan_megastructure_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_alpha_titan_megastructure_0_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	resources = {
		category = megastructures
		cost = {
			alloys = @ag_alpha_titan_megastructure_0_cost_alloys
			influence = @ag_alpha_titan_megastructure_0_cost_influence
		}
		upkeep = { energy = @ag_alpha_titan_megastructure_0_upkeep_energy }
	}
	
	potential = {
		has_technology = tech_ag_alpha_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}		
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_system_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_alpha_titan"
			from = { has_technology = tech_ag_alpha_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_alpha_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_alpha_titan_0
							is_ship_size = ag_alpha_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_alpha_titan_megastructure_0
							is_megastructure_type = ag_alpha_titan_megastructure_1
							is_megastructure_type = ag_alpha_titan_megastructure_2
							is_megastructure_type = ag_alpha_titan_megastructure_3
							is_megastructure_type = ag_alpha_titan_megastructure_4
						}
					}
					has_special_project = ag_structural_protection_system_101
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	placement_rules = {
		planet_possible = {
			ag_is_construction_section = yes
			custom_tooltip = {
				fail_text = "ag_requires_usable_ancient_construction_section"
				NOT = {
					has_planet_flag = has_megastructure
				}
			}
		}
	}
	
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		fromfrom.planet = { set_planet_flag = has_megastructure }
		from = {
			country_event = { id = ag_alpha.110 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
		every_country = {
			limit = { NOT = { is_same_value = from } }
			country_event = { id = ag_alpha.115 }
		}
	}

	construction_blocks_and_blocked_by = self_type
	
	ai_weight = { weight = 1000 }
}
ag_alpha_titan_megastructure_1 = {
	entity = "ag_alpha_titan_megastructure_part_1_entity"
	construction_entity = "ag_alpha_titan_megastructure_part_1_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_alpha_titan_megastructure_1_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_alpha_titan_megastructure_0
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_malphal = @ag_alpha_titan_megastructure_1_cost_sr_living_malphal
			nanites = @ag_alpha_titan_megastructure_1_cost_nanites
			sr_dark_matter = @ag_alpha_titan_megastructure_1_cost_sr_dark_matter
			sr_zro = @ag_alpha_titan_megastructure_1_cost_sr_zro
		}
		upkeep = { energy = @ag_alpha_titan_megastructure_1_upkeep_energy }
	}
	
	potential = {
		has_technology = tech_ag_alpha_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_alpha_titan"
			from = { has_technology = tech_ag_alpha_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_alpha_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_alpha_titan_0
							is_ship_size = ag_alpha_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_alpha_titan_megastructure_1
							is_megastructure_type = ag_alpha_titan_megastructure_2
							is_megastructure_type = ag_alpha_titan_megastructure_3
							is_megastructure_type = ag_alpha_titan_megastructure_4
						}
					}
					has_special_project = ag_structural_protection_system_101
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		if = {
			limit = { fromfrom = { has_megastructure_flag = ag_auto_upgrade_megastructure } }
			system_event = { id = ag_ancient.251 days = 1 scopes = { from = root.fromfrom } }
		}
		else = { from = { country_event = { id = ag_alpha.111 } } }
		from = { country_event = { id = ag_ancient_knowledge.26 } }
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = { weight = 1000 }
}
ag_alpha_titan_megastructure_2 = {
	entity = "ag_alpha_titan_megastructure_part_2_entity"
	construction_entity = "ag_alpha_titan_megastructure_part_2_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_alpha_titan_megastructure_2_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_alpha_titan_megastructure_1
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_malphal = @ag_alpha_titan_megastructure_2_cost_sr_living_malphal
			nanites = @ag_alpha_titan_megastructure_2_cost_nanites
			sr_zro = @ag_alpha_titan_megastructure_2_cost_sr_zro
		}
		upkeep = { energy = @ag_alpha_titan_megastructure_2_upkeep_energy }
	}
	
	potential = {
		has_technology = tech_ag_alpha_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_alpha_titan"
			from = { has_technology = tech_ag_alpha_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_alpha_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_alpha_titan_0
							is_ship_size = ag_alpha_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_alpha_titan_megastructure_0
							is_megastructure_type = ag_alpha_titan_megastructure_2
							is_megastructure_type = ag_alpha_titan_megastructure_3
							is_megastructure_type = ag_alpha_titan_megastructure_4
						}
					}
					has_special_project = ag_structural_protection_system_101
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		if = {
			limit = { fromfrom = { has_megastructure_flag = ag_auto_upgrade_megastructure } }
			system_event = { id = ag_ancient.251 days = 1 scopes = { from = root.fromfrom } }
		}
		else = { from = { country_event = { id = ag_alpha.112 } } }
		from = { country_event = { id = ag_ancient_knowledge.26 } }
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = { weight = 1000 }
}
ag_alpha_titan_megastructure_3 = {
	entity = "ag_alpha_titan_megastructure_part_3_entity"
	construction_entity = "ag_alpha_titan_megastructure_part_3_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_alpha_titan_megastructure_3_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_alpha_titan_megastructure_2
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_malphal = @ag_alpha_titan_megastructure_3_cost_sr_living_malphal
			nanites = @ag_alpha_titan_megastructure_3_cost_nanites
			sr_dark_matter = @ag_alpha_titan_megastructure_3_cost_sr_dark_matter
			sr_zro = @ag_alpha_titan_megastructure_3_cost_sr_zro
		}
		upkeep = { energy = @ag_alpha_titan_megastructure_3_upkeep_energy }
	}
	
	potential = {
		has_technology = tech_ag_alpha_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_alpha_titan"
			from = { has_technology = tech_ag_alpha_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_alpha_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_alpha_titan_0
							is_ship_size = ag_alpha_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_alpha_titan_megastructure_0
							is_megastructure_type = ag_alpha_titan_megastructure_1
							is_megastructure_type = ag_alpha_titan_megastructure_3
							is_megastructure_type = ag_alpha_titan_megastructure_4
						}
					}
					has_special_project = ag_structural_protection_system_101
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		if = {
			limit = { fromfrom = { has_megastructure_flag = ag_auto_upgrade_megastructure } }
			system_event = { id = ag_ancient.251 days = 1 scopes = { from = root.fromfrom } }
		}
		else = { from = { country_event = { id = ag_alpha.113 } } }
		from = { country_event = { id = ag_ancient_knowledge.26 } }
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = { weight = 1000 }
}
ag_alpha_titan_megastructure_4 = {
	entity = "ag_alpha_titan_megastructure_part_4_entity"
	construction_entity = "ag_alpha_titan_megastructure_part_4_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_alpha_titan_megastructure_4_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_alpha_titan_megastructure_3
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_malphal = @ag_alpha_titan_megastructure_4_cost_sr_living_malphal
			nanites = @ag_alpha_titan_megastructure_4_cost_nanites
			sr_dark_matter = @ag_alpha_titan_megastructure_4_cost_sr_dark_matter
			sr_zro = @ag_alpha_titan_megastructure_4_cost_sr_zro
		}
		upkeep = { energy = @ag_alpha_titan_megastructure_4_upkeep_energy }
	}
	
	potential = {
		has_technology = tech_ag_alpha_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_alpha_titan"
			from = { has_technology = tech_ag_alpha_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_alpha_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_alpha_titan_0
							is_ship_size = ag_alpha_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_alpha_titan_megastructure_0
							is_megastructure_type = ag_alpha_titan_megastructure_1
							is_megastructure_type = ag_alpha_titan_megastructure_2
							is_megastructure_type = ag_alpha_titan_megastructure_4
						}
					}
					has_special_project = ag_structural_protection_system_101
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		# from = { if = { limit = { is_ai = yes } country_event = { id = ag_alpha.163 days = 3600 random = 1800 } } }
		fromfrom.planet = { remove_planet_flag = has_megastructure }
		from = {
			country_event = { id = ag_alpha.114 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
		add_threat = { who = from amount = 50 }
		if = {
			limit = { from = { NOT = { has_country_flag = ag_alpha_ships_unlocked } } }
			ag_alpha_titan_player_spawn = {
				ag_unlock_ship = no
				ag_owner = from
				ag_location_target = fromfrom
			}
		}
		else = {
			ag_alpha_titan_player_spawn = {
				ag_unlock_ship = yes
				ag_owner = from
				ag_location_target = fromfrom
			}
		}
		remove_megastructure = fromfrom
		every_country = {
			limit = { NOT = { is_same_value = from } }
			country_event = { id = ag_alpha.116 }
		}
	}

	construction_blocks_and_blocked_by = self_type
	
	ai_weight = { weight = 1000 }
}
