
@entity_x = 0
@entity_y = 0

ag_delta_platform_megastructure = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no
	
	build_time = @ag_delta_platform_megastructure_buildtime
	
	upgrade_desc = hide
	
	entity_offset = { x = @entity_x y = @entity_y }
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_delta_platform_megastructure_cost_sr_living_metal
			nanites = @ag_delta_platform_megastructure_cost_nanites
			sr_dark_matter = @ag_delta_platform_megastructure_cost_sr_dark_matter
		}
		cost = {
			trigger = { owner = { NOT = { has_country_flag = ag_ship_subsystem_enabled_402_13 } } }
			sr_living_metal = @ag_delta_platform_megastructure_extra_cost_sr_living_metal
			nanites = @ag_delta_platform_megastructure_extra_cost_nanites
			sr_dark_matter = @ag_delta_platform_megastructure_extra_cost_sr_dark_matter
		}
	}
	
	potential = {
		NOT = { has_global_flag = ag_ancient_empire_mod_shipyard_building }
		has_technology = tech_ag_delta_platform
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}		
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_system_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_delta_platform"
			from = { has_technology = tech_ag_delta_platform }
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	placement_rules = {
		planet_possible = {
			ag_is_construction_section = yes
			custom_tooltip = {
				fail_text = "ag_requires_usable_ancient_construction_section"
				NOT = {
					has_planet_flag = has_megastructure
				}
			}
		}
	}
	
	on_build_start = {
	}
	on_build_cancel = {
	}
	on_build_complete = {
		from = { if = { limit = { is_ai = yes } country_event = { id = ag_delta.61 days = 3600 random = 1800 } } }
		from = { country_event = { id = ag_ancient_knowledge.26 } }
		if = {
			limit = {
				from = {
					NOT = {
						has_country_flag = ag_delta_platform_built
					}
				}
			}
			from = {
				set_country_flag = ag_delta_platform_built
				country_event = { id = ag_delta.50 }
			}
		}
		else = {
			create_message = {
				type = "MEGASTRUCTURE_BUILT"
				localization = "ag_delta_platform_built_message_desc"
				days = 30
				target = from
				variable = {
					type = name
					localization = "ag_megastructure_system"
					scope = fromfrom.solar_system
				}
			}
		}
		if = {
			limit = {
				from = {
					NOT = {
						has_country_flag = ag_delta_ships_unlocked
					}
				}
			}
			create_fleet = {
				name = "NAME_ag_delta_platform_fleet"
				settings = {
					can_upgrade = no 
					can_change_composition = no 
					can_change_leader = no 
					spawn_debris = no 
				}
				effect = {
					set_fleet_flag = ag_delta_platform_player
					set_owner = from
					create_ship = {
						name = "NAME_ag_delta_platform_ship"
						design = "NAME_ag_delta_platform_00"
						prefix = no
						effect = {
							ag_difficulty_bonus = yes
						}
					}
					set_location = {
						target = fromfrom
						distance = 0
						angle = 0
					}
				}
			}
		}
		else = {
			create_fleet = {
				name = "NAME_ag_delta_platform_fleet"
				settings = {
					can_upgrade = no 
					can_change_composition = no 
					can_change_leader = no 
					spawn_debris = no 
				}
				effect = {
					set_fleet_flag = ag_delta_platform_player
					set_owner = from
					create_ship = {
						name = "NAME_ag_delta_platform_ship"
						design = "NAME_ag_delta_platform_10"
						prefix = no
						effect = {
							ag_difficulty_bonus = yes
						}
					}
					set_location = {
						target = fromfrom
						distance = 0
						angle = 0
					}
				}
			}
		}
		remove_megastructure = fromfrom
	}
	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = {
		weight = 0
	}
}

ag_delta_titan_megastructure_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_delta_titan_megastructure_0_buildtime
	
	upgrade_desc = hide
	
	entity_offset = { x = @entity_x y = @entity_y }
	
	resources = {
		category = megastructures
		cost = {
			alloys = @ag_delta_titan_megastructure_0_cost_alloys
			influence = @ag_delta_titan_megastructure_0_cost_influence
		}
		upkeep = {
			energy = @ag_delta_titan_megastructure_0_upkeep_energy
		}
		
	}
	
	potential = {
		has_technology = tech_ag_delta_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}		
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_system_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_delta_titan"
			from = { has_technology = tech_ag_delta_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_delta_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_delta_titan_0
							is_ship_size = ag_delta_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_delta_titan_megastructure_0
							is_megastructure_type = ag_delta_titan_megastructure_1
							is_megastructure_type = ag_delta_titan_megastructure_2
						}
					}
					has_special_project = ag_structural_protection_system_401
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	placement_rules = {
		planet_possible = {
			ag_is_construction_section = yes
			custom_tooltip = {
				fail_text = "ag_requires_usable_ancient_construction_section"
				NOT = {
					has_planet_flag = has_megastructure
				}
			}
		}
	}
	
	on_build_start = {
	}
	on_build_cancel = {
	}
	on_build_complete = {
		fromfrom.planet = {
			set_planet_flag = has_megastructure
		}
		from = {
			country_event = { id = ag_delta.51 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
		every_country = {
			limit = {
				NOT = { is_same_value = from }
			}
			country_event = { id = ag_delta.54 }
		}
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = {
		weight = 1000
	}

}

ag_delta_titan_megastructure_1 = {
	entity = "ag_delta_titan_part_1_entity"
	construction_entity = "ag_delta_titan_part_1_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_delta_titan_megastructure_1_buildtime
	
	upgrade_desc = hide
	
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_delta_titan_megastructure_0
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_delta_titan_megastructure_1_cost_sr_living_metal
			nanites = @ag_delta_titan_megastructure_1_cost_nanites
			sr_dark_matter = @ag_delta_titan_megastructure_1_cost_sr_dark_matter
		}

		upkeep = {
			energy = @ag_delta_titan_megastructure_1_upkeep_energy
		}
		
	}
	
	potential = {
		has_technology = tech_ag_delta_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_delta_titan"
			from = { has_technology = tech_ag_delta_titan }
		}
		custom_tooltip = {
			fail_text = "requires_no_existing_ag_delta_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_delta_titan_0
							is_ship_size = ag_delta_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_delta_titan_megastructure_1
							is_megastructure_type = ag_delta_titan_megastructure_2
						}
					}
					has_special_project = ag_structural_protection_system_401
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	placement_rules = { }
	
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		if = {
			limit = { fromfrom = { has_megastructure_flag = ag_auto_upgrade_megastructure } }
			system_event = { id = ag_ancient.251 days = 1 scopes = { from = root.fromfrom } }
		}
		else = { from = { country_event = { id = ag_delta.52 } } }
		from = { country_event = { id = ag_ancient_knowledge.26 } }
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = {
		weight = 1000
	}
}

ag_delta_titan_megastructure_2 = {
	entity = "ag_delta_titan_0_hull_entity"
	construction_entity = "ag_delta_titan_part_2_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_delta_titan_megastructure_2_buildtime
	
	upgrade_desc = hide
	
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_delta_titan_megastructure_1
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_delta_titan_megastructure_2_cost_sr_living_metal
			nanites = @ag_delta_titan_megastructure_2_cost_nanites
			sr_dark_matter = @ag_delta_titan_megastructure_2_cost_sr_dark_matter
		}

		upkeep = {
			energy = @ag_delta_titan_megastructure_2_upkeep_energy
		}
		
	}
	
	potential = {
		has_technology = tech_ag_delta_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_delta_titan"
			from = { has_technology = tech_ag_delta_titan }
		}
		custom_tooltip = {
			fail_text = "requires_no_existing_ag_delta_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_delta_titan_0
							is_ship_size = ag_delta_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_delta_titan_megastructure_0
							is_megastructure_type = ag_delta_titan_megastructure_2
						}
					}
					has_special_project = ag_structural_protection_system_401
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	placement_rules = {
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		from = { if = { limit = { is_ai = yes } country_event = { id = ag_delta.61 days = 3600 random = 1800 } } }
		fromfrom.planet = {
			remove_planet_flag = has_megastructure
		}
		from = {
			country_event = { id = ag_delta.53 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
		add_threat = {
			who = from
			amount = 50
		}
		if = {
			limit = { from = { NOT = { has_country_flag = ag_delta_ships_unlocked } } }
			ag_delta_titan_player_spawn = {
				ag_unlock_ship = no
				ag_owner = from
				ag_location_target = fromfrom
			}
		}
		else = {
			ag_delta_titan_player_spawn = {
				ag_unlock_ship = yes
				ag_owner = from
				ag_location_target = fromfrom
			}
		}
		remove_megastructure = fromfrom
		every_country = {
			limit = {
				NOT = { is_same_value = from }
			}
			country_event = { id = ag_delta.55 }
		}
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = {
		weight = 1000
	}

}