
@entity_x = 12
@entity_y = 12

ag_ancient_eta_gateway_megastructure_0 = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no

	build_time = @ag_ancient_eta_gateway_megastructure_0_buildtime
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_ancient_eta_gateway_megastructure_0_cost_sr_living_metal
			nanites = @ag_ancient_eta_gateway_megastructure_0_cost_nanites
			sr_dark_matter = @ag_ancient_eta_gateway_megastructure_0_cost_sr_dark_matter
			influence = @ag_ancient_eta_gateway_megastructure_0_cost_influence
		}
		cost = {
			trigger = { owner = { NOT = { has_country_flag = ag_ship_subsystem_enabled_601_32 } } }
			sr_living_metal = @ag_ancient_eta_gateway_megastructure_0_extra_cost_sr_living_metal
			nanites = @ag_ancient_eta_gateway_megastructure_0_extra_cost_nanites
			sr_dark_matter = @ag_ancient_eta_gateway_megastructure_0_extra_cost_sr_dark_matter
		}
		upkeep = { trigger = { exists = owner } energy = @ag_ancient_eta_gateway_megastructure_0_upkeep_energy }
	}

	
	construction_blocks_and_blocked_by = self_type

	prerequisites = { "tech_ag_ancient_eta_gateway" }
	potential = {
		NOT = { has_global_flag = ag_ancient_empire_mod_shipyard_building }
		has_technology = "tech_ag_ancient_eta_gateway"
	}
	possible = {
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}		
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_system_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_ancient_eta_gateway"
			from = { has_technology = tech_ag_ancient_eta_gateway }
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	placement_rules = {
		planet_possible = {
			ag_is_construction_section = yes
			custom_tooltip = {
				fail_text = "ag_requires_usable_ancient_construction_section"
				NOT = {
					has_planet_flag = has_megastructure
				}
			}
		}
	}

	ai_weight = { factor = 0 }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		from = { if = { limit = { is_ai = yes } country_event = { id = ag_eta.163 days = 3600 random = 1800 } } }
		if = {
			limit = { from = { NOT = { has_country_flag = ag_eta_gateway_built } } }
			from = {
				set_country_flag = ag_eta_gateway_built
				country_event = { id = ag_eta.1001 }
			}
		}
		else = {
			create_message = {
				type = "MEGASTRUCTURE_BUILT"
				localization = "ag_eta_gateway_built_message_desc"
				days = 30
				target = from
				variable = {
					type = name
					localization = "ag_megastructure_system"
					scope = fromfrom.solar_system
				}
			}
		}
		if = {
			limit = { from = { NOT = { has_country_flag = ag_eta_ships_unlocked } } }
			ag_eta_gateway_player_spawn = {
				ag_unlock_ship = no
				ag_owner = root.from
				ag_location_target = root.fromfrom
				ag_location_distance = 0
				ag_location_angle = 0
			}
		}
		else = {
			ag_eta_gateway_player_spawn = {
				ag_unlock_ship = yes
				ag_owner = root.from
				ag_location_target = root.fromfrom
				ag_location_distance = 0
				ag_location_angle = 0
			}
		}
		remove_megastructure = fromfrom
	}
}

ag_ancient_eta_gateway_megastructure_1 = {
	entity = "ag_eta_gateway_0_megastructure_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_eta_gateway_opened_blue"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no
	prerequisites = { "tech_ag_ancient_eta_gateway" }
	potential = { always = no }
	resources = {
		category = megastructures
		upkeep = { trigger = { exists = owner } energy = 5 }
		upkeep = {
			trigger = { exists = owner solar_system = { has_star_flag = ag_ancient_eta_gateway_galactic_gateway_enabled } }
			energy = 10
		}
		upkeep = {
			trigger = { exists = owner solar_system = { has_star_flag = ag_ancient_eta_gateway_lgate_enabled } }
			energy = 10
		}
		upkeep = {
			trigger = { exists = owner solar_system = { has_star_flag = ag_ancient_eta_gateway_ancient_gateway_enabled } }
			energy = 10
		}
		upkeep = {
			trigger = { exists = owner solar_system = { has_star_flag = ag_ancient_eta_gateway_wormhole_temporary_enabled } }
			energy = 75
			sr_dark_matter = 5
		}
	}
	upgrade_desc = hide
	
	construction_blocks_and_blocked_by = self_type
	ai_weight = { factor = 0 }
}
ag_ancient_eta_gateway_megastructure_2 = {
	entity = "ag_eta_gateway_1_megastructure_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_eta_gateway_opened_red"
	place_entity_on_planet_plane = no
	
	show_galactic_map_icon = no
	show_in_outliner = no
	potential = { always = no }
	resources = {
		category = megastructures
		upkeep = { trigger = { exists = owner } energy = 5 }
		upkeep = {
			trigger = { exists = owner solar_system = { has_star_flag = ag_ancient_eta_gateway_galactic_gateway_enabled } }
			energy = 10
		}
		upkeep = {
			trigger = { exists = owner solar_system = { has_star_flag = ag_ancient_eta_gateway_lgate_enabled } }
			energy = 10
		}
		upkeep = {
			trigger = { exists = owner solar_system = { has_star_flag = ag_ancient_eta_gateway_ancient_gateway_enabled } }
			energy = 10
		}
		upkeep = {
			trigger = { exists = owner solar_system = { has_star_flag = ag_ancient_eta_gateway_wormhole_temporary_enabled } }
			energy = 75
			sr_dark_matter = 5
		}
	}
	upgrade_desc = hide
	
	construction_blocks_and_blocked_by = self_type
	ai_weight = { factor = 0 }
}
ag_ancient_eta_gateway_megastructure_3 = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no

	potential = { has_global_flag = ag_eta_titan_event_ended has_technology = "tech_ag_ancient_eta_gateway" NOT = { has_global_flag = ag_ancient_eta_gateway_menu_opened } }
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_eta_gateway_controll_station"
			exists = event_target:ag_eta_gateway_controller
			from = { is_same_value = event_target:ag_eta_gateway_controller }
		}
	}
	upgrade_from = { ag_ancient_eta_gateway_megastructure_2 }

	build_time = 10
	resources = {
		category = megastructures
		cost = { energy = 500 }
		upkeep = { trigger = { exists = owner } energy = 5 }
	}

	
	construction_blocks_and_blocked_by = self_type

	ai_weight = { factor = 0 }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		if = {
			limit = { exists = event_target:ag_eta_gateway_ctrl_target_system }
			clear_global_event_target = ag_eta_gateway_ctrl_target_system
		}
		save_global_event_target_as = ag_eta_gateway_ctrl_target_system
		from = {
			set_global_flag = ag_ancient_eta_gateway_menu_opened
			country_event = { id = ag_eta.1021 }
		}
		spawn_megastructure = {
			type = ag_ancient_eta_gateway_megastructure_2
			coords_from = fromfrom
			owner = from
		}
		remove_megastructure = fromfrom
	}
}
ag_ancient_eta_gateway_megastructure_4 = {
	entity = "ag_eta_gateway_1_closed_megastructure_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_eta_gateway_closed_red"
	place_entity_on_planet_plane = no
	
	show_galactic_map_icon = no
	show_in_outliner = no
	potential = { always = no }
	resources = {
		category = megastructures
		upkeep = { trigger = { exists = owner } energy = 5 }
		upkeep = {
			trigger = { exists = owner solar_system = { has_star_flag = ag_ancient_eta_gateway_galactic_gateway_enabled } }
			energy = 10
		}
		upkeep = {
			trigger = { exists = owner solar_system = { has_star_flag = ag_ancient_eta_gateway_lgate_enabled } }
			energy = 10
		}
		upkeep = {
			trigger = { exists = owner solar_system = { has_star_flag = ag_ancient_eta_gateway_ancient_gateway_enabled } }
			energy = 10
		}
		upkeep = {
			trigger = { exists = owner solar_system = { has_star_flag = ag_ancient_eta_gateway_wormhole_temporary_enabled } }
			energy = 75
			sr_dark_matter = 5
		}
	}
	upgrade_desc = hide
	
	construction_blocks_and_blocked_by = self_type
	ai_weight = { factor = 0 }
}
ag_ancient_eta_gateway_megastructure_5 = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no

	potential = { has_global_flag = ag_eta_titan_event_ended has_technology = "tech_ag_ancient_eta_gateway" NOT = { has_global_flag = ag_ancient_eta_gateway_menu_opened } }
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_eta_gateway_controll_station"
			exists = event_target:ag_eta_gateway_controller
			from = { is_same_value = event_target:ag_eta_gateway_controller }
		}
	}
	upgrade_from = { ag_ancient_eta_gateway_megastructure_4 }

	build_time = 10
	resources = {
		category = megastructures
		cost = { energy = 500 }
		upkeep = { trigger = { exists = owner } energy = 5 }
	}

	
	construction_blocks_and_blocked_by = self_type

	ai_weight = { factor = 0 }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		if = {
			limit = { exists = event_target:ag_eta_gateway_ctrl_target_system }
			clear_global_event_target = ag_eta_gateway_ctrl_target_system
		}
		save_global_event_target_as = ag_eta_gateway_ctrl_target_system
		from = {
			set_global_flag = ag_ancient_eta_gateway_menu_opened
			country_event = { id = ag_eta.1021 }
		}
		spawn_megastructure = {
			type = ag_ancient_eta_gateway_megastructure_4
			coords_from = fromfrom
			owner = from
		}
		remove_megastructure = fromfrom
	}
}
ag_ancient_eta_gateway_megastructure_opening_blue = {
	entity = "ag_eta_gateway_0_opening_megastructure_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no
	potential = { always = no }
	resources = { category = megastructures upkeep = { trigger = { exists = owner } energy = 5 } }
	upgrade_desc = hide
	
	construction_blocks_and_blocked_by = self_type
	ai_weight = { factor = 0 }
}
ag_ancient_eta_gateway_megastructure_opening = {
	entity = "ag_eta_gateway_1_opening_megastructure_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no
	potential = { always = no }
	resources = { category = megastructures upkeep = { trigger = { exists = owner } energy = 5 } }
	upgrade_desc = hide
	
	construction_blocks_and_blocked_by = self_type
	ai_weight = { factor = 0 }
}
ag_ancient_eta_gateway_megastructure_closing = {
	entity = "ag_eta_gateway_1_closing_megastructure_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no
	potential = { always = no }
	resources = { category = megastructures upkeep = { trigger = { exists = owner } energy = 5 } }
	upgrade_desc = hide
	
	construction_blocks_and_blocked_by = self_type
	ai_weight = { factor = 0 }
}

ag_ancient_eta_gateway_megastructure_damaged = {
	entity = "ag_eta_gateway_damaged_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = yes
	potential = { always = no }
	
	construction_blocks_and_blocked_by = self_type
}
ag_ancient_eta_gateway_megastructure_damaged_alt = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no

	prerequisites = { "tech_ag_ancient_eta_gateway_activation" }
	potential = { has_technology = "tech_ag_ancient_eta_gateway_activation" }
	possible = { always = yes }
	upgrade_from = { ag_ancient_eta_gateway_megastructure_damaged }

	build_time = @ag_ancient_eta_gateway_megastructure_damaged_buildtime
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_ancient_eta_gateway_megastructure_damaged_cost_sr_living_metal
			nanites = @ag_ancient_eta_gateway_megastructure_damaged_cost_nanites
			sr_dark_matter = @ag_ancient_eta_gateway_megastructure_damaged_cost_sr_dark_matter
			energy = @ag_ancient_eta_gateway_megastructure_damaged_cost_energy
		}
		upkeep = { trigger = { exists = owner } energy = @ag_ancient_eta_gateway_megastructure_damaged_upkeep_energy }
	}

	
	construction_blocks_and_blocked_by = self_type

	ai_weight = { factor = 0 }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		if = {
			limit = { has_star_flag = ag_ancient_eta_system }
			from = { country_event = { id = ag_eta.11 } }
		}
		else = { from = { country_event = { id = ag_eta.1003 } } }
		every_country = {
			limit = { NOT = { is_same_value = from } }
			create_message = {
				type = "ALIEN_MEGASTRUCTURE_BUILT"
				localization = "ag_eta_gateway_frame_built_message_desc"
				days = 30
				target = this
				variable = {
					type = name
					localization = "ag_owner_country"
					scope = from
				}
				variable = {
					type = name
					localization = "ag_megastructure_system"
					scope = fromfrom.solar_system
				}
			}
		}
		if = {
			limit = { from = { NOT = { has_country_flag = ag_eta_ships_unlocked } } }
			fromfrom = {
				ag_eta_create_gateway_portal = { ag_type = galactic_gateway }
				ag_eta_upgrade_gateway_frame = { ag_target_level = 1 }
			}
		}
		else = { fromfrom = { ag_eta_upgrade_gateway_frame = { ag_target_level = 2 } } }
	}
}

ag_ancient_eta_gateway_megastructure_closed = {
	entity = "ag_eta_gateway_closed_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = yes
	potential = { always = no }
	
	construction_blocks_and_blocked_by = self_type
}
ag_ancient_eta_gateway_megastructure_closed_alt = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no

	prerequisites = { "tech_ag_ancient_eta_gateway_activation" }
	potential = { has_technology = "tech_ag_ancient_eta_gateway_activation" }
	possible = { always = yes }
	upgrade_from = { ag_ancient_eta_gateway_megastructure_closed }

	build_time = @ag_ancient_eta_gateway_megastructure_closed_buildtime
	resources = {
		category = megastructures
		cost = {
			sr_dark_matter = @ag_ancient_eta_gateway_megastructure_closed_cost_sr_dark_matter
			energy = @ag_ancient_eta_gateway_megastructure_closed_cost_energy
		}
		upkeep = { trigger = { exists = owner } energy = @ag_ancient_eta_gateway_megastructure_closed_upkeep_energy }
	}

	
	construction_blocks_and_blocked_by = self_type

	ai_weight = { factor = 0 }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		from = { country_event = { id = ag_eta.1004 } }
		every_country = {
			limit = { NOT = { is_same_value = from } }
			create_message = {
				type = "ALIEN_MEGASTRUCTURE_BUILT"
				localization = "ag_eta_gateway_frame_built_message_desc"
				days = 30
				target = this
				variable = {
					type = name
					localization = "ag_owner_country"
					scope = from
				}
				variable = {
					type = name
					localization = "ag_megastructure_system"
					scope = fromfrom.solar_system
				}
			}
		}
		if = {
			limit = { from = { NOT = { has_country_flag = ag_eta_ships_unlocked } } }
			fromfrom = {
				ag_eta_create_gateway_portal = { ag_type = galactic_gateway }
				ag_eta_upgrade_gateway_frame = { ag_target_level = 1 }
			}
		}
		else = { fromfrom = { ag_eta_upgrade_gateway_frame = { ag_target_level = 2 } } }
	}
}
ag_ancient_eta_gateway_megastructure_burst = {
	entity = "ag_eta_gateway_1_alt_megastructure_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_eta_gateway_opened_red"
	place_entity_on_planet_plane = no
	
	show_galactic_map_icon = no
	show_in_outliner = no
	potential = { always = no }
	resources = {
		category = megastructures
		upkeep = { trigger = { exists = owner } energy = 25 }
		produces = { trigger = { exists = owner } sr_dark_matter = 5 }
	}
	
	construction_blocks_and_blocked_by = self_type
	ai_weight = { factor = 0 }
}

ag_ancient_eta_gateway_control_megastructure_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_ancient_eta_gateway_control_megastructure_0_buildtime
	
	upgrade_desc = hide
	
	entity_offset = { x = @entity_x y = @entity_y }
	
	resources = {
		category = megastructures
		cost = {
			alloys = @ag_ancient_eta_gateway_control_megastructure_0_cost_alloys
			influence = @ag_ancient_eta_gateway_control_megastructure_0_cost_influence
		}
		upkeep = { energy = @ag_ancient_eta_gateway_control_megastructure_0_upkeep_energy }
	}
	
	potential = {
		# Cannot build control station.
		always = no
		has_technology = tech_ag_ancient_eta_gateway_control_station
	}
	possible = {
		exists = starbase
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}		
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_system_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_ancient_eta_gateway_control_station"
			from = { has_technology = tech_ag_ancient_eta_gateway_control_station }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_gateway_control_station"
			NOT = { any_system_megastructure = { OR = {
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_0
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_1
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_2
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_3
			} } }
		}
	}
	placement_rules = {
		planet_possible = {
			custom_tooltip = {
				fail_text = "must_build_around_star"
				is_star = yes
			}
			custom_tooltip = {
				fail_text = "requires_no_anomaly"
				NOT = { has_anomaly = yes }
			}
			custom_tooltip = {
				fail_text = "requires_no_existing_megastructure"
				NOT = { has_planet_flag = has_megastructure }
			}
		}
	}
	
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		fromfrom.planet = { set_planet_flag = has_megastructure }
		from = {
			country_event = { id = ag_eta.1005 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
		every_country = {
			limit = { NOT = { is_same_value = from } }
			country_event = { id = ag_eta.1009 }
		}
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = { weight = 0 }
}
ag_ancient_eta_gateway_control_megastructure_1 = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_ancient_eta_gateway_control_megastructure_1_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = { ag_ancient_eta_gateway_control_megastructure_0 }
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_ancient_eta_gateway_control_megastructure_1_cost_sr_living_metal
			nanites = @ag_ancient_eta_gateway_control_megastructure_1_cost_nanites
			sr_dark_matter = @ag_ancient_eta_gateway_control_megastructure_1_cost_sr_dark_matter
		}
		upkeep = { energy = @ag_ancient_eta_gateway_control_megastructure_1_upkeep_energy }
	}
	
	potential = { has_technology = tech_ag_ancient_eta_gateway_control_station }
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_ancient_eta_gateway_control_station"
			from = { has_technology = tech_ag_ancient_eta_gateway_control_station }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_gateway_control_station"
			NOT = { any_system_megastructure = { OR = {
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_1
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_2
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_3
			} } }
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		from = {
			country_event = { id = ag_eta.1006 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = { weight = 0 }
}
ag_ancient_eta_gateway_control_megastructure_2 = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_ancient_eta_gateway_control_megastructure_2_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = { ag_ancient_eta_gateway_control_megastructure_1 }
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_ancient_eta_gateway_control_megastructure_2_cost_sr_living_metal
			nanites = @ag_ancient_eta_gateway_control_megastructure_2_cost_nanites
			sr_dark_matter = @ag_ancient_eta_gateway_control_megastructure_2_cost_sr_dark_matter
		}
		upkeep = { energy = @ag_ancient_eta_gateway_control_megastructure_2_upkeep_energy }
	}
	
	potential = { has_technology = tech_ag_ancient_eta_gateway_control_station }
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_ancient_eta_gateway_control_station"
			from = { has_technology = tech_ag_ancient_eta_gateway_control_station }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_gateway_control_station"
			NOT = { any_system_megastructure = { OR = {
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_0
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_2
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_3
			} } }
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		from = {
			country_event = { id = ag_eta.1007 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = { weight = 0 }
}
ag_ancient_eta_gateway_control_megastructure_3 = {
	entity = "ag_eta_gateway_control_station_1_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_ancient_eta_gateway_control_megastructure_3_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = { ag_ancient_eta_gateway_control_megastructure_2 }
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_ancient_eta_gateway_control_megastructure_3_cost_sr_living_metal
			nanites = @ag_ancient_eta_gateway_control_megastructure_3_cost_nanites
			sr_dark_matter = @ag_ancient_eta_gateway_control_megastructure_3_cost_sr_dark_matter
		}
		upkeep = { energy = @ag_ancient_eta_gateway_control_megastructure_3_upkeep_energy }
	}
	
	potential = { has_technology = tech_ag_ancient_eta_gateway_control_station }
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_ancient_eta_gateway_control_station"
			from = { has_technology = tech_ag_ancient_eta_gateway_control_station }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_gateway_control_station"
			NOT = { any_system_megastructure = { OR = {
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_0
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_1
				is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_3
			} } }
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		from = {
			country_event = { id = ag_eta.1008 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
		every_country = {
			limit = { NOT = { is_same_value = from } }
			country_event = { id = ag_eta.1010 }
		}
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = { weight = 0 }
}
ag_ancient_eta_gateway_control_damaged = {
	entity = "ag_eta_gateway_control_station_damaged_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	show_galactic_map_icon = yes
	show_in_outliner = yes
	potential = { always = no }
	
	construction_blocks_and_blocked_by = self_type
	ai_weight = { factor = 0 }
}
ag_ancient_eta_gateway_control_restored = {
	entity = "ag_eta_gateway_control_station_1_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_ancient_eta_gateway_control_restored_buildtime
	upgrade_desc = hide
	
	upgrade_from = { ag_ancient_eta_gateway_control_damaged }
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_ancient_eta_gateway_control_restored_cost_sr_living_metal
			nanites = @ag_ancient_eta_gateway_control_restored_cost_nanites
			sr_dark_matter = @ag_ancient_eta_gateway_control_restored_cost_sr_dark_matter
		}
		upkeep = { energy = @ag_ancient_eta_gateway_control_restored_upkeep_energy }
	}

	potential = { has_country_flag = ag_eta_102_fired }

	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		set_global_flag = ag_ancient_eta_gateway_control_restored
		from = { country_event = { id = ag_eta.103 } country_event = { id = ag_ancient_knowledge.26 } }
	}

	
	construction_blocks_and_blocked_by = self_type

	ai_weight = { factor = 1000 }
}
ag_ancient_eta_gateway_control_restored_1 = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	show_galactic_map_icon = yes
	show_in_outliner = yes

	build_time = 10
	upgrade_desc = hide

	upgrade_from = { ag_ancient_eta_gateway_control_restored }

	resources = {
		category = megastructures
		cost = { energy = 500 }
		upkeep = { trigger = { exists = owner } energy = 5 }
	}

	potential = {
		has_country_flag = ag_eta_102_fired
		NOR = {
			has_global_flag = ag_ancient_eta_gateway_control_settings_opened
			has_global_flag = ag_ancient_eta_gateway_control_test
			has_global_flag = ag_eta_titan_event_ended
		}
	}
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_eta_gateway_not_hostile"
			NOT = { has_global_flag = ag_eta_gateway_is_hostile }
		}
	}

	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		from = {
			set_global_flag = ag_ancient_eta_gateway_control_settings_opened
			country_event = { id = ag_eta.104 }
		}
		spawn_megastructure = {
			type = ag_ancient_eta_gateway_control_restored
			coords_from = fromfrom
			owner = from
		}
		remove_megastructure = fromfrom
	}

	
	construction_blocks_and_blocked_by = self_type

	ai_weight = { factor = 0 }
}
ag_ancient_eta_gateway_control_restored_2 = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_megastructure_construction_background"
	show_galactic_map_icon = yes
	show_in_outliner = yes

	build_time = 10
	upgrade_desc = hide

	upgrade_from = { ag_ancient_eta_gateway_control_restored }

	resources = {
		category = megastructures
		cost = { energy = 500 }
		upkeep = { trigger = { exists = owner } energy = 5 }
	}

	potential = {
		has_country_flag = ag_eta_102_fired
		has_country_flag = ag_eta_gateway_control_test_available
		NOR = {
			has_global_flag = ag_ancient_eta_gateway_control_settings_opened
			has_global_flag = ag_ancient_eta_gateway_control_test
			has_global_flag = ag_eta_titan_event_ended
		}
	}
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_eta_gateway_not_hostile"
			NOT = { has_global_flag = ag_eta_gateway_is_hostile }
		}
	}

	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		from = {
			set_global_flag = ag_ancient_eta_gateway_control_test
			country_event = { id = ag_eta.105 }
		}
		spawn_megastructure = {
			type = ag_ancient_eta_gateway_control_restored
			coords_from = fromfrom
			owner = from
		}
		remove_megastructure = fromfrom
	}

	
	construction_blocks_and_blocked_by = self_type

	ai_weight = { factor = 0 }
}

ag_ancient_eta_gateway_galactic_gateway = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_ancient_eta_gateway_galactic_gateway"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no
	potential = { always = no }
	
	construction_blocks_and_blocked_by = self_type
	bypass_type = gateway
}
ag_ancient_eta_gateway_lgate = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_ancient_eta_gateway_lgate"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no
	potential = { always = no }
	
	construction_blocks_and_blocked_by = self_type
	bypass_type = lgate
}
ag_ancient_eta_gateway_ancient_gateway = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_ancient_eta_gateway_ancient_gateway"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no
	potential = { always = no }
	
	construction_blocks_and_blocked_by = self_type
	bypass_type = ag_ancient_eta_gateway
}
ag_ancient_eta_gateway_wormhole_temporary = {
	entity = "ag_void_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_ancient_eta_gateway_wormhole_temporary"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no
	potential = { always = no }
	
	construction_blocks_and_blocked_by = self_type
	bypass_type = ag_ancient_eta_wormhole_temporary
}
ag_ancient_eta_gateway_wormhole_temporary_alt = {
	entity = "ag_eta_gateway_wormhole_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_ancient_eta_gateway_wormhole_temporary"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	show_in_outliner = no
	potential = { always = no }
	
	construction_blocks_and_blocked_by = self_type
	bypass_type = ag_ancient_eta_wormhole_temporary
}

ag_eta_titan_megastructure_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_eta_titan_megastructure_0_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	resources = {
		category = megastructures
		cost = {
			alloys = @ag_eta_titan_megastructure_0_cost_alloys
			influence = @ag_eta_titan_megastructure_0_cost_influence
		}
		upkeep = { energy = @ag_eta_titan_megastructure_0_upkeep_energy }
	}
	
	potential = {
		has_technology = tech_ag_eta_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}		
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_system_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_eta_titan"
			from = { has_technology = tech_ag_eta_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_eta_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_eta_titan_0
							is_ship_size = ag_eta_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_eta_titan_megastructure_0
							is_megastructure_type = ag_eta_titan_megastructure_1
							is_megastructure_type = ag_eta_titan_megastructure_2
							is_megastructure_type = ag_eta_titan_megastructure_3
							is_megastructure_type = ag_eta_titan_megastructure_4
						}
					}
					has_special_project = ag_structural_protection_system_602
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	placement_rules = {
		planet_possible = {
			ag_is_construction_section = yes
			custom_tooltip = {
				fail_text = "ag_requires_usable_ancient_construction_section"
				NOT = {
					has_planet_flag = has_megastructure
				}
			}
		}
	}
	
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		fromfrom.planet = { set_planet_flag = has_megastructure }
		from = {
			country_event = { id = ag_eta.1061 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
		every_country = {
			limit = { NOT = { is_same_value = from } }
			country_event = { id = ag_eta.1066 }
		}
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = { weight = 1000 }
}
ag_eta_titan_megastructure_1 = {
	entity = "ag_eta_titan_part_1_entity"
	construction_entity = "ag_eta_titan_part_1_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_eta_titan_megastructure_1_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_eta_titan_megastructure_0
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_eta_titan_megastructure_1_cost_sr_living_metal
			nanites = @ag_eta_titan_megastructure_1_cost_nanites
			sr_dark_matter = @ag_eta_titan_megastructure_1_cost_sr_dark_matter
		}
		upkeep = { energy = @ag_eta_titan_megastructure_1_upkeep_energy }
	}
	
	potential = {
		has_technology = tech_ag_eta_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_eta_titan"
			from = { has_technology = tech_ag_eta_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_eta_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_eta_titan_0
							is_ship_size = ag_eta_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_eta_titan_megastructure_1
							is_megastructure_type = ag_eta_titan_megastructure_2
							is_megastructure_type = ag_eta_titan_megastructure_3
							is_megastructure_type = ag_eta_titan_megastructure_4
						}
					}
					has_special_project = ag_structural_protection_system_602
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		if = {
			limit = { fromfrom = { has_megastructure_flag = ag_auto_upgrade_megastructure } }
			system_event = { id = ag_ancient.251 days = 1 scopes = { from = root.fromfrom } }
		}
		else = { from = { country_event = { id = ag_eta.1062 } } }
		from = { country_event = { id = ag_ancient_knowledge.26 } }
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = { weight = 1000 }
}
ag_eta_titan_megastructure_2 = {
	entity = "ag_eta_titan_part_2_entity"
	construction_entity = "ag_eta_titan_part_2_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_eta_titan_megastructure_2_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_eta_titan_megastructure_1
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_eta_titan_megastructure_2_cost_sr_living_metal
			nanites = @ag_eta_titan_megastructure_2_cost_nanites
			sr_dark_matter = @ag_eta_titan_megastructure_2_cost_sr_dark_matter
		}
		upkeep = { energy = @ag_eta_titan_megastructure_2_upkeep_energy }
	}
	
	potential = {
		has_technology = tech_ag_eta_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_eta_titan"
			from = { has_technology = tech_ag_eta_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_eta_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_eta_titan_0
							is_ship_size = ag_eta_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_eta_titan_megastructure_0
							is_megastructure_type = ag_eta_titan_megastructure_2
							is_megastructure_type = ag_eta_titan_megastructure_3
							is_megastructure_type = ag_eta_titan_megastructure_4
						}
					}
					has_special_project = ag_structural_protection_system_602
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		if = {
			limit = { fromfrom = { has_megastructure_flag = ag_auto_upgrade_megastructure } }
			system_event = { id = ag_ancient.251 days = 1 scopes = { from = root.fromfrom } }
		}
		else = { from = { country_event = { id = ag_eta.1063 } } }
		from = { country_event = { id = ag_ancient_knowledge.26 } }
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = { weight = 1000 }
}
ag_eta_titan_megastructure_3 = {
	entity = "ag_eta_titan_part_3_entity"
	construction_entity = "ag_eta_titan_part_3_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_eta_titan_megastructure_3_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_eta_titan_megastructure_2
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_eta_titan_megastructure_3_cost_sr_living_metal
			nanites = @ag_eta_titan_megastructure_3_cost_nanites
			sr_dark_matter = @ag_eta_titan_megastructure_3_cost_sr_dark_matter
		}
		upkeep = { energy = @ag_eta_titan_megastructure_3_upkeep_energy }
	}
	
	potential = {
		has_technology = tech_ag_eta_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_eta_titan"
			from = { has_technology = tech_ag_eta_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_eta_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_eta_titan_0
							is_ship_size = ag_eta_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_eta_titan_megastructure_0
							is_megastructure_type = ag_eta_titan_megastructure_1
							is_megastructure_type = ag_eta_titan_megastructure_3
							is_megastructure_type = ag_eta_titan_megastructure_4
						}
					}
					has_special_project = ag_structural_protection_system_602
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		if = {
			limit = { fromfrom = { has_megastructure_flag = ag_auto_upgrade_megastructure } }
			system_event = { id = ag_ancient.251 days = 1 scopes = { from = root.fromfrom } }
		}
		else = { from = { country_event = { id = ag_eta.1064 } } }
		from = { country_event = { id = ag_ancient_knowledge.26 } }
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = { weight = 1000 }
}
ag_eta_titan_megastructure_4 = {
	entity = "ag_eta_titan_part_4_entity"
	construction_entity = "ag_eta_titan_part_4_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	show_in_outliner = yes
	
	build_time = @ag_eta_titan_megastructure_4_buildtime
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_eta_titan_megastructure_3
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = @ag_eta_titan_megastructure_4_cost_sr_living_metal
			nanites = @ag_eta_titan_megastructure_4_cost_nanites
			sr_dark_matter = @ag_eta_titan_megastructure_4_cost_sr_dark_matter
		}
		upkeep = { energy = @ag_eta_titan_megastructure_4_upkeep_energy }
	}
	
	potential = {
		has_technology = tech_ag_eta_titan
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_eta_titan"
			from = { has_technology = tech_ag_eta_titan }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_eta_titan"
			from = {
				NOR = {
					any_controlled_ship = {
						OR = {
							is_ship_size = ag_eta_titan_0
							is_ship_size = ag_eta_titan_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_eta_titan_megastructure_0
							is_megastructure_type = ag_eta_titan_megastructure_1
							is_megastructure_type = ag_eta_titan_megastructure_2
							is_megastructure_type = ag_eta_titan_megastructure_4
						}
					}
					has_special_project = ag_structural_protection_system_602
				}
			}
		}
		# custom_tooltip = {
		# 	fail_text = "ag_requires_usable_ancient_construction_section"
		# 	NOT = {
		# 		any_system_planet = {
		# 			has_planet_flag = ag_using_ancient_construction_section_system
		# 		}
		# 	}
		# }
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		from = { if = { limit = { is_ai = yes } country_event = { id = ag_eta.163 days = 3600 random = 1800 } } }
		fromfrom.planet = { remove_planet_flag = has_megastructure }
		from = {
			country_event = { id = ag_eta.1065 }
			country_event = { id = ag_ancient_knowledge.26 }
		}
		add_threat = { who = from amount = 50 }
		if = {
			limit = { from = { NOT = { has_country_flag = ag_eta_ships_unlocked } } }
			ag_eta_titan_player_spawn = {
				ag_unlock_ship = no
				ag_owner = from
				ag_location_target = fromfrom
			}
		}
		else = {
			ag_eta_titan_player_spawn = {
				ag_unlock_ship = yes
				ag_owner = from
				ag_location_target = fromfrom
			}
		}
		remove_megastructure = fromfrom
		every_country = {
			limit = { NOT = { is_same_value = from } }
			country_event = { id = ag_eta.1067 }
		}
	}

	construction_blocks_and_blocked_by = self_type
	
	
	ai_weight = { weight = 1000 }
}
