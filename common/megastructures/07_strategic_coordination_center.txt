@makeshift_naval_cap            = 25
@makeshift_starbase_capacity    = 1
@makeshift_defense_platform     = 2
@makeshift_ship_speed           = 0
@stage_1_naval_cap              = 50
@stage_1_starbase_capacity      = 2
@stage_1_defense_platform       = 4
@stage_1_ship_speed             = 0.05
@stage_2_naval_cap              = 100
@stage_2_starbase_capacity      = 4
@stage_2_defense_platform       = 8
@stage_2_ship_speed             = 0.10
@stage_3_naval_cap              = 150
@stage_3_starbase_capacity      = 6
@stage_3_defense_platform       = 12
@stage_3_ship_speed             = 0.15


# Strategic Coordination Center
strategic_coordination_center_0 = {
    entity = "construction_platform_entity"
    construction_entity = "construction_platform_entity"
    portrait = "GFX_megastructure_construction_background"
    place_entity_on_planet_plane = no
    entity_offset = { x = -27 y = -27 }
	build_outside_gravity_well = no 						# indicates this will use "free" placement between the system's inner and outer ring
    build_time = 1800
    resources = {
        category = megastructures
        cost = {
            alloys = 5000
            influence = 300
        }

        upkeep = {
            energy = 5
        }
    }

    prerequisites = { "tech_strategic_coordination" }

    possible = {
        exists = starbase
        custom_tooltip = {
            fail_text = "requires_inside_border"
            is_inside_border = from
        }
        custom_tooltip = {
            fail_text = "requires_surveyed_system"
            NOT = {
                any_system_planet = {
                    is_surveyed = {
                        who = prev.from
                        status = no
                    }
                }
            }
        }
        custom_tooltip = {
            fail_text = "requires_no_existing_strategic_coordination_center"
            from = { NOT = { has_country_flag = built_strategic_coordination_center_site } }
        }
    }

    placement_rules = {
        planet_possible = {
            custom_tooltip = {
                fail_text = "requires_survey_not_habitable"
                is_surveyed = {
                    who = prev.from
                    status = yes
                }
                colonizeable_planet = no
            }
            custom_tooltip = {
                fail_text = "requires_no_anomaly"
                NOT = { has_anomaly = yes }
            }
            custom_tooltip = {
                fail_text = "requires_no_orbital_station"
                has_orbital_station = no
            }
            custom_tooltip = {
                fail_text = "requires_not_minor_planetary_body"
                NOR = {
                    is_asteroid = yes
                    is_moon = yes
                }
            }
            custom_tooltip = {
                fail_text = "requires_not_ring_world"
                is_ringworld = no
            }
            custom_tooltip = {
                fail_text = "requires_no_existing_megastructure"
                NOR = {
                    has_planet_flag = has_megastructure
                    has_planet_flag = megastructure
                }
            }
        }
    }

    # root = system
    # from = country
    ai_weight = {
        factor = 15

        modifier = {
            factor = 0.1
            starbase = { NOT = { has_starbase_size >= starbase_starfortress } }
        }

        modifier = {
            factor = 0.1
            any_neighbor_system = {
                exists = owner
                NOT = {
                    owner = { is_same_value = from }
                }
            }
        }
    }

    on_build_start = {
        fromfrom.planet = { set_planet_flag = has_megastructure }
    }
    on_build_cancel = {
        fromfrom.planet = { remove_planet_flag = has_megastructure }
    }
    on_build_complete = {
        fromfrom.planet = { set_planet_flag = has_megastructure }
        from = { set_country_flag = built_strategic_coordination_center_site }
    }
}

# Strategic Coordination Center 1
strategic_coordination_center_1 = {
    entity = "strategic_coordination_center_stage_1_entity"
    construction_entity = "strategic_coordination_center_stage_1_entity"
    portrait = "GFX_megastructure_construction_background"
    place_entity_on_planet_plane = no
    entity_offset = { x = -27 y = -27 }
    build_time = 3600
    resources = {
        category = megastructures
        cost = {
            alloys = 15000
        }

        upkeep = {
            energy = 25
        }
    }
    upgrade_from = {
        strategic_coordination_center_0
    }

    prerequisites = { "tech_strategic_coordination" }

    country_modifier = {
        country_naval_cap_add = @stage_1_naval_cap
        country_starbase_capacity_add = @stage_1_starbase_capacity
        starbase_defense_platform_capacity_add = @stage_1_defense_platform
        ship_speed_mult = @stage_1_ship_speed
    }

    on_build_complete = {
        set_star_flag = strategic_coordination_center_built
        from = { country_event = { id = mega.9003 } }
    }
}

# Strategic Coordination Center 2
strategic_coordination_center_2 = {
    entity = "strategic_coordination_center_stage_2_entity"
    construction_entity = "strategic_coordination_center_stage_2_entity"
    portrait = "GFX_megastructure_construction_background"
    place_entity_on_planet_plane = no
    entity_offset = { x = -27 y = -27 }

    build_time = 3600
    resources = {
        category = megastructures
        cost = {
            alloys = 15000
        }

        upkeep = {
            energy = 50
        }
    }

    upgrade_from = {
        strategic_coordination_center_1
    }

    prerequisites = { "tech_strategic_coordination" }

    country_modifier = {
        country_naval_cap_add = @stage_2_naval_cap
        country_starbase_capacity_add = @stage_2_starbase_capacity
        starbase_defense_platform_capacity_add = @stage_2_defense_platform
        ship_speed_mult = @stage_2_ship_speed
    }

    on_build_complete = {
        set_star_flag = strategic_coordination_center_built
        from = { country_event = { id = mega.9004 } }
    }
}

# Strategic Coordination Center 3
strategic_coordination_center_3 = {
    entity = "strategic_coordination_center_stage_3_entity"
    construction_entity = "strategic_coordination_center_stage_3_entity"
    portrait = "GFX_megastructure_strategic_coordination_center_background"
    place_entity_on_planet_plane = no
    entity_offset = { x = -27 y = -27 }
    build_time = 3600
    resources = {
        category = megastructures
        cost = {
            alloys = 15000
        }

        upkeep = {
            energy = 75
        }
    }

    upgrade_from = {
        strategic_coordination_center_2
    }

    prerequisites = { "tech_strategic_coordination" }
    show_prereqs = yes

    country_modifier = {
        country_naval_cap_add = @stage_3_naval_cap
        country_starbase_capacity_add = @stage_3_starbase_capacity
        starbase_defense_platform_capacity_add = @stage_3_defense_platform
        ship_speed_mult = @stage_3_ship_speed
    }

    on_build_complete = {
        set_star_flag = strategic_coordination_center_built
        from = {
            set_country_flag = has_built_or_repaired_megastructure
            country_event = { id = mega.9005 }
        }
    }
}

# Ruined Strategic Coordination Center
strategic_coordination_center_ruined = {
    entity = "strategic_coordination_center_01_destroyed_entity"
    construction_entity = "strategic_coordination_center_01_destroyed_entity"
    portrait = "GFX_megastructure_construction_background"
    place_entity_on_planet_plane = no
    entity_offset = { x = -27 y = -27 }

    potential = { always = no }
}

# Makeshift Strategic Coordination Center
strategic_coordination_center_makeshift = {
    entity = "strategic_coordination_center_01_destroyed_entity"
    construction_entity = "strategic_coordination_center_01_destroyed_entity"
    portrait = "GFX_megastructure_construction_background"
    place_entity_on_planet_plane = no
    entity_offset = { x = -27 y = -27 }
    build_time = 1800
    resources = {
        category = megastructures
        cost = {
            alloys = 5000
        }

        upkeep = {
            energy = 75
        }
    }

    upgrade_from = {
        strategic_coordination_center_ruined
    }

    possible = {
        from = { has_technology = tech_starbase_4 }
    }

    country_modifier = {
        country_naval_cap_add = @makeshift_naval_cap
        country_starbase_capacity_add = @makeshift_starbase_capacity
        starbase_defense_platform_capacity_add = @makeshift_defense_platform
        ship_speed_mult = @makeshift_ship_speed
    }

    on_build_start = {
        fromfrom = {
            set_graphical_culture = root.from
        }
    }
}

# Restored Strategic Coordination Center
strategic_coordination_center_restored = {
    entity = "strategic_coordination_center_stage_3_entity"
    construction_entity = "strategic_coordination_center_stage_3_entity"
    portrait = "GFX_megastructure_strategic_coordination_center_background"
    place_entity_on_planet_plane = no
    entity_offset = { x = -27 y = -27 }
    build_time = 3800
    resources = {
        category = megastructures
        cost = {
            alloys = 10000
        }

        upkeep = {
            energy = 75
        }
    }

    upgrade_from = {
        strategic_coordination_center_makeshift
    }

    possible = {
        from = { has_technology = tech_mega_engineering }
    }

    country_modifier = {
        country_naval_cap_add = @stage_3_naval_cap
        country_starbase_capacity_add = @stage_3_starbase_capacity
        starbase_defense_platform_capacity_add = @stage_3_defense_platform
        ship_speed_mult = @stage_3_ship_speed
    }

    on_build_start = {
        fromfrom = {
            set_graphical_culture = root.from
        }
    }

    on_build_complete = {
        fromfrom.planet = { set_planet_flag = has_megastructure }
        set_star_flag = strategic_coordination_center_built
        every_system_ambient_object = { destroy_ambient_object = this }
        from = {
            set_country_flag = has_built_or_repaired_megastructure
            country_event = { id = mega.9111 }
        }
    }
}
