war_moon_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_construction_background"
	construction_blocks_others = no
	place_entity_on_planet_plane = no
	build_time = 1800
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 100
		}
		
		upkeep = {
			energy = 5
		}
	}

	potential = {
		has_technology = tech_war_moons
		no_scope = {
			NOT = {
				has_global_flag = warmoon_disabled
			}
		}
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}
	}
	
	placement_rules = {
		planet_possible = {
			custom_tooltip = {
				fail_text = "must_build_around_molten_barren_stripmined"
				OR = {
					is_planet_class = pc_molten
					is_planet_class = pc_barren
					is_planet_class = pc_barren_cold
					is_planet_class = pc_frozen
					is_planet_class = pc_disco_moon
					is_planet_class = pc_core_mined
				}
			}
			custom_tooltip = {
				fail_text = "must_build_size_567"
				OR = {
					is_planet_class = pc_core_mined
					planet_size = 5
					planet_size = 6
					planet_size = 7
				}
			}
			custom_tooltip = {
				fail_text = "requires_no_anomaly"
				NOT = { has_anomaly = yes }
			}
			custom_tooltip = {
				fail_text = "requires_no_existing_megastructure"
				NOR = {
					has_planet_flag = megastructure
					AND = {
						has_planet_flag = has_megastructure
						NOT = {
							is_planet_class = pc_disco_moon
						}
					}
					solar_system = {
						has_star_flag = ring_world_built
					}
				}
			}
			custom_tooltip = {
				fail_text = "requires_not_star"
				is_star = no
			}
		} # use these for all non-star megastructures
	}
	
	ai_weight = {
		factor = 1
		modifier = {
			factor = 0.1
			from = {
				OR = {
					has_megastructure = war_moon_0
					has_megastructure = war_moon_5_0
					has_megastructure = war_moon_5_1
					has_megastructure = war_moon_5_2
					has_megastructure = war_moon_6_0
					has_megastructure = war_moon_6_1
					has_megastructure = war_moon_6_2
					has_megastructure = war_moon_7_0
					has_megastructure = war_moon_7_1
					has_megastructure = war_moon_7_2
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		fromfrom.planet = {
			set_planet_flag = has_megastructure
			set_planet_flag = war_moon_megastructure
			if = {
				limit = {
					is_planet_class = pc_core_mined
				}
				while = { 
					limit = { 
						planet_size < 6
					} 
					change_planet_size = 1
				}
			}
		}
	}
}

###SIZE 5###
war_moon_5_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	place_entity_on_planet_plane = no
	upgrade_from = {
		war_moon_0
	}
	
	resources = {
		category = megastructures
		
		upkeep = {
			energy = 5
		}
	}
	
	upgrade_desc = hide
	
	potential = {
		has_technology = tech_war_moons
	}
}

war_moon_5_1 = {
	entity = "giga_moon_construction_1_5"
	construction_entity = "giga_moon_construction_1_5"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	upgrade_from = {
		war_moon_5_0
	}
	build_time = 1800

	resources = {
		category = megastructures
		
		cost = {
			alloys = 7000
		}
		
		upkeep = {
			energy = 40
			alloys = 15
		}
	}

	potential = {
		has_technology = tech_war_moons
	}
}

war_moon_5_2 = {
	entity = "giga_moon_construction_2_6"
	construction_entity = "giga_moon_construction_1_5_build"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	upgrade_from = {
		war_moon_5_1
	}
	build_time = 3600
	resources = {
		category = megastructures
		
		cost = {
			alloys = 11000
		}
		
		upkeep = {
			energy = 40
			alloys = 15
		}
	}
	
	potential = {
		has_technology = tech_war_moons
	}
	
	on_build_complete = {
		fromfrom.planet = {
			if = {
				limit = {
					is_planet_class = pc_disco_moon
				}
				set_planet_flag = discomoontarget
				solar_system = {
					every_planet = {
						limit = {
							any_moon = { has_planet_flag = discomoontarget }
						}
						remove_modifier = disco_moon_modifier
						every_moon = {
							limit = {
								NOT = {
									has_planet_flag = discomoontarget
								}
							}
							remove_modifier = disco_moon_modifier
						}
					}
				}
				remove_planet_flag = discomoontarget
			}
		}
		remove_megastructure = fromfrom
	}
}

###SIZE 6###
war_moon_6_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	place_entity_on_planet_plane = no
	upgrade_from = {
		war_moon_0
	}
	
	resources = {
		category = megastructures
		
		upkeep = {
			energy = 5
		}
	}
	
	upgrade_desc = hide
	
	potential = {
		has_technology = tech_war_moons
	}
}

war_moon_6_1 = {
	entity = "giga_moon_construction_1_6"
	construction_entity = "giga_moon_construction_1_6"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	upgrade_from = {
		war_moon_6_0
	}
	build_time = 1800
	
	resources = {
		category = megastructures
		
		cost = {
			alloys = 7000
		}
		
		upkeep = {
			energy = 40
			alloys = 15
		}
	}
	
	potential = {
		has_technology = tech_war_moons
	}
}

war_moon_6_2 = {
	entity = "giga_moon_construction_2_6"
	construction_entity = "giga_moon_construction_2_6_build"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	upgrade_from = {
		war_moon_6_1
	}
	build_time = 3600
	resources = {
		category = megastructures
		
		cost = {
			alloys = 11000
		}
		
		upkeep = {
			energy = 40
			alloys = 15
		}
	}
	
	potential = {
		has_technology = tech_war_moons
	}
	
	on_build_complete = {
		fromfrom.planet = {
			if = {
				limit = {
					is_planet_class = pc_disco_moon
				}
				set_planet_flag = discomoontarget
				solar_system = {
					every_planet = {
						limit = {
							any_moon = { has_planet_flag = discomoontarget }
						}
						remove_modifier = disco_moon_modifier
						every_moon = {
							limit = {
								NOT = {
									has_planet_flag = discomoontarget
								}
							}
							remove_modifier = disco_moon_modifier
						}
					}
				}
				remove_planet_flag = discomoontarget
			}
		}
		remove_megastructure = fromfrom
	}
}

###SIZE 7###
war_moon_7_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	place_entity_on_planet_plane = no
	upgrade_from = {
		war_moon_0
	}
	
	resources = {
		category = megastructures
		
		upkeep = {
			energy = 5
		}
	}
	
	upgrade_desc = hide
	
	potential = {
		has_technology = tech_war_moons
	}
}

war_moon_7_1 = {
	entity = "giga_moon_construction_1_7"
	construction_entity = "giga_moon_construction_1_7"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	upgrade_from = {
		war_moon_7_0
	}
	build_time = 1800
	resources = {
		category = megastructures
		
		cost = {
			alloys = 7000
		}
		
		upkeep = {
			energy = 40
			alloys = 15
		}
	}
	
	potential = {
		has_technology = tech_war_moons
	}
}

war_moon_7_2 = {
	entity = "giga_moon_construction_2_7"
	construction_entity = "giga_moon_construction_2_7_build"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	upgrade_from = {
		war_moon_7_1
	}
	build_time = 3600
	
	resources = {
		category = megastructures
		
		cost = {
			alloys = 11000
		}
		
		upkeep = {
			energy = 40
			alloys = 15
		}
	}
	
	potential = {
		has_technology = tech_war_moons
	}
	
	on_build_complete = {
		fromfrom.planet = {
			if = {
				limit = {
					is_planet_class = pc_disco_moon
				}
				set_planet_flag = discomoontarget
				solar_system = {
					every_planet = {
						limit = {
							any_moon = { has_planet_flag = discomoontarget }
						}
						remove_modifier = disco_moon_modifier
						every_moon = {
							limit = {
								NOT = {
									has_planet_flag = discomoontarget
								}
							}
							remove_modifier = disco_moon_modifier
						}
					}
				}
				remove_planet_flag = discomoontarget
			}
		}
		remove_megastructure = fromfrom
	}
}