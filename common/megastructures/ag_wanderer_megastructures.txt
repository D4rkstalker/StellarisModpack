
@entity_x = 8
@entity_y = 8

ag_ancient_anchor_station_0 = {
	entity = "ag_ancient_anchor_station_0_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_anchor_station"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	resources = {
		category = megastructures
		produces = {
			trigger = {
				exists = owner
				has_global_flag = ag_system_spawn_1
			}
			physics_research = 50
			engineering_research = 50
		}
	}
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
ag_ancient_anchor_station_1 = {
	entity = "ag_ancient_anchor_station_1_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_anchor_station_alt"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }

	upgrade_from = {
		ag_ancient_anchor_station_0
	}
	
	resources = {
		category = megastructures
		produces = {
			trigger = {
				exists = owner
				has_global_flag = ag_system_spawn_1
			}
			physics_research = 50
			engineering_research = 50
		}
	}
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
ag_ancient_anchor_station_2 = {
	entity = "ag_ancient_anchor_station_1_hull_entity"
	construction_entity = "ag_void_entity"
	portrait = "GFX_ag_anchor_station_alt"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = yes
	
	build_time = 1080
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }

	upgrade_from = {
		ag_ancient_anchor_station_1
	}
	
	resources = {
		category = megastructures
		cost = {
			energy = 30000
			sr_dark_matter = 2500
		}
		produces = {
			trigger = { exists = owner }
			physics_research = 50
			engineering_research = 50
		}
	}

	country_modifier = {
		ship_ftl_jumpdrive_range_mult = 0.050
		ship_jumpdrive_cooldown_mult = -0.025
	}
	
	prerequisites = { tech_ag_ancient_anchor_station }

	on_build_complete = {
		random_list = {
			# Good result
			75 = {
				if = {
					limit = { exists = event_target:ag_ancient_wandering_ship_fleet }
					event_target:ag_ancient_wandering_ship_fleet = {
						change_variable = { which = ag_num_disabled_anchor_stations value = 1 }
						if = {
							limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 6 } }
							add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_1" days = -1 }
						}
						else_if = {
							limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 7 } }
							add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_2" days = -1 }
						}
						else_if = {
							limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 8 } }
							add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_3" days = -1 }
						}
						else_if = {
							limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 9 } }
							add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_4" days = -1 }
						}
						else_if = {
							limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 10 } }
							add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_5" days = -1 }
						}
					}
					from = { country_event = { id = ag_wanderer.65 } }
					fromfrom.solar_system = { save_event_target_as = ag_target_system }
					every_country = {
						limit = { NOT = { is_same_value = from } }
						if = {
							limit = { has_event_chain = ag_ancient_anchor_station_chain }
							country_event = { id = ag_wanderer.66 }
						}
						else = { country_event = { id = ag_wanderer.68 } }
					}
				}
				else = {
					from = { country_event = { id = ag_wanderer.67 } }
					every_country = {
						limit = { NOT = { is_same_value = from } }
						country_event = { id = ag_wanderer.68 }
					}
				}
			}
			# Bad result, anchor station turn into hostile
			25 = {
				ag_create_ancient_guardian = {
					ag_country_name = "NAME_ag_ancient_anchor_station_guardian"
					ag_country_type = ag_ancient_anchor_station_country
				}
				last_created_country = {
					set_country_flag = ag_ancient_anchor_station_country
					save_event_target_as = ag_ancient_anchor_station_country
					ag_ancient_country_friendly_to_each_other = yes
				}
				ag_ancient_anchor_station_spawn = yes
				every_country = {
					limit = { NOT = { has_communications = event_target:ag_ancient_anchor_station_country } }
					establish_communications_no_message = event_target:ag_ancient_anchor_station_country
				}
				from = { country_event = { id = ag_wanderer.71 } }
				fromfrom.solar_system = { save_event_target_as = ag_target_system }
				remove_megastructure = fromfrom
			}
		}
	}

	potential = { always = yes }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = {
		weight = 25
		modifier = {
			factor = 0.4
			starbase = { NOT = { has_starbase_size >= starbase_starfortress } }
		}
		modifier = {
			factor = 0.1
			any_neighbor_system = {
				exists = owner
				owner = { NOT = { is_same_value = from } }
			}
		}
		modifier = {
			factor = 0
			from = { fleet_power < 1000000 }
		}
	}
}

ag_ancient_wandering_ship_megastructure_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 1080
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	resources = {
		category = megastructures
		cost = {
			alloys = 5000
			influence = 150
		}
		upkeep = { energy = 5 }
	}
	
	potential = {
		has_technology = tech_ag_ancient_wandering_ship
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}		
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_system_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_ancient_wandering_ship"
			from = { has_technology = tech_ag_ancient_wandering_ship }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_ancient_wandering_ship"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_ancient_wandering_ship_0
							is_ship_size = ag_ancient_wandering_ship_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_0
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_1
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_2
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_3
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_4
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_5
						}
					}
					has_special_project = ag_structural_protection_system_2601
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	placement_rules = {
		planet_possible = {
			custom_tooltip = {
				fail_text = "ag_requires_ancient_construction_section"
				has_planet_flag = ag_ancient_construction_section
			}
			custom_tooltip = {
				fail_text = "ag_requires_usable_ancient_construction_section"
				NOT = {
					has_planet_flag = has_megastructure
				}
			}
		}
	}
	
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		fromfrom.planet = { set_planet_flag = has_megastructure }
		from = { country_event = { id = ag_wanderer.121 } }
		every_country = {
			limit = { NOT = { is_same_value = from } }
			country_event = { id = ag_wanderer.127 }
		}
	}

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}
ag_ancient_wandering_ship_megastructure_1 = {
	entity = "ag_ancient_wandering_ship_part_1_entity"
	construction_entity = "ag_ancient_wandering_ship_part_1_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 1920
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_ancient_wandering_ship_megastructure_0
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = 5000
			nanites = 1000
			sr_dark_matter = 800
		}
		upkeep = { energy = 10 }
	}
	
	potential = {
		has_technology = tech_ag_ancient_wandering_ship
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_ancient_wandering_ship"
			from = { has_technology = tech_ag_ancient_wandering_ship }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_ancient_wandering_ship"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_ancient_wandering_ship_0
							is_ship_size = ag_ancient_wandering_ship_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_1
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_2
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_3
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_4
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_5
						}
					}
					has_special_project = ag_structural_protection_system_2601
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = { from = { country_event = { id = ag_wanderer.122 } country_event = { id = ag_ancient_knowledge.26 } } }

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}
ag_ancient_wandering_ship_megastructure_2 = {
	entity = "ag_ancient_wandering_ship_part_2_entity"
	construction_entity = "ag_ancient_wandering_ship_part_2_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 1920
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_ancient_wandering_ship_megastructure_1
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = 4000
			nanites = 1000
			sr_dark_matter = 1000
		}
		upkeep = { energy = 20 }
	}
	
	potential = {
		has_technology = tech_ag_ancient_wandering_ship
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_ancient_wandering_ship"
			from = { has_technology = tech_ag_ancient_wandering_ship }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_ancient_wandering_ship"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_ancient_wandering_ship_0
							is_ship_size = ag_ancient_wandering_ship_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_0
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_2
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_3
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_4
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_5
						}
					}
					has_special_project = ag_structural_protection_system_2601
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = { from = { country_event = { id = ag_wanderer.123 } country_event = { id = ag_ancient_knowledge.26 } } }

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}
ag_ancient_wandering_ship_megastructure_3 = {
	entity = "ag_ancient_wandering_ship_part_3_entity"
	construction_entity = "ag_ancient_wandering_ship_part_3_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 720
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_ancient_wandering_ship_megastructure_2
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = 500
			nanites = 750
		}
		upkeep = { energy = 30 }
	}
	
	potential = {
		has_technology = tech_ag_ancient_wandering_ship
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_ancient_wandering_ship"
			from = { has_technology = tech_ag_ancient_wandering_ship }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_ancient_wandering_ship"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_ancient_wandering_ship_0
							is_ship_size = ag_ancient_wandering_ship_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_0
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_1
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_3
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_4
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_5
						}
					}
					has_special_project = ag_structural_protection_system_2601
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = { from = { country_event = { id = ag_wanderer.124 } country_event = { id = ag_ancient_knowledge.26 } } }

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}
ag_ancient_wandering_ship_megastructure_4 = {
	entity = "ag_ancient_wandering_ship_part_4_entity"
	construction_entity = "ag_ancient_wandering_ship_part_4_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 720
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_ancient_wandering_ship_megastructure_3
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = 1000
			nanites = 250
			sr_dark_matter = 200
		}
		upkeep = { energy = 40 }
	}
	
	potential = {
		has_technology = tech_ag_ancient_wandering_ship
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_ancient_wandering_ship"
			from = { has_technology = tech_ag_ancient_wandering_ship }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_ancient_wandering_ship"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_ancient_wandering_ship_0
							is_ship_size = ag_ancient_wandering_ship_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_0
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_1
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_2
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_4
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_5
						}
					}
					has_special_project = ag_structural_protection_system_2601
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = { from = { country_event = { id = ag_wanderer.125 } country_event = { id = ag_ancient_knowledge.26 } } }

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}
ag_ancient_wandering_ship_megastructure_5 = {
	entity = "ag_ancient_wandering_ship_part_5_entity"
	construction_entity = "ag_ancient_wandering_ship_part_5_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no
	
	build_time = 1440
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	upgrade_from = {
		ag_ancient_wandering_ship_megastructure_4
	}
	
	resources = {
		category = megastructures
		cost = {
			sr_living_metal = 2500
			nanites = 500
			sr_dark_matter = 800
		}
		upkeep = { energy = 50 }
	}

	potential = {
		has_technology = tech_ag_ancient_wandering_ship
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "ag_requires_tech_ag_ancient_wandering_ship"
			from = { has_technology = tech_ag_ancient_wandering_ship }
		}
		custom_tooltip = {
			fail_text = "ag_requires_no_existing_ag_ancient_wandering_ship"
			from = {
				NOR = {
					any_owned_ship = {
						OR = {
							is_ship_size = ag_ancient_wandering_ship_0
							is_ship_size = ag_ancient_wandering_ship_1
						}
					}
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_0
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_1
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_2
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_3
							is_megastructure_type = ag_ancient_wandering_ship_megastructure_5
						}
					}
					has_special_project = ag_structural_protection_system_2601
				}
			}
		}
		custom_tooltip = {
			fail_text = "ag_requires_usable_ancient_construction_section"
			NOT = {
				any_system_planet = {
					has_planet_flag = ag_using_ancient_construction_section_system
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		fromfrom.planet = { remove_planet_flag = has_megastructure }
		from = { country_event = { id = ag_wanderer.126 } country_event = { id = ag_ancient_knowledge.26 } }
		add_threat = { who = from amount = 50 }
		if = {
			limit = { from = { NOT = { has_country_flag = ag_wandering_ships_unlocked } } }
			ag_ancient_wandering_ship_player_spawn = {
				ag_unlock_ship = no
				ag_owner = from
				ag_location_target = fromfrom
			}
		}
		else = {
			ag_ancient_wandering_ship_player_spawn = {
				ag_unlock_ship = yes
				ag_owner = from
				ag_location_target = fromfrom
			}
		}
		remove_megastructure = fromfrom
		every_country = {
			limit = { NOT = { is_same_value = from } }
			country_event = { id = ag_wanderer.128 }
		}
	}

	construction_blocked_by_others = no
	construction_blocks_others = no
	
	ai_weight = { weight = 1000 }
}