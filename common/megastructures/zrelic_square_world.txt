# see README.txt for example

r_square_world_ruined = {
	entity = "squareworld_segment_ruined_mega_entity"
	portrait = "GFX_megastructure_construction_background"

	potential = {
		always = no
	}
}

r_square_world_restored = {
	entity = "squareworld_segment_mega_entity"
	construction_entity = "squareworld_segment_mega_construction_entity"
	portrait = "GFX_megastructure_construction_background"
	construction_blocks_others = no
	upgrade_from = {
		r_square_world_ruined
	}
	build_time = 3600
	resources = {
		category = megastructures
		cost = {
			alloys = 10000
		}
	}

	potential = {
		has_technology = tech_fix_squareworld
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 300
		modifier = {
			weight = 0
			from = { is_country_type = fallen_empire }
		}
	}

	on_build_start = {
		fromfrom = {
			set_graphical_culture = root.from
		}
	}

	on_build_complete = {
		every_system_ambient_object = { destroy_ambient_object = this }
		spawn_planet = {
			class = "pc_squareworld_habitable"
			orbit_angle_offset = 0
			orbit_distance_offset = 0
			size = 10
			location = fromfrom
			init_effect = {
				set_planet_flag = megastructure
				set_planet_flag = colony_event
				save_event_target_as = ring_section
				trigger_megastructure_icon = yes
				set_name = "Squareworld Habitat"
				surveyed = {
					set_surveyed = yes
					surveyor = FROM
				}
				set_all_comms_surveyed = yes
			}
		}
	}
}

r_square_world_hub = {
	entity = "square_world_hub_station_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no

	resources = {
		category = megastructures
	}
	
	potential = {
		always = no
	}
}

r_square_world_hub_powered = {
	entity = "square_world_hub_station_entity"
	construction_entity = ""
	portrait = "GFX_megastructure_construction_background"
	construction_blocks_others = no
	place_entity_on_planet_plane = no
	upgrade_from = {
		r_square_world_hub
	}
	build_time = 360
	resources = {
		category = megastructures
		cost = {
			energy = 7500
			alloys = 1000
		}
		
		produces = {
			physics_research = 100
			engineering_research = 100
			society_research = 100
		}
	}

	potential = {
		has_country_flag = squareworld_expedition
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 300
		modifier = {
			weight = 0
			from = { is_country_type = fallen_empire }
		}
	}
}

r_square_world_hub_garyx = {
	entity = "square_world_hub_station_entity"
	construction_entity = ""
	portrait = "GFX_megastructure_construction_background"
	construction_blocks_others = no
	place_entity_on_planet_plane = no
	upgrade_from = {
		r_square_world_hub_powered
	}
	build_time = 1
	resources = {
		category = megastructures
		cost = {
			energy = 100
		}
	}

	potential = {
		NOT = {
			has_country_flag = talking_to_garyx
		}
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
	}
	
	ai_weight = {
		weight = 300
		modifier = {
			weight = 0
			from = { is_country_type = fallen_empire }
		}
	}
	
	on_build_complete = {
		from = {
			set_country_flag = talking_to_garyx
			country_event = { id = gigagaryx.10 }
		}
		solar_system = {
			every_system_megastructure = {
				if = {
					limit = {
						exists = this
						is_megastructure_type = r_square_world_hub_garyx
					}
					remove_megastructure = this
				}
			}
			spawn_megastructure = { 
				type = "r_square_world_hub_powered" 
				location = FROMFROM
				owner = space_owner
			}
		}
	}
}