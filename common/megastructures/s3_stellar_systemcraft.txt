stellar_systemcraft_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_construction_background"
	construction_blocks_others = no
	place_entity_on_planet_plane = no
	build_time = 1800

	resources = {
		category = megastructures
		
		cost = {
			alloys = 10000
			influence = 200
		}
		
		upkeep = {
			energy = 5
		}
	}
	
	potential = {
		has_technology = tech_experimental_stellar_propulsion
		has_ascension_perk = ap_systemcraft
		no_scope = {
			NOT = {
				has_global_flag = systemcraft_disabled
			}
		}
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_no_habitable_planets"
			NOT = {
				any_system_planet = {
					is_colony = yes
				}
			}
		}
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}
	}
	
	placement_rules = {
		planet_possible = {
			custom_tooltip = {
				fail_text = "must_build_around_star"
				is_star = yes
			}
		} # use these for all non-star megastructures
	}
	
	ai_weight = {
		factor = 0
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		from = {
			set_country_flag = systemcraft_built
		}
		no_scope = {
			set_global_flag = systemcraft_construction
		}
		fromfrom.planet = {
			set_planet_flag = has_megastructure
			set_planet_flag = systemcraft_megastructure
		}
	}
}

stellar_systemcraft_1 = {
	entity = "systemcraft_sun_container_entity"
	construction_entity = "systemcraft_sun_container_entity"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	upgrade_from = {
		stellar_systemcraft_0
	}
	build_time = 3600
	
	resources = {
		category = megastructures
		
		cost = {
			alloys = 100000
		}
		
		upkeep = {
			energy = 100
			alloys = 50
		}
	}

	potential = {
		AND = {
			has_technology = tech_ultra_gravity_bending
			has_ascension_perk = ap_systemcraft
		}
	}

	on_build_complete = {
		every_system_planet = { 
			limit = { is_star = no }
			remove_planet = yes 
		}
		set_asteroid_belt = {
			radius = 0
		}
		fromfrom.planet = {
			while = { 
				limit = { 
					planet_size > 1
				} 
				change_planet_size = -1			
			}
		}
	}
}

stellar_systemcraft_2 = {
	entity = "systemcraft_thrusters_entity"
	construction_entity = "systemcraft_thrusters_construction_entity"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	upgrade_from = {
		stellar_systemcraft_1
	}
	build_time = 3600
	
	resources = {
		category = megastructures
		
		cost = {
			alloys = 100000
		}
		
		upkeep = {
			energy = 250
			alloys = 100
		}
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_behemoth_planetcraft_1_moon_2"
			solar_system = {
				AND = {
					count_system_ships  = {
						limit = { is_ship_size = giga_planet_behemoth }
						count > 0
					}
					count_system_ships  = {
						limit = { is_ship_size = giga_massive_planet }
						count > 1
					}
				}
			}
		}
	}

	potential = {
		AND = {
			has_technology = tech_hyper_energetic_thrusters
			has_ascension_perk = ap_systemcraft
		}
	}

	on_build_start = {
		solar_system = {
			set_star_flag = systemcraft_system
			space_owner = {
				random_owned_ship = {
					limit = {
						solar_system = {
							has_star_flag = systemcraft_system
						}
						is_ship_size = giga_planet_behemoth
					}
					delete_ship = this
				}
				random_owned_ship = {
					limit = {
						solar_system = {
							has_star_flag = systemcraft_system
						}
						is_ship_size = giga_massive_planet
					}
					delete_ship = this
				}
				random_owned_ship = {
					limit = {
						solar_system = {
							has_star_flag = systemcraft_system
						}
						is_ship_size = giga_massive_planet
					}
					delete_ship = this
				}
			}
			remove_star_flag = systemcraft_system
		}
	}
}

stellar_systemcraft_3 = {
	entity = "systemcraft_sides_entity"
	construction_entity = "systemcraft_sides_construction_entity"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	upgrade_from = {
		stellar_systemcraft_2
	}
	build_time = 3600
	
	resources = {
		category = megastructures
		
		cost = {
			alloys = 100000
		}
		
		upkeep = {
			energy = 500
			alloys = 150
		}
	}

	possible = {
		custom_tooltip = {
			fail_text = "requires_moon_2"
			solar_system = {
				AND = {
					count_system_ships  = {
						limit = { is_ship_size = giga_massive_planet }
						count > 1
					}
				}
			}
		}
	}

	potential = {
		AND = {
			has_technology = tech_meta_stabilization
			has_ascension_perk = ap_systemcraft
		}
	}

	on_build_start = {
		solar_system = {
			set_star_flag = systemcraft_system
			space_owner = {
				random_owned_ship = {
					limit = {
						solar_system = {
							has_star_flag = systemcraft_system
						}
						is_ship_size = giga_massive_planet
					}
					delete_ship = this
				}
				random_owned_ship = {
					limit = {
						solar_system = {
							has_star_flag = systemcraft_system
						}
						is_ship_size = giga_massive_planet
					}
					delete_ship = this
				}
			}
			remove_star_flag = systemcraft_system
		}
	}
}

stellar_systemcraft_4 = {
	entity = "systemcraft_front_entity"
	construction_entity = "systemcraft_front_construction_entity"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	upgrade_from = {
		stellar_systemcraft_3
	}
	build_time = 3600
	
	resources = {
		category = megastructures
		
		cost = {
			alloys = 100000
		}
		
		upkeep = {
			energy = 750
			alloys = 500
		}
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_behemoth_planetcraft_2"
			solar_system = {
				AND = {
					count_system_ships  = {
						limit = { is_ship_size = giga_planet_behemoth }
						count > 1
					}
				}
			}
		}
	}

	potential = {
		AND = {
			has_technology = tech_erasure_weaponry
			has_ascension_perk = ap_systemcraft
		}
	}

	on_build_start = {
		solar_system = {
			space_owner = {
				set_country_flag = systemcraft_crew_required
			}
			set_star_flag = systemcraft_system
			space_owner = {
				random_owned_ship = {
					limit = {
						solar_system = {
							has_star_flag = systemcraft_system
						}
						is_ship_size = giga_planet_behemoth
					}
					delete_ship = this
				}
				random_owned_ship = {
					limit = {
						solar_system = {
							has_star_flag = systemcraft_system
						}
						is_ship_size = giga_planet_behemoth
					}
					delete_ship = this
				}
			}
			remove_star_flag = systemcraft_system
		}
	}
}

stellar_systemcraft_5 = {
	entity = "systemcraft_completed_entity"
	construction_entity = "systemcraft_completed_construction_entity"
	portrait = "GFX_megastructure_moon"
	construction_blocks_others = no
	upgrade_from = {
		stellar_systemcraft_4
	}
	build_time = 3600
	
	resources = {
		category = megastructures
		
		cost = {
			alloys = 100000
		}
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_behemoth_planetcraft_1_moon_1"
			solar_system = {
				AND = {
					count_system_ships  = {
						limit = { is_ship_size = giga_planet_behemoth }
						count > 0
					}
					count_system_ships  = {
						limit = { is_ship_size = giga_massive_planet }
						count > 0
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "requires_systemcraft_crew"
			space_owner = {
				NOT = { has_country_flag = systemcraft_crew_required }
			}
		}
	}

	potential = {
		AND = {
			has_technology = tech_systemcraft
			has_ascension_perk = ap_systemcraft
		}
	}
	
	on_build_start = {
		solar_system = {
			set_star_flag = systemcraft_system
			space_owner = {
				random_owned_ship = {
					limit = {
						solar_system = {
							has_star_flag = systemcraft_system
						}
						is_ship_size = giga_planet_behemoth
					}
					delete_ship = this
				}
				random_owned_ship = {
					limit = {
						solar_system = {
							has_star_flag = systemcraft_system
						}
						is_ship_size = giga_massive_planet
					}
					delete_ship = this
				}
			}
			remove_star_flag = systemcraft_system
		}
	}

	on_build_complete = {
		remove_megastructure = fromfrom
	}
}