#_UGRC同步		允许宣称/舰队跃迁/跃迁限制
#_AAR自用		分公司相关


###_[允许宣称]		ev	/ZOFE/SOFE/EE/ETCPM		/AAR	####################################
# Root = claimer
# This = system
can_add_claim = {
	## +ZOFE/EE/ev
	hidden_trigger = {
		if = {
			limit = {
				root = {
					NOR = {
						is_country_type = default
						is_country_type = ascended_empire	# ZOFE
						is_country_type = lost_empire
						is_country_type = eternal_empire	# EE
						is_country_type = default_ev		# ev
					}
				}
			}
			always = yes
		}
	}
	## +ETCPM
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_POLICY
		OR = {
			root = {
				OR = {
					has_policy_flag = unrestricted_wars
					# ETCPM
					AND = {
						has_global_flag = expanded_pops_active
						OR = {
							NOT = { has_valid_civic = civic_closed_collective }
							NOT = { has_valid_civic = civic_closed_network }
						}
					}
				}
			}
			AND = {
				exists = owner
				owner = { is_gestalt = yes }
			}
			AND = {
				exists = owner
				owner = {
					any_war = {
						any_attacker = { is_same_value = prevprev }
						any_defender = { is_same_value = root }
					}
				}
			}
			
			# ETCPM
			AND = {
				has_global_flag = expanded_pops_active
				root = {
					has_policy_flag = liberation_wars
					has_authority = auth_democratic
					has_valid_ai_personality = yes
					has_ai_personality = democratic_crusaders
				}
				owner = { NOT = { has_authority = auth_democratic } }
				owner = { NOT = { has_authority = auth_cooperative } }
			}
		}
	}
	## +ZOFE/SOFE/EE
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_NOT_VALID_EMPIRE
		NAND = {
			exists = owner
			owner = {
				NOR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
					# EE
					is_country_type = eternal_empire
					# SOFE
					is_country_type = original_empire_active	
					is_country_type = sofe_light_seeker
				}
			}
		}
	}
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_DEVOURING_SWARM
		NAND = {
			root = { has_valid_civic = civic_hive_devouring_swarm }
			root = { is_lithoid_empire = no }
		}
	}
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_DEVOURING_SWARM_LITHOID
		NAND = {
			root = { has_valid_civic = civic_hive_devouring_swarm }
			root = { is_lithoid_empire = yes }
		}
	}
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_ASSIMILATOR
		NOT = { root = { has_valid_civic = civic_machine_assimilator } }
	}
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_PURIFIERS
		NAND = {
			exists = owner
			root = { has_valid_civic = civic_fanatic_purifiers }
			NOT = {	owner = { is_same_species = root } }
		}
	}
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_EXTERMINATOR
		NAND = {
			exists = owner
			root = { has_valid_civic = civic_machine_terminator }
			owner = {
				NOR = {
					is_same_species = root
					has_country_flag = synthetic_empire
					has_authority = auth_machine_intelligence
				}
			}
		}
	}
	## +ETCPM
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_THEY_THREAT
		NAND = {
			exists = owner
			owner = {
				OR = {
					has_valid_civic = civic_hive_devouring_swarm
					has_valid_civic = civic_fanatic_purifiers
					has_valid_civic = civic_machine_terminator
					has_valid_civic = civic_machine_assimilator
					# ETCPM
					has_valid_civic = civic_infestation
				}
			}
			root = {
				NOR = {
					has_valid_civic = civic_hive_devouring_swarm
					has_valid_civic = civic_fanatic_purifiers
					has_valid_civic = civic_machine_terminator
					has_valid_civic = civic_machine_assimilator
					# ETCPM
					has_valid_civic = civic_infestation
				}
			}
		}
	}
	# ETCPM
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_ASSIMILATOR
		NOT = { root = { has_valid_civic = civic_infestation } }
	}
	# AAR
#	custom_tooltip = {
#		fail_text = AAR_failtips_no_claim
#		NOT = { root = { has_country_flag = AAR_flg_cntr_no_claim } }
#	}
}


###_[舰队跃迁]
###_[z_fw/古代帝国/seooc]	####################################
# THIS = Fleet
can_jump_drive = {
#	always = yes	# Moved cooldown to code
	
	# z_fw
	if = {
		limit = {
			OR = {
				has_fleet_flag = FW_flg_flt_JUMP	# FW特殊跃迁flt
				owner = {
					OR = {
						has_country_flag = FW_flg_cntr_CHT_orrery_ON		# 璀璨星图
						has_country_flag = FW_flg_cntr_CHT_beacon_ON		# 永恒星炬
					}
				}
			}
		}
	}
	# 古代帝国
	else_if = {
		limit = {
			exists = solar_system
			solar_system = { has_star_flag = ag_no_jump_out_system }
		}
		custom_tooltip = {
			fail_text = ag_jump_drive_unable_system_tooltip
			always = no
		}
	}
	# seooc
	else_if = {
		limit = {
			exists = solar_system
			solar_system = { has_star_flag = nep_Scrus_cluster }
		}
		custom_tooltip = {
			text = "CAN_NOT_JUMP_WHEN_IN_SCRUS"
			always = no
		}
	}
	else_if = {
		limit = {
			exists = solar_system
			solar_system = {
				OR = {
					has_star_flag = nep_whitegoo_1
					has_star_flag = nep_whitegoo_2
					has_star_flag = nep_whitegoo_3
				}
			}
			owner = { NOT = { has_technology = tech_nep_whitegoo_3_2 } }
		}
		custom_tooltip = {
			text = "CAN_NOT_JUMP_IN_WHITEGOO"
			always = no
		}
	}
	else = {
		always = yes
	}
}


###_[跃迁限制]	z_fw/AAR	/古代帝国/wsg/阿夸/SOFE/Giga/Ehof/seooc/多彩	####################################
# Root = country attempting to target system for movement
# This = system being targeted
can_enter_system_by_jump = {
	custom_tooltip = {
		success_text = "debug: can jump"
		fail_text = cannot_jump_to_system
		OR = {
			###_绝对通行	z_fw
			root = {
				OR = {
					has_country_flag = FW_flg_cntr_CHT_orrery_ON			# 璀璨星图
					has_country_flag = FW_flg_cntr_CHT_beacon_ON	# 永恒星炬
				}
			}
			###_特殊通行	AAR
			root = {
				has_country_flag = AAR_flg_cntr_JUMP_webway_TGT			# 网道行者
			}
			
			###_基础条件
			AND = {
				##_Sealed system
				OR = {
					# vanilla
					NOT = { has_star_flag = sealed_system }
					AND = {
						root = { has_country_flag = entered_sealed_system }
						has_star_flag = sealed_system
					}
				}

				##_特殊禁入星系		+wsg/古代帝国/阿夸/SOFE/Giga/Ehof/seooc/多彩
				NOR = {
					# vanilla
					has_star_flag = lcluster

					# wsg
					has_star_flag = wg_sealed_system
					has_star_flag = wg_psionic_systems
					# 古代帝国
					has_star_flag = ag_no_jump_in_system
					# 阿夸
					has_star_flag = kuat_initial_system
					has_star_flag = Kuat_system
					has_star_flag = Kuat_system_1
					has_star_flag = Kuat_system_2
					has_star_flag = Kuat_system_3
					has_star_flag = Kuat_system_int
					has_star_flag = Kuat_system_int_1
					has_star_flag = Kuat_system_int_2
					has_star_flag = Kuat_system_int_3
					has_star_flag = Kuat_system_int_4
					AND = {
						has_global_flag = starkillerbase_not_passed
						has_star_flag = starkiller_system	
					}
					# SOFE
					has_star_flag = outercluster
					# Giga
					has_star_flag = ehof_compound_system
					has_star_flag = giga_core_03
					cohesive_system = yes
					urmazin_system = yes
					everchanging_system = yes
					katzen_jump_blocked_system = yes
					# seooc
					has_star_flag = nep_Krahen_cluster
					has_star_flag = nep_Scrus_cluster
					AND = {
						has_global_flag = nep_not_pass_Aemethms 
						OR = {
							has_star_flag = nep_dragon_system
							has_star_flag = nep_heptagram_cluster
						}
					}
					# 多彩
					AND = {
						has_global_flag = love_between_us
						OR = {
							has_star_flag = ten_crisis_system
							any_neighbor_system = {
								has_star_flag = ten_crisis_system
							}
						}
					}
				}
			}
		}
	}
}




###	分公司相关
# This = country
can_support_branch_offices = {
	custom_tooltip = {
		fail_text = BRANCH_OFFICE_NOT_FALLEN_EMPIRES
		NOR = {
			is_country_type = fallen_empire
			is_country_type = awakened_fallen_empire
		}
	}
	#_|企业|	+AAR
	custom_tooltip = {
		fail_text = BRANCH_OFFICE_NOT_ON_MEGACORP_PLANET
		OR = {
			NOR = {
				has_authority = auth_corporate
				has_civic = civic_galactic_sovereign_megacorp
			}
			#	AAR
			is_subject_with_preset = { PRESET = AAR_SBJ_subsidiary }
		}
	}
	custom_tooltip = {
		fail_text = BRANCH_OFFICE_NOT_REGULAR_EMPIRE
		is_regular_empire = yes
	}
}

