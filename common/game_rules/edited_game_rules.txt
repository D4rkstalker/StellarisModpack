#This rule is a condition for bombarding planets
#Root = fleet, potential attacker
#From = planet, potential target
can_orbital_bombard = {
	exists = FROM.OWNER
	NOT = {
		any_owned_ship = {
			is_ship_size = colossus
		}
	}
	OR = {
		AND = {
			ROOT.OWNER = {
				NOT = { has_communications = FROM.OWNER }
			}
			FROM.OWNER = {
				NOT = { is_country_type = primitive }
			}
		}
		AND = {
			ROOT.OWNER = {
				NOR = {
					has_policy_flag = interference_passive
					has_policy_flag = interference_active
				}
			}
			FROM.OWNER = { is_country_type = primitive }
		}
		ROOT.OWNER = { is_at_war_with = FROM.CONTROLLER }
		FROM = { is_planet_class = pc_infested }
		FROM.CONTROLLER = {
			OR = {
				is_country_type = swarm
				is_country_type = ai_empire
				is_country_type = cybrex_empire
				is_sleeper = yes
			}
		}
		ROOT.OWNER = {
			OR = {
				is_country_type = extradimensional
				is_country_type = extradimensional_2
				is_country_type = extradimensional_3
				is_country_type = swarm
				is_country_type = ai_empire
				is_country_type = cybrex_empire
				is_country_type = dormant_marauders
				is_country_type = marauder_raiders
				is_country_type = ruined_marauders
				is_country_type = gray_goo
				is_country_type = vol
				is_sleeper = yes
				AND = {
					is_country_type = awakened_marauders
					FROM.CONTROLLER = {
						NAND = {
							is_subject_type = satrapy
							NOT = { has_country_flag = rebelling_satrapy }
						}
					}
				}
			}
		}
		AND = {
    	    from.controller = {
    	        is_country_type = faction
    	        NOT = { is_same_value = root.owner }
    	    }
    	    from.owner = {
    	        is_same_value = root.owner
    	    }
		}
	}
}

#AI will restrict sleeper systems if it makes no sense for them to attack

# this = system
# root = country
# Determines if AI-controlled empires should restrict (and thus avoid) a system
# Used by regular empires, fallen empires & crises
ai_should_restrict_system = {
	OR = {
		AND = {
			root = { is_country_type = fallen_empire }
			exists = owner
			OR = {
				any_fleet_in_system = {
					exists = owner
					owner = { is_country_type = berserker_awoken_hive }
				}
				AND = {
					owner = { is_country_type = the_sleeper_fallen }
					has_star_flag = sleeper_core_system
				}
			}
		}
		AND = {
			root = { is_country_type = default }
			exists = owner
			has_star_flag = sleeper_system
			root = {
				AND = {
					#homicidals and non inward fanatic xenophobe do not care
					OR = {
						is_homicidal = no
						NAND = {
							has_ethic = ethic_fanatic_xenophobe 
							NOT = { has_valid_civic = civic_inwards_perfection }
						}
					}
					OR = {
						#non militarists- philes and pacifists will never attack
						AND = {
							is_xenophile = yes
							is_militarist = no
						}
						is_pacifist = yes
						has_valid_civic = civic_machine_servitor
						#sanctions, only xenophobe and militarists
						AND = {
							is_active_resolution = resolution_sleeper_sanctions
							NOR = {
								AND = {
									is_xenophobe = yes
									NOT = { has_valid_civic = civic_inwards_perfection }
								}
								is_militarist = yes
							}
						}
						#TN-3 warning happened, only fanatic xenophobes and homicidal
						AND = {
							has_global_flag = sleeper_warning_happened
							NOT = { has_ethic = ethic_fanatic_xenophobe }
						}
						#neighbors will never attack after the sleeper has reached 500 points and if they are not xenophobe, homicidal or fanatic militarist
						AND = {
							any_neighbor_country = {
								is_country_type = the_sleeper_fallen
							}
							event_target:the_sleeper = {
								check_variable = {
									which = sleeper_aggro
									value > 500
								}
							}
						}
					}
				}
			}
		}

		AND = {
			root = { is_country_type = fallen_empire }
			exists = owner
			owner = { is_country_type = awakened_marauders }
		}
		AND = {
			root = { is_country_type = awakened_marauders }
			exists = owner
			owner = { is_country_type = fallen_empire }
		}
		AND = {
			root = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_marauders
				}
			}
			any_fleet_in_system = {
				exists = owner
				owner = {
					OR = {
						is_country_type = guardian_dragon
						is_country_type = guardian_stellarite
						is_country_type = guardian_wraith
						is_country_type = guardian_horror
						is_country_type = guardian_fortress
						is_country_type = guardian_dreadnought
					}
				}
			}
		}
	}
}

#not really needed...
# Root = claimer
# This = system
can_add_claim = {
	hidden_trigger = {
		if = {
			limit = {
				root = { NOT = { is_country_type = default } }
			}
			always = yes
		}
	}
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_POLICY
		OR = {
			root = { has_policy_flag = unrestricted_wars }
			AND = {
				exists = owner
				owner = { is_gestalt = yes }
			}
			AND = {
				exists = owner
				owner = {
					any_war = {
						any_attacker = { is_same_value = prevprev }
						any_defender = { is_same_value = root }
					}
				}
			}
		}
	}
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_NOT_VALID_EMPIRE
		NAND = {
			exists = owner
			owner = {
				NOR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
					is_country_type = awakened_sleeper
				}
			}
		}
	}
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_DEVOURING_SWARM
		NOT = { root = { has_valid_civic = civic_hive_devouring_swarm } }
	}
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_ASSIMILATOR
		NOT = { root = { has_valid_civic = civic_machine_assimilator } }
	}
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_PURIFIERS
		NAND = {
			exists = owner
			root = { has_valid_civic = civic_fanatic_purifiers }
			NOT = {	owner = { is_same_species = root } }
		}
	}
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_EXTERMINATOR
		NAND = {
			exists = owner
			root = { has_valid_civic = civic_machine_terminator }
			owner = {
				NOR = {
					is_same_species = root
					has_country_flag = synthetic_empire
					has_authority = auth_machine_intelligence
				}
			}
		}
	}
	custom_tooltip = {
		fail_text = CANNOT_ADD_CLAIM_THEY_THREAT
		NAND = {
			exists = owner
			owner = {
				OR = {
					has_valid_civic = civic_hive_devouring_swarm
					has_valid_civic = civic_fanatic_purifiers
					has_valid_civic = civic_machine_terminator
					has_valid_civic = civic_machine_assimilator
				}
			}
			root = {
				NOR = {
					has_valid_civic = civic_hive_devouring_swarm
					has_valid_civic = civic_fanatic_purifiers
					has_valid_civic = civic_machine_terminator
					has_valid_civic = civic_machine_assimilator
				}
			}
		}
	}
}
