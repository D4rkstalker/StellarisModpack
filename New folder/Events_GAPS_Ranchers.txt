namespace = Events_GAPS_Ranchers

#every_owned_ship = { limit = { <triggers> } <effects> }
country_event = {
	id = Events_GAPS_Ranchers.1
	is_triggered_only = yes
	hide_window = yes
	
	trigger = { has_origin = Origin_GAPS_Ranchers }
	
	immediate = {
		every_system_within_border = {
			set_star_flag = StarFlag_GAPS_cattle_system
		}
		save_event_target_as = TIYANKI_FRIENDSHIP_START
		save_event_target_as = Event_Target_System_Owner
		#T3
		add_research_option = tech_regenerative_hull_tissue
		add_tech_progress = {
			tech = tech_regenerative_hull_tissue
			progress = 0.5
		}
		#T1
		add_research_option = tech_space_whale_weapon_1
		add_tech_progress = {
			tech = tech_space_whale_weapon_1
			progress = 0.5
		}
		every_country = {
			limit = { is_country_type = tiyanki }
			save_global_event_target_as = gwen_global_target_tiyanki
			set_faction_hostility = {
				set_hostile = no
			#	set_neutral = yes
				set_friendly = yes
				target = event_target:TIYANKI_FRIENDSHIP_START
			}
		}
		random_planet_within_border = {
			limit = {
				is_planet_class = pc_gas_giant 
			}
			save_event_target_as = gwen_tiyanki_planet
		}
		create_fleet = {
			name = "NAME_Tiyanki_Space_Whale"
			effect = {
				set_fleet_flag = pet_tiyanki
				set_owner = event_target:gwen_global_target_tiyanki
				create_ship = {
					name = "NAME_Cow"
					design = "NAME_Tiyanki_Cow"
				}
				create_ship = {
					name = "NAME_Bull"
					design = "NAME_Tiyanki_Bull"
				}
				create_ship = {
					name = "NAME_Calf"
					design = "NAME_Tiyanki_Calf"
				}
				set_location = event_target:gwen_tiyanki_planet
				set_fleet_stance = evasive
			}
		}
		# you can use this as part of a fleet qued action set_fleet_stance = aggressive
		last_created_fleet = {
			queue_actions = {
				repeat = {
					find_random_system = {
						trigger = {
							id = gwen.whale.system.find.0
							owner = {
								#is_same_value - Checks if the current scope and the target scope are the same thing
								is_same_value = event_target:Event_Target_System_Owner
							}
							any_planet = { 
								is_colony = yes
							}
						}
						found_system = {
							move_to = this
						}
					}
					repeat = {
						max_iterations = 1
						find_random_planet = {
							trigger = {
								id = gwen.whale.planet.find.0
								is_colony = yes
							}
							found_planet = {
								orbit_planet = this
								wait = {
									duration = 30
									random = 90
								}
							}
						}
					}
					find_random_system = {
						trigger = {
							id = gwen.whale.system.find.2
							any_planet = { 
								is_planet_class = pc_gas_giant
							}
							distance = {
								source = PREV
								max_distance <= 200
								min_distance >= 10
							}
						}
						found_system = {
							move_to = this
							}
					}
					repeat = {
						max_iterations = 3
						find_random_planet = {
							trigger = {
								id = gwen.whale.planet.find.2
								is_planet_class = pc_gas_giant
							}
							found_planet = {
								orbit_planet = this
								wait = {
									duration = 30
									random = 90
								}
							}
						}
					}
					find_random_system = {
						trigger = {
							id = gwen.whale.system.find.4
							any_planet = { 
								is_planet_class = pc_gas_giant
							}
							distance = {
								source = PREV
								max_distance <= 50
								min_distance >= 20
							}
						}
						found_system = {
							move_to = this
						}
					}
					repeat = {
						max_iterations = 3
						find_random_planet = {
							trigger = {
								id = gwen.whale.planet.find.4
								is_planet_class = pc_gas_giant
							}
							found_planet = {
								orbit_planet = this
								wait = {
									duration = 30
									random = 90
								}
							}
						}
					}
					find_random_system = {
						trigger = {
							id = gwen.whale.system.find.3
							owner = {
								 has_origin = Origin_GAPS_Ranchers
							}
							any_planet = { 
								is_colony = yes
							}
						}
						found_system = {
							move_to = this
						}
					}
					repeat = {
						max_iterations = 1
						find_random_planet = {
							trigger = {
								id = gwen.whale.planet.find.3
								is_colony = yes
							}
							found_planet = {
								orbit_planet = this
								wait = {
									duration = 30
									random = 90
								}
							}
						}
					}
					find_random_system = {
						trigger = {
							id = gwen.whale.system.find.5
							any_planet = { 
								is_planet_class = pc_gas_giant
							}
							distance = {
								source = PREV
								max_distance <= 50
								min_distance >= 20
							}
						}
						found_system = {
							move_to = this
						}
					}
					repeat = {
						max_iterations = 3
						find_random_planet = {
							trigger = {
								id = gwen.whale.planet.find.5
								is_planet_class = pc_gas_giant
							}
							found_planet = {
								orbit_planet = this
								wait = {
									duration = 30
									random = 90
								}
							}
						}
					}
				}
			}
		}
	}
}
planet_event = {
	id = Events_GAPS_Ranchers.21
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = Planet_Target_GAPS_Ranchers
		SOLAR_SYSTEM = { owner = { save_event_target_as = Owner_Target_GAPS_Ranchers } }
		if = { 
			limit = { 
				event_target:Owner_Target_GAPS_Unswallowed = { has_origin = Origin_GAPS_Ranchers }
			}
			planet_event = { id = Events_GAPS_Ranchers.2 days = 0 }
		}
	}
}
planet_event = {
	id = Events_GAPS_Ranchers.2
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		owner = { save_event_target_as = Event_Target_System_Owner }
		create_fleet = {
			name = "NAME_Tiyanki_Space_Whale"
			effect = {
				set_fleet_flag = pet_tiyanki
				set_owner = event_target:gwen_global_target_tiyanki
				create_ship = {
					name = "NAME_Cow"
					design = "NAME_Tiyanki_Cow"
				}
				create_ship = {
					name = "NAME_Bull"
					design = "NAME_Tiyanki_Bull"
				}
				create_ship = {
					name = "NAME_Calf"
					design = "NAME_Tiyanki_Calf"
				}
				set_location = event_target:Planet_Target_GAPS_Ranchers
				set_fleet_stance = evasive
			}
		}
		last_created_fleet = {
			fleet_event = { id = Events_GAPS_Ranchers.25 days = 1 random = 1 }
		}
		if = { 
			limit = { root = { has_planet_flag = PlanetFlag_GAPS_Roamer_Tiyanki } }
			remove_planet_flag = PlanetFlag_GAPS_Roamer_Tiyanki
			last_created_fleet = {
				queue_actions = {
					repeat = {
						find_random_system = {
							trigger = {
								id = gwen.whale.system.find.09
								owner = {
									#is_same_value - Checks if the current scope and the target scope are the same thing
									is_same_value = event_target:Event_Target_System_Owner
								}
								any_planet = { 
									is_colony = yes
								}
							}
							found_system = {
								move_to = this
							}
						}
						repeat = {
							max_iterations = 1
							find_random_planet = {
								trigger = {
									id = gwen.whale.planet.find.09
									is_colony = yes
								}
								found_planet = {
									orbit_planet = this
									wait = {
										duration = 30
										random = 90
									}
								}
							}
						}
						find_random_system = {
							trigger = {
								id = gwen.whale.system.find.29
								any_planet = { 
									is_planet_class = pc_gas_giant
								}
								distance = {
									source = PREV
									max_distance <= 200
									min_distance >= 10
								}
							}
							found_system = {
								move_to = this
								}
						}
						repeat = {
							max_iterations = 3
							find_random_planet = {
								trigger = {
									id = gwen.whale.planet.find.29
									is_planet_class = pc_gas_giant
								}
								found_planet = {
									orbit_planet = this
									wait = {
										duration = 30
										random = 90
									}
								}
							}
						}
						find_random_system = {
							trigger = {
								id = gwen.whale.system.find.49
								any_planet = { 
									is_planet_class = pc_gas_giant
								}
								distance = {
									source = PREV
									max_distance <= 50
									min_distance >= 20
								}
							}
							found_system = {
								move_to = this
							}
						}
						repeat = {
							max_iterations = 3
							find_random_planet = {
								trigger = {
									id = gwen.whale.planet.find.49
									is_planet_class = pc_gas_giant
								}
								found_planet = {
									orbit_planet = this
									wait = {
										duration = 30
										random = 90
									}
								}
							}
						}
						find_random_system = {
							trigger = {
								id = gwen.whale.system.find.39
								owner = {
									 has_origin = Origin_GAPS_Ranchers
								}
								any_planet = { 
									is_colony = yes
								}
							}
							found_system = {
								move_to = this
							}
						}
						repeat = {
							max_iterations = 1
							find_random_planet = {
								trigger = {
									id = gwen.whale.planet.find.39
									is_colony = yes
								}
								found_planet = {
									orbit_planet = this
									wait = {
										duration = 30
										random = 90
									}
								}
							}
						}
						find_random_system = {
							trigger = {
								id = gwen.whale.system.find.59
								any_planet = { 
									is_planet_class = pc_gas_giant
								}
								distance = {
									source = PREV
									max_distance <= 50
									min_distance >= 20
								}
							}
							found_system = {
								move_to = this
							}
						}
						repeat = {
							max_iterations = 3
							find_random_planet = {
								trigger = {
									id = gwen.whale.planet.find.59
									is_planet_class = pc_gas_giant
								}
								found_planet = {
									orbit_planet = this
									wait = {
										duration = 30
										random = 90
									}
								}
							}
						}
					}
				}
			}
		}
		else_if = { 
			limit = { root = { has_planet_flag = PlanetFlag_GAPS_Corraled_Tiyanki } }
			remove_planet_flag = PlanetFlag_GAPS_Corraled_Tiyanki
			last_created_fleet = {
				queue_actions = {
					repeat = {
						find_random_system = {
							trigger = {
								id = gwen.whale.system.find.05
								owner = {
									#is_same_value - Checks if the current scope and the target scope are the same thing
									is_same_value = event_target:Event_Target_System_Owner
								}
								any_planet = { 
									is_colony = yes
								}
							}
							found_system = {
								move_to = this
							}
						}
						repeat = {
							max_iterations = 1
							find_random_planet = {
								trigger = {
									id = gwen.whale.planet.find.05
									is_colony = yes
								}
								found_planet = {
									orbit_planet = this
									wait = {
										duration = 30
										random = 90
									}
								}
							}
						}
						find_random_system = {
							trigger = {
								id = gwen.whale.system.find.25
								owner = {
									#is_same_value - Checks if the current scope and the target scope are the same thing
									is_same_value = event_target:Event_Target_System_Owner
								}
								any_planet = { 
									is_planet_class = pc_gas_giant
								}
								distance = {
									source = PREV
									max_distance <= 200
									min_distance >= 0
								}
							}
							found_system = {
								move_to = this
							}
						}
						repeat = {
							max_iterations = 3
							find_random_planet = {
								trigger = {
									id = gwen.whale.planet.find.25
									is_planet_class = pc_gas_giant
								}
								found_planet = {
									orbit_planet = this
									wait = {
										duration = 30
										random = 90
									}
								}
							}
						}
						find_random_system = {
							trigger = {
								id = gwen.whale.system.find.15
								owner = {
									#is_same_value - Checks if the current scope and the target scope are the same thing
									is_same_value = event_target:Event_Target_System_Owner
								}
								any_planet = { 
									is_colony = yes
								}
							}
							found_system = {
								move_to = this
							}
						}
						repeat = {
							max_iterations = 1
							find_random_planet = {
								trigger = {
									id = gwen.whale.planet.find.15
									is_colony = yes
								}
								found_planet = {
									orbit_planet = this
									wait = {
										duration = 30
										random = 90
									}
								}
							}
						}
						find_random_system = {
							trigger = {
								id = gwen.whale.system.find.35
								owner = {
									#is_same_value - Checks if the current scope and the target scope are the same thing
									is_same_value = event_target:Event_Target_System_Owner
								}
								any_planet = { 
									is_planet_class = pc_gas_giant
								}
								distance = {
									source = PREV
									max_distance <= 200
									min_distance >= 0
								}
							}
							found_system = {
								move_to = this
							}
						}
						repeat = {
							max_iterations = 3
							find_random_planet = {
								trigger = {
									id = gwen.whale.planet.find.35
									is_planet_class = pc_gas_giant
								}
								found_planet = {
									orbit_planet = this
									wait = {
										duration = 30
										random = 90
									}
								}
							}
						}
					}
				}
			}
		}
	}
}
country_event = {
	id = Events_GAPS_Ranchers.3
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		owner = { has_origin = Origin_GAPS_Ranchers }
	}
	
	immediate = {
		country_event = { id = Events_GAPS_Ranchers.31 days = 1 }
		country_event = { id = Events_GAPS_Ranchers.32 days = 1 }
		country_event = { id = Events_GAPS_Ranchers.33 days = 1 }
		country_event = { id = Events_GAPS_Ranchers.51 days = 1 }
		
	}
}

country_event = {
	id = Events_GAPS_Ranchers.31
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		owner = { has_origin = Origin_GAPS_Ranchers }
	}
	
	immediate = {
		country_event = { id = Events_GAPS_Ranchers.31 days = 360 }
		every_system_within_border = {
			limit = { exists = starbase starbase = { has_starbase_building = Starbase_Building_GAPS_Roamer_Breeding_Area } }
			random_system_planet = { 
				limit = { is_planet_class = pc_gas_giant }
				set_planet_flag = PlanetFlag_GAPS_Roamer_Tiyanki
				save_event_target_as = Planet_Target_GAPS_Ranchers
				planet_event = { id = Events_GAPS_Ranchers.2 days = 0 }
			}
		}
	}
}
country_event = {
	id = Events_GAPS_Ranchers.32
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		owner = { has_origin = Origin_GAPS_Ranchers }
	}
	
	immediate = {
		country_event = { id = Events_GAPS_Ranchers.32 days = 360 }
		every_system_within_border = {
			limit = { exists = starbase starbase = { has_starbase_building = Starbase_Building_GAPS_Corraled_Breeding_Area } }
			random_system_planet = { 
				limit = { is_planet_class = pc_gas_giant }
				save_event_target_as = Planet_Target_GAPS_Ranchers
				set_planet_flag = PlanetFlag_GAPS_Corraled_Tiyanki
				planet_event = { id = Events_GAPS_Ranchers.2 days = 0 }
			}
		}
	}
}

country_event = {
	id = Events_GAPS_Ranchers.33
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		country_event = { id = Events_GAPS_Ranchers.33 days = 60 random 300 }
		every_system_within_border = {
			limit = {
				any_ship_in_system = { is_ship_size = space_whale_1	}
				any_ship_in_system = { is_ship_size = space_whale_2 }
			}
			every_fleet_in_system = {
				limit = {
					any_ship_in_fleet = { is_ship_size = space_whale_1	}
					any_ship_in_fleet = { is_ship_size = space_whale_2 }
				}
				every_ship = { 
					limit = { is_ship_size = space_whale_3 }
					random_list = {
						99 = {
							#you keep the ship
						}
						1 = {
							destroy_ship = this
							prev = {
								random_list = {
									50 = {
										create_ship = {
											name = "NAME_Bull"
											design = "NAME_Tiyanki_Bull"
										}
									}
									50 = {
										create_ship = {
											name = "NAME_Cow"
											design = "NAME_Tiyanki_Cow"
										}
									}
								}
							}
						}
					}
				}
			}
			every_fleet_in_system = {
				limit = { 
					num_ships < 8
					any_ship_in_fleet = { is_ship_size = space_whale_1 }
					any_ship_in_fleet = { is_ship_size = space_whale_2 }
				}
				random_list = {
					90 = {
					}
					10 = {
						create_ship = {
							name = "NAME_Calf"
							design = "NAME_Tiyanki_Calf"
						}
					}
				}
			}
		}
	}
}

country_event = {
	id = Events_GAPS_Ranchers.34
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
			random_list = {
				50 = {
					create_ship = {
						name = "NAME_Bull"
						design = "NAME_Tiyanki_Bull"
					}
				}
				50 = {
					create_ship = {
						name = "NAME_Cow"
						design = "NAME_Tiyanki_Cow"
					}
				}
			}
		destroy_ship = this
	}
}

# This = construction ship
# Fires when construction is complete,
# immediately before station is created
ship_event = { 
	id = Events_GAPS_Ranchers.41
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = solar_system
		owner = {
			has_origin = Origin_GAPS_Ranchers
		}
	}

	immediate = {
		If = { 
			limit = { solar_system = { any_system_planet = { is_planet_class = pc_black_hole } } }
			solar_system = { 
				remove_star_flag = StarFlag_GAPS_cattle_system
				If = {
					limit = { owner = { has_origin = Origin_GAPS_Ranchers } }
					set_star_flag = StarFlag_GAPS_cattle_system
				}
			}
		}
	}
}

# when a tiyanki enters a system
# A fleet has entered a system
# Scope = Fleet
# From = System
################
#Rancher MODIFIER
################
fleet_event = {
	id = Events_GAPS_Ranchers.4
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		from = { owner = { has_origin = Origin_GAPS_Ranchers owner = { has_technology = Tech_GAPS_Ranchers_Delight_1 } } }
		count_fleet_ships = { 
			limit = { 
				OR = {
					is_ship_size = space_whale_1
					is_ship_size = space_whale_2
					is_ship_size = space_whale_3
					is_ship_size = space_whale_4
				}
			} 
			count > 0
		}
	}
	
	immediate = {
		every_system_planet = { 
			remove_modifier = system_modifier_GAPS_whale_bonus_1
			remove_modifier = system_modifier_GAPS_whale_bonus_2
			remove_modifier = system_modifier_GAPS_whale_bonus_3
			remove_modifier = system_modifier_GAPS_whale_bonus_4
			remove_modifier = system_modifier_GAPS_whale_bonus_5
			limit = { 
				is_colony = yes
			}
			if = { 
				limit = { owner = { has_technology = Tech_GAPS_Ranchers_Delight_5 } }
				add_modifier = {
					modifier = system_modifier_GAPS_whale_bonus_5
					days = 30
				}
			}
			else_if = { 
				limit = { owner = { has_technology = Tech_GAPS_Ranchers_Delight_4 } }
				add_modifier = {
					modifier = system_modifier_GAPS_whale_bonus_4
					days = 30
				}
			}
			else_if = { 
				limit = { owner = { has_technology = Tech_GAPS_Ranchers_Delight_3 } }
				add_modifier = {
					modifier = system_modifier_GAPS_whale_bonus_3
					days = 30
				}
			}
			else_if = { 
				limit = { owner = { has_technology = Tech_GAPS_Ranchers_Delight_2 } }
				add_modifier = {
					modifier = system_modifier_GAPS_whale_bonus_2
					days = 30
				}
			}
			else_if = { 
				limit = { owner = { has_technology = Tech_GAPS_Ranchers_Delight_1 } }
				add_modifier = {
					modifier = system_modifier_GAPS_whale_bonus_1
					days = 30
				}
			}
		}
	}
}
country_event = {
	id = Events_GAPS_Ranchers.51
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		owner = { has_origin = Origin_GAPS_Ranchers }
	}
	immediate = {
		country_event = { id = Events_GAPS_Ranchers.51 days = 30 }
		every_owned_fleet = { 
			limit = { 
				solar_system = {
					any_ship_in_system = { 
						OR = {
							is_ship_size = space_whale_1
							is_ship_size = space_whale_2
							is_ship_size = space_whale_3
							is_ship_size = space_whale_4
						}
					}
				}
				owner = { has_technology = Tech_GAPS_Cattle_Protection_1 }
			}
			add_modifier = {
				modifier = ship_modifier_GAPS_whale_bonus
				days = 30
			}
			if = { 
				limit = { owner = { has_technology = Tech_GAPS_Cattle_Protection_2 } }
				add_modifier = {
					modifier = ship_modifier_GAPS_whale_bonus
					days = 30
				}
			}
			if = { 
				limit = { owner = { has_technology = Tech_GAPS_Cattle_Protection_3 } }
				add_modifier = {
					modifier = ship_modifier_GAPS_whale_bonus
					days = 30
				}
			}
			if = { 
				limit = { owner = { has_technology = Tech_GAPS_Cattle_Protection_4 } }
				add_modifier = {
					modifier = ship_modifier_GAPS_whale_bonus
					days = 30
				}
			}
		}
		
		every_owned_planet = { 
			remove_modifier = system_modifier_GAPS_whale_bonus_1
			remove_modifier = system_modifier_GAPS_whale_bonus_2
			remove_modifier = system_modifier_GAPS_whale_bonus_3
			remove_modifier = system_modifier_GAPS_whale_bonus_4
			remove_modifier = system_modifier_GAPS_whale_bonus_5
			limit = { 
				is_colony = yes
				solar_system = {
					any_ship_in_system = { 
						OR = {
							is_ship_size = space_whale_1
							is_ship_size = space_whale_2
							is_ship_size = space_whale_3
							is_ship_size = space_whale_4
						}
					}
				}
				owner = { has_technology = Tech_GAPS_Ranchers_Delight_1 }
			}
			if = { 
				limit = { owner = { has_technology = Tech_GAPS_Ranchers_Delight_5 } }
				add_modifier = {
					modifier = system_modifier_GAPS_whale_bonus_5
					days = 30
				}
			}
			else_if = { 
				limit = { owner = { has_technology = Tech_GAPS_Ranchers_Delight_4 } }
				add_modifier = {
					modifier = system_modifier_GAPS_whale_bonus_4
					days = 30
				}
			}
			else_if = { 
				limit = { owner = { has_technology = Tech_GAPS_Ranchers_Delight_3 } }
				add_modifier = {
					modifier = system_modifier_GAPS_whale_bonus_3
					days = 30
				}
			}
			else_if = { 
				limit = { owner = { has_technology = Tech_GAPS_Ranchers_Delight_2 } }
				add_modifier = {
					modifier = system_modifier_GAPS_whale_bonus_2
					days = 30
				}
			}
			else_if = { 
				limit = { owner = { has_technology = Tech_GAPS_Ranchers_Delight_1 } }
				add_modifier = {
					modifier = system_modifier_GAPS_whale_bonus_1
					days = 30
				}
			}
		}
	}
}