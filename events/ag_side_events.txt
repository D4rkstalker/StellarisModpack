namespace = ag_side

# Starlight-II (ag_side.11 - ag_side.46, ag_side.381, 382, 383 used here.)
# Ancient Wrekage (ag_side.72 - ag_side.77)
# Tachyon Blind Area (ag_side.102 - ag_side.123)
# Strange Storm (ag_side.152 - ag_side.160)
# Beacon of Prosperity (ag_side.202 - ag_side.244)
# Advanced Colonizer (ag_side.252 - ag_side.274)
# Anomalies (ag_side.301 - ag_side.303)
# Large Ship Hull Stabilizer (ag_side.351 - ag_side.360)
# Advanced Strategic Resources Production (ag_side.401 - ag_side.438)
# Abnomal Wreckage (ag_side.451 - ag_side.457)
# Science Constructors (ag_side.471 - ag_side.473)
# Auto Starbase (ag_side.501 - ag_side.509)

# on_yearly_pulse, Gatekeeper of side events expect Starlight II
event = {
	id = ag_side.1
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		ag_spawnsystem_gatekeeper_trigger = yes
		NAND = {
			has_global_flag = ag_side_71_fired
			has_global_flag = ag_aura_battleship_site_spawned
			has_global_flag = ag_dimensional_obelisk_site_spawned
			has_global_flag = ag_4662_preserve_area_spawned
			has_global_flag = ag_adv_col_spawned
			has_global_flag = ag_abnomal_wreckage_spawned
		}
	}
	immediate = {
		if = {
			limit = { NOT = { has_global_flag = ag_side_71_fired } }
			random_list = {
				90 = { }
				10 = { if = {
					limit = { any_system = {
						has_star_flag = ag_shattered_ringworld_system
						exists = space_owner
						space_owner = { is_ai = no }
					} }
					set_global_flag = ag_side_71_fired
					random_system = {
						limit = {
							has_star_flag = ag_shattered_ringworld_system
							exists = space_owner
							space_owner = { is_ai = no }
						}
						save_event_target_as = ag_shattered_ringworld_system
						space_owner = { country_event = { id = ag_side.72 days = 30 random = 60 } }
					}
				} }
			}
			reroll_random = yes
		}
		if = {
			limit = { NOT = { has_global_flag = ag_aura_battleship_site_spawned } }
			random_list = {
				96 = { }
				4 = { if = {
					limit = {
						has_global_flag = ag_system_spawn_1
						any_country = {
							is_ai = no
							any_planet_within_border = {
								exists = owner
								owner = { is_same_value = prevprev }
								exists = controller
								controller = { is_same_value = prevprev }
								is_colony = yes
								is_capital = no
								num_pops > 5
								has_ground_combat = no
								has_moon = yes
								any_moon = {
									NOT = { exists = archaeological_site }
									OR = {
										is_planet_class = pc_barren
										is_planet_class = pc_barren_cold
									}
								}
							}
						}
					}
					set_global_flag = ag_aura_battleship_site_spawned
					random_country = {
						limit = {
							is_ai = no
							any_planet_within_border = {
								exists = owner
								owner = { is_same_value = prevprev }
								exists = controller
								controller = { is_same_value = prevprev }
								is_colony = yes
								is_capital = no
								num_pops > 5
								has_ground_combat = no
								has_moon = yes
								any_moon = {
									NOT = { exists = archaeological_site }
									OR = {
										is_planet_class = pc_barren
										is_planet_class = pc_barren_cold
									}
								}
							}
						}
						random_planet_within_border = {
							limit = {
								exists = owner
								owner = { is_same_value = prevprev }
								exists = controller
								controller = { is_same_value = prevprev }
								is_colony = yes
								is_capital = no
								num_pops > 5
								has_ground_combat = no
								has_moon = yes
								any_moon = {
									NOT = { exists = archaeological_site }
									OR = {
										is_planet_class = pc_barren
										is_planet_class = pc_barren_cold
									}
								}
							}
							planet_event = { id = ag_side.102 days = 15 random = 15 }
						}
					}
				} }
			}
			reroll_random = yes
		}
		if = {
			limit = { NOT = { has_global_flag = ag_dimensional_obelisk_site_spawned } }
			random_list = {
				96 = { }
				4 = { if = {
					limit = {
						has_global_flag = ag_system_spawn_1
						any_country = {
							is_ai = no
							any_planet_within_border = {
								is_planet_class = pc_toxic
								NOT = { exists = archaeological_site }
							}
						}
					}
					set_global_flag = ag_dimensional_obelisk_site_spawned
					random_country = {
						limit = {
							is_ai = no
							any_planet_within_border = {
								is_planet_class = pc_toxic
								NOT = { exists = archaeological_site }
							}
						}
						random_planet_within_border = {
							limit = {
								is_planet_class = pc_toxic
								NOT = { exists = archaeological_site }
							}
							save_event_target_as = ag_side_152_target_planet
						}
						country_event = { id = ag_side.152 days = 15 random = 15 }
					}
				}
			} }
			reroll_random = yes
		}
		if = {
			limit = { NOT = { has_global_flag = ag_4662_preserve_area_spawned } }
			random_list = {
				96 = { }
				4 = { if = {
					limit = {
						has_global_flag = ag_primitive_136_fired
						any_country = {
							is_ai = no
							any_system_within_border = { OR = {
								has_star_flag = ag_primitive_system
								has_star_flag = ag_primitive_system_2
								has_star_flag = ag_primitive_system_3
							} }
						}
					}
					set_global_flag = ag_4662_preserve_area_spawned
					random_country = {
						limit = {
							is_ai = no
							any_system_within_border = { OR = {
								has_star_flag = ag_primitive_system
								has_star_flag = ag_primitive_system_2
								has_star_flag = ag_primitive_system_3
							} }
						}
						country_event = { id = ag_side.202 days = 15 random = 15 }
					}
				} }
			}
			reroll_random = yes
		}
		if = {
			limit = { NOT = { has_global_flag = ag_adv_col_spawned } }
			random_list = {
				95 = {
					# modifier = { add = -5 mid_game_years_passed < 0 }
					# modifier = { add = -5 end_game_years_passed < 0 }
				}
				5 = {
					# modifier = { add = 5 mid_game_years_passed < 0 }
					# modifier = { add = 5 end_game_years_passed < 0 }
					if = {
						limit = {
							has_global_flag = ag_4762_preserved_world_spawned
							any_country = {
								is_ai = no
								any_owned_planet = {
									OR = {
										is_planet_class = pc_desert
										is_planet_class = pc_arid
										is_planet_class = pc_gaia		# In some op mods environment, ordinary planets are rare.
									}
									is_capital = no
									has_ground_combat = no
									num_pops > 4
									exists = controller
									controller = { is_same_value = prev.owner }
									NOT = { exists = archaeological_site }
								}
							}
						}
						set_global_flag = ag_adv_col_spawned
						random_country = {
							limit = {
								is_ai = no
								any_owned_planet = {
									OR = {
										is_planet_class = pc_desert
										is_planet_class = pc_arid
										is_planet_class = pc_gaia		# In some op mods environment, ordinary planets are rare.
									}
									is_capital = no
									has_ground_combat = no
									num_pops > 4
									exists = controller
									controller = { is_same_value = prev.owner }
									NOT = { exists = archaeological_site }
								}
							}
							random_owned_planet = {
								limit = {
									OR = {
										is_planet_class = pc_desert
										is_planet_class = pc_arid
										is_planet_class = pc_gaia		# In some op mods environment, ordinary planets are rare.
									}
									is_capital = no
									has_ground_combat = no
									num_pops > 4
									exists = controller
									controller = { is_same_value = prev.owner }
									NOT = { exists = archaeological_site }
								}
								planet_event = { id = ag_side.252 days = 30 random = 30 }
							}
						}
					}
				}
			}
			reroll_random = yes
		}
		if = {
			limit = { NOT = { has_global_flag = ag_abnomal_wreckage_spawned } }
			random_list = {
				95 = { }
				5 = { if = {
					limit = {
						has_global_flag = ag_system_spawn_1
						any_country = {
							is_ai = no
							any_system_within_border = {
								ag_is_ancient_system = no
								OR = {
									is_star_class = sc_g
									is_star_class = sc_k
									is_star_class = sc_m
									is_star_class = sc_m_giant
								}
								any_system_planet = {
									is_primary_star = yes
									OR = {
										is_planet_class = pc_g_star
										is_planet_class = pc_k_star
										is_planet_class = pc_m_star
										is_planet_class = pc_m_giant_star
									}
								}
								any_system_planet = {
									is_asteroid = yes
									OR = {
										is_planet_class = pc_asteroid
										is_planet_class = pc_ice_asteroid
									}
									NOT = { exists = archaeological_site }
								}
								NOT = { any_system_planet = { OR = {
									is_colony = yes
									is_under_colonization = yes
								} } }
							}
						}
					}
					set_global_flag = ag_abnomal_wreckage_spawned
					random_country = {
						limit = {
							is_ai = no
							any_system_within_border = {
								ag_is_ancient_system = no
								OR = {
									is_star_class = sc_g
									is_star_class = sc_k
									is_star_class = sc_m
									is_star_class = sc_m_giant
								}
								any_system_planet = {
									is_primary_star = yes
									OR = {
										is_planet_class = pc_g_star
										is_planet_class = pc_k_star
										is_planet_class = pc_m_star
										is_planet_class = pc_m_giant_star
									}
								}
								any_system_planet = {
									is_asteroid = yes
									OR = {
										is_planet_class = pc_asteroid
										is_planet_class = pc_ice_asteroid
									}
									NOT = { exists = archaeological_site }
								}
								NOT = { any_system_planet = { OR = {
									is_colony = yes
									is_under_colonization = yes
								} } }
							}
						}
						random_system_within_border = {
							limit = {
								ag_is_ancient_system = no
								OR = {
									is_star_class = sc_g
									is_star_class = sc_k
									is_star_class = sc_m
									is_star_class = sc_m_giant
								}
								any_system_planet = {
									is_primary_star = yes
									OR = {
										is_planet_class = pc_g_star
										is_planet_class = pc_k_star
										is_planet_class = pc_m_star
										is_planet_class = pc_m_giant_star
									}
								}
								any_system_planet = {
									is_asteroid = yes
									OR = {
										is_planet_class = pc_asteroid
										is_planet_class = pc_ice_asteroid
									}
									NOT = { exists = archaeological_site }
								}
								NOT = { any_system_planet = { OR = {
									is_colony = yes
									is_under_colonization = yes
								} } }
							}
							random_system_planet = {
								limit = {
									is_asteroid = yes
									OR = {
										is_planet_class = pc_asteroid
										is_planet_class = pc_ice_asteroid
									}
									NOT = { exists = archaeological_site }
								}
								save_event_target_as = ag_side_451_target_planet
							}
						}
						country_event = { id = ag_side.451 days = 15 random = 15 }
					}
				} }
			}
			reroll_random = yes
		}
		if = {
			limit = { NOT = { has_global_flag = ag_auto_starbase_spawned } }
			random_list = {
				92 = { }
				8 = { if = {
					limit = {
						has_global_flag = ag_theta_area_spawned
						any_country = {
							is_ai = no
							any_owned_planet = {
								OR = {
									is_planet_class = pc_ocean
									is_planet_class = pc_continental
									is_planet_class = pc_gaia			# In some op mods environment, ordinary planets are rare.
								}
								is_capital = no
								solar_system = { NOT = { any_system_planet = { is_colony = yes is_capital = yes } } }
								has_ground_combat = no
								num_pops > 4
								exists = controller
								controller = { is_same_value = prev.owner }
								NOT = { exists = archaeological_site }
								has_moon = yes
								# any_moon = {
									# OR = {
										# is_planet_class = pc_barren
										# is_planet_class = pc_barren_cold
									# }
									# NOT = { exists = archaeological_site }
								# }
							}
						}
					}
					set_global_flag = ag_auto_starbase_spawned
					random_country = {
						limit = {
							is_ai = no
							any_owned_planet = {
								OR = {
									is_planet_class = pc_ocean
									is_planet_class = pc_continental
									is_planet_class = pc_gaia			# In some op mods environment, ordinary planets are rare.
								}
								is_capital = no
								solar_system = { NOT = { any_system_planet = { is_colony = yes is_capital = yes } } }
								has_ground_combat = no
								num_pops > 4
								exists = controller
								controller = { is_same_value = prev.owner }
								NOT = { exists = archaeological_site }
								has_moon = yes
								# any_moon = {
									# OR = {
										# is_planet_class = pc_barren
										# is_planet_class = pc_barren_cold
									# }
									# NOT = { exists = archaeological_site }
								# }
							}
						}
						random_owned_planet = {
							limit = {
								OR = {
									is_planet_class = pc_ocean
									is_planet_class = pc_continental
									is_planet_class = pc_gaia			# In some op mods environment, ordinary planets are rare.
								}
								is_capital = no
								solar_system = { NOT = { any_system_planet = { is_colony = yes is_capital = yes } } }
								has_ground_combat = no
								num_pops > 4
								exists = controller
								controller = { is_same_value = prev.owner }
								NOT = { exists = archaeological_site }
								has_moon = yes
								# any_moon = {
									# OR = {
										# is_planet_class = pc_barren
										# is_planet_class = pc_barren_cold
									# }
									# NOT = { exists = archaeological_site }
								# }
							}
							planet_event = { id = ag_side.501 days = 30 random = 30 }
						}
					}
				} }
			}
			reroll_random = yes
		}
		# if = {
		# 	limit = { NOT = { has_global_flag = flagflagflagflagflag } }
		# 	random_list = {
		# 		95 = { }
		# 		5 = { if = {
		# 			limit = {
		# 			}
		# 			set_global_flag = flagflagflagflagflag
		# 		} }
		# 	}
		# 	reroll_random = yes
		# }
	}
}

# Starlight-II
# Gatekeeper, spawn ancient ship within border
event = {
	id = ag_side.11
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOR = {
			has_global_flag = ag_lost_ancient_ship_spawned
			has_global_flag = ag_lost_ancient_ship_spawn_cooldown
		}
		has_global_flag = ag_5524_preserved_world_spawned
	}
	immediate = {
		random_list = {
			499 = {
				# 1/500 per month -> 1/250 per month -> 1/100 per month -> 1/50 per month -> 1/20 per month.
				# 540 days cooldown to prevent frequently check any_country & any_planet_within_border trigger.
				modifier = { add = -250 has_global_flag = ag_9102_preserved_world_spawned }
				modifier = { add = -150 has_global_flag = ag_theta_area_spawned }
				modifier = {
					add = -50
					OR = {
						has_global_flag = ag_alpha_area_spawned
						has_global_flag = ag_beta_area_spawned
						has_global_flag = ag_gamma_area_spawned
						has_global_flag = ag_delta_area_spawned
						has_global_flag = ag_epsilon_area_spawned
						has_global_flag = ag_eta_area_spawned
						has_global_flag = ag_zeta_area_spawned
						has_global_flag = ag_iota_area_spawned
					}
				}
				modifier = {
					add = -30
					calc_true_if = {
						amount >= 2
						has_global_flag = ag_alpha_area_spawned
						has_global_flag = ag_beta_area_spawned
						has_global_flag = ag_gamma_area_spawned
						has_global_flag = ag_delta_area_spawned
						has_global_flag = ag_epsilon_area_spawned
						has_global_flag = ag_eta_area_spawned
						has_global_flag = ag_zeta_area_spawned
						has_global_flag = ag_iota_area_spawned
					}
				}
			}
			1 = {
				if = {
					limit = { any_country = {
						is_ai = no
						any_planet_within_border = {
							is_planet_class = pc_gas_giant
							OR = {
								has_mining_station = yes
								has_research_station = yes
							}
							solar_system = { NOT = { has_star_flag = guardian } }
						}
					} }
					set_global_flag = ag_lost_ancient_ship_spawned
					random_country = {
						limit = {
							is_ai = no
							any_planet_within_border = {
								is_planet_class = pc_gas_giant
								OR = { has_mining_station = yes has_research_station = yes }
								solar_system = { NOT = { has_star_flag = guardian } }
							}
						}
						random_planet_within_border = {
							limit = {
								is_planet_class = pc_gas_giant
								OR = { has_mining_station = yes has_research_station = yes }
								solar_system = { NOT = { has_star_flag = guardian } }
							}
							save_global_event_target_as = ag_lost_ancient_ship_target_gas_giant
						}
						country_event = { id = ag_side.12 }
					}
					ag_create_ancient_guardian = {
						ag_country_name = "NAME_ag_lost_ancient_ship_country_1"
						ag_country_type = ag_ancient_guardian_passive
					}
					last_created_country = {
						save_global_event_target_as = ag_lost_ancient_ship_country
						set_country_flag = ag_lost_ancient_ship_country
						ag_ancient_country_friendly_to_each_other = yes
						create_fleet = {
							name = "NAME_ag_lost_ancient_ship_fleet"
							settings = {
								spawn_debris = no
								can_upgrade = no
								uses_naval_capacity = no
							}
							effect = {
								set_owner = event_target:ag_lost_ancient_ship_country
								create_ship = {
									name = "NAME_ag_lost_ancient_ship"
									design = "NAME_ag_lost_ancient_ship_battleship_form"
									prefix = no
									effect = {
										set_ship_flag = ag_lost_ancient_ship
										ag_difficulty_bonus = yes
										ag_lost_ancient_ship_debuff = yes
										if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
										save_global_event_target_as = ag_starlight_2_ship
									}
								}
								set_location = { target = event_target:ag_lost_ancient_ship_target_gas_giant distance = 200 angle = random }
								auto_move_to_planet = { target = event_target:ag_lost_ancient_ship_target_gas_giant clear_auto_move_on_arrival = yes }
							}
						}
					}
				}
				else = { set_timed_global_flag = { flag = ag_lost_ancient_ship_spawn_cooldown days = 540 } }
			}
		}
		reroll_random = yes
	}
}

# Notification for ancient ship entering border
country_event = {
	id = ag_side.12
	title = "ag_side.12.name"
	desc = "ag_side.12.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unknown_ships_room }
	show_sound = event_yellow_alert
	location = event_target:ag_lost_ancient_ship_target_gas_giant

	is_triggered_only = yes
	
	option = {
		name = "ag_side.12.a"
		trigger = {
			NOR = {
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_machine_terminator
			}
		}
	}
	option = {
		name = "ag_side.12.b"
		trigger = {
			NOT = {
				has_ethic = ethic_gestalt_consciousness
			}
		}
		hidden_effect = {
			set_faction_hostility = {
				target = event_target:ag_lost_ancient_ship_country
				set_hostile = yes
				set_neutral = no
				set_friendly = no
			}
		}
	}
	option = {
		name = "ag_side.12.c"
		trigger = {
			has_ethic = ethic_gestalt_consciousness
		}
		hidden_effect = {
			set_faction_hostility = {
				target = event_target:ag_lost_ancient_ship_country
				set_hostile = yes
				set_neutral = no
				set_friendly = no
			}
		}
	}
}

# on_fleet_destroyed_perp, Destroy ancient ship
country_event = {
	id = ag_side.13
	title = "ag_side.13.name"
	desc = "ag_side.13.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_space_battle
	location = fromfrom

	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = { from = { has_country_flag = ag_lost_ancient_ship_country } }
	immediate = { from = { destroy_country = yes } }
	
	option = {
		name = "ag_side.13.a"
		trigger = { NOR = {
			has_ethic = ethic_militarist
			has_ethic = ethic_fanatic_militarist
			has_ethic = ethic_xenophobe
			has_ethic = ethic_fanatic_xenophobe
			has_ethic = ethic_gestalt_consciousness
		} }
		add_resource = { influence = 50 }
	}
	option = {
		name = "ag_side.13.b"
		trigger = {
			has_ethic = ethic_gestalt_consciousness
			NOR = {
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_machine_terminator
			}
		}
		add_resource = { influence = 50 }
	}
	option = {
		name = "ag_side.13.c"
		trigger = {
			OR = {
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_militarist
			}
			NOT = { has_valid_civic = civic_fanatic_purifiers }
		}
		add_resource = { influence = 50 }
		ag_add_monthly_unity = { ag_tier = 1 }
	}
	option = {
		name = "ag_side.13.d"
		trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
			NOT = { has_valid_civic = civic_fanatic_purifiers }
		}
		add_resource = { influence = 50 }
		ag_add_monthly_unity = { ag_tier = 1 }
	}
	option = {
		name = "ag_side.13.e"
		trigger = { has_valid_civic = civic_fanatic_purifiers }
		add_resource = { influence = 80 }
		ag_add_monthly_unity = { ag_tier = 2 }
	}
	option = {
		name = "ag_side.13.f"
		trigger = { OR = {
			has_valid_civic = civic_hive_devouring_swarm
			has_valid_civic = civic_machine_terminator
		} }
		add_resource = { influence = 80 }
		ag_add_monthly_unity = { ag_tier = 2 }
	}
}

# on_fleet_destroyed_victim, Lost space battle, remove ancient ship
country_event = {
	id = ag_side.14
	title = "ag_side.14.name"
	desc = "ag_side.14.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_space_battle
	location = fromfrom.solar_system

	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		from = { has_country_flag = ag_lost_ancient_ship_country }
		fromfrom = { any_controlled_ship = { is_ship_class = shipclass_military } }
	}
	immediate = {
		fromfromfrom = { ag_spawn_explosion_effect = { ag_scale = xl ag_color = red } destroy_fleet = this }
		from = { destroy_country = yes }
	}
	
	option = {
		name = "ag_side.14.a"
		trigger = { NOR = {
			has_ethic = ethic_militarist
			has_ethic = ethic_fanatic_militarist
			has_ethic = ethic_xenophobe
			has_ethic = ethic_fanatic_xenophobe
			has_ethic = ethic_gestalt_consciousness
		} }
		add_resource = { influence = 50 }
	}
	option = {
		name = "ag_side.14.b"
		trigger = {
			has_ethic = ethic_gestalt_consciousness
			NOR = {
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_machine_terminator
			}
		}
		add_resource = { influence = 50 }
	}
	option = {
		name = "ag_side.14.c"
		trigger = {
			OR = {
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_militarist
			}
			NOT = { has_valid_civic = civic_fanatic_purifiers }
		}
		add_resource = { influence = 50 }
		ag_add_monthly_unity = { ag_tier = 1 }
	}
	option = {
		name = "ag_side.14.d"
		trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
			NOT = { has_valid_civic = civic_fanatic_purifiers }
		}
		add_resource = { influence = 50 }
		ag_add_monthly_unity = { ag_tier = 2 }
	}
	option = {
		name = "ag_side.14.e"
		trigger = { has_valid_civic = civic_fanatic_purifiers }
		add_resource = { influence = 80 }
		ag_add_monthly_unity = { ag_tier = 2 }
	}
	option = {
		name = "ag_side.14.f"
		trigger = { OR = {
			has_valid_civic = civic_hive_devouring_swarm
			has_valid_civic = civic_machine_terminator
		} }
		add_resource = { influence = 80 }
		ag_add_monthly_unity = { ag_tier = 2 }
	}
}

# on_fleet_auto_move_arrival, Ancient ship entering a gas giant's orbit
country_event = {
	id = ag_side.15
	hide_window = yes
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		has_country_flag = ag_lost_ancient_ship_country
	}
	
	immediate = {
		from = {
			clear_orders = yes
			clear_fleet_actions = this
			solar_system = {
				if = {
					limit = {
						exists = space_owner
					}
					space_owner = {
						country_event = { id = ag_side.16 }
						country_event = { id = ag_side.17 days = 10 }
					}
				}
				else = {
					event_target:ag_lost_ancient_ship_country = {
						country_event = { id = ag_side.20 days = 30 }
					}
				}
			}
		}
	}
}

# Notification, Ancient ship entering a gas giant's orbit
country_event = {
	id = ag_side.16
	title = "ag_side.16.name"
	desc = "ag_side.16.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unknown_ships_room }
	show_sound = event_yellow_alert
	location = event_target:ag_lost_ancient_ship_target_gas_giant

	is_triggered_only = yes
	
	trigger = {
		exists = event_target:ag_lost_ancient_ship_country
		NOT = {
			is_hostile = event_target:ag_lost_ancient_ship_country
		}
	}
	
	option = {
		name = "ag_side.16.a"
	}
	option = {
		name = "ag_side.16.b"
		hidden_effect = {
			set_faction_hostility = {
				target = event_target:ag_lost_ancient_ship_country
				set_hostile = yes
				set_neutral = no
				set_friendly = no
			}
		}
	}
}

# Incoming transmission from the ancient ship
country_event = {
	id = ag_side.17
	title = "ag_side.17.name"
	desc = "ag_side.17.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_star_chart_room }
	show_sound = event_radio_chatter
	location = event_target:ag_lost_ancient_ship_target_gas_giant

	is_triggered_only = yes
	
	trigger = {
		exists = event_target:ag_lost_ancient_ship_country
		NOT = {
			is_hostile = event_target:ag_lost_ancient_ship_country
		}
	}
	
	option = {
		name = "ag_side.17.a"
		hidden_effect = {
			country_event = { id = ag_side.21 }
		}
	}
	option = {
		name = "ag_side.17.b"
		hidden_effect = {
			country_event = { id = ag_side.18 days = 30 }
			event_target:ag_lost_ancient_ship_country = {
				country_event = { id = ag_side.20 days = 30 }
			}
		}
	}
}

# Notification, ancient ship left
country_event = {
	id = ag_side.18
	title = "ag_side.18.name"
	desc = "ag_side.18.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unknown_ships_room }
	show_sound = event_sensor_ping
	is_triggered_only = yes
	trigger = { exists = event_target:ag_lost_ancient_ship_country }
	option = { name = "ag_side.18.a" }
}
country_event = {
	id = ag_side.19
	title = "ag_side.19.name"
	desc = "ag_side.19.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unknown_ships_room }
	show_sound = event_sensor_ping
	is_triggered_only = yes
	trigger = { exists = event_target:ag_lost_ancient_ship_country }
	option = { name = "ag_side.19.a" }
}

# Remove ancient ship
country_event = {
	id = ag_side.20
	hide_window = yes

	is_triggered_only = yes
	trigger = {
		exists = event_target:ag_lost_ancient_ship_country
		is_same_value = event_target:ag_lost_ancient_ship_country
	}
	
	after = {
		random_controlled_ship = { ag_spawn_jumpdrive_effect = { ag_color = red } delete_ship = this }
		destroy_country = yes
	}
}

# COmmunication with ancient ship
country_event = {
	id = ag_side.21
	title = "ag_side.21.name"
	desc = "ag_side.21.desc"
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		room = "ag_lost_ancient_ship_room"
	}
	
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:ag_lost_ancient_ship_country
		NOT = {
			is_hostile = event_target:ag_lost_ancient_ship_country
		}
	}
	
	immediate = {
		establish_communications_no_message = event_target:ag_lost_ancient_ship_country
	}
	
	option = {
		name = "ag_side.21.a"
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						has_country_flag = worm_events_available
					}
				}
				country_event = { id = ag_side.22 }
				
			}
			else = {
				country_event = { id = ag_side.41 }
			}
		}
	}
	option = {
		name = "ag_side.21.b"
		trigger = {
			OR = {
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_militarist
			}
		}
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						has_country_flag = worm_events_available
					}
				}
				country_event = { id = ag_side.22 }
				
			}
			else = {
				country_event = { id = ag_side.41 }
			}
		}
	}
	option = {
		name = "ag_side.21.c"
		trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						has_country_flag = worm_events_available
					}
				}
				country_event = { id = ag_side.22 }
				
			}
			else = {
				country_event = { id = ag_side.41 }
			}
		}
	}
}
country_event = {
	id = ag_side.22
	title = "ag_side.22.name"
	desc = "ag_side.22.desc"
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		room = "ag_lost_ancient_ship_room"
	}
	
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:ag_lost_ancient_ship_country
		NOT = {
			is_hostile = event_target:ag_lost_ancient_ship_country
		}
	}
	
	option = {
		name = "ag_side.22.a"
		is_dialog_only = yes
		response_text = "ag_side.22.a.response"
	}
	option = {
		name = "ag_side.22.b"
		is_dialog_only = yes
		response_text = "ag_side.22.b.response"
	}
	option = {
		name = "ag_side.22.c"
		hidden_effect = {
			country_event = { id = ag_side.23 }
		}
	}
	option = {
		name = "ag_side.22.d"
		response_text = "ag_side.22.d.response"
		hidden_effect = {
			country_event = { id = ag_side.19 days = 30 }
			event_target:ag_lost_ancient_ship_country = {
				country_event = { id = ag_side.20 days = 30 }
			}
		}
	}
}
country_event = {
	id = ag_side.23
	title = "ag_side.23.name"
	desc = "ag_side.23.desc"
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		room = "ag_lost_ancient_ship_room"
	}
	
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:ag_lost_ancient_ship_country
		NOT = {
			is_hostile = event_target:ag_lost_ancient_ship_country
		}
	}
	
	immediate = {
		event_target:ag_lost_ancient_ship_country = {
			random_controlled_ship = {
				save_event_target_as = ag_target_ship
			}
		}
	}
	
	option = {
		name = "ag_side.23.a"
		response_text = "ag_side.23.a.response"
		enable_special_project = {
			name = "ag_repair_lost_ancient_ship"
			location = event_target:ag_target_ship
			owner = root
		}
	}
	option = {
		name = "ag_side.23.b"
		response_text = "ag_side.23.b.response"
		hidden_effect = {
			country_event = { id = ag_side.19 days = 30 }
			event_target:ag_lost_ancient_ship_country = {
				country_event = { id = ag_side.20 days = 30 }
			}
		}
	}
	option = {
		name = "ag_side.23.c"
		response_text = "ag_side.23.c.response"
		enable_special_project = {
			name = "ag_hack_lost_ancient_ship"
			location = event_target:ag_target_ship
			owner = root
		}
	}
}
country_event = {
	id = ag_side.24
	title = "ag_side.24.name"
	desc = "ag_side.24.desc"
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		room = "ag_lost_ancient_ship_room"
	}
	
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:ag_lost_ancient_ship_country
		NOT = {
			is_hostile = event_target:ag_lost_ancient_ship_country
		}
	}
	
	option = {
		name = "ag_side.24.a"
		hidden_effect = {
			country_event = { id = ag_side.25 }
		}
	}
	option = {
		name = "ag_side.24.b"
		response_text = "ag_side.24.b.response"
		hidden_effect = {
			country_event = { id = ag_side.19 days = 30 }
			event_target:ag_lost_ancient_ship_country = {
				country_event = { id = ag_side.20 days = 30 }
			}
		}
	}
}
country_event = {
	id = ag_side.25
	title = "ag_side.25.name"
	desc = "ag_side.25.desc"
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		room = "ag_lost_ancient_ship_room"
	}
	
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:ag_lost_ancient_ship_country
		NOT = {
			is_hostile = event_target:ag_lost_ancient_ship_country
		}
	}
	
	option = {
		name = "ag_side.25.a"
		hidden_effect = {
			country_event = { id = ag_side.26 }
		}
	}
}
country_event = {
	id = ag_side.26
	title = "ag_side.26.name"
	desc = "ag_side.26.desc"
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		room = "ag_lost_ancient_ship_room"
	}
	
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:ag_lost_ancient_ship_country
		NOT = { is_hostile = event_target:ag_lost_ancient_ship_country }
	}
	
	option = {
		name = "ag_side.26.a"
		response_text = "ag_side.26.a.response"
		hidden_effect = {
			if = {
				limit = { exists = event_target:ag_lost_ancient_ship_country }
				event_target:ag_lost_ancient_ship_country = {
					random_controlled_fleet = { set_owner = root }
					destroy_country = yes
				}
			}
			if = {
				limit = { NOT = { exists = event_target:ag_lost_ancient_ship_country_coms } }
				ag_create_ancient_guardian = {
					ag_country_name = "NAME_ag_lost_ancient_ship_country_2"
					ag_country_type = ag_lost_ancient_ship_country
				}
				last_created_country = {
					save_global_event_target_as = ag_lost_ancient_ship_country_coms
					establish_communications_no_message = root
					ag_ancient_country_friendly_to_each_other = yes
				}
			}
			if = {
				limit = { exists = event_target:ag_lost_ancient_ship_owner }
				clear_global_event_target = ag_lost_ancient_ship_owner
			}
			save_global_event_target_as = ag_lost_ancient_ship_owner
			set_country_flag = ag_lost_ancient_ship_battleship_form_active
			set_country_flag = ag_lost_ancient_ship_target_guardian_sphere_protected

			# Interaction event.
			if = {
				limit = {
					has_global_flag = has_StellarRegulator_Array_mod
					OR = {
						has_civic = civic_SRAtechnology
						has_civic = civic_SRARociviaEmpire
					}
				}
				country_event = { id = SRA_ag_StarLightII.1 days = 3600 random = 3600 }
			}
		}
	}
}

# Hack in ancient ship's system, succeed
country_event = {
	id = ag_side.27
	title = "ag_side.27.name"
	desc = "ag_side.27.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_lost_ancient_battleship_room }
	show_sound = event_ai_started
	location = event_target:ag_target_fleet
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ag_lost_ancient_ship_country
		NOT = {
			is_hostile = event_target:ag_lost_ancient_ship_country
		}
	}

	immediate = {
		event_target:ag_lost_ancient_ship_country = {
			random_controlled_fleet = {
				save_event_target_as = ag_target_fleet
			}
		}
	}
	
	option = {
		name = "ag_side.27.a"
		hidden_effect = {
			event_target:ag_target_fleet = {
				set_owner = root
				root = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_hyper_drive_2
								has_technology = tech_hyper_drive_3
								has_technology = tech_jump_drive_1
								has_technology = tech_psi_jump_drive_1
							}
						}
						prev = {
							random_controlled_ship = {
								save_event_target_as = ag_target_ship
							}
							create_ship = {
								name = "NAME_ag_lost_ancient_ship"
								design = "NAME_ag_lost_ancient_ship_battleship_form_hyperdrive_1"
								prefix = no
								
								effect = {
									copy_flags_and_variables_from = event_target:ag_target_ship
									ag_difficulty_bonus = yes
									ag_lost_ancient_ship_debuff = yes
								}
							}
							event_target:ag_target_ship = {
								delete_ship = this
							}
						}
					}
					else_if = {
						limit = {
							has_technology = tech_psi_jump_drive_1
						}
						prev = {
							random_controlled_ship = {
								save_event_target_as = ag_target_ship
							}
							create_ship = {
								name = "NAME_ag_lost_ancient_ship"
								design = "NAME_ag_lost_ancient_ship_battleship_form_psi_jumpdrive_1"
								prefix = no
								
								effect = {
									copy_flags_and_variables_from = event_target:ag_target_ship
									ag_difficulty_bonus = yes
									ag_lost_ancient_ship_debuff = yes
								}
							}
							event_target:ag_target_ship = {
								delete_ship = this
							}
						}
					}
					else_if = {
						limit = {
							has_technology = tech_jump_drive_1
						}
						prev = {
							random_controlled_ship = {
								save_event_target_as = ag_target_ship
							}
							create_ship = {
								name = "NAME_ag_lost_ancient_ship"
								design = "NAME_ag_lost_ancient_ship_battleship_form_jumpdrive_1"
								prefix = no
								
								effect = {
									copy_flags_and_variables_from = event_target:ag_target_ship
									ag_difficulty_bonus = yes
									ag_lost_ancient_ship_debuff = yes
								}
							}
							event_target:ag_target_ship = {
								delete_ship = this
							}
						}
					}
					else_if = {
						limit = {
							has_technology = tech_hyper_drive_3
						}
						prev = {
							random_controlled_ship = {
								save_event_target_as = ag_target_ship
							}
							create_ship = {
								name = "NAME_ag_lost_ancient_ship"
								design = "NAME_ag_lost_ancient_ship_battleship_form_hyperdrive_3"
								prefix = no
								
								effect = {
									copy_flags_and_variables_from = event_target:ag_target_ship
									ag_difficulty_bonus = yes
									ag_lost_ancient_ship_debuff = yes
								}
							}
							event_target:ag_target_ship = {
								delete_ship = this
							}
						}
					}
					else_if = {
						limit = {
							has_technology = tech_hyper_drive_2
						}
						prev = {
							random_controlled_ship = {
								save_event_target_as = ag_target_ship
							}
							create_ship = {
								name = "NAME_ag_lost_ancient_ship"
								design = "NAME_ag_lost_ancient_ship_battleship_form_hyperdrive_2"
								prefix = no
								
								effect = {
									copy_flags_and_variables_from = event_target:ag_target_ship
									ag_difficulty_bonus = yes
									ag_lost_ancient_ship_debuff = yes
								}
							}
							event_target:ag_target_ship = {
								delete_ship = this
							}
						}
					}
				}
			}
			event_target:ag_lost_ancient_ship_country = {
				destroy_country = yes
			}
		}
	}
}

# Failed to hack in ancient ship's system
country_event = {
	id = ag_side.28
	title = "ag_side.28.name"
	desc = "ag_side.28.desc"
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		room = "ag_lost_ancient_ship_room"
	}
	
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:ag_lost_ancient_ship_country
		NOT = {
			is_hostile = event_target:ag_lost_ancient_ship_country
		}
	}
	
	option = {
		name = "ag_side.28.a"
		response_text = "ag_side.28.a.response"
		hidden_effect = {
			country_event = { id = ag_side.29 days = 1 }
			country_event = { id = ag_side.19 days = 30 }
			event_target:ag_lost_ancient_ship_country = {
				country_event = { id = ag_side.20 days = 30 }
			}
		}
	}
}
country_event = {
	id = ag_side.29
	title = "ag_side.29.name"
	desc = "ag_side.29.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_default
	
	is_triggered_only = yes
	
	option = {
		name = "ag_side.29.a"
		if = {
			limit = { NOT = { has_technology = tech_self_aware_logic } }
			add_resource = { engineering_research = 1000 }
		}
		else_if = {
			limit = { NOT = { has_technology = tech_sapient_ai } }
			ag_give_technology = { ag_tech = tech_sapient_ai }
		}
		else_if = {
			limit = { NOT = { has_technology = tech_synthetic_workers } }
			ag_give_technology = { ag_tech = tech_synthetic_workers }
		}
		else_if = {
			limit = { NOT = { has_technology = tech_synthetic_leaders } }
			ag_give_technology = { ag_tech = tech_synthetic_leaders }
		}
		else_if = {
			limit = { always = yes }
			ag_add_monthly_research = { ag_area = engineering_research ag_tier = 1 }
		}
	}
}

# on_custom_diplomacy, Communication with Starlight-II
country_event = {
	id = ag_side.31
	title = "ag_side.31.name"
	inline_script = "events/ag_lost_ancient_ship_dialogs"
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_leader_window"
	custom_gui_option = "ag_ancient_event_leader_option"
	
	picture_event_data = {
		room = ag_ancient_ship_room
		portrait = event_target:ag_lost_ancient_ship_diplo_portrait
	}
	
	is_triggered_only = yes

	trigger = {
		OR = {
			from = { is_same_value = root }
			AND = {
				NOT = { has_country_flag = ag_special_leader_diplomacy_engaged }	# 通用特殊领袖外交窗口。
				from = { is_country_type = ag_lost_ancient_ship_country }
			}
		}
		is_same_value = event_target:ag_lost_ancient_ship_owner
		# NOT = { has_country_flag = SRA_ag_StarLightII_changed }		# Interaction flags
		exists = event_target:ag_starlight_2_ship
	}

	immediate = {
		# 独立窗口标识。
		set_country_flag = ag_lost_ancient_ship_diplomacy_engaged
		# 将目标舰船/领袖存为事件目标"ag_special_leader_diplo_target"，如果已存在则需要清除就有的。
		# 将目标对玩家的态度存入玩家国家的变量"ag_special_leader_attitude"。
		# 设置通用标识"ag_special_leader_diplomacy_engaged"
		ag_lost_ancient_ship_diplo_window_open_effect = yes
		# 修正立绘以防发生奇怪的事情。
		ag_lost_ancient_ship_diplo_portrait_check = yes
	}
	after = { hidden_effect = {
		# 清空表情差分。
		ag_lost_ancient_ship_reset_special_dialog_flag = yes
		# 清除通用标识"ag_special_leader_diplomacy_engaged"，事件目标"ag_special_leader_diplo_target"和变量"ag_special_leader_attitude"。
		ag_lost_ancient_ship_diplo_window_close_effect = yes
		# 独立窗口标识。
		remove_country_flag = ag_lost_ancient_ship_diplomacy_engaged
	} }

	inline_script = "ag_player_StarlightII_interface"
	inline_script = "events/ag_lost_ancient_ship_options"
}

# on_entering_system_fleet, Change ftl drive after ftl action if didn't be repaired
fleet_event = {
	id = ag_side.33
	title = "ag_side.33.name"
	desc = "ag_side.33.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_yellow_alert
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		any_controlled_ship = { has_ship_flag = ag_lost_ancient_ship }
		exists = owner
		owner = {
			is_same_value = event_target:ag_lost_ancient_ship_owner
			NOR = {
				has_country_flag = ag_lost_ancient_ship_ftl_unusable
				has_country_flag = ag_lost_ancient_ship_restored
			}
		}
	}
	
	immediate = {
		owner = { set_country_flag = ag_lost_ancient_ship_ftl_unusable }
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
		random_controlled_ship = {
			limit = { has_ship_flag = ag_lost_ancient_ship }
			fleet = {
				if = {
					limit = { exists = leader }
					leader = {
						save_event_target_as = ag_target_leader
						unassign_leader = this
					}
				}
			}
			owner = {
				if = {
					limit = { has_country_flag = ag_lost_ancient_ship_battleship_form_active }
					if = {
						limit = { has_technology = tech_psi_jump_drive_1 }
						prev.fleet = {
							create_ship = {
								name = "NAME_ag_lost_ancient_ship"
								design = "NAME_ag_lost_ancient_ship_battleship_form_psi_jumpdrive_1"
								prefix = no
								
								effect = {
									set_ship_flag = ag_lost_ancient_ship
									copy_flags_and_variables_from = prevprevprev
									ag_difficulty_bonus = yes
									ag_lost_ancient_ship_debuff = yes
									if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
									save_global_event_target_as = ag_starlight_2_ship
								}
							}
						}
					}
					else_if = {
						limit = { has_technology = tech_jump_drive_1 }
						prev.fleet = {
							create_ship = {
								name = "NAME_ag_lost_ancient_ship"
								design = "NAME_ag_lost_ancient_ship_battleship_form_jumpdrive_1"
								prefix = no
								
								effect = {
									set_ship_flag = ag_lost_ancient_ship
									copy_flags_and_variables_from = prevprevprev
									ag_difficulty_bonus = yes
									ag_lost_ancient_ship_debuff = yes
									if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
									save_global_event_target_as = ag_starlight_2_ship
								}
							}
						}
					}
					else_if = {
						limit = { has_technology = tech_hyper_drive_3 }
						prev.fleet = {
							create_ship = {
								name = "NAME_ag_lost_ancient_ship"
								design = "NAME_ag_lost_ancient_ship_battleship_form_hyperdrive_3"
								prefix = no
								
								effect = {
									set_ship_flag = ag_lost_ancient_ship
									copy_flags_and_variables_from = prevprevprev
									ag_difficulty_bonus = yes
									ag_lost_ancient_ship_debuff = yes
									if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
									save_global_event_target_as = ag_starlight_2_ship
								}
							}
						}
					}
					else_if = {
						limit = { has_technology = tech_hyper_drive_2 }
						prev.fleet = {
							create_ship = {
								name = "NAME_ag_lost_ancient_ship"
								design = "NAME_ag_lost_ancient_ship_battleship_form_hyperdrive_2"
								prefix = no
								
								effect = {
									set_ship_flag = ag_lost_ancient_ship
									copy_flags_and_variables_from = prevprevprev
									ag_difficulty_bonus = yes
									ag_lost_ancient_ship_debuff = yes
									if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
									save_global_event_target_as = ag_starlight_2_ship
								}
							}
						}
					}
					else_if = {
						limit = { always = yes }
						prev.fleet = {
							create_ship = {
								name = "NAME_ag_lost_ancient_ship"
								design = "NAME_ag_lost_ancient_ship_battleship_form_hyperdrive_1"
								prefix = no
								
								effect = {
									set_ship_flag = ag_lost_ancient_ship
									copy_flags_and_variables_from = prevprevprev
									ag_difficulty_bonus = yes
									ag_lost_ancient_ship_debuff = yes
									if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
									save_global_event_target_as = ag_starlight_2_ship
								}
							}
						}
					}
				}
				else = {
					prev.fleet = { save_event_target_as = ag_lost_ancient_ship_loc }
					if = {
						limit = { has_technology = tech_psi_jump_drive_1 }
						create_fleet = {
							name = event_target:ag_lost_ancient_ship_loc
							settings = {
								spawn_debris = no
								can_upgrade = no
								uses_naval_capacity = no
							}
							effect = {
								set_owner = event_target:ag_lost_ancient_ship_loc.owner
								create_ship = {
									name = "NAME_ag_lost_ancient_ship"
									design = "NAME_ag_lost_ancient_ship_science_ship_form_psi_jumpdrive_1"
									prefix = no
									
									effect = {
										set_ship_flag = ag_lost_ancient_ship
										copy_flags_and_variables_from = prevprevprev
										ag_difficulty_bonus = yes
										ag_lost_ancient_ship_debuff = yes
										if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
										save_global_event_target_as = ag_starlight_2_ship
									}
								}
								set_location = {
									target = event_target:ag_lost_ancient_ship_loc
									distance = -1
									angle = 0
								}
								if = {
									limit = {
										exists = event_target:ag_target_leader
									}
									fleet = {
										assign_leader = event_target:ag_target_leader
									}
								}
							}
						}
					}
					else_if = {
						limit = { has_technology = tech_jump_drive_1 }
						create_fleet = {
							name = event_target:ag_lost_ancient_ship_loc
							settings = {
								spawn_debris = no
								can_upgrade = no
								uses_naval_capacity = no
							}
							effect = {
								set_owner = event_target:ag_lost_ancient_ship_loc.owner
								create_ship = {
									name = "NAME_ag_lost_ancient_ship"
									design = "NAME_ag_lost_ancient_ship_science_ship_form_jumpdrive_1"
									prefix = no
									
									effect = {
										set_ship_flag = ag_lost_ancient_ship
										copy_flags_and_variables_from = prevprevprev
										ag_difficulty_bonus = yes
										ag_lost_ancient_ship_debuff = yes
										if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
										save_global_event_target_as = ag_starlight_2_ship
									}
								}
								set_location = {
									target = event_target:ag_lost_ancient_ship_loc
									distance = -1
									angle = 0
								}
								if = {
									limit = {
										exists = event_target:ag_target_leader
									}
									fleet = {
										assign_leader = event_target:ag_target_leader
									}
								}
							}
						}
					}
					else_if = {
						limit = { has_technology = tech_hyper_drive_3 }
						create_fleet = {
							name = event_target:ag_lost_ancient_ship_loc
							settings = {
								spawn_debris = no
								can_upgrade = no
								uses_naval_capacity = no
							}
							effect = {
								set_owner = event_target:ag_lost_ancient_ship_loc.owner
								create_ship = {
									name = "NAME_ag_lost_ancient_ship"
									design = "NAME_ag_lost_ancient_ship_science_ship_form_hyperdrive_3"
									prefix = no
									
									effect = {
										set_ship_flag = ag_lost_ancient_ship
										copy_flags_and_variables_from = prevprevprev
										ag_difficulty_bonus = yes
										ag_lost_ancient_ship_debuff = yes
										if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
										save_global_event_target_as = ag_starlight_2_ship
									}
								}
								set_location = {
									target = event_target:ag_lost_ancient_ship_loc
									distance = -1
									angle = 0
								}
								if = {
									limit = {
										exists = event_target:ag_target_leader
									}
									fleet = {
										assign_leader = event_target:ag_target_leader
									}
								}
							}
						}
					}
					else_if = {
						limit = { has_technology = tech_hyper_drive_2 }
						create_fleet = {
							name = event_target:ag_lost_ancient_ship_loc
							settings = {
								spawn_debris = no
								can_upgrade = no
								uses_naval_capacity = no
							}
							effect = {
								set_owner = event_target:ag_lost_ancient_ship_loc.owner
								create_ship = {
									name = "NAME_ag_lost_ancient_ship"
									design = "NAME_ag_lost_ancient_ship_science_ship_form_hyperdrive_2"
									prefix = no
									
									effect = {
										set_ship_flag = ag_lost_ancient_ship
										copy_flags_and_variables_from = prevprevprev
										ag_difficulty_bonus = yes
										ag_lost_ancient_ship_debuff = yes
										if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
										save_global_event_target_as = ag_starlight_2_ship
									}
								}
								set_location = {
									target = event_target:ag_lost_ancient_ship_loc
									distance = -1
									angle = 0
								}
								if = {
									limit = {
										exists = event_target:ag_target_leader
									}
									fleet = {
										assign_leader = event_target:ag_target_leader
									}
								}
							}
						}
					}
					else_if = {
						limit = { always = yes }
						create_fleet = {
							name = event_target:ag_lost_ancient_ship_loc
							settings = {
								spawn_debris = no
								can_upgrade = no
								uses_naval_capacity = no
							}
							effect = {
								set_owner = event_target:ag_lost_ancient_ship_loc.owner
								create_ship = {
									name = "NAME_ag_lost_ancient_ship"
									design = "NAME_ag_lost_ancient_ship_science_ship_form_hyperdrive_1"
									prefix = no
									
									effect = {
										set_ship_flag = ag_lost_ancient_ship
										copy_flags_and_variables_from = prevprevprev
										ag_difficulty_bonus = yes
										ag_lost_ancient_ship_debuff = yes
										if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
										save_global_event_target_as = ag_starlight_2_ship
									}
								}
								set_location = {
									target = event_target:ag_lost_ancient_ship_loc
									distance = -1
									angle = 0
								}
								if = {
									limit = {
										exists = event_target:ag_target_leader
									}
									fleet = {
										assign_leader = event_target:ag_target_leader
									}
								}
							}
						}
					}
				}
			}
			delete_ship = this
			if = {
				limit = {
					exists = event_target:ag_target_leader
					fleet = {
						any_controlled_ship = {
							NOT = {
								is_same_value = prevprev
							}
						}
					}
				}
				fleet = {
					assign_leader = event_target:ag_target_leader
				}
			}
		}
	}
	
	option = {
		name = "ag_side.33.a"
	}
}

# Repair action aviliable when researched enough technologies
country_event = {
	id = ag_side.340
	hide_window = yes
	is_triggered_only = yes
	trigger = { exists = event_target:ag_lost_ancient_ship_owner is_same_value = event_target:ag_lost_ancient_ship_owner NOT = { has_global_flag = ag_side_340_fired } }
	immediate = {
		if = {
			limit = {
				has_technology = "tech_global_research_initiative"
				has_technology = "tech_basic_science_lab_3"
				has_technology = "tech_space_science_5"
				has_technology = "tech_physics_3"
				has_technology = "tech_titans"
				has_technology = "tech_ag_advanced_gravity_theory"
				is_same_value = event_target:ag_lost_ancient_ship_owner
				any_controlled_ship = {
					has_ship_flag = ag_lost_ancient_ship
					OR = {
						has_modifier = "ag_lost_ancient_ship_debuff_1x"
						has_modifier = "ag_lost_ancient_ship_debuff_2x"
					}
				}
			}
			random_list = { 66 = { } 33 = { set_global_flag = ag_side_340_fired country_event = { id = ag_side.34 days = 30 random = 30 } } }
			reroll_random = yes
		}
	}
}
country_event = {
	id = ag_side.34
	title = "ag_side.34.name"
	desc = "ag_side.34.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_lost_ancient_battleship_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = "ag_side.34.a"
		custom_tooltip = "ag_side.34.a.tooltip"
		hidden_effect = {
			random_list = {
				10 = { ag_give_research_project = { ag_project_id = @ag_repair_starlight_2_project_id ag_progress = 2.5 } }
				10 = { ag_give_research_project = { ag_project_id = @ag_repair_starlight_2_project_id ag_progress = 5 } }
				10 = { ag_give_research_project = { ag_project_id = @ag_repair_starlight_2_project_id ag_progress = 7.5 } }
				10 = { ag_give_research_project = { ag_project_id = @ag_repair_starlight_2_project_id ag_progress = 10 } }
				10 = { ag_give_research_project = { ag_project_id = @ag_repair_starlight_2_project_id ag_progress = 12.5 } }
				10 = { ag_give_research_project = { ag_project_id = @ag_repair_starlight_2_project_id ag_progress = 15 } }
			}
			if = {
				limit = { is_ai = yes }
				country_event = { id = ag_side.35 days = 1800 }
			}
		}
	}
	option = {
		name = "ag_side.34.b"
	}
}

# Repair completed
country_event = {
	id = ag_side.35
	title = "ag_side.35.name"
	desc = "ag_side.35.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_lost_ancient_battleship_room }
	show_sound = event_dyson_sphere_build_complete
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				any_controlled_ship = {
					OR = {
						is_ship_size = ag_lost_ancient_ship_battleship_form
						is_ship_size = ag_lost_ancient_ship_science_ship_form
					}
				}
			}
			set_country_flag = ag_lost_ancient_ship_restored
			random_controlled_ship = {
				limit = { has_ship_flag = ag_lost_ancient_ship }
				save_event_target_as = ag_target_ship
				if = {
					limit = { has_component = ag_ancient_ftl_drive_1 }
					remove_modifier = "ag_lost_ancient_ship_debuff_1x"
					remove_modifier = "ag_lost_ancient_ship_debuff_2x"
				}
				else = {
					fleet = {
						if = {
							limit = {
								exists = leader
							}
							leader = {
								save_event_target_as = ag_target_leader
								unassign_leader = this
							}
						}
						prevprev = {
							if = {
								limit = { has_country_flag = ag_lost_ancient_ship_battleship_form_active }
								prev = {
									create_ship = {
										name = "NAME_ag_lost_ancient_ship"
										design = "NAME_ag_lost_ancient_ship_battleship_form"
										prefix = no
										
										effect = {
											set_ship_flag = ag_lost_ancient_ship
											copy_flags_and_variables_from = event_target:ag_target_ship
											ag_difficulty_bonus = yes
											if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
											save_global_event_target_as = ag_starlight_2_ship
										}
									}
								}
							}
							else = {
								create_fleet = {
									name = prev
									settings = {
										spawn_debris = no
										can_upgrade = no
										uses_naval_capacity = no
									}
									effect = {
										set_owner = prev
										create_ship = {
											name = "NAME_ag_lost_ancient_ship"
											design = "NAME_ag_lost_ancient_ship_science_ship_form"
											prefix = no
											
											effect = {
												set_ship_flag = ag_lost_ancient_ship
												ag_difficulty_bonus = yes
												if = { limit = { exists = event_target:ag_starlight_2_ship } clear_global_event_target = ag_starlight_2_ship }
												save_global_event_target_as = ag_starlight_2_ship
											}
										}
										set_location = {
											target = prevprev
											distance = -1
											angle = 0
										}
									}
								}
							}
						}
					}
					delete_ship = this
					if = {
						limit = { exists = event_target:ag_target_leader }
						fleet = { assign_leader = event_target:ag_target_leader }
					}
				}
			}
		}
	}
	
	option = {
		name = "ag_side.35.a"
	}
}

# Change ftl drives manually
country_event = {
	id = ag_side.37
	title = "ag_side.37.name"
	desc = "ag_side.37.a.desc"
	desc = "ag_side.37.b.desc"
	desc = "ag_side.37.c.desc"
	desc = "ag_side.37.d.desc"
	desc = "ag_side.37.e.desc"
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_leader_window"
	custom_gui_option = "ag_ancient_event_leader_option"
	
	picture_event_data = {
		room = ag_ancient_ship_room
		portrait = event_target:ag_lost_ancient_ship_diplo_portrait
	}
	
	is_triggered_only = yes

	trigger = {
		from = { is_same_value = root }
		is_same_value = event_target:ag_lost_ancient_ship_owner
		exists = event_target:ag_starlight_2_ship
		is_same_value = event_target:ag_starlight_2_ship.owner
		any_country = { is_country_type = ag_lost_ancient_ship_country }
	}

	immediate = {
		set_country_flag = ag_lost_ancient_ship_diplomacy_engaged
		ag_lost_ancient_ship_diplo_window_open_effect = yes
		ag_lost_ancient_ship_diplo_portrait_check = yes
	}
	after = { hidden_effect = {
		ag_lost_ancient_ship_reset_special_dialog_flag = yes
		ag_lost_ancient_ship_diplo_window_close_effect = yes
		remove_country_flag = ag_lost_ancient_ship_diplomacy_engaged
	} }

	option = {
		name = "ag_side.37.a"
		response_text = "ag_side.37.a.response"
		trigger = {
			has_technology = tech_hyper_drive_1
			NOT = {
				any_controlled_ship = {
					has_ship_flag = ag_lost_ancient_ship
					has_component = HYPER_DRIVE_1
				}
			}
		}
		allow = { ag_lost_ancient_ship_action_basic_check = yes }
		hidden_effect = {
			if = {
				limit = { has_country_flag = ag_lost_ancient_ship_battleship_form_active }
				ag_lost_ancient_ship_player_spawn = { ag_is_battleship = yes ag_target_ftl_drive = _hyperdrive_1 }
			}
			else = { ag_lost_ancient_ship_player_spawn = { ag_is_battleship = no ag_target_ftl_drive = _hyperdrive_1 } }
		}
	}
	option = {
		name = "ag_side.37.b"
		response_text = "ag_side.37.b.response"
		trigger = {
			has_technology = tech_hyper_drive_2
			NOT = {
				any_controlled_ship = {
					has_ship_flag = ag_lost_ancient_ship
					has_component = HYPER_DRIVE_2
				}
			}
		}
		allow = { ag_lost_ancient_ship_action_basic_check = yes }
		hidden_effect = {
			if = {
				limit = { has_country_flag = ag_lost_ancient_ship_battleship_form_active }
				ag_lost_ancient_ship_player_spawn = { ag_is_battleship = yes ag_target_ftl_drive = _hyperdrive_2 }
			}
			else = { ag_lost_ancient_ship_player_spawn = { ag_is_battleship = no ag_target_ftl_drive = _hyperdrive_2 } }
		}
	}
	option = {
		name = "ag_side.37.c"
		response_text = "ag_side.37.c.response"
		trigger = {
			has_technology = tech_hyper_drive_3
			NOT = {
				any_controlled_ship = {
					has_ship_flag = ag_lost_ancient_ship
					has_component = HYPER_DRIVE_3
				}
			}
		}
		allow = { ag_lost_ancient_ship_action_basic_check = yes }
		hidden_effect = {
			if = {
				limit = { has_country_flag = ag_lost_ancient_ship_battleship_form_active }
				ag_lost_ancient_ship_player_spawn = { ag_is_battleship = yes ag_target_ftl_drive = _hyperdrive_3 }
			}
			else = { ag_lost_ancient_ship_player_spawn = { ag_is_battleship = no ag_target_ftl_drive = _hyperdrive_3 } }
		}
	}
	option = {
		name = "ag_side.37.d"
		response_text = "ag_side.37.d.response"
		trigger = {
			has_technology = tech_jump_drive_1
			NOT = {
				any_controlled_ship = {
					has_ship_flag = ag_lost_ancient_ship
					has_component = JUMP_DRIVE_1
				}
			}
		}
		allow = { ag_lost_ancient_ship_action_basic_check = yes }
		hidden_effect = {
			if = {
				limit = { has_country_flag = ag_lost_ancient_ship_battleship_form_active }
				ag_lost_ancient_ship_player_spawn = { ag_is_battleship = yes ag_target_ftl_drive = _jumpdrive_1 }
			}
			else = { ag_lost_ancient_ship_player_spawn = { ag_is_battleship = no ag_target_ftl_drive = _jumpdrive_1 } }
		}
	}
	option = {
		name = "ag_side.37.e"
		response_text = "ag_side.37.e.response"
		trigger = {
			has_technology = tech_psi_jump_drive_1
			NOT = {
				any_controlled_ship = {
					has_ship_flag = ag_lost_ancient_ship
					has_component = PSI_JUMP_DRIVE_1
				}
			}
		}
		allow = { ag_lost_ancient_ship_action_basic_check = yes }
		hidden_effect = {
			if = {
				limit = { has_country_flag = ag_lost_ancient_ship_battleship_form_active }
				ag_lost_ancient_ship_player_spawn = { ag_is_battleship = yes ag_target_ftl_drive = _psi_jumpdrive_1 }
			}
			else = { ag_lost_ancient_ship_player_spawn = { ag_is_battleship = no ag_target_ftl_drive = _psi_jumpdrive_1 } }
		}
	}
	option = {
		name = "ag_side.37.origin"
		response_text = "ag_side.37.origin.response"
		trigger = {
			has_country_flag = ag_lost_ancient_ship_restored
			NOT = {
				any_controlled_ship = {
					has_ship_flag = ag_lost_ancient_ship
					has_component = ag_ancient_ftl_drive_1
				}
			}
		}
		allow = { ag_lost_ancient_ship_action_basic_check = yes }
		hidden_effect = {
			if = {
				limit = { has_country_flag = ag_lost_ancient_ship_battleship_form_active }
				ag_lost_ancient_ship_player_spawn = { ag_is_battleship = yes }
			}
			else = { ag_lost_ancient_ship_player_spawn = { ag_is_battleship = no } }
		}
	}
	option = {
		name = "ag_side.37.return"
		hidden_effect = { country_event = { id = ag_side.31 } }
	}
	option = {
		name = "ag_side.37.exit"
		default_hide_option = yes
	}
}

# Find Guradians
fleet_event = {
	id = ag_side.38
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_same_value = event_target:ag_starlight_2_ship.fleet
		has_fleet_flag = ag_lost_ancient_ship_targeting_guardians
	}
	immediate = {
		owner = { ag_lost_ancient_ship_clear_guardians_flags = yes }
		ag_lost_ancient_ship_set_guardians_flag = yes
	}
	after = {
		ag_lost_ancient_ship_find_guardians = yes
		fleet_event = { id = ag_side.382 days = 30 }
	}
}
# Attack Guradians
country_event = {
	id = ag_side.381
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:ag_lost_ancient_ship_owner
		is_same_value = event_target:ag_lost_ancient_ship_owner
		event_target:ag_starlight_2_ship = { exists = fleet fleet = { has_fleet_flag = ag_lost_ancient_ship_targeting_guardians } }
		from = { is_same_value = event_target:ag_starlight_2_ship.fleet }
	}
	
	immediate = {
		from.solar_system = {
			random_fleet_in_system = {
				limit = {
					exists = owner
					owner = {
						OR = {
							is_country_type = guardian_dragon
							is_country_type = guardian_fortress
							is_country_type = guardian_stellarite
							is_country_type = guardian_horror
							is_country_type = guardian_hiver
							is_country_type = guardian_sphere
							is_country_type = guardian_dreadnought
							is_country_type = guardian_wraith
							is_country_type = guardian_hatchling
							is_country_type = guardian_scavenger_bot
							is_country_type = guardian_elderly_tiyanki
						}
					}
				}
				save_event_target_as = ag_lost_ancient_ship_target
			}
		}
		if = {
			limit = { exists = event_target:ag_lost_ancient_ship_target }
			from = { auto_follow_fleet = { target = event_target:ag_lost_ancient_ship_target attack_fleet = yes } }
		}
		else = { event_target:ag_starlight_2_ship.fleet = { fleet_event = { id = ag_side.38 days = 5 random = 5 } } }
	}
}
# Check to prevent idle state
fleet_event = {
	id = ag_side.382
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_same_value = event_target:ag_starlight_2_ship
		has_fleet_flag = ag_lost_ancient_ship_targeting_guardians
	}
	immediate = {
		if = {
			limit = { is_fleet_idle = yes }
			clear_orders = yes
			clear_fleet_actions = this
			owner = { ag_lost_ancient_ship_clear_failed_flags = yes }
			root = { fleet_event = { id = ag_side.38 days = 5 random = 5 } }
		}
		else = { root = { fleet_event = { id = ag_side.382 days = 30 } } }
	}
}
country_event = {
	id = ag_side.383
	title = "ag_side.383.name"
	desc = "ag_side.383.desc"
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_leader_window"
	custom_gui_option = "ag_ancient_event_leader_option"
	
	picture_event_data = {
		room = ag_ancient_ship_room
		portrait = event_target:ag_lost_ancient_ship_diplo_portrait
	}
	
	is_triggered_only = yes

	trigger = {
		from = { is_same_value = root }
		is_same_value = event_target:ag_lost_ancient_ship_owner
		exists = event_target:ag_starlight_2_ship
		is_same_value = event_target:ag_starlight_2_ship.owner
		any_country = { is_country_type = ag_lost_ancient_ship_country }
	}

	immediate = {
		set_country_flag = ag_lost_ancient_ship_diplomacy_engaged
		ag_lost_ancient_ship_diplo_window_open_effect = yes
		ag_lost_ancient_ship_diplo_portrait_check = yes
	}
	after = { hidden_effect = {
		ag_lost_ancient_ship_reset_special_dialog_flag = yes
		ag_lost_ancient_ship_diplo_window_close_effect = yes
		remove_country_flag = ag_lost_ancient_ship_diplomacy_engaged
	} }

	option = {
		name = "ag_side.383.guardian_dragon"
		trigger = { has_country_flag = ag_exists_guardian_dragon }
		hidden_effect = {
			ag_lost_ancient_ship_change_guardians_protection = { ag_target_guardian = guardian_dragon }
			country_event = { id = ag_side.383 }
		}
	}
	option = {
		name = "ag_side.383.guardian_fortress"
		trigger = { has_country_flag = ag_exists_guardian_fortress }
		hidden_effect = {
			ag_lost_ancient_ship_change_guardians_protection = { ag_target_guardian = guardian_fortress }
			country_event = { id = ag_side.383 }
		}
	}
	option = {
		name = "ag_side.383.guardian_stellarite"
		trigger = { has_country_flag = ag_exists_guardian_stellarite }
		hidden_effect = {
			ag_lost_ancient_ship_change_guardians_protection = { ag_target_guardian = guardian_stellarite }
			country_event = { id = ag_side.383 }
		}
	}
	option = {
		name = "ag_side.383.guardian_horror"
		trigger = { has_country_flag = ag_exists_guardian_horror }
		hidden_effect = {
			ag_lost_ancient_ship_change_guardians_protection = { ag_target_guardian = guardian_horror }
			country_event = { id = ag_side.383 }
		}
	}
	option = {
		name = "ag_side.383.guardian_hiver"
		trigger = { has_country_flag = ag_exists_guardian_hiver }
		hidden_effect = {
			ag_lost_ancient_ship_change_guardians_protection = { ag_target_guardian = guardian_hiver }
			country_event = { id = ag_side.383 }
		}
	}
	option = {
		name = "ag_side.383.guardian_sphere"
		trigger = { has_country_flag = ag_exists_guardian_sphere }
		hidden_effect = {
			ag_lost_ancient_ship_change_guardians_protection = { ag_target_guardian = guardian_sphere }
			country_event = { id = ag_side.383 }
		}
	}
	option = {
		name = "ag_side.383.guardian_dreadnought"
		trigger = { has_country_flag = ag_exists_guardian_dreadnought }
		hidden_effect = {
			ag_lost_ancient_ship_change_guardians_protection = { ag_target_guardian = guardian_dreadnought }
			country_event = { id = ag_side.383 }
		}
	}
	option = {
		name = "ag_side.383.guardian_wraith"
		trigger = { has_country_flag = ag_exists_guardian_wraith }
		hidden_effect = {
			ag_lost_ancient_ship_change_guardians_protection = { ag_target_guardian = guardian_wraith }
			country_event = { id = ag_side.383 }
		}
	}
	option = {
		name = "ag_side.383.guardian_hatchling"
		trigger = { has_country_flag = ag_exists_guardian_hatchling }
		hidden_effect = {
			ag_lost_ancient_ship_change_guardians_protection = { ag_target_guardian = guardian_hatchling }
			country_event = { id = ag_side.383 }
		}
	}
	option = {
		name = "ag_side.383.guardian_scavenger_bot"
		trigger = { has_country_flag = ag_exists_guardian_scavenger_bot }
		hidden_effect = {
			ag_lost_ancient_ship_change_guardians_protection = { ag_target_guardian = guardian_scavenger_bot }
			country_event = { id = ag_side.383 }
		}
	}
	option = {
		name = "ag_side.383.guardian_elderly_tiyanki"
		trigger = { has_country_flag = ag_exists_guardian_elderly_tiyanki }
		hidden_effect = {
			ag_lost_ancient_ship_change_guardians_protection = { ag_target_guardian = guardian_elderly_tiyanki }
			country_event = { id = ag_side.383 }
		}
	}
	option = {
		name = "ag_side.383.return"
		hidden_effect = { country_event = { id = ag_side.31 } }
	}
	option = { name = "ag_side.383.exit" default_hide_option = yes }
}

# on_custom_diplomacy, Communication with Starlight-II, destroyed but could be repaired.
country_event = {
	id = ag_side.39
	title = "ag_side.39.name"
	desc = "ag_side.39.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = no_video_feed_room }
	is_triggered_only = yes
	trigger = {
		NOT = { has_country_flag = ag_lost_ancient_ship_diplomacy_engaged }
		has_country_flag = ag_lost_ancient_ship_locked
		from = { is_country_type = ag_lost_ancient_ship_country }
		is_same_value = event_target:ag_lost_ancient_ship_owner
		NOT = { has_country_flag = SRA_ag_StarLightII_changed }		# Interaction flag
		NOT = { exists = event_target:ag_starlight_2_ship }
	}
	immediate = { set_country_flag = ag_lost_ancient_ship_diplomacy_engaged }
	after = { hidden_effect = { remove_country_flag = ag_lost_ancient_ship_diplomacy_engaged } }
	option = { name = "ag_side.39.a" default_hide_option = yes }
}

# Communication with ancient ship, worm events available
country_event = {
	id = ag_side.41
	title = "ag_side.41.name"
	desc = "ag_side.41.desc"
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		room = "ag_lost_ancient_ship_room"
	}
	
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:ag_lost_ancient_ship_country
		NOT = {
			is_hostile = event_target:ag_lost_ancient_ship_country
		}
	}
	
	option = {
		name = "ag_side.41.a"
		is_dialog_only = yes
		response_text = "ag_side.41.a.response"
	}
	option = {
		name = "ag_side.41.b"
		is_dialog_only = yes
		response_text = "ag_side.41.b.response"
	}
	option = {
		name = "ag_side.41.c"
		is_dialog_only = yes
		response_text = "ag_side.41.c.response"
	}
	option = {
		name = "ag_side.41.d"
		response_text = "ag_side.41.d.response"
		hidden_effect = { set_variable = { which = ag_num_spiral_towers value = 1 } }
	}
	option = {
		name = "ag_side.41.e"
		response_text = "ag_side.41.e.response"
		hidden_effect = {
			country_event = { id = ag_side.19 days = 30 }
			event_target:ag_lost_ancient_ship_country = {
				country_event = { id = ag_side.20 days = 30 }
			}
		}
	}
}

# on_building_complete, on_building_replaced, Notification, ancient ship disappeared when building finished
planet_event = {
	id = ag_side.42
	title = "ag_side.42.name"
	desc = "ag_side.42.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unknown_ships_room }
	show_sound = event_sensor_ping

	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = { has_building = ag_spiral_tower }
	
	immediate = {
		owner = {
			set_country_flag = ag_lost_ancient_ship_worm_event
		}
		event_target:ag_lost_ancient_ship_country = {
			every_controlled_fleet = {
				delete_fleet = this
			}
			destroy_country = yes
		}
	}
	
	option = {
		name = "ag_side.42.a"
	}
	option = {
		name = "ag_side.42.b"
	}
}

# on_yearly_pulse_country, Remove Starlight-II country if ship doesn't exists
country_event = {
	id = ag_side.45
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:ag_lost_ancient_ship_owner
		is_same_value = event_target:ag_lost_ancient_ship_owner
		NOR = {
			has_country_flag = ag_lost_ancient_ship_locked
			has_country_flag = SRA_ag_StarLightII_changed
			exists = event_target:ag_starlight_2_ship
		}
		any_country = { is_country_type = ag_lost_ancient_ship_country }
	}
	immediate = {
		clear_global_event_target = ag_lost_ancient_ship_owner
		random_country = {
			limit = { is_country_type = ag_lost_ancient_ship_country }
			destroy_country = yes
		}
	}
}

# Give Starlight-II after worm event
country_event = {
	id = ag_side.46
	title = "ag_side.46.name"
	desc = "ag_side.46.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_sensor_ping

	mean_time_to_happen = { years = 3 }

	fire_only_once = yes

	trigger = {
		has_country_flag = ag_lost_ancient_ship_worm_event
		has_country_flag = worm_tomb_ending
	}
	
	option = {
		name = "ag_side.46.a"
		custom_tooltip = "ag_side.46.a.tooltip"
		hidden_effect = {
			capital_scope = {
				create_fleet = {
					name = "NAME_ag_lost_ancient_ship_fleet"
					settings = {
						spawn_debris = no
						can_upgrade = no
						uses_naval_capacity = no
					}
					effect = {
						set_owner = root
						create_ship = {
							name = "NAME_ag_lost_ancient_ship"
							design = "NAME_ag_lost_ancient_ship_battleship_form"
							prefix = no
							
							effect = {
								set_ship_flag = ag_lost_ancient_ship
								ag_difficulty_bonus = yes
							}
						}
						set_location = {
							target = prev
							distance = 20
							angle = 0
						}
					}
				}
			}
		}
	}
	option = {
		name = "ag_side.46.c"
		custom_tooltip = "ag_side.46.a.tooltip"
		hidden_effect = {
			capital_scope = {
				create_fleet = {
					name = "NAME_ag_lost_ancient_ship_fleet"
					settings = {
						spawn_debris = no
						can_upgrade = no
						uses_naval_capacity = no
					}
					effect = {
						set_owner = root
						create_ship = {
							name = "NAME_ag_lost_ancient_ship"
							design = "NAME_ag_lost_ancient_ship_science_ship_form"
							prefix = no
							
							effect = {
								set_ship_flag = ag_lost_ancient_ship
								ag_difficulty_bonus = yes
							}
						}
						set_location = {
							target = prev
							distance = 20
							angle = 0
						}
					}
				}
			}
		}
	}
	option = {
		name = "ag_side.46.b"
		add_resource = {
			alloys = 5000
			sr_living_metal = 1500
			nanites = 1000
			sr_dark_matter = 800
		}
	}
}

# Ancient Wrekage
# Notification for discovery of ancient ship.
country_event = {
	id = ag_side.72
	title = "ag_side.72.name"
	desc = "ag_side.72.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_debris_room }
	show_sound = event_sensor_ping
	location = event_target:ag_shattered_ringworld_system.star

	is_triggered_only = yes
	fire_only_once = yes

	immediate = {
		event_target:ag_shattered_ringworld_system = { random_system_ambient_object = {
			limit = { has_ambient_object_flag = ag_shattered_ringworld_ancient_ship }
			save_event_target_as = ag_target_ancient_ship_object
		} }
	}
	
	option = {
		name = "ag_side.72.a"
		begin_event_chain = {
			event_chain = "ag_shattered_ringworld_ancient_ship_chain"
			target = root
		}
		enable_special_project = {
			name = "ag_shattered_ringworld_ancient_ship_project"
			location = event_target:ag_target_ancient_ship_object
			owner = root
		}
	}
	option = {
		name = "ag_side.72.b"
		add_resource = { influence = @ag_end_event_influence_small }
	}
}
ship_event = {
	id = ag_side.73
	title = "ag_side.73.name"
	desc = "ag_side.73.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_debris_room }
	show_sound = event_mystic_reveal
	location = root

	is_triggered_only = yes
	immediate = { if = {
		limit = { NOT = { exists = event_target:ag_target_ancient_ship_object } }
		random_system = {
			limit = {
				has_star_flag = ag_shattered_ringworld_system
				exists = space_owner
				space_owner = { is_ai = no }
			}
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_shattered_ringworld_ancient_ship }
				save_event_target_as = ag_target_ancient_ship_object
			}
		}
	} }
	
	option = {
		name = "ag_side.73.a"
		owner = {
			enable_special_project = {
				name = "ag_shattered_ringworld_ancient_ship_destroy"
				location = event_target:ag_target_ancient_ship_object
				owner = root.owner
			}
		}
	}
	option = {
		name = "ag_side.73.b"
		owner = {
			if = {
				limit = { NOT = { has_technology = "tech_administrative_ai" } }
				ag_give_technology = { ag_tech = "tech_administrative_ai" }
			}
			else_if = {
				limit = { NOT = { has_technology = "tech_self_aware_logic" } }
				ag_give_technology = { ag_tech = "tech_self_aware_logic" }
			}
			else_if = {
				limit = { OR = {
					AND = { is_gestalt = no NOT = { has_technology = "tech_sapient_ai" } }
					AND = { is_gestalt = yes NOT = { has_technology = "tech_positronic_implants" } }
				} }
				if = { limit = { is_gestalt = no } ag_give_technology = { ag_tech = "tech_sapient_ai" } }
				else = { ag_give_technology = { ag_tech = "tech_positronic_implants" } }
			}
			else_if = {
				limit = { is_gestalt = no NOT = { has_technology = "tech_synthetic_workers" } }
				ag_give_technology = { ag_tech = "tech_synthetic_workers" }
			}
			else_if = {
				limit = { is_gestalt = no NOT = { has_technology = "tech_synthetic_leaders" } }
				ag_give_technology = { ag_tech = "tech_synthetic_leaders" }
			}
			else_if = {
				limit = { always = yes }
				ag_add_monthly_research = { ag_area = engineering_research ag_tier = 2 }
			}
			end_event_chain = "ag_shattered_ringworld_ancient_ship_chain"
		}
	}
	option = {
		name = "ag_side.73.c"
		trigger = { owner = { has_relic = ag_zeta_crisis_relic } }
		event_target:ag_target_ancient_ship_object = {
			enable_special_project = {
				name = "ag_shattered_ringworld_ancient_ship_repair"
				location = this
				owner = root.owner
			}
		}
	}
	option = {
		name = "ag_side.73.d"
		owner = {
			add_resource = { influence = @ag_end_event_influence_small }
			end_event_chain = "ag_shattered_ringworld_ancient_ship_chain"
		}
	}
}
ship_event = {
	id = ag_side.75
	title = "ag_side.75.name"
	desc = "ag_side.75.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	immediate = {
		reroll_random = yes
		random_list = {
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 2 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 2.5 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 3 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 3.5 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 4 } }
		}
	}
	# after = { hidden_effect = { clear_variable = ag_ancient_knowledge_common_var } }
	option = {
		name = "ag_side.75.a"
		owner = {
			ag_add_ancient_knowledge = {
				ag_value = ag_ancient_knowledge_common_var
				ag_notification_desc = ""
			}
			locked_random_list = {
				20 = { }
				80 = { ag_add_research_option = { ag_tech = tech_ag_nano_living_metal_armor } }
			}
			end_event_chain = "ag_shattered_ringworld_ancient_ship_chain"
		}
	}
}
ship_event = {
	id = ag_side.76
	title = "ag_side.76.name"
	desc = "ag_side.76.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	
	option = {
		name = "ag_side.76.a"
		create_fleet = {
			name = "NAME_ag_salvaged_ancient_fleet"
			settings = { spawn_debris = no }
			effect = {
				set_owner = root.owner
				set_fleet_flag = ag_has_ancient_ship_in_fleet
				set_fleet_bombardment_stance = ag_ancient_bombardment
				root.solar_system = {
					every_system_ambient_object = {
						limit = { has_ambient_object_flag = ag_shattered_ringworld_ancient_ship }
						if = {
							limit = { has_ambient_object_flag = ag_shattered_ringworld_ancient_ship_titan }
							prevprev = { create_ship = {
								name = "NAME_ag_zeta_titan_ship"
								design = "NAME_ag_zeta_titan"
								prefix = no
								effect = {
									set_ship_flag = ag_zeta_titan_player
									ag_difficulty_bonus = yes
								}
							} }
						}
						if = {
							limit = { has_ambient_object_flag = ag_shattered_ringworld_ancient_ship_battleship }
							prevprev = { create_ship = {
								name = "NAME_ag_zeta_battleship_ship"
								design = "NAME_ag_zeta_battleship"
								prefix = no
								effect = { ag_difficulty_bonus = yes }
							} }
						}
						if = {
							limit = { has_ambient_object_flag = ag_shattered_ringworld_ancient_ship_destroyer }
							prevprev = { create_ship = {
								name = "NAME_ag_zeta_destroyer_ship"
								design = "NAME_ag_zeta_destroyer"
								prefix = no
								effect = { ag_difficulty_bonus = yes }
							} }
						}
						destroy_ambient_object = this
					}
				}
				set_location = { target = root distance = 0 angle = random }
				set_fleet_stance = aggressive
				set_aggro_range_measure_from = self
				set_aggro_range = 500
			}
		}
		owner = { end_event_chain = "ag_shattered_ringworld_ancient_ship_chain" }
	}
}
ship_event = {
	id = ag_side.77
	title = "ag_side.77.name"
	desc = "ag_side.77.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_debris_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	option = { name = "ag_side.77.a" owner = { end_event_chain = "ag_shattered_ringworld_ancient_ship_chain" } }
}

# Tachyon Blind area
# Notification, archaeological site spawned
planet_event = {
	id = ag_side.102
	title = "ag_side.102.name"
	desc = "ag_side.102.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_cold_barren_planet_room }
	show_sound = event_sensor_ping
	location = root

	is_triggered_only = yes
	immediate = {
		random_moon = {
			limit = {
				NOT = {
					exists = archaeological_site
				}
				OR = {
					is_planet_class = pc_barren
					is_planet_class = pc_barren_cold
				}
			}
			save_event_target_as = ag_target_moon
		}
	}
	
	option = {
		name = "ag_side.102.a"
		event_target:ag_target_moon = { create_archaeological_site = ag_precursor_research_facility_site }
		hidden_effect = { owner = { set_country_flag = ag_precursor_research_facility_site_discovered } }
	}
	option = {
		name = "ag_side.102.b"
		owner = {
			add_resource = {
				influence = 50
			}
		}
	}
}

# Archaeological site
# Stage 1
fleet_event = {
	id = ag_side.111
	title = "ag_side.111.name"
	desc = "ag_side.111.desc"
	picture = GFX_evt_barren_dig_site
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.111.a"
	}
}
# Stage 2
fleet_event = {
	id = ag_side.112
	title = "ag_side.112.name"
	desc = "ag_side.112.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.112.a"
	}
}
# Stage 3
fleet_event = {
	id = ag_side.113
	title = "ag_side.113.name"
	desc = "ag_side.113.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_finding_loot
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.113.a"
		small_artifact_reward = yes
	}
}
# Stage 4
fleet_event = {
	id = ag_side.114
	title = "ag_side.114.name"
	desc = "ag_side.114.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.114.a"
		hidden_effect = { owner = { set_country_flag = ag_precursor_databank_site_discovered } }
		small_artifact_reward = yes
		ag_create_precursor_databank_site = yes
	}
}

# Archaeological site
# Stage 1
fleet_event = {
	id = ag_side.121
	title = "ag_side.121.name"
	desc = "ag_side.121.desc"
	picture = GFX_evt_barren_dig_site
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.121.a"
	}
}
# Stage 2
fleet_event = {
	id = ag_side.122
	title = "ag_side.122.name"
	desc = "ag_side.122.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.122.a"
		small_artifact_reward = yes
	}
}
# Stage 3
fleet_event = {
	id = ag_side.123
	title = "ag_side.123.name"
	desc = "ag_side.123.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.123.a"
		owner = { ag_add_research_option = { ag_tech = tech_ag_aura_battleship } }
	}
	option = {
		name = "ag_side.123.b"
		owner = { add_resource = { influence = @ag_end_event_influence_small } }
	}
}

# Strange Storm
# Spawn archaeological site
country_event = {
	id = ag_side.152
	title = "ag_side.152.name"
	desc = "ag_side.152.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_toxic_planet_room }
	show_sound = event_sensor_ping
	location = event_target:ag_side_152_target_planet

	is_triggered_only = yes
	
	option = {
		name = "ag_side.152.a"
		hidden_effect = { set_country_flag = ag_dimensional_obelisk_site_discovered }
		event_target:ag_side_152_target_planet = { create_archaeological_site = ag_dimensional_obelisk_site }
	}
	option = {
		name = "ag_side.152.b"
		add_resource = { influence = @ag_end_event_influence_small }
	}
}
fleet_event = {
	id = ag_side.153
	title = "ag_side.153.name"
	desc = "ag_side.153.desc"
	picture = GFX_evt_toxic
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.153.a" }
}
fleet_event = {
	id = ag_side.154
	title = "ag_side.154.name"
	desc = "ag_side.154.desc"
	picture = GFX_evt_toxic
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.154.a" }
}
fleet_event = {
	id = ag_side.155
	title = "ag_side.155.name"
	desc = "ag_side.155.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_mystic_reveal
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.155.a" if = { limit = { exists = leader } leader = { add_experience = 200 } } }
}
fleet_event = {
	id = ag_side.156
	title = "ag_side.156.name"
	desc = "ag_side.156.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_finding_loot
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.156.a" small_artifact_reward = yes }
}
fleet_event = {
	id = ag_side.157
	title = "ag_side.157.name"
	desc = "ag_side.157.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_finding_loot
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.157.a" small_artifact_reward = yes }
}
fleet_event = {
	id = ag_side.158
	title = "ag_side.158.name"
	desc = "ag_side.158.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = {
		name = "ag_side.158.a"
		from = { add_deposit = d_dark_matter_deposit_1 }
		owner = { ag_add_research_option = { ag_tech = tech_ag_dimensional_obelisk } }
		medium_artifact_reward = yes
	}
}
planet_event = {
	id = ag_side.159
	title = "ag_side.159.name"
	desc = ""
	diplomatic = yes
	custom_gui = "ag_dimensional_obelisk_window"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_default
	is_triggered_only = yes
	immediate = { set_variable = { which = ag_num_dimensional_obelisk_districts_temp value = ag_num_dimensional_obelisk_districts } }
	
	option = {
		name = "ag_side.159.a"
		custom_gui = "ag_dimensional_obelisk_cancel_option"
		hidden_effect = {
			clear_variable = ag_num_dimensional_obelisk_districts_temp
			remove_planet_flag = ag_dimensional_obelisk_settings_flag
			owner = {
				remove_country_flag = ag_dimensional_obelisk_settings_opened
				remove_country_flag = ag_dimensional_obelisk_global_settings
				remove_country_flag = ag_dimensional_obelisk_max_district
			}
		}
	}
	option = {
		name = "ag_side.159.b"
		custom_gui = "ag_dimensional_obelisk_confirm_option"
		default_hide_option = yes
		hidden_effect = {
			owner = { if = {
				limit = { has_country_flag = ag_dimensional_obelisk_global_settings }
				remove_country_flag = ag_dimensional_obelisk_global_settings
				every_owned_planet = {
					limit = { has_active_building = ag_dimensional_obelisk NOT = { is_same_value = root } }
					if = {
						limit = { prev = { has_country_flag = ag_dimensional_obelisk_max_district } }
						while = {
							limit = { 
								check_variable = { which = ag_num_dimensional_obelisk_districts value <= 24 }
								check_variable = { which = ag_num_dimensional_obelisk_districts value < trigger:planet_size }
							}
							change_variable = { which = ag_num_dimensional_obelisk_districts value = 1 }
						}
					}
					else = { set_variable = { which = ag_num_dimensional_obelisk_districts value = root.ag_num_dimensional_obelisk_districts_temp } }
				}
			} }
			if = {
				limit = { owner = { has_country_flag = ag_dimensional_obelisk_max_district } }
				while = {
					limit = {
						check_variable = { which = ag_num_dimensional_obelisk_districts value <= 24 }
						check_variable = { which = ag_num_dimensional_obelisk_districts value < trigger:planet_size }
					}
					change_variable = { which = ag_num_dimensional_obelisk_districts value = 1 }
				}
				owner = { remove_country_flag = ag_dimensional_obelisk_max_district }
			}
			else = { set_variable = { which = ag_num_dimensional_obelisk_districts value = ag_num_dimensional_obelisk_districts_temp } }
			clear_variable = ag_num_dimensional_obelisk_districts_temp
			remove_planet_flag = ag_dimensional_obelisk_settings_flag
			owner = { remove_country_flag = ag_dimensional_obelisk_settings_opened }
		}
	}
}

# on_building_complete, on_building_replaced, Dimensional_obelisk default settings
planet_event = {
	id = ag_side.160
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_active_building = ag_dimensional_obelisk
		NOT = { is_variable_set = ag_num_dimensional_obelisk_districts }
		exists = owner
		owner = { has_country_flag = ag_dimensional_obelisk_default_value }
	}

	immediate = {
		if = {
			limit = { owner = { has_country_flag = ag_dimensional_obelisk_default_max } }
			while = {
				limit = { 
					check_variable = { which = ag_num_dimensional_obelisk_districts value <= 24 }
					check_variable = { which = ag_num_dimensional_obelisk_districts value < trigger:planet_size }
				}
				change_variable = { which = ag_num_dimensional_obelisk_districts value = 1 }
			}
		}
		else = {
			set_variable = { which = ag_num_dimensional_obelisk_districts value = ag_dimensional_obelisk_default }
			while = {
				limit = { NAND = {
					check_variable = { which = ag_num_dimensional_obelisk_districts value <= 24 }
					check_variable = { which = ag_num_dimensional_obelisk_districts value < trigger:planet_size }
				} }
				subtract_variable = { which = ag_num_dimensional_obelisk_districts value = 1 }
			}
		}
	}
}

# 4662 Preserved World
# Notification for 4662 Preserved World events, give special project
country_event = {
	id = ag_side.202
	title = "ag_side.202.name"
	desc = "ag_side.202.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_archaeological_dig_room }
	show_sound = event_sensor_ping
	location = capital_scope

	is_triggered_only = yes
	
	option = {
		name = "ag_side.202.a"
		enable_special_project = {
			name = "ag_located_primitive_system_4"
			location = capital_scope
		}
	}
	option = {
		name = "ag_side.202.b"
		add_resource = { influence = @ag_end_event_influence_small }
	}
}

# Spawn 4662 Preserved World, hidden events
country_event = {
    id = ag_side.203
    hide_window = yes
	is_triggered_only = yes
	
    immediate = {
		save_event_target_as = ag_system_discover_country
		ag_spawn_ancient_system = { ag_system_to_spawn = "ag_primitive_system_4" }
		ag_spawned_system_effect = yes
		create_point_of_interest = {
			id = ag_primitive_system_4_poi
			name = "ag_primitive_system_4_poi"
			desc = "ag_primitive_system_4_desc"
			event_chain = ag_hidden_system_chain
			location = event_target:ag_primitive_world_4.solar_system
		}
    }
	
	after = {
		every_country = {
			limit = {
				has_special_project = ag_located_primitive_system_4
			}
			abort_special_project = {
				type = "ag_located_primitive_system_4"
				location = capital_scope
			}
		}
	}
}

# on_entering_system_fleet, Notification for entering system, ancient fleet in system
fleet_event = {
	id = ag_side.211
	title = "ag_side.211.name"
	desc = "ag_side.211.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ruined_system_room }
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		from = { has_star_flag = ag_primitive_system_4 }
		NOT = { owner = { has_country_flag = ag_primitive_system_4_entered } }
		exists = event_target:ag_primitive_4_guardian_country
	}
	
    immediate = {
		owner = {
			establish_communications_no_message = event_target:ag_primitive_4_guardian_country
			set_country_flag = ag_primitive_system_4_entered
		}
	}
	
	option = {
		name = "ag_side.211.a"
	}
}

# on_survey, surveyed planet, add archaeological site
ship_event = {
	id = ag_side.221
	title = "ag_side.221.name"
	desc = "ag_side.221.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_room }
	show_sound = event_default
	location = event_target:ag_primitive_world_4
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_planet_flag = ag_primitive_world_4
			is_planet_class = pc_relic
		}
		owner = {
			is_ai = no
			NOT = { has_country_flag = ag_side_221_fired }
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = ag_side_221_fired
			remove_point_of_interest = ag_primitive_system_4_poi
		}
	}
	
	option = {
		name = "ag_side.221.a"
		from = {
			create_archaeological_site = ag_primitive_relic_planet_site
		}
		hidden_effect = { owner = { set_country_flag = ag_primitive_relic_planet_site_discovered } }
	}
}
ship_event = {
	id = ag_side.222
	title = "ag_side.222.name"
	desc = "ag_side.222.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_warm_barren_planet_room }
	show_sound = event_default
	location = event_target:ag_primitive_world_4
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_planet_flag = ag_primitive_world_4
			is_planet_class = pc_barren
		}
		owner = {
			is_ai = no
			NOT = { has_country_flag = ag_side_222_fired }
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = ag_side_222_fired
			remove_point_of_interest = ag_primitive_system_4_poi
		}
	}
	
	option = {
		name = "ag_side.221.a"
		from = {
			create_archaeological_site = ag_primitive_tomb_planet_site
		}
		hidden_effect = { owner = { set_country_flag = ag_primitive_tomb_planet_site_discovered } }
	}
}

# Archaeological site - Forgotten World
fleet_event = {
	id = ag_side.231
	title = "ag_side.231.name"
	desc = "ag_side.231.desc"
	picture = GFX_evt_relic_world
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.231.a"
	}
}
fleet_event = {
	id = ag_side.232
	title = "ag_side.232.name"
	desc = "ag_side.232.desc"
	picture = GFX_evt_excavation_team
	show_sound = event_finding_loot
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.232.a"
		small_artifact_reward = yes
	}
}
fleet_event = {
	id = ag_side.233
	title = "ag_side.233.name"
	desc = "ag_side.233.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.233.a"
		small_artifact_reward = yes
	}
	option = {
		name = "ag_side.233.a"
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophile
					has_ethic = ethic_fanatic_xenophile
				}
			}
		}
		small_artifact_reward = yes
	}
}
fleet_event = {
	id = ag_side.234
	title = "ag_side.234.name"
	desc = "ag_side.234.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.234.a"
		medium_artifact_reward = yes
		owner = { ag_add_research_option = { ag_tech = tech_ag_ancient_lab } }
	}
}

# Archaeological site - Destroyed World
fleet_event = {
	id = ag_side.241
	title = "ag_side.241.name"
	desc = "ag_side.241.desc"
	picture = GFX_evt_habitable_dig_site
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.241.a"
	}
}
fleet_event = {
	id = ag_side.242
	title = "ag_side.242.name"
	desc = "ag_side.242.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.242.a"
		small_artifact_reward = yes
	}
}
fleet_event = {
	id = ag_side.243
	title = "ag_side.243.name"
	desc = "ag_side.243.desc"
	picture = GFX_evt_underground_city
	show_sound = event_finding_loot
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.243.a"
		small_artifact_reward = yes
	}
}
fleet_event = {
	id = ag_side.244
	title = "ag_side.244.name"
	desc = "ag_side.244.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.244.a"
		trigger = {
			exists = owner
			owner = {
				NOR = {
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophile
					has_ethic = ethic_xenophile
				}
			}
		}
		large_artifact_reward = yes
		owner = { ag_add_research_option = { ag_tech = tech_ag_ancient_lab } }
	}
	option = {
		name = "ag_side.244.b"
		trigger = {
			exists = owner
			owner = {
				OR = {
					has_ethic = ethic_fanatic_xenophile
					has_ethic = ethic_xenophile
				}
			}
		}
		large_artifact_reward = yes
		owner = { ag_add_research_option = { ag_tech = tech_ag_ancient_lab } }
	}
	option = {
		name = "ag_side.244.c"
		trigger = {
			exists = owner
			owner = {
				OR = {
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe
				}
			}
		}
		large_artifact_reward = yes
		owner = { ag_add_research_option = { ag_tech = tech_ag_ancient_lab } }
	}
}


# Advanced Colonizer
# on_yearly_pulse, Gatekeeper, spawn archaeological site
# Spawn archaeological site.
planet_event = {
	id = ag_side.252
	title = "ag_side.252.name"
	desc = "ag_side.252.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_street_room }
	show_sound = event_sensor_ping
	location = root

	is_triggered_only = yes

	option = {
		name = "ag_side.252.a"
		create_archaeological_site = ag_buried_city_site
		hidden_effect = { owner = { set_country_flag = ag_buried_city_site_discovered } }
	}
	option = {
		name = "ag_side.252.b"
		owner = { add_resource = { influence = @ag_end_event_influence_small } }
	}
}

# Archaeological site1
fleet_event = {
	id = ag_side.261
	title = "ag_side.261.name"
	desc = "ag_side.261.desc"
	picture = GFX_evt_desert
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.261.a"
	}
}
fleet_event = {
	id = ag_side.262
	title = "ag_side.262.name"
	desc = "ag_side.262.desc"
	picture = GFX_evt_relic_world_street
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.262.a"
	}
}
fleet_event = {
	id = ag_side.263
	title = "ag_side.263.name"
	desc = "ag_side.263.desc"
	picture = GFX_evt_relic_world
	show_sound = event_finding_loot
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.263.a"
	}
}
fleet_event = {
	id = ag_side.264
	title = "ag_side.264.name"
	desc = "ag_side.264.desc"
	picture = GFX_evt_relic_world_street
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.264.a"
	}
}
fleet_event = {
	id = ag_side.265
	title = "ag_side.265.name"
	desc = "ag_side.265.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		from = { set_site_progress_locked = yes }
		owner = {
			random_planet_within_border = {
				limit = {
					is_asteroid = yes
					NOT = { exists = archaeological_site }
				}
				save_event_target_as = ag_target_planet
			}
			if = {
				limit = { NOT = { exists = event_target:ag_target_planet } }
				random_planet_within_border = {
					limit = { is_asteroid = yes }
					save_event_target_as = ag_target_planet
				}
				if = {
					limit = { NOT = { exists = event_target:ag_target_planet } }
					random_galaxy_planet = {
						limit = { is_asteroid = yes }
						save_event_target_as = ag_target_planet
					}
				}
			}
		}
	}
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.265.a"
		trigger = { exists = event_target:ag_target_planet }
		event_target:ag_target_planet = { create_archaeological_site = ag_asteroid_habitat_site }
		hidden_effect = { owner = { set_country_flag = ag_asteroid_habitat_site_discovered } }
	}
	option = {
		name = "ag_side.265.b"
		owner = { add_resource = { influence = @ag_end_event_influence_small } }
	}
}

# Archaeological site2
fleet_event = {
	id = ag_side.271
	title = "ag_side.271.name"
	desc = "ag_side.271.desc"
	picture = GFX_evt_space_station
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.271.a"
	}
}
fleet_event = {
	id = ag_side.272
	title = "ag_side.272.name"
	desc = "ag_side.272.desc"
	picture = GFX_evt_space_hangar
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.272.a"
	}
}
fleet_event = {
	id = ag_side.273
	title = "ag_side.273.name"
	desc = "ag_side.273.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_finding_loot
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.273.a"
	}
}
fleet_event = {
	id = ag_side.274
	title = "ag_side.274.name"
	desc = "ag_side.274.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no }  }
	option = {
		name = "ag_side.274.a"
		owner = { ag_add_research_option = { ag_tech = tech_ag_advanced_colonizer } }
	}
	option = {
		name = "ag_side.274.b"
		owner = { add_resource = { influence = @ag_end_event_influence_small } }
	}
}

# Anomalies
# Collapsed Ground
ship_event = {
	id = ag_side.301
	title = "ag_side.301.name"
	desc = "ag_side.301.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_warm_barren_planet_room }
	show_sound = event_default
	location = root

	is_triggered_only = yes

	option = {
		name = "ag_side.301.a"
		owner = {
			if = {
				limit = { NOR = {
					has_technology = tech_mine_dark_matter
					has_tech_option = tech_mine_dark_matter
				} }
				ag_add_research_option = { ag_tech = tech_mine_dark_matter }
			}
			else_if = {
				limit = { has_tech_option = tech_mine_dark_matter }
				add_tech_progress = {
					tech = tech_mine_dark_matter
					progress = 0.50
				}
			}
			else_if = {
				limit = { has_technology = tech_mine_dark_matter }
				locked_random_list = {
					30 = { add_resource = { sr_dark_matter = 10 } }
					20 = { add_resource = { sr_dark_matter = 20 } }
					10 = { add_resource = { sr_dark_matter = 30 } }
				}
			}
		}
		locked_random_list = {
			9 = { from = { add_deposit = d_dark_matter_deposit_1 } }
			4 = { from = { add_deposit = d_dark_matter_deposit_2 } }
			1 = { from = { add_deposit = d_dark_matter_deposit_3 } }
		}
	}
}
# Active Asteroid
ship_event = {
	id = ag_side.302
	title = "ag_side.302.name"
	desc = "ag_side.302.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_mining_station_room }
	show_sound = event_airlock
	location = root

	is_triggered_only = yes

	option = {
		name = "ag_side.302.a"
		owner = {
			locked_random_list = {
				30 = { add_resource = { nanites = 50 } }
				20 = { add_resource = { nanites = 75 } }
				10 = { add_resource = { nanites = 100 } }
			}
		}
		locked_random_list = {
			9 = { from = { add_deposit = d_nanites_deposit } }
			4 = { from = { while = { count = 2 add_deposit = d_nanites_deposit } } }
			1 = { from = { while = { count = 3 add_deposit = d_nanites_deposit } } }
		}
	}
}
# Strange Hill
ship_event = {
	id = ag_side.303
	title = "ag_side.303.name"
	desc = "ag_side.303.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_shipyard_room }
	show_sound = event_default
	location = root

	is_triggered_only = yes

	option = {
		name = "ag_side.303.a"
		owner = {
			if = {
				limit = { NOR = {
					has_technology = tech_mine_living_metal
					has_tech_option = tech_mine_living_metal
				} }
				ag_add_research_option = { ag_tech = tech_mine_living_metal }
			}
			else_if = {
				limit = { has_tech_option = tech_mine_living_metal }
				add_tech_progress = { tech = tech_mine_living_metal progress = 0.50 }
			}
			else_if = {
				limit = { has_technology = tech_mine_living_metal }
				locked_random_list = {
					30 = { add_resource = { sr_living_metal = 10 } }
					20 = { add_resource = { sr_living_metal = 20 } }
					10 = { add_resource = { sr_living_metal = 30 } }
				}
			}
		}
		locked_random_list = {
			9 = { from = { add_deposit = d_living_metal_deposit } }
			4 = { from = { while = { count = 2 add_deposit = d_living_metal_deposit } } }
			1 = { from = { while = { count = 3 add_deposit = d_living_metal_deposit } } }
		}
	}
}

# Large Ship Hull Stabilizer
# on_survey, Survey planet, begins countdown.
ship_event = {
	id = ag_side.351
	title = "ag_side.351.name"
	desc = "ag_side.351.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_shielded_planet_room }
	show_sound = event_mystic_reveal
	location = from

	is_triggered_only = yes

	trigger = {
		owner = { is_ai = no NOT = { has_country_flag = ag_side_351_fired } }
		from = {
			is_planet_class = pc_shielded
			has_planet_flag = ag_ancient_shielded_molten_planet
		}
	}

	immediate = {
		owner = { set_country_flag = ag_side_351_fired }
		from = { if = {
			limit = { NOT = { has_planet_flag = ag_ancient_shielded_molten_planet_first_surveyed } }
			set_planet_flag = ag_ancient_shielded_molten_planet_first_surveyed
			planet_event = { id = ag_side.353 days = 360 random = 180 }
		} }
	}

	option = { name = "ag_side.351.a" }
}
# on_starbase_transfer, Notification for player if captured shielded molten planet from ai
ship_event = {
	id = ag_side.352
	title = "ag_side.352.name"
	desc = "ag_side.352.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_shielded_planet_room }
	show_sound = event_mystic_reveal
	location = root.solar_system
	is_triggered_only = yes

	trigger = {
		owner = { is_ai = no NOT = { has_country_flag = ag_side_351_fired } }
		solar_system = {
			has_star_flag = ag_ancient_shielded_molten_planet_system
			any_system_planet = {
				is_planet_class = pc_shielded
				has_planet_flag = ag_ancient_shielded_molten_planet
			}
		}
	}
	immediate = {
		owner = { set_country_flag = ag_side_351_fired }
		solar_system = { random_system_planet = {
			limit = {
				is_planet_class = pc_shielded
				has_planet_flag = ag_ancient_shielded_molten_planet
			}
			save_event_target_as = ag_target_planet
			if = {
				limit = { NOT = { has_planet_flag = ag_ancient_shielded_molten_planet_first_surveyed } }
				set_planet_flag = ag_ancient_shielded_molten_planet_first_surveyed
				planet_event = { id = ag_side.353 days = 360 random = 180 }
			}
		} }
	}

	option = { name = "ag_side.352.a" }
}

# Ancient ship break the shield
planet_event = {
	id = ag_side.353
	hide_window = yes
	is_triggered_only = yes
	trigger = { exists = this }
	immediate = {
		if = {
			limit = { ag_spawnsystem_gatekeeper_trigger = yes }
			random_list = {
				95 = { planet_event = { id = ag_side.353 days = 1800 random = 360 } }
				5 = {
					set_planet_entity = { entity = "ag_ancient_molten_planet_shielded_green_entity" }
					remove_modifier = ag_ancient_shield_deposit_blue
					remove_deposit = ag_ancient_shield_deposit_blue
					add_modifier = { modifier = "ag_ancient_shield_deposit_green" days = -1 }
					add_deposit = ag_ancient_shield_deposit_green
					planet_event = { id = ag_side.354 days = 1080 random = 360 }
					solar_system = { if = { limit = { exists = space_owner } space_owner = { country_event = { id = ag_side.355 } } } }
				}
			}
		}
		else = { planet_event = { id = ag_side.353 days = 1800 random = 360 } }
	}
}
planet_event = {
	id = ag_side.354
	hide_window = yes
	is_triggered_only = yes
	trigger = { exists = this }
	immediate = {
		ag_change_pc = { ag_planet_class = pc_molten }
		set_planet_entity = { entity = "ag_ancient_molten_planet_unshielded_entity" }
		remove_modifier = ag_ancient_shield_deposit_green
		remove_deposit = ag_ancient_shield_deposit_green
		if = { limit = { has_research_station = yes } research_station = { dismantle = yes } }
		add_deposit = d_living_metal_deposit
		add_deposit = d_living_metal_deposit
		add_deposit = d_nanites_deposit
		add_modifier = { modifier = "terraforming_candidate" days = -1 }
		ag_create_ancient_guardian = {
			ag_country_name = "NAME_ag_ancient_molten_planet_guardian"
			ag_country_type = ag_ancient_molten_planet_guardian
		}
		last_created_country = {
			save_global_event_target_as = ag_ancient_molten_planet_guardian
			set_country_flag = ag_ancient_molten_planet_guardian
			ag_ancient_country_friendly_to_each_other = yes
			ag_ancient_molten_planet_fleet_spawn = yes
		}
		solar_system = { if = { limit = { exists = space_owner } space_owner = { country_event = { id = ag_side.356 } } } }
	}
}

# Notification for space owner
country_event = {
	id = ag_side.355
	title = "ag_side.355.name"
	desc = "ag_side.355.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_shielded_planet_room }
	show_sound = event_yellow_alert
	location = from
	is_triggered_only = yes
	option = { name = "ag_side.355.a" }
}
country_event = {
	id = ag_side.356
	title = "ag_side.356.name"
	desc = "ag_side.356.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_fleet_evil_room }
	show_sound = event_red_alert
	location = from
	is_triggered_only = yes
	option = { name = "ag_side.356.a" }
}

# on_ship_destroyed_perp, Destroy ancient fleet, give technology.
country_event = {
	id = ag_side.357
	title = "ag_side.357.name"
	desc = "ag_side.357.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_space_battle
	location = fromfrom.solar_system

	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		from = {
			is_country_type = ag_ancient_molten_planet_guardian
			has_country_flag = ag_ancient_molten_planet_guardian
			num_ships < 1
		}
		fromfromfrom = { NOT = { has_ship_flag = ag_set_disable_at_health } }
	}
	immediate = {
		every_country = {
			if = {
				limit = { has_modifier = ag_ancient_molten_planet_guardian_weakness }
				remove_modifier = "ag_ancient_molten_planet_guardian_weakness"
			}
			if = {
				limit = { has_country_flag = ag_ancient_molten_planet_guardian_weakness }
				remove_country_flag = ag_ancient_molten_planet_guardian_weakness
			}
			if = {
				limit = { has_special_project = ag_find_molten_planet_guardian_weakness }
				abort_special_project = {
					type = "ag_find_molten_planet_guardian_weakness"
					location = capital_scope
				}
			}
		}
		set_global_flag = ag_ancient_molten_planet_guardian_destroyed
		from = { destroy_country = yes }
	}

	option = {
		name = "ag_side.357.a"
		if = {
			limit = { NOR = {
				has_technology = tech_ag_battleship_upgrade_1
				has_technology = tech_ag_battleship_upgrade_2
				has_technology = tech_ag_battleship_upgrade_3
				has_technology = tech_ag_battleship_upgrade_4
				has_technology = tech_ag_battleship_upgrade_5
				has_tech_option = tech_ag_battleship_upgrade_1
				has_tech_option = tech_ag_battleship_upgrade_2
				has_tech_option = tech_ag_battleship_upgrade_3
				has_tech_option = tech_ag_battleship_upgrade_4
				has_tech_option = tech_ag_battleship_upgrade_5
			} }
			locked_random_list = {
				10 = {
					modifier = { add = 3 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value >= 1 } } }
					modifier = { add = 3 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } } }
					modifier = { add = 3 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 4 } } }
					ag_add_research_option = { ag_tech = tech_ag_battleship_upgrade_1 }
				}
				10 = {
					modifier = { add = 1 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value >= 1 } } }
					modifier = { add = 1 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } } }
					modifier = { add = 1 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 4 } } }
					ag_add_research_option = { ag_tech = tech_ag_battleship_upgrade_2 }
				}
				10 = {
					ag_add_research_option = { ag_tech = tech_ag_battleship_upgrade_3 }
				}
				10 = {
					modifier = { add = -1 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value >= 1 } } }
					modifier = { add = -1 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } } }
					modifier = { add = -1 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 4 } } }
					ag_add_research_option = { ag_tech = tech_ag_battleship_upgrade_4 }
				}
				10 = {
					modifier = { add = -3 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value >= 1 } } }
					modifier = { add = -3 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } } }
					modifier = { add = -3 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 4 } } }
					ag_add_research_option = { ag_tech = tech_ag_battleship_upgrade_5 }
				}
			}
		}
	}
}

# on_ship_destroyed_victim, Research weakness if lost too many ships, molten planet ships.
country_event = {
	id = ag_side.358
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		from = {
			is_country_type = ag_ancient_molten_planet_guardian
			has_country_flag = ag_ancient_molten_planet_guardian
			is_same_value = event_target:ag_ancient_molten_planet_guardian
		}
		is_ai = no
		NOR = {
			has_global_flag = ag_ancient_molten_planet_guardian_destroyed
			has_country_flag = ag_has_molten_planet_guardian_weakness
		}
	}
	
	immediate = {
		if = {
			limit = { check_variable = { which = ag_ancient_molten_planet_guardian_killcount value < 1 } }
			set_variable = { which = ag_ancient_molten_planet_guardian_killcount value = 1 }
		}
		fromfrom = { root = { ag_hostile_kill_counter = { ag_variable_name = ag_ancient_molten_planet_guardian_killcount } } }
		if = {
			limit = {
				check_variable = { which = ag_ancient_molten_planet_guardian_killcount value > 512 }
				NOR = {
					has_global_flag = ag_ancient_molten_planet_guardian_destroyed
					has_country_flag = ag_ancient_molten_planet_guardian_weakness
				}
			}
			set_variable = { which = ag_ancient_molten_planet_guardian_killcount value = 512 }
			random_list = {
				25 = {
					country_event = { id = ag_side.359 days = 30 random = 30 }
					set_country_flag = ag_ancient_molten_planet_guardian_weakness
				}
				75 = { }
			}
		}
	}
}
country_event = {
	id = ag_side.359
	title = "ag_side.359.name"
	desc = "ag_side.359.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes

	trigger = { NOT = { has_global_flag = ag_ancient_molten_planet_guardian_destroyed } }
	
	option = {
		name = "ag_side.359.a"
		enable_special_project = {
			name = "ag_find_molten_planet_guardian_weakness"
			location = capital_scope
			owner = root
		}
	}
	option = {
		name = "ag_side.359.b"
		add_resource = { influence = @ag_end_event_influence_small }
	}
}
country_event = {
	id = ag_side.360
	title = "ag_side.360.name"
	desc = "ag_side.360.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	
	is_triggered_only = yes

	option = {
		name = "ag_side.360.a"
		if = {
			limit = { NOT = { has_modifier = ag_ancient_molten_planet_guardian_weakness } }
			add_modifier = { modifier = ag_ancient_molten_planet_guardian_weakness days = -1 }
		}
	}
}

# on_survey, Survey planet, found ancient habitat.
ship_event = {
	id = ag_side.401
	title = "ag_side.401.name"
	desc = "ag_side.401.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_sensor_ping
	location = from
	is_triggered_only = yes
	trigger = {
		owner = { NOT = { has_country_flag = ag_side_401_fired } }
		from = { has_planet_flag = ag_fallen_habitat_orbit_planet }
	}
	immediate = { owner = { set_country_flag = ag_side_401_fired } }
	option = { name = "ag_side.401.a" }
}

# Spawn fallen habitat.
country_event = {
	id = ag_side.402
	title = "ag_side.402.name"
	desc = "ag_side.402.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_sensor_ping
	location = event_target:ag_fallen_habitat_planet
	
	fire_only_once = yes
	mean_time_to_happen = { years = 15 }

	trigger = {
		is_ai = no
		ag_spawnsystem_gatekeeper_trigger = yes
		any_system_within_border = { has_star_flag = ag_fallen_habitat_system }
	}
	immediate = {
		random_system_within_border = {
			limit = { has_star_flag = ag_fallen_habitat_system }
			save_event_target_as = ag_target_system
			ag_create_fallen_habitat_planet = yes
		}
	}

	option = { name = "ag_side.402.a" }
}

# on_colonized, Colonized fallen habitat
planet_event = {
	id = ag_side.403
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}
	trigger = { OR = {
		has_planet_flag = ag_volatile_motes_habitat
		has_planet_flag = ag_exotic_gases_habitat
		has_planet_flag = ag_rare_crystals_habitat
	} }
	immediate = {
		switch = {
			trigger = has_planet_flag
			ag_volatile_motes_habitat = { planet_event = { id = ag_side.411 } }
			ag_exotic_gases_habitat = { planet_event = { id = ag_side.421 } }
			ag_rare_crystals_habitat = { planet_event = { id = ag_side.431 } }
		}
	}
}

# on_planet_transfer, Occupied fallen habitat
planet_event = {
	id = ag_side.404
	hide_window = yes
	is_triggered_only = yes
	pre_triggers = { has_owner = yes is_ai = no }
	trigger = { OR = {
		has_planet_flag = ag_volatile_motes_habitat_planet
		has_planet_flag = ag_exotic_gases_habitat_planet
		has_planet_flag = ag_rare_crystals_habitat_planet
	} }
	immediate = {
		switch = {
			trigger = has_planet_flag
			ag_volatile_motes_habitat_planet = { from = {
				if = { limit = { NOT = { has_country_flag = ag_fallen_habitat_noti } } country_event = { id = ag_side.410 } }
				else_if = { limit = { NOT = { has_country_flag = ag_side_412_fired } } root = { planet_event = { id = ag_side.412 days = 300 random = 100 } } }
				else_if = { limit = { NOT = { has_country_flag = ag_side_413_fired } } root = { planet_event = { id = ag_side.413 days = 60 random = 60 } } }
				else_if = { limit = { root = { NOT = { has_planet_flag = ag_volatile_motes_stabilized } } } root = { planet_event = { id = ag_side.414 days = 400 random = 400 } } }
			} }
			ag_exotic_gases_habitat_planet = { from = {
				if = { limit = { NOT = { has_country_flag = ag_fallen_habitat_noti } } country_event = { id = ag_side.420 } }
				else_if = { limit = { NOT = { has_country_flag = ag_side_422_fired } } root = { planet_event = { id = ag_side.422 days = 200 random = 100 } } }
				else_if = { limit = { NOT = { has_country_flag = ag_side_423_fired } } root = { planet_event = { id = ag_side.423 days = 200 random = 100 } } }
				else_if = { limit = { NOT = { has_country_flag = ag_side_424_fired } } root = { planet_event = { id = ag_side.424 days = 200 random = 100 } } }
				else_if = { limit = { root = { has_modifier = "ag_fallen_habitat_atmospheric_hallucinogen_alt" } } root = { planet_event = { id = ag_side.425 days = 200 random = 100 } } }
			} }
			ag_rare_crystals_habitat_planet = { from = {
				if = { limit = { NOT = { has_country_flag = ag_fallen_habitat_noti } } country_event = { id = ag_side.430 } }
				else_if = { limit = { root = { NOT = { has_planet_flag = ag_fallen_habitat_crystal_1 } } } root = { planet_event = { id = ag_side.432 days = 250 random = 125 } } }
				else_if = { limit = { root = { NOT = { has_planet_flag = ag_fallen_habitat_crystal_2 } } } root = { planet_event = { id = ag_side.433 days = 200 random = 200 } } }
				else_if = { limit = { root = { NOT = { has_planet_flag = ag_fallen_habitat_crystal_3 } } } root = { planet_event = { id = ag_side.435 days = 120 random = 120 } } }
				else_if = { limit = { root = { NOT = { has_planet_flag = ag_fallen_habitat_crystal_4 } } } root = { planet_event = { id = ag_side.437 days = 200 random = 200 } } }
			} }
		}
	}
}

# Volatile Motes Events.
# Occupied habitat
country_event = {
	id = ag_side.410
	title = "ag_side.410.name"
	desc = "ag_side.410.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes
	trigger = { from = { NOT = { has_planet_flag = ag_volatile_motes_stabilized } } }
	immediate = {
		set_country_flag = ag_fallen_habitat_noti
		from = {
			if = {
				limit = { NOT = { has_deposit = ag_fallen_station_damaged_deposit } }
				while = { count = 5 add_deposit = ag_fallen_station_damaged_deposit }
			}
			planet_event = { id = ag_side.412 days = 300 random = 100 }
		}
	}
	option = { name = "ag_side.410.a" }
}
# Colonized habitat
planet_event = {
	id = ag_side.411
	title = "ag_side.411.name"
	desc = "ag_side.411.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes
	fire_only_once = yes
	trigger = { owner = { NOT = { has_country_flag = ag_fallen_habitat_noti } } }
	immediate = { owner = { set_country_flag = ag_fallen_habitat_noti } planet_event = { id = ag_side.412 days = 300 random = 100 } }
	option = { name = "ag_side.411.a" }
}
# Habitat district exploded.
planet_event = {
	id = ag_side.412
	title = "ag_side.412.name"
	desc = "ag_side.412.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_ship_explosion
	location = root

	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_ai = no
		is_occupied_flag = no
		has_ground_combat = no
	}
	trigger = {
		ag_spawnsystem_gatekeeper_trigger = yes
		owner = {
			has_country_flag = ag_fallen_habitat_noti
			NOT = { has_country_flag = ag_side_412_fired }
		}
		has_planet_flag = ag_volatile_motes_habitat
		NOT = { has_planet_flag = ag_volatile_motes_stabilized }
		num_pops > 0
	}
	immediate = { owner = { set_country_flag = ag_side_412_fired } planet_event = { id = ag_side.413 days = 60 random = 60 } }

	option = {
		name = "ag_side.412.a"
		random_list = { 50 = { add_planet_devastation = 20 } 50 = { add_planet_devastation = 25 } }
		add_deposit = ag_fallen_station_damaged_deposit
		random_list = { 80 = { } 20 = { add_deposit = ag_fallen_station_damaged_deposit } }
		random_list = { 75 = { } 25 = { random_owned_pop = { kill_pop = yes } } }
		if = { limit = { num_districts = { type = any value > 0 } } remove_last_built_district = yes }
	}
}
planet_event = {
	id = ag_side.413
	title = "ag_side.413.name"
	desc = "ag_side.413.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_super_explosion
	location = root

	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_ai = no
		is_occupied_flag = no
		has_ground_combat = no
	}
	trigger = {
		owner = {
			has_country_flag = ag_side_412_fired
			has_country_flag = ag_fallen_habitat_noti
		}
		has_planet_flag = ag_volatile_motes_habitat
		NOT = { has_planet_flag = ag_volatile_motes_stabilized }
		num_pops > 0
	}
	immediate = { owner = { set_country_flag = ag_side_413_fired } planet_event = { id = ag_side.414 days = 400 random = 400 } }

	option = {
		name = "ag_side.413.a"
		random_list = {
			33 = { add_planet_devastation = 25 }
			33 = { add_planet_devastation = 30 }
			33 = { add_planet_devastation = 35 }
		}
		add_deposit = ag_fallen_station_damaged_deposit
		random_list = { 40 = { } 60 = { add_deposit = ag_fallen_station_damaged_deposit } }
		random_list = { 50 = { } 50 = { random_owned_pop = { kill_pop = yes } } }
		if = { limit = { num_districts = { type = any value > 0 } } remove_last_built_district = yes }
		enable_special_project = {
			name = ag_fallen_habitat_volatile_motes_project
			location = this
			owner = root.owner
		}
	}
}
planet_event = {
	id = ag_side.414
	title = "ag_side.414.name"
	desc = "ag_side.414.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_ship_explosion
	location = root

	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_ai = no
		is_occupied_flag = no
		has_ground_combat = no
	}
	trigger = {
		owner = {
			has_country_flag = ag_side_413_fired
			has_country_flag = ag_fallen_habitat_noti
		}
		has_planet_flag = ag_volatile_motes_habitat
		NOT = { has_planet_flag = ag_volatile_motes_stabilized }
		num_pops > 0
	}
	immediate = { planet_event = { id = ag_side.414 days = 400 random = 400 } }

	option = {
		name = "ag_side.414.a"
		random_list = {
			25 = { add_planet_devastation = 20 }
			25 = { add_planet_devastation = 25 }
			25 = { add_planet_devastation = 30 }
			25 = { add_planet_devastation = 35 }
		}
		add_deposit = ag_fallen_station_damaged_deposit
		random_list = { 45 = { } 55 = { add_deposit = ag_fallen_station_damaged_deposit } }
		random_list = { 50 = { } 50 = { random_owned_pop = { kill_pop = yes } } }
		if = { limit = { num_districts = { type = any value > 0 } } remove_last_built_district = yes }
	}
}

# Special project finished
ship_event = {
	id = ag_side.415
	title = "ag_side.415.name"
	desc = "ag_side.415.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes

	immediate = { 
		random_list = {
			75 = { modifier = { factor = 1.5 exists = leader leader = { has_skill >= 8 } } }
			20 = { ship_event = { id = ag_side.416 days = 10 random = 5 } }
			5 = { ship_event = { id = ag_side.417 days = 10 random = 5 } }
		}
		solar_system = { random_system_planet = {
			limit = { has_planet_flag = ag_volatile_motes_habitat }
			set_planet_flag = ag_volatile_motes_stabilized
		} }
	}

	option = {
		name = "ag_side.415.a"
		owner = { ag_add_research_option = { ag_tech = tech_ag_adv_chemical_plant } }
	}
}
# Special project finished, be, science ship destroyed but scientist survived
ship_event = {
	id = ag_side.416
	title = "ag_side.416.name"
	desc = "ag_side.416.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_ship_explosion
	location = root
	is_triggered_only = yes
	immediate = {
		if = { limit = { exists = leader } unassign_leader = this }
		destroy_ship = this
	}
	option = { name = "ag_side.416.a" }
}
# Special project finished, be, scientist killed
ship_event = {
	id = ag_side.417
	title = "ag_side.417.name"
	desc = "ag_side.417.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_ship_explosion
	location = root
	is_triggered_only = yes
	immediate = {
		if = { limit = { exists = leader } ag_kill_leader = { ag_notification = yes } }
		destroy_ship = this
	}
	option = { name = "ag_side.417.a" }
}

# Exotic Gases Events
# Occupied habitat
country_event = {
	id = ag_side.420
	title = "ag_side.420.name"
	desc = "ag_side.420.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes
	trigger = {
		NOT = { has_country_flag = ag_fallen_habitat_noti }
		from = { OR = {
			has_modifier = "ag_fallen_habitat_atmospheric_hallucinogen"
			has_modifier = "ag_fallen_habitat_atmospheric_hallucinogen_alt"
		} }
	}
	immediate = { set_country_flag = ag_fallen_habitat_noti from = { planet_event = { id = ag_side.422 days = 200 random = 100 } } }
	option = { name = "ag_side.420.a" }
}
# Colonized habitat
planet_event = {
	id = ag_side.421
	title = "ag_side.421.name"
	desc = "ag_side.421.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		owner = { NOT = { has_country_flag = ag_fallen_habitat_noti } }
		OR = {
			has_modifier = "ag_fallen_habitat_atmospheric_hallucinogen"
			has_modifier = "ag_fallen_habitat_atmospheric_hallucinogen_alt"
		}
	}
	immediate = { owner = { set_country_flag = ag_fallen_habitat_noti } planet_event = { id = ag_side.422 days = 200 random = 100 } }
	option = { name = "ag_side.421.a" }
}

# Gases Stage 1
planet_event = {
	id = ag_side.422
	title = "ag_side.422.name"
	desc = "ag_side.422.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_default
	location = root
	is_triggered_only = yes
	pre_triggers = {
		has_owner = yes
		is_ai = no
		is_occupied_flag = no
		has_ground_combat = no
	}
	trigger = {
		owner = { has_country_flag = ag_fallen_habitat_noti }
		OR = {
			has_modifier = "ag_fallen_habitat_atmospheric_hallucinogen"
			has_modifier = "ag_fallen_habitat_atmospheric_hallucinogen_alt"
		}
	}
	immediate = {
		owner = { set_country_flag = ag_side_422_fired }
		remove_modifier = "ag_fallen_habitat_atmospheric_hallucinogen"
		add_modifier = { modifier = "ag_fallen_habitat_atmospheric_hallucinogen" days = -1 multiplier = 1.25 }
		planet_event = { id = ag_side.423 days = 200 random = 100 }
	}
	option = { name = "ag_side.422.a" }
}
# Gases Stage 2
planet_event = {
	id = ag_side.423
	title = "ag_side.423.name"
	desc = "ag_side.423.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_default
	location = root
	is_triggered_only = yes
	pre_triggers = {
		has_owner = yes
		is_ai = no
		is_occupied_flag = no
		has_ground_combat = no
	}
	trigger = {
		owner = { has_country_flag = ag_fallen_habitat_noti }
		OR = {
			has_modifier = "ag_fallen_habitat_atmospheric_hallucinogen"
			has_modifier = "ag_fallen_habitat_atmospheric_hallucinogen_alt"
		}
	}
	immediate = {
		owner = { set_country_flag = ag_side_423_fired }
		remove_modifier = "ag_fallen_habitat_atmospheric_hallucinogen"
		add_modifier = { modifier = "ag_fallen_habitat_atmospheric_hallucinogen" days = -1 multiplier = 1.5 }
		planet_event = { id = ag_side.424 days = 200 random = 100 }
	}
	option = { name = "ag_side.423.a" }
}
# Give project to clean the gases
planet_event = {
	id = ag_side.424
	title = "ag_side.424.name"
	desc = "ag_side.424.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_ai = no
		is_occupied_flag = no
		has_ground_combat = no
	}
	trigger = {
		owner = { has_country_flag = ag_fallen_habitat_noti }
		OR = {
			has_modifier = "ag_fallen_habitat_atmospheric_hallucinogen"
			has_modifier = "ag_fallen_habitat_atmospheric_hallucinogen_alt"
		}
	}
	immediate = {
		owner = { set_country_flag = ag_side_424_fired }
		remove_modifier = "ag_fallen_habitat_atmospheric_hallucinogen"
		add_modifier = { modifier = "ag_fallen_habitat_atmospheric_hallucinogen_alt" days = -1 }
		planet_event = { id = ag_side.425 days = 200 random = 100 }
	}

	option = {
		name = "ag_side.424.a"
		enable_special_project = {
			name = ag_fallen_habitat_exotic_gases_project
			location = this
			owner = root.owner
		}
	}
}
# Failed to clean the gases
planet_event = {
	id = ag_side.425
	title = "ag_side.425.name"
	desc = "ag_side.425.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_default
	location = root
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_ai = no
		is_occupied_flag = no
		has_ground_combat = no
	}
	trigger = {
		owner = { has_country_flag = ag_fallen_habitat_noti }
		has_modifier = "ag_fallen_habitat_atmospheric_hallucinogen_alt"
	}
	immediate = { planet_event = { id = ag_side.425 days = 200 random = 100 } }

	option = { name = "ag_side.425.a" random_owned_pop = { kill_pop = yes } }
}
# Clean the gases, give technology
ship_event = {
	id = ag_side.426
	title = "ag_side.426.name"
	desc = "ag_side.426.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes

	immediate = {
		solar_system = { random_system_planet = {
			limit = { has_planet_flag = ag_exotic_gases_habitat }
			remove_modifier = "ag_fallen_habitat_atmospheric_hallucinogen_alt"
		} }
		if = {
			limit = { exists = leader }
			random_list = {
				75 = { modifier = { factor = 1.5 exists = leader leader = { has_skill >= 8 } } }
				25 = { leader = { leader_event = { id = ag_side.427 days = 60 random = 60 } } }
			}
		}
	}

	option = {
		name = "ag_side.426.a"
		owner = { ag_add_research_option = { ag_tech = tech_ag_adv_gas_refinery } }
	}
}
# BE, scientist gain negative trait
leader_event = {
	id = ag_side.427
	title = "ag_side.427.name"
	desc = "ag_side.427.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_laboratory_sound
	is_triggered_only = yes

	immediate = {
		if = { limit = { is_robotic_species = yes } add_trait = leader_trait_rigid_programming }
		else = { add_trait = leader_trait_stubborn }
	}

	option = { name = "ag_side.427.a" }
}

# Rare Crystals Events
# Occupied habitat
country_event = {
	id = ag_side.430
	title = "ag_side.430.name"
	desc = "ag_side.430.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes
	trigger = {
		NOT = { has_country_flag = ag_fallen_habitat_noti }
	}
	immediate = { set_country_flag = ag_fallen_habitat_noti from = { planet_event = { id = ag_side.432 days = 250 random = 125 } } }
	option = { name = "ag_side.430.a" }
}
# Colonized habitat
planet_event = {
	id = ag_side.431
	title = "ag_side.431.name"
	desc = "ag_side.431.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		owner = { NOT = { has_country_flag = ag_fallen_habitat_noti } }
	}
	immediate = { owner = { set_country_flag = ag_fallen_habitat_noti } planet_event = { id = ag_side.432 days = 250 random = 125 } }
	option = { name = "ag_side.431.a" }
}
# Crystal begins to spread
planet_event = {
	id = ag_side.432
	title = "ag_side.432.name"
	desc = "ag_side.432.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	fire_only_once = yes
	pre_triggers = {
		has_owner = yes
		is_ai = no
		is_occupied_flag = no
		has_ground_combat = no
	}
	trigger = {
		NOT = { has_planet_flag = ag_fallen_habitat_crystal_chain_ended }
		owner = { has_country_flag = ag_fallen_habitat_noti }
		has_deposit = ag_fallen_station_crystalized_deposit
	}
	immediate = {
		set_planet_flag = ag_fallen_habitat_crystal_1
		planet_event = { id = ag_side.433 days = 120 random = 120 }
	}
	option = { name = "ag_side.432.a" }
}
# Crystal begins to thread colony
planet_event = {
	id = ag_side.433
	title = "ag_side.433.name"
	desc = "ag_side.433.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	fire_only_once = yes
	pre_triggers = {
		has_owner = yes
		is_ai = no
		is_occupied_flag = no
		has_ground_combat = no
	}
	trigger = {
		NOT = { has_planet_flag = ag_fallen_habitat_crystal_chain_ended }
		owner = { has_country_flag = ag_fallen_habitat_noti }
		has_deposit = ag_fallen_station_crystalized_deposit
	}
	immediate = {
		set_planet_flag = ag_fallen_habitat_crystal_2
		planet_event = { id = ag_side.435 days = 120 random = 120 }
	}
	option = {
		name = "ag_side.433.a"
		enable_special_project = {
			name = ag_fallen_habitat_rare_crystals_project_1
			location = this
			owner = root.owner
		}
	}
}
# Finished project 1, not necessary.
planet_event = {
	id = ag_side.434
	title = "ag_side.434.name"
	desc = "ag_side.434.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	immediate = { set_planet_flag = ag_fallen_habitat_crystal_research_flag }
	option = { name = "ag_side.434.a" }
}
# Crystal debuff for colony
planet_event = {
	id = ag_side.435
	title = "ag_side.435.name"
	desc = "ag_side.435.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	fire_only_once = yes
	pre_triggers = {
		has_owner = yes
		is_ai = no
		is_occupied_flag = no
		has_ground_combat = no
	}
	trigger = {
		NOT = { has_planet_flag = ag_fallen_habitat_crystal_chain_ended }
		owner = { has_country_flag = ag_fallen_habitat_noti }
		has_deposit = ag_fallen_station_crystalized_deposit
	}
	immediate = {
		set_planet_flag = ag_fallen_habitat_crystal_3
		planet_event = { id = ag_side.437 days = 200 random = 200 }
	}
	option = {
		name = "ag_side.435.a"
		enable_special_project = {
			name = ag_fallen_habitat_rare_crystals_project_2
			location = this
			owner = root.owner
		}
	}
}
# Finished project 2
planet_event = {
	id = ag_side.436
	title = "ag_side.436.name"
	desc = "ag_side.436.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	immediate = {
		set_planet_flag = ag_fallen_habitat_crystal_chain_ended
		planet_event = { id = ag_side.438 days = 90 random = 90 }
		owner = { if = {
			limit = { has_special_project = ag_fallen_habitat_rare_crystals_project_1 }
			abort_special_project = { type = ag_fallen_habitat_rare_crystals_project_1 location = root }
		} }
	}
	option = {
		name = "ag_side.436.a"
		owner = { ag_add_research_option = { ag_tech = tech_ag_adv_crystal_plant } }
	}
}
# Crystal debuff for colony, player didn't research project 2
planet_event = {
	id = ag_side.437
	title = "ag_side.437.name"
	desc = "ag_side.437.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_air_raid_siren
	location = root
	is_triggered_only = yes
	fire_only_once = yes
	pre_triggers = {
		has_owner = yes
		is_ai = no
		is_occupied_flag = no
		has_ground_combat = no
	}
	trigger = {
		NOT = { has_planet_flag = ag_fallen_habitat_crystal_chain_ended }
		owner = { has_country_flag = ag_fallen_habitat_noti }
		has_deposit = ag_fallen_station_crystalized_deposit
	}
	immediate = { set_planet_flag = ag_fallen_habitat_crystal_4 }
	option = {
		name = "ag_side.437.a"
		owner = { if = {
			limit = { NOT = { has_special_project = ag_fallen_habitat_rare_crystals_project_2 } }
			root = { enable_special_project = {
				name = ag_fallen_habitat_rare_crystals_project_2
				location = this
				owner = root.owner
			} }
		} }
	}
}
# Remove all debuff
planet_event = {
	id = ag_side.438
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		if = {
			limit = { has_planet_flag = ag_fallen_habitat_crystal_4 }
			remove_planet_flag = ag_fallen_habitat_crystal_4
			planet_event = { id = ag_side.438 days = 60 random = 60 }
		}
		else_if = {
			limit = { has_planet_flag = ag_fallen_habitat_crystal_3 }
			remove_planet_flag = ag_fallen_habitat_crystal_3
			planet_event = { id = ag_side.438 days = 80 random = 80 }
		}
		else_if = {
			limit = { has_planet_flag = ag_fallen_habitat_crystal_2 }
			remove_planet_flag = ag_fallen_habitat_crystal_2
			remove_planet_flag = ag_fallen_habitat_crystal_research_flag
			planet_event = { id = ag_side.438 days = 100 random = 100 }
		}
		else_if = {
			limit = { has_planet_flag = ag_fallen_habitat_crystal_1 }
			remove_planet_flag = ag_fallen_habitat_crystal_1
		}
	}
}

# Abnomal Wreckage
# Spawn archaeological site
country_event = {
	id = ag_side.451
	title = "ag_side.451.name"
	desc = "ag_side.451.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_debris_room }
	show_sound = event_sensor_ping
	location = event_target:ag_side_451_target_planet

	is_triggered_only = yes
	
	option = {
		name = "ag_side.451.a"
		hidden_effect = { set_country_flag = ag_abnomal_wreckage_site_discovered }
		event_target:ag_side_451_target_planet.solar_system.star = { create_archaeological_site = ag_abnomal_wreckage_star_site }
	}
	option = {
		name = "ag_side.451.b"
		add_resource = { influence = @ag_end_event_influence_small }
	}
}
fleet_event = {
	id = ag_side.452
	title = "ag_side.452.name"
	desc = "ag_side.452.desc"
	picture = GFX_evt_space_hangar
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.452.a" }
}
fleet_event = {
	id = ag_side.453
	title = "ag_side.453.name"
	desc = "ag_side.453.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_finding_loot
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.453.a" leader = { add_experience = 100 } }
}
fleet_event = {
	id = ag_side.454
	title = "ag_side.454.name"
	desc = "ag_side.454.desc"
	picture = GFX_evt_space_funeral
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.454.a" }
}
fleet_event = {
	id = ag_side.455
	title = "ag_side.455.name"
	desc = "ag_side.455.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_finding_loot
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.455.a" small_artifact_reward = yes }
}
fleet_event = {
	id = ag_side.456
	title = "ag_side.456.name"
	desc = "ag_side.456.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_finding_loot
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.456.a" leader = { add_experience = 200 } }
}
fleet_event = {
	id = ag_side.457
	title = "ag_side.457.name"
	desc = "ag_side.457.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = {
		name = "ag_side.457.a"
		owner = { if = {
			limit = { NOR = { has_technology = tech_ag_space_mine_field has_tech_option = tech_ag_space_mine_field } }
			ag_add_research_option = { ag_tech = tech_ag_space_mine_field }
		} }
		small_artifact_reward = yes
	}
	option = {
		name = "ag_side.457.b"
		medium_artifact_reward = yes
	}
}

# Science Constructors
# on_survey, Discovered ship in gas giant.
ship_event = {
	id = ag_side.471
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = ag_side_471_fired }
		ag_spawnsystem_gatekeeper_trigger = yes
		exists = owner
		owner = { is_ai = no has_technology = tech_sensors_2 }
		exists = leader
		leader = { has_skill > 2 }
		from = { is_planet_class = pc_gas_giant }
	}
	
	immediate = {
		random_list = {
			95 = {
				modifier = { add = -2 leader = { has_skill > 3 } }
				modifier = { add = -3 leader = { has_skill > 4 } }
				modifier = { add = -2 leader = { has_skill > 5 } }
				modifier = { add = -2 leader = { has_skill > 6 } }
				modifier = { add = -2 leader = { has_skill > 7 } }
				modifier = { add = -2 leader = { has_skill > 8 } }
				modifier = { add = -2 leader = { has_skill > 9 } }
				modifier = { add = -10 mid_game_years_passed > 0 }
				modifier = { add = -25 end_game_years_passed > 0 }
			}
			5 = {
				modifier = { add = 2 leader = { has_skill > 3 } }
				modifier = { add = 3 leader = { has_skill > 4 } }
				modifier = { add = 2 leader = { has_skill > 5 } }
				modifier = { add = 2 leader = { has_skill > 6 } }
				modifier = { add = 2 leader = { has_skill > 7 } }
				modifier = { add = 2 leader = { has_skill > 8 } }
				modifier = { add = 2 leader = { has_skill > 9 } }
				modifier = { add = 10 mid_game_years_passed > 0 }
				modifier = { add = 25 end_game_years_passed > 0 }
				set_global_flag = ag_side_471_fired
				ship_event = { id = ag_side.472 }
			}
		}
		reroll_random = yes
	}
}
# Notification for discovery of ship in gas giant.
ship_event = {
	id = ag_side.472
	title = "ag_side.472.name"
	desc = "ag_side.472.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_gas_giant_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes

	option = {
		name = "ag_side.472.a"
		fromfrom = { enable_special_project = {
			name = ag_salvage_gas_giant_ship
			owner = root.owner
			location = this
		} }
	}
	option = {
		name = "ag_side.472.b"
		owner = { add_resource = { influence = @ag_end_event_influence_small } }
	}
}

# Special project completed.
ship_event = {
	id = ag_side.473
	title = "ag_side.473.name"
	desc = "ag_side.473.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_gas_giant_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes

	option = {
		name = "ag_side.473.a"
		trigger = { owner = { has_technology = "tech_cruisers" } }
		owner = { if = {
			limit = { NOR = {
				has_technology = "tech_ag_science_constructor"
				has_tech_option = "tech_ag_science_constructor"
			} }
			set_country_flag = ag_side_473_fired
			ag_add_research_option = { ag_tech = tech_ag_science_constructor }
		} }
	}
	option = {
		name = "ag_side.473.b"
		custom_tooltip = "ag_side.473.b.tooltip"
		trigger = { owner = { NOT = { has_technology = "tech_cruisers" } } }
		hidden_effect = { owner = { set_country_flag = ag_side_473_fired } }
	}
	option = {
		name = "ag_side.473.c"
		owner = { add_resource = { influence = @ag_end_event_influence_medium } }
	}
}

# Auto starbase events.
# Spawn archaeological site
planet_event = {
	id = ag_side.501
	title = "ag_side.501.name"
	desc = "ag_side.501.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_scholarium_anomaly_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes

	option = {
		name = "ag_side.472.a"
		create_archaeological_site = ag_ruins_on_ocean_buttom_site
		hidden_effect = { owner = { set_country_flag = ag_ruins_on_ocean_buttom_site_discovered } }
	}
	option = {
		name = "ag_side.472.b"
		owner = { add_resource = { influence = @ag_end_event_influence_small } }
	}
}
# Archaeological Stages
fleet_event = {
	id = ag_side.502
	title = "ag_side.502.name"
	desc = "ag_side.502.desc"
	picture = GFX_evt_ocean
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.502.a" leader = { add_experience = 50 } }
}
fleet_event = {
	id = ag_side.503
	title = "ag_side.503.name"
	desc = "ag_side.503.desc"
	picture = GFX_evt_underwater_ruins
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.503.a" small_artifact_reward = yes }
}
fleet_event = {
	id = ag_side.504
	title = "ag_side.504.name"
	desc = "ag_side.504.desc"
	picture = GFX_evt_ocean
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.504.a" leader = { add_experience = 100 } }
}
fleet_event = {
	id = ag_side.505
	title = "ag_side.505.name"
	desc = "ag_side.505.desc"
	picture = GFX_evt_rare_tech_cache
	show_sound = event_finding_loot
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = { name = "ag_side.505.a" medium_artifact_reward = yes }
}
fleet_event = {
	id = ag_side.506
	title = "ag_side.506.name"
	desc = "ag_side.506.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	option = {
		name = "ag_side.506.a"
		from.planet = { enable_special_project = {
			name = ag_search_ancient_devices
			location = this
			owner = root.owner
		} }
	}
	option = {
		name = "ag_side.506.b"
		owner = { add_resource = { influence = @ag_end_event_influence_small } }
	}
}
# Special project completed.
country_event = {
	id = ag_side.507
	title = "ag_side.507.name"
	desc = "ag_side.507.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_sensor_ping
	location = event_target:ag_target_moon
	is_triggered_only = yes
	option = {
		name = "ag_side.507.a"
		enable_special_project = { name = ag_search_ancient_devices_2 owner = root }
	}
}
country_event = {
	id = ag_side.508
	title = "ag_side.508.name"
	desc = "ag_side.508.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sapient_AI_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = "ag_side.508.a"
		add_relic = ag_auto_starbase_relic
		hidden_effect = {
			ag_add_research_option = { ag_tech = tech_ag_auto_starbase }
			ag_add_research_option = { ag_tech = tech_mega_engineering }
		}
	}
}
# Researched technology, show notification.
country_event = {
	id = ag_side.509
	title = "ag_side.509.name"
	desc = "ag_side.509.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_metropolis_room }
	show_sound = event_mystic_reveal
	location = capital_scope
	is_triggered_only = yes
	trigger = {
		last_increased_tech = "tech_ag_auto_starbase"
		NOT = { has_country_flag = ag_side_509_fired }
	}
	immediate = { set_country_flag = ag_side_509_fired }
	option = { name = "ag_side.509.a" custom_tooltip = "ag_side.509.a.tooltip" }
}
