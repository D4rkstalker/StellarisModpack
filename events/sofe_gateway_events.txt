namespace = sofe_gateway


###########ENCOUNTERING GATERWAY

# Encountered Gateway via Survey
country_event = {
	id = sofe_gateway.1
	title = "sofe_gatekeeper.1.name"
	desc = {
		text = sofe_gatekeeper.1.1.desc
		trigger = {
			OR = {
				is_country_type = default
				is_country_type = ascended_empire
			}
			NOT = { 
				has_country_flag = encountered_first_gateway
			}
		}
	}
	desc = {
		text = sofe_gatekeeper.1.2.desc
		trigger = {
			OR = {
				is_country_type = default
				is_country_type = ascended_empire
			}
			has_country_flag = encountered_first_gateway
		}
	}
	desc = {
		text = sofe_gatekeeper.1.fallen.desc
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
			}
		}
	}
	desc = {
		text = sofe_gatekeeper.1.eternal.desc
		trigger = {
			is_country_type = eternal_empire
		}
	}
	desc = {
		text = sofe_gatekeeper.1.playoe.desc
		trigger = {
			is_progenitor_empires = yes
		}
	}

	picture = GFX_evt_sofe_outergate_keeper
	show_sound = event_radio_chatter
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { exists = fromfrom } # not surveyed by ship
		NOR = { 
			has_country_flag = encountered_first_outergate
			has_event_chain = "sofe_outergate_chain"
			has_global_flag = outer_cluster_opened
		}
		FROM = {
			has_star_flag = outergate
			any_system_megastructure = { is_megastructure_type = sofe_outer_gate }
		}
	}
	
	immediate = {
		FROM = { save_event_target_as = outergate_system }
		set_country_flag = encountered_first_outergate
		every_country = {
			limit = { is_country_type = sofe_sentinel_dormant }
			establish_communications_no_message = ROOT
		}
	}
	
	option = {
		name = EXCELLENT
		trigger = {
			is_progenitor_empires = no
		}
		default_hide_option = yes
		custom_tooltip = begin_outercluster_chain
		begin_event_chain = {
			event_chain = sofe_outergate_chain
			target = this
		}
		hidden_effect = {
			if = {
				limit = { 
					exists = event_target:sofe_gatekeeper_dormant_country 
					is_ai = no
				}
				country_event = { id = sofe_gateway.3 }				
			}
		}
	}

	option = {
		name = sofe_gatekeeper.1.playoe.a
		trigger = {
			is_progenitor_empires = yes
		}
		default_hide_option = yes
		hidden_effect = {
			custom_tooltip = begin_outercluster_chain
			begin_event_chain = {
				event_chain = sofe_outergate_chain
				target = this
			}
			if = {
				limit = { 
					exists = event_target:sofe_gatekeeper_dormant_country 
					is_ai = no
				}
				country_event = { id = sofe_gateway.3 }				
			}
		}
	}
}

# Encountered Gateway via Entering
ship_event = {
	id = sofe_gateway.2
	title = "sofe_gatekeeper.1.name"
	desc = {
		text = sofe_gatekeeper.2.1.desc
		trigger = {
			owner = { 
				OR = {
					is_country_type = default
					is_country_type = ascended_empire
				}
			}
			NOT = { has_global_flag = outer_cluster_opened }
		}
	}
	desc = {
		text = sofe_gatekeeper.2.2.desc
		trigger = {
			owner = { 
				has_country_flag = encountered_first_gateway
				OR = {
					is_country_type = default
					is_country_type = ascended_empire
				}
			}
			NOT = { has_global_flag = outer_cluster_opened }

		}
	}
	desc = {
		text = sofe_gatekeeper.1.fallen.desc
		trigger = {
			owner = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}
		}
	}
	desc = {
		text = sofe_gatekeeper.1.eternal.desc
		trigger = {
			owner = {
				is_country_type = eternal_empire
			}
		}
	}
	desc = {
		text = sofe_gatekeeper.1.playoe.desc
		trigger = {
			owner = {
				is_progenitor_empires = yes				
			}
		}
	}

	picture = GFX_evt_sofe_outergate_keeper
	show_sound = event_radio_chatter
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_global_flag = outer_cluster_opened
		}
		owner = {
			NOR = { 
				has_country_flag = encountered_first_outergate
				has_event_chain = "sofe_outergate_chain"
			}
		}
		FROM = {
			has_star_flag = outergate
			any_system_megastructure = { is_megastructure_type = sofe_outer_gate }
		}
	}
	
	immediate = {
		#FROM = { save_event_target_as = gateway_system }
		FROM = { save_event_target_as = outergate_system }
		owner = { set_country_flag = encountered_first_outergate }
		every_country = {
			limit = { is_country_type = sofe_sentinel_dormant }
			establish_communications_no_message = ROOT.owner
		}
	}	

	option = {
		name = EXCELLENT
		trigger = {
			owner = {
				is_progenitor_empires = no	
			}
		}
		default_hide_option = yes
		custom_tooltip = begin_outercluster_chain
		begin_event_chain = {
			event_chain = sofe_outergate_chain
			target = this
		}
		owner = {
			hidden_effect = {
				if = {
					limit = { 
						exists = event_target:sofe_gatekeeper_dormant_country 
						is_ai = no
					}
					country_event = { id = sofe_gateway.3 }					
				}
			}
		}
	}

	option = {
		name = sofe_gatekeeper.1.playoe.a
		trigger = {
			owner = {
				is_progenitor_empires = yes	
			}
		}
		default_hide_option = yes
		owner = {
			hidden_effect = {
				if = {
					limit = { 
						exists = event_target:sofe_gatekeeper_dormant_country 
						is_ai = no
					}
					country_event = { id = sofe_gateway.3 }					
				}
			}
		}
	}
}

#WARNING! YOU ARE TALKING TO GATEKEER< BIATCH
country_event = {
	id = sofe_gateway.3
	title = sofe_gateway.gatekeeper.title
	desc = {
		text = sofe_gateway.3.desc
		trigger = {
			OR = {
				is_country_type = default
				is_country_type = ascended_empire
			}
		}
	}
	desc = {
		text = sofe_gateway.3.desc
		trigger = {
			is_country_type = lost_empire
		}
	}
	desc = {
		text = sofe_gateway.3.desc.fallen
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
			}
		}
	}
	desc = {
		text = sofe_gateway.3.desc.eternal
		trigger = {
			OR = {
				is_country_type = eternal_empire
			}
		}
	}
	desc = {
		text = sofe_gateway.3.desc.playoe
		trigger = {
			OR = {
				is_progenitor_empires = yes
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	show_sound = event_yellow_alert

	trigger = {
		exists = event_target:sofe_gatekeeper_dormant_country
	}

	picture_event_data = {
		room = sofe_gatekeeper_room
	}

	option = {
		name = sofe_gateway.3.a
		trigger = {
			OR = {
				is_country_type = default
				is_country_type = ascended_empire
				is_country_type = lost_empire			
			}
		}
		is_dialog_only = yes
		response_text = sofe_gateway.3.a.explain
	}

	option = {
		name = sofe_gateway.3.b
		trigger = {
			OR = {
				is_country_type = default
				is_country_type = ascended_empire
				is_country_type = lost_empire			
			}
		}
		is_dialog_only = yes
		response_text = sofe_gateway.3.b.explain
	}

	option = {
		name = sofe_gateway.3.fallen.a
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire			
			}
		}
		is_dialog_only = yes
		response_text = sofe_gateway.3.fallen.a.explain
	}

	option = {
		name = sofe_gateway.3.fallen.b
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire		
			}
		}
		is_dialog_only = yes
		response_text = sofe_gateway.3.fallen.b.explain
	}

	option = {
		name = sofe_gateway.3.c
		response_text = sofe_gateway.3.c.explain
		trigger = {
			is_progenitor_empires = no
			NOT = {
				is_country_type = eternal_empire					
			}
		}
		default_hide_option = yes
		hidden_effect = {
			custom_tooltip = begin_outercluster_chain
			begin_event_chain = {
				event_chain = sofe_outergate_chain
				target = this
			}
		}
	}

	option = {
		name = sofe_gateway.3.eternal.a
		trigger = {
			OR = {
				is_country_type = original_empire_active
				is_country_type = eternal_empire				
			}
		}
		response_text = sofe_gateway.3.eternal.a.explain
		hidden_effect = {
			if = {
				limit = { is_country_type = eternal_empire }
				begin_event_chain = {
					event_chain = sofe_outergate_chain
					target = this
				}				
			}
			random_country = {
				limit = {
					OR = {
						is_country_type = sofe_sentinel_dormant
						is_country_type = sofe_sentinel_active			
					}
				}				
				every_owned_fleet = {
					destroy_fleet = this
				}
			}
		}
	}

	option = {
		name = sofe_gateway.3.eternal.b
		trigger = {
			is_country_type = eternal_empire			
		}
		response_text = sofe_gateway.3.eternal.b.explain
		hidden_effect = {
			begin_event_chain = {
				event_chain = sofe_outergate_chain
				target = this
			}
			random_country = {
				limit = {
					OR = {
						is_country_type = sofe_sentinel_dormant
						is_country_type = sofe_sentinel_active			
					}
				}
				every_owned_fleet = {
					set_owner = root
					solar_system = {
						every_system_planet = {
							surveyed = {
								set_surveyed = yes
							}							
						}
					}
				}
			}
		}
	}

	option = {
		name = sofe_gateway.3.c
		default_hide_option = yes
		trigger = {
			is_country_type = eternal_empire		
		}
		hidden_effect = {
			custom_tooltip = begin_outercluster_chain
			begin_event_chain = {
				event_chain = sofe_outergate_chain
				target = this
			}
			every_country = {
				limit = {
					OR = {
						is_country_type = sofe_sentinel_dormant
						is_country_type = sofe_sentinel_active			
					}
				}
				set_faction_hostility = {
					target = prev
					set_hostile = yes
					set_neutral = no
					set_friendly = no
				}
			}
		}
	}

	option = {
		name = sofe_gateway.3.playoe.control
		trigger = {
			OR = {
				is_progenitor_empires = yes
			}
		}
		response_text = sofe_gateway.3.playoe.control.explain
		hidden_effect = {
			random_country = {
				limit = {
					OR = {
						is_country_type = sofe_sentinel_dormant
						is_country_type = sofe_sentinel_active			
					}
				}			
				every_owned_fleet = {
					delete_fleet = this
				}
				every_system = {
					limit = {
						has_megastructure = sofe_outer_gate
					}
					every_system_megastructure = {
						limit = {
							is_megastructure_type = sofe_outer_gate
						}
						create_fleet = {
							name = "NAME_GATEKEEPER_WARDEN_FLEET"
							settings = {
								is_boss = yes
								uses_naval_capacity = no
								spawn_debris = no
							}
							effect = {
								set_owner = ROOT
								while = {
									count = 1
									create_ship = {
										name = "NAME_WARDEN_DEVOUR"
										design = "NAME_WARDEN_STELLAR"
										graphical_culture = root
									}
								}
								set_location = PREV
								set_fleet_stance = aggressive
								set_aggro_range_measure_from = return_point
								set_aggro_range = 400
							}
						}
					}
				}	
			}
		}
	}
}

#WARNING! GATEKEEPER NOW HOSTILE
event = {
	id = sofe_gateway.4
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		mid_game_years_passed >= 0
		NOR = {
			has_global_flag = sofe_shield_weaken
			has_global_flag = outer_cluster_opened
		}
	}


	immediate = {
		random_list = {
			80 = {
			}	
			20 = {
				set_global_flag = sofe_shield_weaken
				every_country = {
					limit = {
						is_country_type = sofe_sentinel_dormant
					}
					set_country_type = sofe_sentinel_active
				}
				every_ambient_object = {
					limit = {
						has_ambient_object_flag = sofe_shield_full
					}
					destroy_ambient_object = this
					create_ambient_object = {
						type = sofe_mem_planet_shield_partial
						location = this
					}
					last_created_ambient_object = {
						#set_location = prev
						set_ambient_object_flag = sofe_shield_partial
					}
				}
				every_country = {
					limit = {
						OR = {
							is_country_type = default
							is_country_type = fallen_empire
							is_country_type = awakened_fallen_empire
							is_country_type = ascended_empire
							is_country_type = lost_empire
							is_country_type = eternal_empire
							is_country_type = original_empire_active
						}			
					}
					country_event = { id = sofe_gateway.400 }
					if = {
						limit = {
							NOT = {
								has_event_chain = sofe_outergate_chain
							}
							is_progenitor_empires = no
						 }
						 begin_event_chain = {
							event_chain = sofe_outergate_chain
							target = this
						}			
					}		
				}
			}			
		}
	}
}

country_event = {
	id = sofe_gateway.4123
	hide_window = yes
	is_triggered_only = yes


	immediate = {
			set_global_flag = sofe_shield_weaken
			every_country = {
				limit = {
					is_country_type = sofe_sentinel_dormant
				}
				set_country_type = sofe_sentinel_active
			}
			every_ambient_object = {
				limit = {
					has_ambient_object_flag = sofe_shield_full
				}
				destroy_ambient_object = this
				create_ambient_object = {
					type = sofe_mem_planet_shield_partial
					location = this
				}
				last_created_ambient_object = {
					#set_location = prev
					set_ambient_object_flag = sofe_shield_partial
				}
			}
			every_country = {
				limit = {
					OR = {
						is_country_type = default
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
						is_country_type = ascended_empire
						is_country_type = lost_empire
						is_country_type = eternal_empire
						is_country_type = original_empire_active
					}			
				}
				country_event = { id = sofe_gateway.400 }
				if = {
					limit = {
						NOT = {
							has_event_chain = sofe_outergate_chain
						}
						is_progenitor_empires = no
					 }
					 begin_event_chain = {
						event_chain = sofe_outergate_chain
						target = this
				}				
			}		
		}
	}			
}

country_event = {
	id = sofe_gateway.400
	is_triggered_only = yes
	title = sofe_gatekeeper.4.name
	desc = {
		trigger = {
			is_progenitor_empires = no
		}
		text = sofe_gatekeeper.4.desc
	}
	desc = {
		trigger = {
			is_progenitor_empires = yes
		}
		text = sofe_gatekeeper.4.desc.playoe
	}
	picture = GFX_evt_sofe_outergate_keeper
	show_sound = event_radio_chatter

	immediate = {

		every_country = {
			limit = {
				OR = {
					is_country_type = sofe_sentinel_dormant
					is_country_type = sofe_sentinel_active					
				}
			}
			establish_communications_no_message = ROOT
		}
		every_country = {
			limit = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire					
				}
			}
		establish_communications_no_message = ROOT
		}
	}

	option = {
		name = EXCELLENT
		default_hide_option = yes
		if = {
			limit = {
				any_country = {
					OR = {
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire					
					}
					has_communications = root					
				}
			}
			random_country = {
				limit = {
					OR = {
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire					
					}
				}	
				save_event_target_as = FallenEmpireTaskOrigin
			}
			hidden_effect = {
				country_event = { id = sofe_gateway.401 }
			}
		}
	}

	after = {
		IF = {
			limit = {
				is_progenitor_empires = no
			}
			hidden_effect = {
				create_point_of_interest = {
					id = sofe_outer_gate_weaken_gate_poi.1
					name = "sofe_outergate_weaken_shield"
					desc = "sofe_outergate_weaken_shield_desc"
					event_chain = "sofe_outergate_chain"
					location = event_target:outer_gate_1
				}
				if = {
					limit = {
						exists = event_target:outer_gate_2
					 }
					 create_point_of_interest = {
						id = sofe_outer_gate_weaken_gate_poi.2
						name = "sofe_outergate_weaken_shield"
						desc = "sofe_outergate_weaken_shield_desc"
						event_chain = "sofe_outergate_chain"
						location = event_target:outer_gate_2
					}			
				}
				if = {
					limit = {
						exists = event_target:outer_gate_3
					 }
					 create_point_of_interest = {
						id = sofe_outer_gate_weaken_gate_poi.3
						name = "sofe_outergate_weaken_shield"
						desc = "sofe_outergate_weaken_shield_desc"
						event_chain = "sofe_outergate_chain"
						location = event_target:outer_gate_3
					}			
				}
				if = {
					limit = {
						exists = event_target:outer_gate_4
					 }
					 create_point_of_interest = {
						id = sofe_outer_gate_weaken_gate_poi.4
						name = "sofe_outergate_weaken_shield"
						desc = "sofe_outergate_weaken_shield_desc"
						event_chain = "sofe_outergate_chain"
						location = event_target:outer_gate_4
					}			
				}
				if = {
					limit = {
						exists = event_target:outer_gate_5
					 }
					 create_point_of_interest = {
						id = sofe_outer_gate_weaken_gate_poi.5
						name = "sofe_outergate_weaken_shield"
						desc = "sofe_outergate_weaken_shield_desc"
						event_chain = "sofe_outergate_chain"
						location = event_target:outer_gate_5
					}			
				}
				if = {
					limit = {
						exists = event_target:outer_gate_6
					 }
					 create_point_of_interest = {
						id = sofe_outer_gate_weaken_gate_poi.6
						name = "sofe_outergate_weaken_shield"
						desc = "sofe_outergate_weaken_shield_desc"
						event_chain = "sofe_outergate_chain"
						location = event_target:outer_gate_6
					}			
				}
				if = {
					limit = {
						exists = event_target:outer_gate_7
					 }
					 create_point_of_interest = {
						id = sofe_outer_gate_weaken_gate_poi.7
						name = "sofe_outergate_weaken_shield"
						desc = "sofe_outergate_weaken_shield_desc"
						event_chain = "sofe_outergate_chain"
						location = event_target:outer_gate_7
					}			
				}
				if = {
					limit = {
						exists = event_target:outer_gate_8
					 }
					 create_point_of_interest = {
						id = sofe_outer_gate_weaken_gate_poi.8
						name = "sofe_outergate_weaken_shield"
						desc = "sofe_outergate_weaken_shield_desc"
						event_chain = "sofe_outergate_chain"
						location = event_target:outer_gate_8
					}			
				}
				if = {
					limit = {
						exists = event_target:outer_gate_9
					 }
					 create_point_of_interest = {
						id = sofe_outer_gate_weaken_gate_poi.9
						name = "sofe_outergate_weaken_shield"
						desc = "sofe_outergate_weaken_shield_desc"
						event_chain = "sofe_outergate_chain"
						location = event_target:outer_gate_9
					}			
				}
				if = {
					limit = {
						exists = event_target:outer_gate_10
					 }
					 create_point_of_interest = {
						id = sofe_outer_gate_weaken_gate_poi.10
						name = "sofe_outergate_weaken_shield"
						desc = "sofe_outergate_weaken_shield_desc"
						event_chain = "sofe_outergate_chain"
						location = event_target:outer_gate_10
					}			
				}
				if = {
					limit = {
						exists = event_target:outer_gate_11
					 }
					 create_point_of_interest = {
						id = sofe_outer_gate_weaken_gate_poi.11
						name = "sofe_outergate_weaken_shield"
						desc = "sofe_outergate_weaken_shield_desc"
						event_chain = "sofe_outergate_chain"
						location = event_target:outer_gate_11
					}			
				}
				country_event = { id = sofe_gateway.6 }	
			}
		}
	}
}

country_event = {
	id = sofe_gateway.401
	title = sofe_gateway.401.name
	
	is_triggered_only = yes
	diplomatic = yes
	
	picture_event_data = {
		portrait = event_target:FallenEmpireTaskOrigin
		planet_background = event_target:FallenEmpireTaskOrigin
		graphical_culture = event_target:FallenEmpireTaskOrigin
		city_level = event_target:FallenEmpireTaskOrigin
		room = event_target:FallenEmpireTaskOrigin.ruler
	}
		

	desc = {
		text = sofe_gateway.401.desc.fallen
		trigger = {
			event_target:FallenEmpireTaskOrigin = { 
				NOT = {
					is_same_value = root
				}
			}
			NOT = {
				is_same_value = root
			}
			ROOT = {
				OR = {
					is_country_type = awakened_fallen_empire
					is_country_type = fallen_empire
				}
			}
		}
	}
	desc = {
		text = sofe_gateway.401.desc.myself
		trigger = {
			event_target:FallenEmpireTaskOrigin = { 
				is_same_value = root
			}
			ROOT = {
				OR = {
					is_country_type = awakened_fallen_empire
					is_country_type = fallen_empire
				}
			}
		}
	}
	desc = {
		text = sofe_gateway.401.desc.eternal
		trigger = {
			ROOT = {
				is_country_type = eternal_empire
			}
		}
	}
	desc = {
		text = sofe_gateway.401.desc.playoe
		trigger = {
			ROOT = {
				is_progenitor_empires = yes
			}
		}
	}
	desc = {
		text = sofe_gateway.401.desc.a.materialistA
		trigger = {
			ROOT = {
				OR = {
					is_country_type = default
					is_country_type = ascended_empire
					is_country_type = lost_empire
				}
			}
			event_target:FallenEmpireTaskOrigin = { 
				has_ethic = ethic_fanatic_materialist
				OR = {
					is_patronizing_to = root 
					is_custodial_to = root
					is_overlord_to = root		
				}
			}
		}
	}
	desc = {
		text = sofe_gateway.401.desc.a.materialistB
		trigger = {
			ROOT = {
				OR = {
					is_country_type = default
					is_country_type = ascended_empire
					is_country_type = lost_empire
				}
			}
			event_target:FallenEmpireTaskOrigin = { 
				has_ethic = ethic_fanatic_materialist
				NOR = {
					is_patronizing_to = root 
					is_custodial_to = root
					is_overlord_to = root		
				}
			}
		}
	}
	desc = {
		text = sofe_gateway.401.desc.a.xenophileA
		trigger = {
			ROOT = {
				OR = {
					is_country_type = default
					is_country_type = ascended_empire
					is_country_type = lost_empire
				}
			}
			event_target:FallenEmpireTaskOrigin = { 
				has_ethic = ethic_fanatic_xenophile
				OR = {
					is_patronizing_to = root 
					is_custodial_to = root
					is_overlord_to = root		
				}
			}
		}
	}
	desc = {
		text = sofe_gateway.401.desc.a.xenophileB
		trigger = {
			ROOT = {
				OR = {
					is_country_type = default
					is_country_type = ascended_empire
					is_country_type = lost_empire
				}
			}
			event_target:FallenEmpireTaskOrigin = { 
				has_ethic = ethic_fanatic_xenophile
				NOR = {
					is_patronizing_to = root 
					is_custodial_to = root
					is_overlord_to = root		
				}
			}
		}
	}
	desc = {
		text = sofe_gateway.401.desc.a.spiritualistA
		trigger = {
			ROOT = {
				OR = {
					is_country_type = default
					is_country_type = ascended_empire
					is_country_type = lost_empire
				}
			}
			event_target:FallenEmpireTaskOrigin = { 
				has_ethic = ethic_fanatic_spiritualist
				OR = {
					is_patronizing_to = root 
					is_custodial_to = root
					is_overlord_to = root		
				}
			}
		}
	}
	desc = {
		text = sofe_gateway.401.desc.a.spiritualistB
		trigger = {
			ROOT = {
				OR = {
					is_country_type = default
					is_country_type = ascended_empire
					is_country_type = lost_empire
				}
			}
			event_target:FallenEmpireTaskOrigin = { 
				has_ethic = ethic_fanatic_spiritualist
				NOR = {
					is_patronizing_to = root 
					is_custodial_to = root
					is_overlord_to = root		
				}
			}
		}
	}
	desc = {
		text = sofe_gateway.401.desc.a.xenophobe
		trigger = {
			ROOT = {
				OR = {
					is_country_type = default
					is_country_type = ascended_empire
					is_country_type = lost_empire
				}
			}
			event_target:FallenEmpireTaskOrigin = { 
				has_ethic = ethic_fanatic_xenophobe
			}
		}
	}
	desc = {
		text = sofe_gateway.401.desc.a.machine
		trigger = {
			ROOT = {
				is_progenitor_empires = no
			}
			event_target:FallenEmpireTaskOrigin = { 
				has_authority = auth_machine_intelligence 
			}
		}
	}
	desc = {
		text = sofe_gateway.401.desc.playoe.caretaker
		trigger = {
			ROOT = {
				is_progenitor_empires = yes
			}
			event_target:FallenEmpireTaskOrigin = { 
				has_authority = auth_machine_intelligence 
			}
		}
	}


	option = {
		name = sofe_gateway.401.a
		is_dialog_only = yes
		custom_tooltip = fallen_empire_unhappy_tooltip
		trigger = {
			NOR = {
				has_country_flag = asked_first_time
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = eternal_empire
				is_progenitor_empires = yes				
			}
			event_target:FallenEmpireTaskOrigin = { 
				NOR = {
					has_authority = auth_machine_intelligence 	
					is_same_value = root
				}
			}
		}
		response_text = sofe_gateway.401.a.bluff
		hidden_effect = {
			set_country_flag = asked_first_time
			event_target:FallenEmpireTaskOrigin = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request } }
		}
	}

	option = {
		name = sofe_gateway.401.b	
		allow = {
			root.owner = {
				resource_stockpile_compare = {
					resource = influence
					value >= 150
					
				}
			}
		}
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = eternal_empire
				is_progenitor_empires = yes
			}
			event_target:FallenEmpireTaskOrigin = { 
				NOR = {
					has_authority = auth_machine_intelligence 	
					is_same_value = root
				}
			}		
		}
		add_resource = {
			influence = -150
		}
	}

	option = {
		name = sofe_gateway.401.c
		custom_tooltip = fallen_empire_unhappy_tooltip
		default_hide_option = yes
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = eternal_empire
				is_progenitor_empires = yes
			}
			event_target:FallenEmpireTaskOrigin = { 
				NOR = {
					has_authority = auth_machine_intelligence 	
					is_same_value = root
				}
			}		
		}
		add_resource = {
			influence = 150
		}
		hidden_effect = {
			event_target:FallenEmpireTaskOrigin = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request } }	
		}
	}

	option = {
		name = sofe_gateway.401.fallen.a
		custom_tooltip = fallen_empire_unhappy_tooltip
		default_hide_option = yes
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
			}
			event_target:FallenEmpireTaskOrigin = { 
				NOR = {
					has_authority = auth_machine_intelligence 	
					is_same_value = root
				}
			}	
		}
		hidden_effect = {
			event_target:FallenEmpireTaskOrigin = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request } }	
		}
	}

	option = {
		name = sofe_gateway.401.fallen.b
		custom_tooltip = fallen_empire_unhappy_tooltip
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
			}
			event_target:FallenEmpireTaskOrigin = { 
				NOR = {
					has_authority = auth_machine_intelligence 	
					is_same_value = root
				}
			}	
		}
		hidden_effect = {
			event_target:FallenEmpireTaskOrigin = { add_opinion_modifier = { who = root modifier = opinion_majorly_failed_fallen_empire_task } }	
		}

		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = sofe_gateway.401.eternal.a
		custom_tooltip = fallen_empire_unhappy_tooltip
		trigger = {
			is_country_type = eternal_empire
			event_target:FallenEmpireTaskOrigin = { 
				NOR = {
					has_authority = auth_machine_intelligence 	
					is_same_value = root
				}
			}	
		}
		hidden_effect = {
			event_target:FallenEmpireTaskOrigin = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request } }	
		}
	}

	option = {
		name = sofe_gateway.401.eternal.b
		custom_tooltip = fallen_empire_unhappy_tooltip
		default_hide_option = yes
		trigger = {
			is_country_type = eternal_empire
			event_target:FallenEmpireTaskOrigin = { 
				NOR = {
					has_authority = auth_machine_intelligence 	
					is_same_value = root
				}
			}
		}
		hidden_effect = {
			event_target:FallenEmpireTaskOrigin = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request } }	
		}
	}

	option = {
		name = sofe_gateway.401.playoe.a
		default_hide_option = yes
		trigger = {
			is_progenitor_empires = yes
			event_target:FallenEmpireTaskOrigin = { 
				NOR = {
					has_authority = auth_machine_intelligence 	
					is_same_value = root
				}
			}
		}
		hidden_effect = {
		}
	}

	option = {
		name = sofe_gateway.401.playoe.b
		default_hide_option = yes
		trigger = {
			is_progenitor_empires = yes
			event_target:FallenEmpireTaskOrigin = { 
				NOR = {
					has_authority = auth_machine_intelligence 	
					is_same_value = root
				}
			}
		}
		hidden_effect = {
		}
	}

	option = {
		name = sofe_gateway.401.playoe.c
		default_hide_option = yes
		trigger = {
			is_progenitor_empires = yes
			event_target:FallenEmpireTaskOrigin = { 
				NOR = {
					has_authority = auth_machine_intelligence 	
					is_same_value = root
				}
			}
		}
		hidden_effect = {
			event_target:FallenEmpireTaskOrigin = { 
				destroy_country = yes
			}	
		}
	}

	option = {
		name = sofe_gateway.401.d
		default_hide_option = yes
		trigger = {
			is_progenitor_empires = no
			event_target:FallenEmpireTaskOrigin = { 
				has_authority = auth_machine_intelligence
				NOT = {
					is_same_value = root					
				}
			 }		
		}
	}

	option = {
		name = sofe_gateway.401.playoe.a.caretaker
		default_hide_option = yes
		trigger = {
			is_progenitor_empires = yes
			event_target:FallenEmpireTaskOrigin = { 
				has_authority = auth_machine_intelligence
				NOT = {
					is_same_value = root					
				}
			 }		
		}
	}

	option = {
		name = sofe_gateway.401.playoe.b.caretaker
		default_hide_option = yes
		trigger = {
			is_progenitor_empires = yes
			event_target:FallenEmpireTaskOrigin = { 
				has_authority = auth_machine_intelligence
				NOT = {
					is_same_value = root					
				}
			 }		
		}
		event_target:FallenEmpireTaskOrigin = { 
			every_owned_planet = {
				set_owner = ROOT
			}
			every_owned_fleet = {
				set_owner = ROOT				
			}
		 }
	}

	option = {
		name = sofe_gateway.401.myself.a
		default_hide_option = yes
		trigger = {
			is_progenitor_empires = no
			event_target:FallenEmpireTaskOrigin = { 
				is_same_value = root	
			 }		
		}
	}

	option = {
		name = sofe_gateway.401.myself.b
		trigger = {
			event_target:FallenEmpireTaskOrigin = { 
				is_same_value = root	
			 }		
		}
	}

	option = {
		name = sofe_gateway.401.myself.c
		trigger = {
			event_target:FallenEmpireTaskOrigin = { 
				is_same_value = root	
			 }		
		}
	}

	option = {
		name = sofe_gateway.401.myself.d
		trigger = {
			event_target:FallenEmpireTaskOrigin = { 
				is_same_value = root	
			 }		
		}
	}
}

#WARNING! YOU ARE TALKING TO RAPTORUS
country_event = {
	id = sofe_gateway.5
	title = sofe_gateway.smuggler.title
	desc = {
		text = sofe_gatekeeper.5.1.desc
		trigger = {
			NOT = {		
				has_country_flag = met_the_smuggler	
			}
		}
	}
	desc = {
		text = sofe_gatekeeper.5.2.desc
		trigger = {
			has_country_flag = met_the_smuggler
		}
	}
	desc = {
		text = sofe_gatekeeper.5.3.desc
		trigger = {
			has_country_flag = known_the_smuggler
			NOT = { 
				has_country_flag = met_the_smuggler
			}
		}
	}
	desc = {
		text = sofe_gatekeeper.5.4.desc
		trigger = {
			has_country_flag = known_the_smuggler
			has_country_flag = met_the_smuggler
		}
	}
	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		room = sofe_smuggler_room
	}

	immediate = {
		if = {
			limit = {
				has_special_project = OUTER_GATE_SMUGGLER_STEAL
			 }
			 abort_special_project = {
				type = OUTER_GATE_SMUGGLER_STEAL
			}	
		}
	}

	option = {
		name = sofe_gateway.5.a
		is_dialog_only = yes
		response_text = sofe_gateway.5.a.explain
	}

	option = {
		name = sofe_gateway.5.b
		response_text = sofe_gateway.5.b.explain
		default_hide_option = yes
		hidden_effect = {
			capital_scope = {
				enable_special_project = {
					name = "OUTER_GATE_SMUGGLER_STEAL"
					location = this
					owner = root
				}
			}			
		}		
	}

	option = {
		name = sofe_gateway.5.c
		response_text = sofe_gateway.5.c.explain	
		allow = {
			resource_stockpile_compare = {
				resource = alloys
				value >= 10000	
			}
			resource_stockpile_compare = {
				resource = energy
				value >= 100000	
			}
			resource_stockpile_compare = {
				resource = minerals
				value >= 50000	
			}
		}	
		trigger = {
			NOT = {
				has_country_flag = known_the_smuggler				
			}
		}
		add_resource = {
			minerals = -50000
			energy = -100000
			alloys = -10000
		}
		hidden_effect = {
			country_event = { id = sofe_gateway.501 days = 30 }
		}
	}

	option = {
		name = sofe_gateway.5.d
		response_text = sofe_gateway.5.c.explain
		allow = {
			resource_stockpile_compare = {
				resource = alloys
				value >= 7500	
			}
			resource_stockpile_compare = {
				resource = energy
				value >= 65000
			}
			resource_stockpile_compare = {
				resource = minerals
				value >= 35000	
			}
		}	
		trigger = {
			has_country_flag = known_the_smuggler	
		}
		add_resource = {
			minerals = -35000
			energy = -65000
			alloys = -7500
		}
		hidden_effect = {
			country_event = { id = sofe_gateway.501 days = 30 }
		}
	}

	after = {
		set_country_flag = met_the_smuggler	
	}
}


# Smuggler Done
country_event = {
	id = sofe_gateway.501
	title = "sofe_gateway.501.name"
	desc = "sofe_gateway.501.desc"
	picture = GFX_evt_ship_offloading_cargo
	show_sound = event_radio_chatter

	is_triggered_only = yes

	immediate = {
	}

	option = {
		name = "sofe_gateway.501.a"
		default_hide_option = yes
		add_resource = {
			minerals = 13337
			alloys = 6731
			energy = 9
		}
		hidden_effect = {
			country_event = { id = sofe_gateway.606 }
		}
	}
}

# looping check for owning gateway, once every two months
country_event = {
	id = sofe_gateway.6
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		NOT = { 
			has_global_flag = outer_cluster_opened 	
		}
	}

	immediate = {
		if = {
			limit = {
				any_owned_megastructure = {
					is_megastructure_type = sofe_outer_gate
				}
			}
			set_country_flag = outer_gate_research_began
			random_owned_megastructure = {
				limit = {
					is_megastructure_type = sofe_outer_gate
				}
				save_event_target_as = candidate_outergateway
			}
			country_event = { id = sofe_gateway.601 } # enable project
		}
		else = {
			country_event = { id = sofe_gateway.6 days = 60 } # *THIS* looping check
		}		
	}
}

# Project available
country_event = {
	id = sofe_gateway.601
	title = "sofe_gateway.601.name"
	desc = "sofe_gateway.601.desc"
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		remove_point_of_interest = sofe_outer_gate_weaken_gate_poi.1
		remove_point_of_interest = sofe_outer_gate_weaken_gate_poi.2
		remove_point_of_interest = sofe_outer_gate_weaken_gate_poi.3
		remove_point_of_interest = sofe_outer_gate_weaken_gate_poi.4
		remove_point_of_interest = sofe_outer_gate_weaken_gate_poi.5
		remove_point_of_interest = sofe_outer_gate_weaken_gate_poi.6
		remove_point_of_interest = sofe_outer_gate_weaken_gate_poi.7
		remove_point_of_interest = sofe_outer_gate_weaken_gate_poi.8
		remove_point_of_interest = sofe_outer_gate_weaken_gate_poi.9
		remove_point_of_interest = sofe_outer_gate_weaken_gate_poi.10
		remove_point_of_interest = sofe_outer_gate_weaken_gate_poi.11
		event_target:candidate_outergateway = {
			solar_system = { 
				save_event_target_as = candidate_outergateway_system 
			}
		}
	}

	option = {
		name = "EXCELLENT"
		default_hide_option = yes
		event_target:candidate_outergateway = {
			enable_special_project = {
				name = OUTER_GATE_FIRST_ANALYSIS_TITLE
				location = this
			}
		}
	}
}


# Project First Analysis Completed
country_event = {
	id = sofe_gateway.602
	title = "sofe_gateway.602.name"
	desc = "sofe_gateway.602.desc"
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		if = {
			limit =  { has_special_project = OUTER_GATE_FIRST_ANALYSIS_TITLE }
			abort_special_project = {
				type = OUTER_GATE_FIRST_ANALYSIS_TITLE
			}				
		}
		if = {
			limit = {
				NOT = {
					has_technology = tech_gateway_activation
				}
			 }
			add_research_option = tech_gateway_activation
			add_tech_progress = {
				tech = tech_gateway_activation
				progress = 0.15
			}
		}
		if = {
			limit = {
				OR = {
					is_country_type = default
					is_country_type = ascended_empire
					is_country_type = lost_empire
				}				
			 }	
			 if = {
				 limit = {
					 any_country = {
						 OR = {
							 is_country_type = fallen_empire
							 is_country_type = awakened_fallen_empire
						 }
					 }
				  }
				  create_point_of_interest = {
					id = sofe_outergate_shield_poi.2
					name = "sofe_outergate_steal_fallen_world"
					desc = "sofe_outergate_steal_fallen_world_desc"
					event_chain = "sofe_outergate_chain"
					location = event_target:candidate_outergateway_system
				}
			 }
			create_point_of_interest = {
				id = sofe_outergate_shield_poi.3
				name = "sofe_outergate_fabricate_keystone"
				desc = "sofe_outergate_fabricate_keystone_desc"
				event_chain = "sofe_outergate_chain"
				location = event_target:candidate_outergateway_system
			}
			capital_scope = {
				enable_special_project = {
					name = "OUTER_GATE_SMUGGLER_STEAL"
					location = this
					owner = root
				}
			}
			 hidden_effect = {
				set_country_flag = allow_keystone_steal
				country_event = { id = sofe_gateway.603 days = 60 } # *THIS* looping check						
			}	
		}
		else_if = {
			limit = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
					is_country_type = eternal_empire
					is_country_type = original_empire_active
				}					
			 }
			 hidden_effect = {
				country_event = { id = sofe_gateway.606 days = 5 } # Already has a keystone					
			}			
		}
	}

	option = {
		name = "sofe_gateway.602.a"
	}
}


# looping check for owning technology
country_event = {
	id = sofe_gateway.603
	hide_window = yes

	mean_time_to_happen = {
		months = 2
	}

	location = FROM
	
	trigger = {
		has_technology = tech_armor_dm
		has_technology = tech_dark_matter_power_core
		has_country_flag = allow_keystone_steal
		NOR = { 
			has_global_flag = outer_cluster_opened 
			has_country_flag = has_keystone
			has_country_flag = keystone_project_granted
		}
	}

	immediate = {
		set_country_flag = keystone_project_granted
		country_event = { id = sofe_gateway.604 } # enable project	
	}
}

# Keystone Project available
country_event = {
	id = sofe_gateway.604
	title = "sofe_gateway.604.name"
	desc = "sofe_gateway.604.desc"
	picture = GFX_evt_matter_decompressor
	show_sound = event_mystic_reveal

	is_triggered_only = yes

	immediate = {
		remove_point_of_interest = sofe_outergate_shield_poi.3	
	}

	option = {
		name = "EXCELLENT"
		default_hide_option = yes
		capital_scope = {
			enable_special_project = {
				name = OUTER_GATE_FABRICATE_SEAL
				location = this
			}		
		}
	}
}

# Keystone Acquired
country_event = {
	id = sofe_gateway.606
	title = "sofe_gateway.606.name"
	desc = {
		text = sofe_gateway.606.desc
		trigger = {
			OR = {
				is_country_type = default	
				is_country_type = lost_empire	
				is_country_type = ascended_empire	
			}	
		}
	}
	desc = {
		text = sofe_gateway.606.desc.fallen
		trigger = {
			OR = {
				is_country_type = original_empire_active
				is_country_type = fallen_empire		
				is_country_type = awakened_fallen_empire	
				is_country_type = eternal_empire	
			}
		}
	}
	picture = GFX_evt_matter_decompressor
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes


	
	immediate = {
		set_country_flag = has_keystone
		add_event_chain_counter = {
			event_chain = sofe_outergate_chain
			counter = seals_broken
			amount = 1
		}
		hidden_effect = {		
			remove_point_of_interest = sofe_outergate_shield_poi.2
			remove_point_of_interest = sofe_outergate_shield_poi.3	
			if = {
				limit =  { has_special_project = OUTER_GATE_FABRICATE_SEAL }
				abort_special_project = {
					type = OUTER_GATE_FABRICATE_SEAL
				}				
			}
			if = {
				limit =  { has_special_project = OUTER_GATE_SMUGGLER_STEAL }
				abort_special_project = {
					type = OUTER_GATE_SMUGGLER_STEAL
				}				
			}
		}
	}

	option = {
		name = "sofe_gateway.606.a"
		default_hide_option = yes
		set_country_flag = first_seal_broken
		country_event = { id = sofe_gateway.7 days = 10 }
	}
}

country_event = {
	id = sofe_gateway.7
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				any_owned_megastructure = {
					is_megastructure_type = sofe_outer_gate
				}
			}
			random_owned_megastructure = {
				limit = {
					is_megastructure_type = sofe_outer_gate
				}
				save_event_target_as = candidate_outergateway
			}
			country_event = { id = sofe_gateway.71 } # enable project
		}
		else = {
			country_event = { id = sofe_gateway.7 days = 60 } # *THIS* looping check
		}
	}
}

# True Analysis Project available
country_event = {
	id = sofe_gateway.71
	title = "sofe_gateway.7.name"
	desc = {
		text = sofe_gateway.7.desc
		trigger = {
			NOT = {
				has_country_flag = second_seal_attempted
			}		
		}
	}
	desc = {
		text = sofe_gateway.7x2.desc
		trigger = {
			has_country_flag = second_seal_attempted
		}
	}
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		event_target:candidate_outergateway = {
			solar_system = { 
				save_event_target_as = candidate_outergateway_system 
			}
		}
	}

	option = {
		name = "sofe_gateway.7.a"
		default_hide_option = yes
		event_target:candidate_outergateway = {
			enable_special_project = {
				name = OUTER_GATE_SECOND_SEAL
				location = this
			}
		}
	}
}

############ FIRST RIDDLE TEST ##############################
#Spiritualist
country_event = {
	id = sofe_gateway.701
	title = "sofe_gateway.701.name"
	desc = "sofe_gateway.701.spiritualist_riddle"
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		if = {
			limit =  { has_special_project = OUTER_GATE_SECOND_SEAL }
			abort_special_project = {
				type = OUTER_GATE_SECOND_SEAL
			}				
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = second_seal_attempted
				}
			 }
			 set_country_flag = second_seal_attempted			
		}
	}

	option = {
		name = "sofe_gateway.701.spiritualist_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_spiritualist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.spiritualist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.7001 }			
		}
	}
	option = {
		name = "sofe_gateway.701.materialist_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_materialist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.materialist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.703 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophile_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_xenophile_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophile_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.704 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophobe_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_xenophobe_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophobe_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.705 }			
		}
	}
	option = {
		name = "sofe_gateway.701.stellarite_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_stellarite_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.stellarite_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.706 }			
		}
	}
	option = {
		name = "sofe_gateway.701.psionic_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_psionic_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.psionic_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.707 }			
		}
	}
}

#Materialist
country_event = {
	id = sofe_gateway.801
	title = "sofe_gateway.701.name"
	desc = "sofe_gateway.701.materialist_riddle"
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		if = {
			limit =  { has_special_project = OUTER_GATE_SECOND_SEAL }
			abort_special_project = {
				type = OUTER_GATE_SECOND_SEAL
			}				
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = second_seal_attempted
				}
			 }
			 set_country_flag = second_seal_attempted			
		}
	}

	option = {
		name = "sofe_gateway.701.spiritualist_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_spiritualist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.spiritualist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.702 }			
		}
	}
	option = {
		name = "sofe_gateway.701.materialist_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_materialist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.materialist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.8001 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophile_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_xenophile_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophile_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.704 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophobe_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_xenophobe_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophobe_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.705 }			
		}
	}
	option = {
		name = "sofe_gateway.701.stellarite_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_stellarite_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.stellarite_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.706 }			
		}
	}
	option = {
		name = "sofe_gateway.701.psionic_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_psionic_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.psionic_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.707 }			
		}
	}
}

#Xenophile
country_event = {
	id = sofe_gateway.901
	title = "sofe_gateway.701.name"
	desc = "sofe_gateway.701.xenophile_riddle"
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		if = {
			limit =  { has_special_project = OUTER_GATE_SECOND_SEAL }
			abort_special_project = {
				type = OUTER_GATE_SECOND_SEAL
			}				
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = second_seal_attempted
				}
			 }
			 set_country_flag = second_seal_attempted			
		}
	}

	option = {
		name = "sofe_gateway.701.spiritualist_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_spiritualist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.spiritualist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.702 }			
		}
	}
	option = {
		name = "sofe_gateway.701.materialist_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_materialist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.materialist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.703 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophile_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_xenophile_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophile_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.9001 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophobe_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_xenophobe_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophobe_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.705 }			
		}
	}
	option = {
		name = "sofe_gateway.701.stellarite_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_stellarite_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.stellarite_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.706 }			
		}
	}
	option = {
		name = "sofe_gateway.701.psionic_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_psionic_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.psionic_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.707 }			
		}
	}
}

#Xenophobe
country_event = {
	id = sofe_gateway.1001
	title = "sofe_gateway.701.name"
	desc = "sofe_gateway.701.xenophobe_riddle"
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		if = {
			limit =  { has_special_project = OUTER_GATE_SECOND_SEAL }
			abort_special_project = {
				type = OUTER_GATE_SECOND_SEAL
			}				
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = second_seal_attempted
				}
			 }
			 set_country_flag = second_seal_attempted			
		}
	}

	option = {
		name = "sofe_gateway.701.spiritualist_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_spiritualist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.spiritualist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.702 }			
		}
	}
	option = {
		name = "sofe_gateway.701.materialist_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_materialist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.materialist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.703 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophile_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_xenophile_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophile_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.704 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophobe_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_xenophobe_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophobe_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.10001 }			
		}
	}
	option = {
		name = "sofe_gateway.701.stellarite_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_stellarite_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.stellarite_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.706 }			
		}
	}
	option = {
		name = "sofe_gateway.701.psionic_choice"
		trigger = {
			NOT = {
				has_country_flag = first_riddle_psionic_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.psionic_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.707 }			
		}
	}
}

#Correct-Choice - Spiritualist
country_event = {
	id = sofe_gateway.7001
	title = "sofe_gateway.riddle_correct"
	desc = "sofe_gateway.riddle_choice_correct_spiritualist_desc"
	picture = GFX_evt_alien_propaganda
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = first_riddle_spiritualist_selected
	}

	option = {
		name = "EXCELLENT"
		if = { 
			limit = { NOT = { has_country_flag = hear_stellarite } }
				set_country_flag = stellarite_from_gate	
				set_country_flag = hear_stellarite 
				country_event = { id = stellarite_events.2 days = 2 }
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = sofe_outergate_chain
				counter = seals_broken
				amount = 1
			}		
		}
	}

	after = {
		country_event = { id = sofe_gateway.12 days = 60 }					
	}
}

#Correct-Choice - Materialist
country_event = {
	id = sofe_gateway.8001
	title = "sofe_gateway.riddle_correct"
	desc = "sofe_gateway.riddle_choice_correct_materialist_desc"
	picture = GFX_evt_robot_assembly_plant
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = first_riddle_materialist_selected
	}

	option = {
		name = "EXCELLENT"
		if = { 
			limit = { NOT = { has_country_flag = hear_stellarite } }
				set_country_flag = stellarite_from_gate	
				set_country_flag = hear_stellarite 
				country_event = { id = stellarite_events.2 days = 2 }
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = sofe_outergate_chain
				counter = seals_broken
				amount = 1
			}		
		}
	}

	after = {
		country_event = { id = sofe_gateway.12 days = 60 }					
	}
}

#Correct-Choice - Xenophile
country_event = {
	id = sofe_gateway.9001
	title = "sofe_gateway.riddle_correct"
	desc = "sofe_gateway.riddle_choice_correct_xenophile_desc"
	picture = GFX_evt_space_hangar
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = first_riddle_xenophile_selected
	}

	option = {
		name = "EXCELLENT"
		if = { 
			limit = { NOT = { has_country_flag = hear_stellarite } }
				set_country_flag = stellarite_from_gate	
				set_country_flag = hear_stellarite 
				country_event = { id = stellarite_events.2 days = 2 }
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = sofe_outergate_chain
				counter = seals_broken
				amount = 1
			}			
		}
	}

	after = {
		country_event = { id = sofe_gateway.12 days = 60 }					
	}
}

#Correct-Choice - Xenophobe
country_event = {
	id = sofe_gateway.10001
	title = "sofe_gateway.riddle_correct"
	desc = "sofe_gateway.riddle_choice_correct_xenophobe_desc"
	picture = GFX_evt_interior_battle
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = first_riddle_xenophobe_selected
	}

	option = {
		name = "EXCELLENT"
		if = { 
			limit = { NOT = { has_country_flag = hear_stellarite } }
				set_country_flag = stellarite_from_gate	
				set_country_flag = hear_stellarite 
				country_event = { id = stellarite_events.2 days = 2 }
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = sofe_outergate_chain
				counter = seals_broken
				amount = 1
			}			
		}
	}

	after = {
		country_event = { id = sofe_gateway.12 days = 60 }					
	}
}

### WRPMG CHPOCE

#S-Choice - Spiritualist
country_event = {
	id = sofe_gateway.702
	title = "sofe_gateway.riddle_incorrect"
	desc = "sofe_gateway.riddle_choice_wrong_spiritualist_desc"
	picture = GFX_evt_space_monster
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = first_riddle_spiritualist_selected
		if = {
			limit = { 
				NOT = {
					has_technology = tech_psionic_theory
				}
			}
			add_research_option = tech_psionic_theory
		}
		add_resource = {
			minerals = 100000
			energy = 100000
			food = 100000
			alloys = 10000
			consumer_goods = 10000
			sr_dark_matter = 5000
			acot_sr_dark_energy = 5000
		}
	}

	option = {
		name = sofe_gateway.riddle_positive_reply
	}

	after = {
		hidden_effect = {
			country_event = { id = sofe_gateway.7 days = 5 } # *THIS* looping check
		}		
	}
}

#S-Choice - Materialist
country_event = {
	id = sofe_gateway.703
	title = "sofe_gateway.riddle_incorrect"
	desc = {
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		text = sofe_gateway.riddle_choice_wrong_materialist_desc
	}
	desc = {
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		text = sofe_gateway.riddle_choice_wrong_materialist_ae_desc
	}
	picture = GFX_evt_sofe_outergate_keeper
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = first_riddle_materialist_selected
	}

	option = {
		name = sofe_gateway.riddle_positive_reply
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		if = {
			limit = {
				NOT = {
					has_technology = tech_precursor_design
				}
			 }
			 add_research_option = tech_precursor_design
			 add_tech_progress = {
				 tech = tech_precursor_design
				 progress = 0.10
			 }		
		}
		if = {
			limit = {
				NOT = {
					has_technology = tech_gatekeepers
				}
			 }
			 add_research_option = tech_gatekeepers
			 add_tech_progress = {
				 tech = tech_gatekeepers
				 progress = 0.10
			 }			
		}
		else = {
			add_research_option = tech_gatekeepers_cost
			add_tech_progress = {
				tech = tech_gatekeepers_cost
				progress = 0.10
			}				
		}
	}

	option = {
		name = sofe_gateway.riddle_ae_refuse
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		add_resource = {
			society_research = 50000
			engineering_research = 50000
			physics_research = 50000
		}
	}

	option = {
		name = sofe_gateway.riddle_ae_reply
		trigger = {
			OR = {
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = influence
				value >= 1000		
			}
		}
		if = {
			limit = {
				NOT = {
					has_technology = tech_precursor_design
				}
			 }
			 add_research_option = tech_precursor_design
			 add_tech_progress = {
				 tech = tech_precursor_design
				 progress = 0.10
			 }			
		}
		if = {
			limit = {
				NOT = {
					has_technology = tech_gatekeepers
				}
			 }
			 add_research_option = tech_gatekeepers
			 add_tech_progress = {
				 tech = tech_gatekeepers
				 progress = 0.10
			 }			
		}
		else = {
			add_research_option = tech_gatekeepers_cost
			add_tech_progress = {
				tech = tech_gatekeepers_cost
				progress = 0.10
			}				
		}
	}

	after = {
		hidden_effect = {
			country_event = { id = sofe_gateway.7 days = 5 } # *THIS* looping check
		}		
	}
}

#S-Choice - Xenophile
country_event = {
	id = sofe_gateway.704
	title = "sofe_gateway.riddle_incorrect"
	desc = {
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		text = sofe_gateway.riddle_choice_wrong_xenophile_desc
	}
	desc = {
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		text = sofe_gateway.riddle_choice_wrong_xenophile_ae_desc
	}
	picture = GFX_evt_board_meeting
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = first_riddle_xenophile_selected
	}

	option = {
		name = sofe_gateway.riddle_positive_reply
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}			
		}
		if = {
			limit = {
				NOT = {
					has_technology = tech_precursor_design
				}
			 }
			 add_research_option = tech_precursor_design
			 add_tech_progress = {
				 tech = tech_precursor_design
				 progress = 0.10
			 }		
		}
		if = {
			limit = {
				NOT = {
					has_technology = tech_precursor_guardian
				}
			 }
			 add_research_option = tech_precursor_guardian
			 add_tech_progress = {
				 tech = tech_precursor_guardian
				 progress = 0.10
			 }			
		}
		else = {
			add_research_option = tech_precursor_guardian_cost
			add_tech_progress = {
				tech = tech_precursor_guardian_cost
				progress = 0.10
			}				
		}
	}

	option = {
		name = sofe_gateway.riddle_ae_refuse
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		add_resource = {
			society_research = 50000
			engineering_research = 50000
			physics_research = 50000
		}
	}

	option = {
		name = sofe_gateway.riddle_ae_reply
		trigger = {
			OR = {
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = influence
				value >= 1000		
			}
		}
		if = {
			limit = {
				NOT = {
					has_technology = tech_precursor_design
				}
			 }
			 add_research_option = tech_precursor_design
			 add_tech_progress = {
				 tech = tech_precursor_design
				 progress = 0.10
			 }		
		}
		if = {
			limit = {
				NOT = {
					has_technology = tech_precursor_guardian
				}
			 }
			 add_research_option = tech_precursor_guardian
			 add_tech_progress = {
				 tech = tech_precursor_guardian
				 progress = 0.10
			 }			
		}
		else = {
			add_research_option = tech_precursor_guardian_cost
			add_tech_progress = {
				tech = tech_precursor_guardian_cost
				progress = 0.10
			}				
		}
	}

	after = {
		hidden_effect = {
			country_event = { id = sofe_gateway.7 days = 5 } # *THIS* looping check
		}		
	}
}

#S-Choice - Xenophobe
country_event = {
	id = sofe_gateway.705
	title = "sofe_gateway.riddle_incorrect"
	desc = "sofe_gateway.riddle_choice_wrong_xenophobe_desc"
	picture = GFX_evt_synth_sabotage
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = first_riddle_xenophobe_selected
	}

	option = {
		name = sofe_gateway.riddle_negative_reply
		country_event = { id = sofe_gateway.708 }
	}

	after = {
		hidden_effect = {
			country_event = { id = sofe_gateway.7 days = 5 } # *THIS* looping check
		}		
	}	
}

#S-Choice - Stellarite
country_event = {
	id = sofe_gateway.706
	title = "sofe_gateway.riddle_incorrect"
	desc = "sofe_gateway.riddle_choice_wrong_stellarite_desc"
	picture = GFX_evt_synth_organic_relations
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = first_riddle_stellarite_selected
	}

	option = {
		name = sofe_gateway.riddle_negative_reply
		if = {
			limit = { 
				any_country = { 
					is_ai = yes
					is_country_type = fallen_empire
					has_authority = auth_machine_intelligence
				}
			 }
			 random_country = {
				 limit = {
					is_ai = yes
					is_country_type = fallen_empire
					has_authority = auth_machine_intelligence					 
				 }
				save_event_target_as = CaretakerCode
			 }
			hidden_effect = {
				country_event = { id = sofe_gateway.711 }				
			}
		}
		else = {
			country_event = { id = sofe_gateway.712 }				
		}
	}

	after = {
		hidden_effect = {
			country_event = { id = sofe_gateway.7 days = 5 } # *THIS* looping check
		}		
	}
}

#S-Choice - Psionic
country_event = {
	id = sofe_gateway.707
	title = "sofe_gateway.riddle_incorrect"
	desc = "sofe_gateway.riddle_choice_wrong_psionic_desc"
	picture = GFX_evt_shrouded_planet
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = first_riddle_psionic_selected
	}

	option = {
		name = sofe_gateway.riddle_negative_reply
		country_event = { id = sofe_gateway.713 }
	}

	after = {
		hidden_effect = {
			country_event = { id = sofe_gateway.7 days = 5 } # *THIS* looping check
		}		
	}
}

#S-Choice - Xenophobe - Bomb Prompt
country_event = {
	id = sofe_gateway.708
	title = "sofe_gateway.708.name"
	desc = "sofe_gateway.708.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_red_alert
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		country_event = { id = sofe_gateway.709 days = 30 }
		set_country_flag = bomb_originator
	}

	option = {
		name = sofe_gateway.708.a
	}
}

#S-Choice - Xenophobe - Bomb Exploded
country_event = {
	id = sofe_gateway.709
	title = "sofe_gateway.709.name"
	desc = "sofe_gateway.709.desc"
	picture = GFX_evt_large_explosion
	show_sound = event_ship_explosion

	is_triggered_only = yes

	immediate = {
		every_playable_country = {
			limit = {
				NOT = {
					has_country_flag = bomb_originator				
				}
			}
			country_event = {
				id = sofe_gateway.710	
			}
		}
		remove_country_flag = bomb_originator
		every_system = {
			limit = {
				NOT = {
					has_star_flag = outercluster_gate
				}
				any_system_megastructure = { 
					is_megastructure_type = sofe_outer_gate
				}
			}
			solar_system = {
				every_system_planet = {
					if = {
						limit = { 
							NOR = {
								is_ringworld = yes
								is_planet_class = pc_habitat
								is_asteroid = yes
								is_star = yes
							}
						}
						destroy_colony = yes
						reset_planet = yes
						change_pc = pc_shattered						
					}
					if = {
						limit = { 
							is_planet_class = pc_habitat
						}
						destroy_colony = yes
						remove_planet = yes						
					}
				}
				every_fleet_in_system = {
					destroy_fleet = this
				}
				if = {
					limit = {
						any_ship_in_system = {
							is_ship_class = shipclass_starbase
						}
					}
					random_fleet_in_system = {
						limit = {
							any_owned_ship = {
								is_ship_class = shipclass_starbase
							}
						}
						destroy_fleet = this
					}
				}
				every_neighbor_system = {
					every_system_planet = {
						if = {
							limit = { 
								NOR = {
									is_ringworld = yes
									is_planet_class = pc_habitat
									is_asteroid = yes
									is_star = yes
								}
							}
							destroy_colony = yes
							reset_planet = yes
							change_pc = pc_shattered						
						}
						if = {
							limit = { 
								is_planet_class = pc_habitat
							}
							destroy_colony = yes
							remove_planet = yes						
						}
					}
					every_fleet_in_system = {
						destroy_fleet = this
					}
					if = {
						limit = {
							any_ship_in_system = {
								is_ship_class = shipclass_starbase
							}
						}
						random_fleet_in_system = {
							limit = {
								any_owned_ship = {
									is_ship_class = shipclass_starbase
								}
							}
							destroy_fleet = this
						}
					}
					every_neighbor_system = {
						every_system_planet = {
							if = {
								limit = { 
									NOR = {
										is_ringworld = yes
										is_planet_class = pc_habitat
										is_asteroid = yes
										is_star = yes
									}
									habitable_planet = yes
								}
								destroy_colony = yes
								change_pc = pc_nuked						
							}
							if = {
								limit = { 
									is_planet_class = pc_habitat
								}
								destroy_colony = yes
								remove_planet = yes						
							}
						}
						every_fleet_in_system = {
							destroy_fleet = this
						}
						if = {
							limit = {
								any_ship_in_system = {
									is_ship_class = shipclass_starbase
								}
							}
							random_fleet_in_system = {
								limit = {
									any_owned_ship = {
										is_ship_class = shipclass_starbase
									}
								}
								destroy_fleet = this
							}
						}						
					}			
				}
			}
		}
	}

	option = {
		name = EXCELLENT
	}
}

#S-Choice - Xenophobe - Bomb Prompt
country_event = {
	id = sofe_gateway.710
	title = "sofe_gateway.710.name"
	desc = "sofe_gateway.710.desc"
	picture = GFX_evt_large_explosion
	show_sound = event_ship_explosion
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
	}

	option = {
		name = sofe_gateway.710.a
	}
}

country_event = {
	id = sofe_gateway.711
	title = sofe_gateway.711.name
	desc = sofe_gateway.711.desc
	show_sound = event_yellow_alert
	
	is_triggered_only = yes
	diplomatic = yes
	
	picture_event_data = {
		portrait = event_target:CaretakerCode
		planet_background = event_target:CaretakerCode
		graphical_culture = event_target:CaretakerCode
		city_level = event_target:CaretakerCode
		room = event_target:CaretakerCode.ruler
	}

	option = {
		name = sofe_gateway.711.a
		trigger = {
			has_global_flag = will_kill_caretaker
		}
		response_text = sofe_gateway.711.a.response
		hidden_effect = {
			event_target:CaretakerCode = {
				destroy_country = yes			
			}
		}
	}

	option = {
		name = sofe_gateway.711.a
		trigger = {
			has_global_flag = will_berserk_caretaker
		}
		response_text = sofe_gateway.711.a.berserk
		hidden_effect = {
			event_target:CaretakerCode = {
				set_country_type = awakened_fallen_empire		
				change_government = {
					civics = {
						civic = civic_awakened_machine
						civic = civic_malfunctioning_custodian
					}
				}	
				add_resource = { minerals = 200000 }
				add_resource = { energy = 200000 }
				add_resource = { influence = 1000 }
				add_resource = { alloys = 50000 }
				add_resource = { sr_dark_matter = 5000 }
				add_resource = { acot_sr_dark_energy = 1000 }

				# Add some more fleet
				country_event = { id = fallen_empires.13 }	
			# Establish communications
				every_country = {
					limit = {
					OR = {
						is_country_type = default
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
					NOT = { has_communications = root }
				}

				establish_communications_no_message = root
				}
				root = { save_event_target_as = awakened_machine_empire }							
			}
		}
	}

	option = {
		name = sofe_gateway.711.b
		response_text = sofe_gateway.711.b.response
	}

	option = {
		name = sofe_gateway.711.c
		response_text = sofe_gateway.711.c.response
		trigger = {
			has_technology = tech_precursor_design
			is_country_type = default
			NOT = {
				has_technology = tech_precursor_titan
				has_technology = tech_precursor_titan_cost								
			}
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_titan
				}
			 }
			 add_research_option = tech_precursor_titan
			 add_tech_progress = {
				 tech = tech_precursor_bc
				 progress = 0.20 
			 }
		}
		else_if = {
			limit = { has_technology = tech_precursor_titan }
			add_research_option = tech_precursor_titan_cost	
		}		
	}
}

#S-Choice - Xenophobe - Bomb Prompt
country_event = {
	id = sofe_gateway.712
	title = "sofe_gateway.712.name"
	desc = "sofe_gateway.712.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
	}

	option = {
		name = sofe_gateway.712.a
	}
}

###### FLEET SWAP EVENT
country_event = {
	id = sofe_gateway.713
	title = "sofe_gateway.713.name"
	desc = "sofe_gateway.713.desc"
	picture = GFX_evt_machine_sapience
	show_sound = event_laboratory_sound

	is_triggered_only = yes

	immediate = {
		set_country_flag = ownt_fleet
	}

	option = {
		name = "sofe_gateway.713.a"
		random_owned_fleet = {
			limit = {
				is_ship_class = shipclass_military
			}
			delete_fleet = this
		}
		random_owned_fleet = {
			limit = {
				is_ship_class = shipclass_military
			}
			save_event_target_as = going_to_lose_this_ship			
		}
		random_country = {
			limit = {
				NOT = { has_country_flag = ownt_fleet }					
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire		
					is_country_type = ascended_empire
					is_country_type = lost_empire	
					is_country_type = eternal_empire	
					is_country_type = original_empire_active			
				}
			}
			save_event_target_as = getting_free_fleet
			country_event = { id = sofe_gateway.714 }
			event_target:going_to_lose_this_ship = {
				set_owner = event_target:getting_free_fleet						
			}
		}
		random_country = {
			limit = {
				NOT = { has_country_flag = ownt_fleet }
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire		
					is_country_type = ascended_empire
					is_country_type = lost_empire		
					is_country_type = eternal_empire	
					is_country_type = original_empire_active		
				}
			}
			THIS = {
				country_event = { id = sofe_gateway.715 }					
			}
			random_owned_fleet = {
				limit = {
					is_ship_class = shipclass_military
				}
			set_owner = prevprev
			}
		}
		random_country = {
			limit = {
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire		
					is_country_type = ascended_empire
					is_country_type = lost_empire	
					is_country_type = eternal_empire				
					is_country_type = original_empire_active
				}
			}
			THIS = {
				country_event = { id = sofe_gateway.715 }					
			}
			random_owned_fleet = {
				limit = {
					is_ship_class = shipclass_military
				}
			set_owner = prevprev
			}
		}
		remove_country_flag = ownt_fleet
	}
}

country_event = {
	id = sofe_gateway.714
	title = "sofe_gateway.714.name"
	desc = "sofe_gateway.714.desc"
	picture = GFX_evt_fleet_neutral
	show_sound = event_mystic_reveal

	is_triggered_only = yes

	immediate = {
	}

	option = {
		name = "sofe_gateway.714.a"
	}
}

country_event = {
	id = sofe_gateway.715
	title = "sofe_gateway.715.name"
	desc = "sofe_gateway.715.desc"
	picture = GFX_evt_fleet_evil
	show_sound = event_mystic_reveal

	is_triggered_only = yes

	immediate = {
	}

	option = {
		name = "sofe_gateway.715.a"
	}
}

###################PROMPT FOR SECOND RIDDLE

country_event = {
	id = sofe_gateway.12
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				any_owned_megastructure = {
					is_megastructure_type = sofe_outer_gate
				}
			}
			random_owned_megastructure = {
				limit = {
					is_megastructure_type = sofe_outer_gate
				}
				save_event_target_as = candidate_outergateway
			}
			country_event = { id = sofe_gateway.120 } # enable project
		}
		else = {
			country_event = { id = sofe_gateway.12 days = 60 } # *THIS* looping check
		}
	}
}

# True Analysis Project available
country_event = {
	id = sofe_gateway.120
	title = "sofe_gateway.120.name"
	desc = {
		text = sofe_gateway.120.desc
		trigger = {
			NOT = {
				has_country_flag = third_seal_attempted
			}		
		}
	}
	desc = {
		text = sofe_gateway.120x2.desc
		trigger = {
			has_country_flag = third_seal_attempted
		}
	}
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		event_target:candidate_outergateway = {
			solar_system = { 
				save_event_target_as = candidate_outergateway_system 
			}
		}
	}

	option = {
		name = "sofe_gateway.120.a"
		event_target:candidate_outergateway = {
			enable_special_project = {
				name = OUTER_GATE_THIRD_SEAL
				location = this
			}
		}
	}
}

############ SECOND RIDDLE TEST ##############################
#Spiritualist
country_event = {
	id = sofe_gateway.13
	title = "sofe_gateway.13.name"
	desc = "sofe_gateway.second.spiritualist_riddle"
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		if = {
			limit =  { has_special_project = OUTER_GATE_THIRD_SEAL }
			abort_special_project = {
				type = OUTER_GATE_THIRD_SEAL
			}				
		}
		if = {
			limit =  { 
				NOT = {
					has_country_flag = third_seal_attempted
				}
			}	
			set_country_flag = third_seal_attempted
		}
	}

	option = {
		name = "sofe_gateway.701.spiritualist_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_spiritualist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.spiritualist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1300 }			
		}
	}
	option = {
		name = "sofe_gateway.701.materialist_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_materialist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.materialist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1401 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophile_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_xenophile_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophile_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1501 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophobe_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_xenophobe_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophobe_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1601 }			
		}
	}
	option = {
		name = "sofe_gateway.701.stellarite_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_stellarite_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.stellarite_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1701 }			
		}
	}
	option = {
		name = "sofe_gateway.701.psionic_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_psionic_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.psionic_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1801 }			
		}
	}
}

#Materialist
country_event = {
	id = sofe_gateway.14
	title = "sofe_gateway.701.name"
	desc = "sofe_gateway.second.materialist_riddle"
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		if = {
			limit =  { has_special_project = OUTER_GATE_THIRD_SEAL }
			abort_special_project = {
				type = OUTER_GATE_THIRD_SEAL
			}				
		}
		if = {
			limit =  { 
				NOT = {
					has_country_flag = third_seal_attempted
				}
			}	
			set_country_flag = third_seal_attempted
		}
	}

	option = {
		name = "sofe_gateway.701.spiritualist_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_spiritualist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.spiritualist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1301 }			
		}
	}
	option = {
		name = "sofe_gateway.701.materialist_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_materialist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.materialist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1400 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophile_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_xenophile_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophile_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1501 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophobe_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_xenophobe_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophobe_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1601 }			
		}
	}
	option = {
		name = "sofe_gateway.701.stellarite_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_stellarite_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.stellarite_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1701 }			
		}
	}
	option = {
		name = "sofe_gateway.701.psionic_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_psionic_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.psionic_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1801 }			
		}
	}
}

#Xenophile
country_event = {
	id = sofe_gateway.15
	title = "sofe_gateway.701.name"
	desc = "sofe_gateway.second.xenophile_riddle"
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		if = {
			limit =  { has_special_project = OUTER_GATE_THIRD_SEAL }
			abort_special_project = {
				type = OUTER_GATE_THIRD_SEAL
			}				
		}
		if = {
			limit =  { 
				NOT = {
					has_country_flag = third_seal_attempted
				}
			}	
			set_country_flag = third_seal_attempted
		}
	}

	option = {
		name = "sofe_gateway.701.spiritualist_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_spiritualist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.spiritualist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1301 }			
		}
	}
	option = {
		name = "sofe_gateway.701.materialist_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_materialist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.materialist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1401 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophile_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_xenophile_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophile_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1500 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophobe_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_xenophobe_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophobe_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1601 }			
		}
	}
	option = {
		name = "sofe_gateway.701.stellarite_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_stellarite_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.stellarite_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1701 }			
		}
	}
	option = {
		name = "sofe_gateway.701.psionic_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_psionic_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.psionic_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1801 }			
		}
	}
}

#Xenophobe
country_event = {
	id = sofe_gateway.16
	title = "sofe_gateway.701.name"
	desc = "sofe_gateway.second.xenophobe_riddle"
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		if = {
			limit =  { has_special_project = OUTER_GATE_THIRD_SEAL }
			abort_special_project = {
				type = OUTER_GATE_THIRD_SEAL
			}				
		}
		if = {
			limit =  { 
				NOT = {
					has_country_flag = third_seal_attempted
				}
			}	
			set_country_flag = third_seal_attempted
		}
	}

	option = {
		name = "sofe_gateway.701.spiritualist_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_spiritualist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.spiritualist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1301 }			
		}
	}
	option = {
		name = "sofe_gateway.701.materialist_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_materialist_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.materialist_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1401 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophile_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_xenophile_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophile_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1501 }			
		}
	}
	option = {
		name = "sofe_gateway.701.xenophobe_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_xenophobe_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.xenophobe_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1600 }			
		}
	}
	option = {
		name = "sofe_gateway.701.stellarite_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_stellarite_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.stellarite_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1701 }			
		}
	}
	option = {
		name = "sofe_gateway.701.psionic_choice"
		trigger = {
			NOT = {
				has_country_flag = second_riddle_psionic_selected
			}
		}
		custom_tooltip = "sofe_gateway.701.psionic_choice_desc"
		hidden_effect = {
			country_event = { id = sofe_gateway.1801 }			
		}
	}
}

##############CORRECT CHOICES###############

#Correct-Choice - Spiritualist
country_event = {
	id = sofe_gateway.1300
	title = "sofe_gateway.riddle_correct"
	desc = "sofe_gateway.second_riddle_choice_correct_spiritualist_desc"
	picture = GFX_evt_alien_propaganda
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = second_riddle_spiritualist_selected
	}

	option = {
		name = "EXCELLENT"
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = sofe_outergate_chain
				counter = seals_broken
				amount = 1
			}		
			country_event = { id = sofe_gateway.20 days = 60 }	
		}
	}
}

#Correct-Choice - Materialist
country_event = {
	id = sofe_gateway.1400
	title = "sofe_gateway.riddle_correct"
	desc = "sofe_gateway.second_riddle_choice_correct_materialist_desc"
	picture = GFX_evt_alien_propaganda
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = second_riddle_materialist_selected
	}

	option = {
		name = "EXCELLENT"
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = sofe_outergate_chain
				counter = seals_broken
				amount = 1
			}			
		}
		country_event = { id = sofe_gateway.20 days = 60 }	
	}
}

#Correct-Choice - Xenophile
country_event = {
	id = sofe_gateway.1500
	title = "sofe_gateway.riddle_correct"
	desc = "sofe_gateway.second_riddle_choice_correct_xenophile_desc"
	picture = GFX_evt_alien_propaganda
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = second_riddle_xenophile_selected
	}

	option = {
		name = "EXCELLENT"
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = sofe_outergate_chain
				counter = seals_broken
				amount = 1
			}			
		}
		country_event = { id = sofe_gateway.20 days = 60 }	
	}
}

#Correct-Choice - Xenophobe
country_event = {
	id = sofe_gateway.1600
	title = "sofe_gateway.riddle_correct"
	desc = "sofe_gateway.second_riddle_choice_correct_xenophobe_desc"
	picture = GFX_evt_alien_propaganda
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = second_riddle_xenophobe_selected
	}

	option = {
		name = "EXCELLENT"
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = sofe_outergate_chain
				counter = seals_broken
				amount = 1
			}			
		}
		country_event = { id = sofe_gateway.20 days = 60 }	
	}
}

#################WRONGGGGGGGGGGGGGGGGGGGGGGGGGGG###################

#S-Choice - Spiritualist
country_event = {
	id = sofe_gateway.1301
	title = "sofe_gateway.riddle_incorrect"
	desc = {
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}			
		}
		text = sofe_gateway.second_riddle_choice_wrong_spiritualist_desc
	}
	desc = {
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}			
		}
		text = sofe_gateway.second_riddle_choice_wrong_spiritualist_ae_desc
	}
	picture = GFX_evt_sofe_outergate_keeper
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = second_riddle_spiritualist_selected
	}

	option = {
		name = sofe_gateway.riddle_positive_reply
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_design
				}
			 }
			 add_research_option = tech_precursor_design
			 add_tech_progress = {
				 tech = tech_precursor_design
				 progress = 0.20 
			 }
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_fe_tower_offense
				}
			 }
			 add_research_option = tech_fe_tower_offense
			 add_tech_progress = {
				 tech = tech_fe_tower_offense
				 progress = 0.20 
			 }
		}
		if = {
			limit = { has_technology = tech_fe_tower_offense }
			add_research_option = tech_fe_tower_offense_cost	
		}
	}

	option = {
		name = sofe_gateway.riddle_ae_refuse
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		add_resource = {
			society_research = 50000
			engineering_research = 50000
			physics_research = 50000
		}
	}

	option = {
		name = sofe_gateway.riddle_ae_reply
		trigger = {
			OR = {
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = influence
				value >= 1000		
			}
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_design
				}
			 }
			 add_research_option = tech_precursor_design
			 add_tech_progress = {
				 tech = tech_precursor_design
				 progress = 0.20 
			 }
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_fe_tower_offense
				}
			 }
			 add_research_option = tech_fe_tower_offense
			 add_tech_progress = {
				 tech = tech_fe_tower_offense
				 progress = 0.20 
			 }
		}
		if = {
			limit = { has_technology = tech_fe_tower_offense }
			add_research_option = tech_fe_tower_offense_cost	
		}
	}

	after = {
		hidden_effect = {
			country_event = { id = sofe_gateway.12 days = 5 } # *THIS* looping check
		}
	}
}

#S-Choice - Materialist
country_event = {
	id = sofe_gateway.1401
	title = "sofe_gateway.riddle_incorrect"
	desc = {
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}			
		}
		text = sofe_gateway.second_riddle_choice_wrong_materialist_desc
	}
	desc = {
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}			
		}
		text = sofe_gateway.second_riddle_choice_wrong_materialist_ae_desc
	}
	picture = GFX_evt_sofe_outergate_keeper
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = second_riddle_materialist_selected
	}

	option = {
		name = sofe_gateway.riddle_positive_reply
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_design
				}
			 }
			 add_research_option = tech_precursor_design
			 add_tech_progress = {
				 tech = tech_precursor_design
				 progress = 0.20 
			 }
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_escort
				}
			 }
			 add_research_option = tech_precursor_escort
			 add_tech_progress = {
				 tech = tech_precursor_escort
				 progress = 0.20 
			 }
		}
		if = {
			limit = { has_technology = tech_precursor_escort }
			add_research_option = tech_precursor_escort_cost	
		}
	}

	option = {
		name = sofe_gateway.riddle_ae_refuse
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		add_resource = {
			society_research = 50000
			engineering_research = 50000
			physics_research = 50000
		}
	}

	option = {
		name = sofe_gateway.riddle_ae_reply
		trigger = {
			OR = {
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = influence
				value >= 1000		
			}
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_design
				}
			 }
			 add_research_option = tech_precursor_design
			 add_tech_progress = {
				 tech = tech_precursor_design
				 progress = 0.20 
			 }
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_escort
				}
			 }
			 add_research_option = tech_precursor_escort
			 add_tech_progress = {
				 tech = tech_precursor_escort
				 progress = 0.20 
			 }
		}
		if = {
			limit = { has_technology = tech_precursor_escort }
			add_research_option = tech_precursor_escort_cost	
		}
	}

	after = {
		hidden_effect = {
			country_event = { id = sofe_gateway.12 days = 5 } # *THIS* looping check
		}
	}
}

#S-Choice - Xenophile
country_event = {
	id = sofe_gateway.1501
	title = "sofe_gateway.riddle_incorrect"
	desc = {
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}			
		}
		text = sofe_gateway.second_riddle_choice_wrong_xenophile_desc
	}
	desc = {
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}			
		}
		text = sofe_gateway.second_riddle_choice_wrong_xenophile_ae_desc
	}
	picture = GFX_evt_board_meeting
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = second_riddle_xenophile_selected
	}

	option = {
		name = sofe_gateway.riddle_negative_reply
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_design
				}
			 }
			 add_research_option = tech_precursor_design
			 add_tech_progress = {
				 tech = tech_precursor_design
				 progress = 0.20 
			 }
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_fe_assault_carrier
				}
			 }
			 add_research_option = tech_fe_assault_carrier
			 add_tech_progress = {
				 tech = tech_fe_assault_carrier
				 progress = 0.20
			 }
		}
		if = {
			limit = { has_technology = tech_fe_assault_carrier }
			add_research_option = tech_fe_assault_carrier_cost			
		}
	}

	option = {
		name = sofe_gateway.riddle_ae_refuse
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		add_resource = {
			society_research = 50000
			engineering_research = 50000
			physics_research = 50000
		}
	}

	option = {
		name = sofe_gateway.riddle_ae_reply
		trigger = {
			OR = {
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = influence
				value >= 1000		
			}
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_design
				}
			 }
			 add_research_option = tech_precursor_design
			 add_tech_progress = {
				 tech = tech_precursor_design
				 progress = 0.20 
			 }
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_fe_assault_carrier
				}
			 }
			 add_research_option = tech_fe_assault_carrier
			 add_tech_progress = {
				 tech = tech_fe_assault_carrier
				 progress = 0.20
			 }
		}
		if = {
			limit = { has_technology = tech_fe_assault_carrier }
			add_research_option = tech_fe_assault_carrier_cost			
		}
	}

	after = {
		hidden_effect = {
			country_event = { id = sofe_gateway.12 days = 5 } # *THIS* looping check
		}
	}
}

#S-Choice - Xenophobe
country_event = {
	id = sofe_gateway.1601
	title = "sofe_gateway.riddle_incorrect"
	desc = {
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}			
		}
		text = sofe_gateway.second_riddle_choice_wrong_xenophobe_desc
	}
	desc = {
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}			
		}
		text = sofe_gateway.second_riddle_choice_wrong_xenophobe_ae_desc
	}
	picture = GFX_evt_synth_sabotage
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = second_riddle_xenophobe_selected
	}

	option = {
		name = sofe_gateway.riddle_positive_reply
		trigger = {
			NOR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_design
				}
			 }
			 add_research_option = tech_precursor_design
			 add_tech_progress = {
				 tech = tech_precursor_design
				 progress = 0.20 
			 }
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_bc
				}
			 }
			 add_research_option = tech_precursor_bc
			 add_tech_progress = {
				 tech = tech_precursor_bc
				 progress = 0.20 
			 }
		}
		if = {
			limit = { has_technology = tech_precursor_bc }
			add_research_option = tech_precursor_bc_cost	
		}
	}

	option = {
		name = sofe_gateway.riddle_ae_refuse
		trigger = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		add_resource = {
			society_research = 50000
			engineering_research = 50000
			physics_research = 50000
		}
	}

	option = {
		name = sofe_gateway.riddle_ae_reply
		trigger = {
			OR = {
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = influence
				value >= 1000		
			}
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_design
				}
			 }
			 add_research_option = tech_precursor_design
			 add_tech_progress = {
				 tech = tech_precursor_design
				 progress = 0.20 
			 }
		}
		if = {
			limit = { 
				NOT = {
					has_technology = tech_precursor_bc
				}
			 }
			 add_research_option = tech_precursor_bc
			 add_tech_progress = {
				 tech = tech_precursor_bc
				 progress = 0.20 
			 }
		}
		if = {
			limit = { has_technology = tech_precursor_bc }
			add_research_option = tech_precursor_bc_cost	
		}
	}

	after = {
		hidden_effect = {
			country_event = { id = sofe_gateway.12 days = 5 } # *THIS* looping check
		}
	}
}

#S-Choice - Stellarite
country_event = {
	id = sofe_gateway.1701
	title = "sofe_gateway.riddle_incorrect"
	desc = sofe_gateway.second_riddle_choice_wrong_stellarite_desc
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = second_riddle_stellarite_selected
		set_country_flag = hear_stellarite
	}

	option = {
		name = sofe_gateway.riddle_positive_reply
		if = {
			limit = { NOT = { has_technology = tech_stellarite_reactor } }
			add_research_option = tech_stellarite_reactor
			add_tech_progress = {
				tech = tech_stellarite_reactor
				progress = 0.10	
			}
		}
		if = {
			limit = { has_technology = tech_stellarite_reactor }
			set_country_flag = stellarite_section_learned
			add_resource = {
				acot_sr_stellarite = 5000
			 }
			 if = {
				limit = { 
					NOT = {
						has_technology = tech_stellarite_generator_ae
					}
				 }
				 add_research_option = tech_stellarite_generator_ae
				 add_tech_progress = {
					 tech = tech_stellarite_generator_ae
					 progress = 0.10 
				 }
			}
		}
	}

	after = {
		hidden_effect = {
			country_event = { id = sofe_gateway.12 days = 5 } # *THIS* looping check
		}
	}
}

#S-Choice - Psionic
country_event = {
	id = sofe_gateway.1801
	title = "sofe_gateway.riddle_incorrect"
	desc = "sofe_gateway.second_riddle_choice_wrong_psionic_desc"
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		set_country_flag = second_riddle_psionic_selected
	}

	option = {
		name = sofe_gateway.riddle_positive_reply
		add_research_option = tech_psionic_archon
		if = {
			limit = {
				NOT = { 
					has_technology = tech_psionic_theory
				}
			 }
			give_technology = {
				tech = tech_psionic_theory
			}
		}
	}

	after = {
		hidden_effect = {
			country_event = { id = sofe_gateway.12 days = 5 } # *THIS* looping check
		}
	}
}

###################PROMPT FOR FINAK SEAL

country_event = {
	id = sofe_gateway.20
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				any_owned_megastructure = {
					is_megastructure_type = sofe_outer_gate
				}
			}
			random_owned_megastructure = {
				limit = {
					is_megastructure_type = sofe_outer_gate
				}
				save_event_target_as = candidate_outergateway
			}
			country_event = { id = sofe_gateway.200 } # enable project
		}
		else = {
			country_event = { id = sofe_gateway.20 days = 60 } # *THIS* looping check
		}
	}
}

# True Analysis Project available
country_event = {
	id = sofe_gateway.200
	title = "sofe_gateway.200.name"
	desc = sofe_gateway.200.desc
	picture = GFX_evt_sofe_outergate
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		event_target:candidate_outergateway = {
			solar_system = { 
				save_event_target_as = candidate_outergateway_system 
			}
		}
	}

	option = {
		name = "sofe_gateway.200.a"
		event_target:candidate_outergateway = {
			enable_special_project = {
				name = OUTER_GATE_FINAL_SEAL
				location = this
			}
		}
	}
}

##############CRISIS READY###############
country_event = {
	id = sofe_gateway.201
	title = "sofe_gateway.201.name"
	desc = "sofe_gateway.201.desc"
	picture = GFX_evt_alien_propaganda
	show_sound = event_mystic_reveal
	location = event_target:candidate_outergateway

	is_triggered_only = yes

	immediate = {
		#set_country_flag = outercluster_opener
		country_event = { id = sofe_setup.1 days = 3 }	
	}

	option = {
		name = "sofe_gateway.201.a"
		trigger = {
			NOT = {
				is_country_type = eternal_empire			
			}
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = sofe_outergate_chain
				counter = seals_broken
				amount = 1
			}		
		}
	}

	option = {
		name = "sofe_gateway.201.eternal"
		trigger = {
			is_country_type = eternal_empire
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = sofe_outergate_chain
				counter = seals_broken
				amount = 1
			}		
		}
	}
}