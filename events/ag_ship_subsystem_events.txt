namespace = ag_subsystem

###########################################################################
# New Subsystem: (7) Create Subsystem's extra requirements and events.
###########################################################################

# Emergency Repair System
# Attached
ship_event = {
	id = ag_subsystem.11
	hide_window = yes
	is_triggered_only = yes
	trigger = { NOR = { has_ship_flag = ag_emergency_repair_system_locked has_ship_flag = ag_emergency_repair_system } }
	immediate = {
		set_ship_flag = ag_emergency_repair_system
		if = {
			limit = { NOT = { has_ship_flag = ag_set_disable_at_health } }
			ag_set_disable_at_health = { ag_value = 0.10 }
		}
		else = { ag_increase_disable_level = yes }
	}
}
# on_disabled
ship_event = {
	id = ag_subsystem.12
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_ship_flag = ag_emergency_repair_system
		NOT = { has_ship_flag = ag_gamma_station_protection_enabled }
	}
	immediate = {
		repair_ship = yes
		repair_percentage = 1.0
		remove_ship_flag = ag_emergency_repair_system
		remove_modifier = "ag_emergency_repair_system_power"
		add_modifier = { modifier = "ag_emergency_repair_system_power" days = 30 }
		ag_spawn_buff_effect = { ag_color = red ag_scale = xl }
		ship_event = { id = ag_subsystem.13 days = 30 }
		ship_event = { id = ag_subsystem.11 days = 180 }
		owner = { country_event = { id = ag_subsystem.15 } }
		ag_subtract_disable_level = yes
		set_disabled = no
	}
}
ship_event = {
	id = ag_subsystem.13
	hide_window = yes
	is_triggered_only = yes
	trigger = { exists = this }
	immediate = {
		remove_modifier = "ag_emergency_repair_system_cooldown"
		add_modifier = { modifier = "ag_emergency_repair_system_cooldown" days = 150 }
	}
}
# Removed
ship_event = {
	id = ag_subsystem.14
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		ag_subtract_disable_level = yes
		remove_ship_flag = ag_emergency_repair_system
		set_timed_ship_flag = { flag = ag_emergency_repair_system_locked days = 180 }
	}
}
country_event = {
	id = ag_subsystem.15
	title = "ag_subsystem.15.name"
	desc = "ag_subsystem.15.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_yellow_alert
	location = from
	is_triggered_only = yes
	option = { name = "ag_subsystem.15.a" }
}

# Structural Protection System
# on_ship_destroyed_victim
country_event = {
	id = ag_subsystem.21
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		OR = {
			has_country_flag = ag_ship_subsystem_enabled_301_2
			has_country_flag = ag_ship_subsystem_enabled_304_2
			has_country_flag = ag_ship_subsystem_enabled_401_2
			has_country_flag = ag_ship_subsystem_enabled_501_2
			has_country_flag = ag_ship_subsystem_enabled_701_2
			has_country_flag = ag_ship_subsystem_enabled_2501_2
			has_country_flag = ag_ship_subsystem_enabled_2601_2
			has_country_flag = ag_ship_subsystem_enabled_201_9
		}
	}
	immediate = {
		if = {
			limit = { has_country_flag = ag_ship_subsystem_enabled_301_2 fromfrom = { has_ship_flag = ag_gamma_station_player } }
			create_ambient_object = { type = ag_player_gamma_station_debris_object }
			last_created_ambient_object = {
				set_location = { target = fromfrom distance = -1 angle = 0 }
				set_ambient_object_flag = ag_player_gamma_station_debris_object
				enable_special_project = { name = ag_structural_protection_system_301 location = this owner = root }
			}
		}
		else_if = {
			limit = { has_country_flag = ag_ship_subsystem_enabled_304_2 fromfrom = { has_ship_flag = ag_gamma_titan_player } }
			create_ambient_object = { type = ag_player_gamma_titan_debris_object }
			last_created_ambient_object = {
				set_location = { target = fromfrom distance = -1 angle = 0 }
				set_ambient_object_flag = ag_player_gamma_titan_debris_object
				enable_special_project = { name = ag_structural_protection_system_304 location = this owner = root }
			}
		}
		else_if = {
			limit = { has_country_flag = ag_ship_subsystem_enabled_401_2 fromfrom = { has_ship_flag = ag_delta_titan_player } }
			create_ambient_object = { type = ag_player_delta_titan_debris_object }
			last_created_ambient_object = {
				set_location = { target = fromfrom distance = -1 angle = 0 }
				set_ambient_object_flag = ag_player_delta_titan_debris_object
				enable_special_project = { name = ag_structural_protection_system_401 location = this owner = root }
			}
		}
		else_if = {
			limit = { has_country_flag = ag_ship_subsystem_enabled_501_2 fromfrom = { has_ship_flag = ag_epsilon_titan_player } }
			create_ambient_object = { type = ag_player_epsilon_titan_debris_object }
			last_created_ambient_object = {
				set_location = { target = fromfrom distance = -1 angle = 0 }
				set_ambient_object_flag = ag_player_epsilon_titan_debris_object
				enable_special_project = { name = ag_structural_protection_system_501 location = this owner = root }
			}
		}
		else_if = {
			limit = { has_country_flag = ag_ship_subsystem_enabled_701_2 fromfrom = { has_ship_flag = ag_zeta_titan_player } }
			create_ambient_object = { type = ag_player_zeta_titan_debris_object }
			last_created_ambient_object = {
				set_location = { target = fromfrom distance = -1 angle = 0 }
				set_ambient_object_flag = ag_player_zeta_titan_debris_object
				enable_special_project = { name = ag_structural_protection_system_701 location = this owner = root }
			}
		}
		else_if = {
			limit = { has_country_flag = ag_ship_subsystem_enabled_2501_2 fromfrom = { has_ship_flag = ag_lost_ancient_ship } }
			create_ambient_object = { type = ag_player_starlight_2_debris_object }
			last_created_ambient_object = {
				set_location = { target = fromfrom distance = -1 angle = 0 }
				set_ambient_object_flag = ag_player_starlight_2_debris_object
				enable_special_project = { name = ag_structural_protection_system_2501 location = this owner = root }
			}
			set_country_flag = ag_lost_ancient_ship_locked
		}
		else_if = {
			limit = { has_country_flag = ag_ship_subsystem_enabled_2601_2 fromfrom = { has_ship_flag = ag_ancient_wandering_ship_player } }
			create_ambient_object = { type = ag_player_wandering_ship_debris_object }
			last_created_ambient_object = {
				set_location = { target = fromfrom distance = -1 angle = 0 }
				set_ambient_object_flag = ag_player_wandering_ship_debris_object
				enable_special_project = { name = ag_structural_protection_system_2601 location = this owner = root }
			}
		}
		else_if = {
			limit = {
				has_country_flag = ag_ship_subsystem_enabled_201_9
				fromfrom = { OR = { is_ship_size = ag_beta_station_type1_0 is_ship_size = ag_beta_station_type1_1 } }
			}
			random_list = { 25 = { } 75 = { change_variable = { which = ag_num_beta_station_type1_cores value = 1 } } }
		}
	}
}
# Gamma Station
ship_event = {
	id = ag_subsystem.22
	title = "ag_subsystem.22.name"
	desc = "ag_subsystem.22.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_dyson_sphere_build_complete
	location = root
	is_triggered_only = yes
	
	option = {
		name = "ag_subsystem.22.a"
		hidden_effect = {
			solar_system = {
				random_system_ambient_object = {
					limit = { has_ambient_object_flag = ag_player_gamma_station_debris_object }
					save_event_target_as = ag_ship_spawn_loc
				}
			}
			owner = {
				if = {
					limit = { has_country_flag = ag_gamma_ships_unlocked }
					ag_gamma_station_player_spawn = {
						ag_unlock_ship = yes
						ag_owner = root.owner
						ag_location_target = event_target:ag_ship_spawn_loc
					}
				}
				else = {
					ag_gamma_station_player_spawn = {
						ag_unlock_ship = no
						ag_owner = root.owner
						ag_location_target = event_target:ag_ship_spawn_loc
					}
				}
			}
			event_target:ag_ship_spawn_loc = { destroy_ambient_object = this }
		}
	}
}
# Delta Titan
ship_event = {
	id = ag_subsystem.23
	title = "ag_subsystem.23.name"
	desc = "ag_subsystem.23.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_dyson_sphere_build_complete
	location = root
	is_triggered_only = yes
	
	option = {
		name = "ag_subsystem.23.a"
		hidden_effect = {
			solar_system = {
				random_system_ambient_object = {
					limit = { has_ambient_object_flag = ag_player_delta_titan_debris_object }
					save_event_target_as = ag_ship_spawn_loc
				}
			}
			owner = {
				if = {
					limit = { has_country_flag = ag_delta_ships_unlocked }
					ag_delta_titan_player_spawn = {
						ag_unlock_ship = yes
						ag_owner = root.owner
						ag_location_target = event_target:ag_ship_spawn_loc
					}
				}
				else = {
					ag_delta_titan_player_spawn = {
						ag_unlock_ship = no
						ag_owner = root.owner
						ag_location_target = event_target:ag_ship_spawn_loc
					}
				}
			}
			event_target:ag_ship_spawn_loc = { destroy_ambient_object = this }
		}
	}
}
# Epsilon Titan
ship_event = {
	id = ag_subsystem.24
	title = "ag_subsystem.24.name"
	desc = "ag_subsystem.24.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_dyson_sphere_build_complete
	location = root
	is_triggered_only = yes
	
	option = {
		name = "ag_subsystem.24.a"
		hidden_effect = {
			solar_system = {
				random_system_ambient_object = {
					limit = { has_ambient_object_flag = ag_player_epsilon_titan_debris_object }
					save_event_target_as = ag_ship_spawn_loc
				}
			}
			owner = {
				if = {
					limit = { has_country_flag = ag_epsilon_ships_unlocked }
					ag_epsilon_titan_player_spawn = {
						ag_unlock_ship = yes
						ag_owner = root.owner
						ag_location_target = event_target:ag_ship_spawn_loc
					}
				}
				else = {
					ag_epsilon_titan_player_spawn = {
						ag_unlock_ship = no
						ag_owner = root.owner
						ag_location_target = event_target:ag_ship_spawn_loc
					}
				}
			}
			event_target:ag_ship_spawn_loc = { destroy_ambient_object = this }
		}
	}
}
# Zeta Titan
ship_event = {
	id = ag_subsystem.25
	title = "ag_subsystem.25.name"
	desc = "ag_subsystem.25.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_dyson_sphere_build_complete
	location = root
	is_triggered_only = yes
	
	option = {
		name = "ag_subsystem.25.a"
		hidden_effect = {
			solar_system = {
				random_system_ambient_object = {
					limit = { has_ambient_object_flag = ag_player_zeta_titan_debris_object }
					save_event_target_as = ag_ship_spawn_loc
				}
			}
			owner = {
				create_fleet = {
					name = "NAME_ag_zeta_guardian_fleet"
					settings = { spawn_debris = no }
					effect = {
						set_fleet_flag = ag_has_ancient_ship_in_fleet
						set_owner = root.owner
						create_ship = {
							name = "NAME_ag_zeta_titan_ship"
							design = "NAME_ag_zeta_titan"
							prefix = no
							effect = {
								set_ship_flag = ag_zeta_titan_player
								ag_difficulty_bonus = yes
							}
						}
						set_location = {
							target = event_target:ag_ship_spawn_loc
							distance = 0
							angle = random 
						}
					}
				}
				# if = {
				# 	limit = { has_country_flag = ag_zeta_ships_unlocked }
				# 	ag_zeta_titan_player_spawn = {
				# 		ag_unlock_ship = yes
				# 		ag_owner = root.owner
				# 		ag_location_target = event_target:ag_ship_spawn_loc
				# 	}
				# }
				# else = {
				# 	ag_zeta_titan_player_spawn = {
				# 		ag_unlock_ship = no
				# 		ag_owner = root.owner
				# 		ag_location_target = event_target:ag_ship_spawn_loc
				# 	}
				# }
			}
			event_target:ag_ship_spawn_loc = { destroy_ambient_object = this }
		}
	}
}
# Starlight II
ship_event = {
	id = ag_subsystem.26
	title = "ag_subsystem.26.name"
	desc = "ag_subsystem.26.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_dyson_sphere_build_complete
	location = root
	is_triggered_only = yes
	
	option = {
		name = "ag_subsystem.26.a"
		hidden_effect = {
			solar_system = {
				random_system_ambient_object = {
					limit = { has_ambient_object_flag = ag_player_starlight_2_debris_object }
					save_event_target_as = ag_ship_spawn_loc
				}
			}
			owner = {
				if = {
					limit = { has_country_flag = ag_lost_ancient_ship_science_ship_form_active }
					ag_spawn_lost_ancient_ship_via_tech = { ag_is_battleship = no ag_location_target = event_target:ag_ship_spawn_loc }
				}
				else = { ag_spawn_lost_ancient_ship_via_tech = { ag_is_battleship = yes ag_location_target = event_target:ag_ship_spawn_loc } }
				remove_country_flag = ag_lost_ancient_ship_locked
			}
			event_target:ag_ship_spawn_loc = { destroy_ambient_object = this }
		}
	}
}
# Wandering Ship
ship_event = {
	id = ag_subsystem.27
	title = "ag_subsystem.27.name"
	desc = "ag_subsystem.27.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_dyson_sphere_build_complete
	location = root
	is_triggered_only = yes
	
	option = {
		name = "ag_subsystem.27.a"
		hidden_effect = {
			solar_system = {
				random_system_ambient_object = {
					limit = { has_ambient_object_flag = ag_player_wandering_ship_debris_object }
					save_event_target_as = ag_ship_spawn_loc
				}
			}
			owner = {
				if = {
					limit = { has_country_flag = ag_delta_ships_unlocked }
					ag_ancient_wandering_ship_player_spawn = {
						ag_unlock_ship = yes
						ag_owner = root.owner
						ag_location_target = event_target:ag_ship_spawn_loc
					}
				}
				else = {
					ag_ancient_wandering_ship_player_spawn = {
						ag_unlock_ship = no
						ag_owner = root.owner
						ag_location_target = event_target:ag_ship_spawn_loc
					}
				}
			}
			event_target:ag_ship_spawn_loc = { destroy_ambient_object = this }
		}
	}
}
# Gamma Titan
ship_event = {
	id = ag_subsystem.28
	title = "ag_subsystem.28.name"
	desc = "ag_subsystem.28.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_dyson_sphere_build_complete
	location = root
	is_triggered_only = yes
	
	option = {
		name = "ag_subsystem.28.a"
		hidden_effect = {
			solar_system = {
				random_system_ambient_object = {
					limit = { has_ambient_object_flag = ag_player_gamma_titan_debris_object }
					save_event_target_as = ag_ship_spawn_loc
				}
			}
			owner = {
				if = {
					limit = { has_country_flag = ag_gamma_ships_unlocked }
					ag_gamma_titan_player_spawn = {
						ag_unlock_ship = yes
						ag_owner = root.owner
						ag_location_target = event_target:ag_ship_spawn_loc
					}
				}
				else = {
					ag_gamma_titan_player_spawn = {
						ag_unlock_ship = no
						ag_owner = root.owner
						ag_location_target = event_target:ag_ship_spawn_loc
					}
				}
			}
			event_target:ag_ship_spawn_loc = { destroy_ambient_object = this }
		}
	}
}

# Gravity Weapon System
country_event = {
	id = ag_subsystem.31
	hide_window = yes
	is_triggered_only = yes
	trigger = { ag_country_has_subsystem = { ag_subsystem_id = 3 } }
	immediate = {
		fromfrom = {
			every_owned_ship = {
				limit = { ag_ship_has_subsystem = { ag_owner = root ag_subsystem_id = 3 } }
				root.fromfromfrom = {
					every_owned_ship = {
						random_list = {
							181 = { modifier = { factor = 4 has_ship_flag = ag_subsystem_31_target } }
							# 211 Totally, 181 Available
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_1_1" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_1_2" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_1_3" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_2_1" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_2_2" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_2_3" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_3_1" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_3_2" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_3_3" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_4_1" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_4_2" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_4_3" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_5_1" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_5_2" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = { add_modifier = { modifier = "ag_ancient_gravity_weapon_effect_5_3" days = @ag_ancient_gravity_weapon_unlocked_effect_days } set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 } }
							10 = {
								modifier = {
									factor = 0
									OR = {
										ag_is_ancient_ship = yes
										ag_is_zeta_crisis_ship = yes
										has_hp <= 4000
									}
								}
								ag_reduce_hp_percent = { ag_value = 6 }
								set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 }
							}
							10 = {
								modifier = {
									factor = 0
									OR = {
										ag_is_ancient_ship = yes
										ag_is_zeta_crisis_ship = yes
										has_hp <= 4000
									}
								}
								reduce_hp_percent = 4
								set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 }
							}
							10 = {
								modifier = {
									factor = 0
									OR = {
										ag_is_ancient_ship = yes
										ag_is_zeta_crisis_ship = yes
										has_hp <= 4000
									}
								}
								ag_reduce_hp_percent = { ag_value = 2 }
								set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 }
							}
							10 = {
								modifier = {
									factor = 0
									OR = {
										ag_is_ancient_ship = yes
										ag_is_zeta_crisis_ship = yes
										has_hp > 4000
									}
								}
								reduce_hp = 100.0
								set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 }
							}
							10 = {
								modifier = {
									factor = 0
									OR = {
										ag_is_ancient_ship = yes
										ag_is_zeta_crisis_ship = yes
										has_hp > 4000
									}
								}
								reduce_hp = 80.0
								set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 }
							}
							10 = {
								modifier = {
									factor = 0
									OR = {
										ag_is_ancient_ship = yes
										ag_is_zeta_crisis_ship = yes
										has_hp > 4000
									}
								}
								reduce_hp = 60.0
								set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 }
							}
							1 = {
								modifier = { factor = 1.13 has_hp > 1000000 }
								modifier = { factor = 1.13 has_hp > 2000000 }
								modifier = { factor = 1.13 has_hp > 5000000 }
								modifier = { factor = 1.13 has_hp > 10000000 }
								modifier = { factor = 1.13 has_hp > 20000000 }
								modifier = { factor = 1.13 has_hp > 50000000 }
								modifier = { factor = 1.67 has_hp > 100000000 }
								modifier = { factor = 1.67 has_hp > 200000000 }
								modifier = { factor = 1.75 has_hp > 500000000 }
								modifier = {
									factor = 0
									OR = {
										ag_is_ancient_ship = yes
										ag_is_zeta_crisis_ship = yes
										owner = { is_same_value = event_target:ag_ancient_zeta_guardian_country }
									}
								}
								ag_spawn_buff_effect = { ag_color = red ag_scale = m }
								random_list = {
									20 = { remove_modifier = "ag_weapon_inhibition_modifier" add_modifier = { modifier = "ag_weapon_inhibition_modifier" days = 5 } }
									20 = { remove_modifier = "ag_weapon_inhibition_modifier" add_modifier = { modifier = "ag_weapon_inhibition_modifier" days = 10 } }
									20 = { remove_modifier = "ag_weapon_inhibition_modifier" add_modifier = { modifier = "ag_weapon_inhibition_modifier" days = 15 } }
									20 = { remove_modifier = "ag_weapon_inhibition_modifier" add_modifier = { modifier = "ag_weapon_inhibition_modifier" days = 20 } }
									20 = { remove_modifier = "ag_weapon_inhibition_modifier" add_modifier = { modifier = "ag_weapon_inhibition_modifier" days = 25 } }
								}
								set_timed_ship_flag = { flag = ag_subsystem_31_target days = 5 }
								# destroy_ship = this
								# owner = { change_variable = { which = ag_ships_killed_counter_ancients value = 1 } }
							}
						}
					}
				}
			}
		}
	}
}

# Psionic Weapon System
country_event = {
	id = ag_subsystem.32
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		OR = {
			AND = {
				has_country_flag = ag_ship_subsystem_enabled_201_21
				fromfrom = { OR = { is_ship_size = ag_beta_station_type1_0 is_ship_size = ag_beta_station_type1_1 } }
			}
			AND = {
				has_country_flag = ag_ship_subsystem_enabled_701_21
				fromfrom = { is_ship_size = ag_zeta_titan_psi }
			}
			AND = {
				has_country_flag = ag_ship_subsystem_enabled_702_21
				fromfrom = { is_ship_size = ag_zeta_battleship_psi }
			}
			AND = {
				has_country_flag = ag_ship_subsystem_enabled_703_21
				fromfrom = { is_ship_size = ag_zeta_destroyer_psi }
			}
		}
	}
	immediate = {
		fromfrom = {
			if = {
				limit = { has_hp_percentage < 1.0 }
				random_list = { 20 = { repair_ship = yes } 80 = { } }
			}
			else = {
				solar_system = {
					every_fleet_in_system = {
						limit = { exists = owner owner = { is_same_value = root } }
						add_modifier = { modifier = "ag_ancient_psionic_weapon_friendly_buff" days = 10 }
					}
				}
			}
			random_list = {
				80 = { add_modifier = { modifier = "ag_ancient_psionic_weapon_kill_effect" days = 20 } }
				20 = { }
			}
		}
		fromfromfrom = {
			if = {
				limit = {
					exists = fleet
					root.from = {
						NOR = {
							is_country_type = ag_zeta_crisis_country
							is_country_type = ag_zeta_crisis_portal_holder
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
							is_country_type = portal_holder
							is_country_type = shroud
							is_country_type = shroud_spirits
						}
					}
				}
				fleet = {
					ag_spawn_buff_effect = { ag_scale = xl ag_color = violet }
					every_owned_ship = {
						limit = {
							NOR = {
								is_same_value = root.fromfromfrom
								is_disabled = no
								has_hp > 0
							}
							OR = {
								is_ship_class = shipclass_military
								is_ship_class = shipclass_military_station
								is_ship_class = shipclass_starbase
							}
						}
						random_list = {
							800 = { }
							#总共200
							10 = {
								modifier = {
									factor = 0
									ag_is_special_ship = yes
								}
								reduce_hp_percent = 25
							}
							10 = {
								modifier = {
									factor = 0
									ag_is_special_ship = yes
								}
								reduce_hp_percent = 24
							}
							10 = {
								modifier = {
									factor = 0
									ag_is_special_ship = yes
								}
								reduce_hp_percent = 23
							}
							10 = {
								modifier = {
									factor = 0
									ag_is_special_ship = yes
								}
								reduce_hp_percent = 22
							}
							10 = {
								modifier = {
									factor = 0
									ag_is_special_ship = yes
								}
								reduce_hp_percent = 21
							}
							10 = {
								modifier = {
									factor = 0
									ag_is_special_ship = yes
								}
								reduce_hp_percent = 20
							}
							10 = {
								modifier = {
									factor = 0
									ag_is_special_ship = yes
								}
								reduce_hp = 1100
							}
							10 = {
								modifier = {
									factor = 0
									ag_is_special_ship = yes
								}
								reduce_hp = 1000
							}
							10 = {
								modifier = {
									factor = 0
									ag_is_special_ship = yes
								}
								reduce_hp = 900
							}
							10 = {
								modifier = {
									factor = 0
									ag_is_special_ship = yes
								}
								reduce_hp = 800
							}
							10 = {
								modifier = {
									factor = 0
									ag_is_special_ship = yes
								}
								reduce_hp = 700
							}
							10 = {
								modifier = {
									factor = 0
									ag_is_special_ship = yes
								}
								reduce_hp = 600
							}
							10 = {
								add_modifier = {
									modifier = "ag_ancient_psionic_weapon_effect_1_1"
									days = @ag_ancient_psionic_weapon_effect_days
								}
							}
							10 = {
								add_modifier = {
									modifier = "ag_ancient_psionic_weapon_effect_1_2"
									days = @ag_ancient_psionic_weapon_effect_days
								}
							}
							10 = {
								add_modifier = {
									modifier = "ag_ancient_psionic_weapon_effect_1_3"
									days = @ag_ancient_psionic_weapon_effect_days
								}
							}
							10 = {
								add_modifier = {
									modifier = "ag_ancient_psionic_weapon_effect_1_4"
									days = @ag_ancient_psionic_weapon_effect_days
								}
							}
							10 = {
								add_modifier = {
									modifier = "ag_ancient_psionic_weapon_effect_2_1"
									days = @ag_ancient_psionic_weapon_effect_days
								}
							}
							10 = {
								add_modifier = {
									modifier = "ag_ancient_psionic_weapon_effect_2_2"
									days = @ag_ancient_psionic_weapon_effect_days
								}
							}
							10 = {
								add_modifier = {
									modifier = "ag_ancient_psionic_weapon_effect_2_3"
									days = @ag_ancient_psionic_weapon_effect_days
								}
							}
							10 = {
								add_modifier = {
									modifier = "ag_ancient_psionic_weapon_effect_2_4"
									days = @ag_ancient_psionic_weapon_effect_days
								}
							}
						}
					}
				}
			}
		}
	}
}

# Anti Psionic Weapon System
country_event = {
	id = ag_subsystem.33
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		OR = {
			has_country_flag = ag_ship_subsystem_enabled_701_23
			has_country_flag = ag_ship_subsystem_enabled_702_23
			has_country_flag = ag_ship_subsystem_enabled_703_23
		}
	}
	immediate = {
		if = {
			limit = { from = { OR = {
				is_country_type = ag_zeta_crisis_country
				is_country_type = ag_zeta_crisis_portal_holder
				is_country_type = ag_zeta_crisis_relic_country
			} } }
			fromfromfrom = {
				remove_ship_flag = ag_sub_23_debuffed
				set_timed_ship_flag = { flag = ag_sub_23_debuffed days = 20 }
				solar_system = {
					every_fleet_in_system = {
						limit = { has_fleet_flag = ag_zeta_crisis_avatar_fleet }
						random_list = {
							50 = { }
							30 = {
								ag_spawn_buff_effect = { ag_scale = m ag_color = violet }
								set_timed_ship_flag = { flag = ag_ship_weapon_range_mult_locked days = 10 }
								add_modifier = { modifier = ag_ship_weapon_range_mult_buff multiplier = -5 days = 10 }
							}
							20 = {
								ag_spawn_buff_effect = { ag_scale = m ag_color = violet }
								delete_fleet = this
							}
						}
					}
				}
			}
		}
		fromfrom = {
			every_owned_ship = {
				limit = {
					OR = {
						AND = {
							owner = { has_country_flag = ag_ship_subsystem_enabled_701_23 }
							is_ship_size = ag_zeta_titan
							NOT = { has_ship_flag = ag_zeta_ship_gravity_weapon }
						}
						AND = {
							owner = { has_country_flag = ag_ship_subsystem_enabled_702_23 }
							is_ship_size = ag_zeta_battleship
							NOT = { has_ship_flag = ag_zeta_ship_gravity_weapon }
						}
						AND = {
							owner = { has_country_flag = ag_ship_subsystem_enabled_703_23 }
							is_ship_size = ag_zeta_destroyer
							NOT = { has_ship_flag = ag_zeta_ship_gravity_weapon }
						}
					}
				}
				root.fromfromfrom = {
					every_owned_ship = {
						limit = {
							OR = {
								is_ship_class = shipclass_military
								is_ship_class = shipclass_military_station
								is_ship_class = shipclass_starbase
							}
						}
						random_list = {
							120 = { modifier = { factor = 3 has_ship_flag = ag_subsystem_33_target } }
							# 120 Totally
							10 = { add_modifier = { modifier = "ag_ancient_anti_psi_weapon_effect_1_1" days = @ag_ancient_anti_psi_weapon_effect_days } set_timed_ship_flag = { flag = ag_subsystem_33_target days = 2 } }
							10 = { add_modifier = { modifier = "ag_ancient_anti_psi_weapon_effect_1_2" days = @ag_ancient_anti_psi_weapon_effect_days } set_timed_ship_flag = { flag = ag_subsystem_33_target days = 2 } }
							10 = { add_modifier = { modifier = "ag_ancient_anti_psi_weapon_effect_1_3" days = @ag_ancient_anti_psi_weapon_effect_days } set_timed_ship_flag = { flag = ag_subsystem_33_target days = 2 } }
							10 = { add_modifier = { modifier = "ag_ancient_anti_psi_weapon_effect_2_1" days = @ag_ancient_anti_psi_weapon_effect_days } set_timed_ship_flag = { flag = ag_subsystem_33_target days = 2 } }
							10 = { add_modifier = { modifier = "ag_ancient_anti_psi_weapon_effect_2_2" days = @ag_ancient_anti_psi_weapon_effect_days } set_timed_ship_flag = { flag = ag_subsystem_33_target days = 2 } }
							10 = { add_modifier = { modifier = "ag_ancient_anti_psi_weapon_effect_2_3" days = @ag_ancient_anti_psi_weapon_effect_days } set_timed_ship_flag = { flag = ag_subsystem_33_target days = 2 } }
							10 = { add_modifier = { modifier = "ag_ancient_anti_psi_weapon_effect_3_1" days = @ag_ancient_anti_psi_weapon_effect_days } set_timed_ship_flag = { flag = ag_subsystem_33_target days = 2 } }
							10 = { add_modifier = { modifier = "ag_ancient_anti_psi_weapon_effect_3_2" days = @ag_ancient_anti_psi_weapon_effect_days } set_timed_ship_flag = { flag = ag_subsystem_33_target days = 2 } }
							10 = { add_modifier = { modifier = "ag_ancient_anti_psi_weapon_effect_3_3" days = @ag_ancient_anti_psi_weapon_effect_days } set_timed_ship_flag = { flag = ag_subsystem_33_target days = 2 } }
							10 = { add_modifier = { modifier = "ag_ancient_anti_psi_weapon_effect_4_1" days = @ag_ancient_anti_psi_weapon_effect_days } set_timed_ship_flag = { flag = ag_subsystem_33_target days = 2 } }
							10 = { add_modifier = { modifier = "ag_ancient_anti_psi_weapon_effect_4_2" days = @ag_ancient_anti_psi_weapon_effect_days } set_timed_ship_flag = { flag = ag_subsystem_33_target days = 2 } }
							10 = { add_modifier = { modifier = "ag_ancient_anti_psi_weapon_effect_4_3" days = @ag_ancient_anti_psi_weapon_effect_days } set_timed_ship_flag = { flag = ag_subsystem_33_target days = 2 } }
						}
					}
				}
			}
		}
	}
}

# Gamma Station Drones Spawn
country_event = {
	id = ag_subsystem.34
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		OR = {
			is_country_type = ag_ancient_gamma_guardian
			has_country_flag = ag_ship_subsystem_enabled_301_11
		}
		from = { NOT = { is_country_type = ag_zeta_crisis_country } }
		fromfrom = {
			OR = {
				has_fleet_flag = ag_gamma_station_hostile_fleet
				has_fleet_flag = ag_gamma_station_small_hostile_fleet
				has_fleet_flag = ag_gamma_station_player
			}
		}
	}
	immediate = {
		if = {
			limit = { is_country_type = ag_ancient_gamma_guardian }
			ag_gamma_station_drones_spawn = { ag_owner = root ag_location = fromfromfrom ag_drones_max = 6 }
		}
		else = { ag_gamma_station_drones_spawn = { ag_owner = root ag_location = fromfromfrom ag_drones_max = 4 } }
	}
}
fleet_event = {
	id = ag_subsystem.35
	hide_window = yes
	is_triggered_only = yes
	trigger = { exists = this }
	immediate = { delete_fleet = { target = this destroy_template = yes } }
}

# Leader Killer / Protector
country_event = {
	id = ag_subsystem.41
	hide_window = yes
	is_triggered_only = yes
	trigger = { ag_country_has_subsystem = { ag_subsystem_id = 4 } fromfromfrom = { exists = leader } }
	immediate = {
		if = {
			limit = { fromfrom = { any_owned_ship = { ag_ship_has_subsystem = { ag_owner = root ag_subsystem_id = 4 } } } }
			random_list = {
				95 = { }
				5 = {
					modifier = { factor = 0.84 fromfromfrom = { leader = { has_skill > 1 } } }
					modifier = { factor = 0.84 fromfromfrom = { leader = { has_skill > 2 } } }
					modifier = { factor = 0.84 fromfromfrom = { leader = { has_skill > 3 } } }
					modifier = { factor = 0.84 fromfromfrom = { leader = { has_skill > 4 } } }
					modifier = { factor = 0.84 fromfromfrom = { leader = { has_skill > 5 } } }
					modifier = { factor = 0.84 fromfromfrom = { leader = { has_skill > 6 } } }
					modifier = { factor = 0.84 fromfromfrom = { leader = { has_skill > 7 } } }
					modifier = { factor = 0.84 fromfromfrom = { leader = { has_skill > 8 } } }
					modifier = { factor = 0.84 fromfromfrom = { leader = { OR = { has_skill > 9 has_skill = 10 } } } }
					modifier = {
						factor = 0.5
						fromfromfrom.leader = {
							OR = {
								has_trait = leader_trait_cautious
								has_trait = leader_trait_foredoomed_to_a_rendezvous
								has_trait = leader_trait_dragonslayer
							}
						}
					}
					modifier = {
						factor = 0
						fromfromfrom.leader = {
							OR = {
								has_trait = leader_trait_admiral_chosen
								has_trait = leader_trait_great_khan
							}
						}
					}
					modifier = {
						factor = 0
						fromfromfrom = { any_owned_ship = { ag_ship_has_subsystem = { ag_owner = root.from ag_subsystem_id = 5 } } }
					}
					fromfromfrom = {
						ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
						leader = { save_event_target_as = ag_target_leader }
						root.from = {
							create_message = {
								type = "LEADER_DEATH"
								localization = "ag_leader_kill_by_ancients_message_desc"
								days = 30
								target = root.fromfromfrom
								variable = {
									type = name
									localization = "ag_target_fleet"
									scope = root.fromfromfrom
								}
								variable = {
									type = name
									localization = "ag_target_leader"
									scope = event_target:ag_target_leader
								}
							}
							# change_variable = {
							# 	which = ag_admirals_killed_counter_ancients
							# 	value = 1
							# }
						}
						if = {
							limit = { OR = {
								has_fleet_flag = ag_zeta_crisis_guardian_fleet
								has_fleet_flag = ag_zeta_crisis_assault_fleet
								has_fleet_flag = ag_zeta_crisis_patrol_fleet
								has_fleet_flag = ag_zeta_crisis_protector_fleet
							} }
							random_list = {
								20 = { }
								80 = {
									remove_fleet_flag = ag_zeta_crisis_leader
									remove_fleet_flag = ag_zeta_crisis_leader_1
									remove_fleet_flag = ag_zeta_crisis_leader_2
									remove_fleet_flag = ag_zeta_crisis_leader_3
									remove_fleet_flag = ag_zeta_crisis_leader_4
									remove_fleet_flag = ag_zeta_crisis_leader_5
									remove_fleet_flag = ag_zeta_crisis_leader_6
									remove_fleet_flag = ag_zeta_crisis_leader_7
									remove_fleet_flag = ag_zeta_crisis_leader_8
									remove_fleet_flag = ag_zeta_crisis_leader_9
									remove_fleet_flag = ag_zeta_crisis_leader_10
									remove_fleet_flag = ag_zeta_crisis_leader_11
									remove_fleet_flag = ag_zeta_crisis_leader_12
								}
							}
						}
					}
					event_target:ag_target_leader = {
						kill_leader = {
							type = admiral
							show_notification = no
						}
					}
				}
			}
		}
	}
}

# Auxiliary Energy System
country_event = {
	id = ag_subsystem.51
	hide_window = yes
	is_triggered_only = yes
	trigger = { ag_country_has_subsystem = { ag_subsystem_id = 6 } }
	immediate = {
		fromfrom = {
			every_owned_ship = {
				limit = { ag_ship_has_subsystem = { ag_owner = root ag_subsystem_id = 6 } }
				remove_modifier = "ag_auxiliary_power"
				add_modifier = { modifier = "ag_auxiliary_power" days = 5 }
			}
		}
	}
}

# Computing Network
country_event = {
	id = ag_subsystem.52
	hide_window = yes
	is_triggered_only = yes
	trigger = { ag_country_has_subsystem = { ag_subsystem_id = 7 } }
	immediate = {
		fromfrom = {
			if = {
				limit = {
					count_owned_ship = {
						limit = { ag_ship_has_subsystem = { ag_owner = root ag_subsystem_id = 7 } }
						count > 5
					}
				}
				every_owned_ship = {
					remove_modifier = "ag_computing_network_buff"
					add_modifier = { modifier = "ag_computing_network_buff" days = 5 }
				}
			}
		}
	}
}

# Recycle Station
country_event = {
	id = ag_subsystem.61
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_country_flag = ag_ship_subsystem_enabled_201_8
		from = { any_owned_ship = { OR = { is_ship_size = ag_beta_station_type1_0 is_ship_size = ag_beta_station_type1_1 } } }
	}
	immediate = { change_variable = { which = ag_num_beta_station_type1_cores value = 1 } }
}

# Titans' Abilities
country_event = {
	id = ag_subsystem.71
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		OR = {
			has_country_flag = ag_ship_subsystem_enabled_304_17
			has_country_flag = ag_ship_subsystem_enabled_401_16
			has_country_flag = ag_ship_subsystem_enabled_401_17
			has_country_flag = ag_ship_subsystem_enabled_501_19
			has_country_flag = ag_ship_subsystem_enabled_2601_28
			has_country_flag = ag_ship_subsystem_enabled_2601_29
		}
		from = { ag_is_mod_country = no }
	}
	immediate = {
		if = {
			limit = { has_country_flag = ag_ship_subsystem_enabled_304_17 fromfrom = { any_owned_ship = { has_ship_flag = ag_gamma_titan_player } } }
			fromfromfrom = {
				set_variable = { which = ag_num_ships_temp_1 value = 0 }
				# export_trigger_value_to_variable = { trigger = num_ships variable = ag_num_ships_temp_1 }
				every_owned_ship = { fromfrom = { change_variable = { which = ag_num_ships_temp_1 value = 1 } } }
			}
			fromfrom = {
				set_variable = { which = ag_num_ships_temp_2 value = 0 }
				# export_trigger_value_to_variable = { trigger = num_ships variable = ag_num_ships_temp_2 }
				every_owned_ship = { prev = { change_variable = { which = ag_num_ships_temp_2 value = 1 } } }
				set_variable = { which = ag_num_ships_temp_1 value = { variable = ag_num_ships_temp_1 scope = root.fromfromfrom } }
				if = {
					limit = { check_variable = { which = ag_num_ships_temp_2 value < ag_num_ships_temp_1 } }
					remove_modifier = "ag_delta_titan_support_system"
					add_modifier = { modifier = "ag_delta_titan_support_system" days = 8 }
				}
			}
			fromfromfrom = { clear_variable = ag_num_ships_temp_1 }
			fromfrom = { clear_variable = ag_num_ships_temp_1 clear_variable = ag_num_ships_temp_2 }
		}
		if = {
			limit = { fromfrom = { any_owned_ship = { has_ship_flag = ag_delta_titan_player } } }
			if = {
				limit = { has_country_flag = ag_ship_subsystem_enabled_401_16 }
				random_list = {
					50 = { }
					50 = {
						fromfromfrom = {
							set_timed_fleet_flag = { flag = ag_sub_16_flaged days = 5 }
							every_owned_ship = {
								set_variable = { which = ag_weapon_range_factor value = 0 }
								export_modifier_to_variable = { modifier = ship_weapon_range_mult variable = ag_weapon_range_factor }
								if = {
									limit = { check_variable = { which = ag_weapon_range_factor value > 0 } }
									add_modifier = { modifier = "ag_delta_titan_weapon_range_debuff" multiplier = ag_weapon_range_factor days = -1 }
									change_variable = { which = ag_delta_titan_weapon_range_debuff_levels value = 1 }
								}
								clear_variable = ag_weapon_range_factor
							}
							fleet_event = { id = ag_subsystem.72 days = 1 }
						}
					}
				}
			}
			else_if = {
				limit = { has_country_flag = ag_ship_subsystem_enabled_401_17 }
				fromfromfrom = {
					set_variable = { which = ag_num_ships_temp_1 value = 0 }
					# export_trigger_value_to_variable = { trigger = num_ships variable = ag_num_ships_temp_1 }
					every_owned_ship = { fromfrom = { change_variable = { which = ag_num_ships_temp_1 value = 1 } } }
				}
				fromfrom = {
					set_variable = { which = ag_num_ships_temp_2 value = 0 }
					# export_trigger_value_to_variable = { trigger = num_ships variable = ag_num_ships_temp_2 }
					every_owned_ship = { prev = { change_variable = { which = ag_num_ships_temp_2 value = 1 } } }
					set_variable = { which = ag_num_ships_temp_1 value = { variable = ag_num_ships_temp_1 scope = root.fromfromfrom } }
					if = {
						limit = { check_variable = { which = ag_num_ships_temp_2 value < ag_num_ships_temp_1 } }
						remove_modifier = "ag_delta_titan_support_system"
						add_modifier = { modifier = "ag_delta_titan_support_system" days = 8 }
					}
				}
				fromfromfrom = { clear_variable = ag_num_ships_temp_1 }
				fromfrom = { clear_variable = ag_num_ships_temp_1 clear_variable = ag_num_ships_temp_2 }
			}
		}
		if = {
			limit = { fromfrom = { any_owned_ship = { has_ship_flag = ag_ancient_wandering_ship_player } } }
			if = {
				limit = { has_country_flag = ag_ship_subsystem_enabled_2601_28 }
				set_variable = { which = ag_num_owned_anchor_stations value = 0 }
				every_megastructure = {
					limit = { is_megastructure_type = ag_ancient_anchor_station_2 }
					prev = { change_variable = { which = ag_num_owned_anchor_stations value = 1 } }
				}
				random_list = {
					90 = {
						modifier = { add = -10 check_variable = { which = ag_num_owned_anchor_stations value > 0 } }
						modifier = { add = -10 check_variable = { which = ag_num_owned_anchor_stations value > 1 } }
						modifier = { add = -10 check_variable = { which = ag_num_owned_anchor_stations value > 2 } }
						modifier = { add = -10 check_variable = { which = ag_num_owned_anchor_stations value > 3 } }
					}
					10 = {
						modifier = { add = 10 check_variable = { which = ag_num_owned_anchor_stations value > 0 } }
						modifier = { add = 10 check_variable = { which = ag_num_owned_anchor_stations value > 1 } }
						modifier = { add = 10 check_variable = { which = ag_num_owned_anchor_stations value > 2 } }
						modifier = { add = 10 check_variable = { which = ag_num_owned_anchor_stations value > 3 } }
						fromfromfrom = {
							set_timed_fleet_flag = { flag = ag_sub_28_flaged days = 5 }
							ag_spawn_explosion_effect = { ag_color = red ag_scale = xl }
							every_owned_ship = {
								set_variable = { which = ag_weapon_debuff_factor value = 0 }
								export_modifier_to_variable = { modifier = ship_weapon_damage variable = ag_weapon_debuff_factor }
								if = {
									limit = { check_variable = { which = ag_weapon_debuff_factor value > 0 } }
									add_modifier = { modifier = "ag_wandering_ship_weapon_damage_debuff" multiplier = ag_weapon_debuff_factor days = -1 }
									change_variable = { which = ag_wandering_ship_weapon_damage_debuff_levels value = 1 }
								}
								set_variable = { which = ag_weapon_debuff_factor value = 0 }
								export_modifier_to_variable = { modifier = ship_shield_damage_mult variable = ag_weapon_debuff_factor }
								if = {
									limit = { check_variable = { which = ag_weapon_debuff_factor value > 0 } }
									add_modifier = { modifier = "ag_wandering_ship_shield_damage_debuff" multiplier = ag_weapon_debuff_factor days = -1 }
									change_variable = { which = ag_wandering_ship_shield_damage_debuff_levels value = 1 }
								}
								set_variable = { which = ag_weapon_debuff_factor value = 0 }
								export_modifier_to_variable = { modifier = ship_armor_damage_mult variable = ag_weapon_debuff_factor }
								if = {
									limit = { check_variable = { which = ag_weapon_debuff_factor value > 0 } }
									add_modifier = { modifier = "ag_wandering_ship_armor_damage_debuff" multiplier = ag_weapon_debuff_factor days = -1 }
									change_variable = { which = ag_wandering_ship_armor_damage_debuff_levels value = 1 }
								}
								set_variable = { which = ag_weapon_debuff_factor value = 0 }
								export_modifier_to_variable = { modifier = ship_hull_damage_mult variable = ag_weapon_debuff_factor }
								if = {
									limit = { check_variable = { which = ag_weapon_debuff_factor value > 0 } }
									add_modifier = { modifier = "ag_wandering_ship_hull_damage_debuff" multiplier = ag_weapon_debuff_factor days = -1 }
									change_variable = { which = ag_wandering_ship_hull_damage_debuff_levels value = 1 }
								}
								clear_variable = ag_weapon_debuff_factor
							}
							fleet_event = { id = ag_subsystem.73 days = 1 }
						}
					}
				}
				clear_variable = ag_num_owned_anchor_stations
			}
			else_if = {
				limit = { has_country_flag = ag_ship_subsystem_enabled_2601_29 }
				fromfromfrom = {
					set_variable = { which = ag_num_ships_temp_1 value = 0 }
					# export_trigger_value_to_variable = { trigger = num_ships variable = ag_num_ships_temp_1 }
					every_owned_ship = { fromfrom = { change_variable = { which = ag_num_ships_temp_1 value = 1 } } }
				}
				fromfrom = {
					set_variable = { which = ag_num_ships_temp_2 value = 0 }
					# export_trigger_value_to_variable = { trigger = num_ships variable = ag_num_ships_temp_2 }
					every_owned_ship = { prev = { change_variable = { which = ag_num_ships_temp_2 value = 1 } } }
					if = {
						limit = { check_variable = { which = ag_num_ships_temp_2 value < { variable = ag_num_ships_temp_1 scope = root.fromfromfrom } } }
						remove_modifier = "ag_wandering_ship_weapon_range_debuff"
						add_modifier = { modifier = "ag_wandering_ship_weapon_range_debuff" multiplier = 0.2 days = 8 }
					}
				}
				fromfromfrom = { clear_variable = ag_num_ships_temp_1 }
				fromfrom = { clear_variable = ag_num_ships_temp_2 }
			}
		}
	}
}
fleet_event = {
	id = ag_subsystem.72
	hide_window = yes
	is_triggered_only = yes
	trigger = { exists = this }
	immediate = {
		if = {
			limit = { is_in_combat = yes has_fleet_flag = ag_sub_16_flaged }
			every_owned_ship = {
				limit = { check_modifier_value = { modifier = ship_weapon_range_mult value > 0 } }
				set_variable = { which = ag_weapon_range_factor value = 0 }
				export_modifier_to_variable = { modifier = ship_weapon_range_mult variable = ag_weapon_range_factor }
				if = {
					limit = { check_variable = { which = ag_weapon_range_factor value > 0 } }
					add_modifier = { modifier = "ag_delta_titan_weapon_range_debuff" multiplier = ag_weapon_range_factor days = -1 }
					change_variable = { which = ag_delta_titan_weapon_range_debuff_levels value = 1 }
				}
				clear_variable = ag_weapon_range_factor
			}
			fleet_event = { id = ag_subsystem.72 days = 1 }
		}
		else = { every_owned_ship = {
			while = {
				count = ag_delta_titan_weapon_range_debuff_levels
				remove_modifier = "ag_delta_titan_weapon_range_debuff"
			}
			clear_variable = ag_delta_titan_weapon_range_debuff_levels
		} }
	}
}
fleet_event = {
	id = ag_subsystem.73
	hide_window = yes
	is_triggered_only = yes
	trigger = { exists = this }
	immediate = {
		if = {
			limit = { is_in_combat = yes has_fleet_flag = ag_sub_28_flaged }
			every_owned_ship = {
				limit = { OR = {
					check_modifier_value = { modifier = ship_weapon_damage value > 0 }
					check_modifier_value = { modifier = ship_shield_damage_mult value > 0 }
					check_modifier_value = { modifier = ship_armor_damage_mult value > 0 }
					check_modifier_value = { modifier = ship_hull_damage_mult value > 0 }
				} }
				if = {
					limit = { check_modifier_value = { modifier = ship_weapon_damage value > 0 } }
					set_variable = { which = ag_weapon_debuff_factor value = 0 }
					export_modifier_to_variable = { modifier = ship_weapon_damage variable = ag_weapon_debuff_factor }
					if = {
						limit = { check_variable = { which = ag_weapon_debuff_factor value > 0 } }
						add_modifier = { modifier = "ag_wandering_ship_weapon_damage_debuff" multiplier = ag_weapon_debuff_factor days = -1 }
						change_variable = { which = ag_wandering_ship_weapon_damage_debuff_levels value = 1 }
					}
				}
				if = {
					limit = { check_modifier_value = { modifier = ship_shield_damage_mult value > 0 } }
					set_variable = { which = ag_weapon_debuff_factor value = 0 }
					export_modifier_to_variable = { modifier = ship_shield_damage_mult variable = ag_weapon_debuff_factor }
					if = {
						limit = { check_variable = { which = ag_weapon_debuff_factor value > 0 } }
						add_modifier = { modifier = "ag_wandering_ship_shield_damage_debuff" multiplier = ag_weapon_debuff_factor days = -1 }
						change_variable = { which = ag_wandering_ship_shield_damage_debuff_levels value = 1 }
					}
				}
				if = {
					limit = { check_modifier_value = { modifier = ship_armor_damage_mult value > 0 } }
					set_variable = { which = ag_weapon_debuff_factor value = 0 }
					export_modifier_to_variable = { modifier = ship_armor_damage_mult variable = ag_weapon_debuff_factor }
					if = {
						limit = { check_variable = { which = ag_weapon_debuff_factor value > 0 } }
						add_modifier = { modifier = "ag_wandering_ship_armor_damage_debuff" multiplier = ag_weapon_debuff_factor days = -1 }
						change_variable = { which = ag_wandering_ship_armor_damage_debuff_levels value = 1 }
					}
				}
				if = {
					limit = { check_modifier_value = { modifier = ship_hull_damage_mult value > 0 } }
					set_variable = { which = ag_weapon_debuff_factor value = 0 }
					export_modifier_to_variable = { modifier = ship_hull_damage_mult variable = ag_weapon_debuff_factor }
					if = {
						limit = { check_variable = { which = ag_weapon_debuff_factor value > 0 } }
						add_modifier = { modifier = "ag_wandering_ship_hull_damage_debuff" multiplier = ag_weapon_debuff_factor days = -1 }
						change_variable = { which = ag_wandering_ship_hull_damage_debuff_levels value = 1 }
					}
				}
				clear_variable = ag_weapon_debuff_factor
			}
			fleet_event = { id = ag_subsystem.73 days = 1 }
		}
		else = { every_owned_ship = {
			while = {
				count = ag_wandering_ship_weapon_damage_debuff_levels
				remove_modifier = "ag_wandering_ship_weapon_damage_debuff"
			}
			while = {
				count = ag_wandering_ship_shield_damage_debuff_levels
				remove_modifier = "ag_wandering_ship_shield_damage_debuff"
			}
			while = {
				count = ag_wandering_ship_armor_damage_debuff_levels
				remove_modifier = "ag_wandering_ship_armor_damage_debuff"
			}
			while = {
				count = ag_wandering_ship_hull_damage_debuff_levels
				remove_modifier = "ag_wandering_ship_hull_damage_debuff"
			}
			clear_variable = ag_wandering_ship_weapon_damage_debuff_levels
			clear_variable = ag_wandering_ship_shield_damage_debuff_levels
			clear_variable = ag_wandering_ship_armor_damage_debuff_levels
			clear_variable = ag_wandering_ship_hull_damage_debuff_levels
		} }
	}
}

# Starlight II enhance new leaders
country_event = {
	id = ag_subsystem.81
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		OR = {
			AND = {
				has_country_flag = ag_ship_subsystem_enabled_2501_26
				has_country_flag = ag_lost_ancient_ship_science_ship_form_active
			}
			AND = {
				has_country_flag = ag_ship_subsystem_enabled_2501_27
				has_country_flag = ag_lost_ancient_ship_battleship_form_active
			}
		}
		exists = event_target:ag_starlight_2_ship
		is_same_value = event_target:ag_starlight_2_ship.owner
	}
	immediate = {
		if = {
			limit = { has_country_flag = ag_ship_subsystem_enabled_2501_26 }
			from = {
				random_list = { 10 = { add_skill = 2 } 40 = { add_skill = 1 } 50 = { } }
				random_list = {
					300 = { }
					# 200 available totally.
					10 = { modifier = { factor = 0 has_trait = leader_trait_meticulous } add_trait = leader_trait_meticulous }
					10 = { modifier = { factor = 0 has_trait = leader_trait_spark_of_genius } add_trait = leader_trait_spark_of_genius }
					10 = { modifier = { factor = 0 has_trait = leader_trait_carefree } add_trait = leader_trait_carefree }
					10 = { modifier = { factor = 0 has_trait = leader_trait_roamer } add_trait = leader_trait_roamer }
					10 = { modifier = { factor = 0 has_trait = leader_trait_maniacal } add_trait = leader_trait_maniacal }
					10 = { modifier = { factor = 0 has_trait = leader_trait_expertise_materials } add_trait = leader_trait_expertise_materials }
					10 = { modifier = { factor = 0 has_trait = leader_trait_expertise_propulsion } add_trait = leader_trait_expertise_propulsion }
					10 = { modifier = { factor = 0 has_trait = leader_trait_expertise_voidcraft } add_trait = leader_trait_expertise_voidcraft }
					10 = { modifier = { factor = 0 has_trait = leader_trait_expertise_industry } add_trait = leader_trait_expertise_industry }
					10 = { modifier = { factor = 0 has_trait = leader_trait_expertise_field_manipulation } add_trait = leader_trait_expertise_field_manipulation }
					10 = { modifier = { factor = 0 has_trait = leader_trait_expertise_particles } add_trait = leader_trait_expertise_particles }
					10 = { modifier = { factor = 0 has_trait = leader_trait_expertise_psionics } add_trait = leader_trait_expertise_psionics }
					10 = { modifier = { factor = 0 has_trait = leader_trait_expertise_computing } add_trait = leader_trait_expertise_computing }
					10 = { modifier = { factor = 0 has_trait = leader_trait_expertise_biology } add_trait = leader_trait_expertise_biology }
					10 = { modifier = { factor = 0 has_trait = leader_trait_expertise_statecraft } add_trait = leader_trait_expertise_statecraft }
					10 = { modifier = { factor = 0 has_trait = leader_trait_expertise_military_theory } add_trait = leader_trait_expertise_military_theory }
					10 = { modifier = { factor = 0 has_trait = leader_trait_expertise_new_worlds } add_trait = leader_trait_expertise_new_worlds }
					10 = {
						modifier = { factor = 0 OR = { root = { has_ancrel = no } has_trait = leader_trait_archaeologist_ancrel } }
						add_trait = leader_trait_archaeologist_ancrel
					}
					10 = {
						modifier = { factor = 0 OR = { root = { has_ancrel = yes } has_trait = leader_trait_archaeologist } }
						add_trait = leader_trait_archaeologist
					}
					10 = {
						modifier = { factor = 0 OR = { root = { has_ethic = "ethic_gestalt_consciousness" } has_trait = leader_trait_custom_AI_assistant } }
						add_trait = leader_trait_custom_AI_assistant
					}
					10 = {
						modifier = { factor = 0 OR = {
							root = { has_ethic = "ethic_gestalt_consciousness" }
							root = { has_policy_flag = ai_outlawed }
							has_trait = leader_trait_custom_AI_assistant }
						}
						add_trait = leader_trait_sapient_AI_assistant
					}
				}
			}
		}
		else = {
			from = {
				random_list = { 10 = { add_skill = 2 } 40 = { add_skill = 1 } 50 = { } }
				random_list = {
					120 = { }
					# 80
					10 = { modifier = { factor = 0 has_trait = leader_trait_trickster } add_trait = leader_trait_trickster }
					10 = { modifier = { factor = 0 has_trait = leader_trait_engineer } add_trait = leader_trait_engineer }
					10 = { modifier = { factor = 0 has_trait = leader_trait_aggressive } add_trait = leader_trait_aggressive }
					10 = { modifier = { factor = 0 has_trait = leader_trait_cautious } add_trait = leader_trait_cautious }
					10 = { modifier = { factor = 0 has_trait = leader_trait_scout } add_trait = leader_trait_scout }
					10 = { modifier = { factor = 0 has_trait = leader_trait_unyielding } add_trait = leader_trait_unyielding }
					10 = { modifier = { factor = 0 has_trait = leader_trait_gale_speed } add_trait = leader_trait_gale_speed }
					10 = {
						modifier = { factor = 0 OR = { root = { has_authority = "auth_machine_intelligence" } has_trait = leader_trait_fleet_logistician } }
						add_trait = leader_trait_fleet_logistician
					}
				}
			}
		}
	}
}
