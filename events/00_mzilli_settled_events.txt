namespace = 00_mzilli_settled

# Distributes Nascent Worlds
event = {
	id = 00_mzilli_settled.1
	title = OK
	desc = OK
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	
	immediate = {
		every_country = {
			limit = { has_origin = origin_interplanetary_expansion }
			give_technology = {
				tech = tech_hydroponics
				message = no
			}
		}
		every_system = {
			limit = {
				OR = {
					any_system_planet = {
						exists = owner
						owner = {
							OR = {
								has_origin = origin_common_ground_npc
								has_origin = origin_hegemon_npc
							}
						}
					}
					AND = {
						has_star_flag = empire_home_system
						has_star_flag = empire_cluster
						exists = space_owner
						space_owner = {
							is_country_type = default
							NOT = { has_country_flag = no_mzilli_colonies } #modders, add this flag to excluse your custom empires if desired
						}
					}
				}
			}
			random_system_planet = {
				limit = { exists = owner }
				owner = { save_global_event_target_as = dormant_world_owner }
			}
			if = {
				limit = { any_system_planet = { has_planet_flag = mzilli_settled_planet } }
				if = {
					limit = {
						NOR = {
							event_target:dormant_world_owner = { has_origin = origin_life_seeded }
							event_target:dormant_world_owner = { has_origin = origin_shattered_ring }
							event_target:dormant_world_owner = { has_origin = origin_void_dwellers }
							event_target:dormant_world_owner = { has_origin = origin_doomsday }
							event_target:dormant_world_owner = { has_origin = origin_machine }
						}
					}
					while = {
						count = 2
						random_system_planet = {
							limit = {
								has_planet_flag = mzilli_settled_planet
								NOT = { has_planet_flag = dormant }
							}
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
				}
				if = {
					limit = { event_target:dormant_world_owner = { has_origin = origin_interplanetary_expansion } }
					random_system_planet = {
						limit = {
							has_planet_flag = mzilli_settled_planet
							NOT = { has_planet_flag = dormant }
						}
						set_planet_flag = dormant
						solar_system = { create_mzilli_settled_colonies_2 = yes }
					}
				}
			}
			else_if = {
				limit = { has_star_flag = sol }
				if = {
					limit = { has_star_flag = mzilli_martian_system } # Distant Origin mod
					if = {
						limit = { event_target:dormant_world_owner = { has_origin = origin_interplanetary_expansion } }
						random_system_planet = {
							limit = { has_planet_flag = moon_ganymede }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
					if = {
						limit = {
							NOR = {
								event_target:dormant_world_owner = { has_origin = origin_life_seeded }
								event_target:dormant_world_owner = { has_origin = origin_shattered_ring }
								event_target:dormant_world_owner = { has_origin = origin_void_dwellers }
								event_target:dormant_world_owner = { has_origin = origin_doomsday }
								event_target:dormant_world_owner = { has_origin = origin_machine }
							}
						}
						random_system_planet = {
							limit = { has_planet_flag = moon_titan }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
						random_system_planet = {
							limit = { has_planet_flag = moon_luna }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
				}
				else = { # Standard Sol System
					if = { # Titan
						limit = { event_target:dormant_world_owner = { has_origin = origin_interplanetary_expansion } }
						if = {
							limit = { NOT = { any_system_planet = { has_planet_flag = moon_titan } } }
							random_system_planet = {
								limit = {
									has_ring = yes
									has_moon = yes
									OR = {
										is_planet_class = pc_gas_giant
										is_planet_class = pc_bespin
									}
								}
								random_moon = { set_planet_flag = moon_titan }
							}
						}
						random_system_planet = {
							limit = { has_planet_flag = moon_titan }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
					if = {
						limit = {
							NOR = {
								event_target:dormant_world_owner = { has_origin = origin_life_seeded }
								event_target:dormant_world_owner = { has_origin = origin_shattered_ring }
								event_target:dormant_world_owner = { has_origin = origin_void_dwellers }
								event_target:dormant_world_owner = { has_origin = origin_doomsday }
								event_target:dormant_world_owner = { has_origin = origin_machine }
							}
						}
						if = {
							limit = { NOT = { any_system_planet = { has_planet_flag = planet_mars } } }
							random_system_planet = { # Mars
								limit = {
									is_planet_class = pc_barren
									has_modifier = terraforming_candidate
								}
								set_planet_flag = planet_mars
							}
						}
						random_system_planet = {
							limit = { has_planet_flag = planet_mars }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
						if = {
							limit = { NOT = { any_system_planet = { has_planet_flag = moon_luna } } }
							random_system_planet = { # Luna
								limit = {
									is_planet_class = pc_barren_cold
									is_moon = yes
								}
								set_planet_flag = moon_luna
							}
						}
						random_system_planet = {
							limit = { has_planet_flag = moon_luna }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
				}
			}
			else_if = { # Deneb
				limit = { has_star_flag = deneb_system }
				if = { # Helios or New Luna
					limit = { event_target:dormant_world_owner = { has_origin = origin_interplanetary_expansion } }
					random_system_planet = {
						limit = {
							is_moon = yes
							is_planet_class = pc_frozen
						}
						if = { # Helios
							limit = { planet_size = 8 }
							set_planet_flag = dormant
							set_planet_flag = planet_helios
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
						else = { set_planet_flag = planet_new_luna }
					}
				}
				if = {
					limit = {
						NOR = {
							event_target:dormant_world_owner = { has_origin = origin_life_seeded }
							event_target:dormant_world_owner = { has_origin = origin_shattered_ring }
							event_target:dormant_world_owner = { has_origin = origin_void_dwellers }
							event_target:dormant_world_owner = { has_origin = origin_doomsday }
							event_target:dormant_world_owner = { has_origin = origin_machine }
						}
					}
					while = { # Marble and Tumbleweed
						count = 2
						random_system_planet = {
							limit = {
								OR = {
									is_planet_class = pc_barren
									is_planet_class = pc_barren_cold
								}
							}
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
				}
				if = {
					limit = {
						event_target:dormant_world_owner = { has_origin = origin_interplanetary_expansion }
						any_system_planet = { has_planet_flag = planet_new_luna }
					}
					random_system_planet = { # New Luna
						limit = { has_planet_flag = planet_new_luna }
						set_planet_flag = dormant
						solar_system = { create_mzilli_settled_colonies_2 = yes }
					}
				}
			}
			else = {
				random_system_planet = {
					limit = { exists = owner }
					if = {
						limit = {
							is_moon = yes
							solar_system = { NOT = { any_system_planet = { has_planet_flag = mzilli_settled_planet } } }
						}
						save_event_target_as = mzilli_settled_moon
						solar_system = {
							random_system_planet = {
								limit = {
									any_moon = { is_planet = event_target:mzilli_settled_moon }
									any_moon = { NOT = { is_planet = event_target:mzilli_settled_moon } }
								}
								random_moon = {
									limit = { NOT = { is_planet = event_target:mzilli_settled_moon } }
									set_planet_flag = mzilli_settled_planet
								}						
							}
						}
					}
				}
				if = {
					limit = {
						NOR = {
							event_target:dormant_world_owner = { has_origin = origin_life_seeded }
							event_target:dormant_world_owner = { has_origin = origin_shattered_ring }
							event_target:dormant_world_owner = { has_origin = origin_void_dwellers }
							event_target:dormant_world_owner = { has_origin = origin_doomsday }
							event_target:dormant_world_owner = { has_origin = origin_machine }
						}
					}
					create_mzilli_settled_colonies_1 = yes
					solar_system = { create_mzilli_settled_colonies_2 = yes }
					create_mzilli_settled_colonies_1 = yes
					solar_system = { create_mzilli_settled_colonies_2 = yes }
				}
				if = {
					limit = { event_target:dormant_world_owner = { has_origin = origin_interplanetary_expansion } }
					create_mzilli_settled_colonies_1 = yes
					solar_system = { create_mzilli_settled_colonies_2 = yes }
				}
			}
			every_system_planet = {
				limit = { has_planet_flag = former_dormant }
				#remove_planet_flag = former_dormant
				remove_planet_flag = dormant_generator
				remove_planet_flag = dormant_mining
				remove_planet_flag = mzilli_settled_planet
			}
			if = {
				limit = { event_target:dormant_world_owner = { has_authority = auth_hive_mind } }
				event_target:dormant_world_owner = {
					capital_scope = {
						remove_district = district_mining
						add_district = district_farming
					}
				}
			}
		}
		every_planet = {
			limit = {
				OR = {
					is_planet_class = pc_dormant
					is_planet_class = pc_dormant_cold
					is_planet_class = pc_dormant_frozen
					is_planet_class = pc_dormant_toxic
				}
			}
			if = {
				limit = { owner = { has_origin = origin_tree_of_life } }
				add_deposit = d_tree_of_life_colony
				remove_modifier = no_lifetree
			}
			if = {
				limit = { has_modifier = dangerous_wildlife }
				remove_modifier = dangerous_wildlife
			}
			if = {
				limit = { has_modifier = titanic_life }
				remove_modifier = titanic_life
			}
			if = {
				limit = { has_modifier = lush_planet }
				remove_modifier = lush_planet
			}
			if = {
				limit = { has_modifier = bleak_planet }
				remove_modifier = bleak_planet
			}
			if = {
				limit = {
					OR = {
						owner = { has_origin = origin_common_ground_npc }
						owner = { has_origin = origin_hegemon_npc }
					}
				}
				set_name = random
			}
			if = {
				limit = { is_planet_class = pc_dormant }
				random_list = {
					10 = {
						add_deposit = d_mountain_range
						add_deposit = d_massive_glacier
					}
					10 = {
						add_deposit = d_massive_glacier
						add_deposit = d_mountain_range
					}
				}
			}
			if = {
				limit = { is_planet_class = pc_dormant_cold }
				random_list = {
					10 = {
						add_deposit = d_mountain_range
						add_deposit = d_crater
						add_deposit = d_crater
					}
					10 = {
						add_deposit = d_crater
						add_deposit = d_crater
						add_deposit = d_mountain_range
					}
				}
			}
			if = {
				limit = { is_planet_class = pc_dormant_toxic }
				random_list = {
					10 = {
						add_deposit = d_active_volcano
						add_deposit = d_quicksand_basin
					}
					10 = {
						add_deposit = d_quicksand_basin
						add_deposit = d_active_volcano
					}
				}
			}
			if = {
				limit = { is_planet_class = pc_dormant_frozen }
				random_list = {
					10 = {
						add_deposit = d_massive_glacier
						add_deposit = d_crater
					}
					10 = {
						add_deposit = d_crater
						add_deposit = d_massive_glacier
					}
				}
			}
		}
	}
}