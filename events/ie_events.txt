namespace = ie

planet_event = {
	id = ie.1
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { 
				owner = { has_authority = auth_machine_intelligence }
				is_planet_class = pc_ie_gateway
			}
			add_building = building_galactic_machine_capital
		}
		if = {
			limit = { 
				owner = { has_authority = auth_hive_mind } 
				is_planet_class = pc_ie_gateway
			}
			add_building = building_galactic_hive_capital
		}
		if = {
			limit = { 
				owner = { is_regular_empire = yes }
				is_planet_class = pc_ie_gateway
			}
			add_building = building_galactic_capital
		}
	}
}

planet_event = {
	id = ie.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { is_planet_class = pc_ie_gateway }
			remove_building = building_colony_shelter
			remove_building = building_capital
			remove_building = building_major_capital
			remove_building = building_system_capital
			remove_building = building_imperial_capital
			remove_building = building_hive_capital
			remove_building = building_hive_major_capital
			remove_building = building_hab_capital
			remove_building = building_hab_major_capital
			remove_building = building_resort_capital
			remove_building = building_resort_major_capital
			remove_building = building_slave_capital
			remove_building = building_slave_major_capital
			remove_building = building_deployment_post
			remove_building = building_machine_capital
			remove_building = building_machine_major_capital
			remove_building = building_machine_system_capital
			remove_building = building_imperial_machine_capital
			remove_building = building_imperial_hive_capital
			planet_event = { id = ie.1 }
		}
	}
}

planet_event = {
	id = ie.3
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = { 
			limit = { is_planet_class = pc_ie_gateway }
			planet_event = { id = ie.2 }
		}
	}
}

country_event = {
	id = ie.4
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_owned_planet = { planet_event = { id = ie.3 } }
	}
}

planet_event = {
	id = ie.5
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = { 
			limit = { is_planet_class = pc_ie_gateway }
			while = {
				count = 120
				create_pop = { species = owner_main_species }
			}
		}
	}
}

planet_event = {
	id = ie.6
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = { 
			limit = { has_planet_flag = ie_gate_start }
			ie_deposits = yes
			planet_event = { id = ie.9 }
		}
	}
}

planet_event = {
	id = ie.7
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		ie_deposits = yes
		planet_event = { id = ie.8 }
	}
}

planet_event = {
	id = ie.8
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		ie_blockers = yes
	}
}

planet_event = {
	id = ie.9
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		ie_origin_blockers = yes
		planet_event = { id = ie.10 }
	}
}

planet_event = {
	id = ie.10
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		ie_gate_setup = yes
	}
}

planet_event = {
	id = ie.999
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		solar_system = {
			spawn_planet = {
				class = "pc_ie_gateway"
				location = prev
				orbit_location = yes
				orbit_angle_offset = 45
				orbit_distance_offset = 9.899
				size = 0
				has_ring = no

				init_effect = {
					set_name = "Galactic Hypergate"
					set_surveyed = {
						surveyed = yes
						surveyor = FROM
					}
					set_all_comms_surveyed = yes
					clear_blockers = yes
					planet_event = { id = ie.7 }

					set_planet_flag = megastructure
					set_planet_flag = has_megastructure		# Vanilla uses to check if an orbital station can be built here
					set_planet_flag = colony_event			# Vanilla uses to prevent unwanted events on planets
					set_planet_flag = habitat
					add_modifier = { modifier = ie_gate }
				}
			}
			fromfrom.planet = {
				set_planet_flag = has_megastructure
				save_event_target_as = habitat_planet

				if = {
					limit = { has_orbital_station = yes }
					orbital_station = {
						dismantle = yes
					}
				}
			}
		}
	}
}

