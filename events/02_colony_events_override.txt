################################################
#	Colony Events: Factory/Assassination/INFECTIOUS DISEASE
#	By Maximilian Olbers (2.1)
#	Opt/Simplified by FirePrince (3.2 - removed MTTH/timed flags)
#
################################################
namespace = colony

## Odd Factory
planet_event = {
	id = colony.2015
	title = colony.2015.name
	desc = colony.2015.desc
	picture = GFX_evt_alien_city
	show_sound = event_activating_unknown_technology
	location = root
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}
	trigger = {
		owner = {
			NOR = {
				has_country_flag = colony_odd_factory
				is_machine_empire = yes
			}
		}
		num_pops > 1
		NOR = {
			has_planet_flag = colony_event
			is_artificial = yes
			has_planet_flag = odd_factory_destroyed
		}
	}
	is_triggered_only = yes
	immediate = {
		set_planet_flag = colony_event
		owner = { set_country_flag = colony_odd_factory }
		random_owned_pop = { unemploy_pop = yes }
		add_deposit = d_odd_factory
		random_list = {
			30 = {
				set_planet_flag = colony_factory_kidnap
				planet_event = { id = colony.2016 days = 120 random = 30 } # MTTH workaround
			}
			16 = {
				set_planet_flag = colony_factory_breaks
				planet_event = { id = colony.2018 days = 180 random = 30 } # MTTH workaround
			}
			35 = {
				set_planet_flag = colony_factory_no_effect
				planet_event = { id = colony.2019 days = 180 random = 30 } # MTTH workaround
			}
		}
	}
	option = {
		name = INTRIGUING
		tooltip = { add_deposit = d_odd_factory }
	}
}

## Follow-up: Kidnap
planet_event = {
	id = colony.2016
	title = colony.2015.name
	desc = colony.2016.desc
	picture = GFX_evt_alien_city
	show_sound = event_ghost_town
	location = root
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
	}
	trigger = {
		has_planet_flag = colony_factory_kidnap
		has_deposit = d_odd_factory
		num_assigned_jobs = {
			job = odd_factory_worker
			value > 0
		}
		owner = { NOT = { has_country_flag = odd_factory_pause } }
	}
	is_triggered_only = yes
	# mean_time_to_happen = { months = 4 }
	immediate = {
		owner = { set_country_flag = odd_factory_pause }
		random_owned_pop = {
			limit = { has_job = odd_factory_worker }
			unemploy_pop = yes
			kill_pop = yes
		}
	}
	after = {
		hidden_effect = {
			remove_planet_flag = colony_factory_kidnap
			owner = { remove_country_flag = odd_factory_pause }
		}
	}
	option = {
		name = colony.2016.b
		custom_tooltip = colony.2016.a.tooltip
		remove_deposit = d_odd_factory
		hidden_effect = {
			set_planet_flag = odd_factory_destroyed
			random = {
				chance = 50
				planet_event = { id = colony.2019 days = 1 }
			}
		}
	}
	option = {
		name = colony.2016.a
		custom_tooltip = colony.2016.a.tooltip
		hidden_effect = {
			random_list = {
				50 = {
					set_planet_flag = colony_factory_kidnap_sequel
					planet_event = { id = colony.2017 days = 120 random = 30 } # MTTH workaround
				}
				15 = {
					set_planet_flag = colony_factory_breaks
					planet_event = { id = colony.2018 days = 180 random = 30 } # MTTH workaround
				}
				35 = {
					set_planet_flag = colony_factory_no_effect
					planet_event = { id = colony.2019 days = 180 random = 30 } # MTTH workaround
				}
			}
		}
	}
}

## Follow-up: Kidnap 2
planet_event = {
	id = colony.2017
	title = colony.2015.name
	desc = colony.2017.desc
	picture = GFX_evt_alien_city
	show_sound = event_ghost_town
	location = root
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
	}
	trigger = {
		has_planet_flag = colony_factory_kidnap_sequel
		has_deposit = d_odd_factory
		num_assigned_jobs = {
			job = odd_factory_worker
			value > 0
		}
		owner = { NOT = { has_country_flag = odd_factory_pause } }
	}
	is_triggered_only = yes
	# mean_time_to_happen = { months = 4 }
	immediate = {
		owner = { set_country_flag = odd_factory_pause }
		random_owned_pop = {
			limit = { has_job = odd_factory_worker }
			unemploy_pop = yes
			kill_pop = yes
		}
		random = {
			chance = 50
			remove_planet_flag = colony_factory_kidnap_sequel
		}
	}
	after = {
		hidden_effect = {
			remove_planet_flag = colony_factory_kidnap
			remove_planet_flag = colony_factory_kidnap_sequel
			owner = { remove_country_flag = odd_factory_pause }
		}
	}
	option = {
		name = colony.2017.a
		custom_tooltip = colony.2017.a.tooltip
		add_modifier = { modifier = scared_population years = 5 }
	}
	option = {
		name = colony.2017.b
		custom_tooltip = colony.2017.b.tooltip
		add_modifier = { modifier = secured_factory years = 5 }
	}
	option = {
		name = colony.2016.b
		custom_tooltip = colony.2016.a.tooltip
		trigger = {
			hidden_trigger = { has_planet_flag = colony_factory_kidnap_sequel }
		}
		remove_deposit = d_odd_factory
		hidden_effect = {
			set_planet_flag = odd_factory_destroyed
			random = {
				chance = 25
				planet_event = { id = colony.2019 days = 1 }
			}
		}
	}
}

## Follow-up: Breaks (removed in 2.2)
planet_event = {
	id = colony.2018
	title = colony.2015.name
	desc = colony.2018.desc
	picture = GFX_evt_burning_settlement
	show_sound = event_structural_collapse
	location = root
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
	}
	trigger = {
		has_planet_flag = colony_factory_breaks
		has_deposit = d_odd_factory
		num_assigned_jobs = {
			job = odd_factory_worker
			value > 0
		}
		NOT = { has_planet_flag = odd_factory_destroyed }
		owner = { NOT = { has_country_flag = odd_factory_pause } }
	}
	is_triggered_only = yes
	# mean_time_to_happen = { months = 6 }
	immediate = {
		owner = { set_country_flag = odd_factory_pause }
		remove_deposit = d_odd_factory
		random_list = {
			1 = { add_deposit = d_odd_factory_wreckage_1 }
			1 = { add_deposit = d_odd_factory_wreckage_2 }
		}
	}
	after = {
		hidden_effect = {
			remove_planet_flag = colony_factory_no_effect
			remove_planet_flag = colony_factory_breaks
			remove_planet_flag = colony_factory_kidnap
			remove_planet_flag = colony_factory_kidnap_sequel
			owner = { remove_country_flag = odd_factory_pause }
			if = { limit = { has_modifier = secured_factory }
				remove_modifier = secured_factory
			}
			if = { limit = { has_modifier = scared_population }
				remove_modifier = scared_population
			}
			set_planet_flag = odd_factory_destroyed
		}
	}
	option = {
		name = colony.2018.a
		custom_tooltip = colony.2018.a.tooltip
		exclusive_trigger = { has_deposit = d_odd_factory_wreckage_1 }
		hidden_effect = { add_deposit = d_energy_4 }
	}
	option = {
		name = colony.2018.b
		custom_tooltip = colony.2018.b.tooltip
		hidden_effect = { add_deposit = d_minerals_4 }
	}
}

## Follow-up: No effect
planet_event = {
	id = colony.2019
	title = colony.2015.name
	desc = colony.2019.desc
	picture = GFX_evt_alien_city
	show_sound = event_administrative_work
	location = root
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		# has_ground_combat = no
	}
	trigger = {
		has_planet_flag = colony_factory_no_effect
		has_deposit = d_odd_factory
		# num_assigned_jobs = { job = odd_factory_worker value > 0 }
	}
	is_triggered_only = yes
	# mean_time_to_happen = { months = 6 }
	immediate = { }
	option = {
		name = GOOD
		hidden_effect = { remove_planet_flag = colony_factory_no_effect }
	}
}

## Follow-up: Destroyed on purpose (removed in 2.2)
planet_event = {
	id = colony.2020
	title = colony.2015.name
	desc = colony.2020.desc
	picture = GFX_evt_burning_settlement
	show_sound = event_structural_collapse
	location = root
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
	}
	trigger = {
		has_planet_flag = colony_event
		# has_deposit = d_odd_factory
		# num_assigned_jobs = {
		# 	job = odd_factory_worker
		# 	value > 0
		# }
		NOT = { has_planet_flag = odd_factory_destroyed }
		owner = {
			has_country_flag = colony_odd_factory
			NOT = { has_country_flag = odd_factory_pause }
		}
		num_pops > 1
	}
	is_triggered_only = yes
	immediate = {
		set_planet_flag = odd_factory_destroyed
		owner = { set_country_flag = odd_factory_pause }
		random_owned_pop = {
			limit = { has_job = odd_factory_worker }
			unemploy_pop = yes
			kill_pop = yes
		}
		# remove_deposit = d_odd_factory
		random_deposit = {
			limit = { is_deposit_type = d_odd_factory }
			remove_deposit = yes
		}
		random_list = {
			1 = { add_deposit = d_odd_factory_wreckage_1 }
			1 = { add_deposit = d_odd_factory_wreckage_2 }
		}
	}
	after = {
		hidden_effect = {
			remove_planet_flag = colony_factory_no_effect
			remove_planet_flag = colony_factory_breaks
			remove_planet_flag = colony_factory_kidnap
			remove_planet_flag = colony_factory_kidnap_sequel
			owner = { remove_country_flag = odd_factory_pause }
			if = { limit = { has_modifier = secured_factory }
				remove_modifier = secured_factory
			}
			if = { limit = { has_modifier = scared_population }
				remove_modifier = scared_population
			}
		}
	}
	option = {
		name = colony.2018.a
		exclusive_trigger = { has_deposit = d_odd_factory_wreckage_1 }
		hidden_effect = { add_deposit = d_energy_3 }
	}
	option = {
		name = colony.2018.b
		hidden_effect = { add_deposit = d_minerals_3 }
	}
}

## Assassination
planet_event = {
	id = colony.2030
	title = colony.2030.name
	desc = {
		trigger = {
			hidden:owner = {
				switch = {
					trigger = has_ethic
					ethic_fanatic_xenophobe = { text = colony.2030.desc.phobe }
					ethic_xenophobe = { text = colony.2030.desc.phobe }
					ethic_fanatic_spiritualist = { text = colony.2030.desc.spirit }
					ethic_spiritualist = { text = colony.2030.desc.spirit }
					ethic_fanatic_militarist = { text = colony.2030.desc.military }
					ethic_militarist = { text = colony.2030.desc.military }
					default = { text = colony.2030.desc }
				}
			}
		}
	}
	picture = GFX_evt_smugglers_in_bar
	show_sound = event_mystic_reveal
	location = root
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}
	trigger = {
		owner = {
			NOR = {
				has_country_flag = colony_assassin
				is_machine_empire = yes
			}
			any_playable_country = {
				is_ai = yes
				has_communications = prev
				their_opinion = { who = prev value < -99 }
				root = {
					owner = { has_communications = prevprev }
				}
				intel_level = { system = root.solar_system level > low }
				has_active_spynetwork = yes
			}
		}
		num_pops > 1
		# exists = sector exists = sector.leader < v.3.8
		exists = leader
		NOR = {
			has_planet_flag = colony_event
			merg_is_habitat = yes
		}
	}
	is_triggered_only = yes
	immediate = {
		set_planet_flag = colony_event
		owner = {
			set_country_flag = colony_assassin
			save_event_target_as = MyCountry
			random_country = {
				limit = {
					is_ai = yes
					merg_is_default_empire = yes
					has_communications = prev
					their_opinion = { who = prev value < -99 }
					root = {
						owner = { has_communications = prevprev }
					}
					intel_level = {
						system = root.solar_system
						level > low
					}
					has_active_spynetwork = yes
				}
				save_event_target_as = AssassinEmpire
			}
		}
		leader = {
			kill_leader = { type = governor show_notification = no }
		}
	}
	option = {
		name = colony.2030.a
		custom_tooltip = colony.2030.a.tooltip
		trigger = {
			owner = { is_pacifist = yes }
		}
		hidden_effect = {
			event_target:AssassinEmpire = {
				add_opinion_modifier = { who = event_target:MyCountry modifier = assassination_forgiven }
			}
		}
	}
	option = {
		name = colony.2030.b
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier3influencereward
				min = @tier3influencemin
				max = @tier3influencemax
			}
		}
	}
	option = {
		name = colony.2030.c
		trigger = {
			owner = {
				resource_stockpile_compare = { resource = influence value > 50 }
				is_militarist = no
				is_pacifist = no
			}
		}
		owner = {
			add_resource = { influence = -50 }
		}
		add_modifier = { modifier = fear_as_control years = 10 }
	}
	option = {
		name = colony.2030.d
		trigger = {
			owner = {
				resource_stockpile_compare = { resource = influence value > 50 }
				is_militarist = yes
			}
		}
		owner = {
			add_resource = { influence = -50 }
			add_modifier = { modifier = fear_as_control_militarist_p2 years = 10 }
		}
		add_modifier = { modifier = fear_as_control_militarist years = 10 }
	}
}

## START INFECTIOUS DISEASE
planet_event = {
	id = colony.2035
	title = colony.2035.name
	desc = {
		trigger = {
			hidden:owner = {
				switch = {
					trigger = has_ethic
					ethic_fanatic_spiritualist = { text = colony.2035.desc.spirit }
					ethic_spiritualist = { text = colony.2035.desc.spirit }
					ethic_fanatic_materialist = { text = colony.2035.desc.material }
					ethic_materialist = { text = colony.2035.desc.material }
					default = { text = colony.2035.desc }
				}
			}
		}
	}
	picture = GFX_evt_microscopic_life
	show_sound = event_laboratory_sound
	location = root
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}
	trigger = {
		# TODO: Fix
		# sector_controlled = no
		is_sector_capital = no
		owner = {
			NOR = {
				has_country_flag = colony_infected
				is_gestalt = yes
			}
			resource_stockpile_compare = { resource = influence value > 100 }
		}
		count_owned_pop = {
			limit = { is_robot_pop = no }
			count > 4
		}
		NOR = {
			has_planet_flag = colony_event
			is_artificial = yes # merg_is_habitat = yes
			has_deposit = d_quarantine_hospital
			has_deposit = d_plague_memorial
		}
	}
	is_triggered_only = yes
	immediate = {
		set_planet_flag = colony_event
		set_planet_flag = colony_infected_active
		planet_event = { id = colony.2037 days = 20 random = 10 }
		owner = {
			set_country_flag = colony_infected
			set_country_flag = colony_infected_active
		}
		while = {
			count = 3
			random_owned_pop = {
				limit = {
					is_robot_pop = no
					NOT = { has_pop_flag = spreading_infection }
					# NOT = { has_modifier = alien_infection }
				}
				add_modifier = { modifier = alien_infection }
				hidden_effect = {
					set_pop_flag = spreading_infection
					# random_list = {
					# 	33 = {
					# 		set_timed_pop_flag = { flag = alien_infection_timer days = 15 }
					# 	}
					# 	33 = {
					# 		set_timed_pop_flag = { flag = alien_infection_timer months = 1 }
					# 	}
					# 	33 = {
					# 		set_timed_pop_flag = { flag = alien_infection_timer days = 45 }
					# 	}
					# }
				}
			}
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					NOR = {
						has_deposit = d_quarantine_hospital
						has_modifier = infectious_disease
					}
				}
				owner = { set_country_flag = alien_infection_isolated }
				while = {
					count = 3
					limit = {
						num_pops > 1
						any_owned_pop = {
							OR = {
								has_modifier = alien_infection
								has_pop_flag = spreading_infection
							}
						}
					}
					random_owned_pop = {
						limit = {
							OR = {
								has_modifier = alien_infection
								has_pop_flag = spreading_infection
							}
						}
						unemploy_pop = yes
						kill_pop = yes
					}
				}
				random_list = {
					25 = { planet_event = { id = colony.2036 days = 30 } }
					25 = { planet_event = { id = colony.2036 days = 60 } }
					50 = { }
				}
			}
		}
	}
	option = {
		name = colony.2035.a
		custom_tooltip = colony.2035.a.tooltip
		add_deposit = d_quarantine_hospital
		hidden_effect = {
			add_modifier = { modifier = infectious_disease }
			random_owned_pop = { unemploy_pop = yes }
			planet_event = { id = colony.2041 days = 21 random = 7 }
			owner = { remove_country_flag = alien_infection_isolated }
		}
	}
	option = {
		name = colony.2035.c
		custom_tooltip = colony.2035.c.tooltip
		trigger = {
			owner = {
				# resource_stockpile_compare = { resource = influence value > 100 }
				NOR = {
					is_spiritualist = yes
					is_materialist = yes
					is_militarist = yes
					has_ethic = ethic_fanatic_authoritarian
					has_ethic = ethic_fanatic_pacifist
					has_ethic = ethic_fanatic_egalitarian
					has_government = gov_military_dictatorship
					has_government = gov_star_empire
					has_government = gov_despotic_hegemony
					has_government = gov_totalitarian_regime
					has_government = gov_despotic_empire
					has_government = gov_feudal_empire
					has_government = gov_constitutional_dictatorship
					has_government = gov_irenic_bureaucracy
					has_government = gov_direct_democracy
					has_government = gov_rational_consensus
					has_government = gov_moral_democracy
				}
			}
		}
		owner = {
			add_resource = { influence = -100 }
		}
	}
	option = {
		name = colony.2035.c.spirit
		custom_tooltip = colony.2035.c.tooltip
		trigger = {
			owner = {
				# resource_stockpile_compare = { resource = influence value > 100 }
				is_spiritualist = yes
				NOR = {
					is_materialist = yes
					is_militarist = yes
					has_ethic = ethic_fanatic_authoritarian
					has_ethic = ethic_fanatic_pacifist
					has_ethic = ethic_fanatic_egalitarian
					has_government = gov_military_dictatorship
					has_government = gov_star_empire
					has_government = gov_despotic_hegemony
					has_government = gov_totalitarian_regime
					has_government = gov_despotic_empire
					has_government = gov_feudal_empire
					has_government = gov_constitutional_dictatorship
					has_government = gov_irenic_bureaucracy
					has_government = gov_direct_democracy
					has_government = gov_rational_consensus
					has_government = gov_moral_democracy
				}
			}
		}
		owner = {
			add_resource = { influence = -100 }
		}
	}
	option = {
		name = colony.2035.c.badguy
		custom_tooltip = colony.2035.c.tooltip.kill
		trigger = {
			owner = {
				# resource_stockpile_compare = { resource = influence value > 100 }
				OR = {
					is_militarist = yes
					has_ethic = ethic_fanatic_authoritarian
					has_government = gov_military_dictatorship
					has_government = gov_star_empire
					has_government = gov_despotic_hegemony
					has_government = gov_totalitarian_regime
					has_government = gov_despotic_empire
					has_government = gov_feudal_empire
					has_government = gov_constitutional_dictatorship
				}
				NOR = {
					is_spiritualist = yes
					is_materialist = yes
					has_ethic = ethic_fanatic_pacifist
					has_ethic = ethic_fanatic_egalitarian
					has_government = gov_irenic_bureaucracy
					has_government = gov_direct_democracy
					has_government = gov_rational_consensus
					has_government = gov_moral_democracy
				}
			}
		}
		owner = {
			add_resource = { influence = -100 }
		}
	}
	option = {
		name = colony.2035.c.material
		custom_tooltip = colony.2035.c.tooltip.kill
		trigger = {
			owner = {
				# resource_stockpile_compare = { resource = influence value > 100 }
				is_materialist = yes
				NOR = {
					is_spiritualist = yes
					is_militarist = yes
					has_ethic = ethic_fanatic_authoritarian
					has_ethic = ethic_fanatic_pacifist
					has_ethic = ethic_fanatic_egalitarian
					has_government = gov_military_dictatorship
					has_government = gov_star_empire
					has_government = gov_despotic_hegemony
					has_government = gov_totalitarian_regime
					has_government = gov_despotic_empire
					has_government = gov_feudal_empire
					has_government = gov_constitutional_dictatorship
					has_government = gov_irenic_bureaucracy
					has_government = gov_direct_democracy
					has_government = gov_rational_consensus
					has_government = gov_moral_democracy
				}
			}
		}
		owner = {
			add_resource = { influence = -100 }
		}
	}
}

## NEW INFECTED POPS UP AFTER QUARENTINE (from .2035).
planet_event = {
	id = colony.2036
	title = colony.2035.name
	desc = colony.2036.desc
	picture = GFX_evt_microscopic_life
	show_sound = event_red_alert
	location = root
	is_triggered_only = yes
	immediate = {
		while = {
			count = 3
			random_owned_pop = {
				limit = {
					is_robot_pop = no
					NOT = { has_pop_flag = spreading_infection }
					# NOT = { has_modifier = alien_infection }
				}
				add_modifier = { modifier = alien_infection }
				hidden_effect = {
					set_pop_flag = spreading_infection
					# random_list = {
					# 	33 = {
					# 		set_timed_pop_flag = { flag = alien_infection_timer days = 15 }
					# 	}
					# 	33 = {
					# 		set_timed_pop_flag = { flag = alien_infection_timer months = 1 }
					# 	}
					# 	33 = {
					# 		set_timed_pop_flag = { flag = alien_infection_timer days = 45 }
					# 	}
					# }
				}
			}
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					NOR = {
						# owner = { has_country_flag = alien_infection_isolated }
						has_deposit = d_quarantine_hospital
						has_modifier = infectious_disease
					}
				}
				remove_planet_flag = colony_infected_active
				remove_planet_flag = infection_warning
				owner = {
					remove_country_flag = alien_infection_1_cured
					remove_country_flag = alien_infection_2_cured
					remove_country_flag = colony_infected_active
					remove_country_flag = alien_infection_isolated
				}
				while = {
					count = 3
					limit = {
						num_pops > 1
						any_owned_pop = {
							OR = {
								has_modifier = alien_infection
								has_pop_flag = spreading_infection
							}
						}
					}
					random_owned_pop = {
						limit = {
							OR = {
								has_modifier = alien_infection
								has_pop_flag = spreading_infection
							}
						}
						unemploy_pop = yes
						kill_pop = yes
					}
				}
				every_owned_pop = {
					limit = {
						OR = {
							has_modifier = alien_infection
							has_pop_flag = spreading_infection
						}
					}
					remove_modifier = alien_infection
					remove_pop_flag = spreading_infection
				}
			}
		}
	}
	option = {
		name = colony.2035.a
		custom_tooltip = colony.2035.b.tooltip
		add_deposit = d_quarantine_hospital
		hidden_effect = {
			add_modifier = { modifier = infectious_disease }
			random_owned_pop = { unemploy_pop = yes }
			planet_event = { id = colony.2041 days = 21 random = 7 }
			owner = { remove_country_flag = alien_infection_isolated }
		}
	}
	option = {
		name = colony.2036.c
		custom_tooltip = colony.2035.c.tooltip
		trigger = {
			owner = {
				resource_stockpile_compare = { resource = influence value > 50 }
				NOR = {
					is_spiritualist = yes
					is_materialist = yes
					is_militarist = yes
					has_ethic = ethic_fanatic_authoritarian
					has_ethic = ethic_fanatic_pacifist
					has_ethic = ethic_fanatic_egalitarian
					has_government = gov_military_dictatorship
					has_government = gov_star_empire
					has_government = gov_despotic_hegemony
					has_government = gov_totalitarian_regime
					has_government = gov_despotic_empire
					has_government = gov_feudal_empire
					has_government = gov_constitutional_dictatorship
					has_government = gov_irenic_bureaucracy
					has_government = gov_direct_democracy
					has_government = gov_rational_consensus
					has_government = gov_moral_democracy
				}
			}
		}
		owner = {
			add_resource = { influence = -50 }
		}
	}
	option = {
		name = colony.2036.c.spirit
		custom_tooltip = colony.2035.c.tooltip
		trigger = {
			owner = {
				resource_stockpile_compare = { resource = influence value > 50 }
				is_spiritualist = yes
				NOR = {
					is_materialist = yes
					is_militarist = yes
					has_ethic = ethic_fanatic_authoritarian
					has_ethic = ethic_fanatic_pacifist
					has_ethic = ethic_fanatic_egalitarian
					has_government = gov_military_dictatorship
					has_government = gov_star_empire
					has_government = gov_despotic_hegemony
					has_government = gov_totalitarian_regime
					has_government = gov_despotic_empire
					has_government = gov_feudal_empire
					has_government = gov_constitutional_dictatorship
					has_government = gov_irenic_bureaucracy
					has_government = gov_direct_democracy
					has_government = gov_rational_consensus
					has_government = gov_moral_democracy
				}
			}
		}
		owner = {
			add_resource = { influence = -50 }
		}
	}
	option = {
		name = colony.2036.c.badguy
		custom_tooltip = colony.2035.c.tooltip.kill
		trigger = {
			owner = {
				resource_stockpile_compare = { resource = influence value > 50 }
				OR = {
					is_militarist = yes
					has_ethic = ethic_fanatic_authoritarian
					has_government = gov_military_dictatorship
					has_government = gov_star_empire
					has_government = gov_despotic_hegemony
					has_government = gov_totalitarian_regime
					has_government = gov_despotic_empire
					has_government = gov_feudal_empire
					has_government = gov_constitutional_dictatorship
				}
				NOR = {
					is_spiritualist = yes
					is_materialist = yes
					has_ethic = ethic_fanatic_pacifist
					has_ethic = ethic_fanatic_egalitarian
					has_government = gov_irenic_bureaucracy
					has_government = gov_direct_democracy
					has_government = gov_rational_consensus
					has_government = gov_moral_democracy
				}
			}
		}
		owner = {
			add_resource = { influence = -50 }
		}
	}
	option = {
		name = colony.2036.c.material
		custom_tooltip = colony.2035.c.tooltip.kill
		trigger = {
			owner = {
				resource_stockpile_compare = { resource = influence value > 50 }
				is_materialist = yes
				NOR = {
					is_spiritualist = yes
					is_militarist = yes
					has_ethic = ethic_fanatic_authoritarian
					has_ethic = ethic_fanatic_pacifist
					has_ethic = ethic_fanatic_egalitarian
					has_government = gov_military_dictatorship
					has_government = gov_star_empire
					has_government = gov_despotic_hegemony
					has_government = gov_totalitarian_regime
					has_government = gov_despotic_empire
					has_government = gov_feudal_empire
					has_government = gov_constitutional_dictatorship
					has_government = gov_irenic_bureaucracy
					has_government = gov_direct_democracy
					has_government = gov_rational_consensus
					has_government = gov_moral_democracy
				}
			}
		}
		owner = {
			add_resource = { influence = -50 }
		}
	}
}

## SPREAD INFECTION
planet_event = {
	id = colony.2037
	hide_window = yes
	# mean_time_to_happen = { days = 20 }
	is_triggered_only = yes
	trigger = {
		has_planet_flag = colony_infected_active
		any_owned_pop = { has_pop_flag = spreading_infection }
	}
	immediate = {
		random_owned_pop = {
			limit = {
				is_robot_pop = no
				NOT = {
					has_pop_flag = spreading_infection
					# has_pop_flag = alien_infection_immunity
					# has_modifier = alien_infection
				}
			}
			set_pop_flag = spreading_infection
			add_modifier = { modifier = alien_infection } # omit -2038
		}
		# Loop
		planet_event = { id = colony.2037 days = 21 random = 7 }
		planet_event = { id = colony.2039 days = 28 random = 14 }
	}
}

# REMOVED as unneeded realistic!? (performance)
# ## TRIGGER INFECTION (only for incubations period)
# ## alien_infection_timer = dead trigger
# planet_event = {
# 	id = colony.2038
# 	hide_window = yes
# 	# mean_time_to_happen = { days = 15 }
# 	is_triggered_only = yes
# 	trigger = {
# 		has_planet_flag = colony_infected_active
# 		any_owned_pop = {
# 			has_pop_flag = spreading_infection
# 			NOT = {
# 				# has_pop_flag = alien_infection_immunity
# 				has_modifier = alien_infection
# 			}
# 		}
# 	}
# 	immediate = {
# 		random_owned_pop = {
# 			limit = {
# 				is_robot_pop = no
# 				has_pop_flag = spreading_infection
# 				NOT = { has_modifier = alien_infection }
# 			}
# 			add_modifier = { modifier = alien_infection }
# 			# random_list = {
# 			# 	33 = {
# 			# 		set_timed_pop_flag = { flag = alien_infection_timer days = 15 }
# 			# 	}
# 			# 	33 = {
# 			# 		set_timed_pop_flag = { flag = alien_infection_timer months = 1 }
# 			# 	}
# 			# 	33 = {
# 			# 		set_timed_pop_flag = { flag = alien_infection_timer days = 45 }
# 			# 	}
# 			# }
# 		}
# 	}
# }

## TRIGGER DEATH (from .2037)
planet_event = {
	id = colony.2039
	hide_window = yes
	# mean_time_to_happen = { days = 22 }
	is_triggered_only = yes
	trigger = {
		has_planet_flag = colony_infected_active
		# NOT = { has_planet_flag = healing_in_progress_msg } only with MTTH
		count_owned_pop = {
			limit = { has_modifier = alien_infection }
			count > 1
		}
		# any_owned_pop = {
		# 	has_modifier = alien_infection
		# 	# NOT = { has_pop_flag = alien_infection_timer }
		# }
	}
	immediate = {
		if = {
			limit = {
				NOR = {
					has_planet_flag = infection_warning
					owner = { has_country_flag = alien_infection_2_cured }
				}
				count_owned_pop = {
					limit = { has_pop_flag = spreading_infection }
					count > 4
				}
			}
			planet_event = { id = colony.2040 days = 30 }
		}
		random_owned_pop = {
			limit = {
				has_modifier = alien_infection
				# NOT = {
				# 	has_pop_flag = alien_infection_timer
				# 	# has_pop_flag = alien_infection_immunity
				# }
			}
			unemploy_pop = yes
			kill_pop = yes
		}
		if = { limit = { num_pops > 40 }
			random_owned_pop = {
				limit = {
					has_modifier = alien_infection
					# NOT = {
					# 	has_pop_flag = alien_infection_timer
					# 	# has_pop_flag = alien_infection_immunity
					# }
				}
				unemploy_pop = yes
				kill_pop = yes
			}
		}
		planet_event = { id = colony.2046 }			# Notify
		planet_event = { id = colony.2047 days = 1 } # Notify
	}
}

## WARNING MESSAGE FOR DEATH - FIRST (from .2039)
planet_event = {
	id = colony.2046
	title = colony.2035.name
	desc = colony.2046.desc
	picture = GFX_evt_microscopic_life
	show_sound = event_red_alert
	location = root
	is_triggered_only = yes
	trigger = {
		NOR = {
			has_planet_flag = healing_in_progress_msg
			has_planet_flag = disease_first_blood
		}
	}
	immediate = {
		set_planet_flag = healing_in_progress_msg
		set_planet_flag = disease_first_blood
	}
	after = {
		hidden_effect = { remove_planet_flag = healing_in_progress_msg }
	}
	option = { name = colony.2046.a }
	option = {
		name = colony.2046.b
		hidden_effect = { set_planet_flag = disease_no_updates }
	}
}

## WARNING MESSAGE FOR DEATH - REPEATING (from .2039)
planet_event = {
	id = colony.2047
	title = colony.2035.name
	desc = colony.2047.desc
	picture = GFX_evt_microscopic_life
	show_sound = event_red_alert
	location = root
	is_triggered_only = yes
	trigger = {
		has_planet_flag = disease_first_blood
		NOT = { has_planet_flag = disease_no_updates }
	}
	immediate = {
		set_planet_flag = healing_in_progress_msg
		# MTTH workaround
		owner = {
			random_owned_planet = {
				limit = {
					has_planet_flag = colony_infected_active
					NOT = { has_planet_flag = plague_progress_made }
					has_deposit = d_quarantine_hospital
					num_assigned_jobs = {
						job = healthcare
						value > 0
					}
				}
				planet_event = { id = colony.2041 days = 21 random = 7 }
			}
		}
	}
	after = {
		hidden_effect = { remove_planet_flag = healing_in_progress_msg }
	}
	option = {
		name = CURSES
		trigger = {
			owner = { is_spiritualist = no }
		}
	}
	option = {
		name = GODDAMNIT
		trigger = {
			owner = { is_spiritualist = yes }
		}
	}
}

## WARNING MESSAGE FOR SPREAD
planet_event = {
	id = colony.2040
	title = colony.2035.name
	desc = colony.2040.desc
	picture = GFX_evt_microscopic_life
	show_sound = event_red_alert
	location = root
	# mean_time_to_happen = { days = 100 }
	is_triggered_only = yes
	trigger = {
		has_planet_flag = colony_infected_active
		NOR = {
			has_planet_flag = infection_warning
			owner = { has_country_flag = alien_infection_2_cured }
		}
		count_owned_pop = {
			limit = { has_pop_flag = spreading_infection }
			count > 4
		}
	}
	immediate = {
		set_planet_flag = infection_warning
		# MTTH workaround
		owner = {
			random_owned_planet = {
				limit = {
					has_planet_flag = colony_infected_active
					NOT = { has_planet_flag = plague_progress_made }
					has_deposit = d_quarantine_hospital
					num_assigned_jobs = {
						job = healthcare
						value > 0
					}
				}
				planet_event = { id = colony.2041 days = 21 random = 7 }
			}
		}
		# Dead Loop
		planet_event = { id = colony.2039 days = 28 random = 14 }
	}
	option = { name = OK }
}

## CURING PEOPLE (on +quarantine_hospital & warning)
planet_event = {
	id = colony.2041
	title = colony.2035.name
	desc = {
		text = colony.2041.desc # W. CLINIC
		# trigger = { }
		exclusive_trigger = { has_deposit = d_quarantine_hospital }
	}
	desc = {
		text = colony.2041.b.desc # W/O CLINIC colony.2045
		# trigger = { }
		exclusive_trigger = {
			NOT = { has_deposit = d_quarantine_hospital }
		}
	}
	picture = GFX_evt_microscopic_life
	show_sound = event_laboratory_sound
	location = root
	trigger = {
		has_planet_flag = colony_infected_active
		NOR = {
			has_planet_flag = healing_in_progress_msg
			has_planet_flag = plague_progress_made
		}
		owner = {
			NOT = { has_country_flag = alien_infection_2_cured }
		}
		any_owned_pop = { has_pop_flag = spreading_infection }
		# has_deposit = d_quarantine_hospital
		# num_assigned_jobs = {
		# 	job = healthcare
		# 	value > 0
		# }
	}
	# mean_time_to_happen = { days = 20 }
	# mean_time_to_happen = { days = 90 } # W/O CLINIC

	is_triggered_only = yes
	immediate = {
		set_planet_flag = healing_in_progress_msg
		set_timed_planet_flag = { flag = plague_progress_made days = 20 }
		# MTTH workaround
		owner = {
			if = { limit = { has_country_flag = alien_infection_1_cured }
				random_owned_planet = {
					limit = {
						has_planet_flag = colony_infected_active
						has_deposit = d_quarantine_hospital
						num_assigned_jobs = {
							job = healthcare
							value > 0
						}
					}
					planet_event = { id = colony.2042 days = 14 random = 7 }
				}
				random_owned_planet = {
					limit = { has_planet_flag = colony_infected_active }
					planet_event = { id = colony.2042 days = 70 random = 14 }
				}
			}
		}
	}
	after = {
		hidden_effect = {
			remove_planet_flag = healing_in_progress_msg
			# MTTH workaround
			owner = {
				if = {
					limit = {
						has_country_flag = alien_infection_2_cured
						NOT = {
							any_owned_planet = {
								has_planet_flag = colony_infected_active
								has_deposit = d_quarantine_hospital
								num_assigned_jobs = {
									job = healthcare
									value > 0
								}
							}
						}
					}
					# Try again?
					# remove_country_flag = alien_infection_2_cured
					random_owned_planet = {
						limit = { has_planet_flag = colony_infected_active }
						weights = {
							base = 1
							modifier = { add = 1 NOT = { is_same_value = root } }
						}
						planet_event = { id = colony.2041 days = 70 random = 21 }
					}
				}
				random_owned_planet = {
					limit = {
						has_planet_flag = colony_infected_active
						has_deposit = d_quarantine_hospital
						num_assigned_jobs = {
							job = healthcare
							value > 0
						}
					}
					weights = {
						base = 1
						modifier = { add = 1 NOR = { has_planet_flag = plague_progress_made is_same_value = root } }
					}
					planet_event = { id = colony.2041 days = 21 random = 7 }
				}
			}
		}
	}
	option = {
		name = EXCELLENT
		hidden_effect = {
			owner = {
				if = {
					limit = {
						has_country_flag = alien_infection_1_cured
						NOT = { has_country_flag = alien_infection_2_cured }
					}
					set_country_flag = alien_infection_2_cured
				}
				if = {
					limit = {
						NOT = { has_country_flag = alien_infection_1_cured }
					}
					set_country_flag = alien_infection_1_cured
				}
			}
			random_owned_pop = {
				limit = {
					OR = {
						has_modifier = alien_infection
						has_pop_flag = spreading_infection
					}
				}
				remove_modifier = alien_infection
				remove_pop_flag = spreading_infection
				# remove_pop_flag = alien_infection_timer
				# set_pop_flag = alien_infection_immunity
			}
		}
	}
}

## FINAL PLAGUE CURED - W. CLINIC (after 3rd attempt from colony.2041)
planet_event = {
	id = colony.2042
	title = colony.2035.name
	desc = colony.2042.desc
	picture = GFX_evt_physics_research
	show_sound = event_celebration
	location = root
	trigger = {
		has_planet_flag = colony_infected_active
		owner = {
			has_country_flag = colony_infected_active
			has_country_flag = alien_infection_1_cured
			# has_country_flag = alien_infection_2_cured
		}
		# has_deposit = d_quarantine_hospital
		# num_assigned_jobs = {
		# 	job = healthcare
		# 	value > 0
		# }
		# any_owned_pop = {
		# 	OR = {
		# 		has_modifier = alien_infection
		# 		has_pop_flag = spreading_infection
		# 	}
		# }
	}
	# mean_time_to_happen = { days = 7 }
	# mean_time_to_happen = { days = 75 } colony.2048 W/O CLINIC (time out)
	is_triggered_only = yes
	immediate = {
		remove_planet_flag = colony_infected_active
		remove_planet_flag = infection_warning
		owner = {
			if = {
				limit = {
					any_owned_planet = { has_planet_flag = colony_infected_active }
				}
				random_owned_planet = {
					limit = { has_planet_flag = colony_infected_active }
					planet_event = { id = colony.2042 days = 14 random = 7 }
				}
			}
			else = {
				remove_country_flag = alien_infection_1_cured
				remove_country_flag = alien_infection_2_cured
				remove_country_flag = colony_infected_active
			}
		}
		every_owned_pop = {
			limit = {
				OR = {
					has_modifier = alien_infection
					has_pop_flag = spreading_infection
				}
			}
			remove_modifier = alien_infection
			remove_pop_flag = spreading_infection
			# remove_pop_flag = alien_infection_timer
		}
		remove_modifier = infectious_disease
	}
	option = {
		name = SPLENDID
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier3influencereward
				min = @tier3influencemin
				max = @tier3influencemax
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
		hidden_effect = {
			if = { limit = { has_deposit = d_quarantine_hospital }
				remove_deposit = d_quarantine_hospital
				if = { limit = { num_assigned_jobs = { job = healthcare value > 0 } }
					add_deposit = d_plague_memorial
					owner = {
						add_monthly_resource_mult = {
							resource = unity
							value = @tier3unityreward
							min = @tier3unitymin
							max = @tier3unitymax
						}
					}
				}
			}
		}
	}
}

## PLAGUE ERRADICATED POPS LEFT
planet_event = {
	id = colony.2043
	title = colony.2035.name
	desc = colony.2043.desc
	picture = GFX_evt_city_ruins
	show_sound = event_laboratory_sound
	location = root
	trigger = {
		has_planet_flag = colony_infected_active
		owner = {
			has_country_flag = colony_infected_active
			NOT = { has_country_flag = alien_infection_isolated }
		}
		num_pops > 0
		count_owned_pop = {
			limit = {
				# OR = {
				# 	has_modifier = alien_infection
				has_pop_flag = spreading_infection
				# }
			}
			count < 1
		}
	}
	# mean_time_to_happen = { days = 7 }
	is_triggered_only = yes
	immediate = {
		remove_planet_flag = colony_infected_active
		remove_planet_flag = infection_warning
		owner = {
			if = {
				limit = {
					any_owned_planet = { has_planet_flag = colony_infected_active }
				}
				random_owned_planet = {
					limit = { has_planet_flag = colony_infected_active }
					planet_event = { id = colony.2042 days = 14 random = 7 }
				}
			}
			else = {
				remove_country_flag = alien_infection_1_cured
				remove_country_flag = alien_infection_2_cured
				remove_country_flag = colony_infected_active
			}
		}
		every_owned_pop = {
			remove_modifier = alien_infection
			remove_pop_flag = spreading_infection
			# remove_pop_flag = alien_infection_timer
		}
		if = { limit = { has_deposit = d_plague_memorial }
			remove_deposit = d_plague_memorial
		}
		remove_modifier = infectious_disease
	}
	option = {
		name = colony.2043.a
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier3influencereward
				min = @tier3influencemin
				max = @tier3influencemax
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
		hidden_effect = {
			if = { limit = { has_deposit = d_quarantine_hospital }
				remove_deposit = d_quarantine_hospital
				add_deposit = d_plague_memorial
			}
		}
	}
}

## PLAGUE ERRADICATED NO POPS LEFT.
planet_event = {
	id = colony.2044
	title = colony.2035.name
	desc = colony.2044.desc
	picture = GFX_evt_city_ruins
	show_sound = event_ghost_town
	location = root
	trigger = {
		has_planet_flag = colony_infected_active
		NOT = { has_planet_flag = healing_in_progress_msg }
		num_pops < 1
		OR = {
			has_owner = no
			NOT = { exists = owner }
			owner = { has_country_flag = colony_infected_active }
		}
	}
	is_triggered_only = yes
	immediate = {
		remove_planet_flag = colony_infected_active
		if = { limit = { exists = space_owner }
			space_owner = {
				if = {
					limit = {
						any_owned_planet = { has_planet_flag = colony_infected_active }
					}
					random_owned_planet = {
						limit = { has_planet_flag = colony_infected_active }
						planet_event = { id = colony.2042 days = 14 random = 7 }
					}
				}
				else = {
					remove_country_flag = alien_infection_1_cured
					remove_country_flag = alien_infection_2_cured
					remove_country_flag = colony_infected_active
				}
			}
		}
		set_timed_planet_flag = { flag = healing_in_progress_msg days = 10 }
		remove_planet_flag = infection_warning
		if = { limit = { has_deposit = d_quarantine_hospital }
			remove_deposit = d_quarantine_hospital
		}
		remove_modifier = infectious_disease
	}
	after = {
		hidden_effect = { remove_planet_flag = healing_in_progress_msg }
	}
	option = { name = colony.2043.a }
}
