############DARK MATTER EVENTS


namespace = dark_matter_event


#Dark Matter Rumor
country_event = {
	id = dark_matter_event.1
	title = dark_matter_event.1.name
	desc = dark_matter_event.1.desc
	picture = GFX_evt_physics_research
	show_sound = event_mystic_reveal

	trigger = {
		is_country_type = default
        has_technology = "tech_mine_dark_matter"
		has_technology = "tech_battleships"
		has_technology = "tech_zero_point_power"
		NOR = {
			has_country_flag = hear_dark_rumor
			has_technology = "tech_dark_matter_power_core"
			has_tech_option = tech_dark_matter_power_core
		}
    }
	
	mean_time_to_happen = {
		years = 5
	}

	immediate = {
		set_country_flag = hear_dark_rumor
		if = {
			limit = {
				NOT = {
					exists = event_target:dm_curators
				}
			 }	
			 random_country = {
				limit = {
					is_country_type = enclave
					has_country_flag = curator_enclave_country
				}
				save_global_event_target_as = dm_curators 
			}	
		}
	}
	
	option = {
		name = dark_matter_event.1.a
		trigger = {
			is_ai = no
		}
		begin_event_chain = {
			event_chain = acot_dm_tech_chain
		}
		capital_scope = {
			create_point_of_interest = {
				id = acot_dm_find_enigmatic.1
				name = "acot_dm_tech_find_enigmatic"
				desc = "acot_dm_tech_find_enigmatic_desc"
				event_chain = acot_dm_tech_chain
				location = this
			}	
			enable_special_project = {
				name = "RESEARCH_DARK_POWER_NORMAL"
				location = this
				owner = root
			}
			enable_special_project = {
				name = "RESEARCH_DARK_POWER_SMUGGLER"
				location = this
				owner = root
			}
			if = {
				limit = {
					owner = {
						NOR = {
							has_country_flag = attacked_curators
							has_valid_civic = civic_fanatic_purifiers
							has_valid_civic = civic_machine_terminator
							has_valid_civic = civic_hive_devouring_swarm
						}					
					} 
					any_country = {
						has_country_flag = curator_enclave_country
						has_established_contact = root
					}
				}
				enable_special_project = {
					name = "RESEARCH_DARK_POWER_CURATOR"
					location = this
					owner = root
				}					
			}		
		}
	}

	option = {
		name = EXCELLENT
		trigger = {
			is_ai = yes
		}		
		set_country_flag = learned_dark_rumor
	}
}

#Dark Matter Rumor SMUGGLER
country_event = {
	id = dark_matter_event.100
	hide_window = yes
	
	trigger = {
		is_ai = yes
		has_country_flag = learned_dark_rumor
		has_technology = tech_zero_point_power
		has_technology = tech_battleships
		has_technology = tech_starbase_5
		NOR = {
			has_technology = "tech_dark_matter_power_core"
			has_tech_option = tech_dark_matter_power_core		
		}
	}
	
	mean_time_to_happen = {
		years = 10
	}

    immediate = {
		if = {
			limit = {
				resource_stockpile_compare = {
					resource = energy
					value >= 15000	
				}
				any_country = {
					is_country_type = enclave
					has_country_flag = curator_enclave_country
					has_established_contact = root
				}
				NOR = {
					resource_stockpile_compare = {
						resource = minerals
						value >= 15000	
					}
					has_country_flag = attacked_curators
					has_valid_civic = civic_fanatic_purifiers
					has_valid_civic = civic_machine_terminator
					has_valid_civic = civic_hive_devouring_swarm
				}
			 }
			 add_resource = {
				 energy = -15000
			 }
			 country_event = { id = dark_matter_event.7 days = 30 random = 30 }
		}
		if = {
			limit = {
				resource_stockpile_compare = {
					resource = energy
					value >= 15000	
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= 15000	
				}
			 }
			 add_resource = {
				 energy = -15000
				 minerals = -15000
			 }
			 country_event = { id = dark_matter_event.7 days = 15 random = 15 }
		}
		else_if = {
			limit = {
				OR = {
					any_owned_leader = {
						leader_class = scientist
						has_skill > 5
						has_trait = leader_trait_curator
					}
					any_owned_leader = {
						leader_class = scientist
						has_skill > 5
						has_trait = leader_trait_scientist_psionic
					}
					any_owned_leader = {
						leader_class = scientist
						has_skill > 5
						has_trait = leader_trait_spark_of_genius
					}
					any_owned_leader = {
						leader_class = scientist
						has_skill > 5
						has_trait = leader_trait_scientist_erudite
					}
					any_owned_leader = {
						leader_class = scientist
						has_skill > 5
						has_trait = leader_trait_sapient_AI_assistant
					}
					any_owned_leader = {
						leader_class = scientist
						has_skill > 5
						has_trait = leader_trait_scientist_brainslug
					}
				}
			 }
			 country_event = { id = dark_matter_event.7 days = 720 random = 720 }
		}
    }
}

#Dark Matter Rumor DEFAULT
country_event = {
	id = dark_matter_event.2
	title = dark_matter_event.2.name
	desc = dark_matter_event.2.desc
	picture = GFX_evt_engineering_research
	show_sound = event_conversation
	
	is_triggered_only = yes

	
    immediate = {
		set_country_flag = learned_dark_rumor
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_CURATOR
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_CURATOR
			}	
		}
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_NORMAL
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_NORMAL
			}	
		}
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_SMUGGLER
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_SMUGGLER
			}	
		}
    }
	
    option = {
        name = dark_matter_event.2.a
        custom_tooltip = dark_matter_event.2.a.desc
		capital_scope = {
			create_point_of_interest = {
				id = acot_dm_tech_poi.1
				name = "acot_dm_tech_physics"
				desc = "acot_dm_tech_physics_desc"
				event_chain = acot_dm_tech_chain
				location = this
			}			
		}
    }
}

#Dark Matter SMUGGLER SUCCESS
country_event = {
	id = dark_matter_event.3
	title = dark_matter_event.3.name.a
	desc = dark_matter_event.3.desc.a
	picture = GFX_evt_laser_grid
	show_sound = event_smuggler_dm
	
	is_triggered_only = yes
	
    immediate = {
        set_country_flag = learned_dark_rumor
		set_country_flag = known_the_smuggler
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_CURATOR
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_CURATOR
			}	
		}
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_NORMAL
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_NORMAL
			}	
		}
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_SMUGGLER
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_SMUGGLER
			}	
		}
    }
	
    option = {
        name = dark_matter_event.3.a
		custom_tooltip = dark_matter_event.3.a.desc
		set_country_flag = know_dark_power_generation
		set_country_flag = know_dark_power_container
		give_technology = { tech = tech_dark_matter_generation }
		give_technology = { tech = tech_dark_matter_container }
		add_research_option = tech_dark_matter_strategy
		random_list = {
			20 = {
				add_resource = {
					energy = 1337
					minerals = 13337
				}
			}
			20 = {
				add_resource = {
					energy = 13337
					minerals = 1337
				}
			}
			20 = {
				add_resource = {
					energy = 10000
					minerals = 10000
				}
			}
			20 = {
				add_resource = {
					energy = 5000
					minerals = 5000
				}
			}
			20 = {
				add_resource = {
					energy = 15000
					minerals = 15000
				}
			}
		}
    }
}

#Dark Matter SMUGGLER FAIL
country_event = {
	id = dark_matter_event.31
	title = dark_matter_event.3.name.b
	desc = dark_matter_event.3.desc.b
	picture = GFX_evt_guardians
	show_sound = event_smuggler_dm
	
	is_triggered_only = yes
	
    immediate = {
        set_country_flag = learned_dark_rumor
		set_country_flag = known_the_smuggler
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_CURATOR
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_CURATOR
			}	
		}
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_NORMAL
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_NORMAL
			}	
		}
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_SMUGGLER
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_SMUGGLER
			}	
		}
		random_country = {
			limit = {
				is_fallen_empire = yes
				is_fallen_empire_machine = no
			}
			add_opinion_modifier = {
				who = root
				modifier = opinion_majorly_failed_fallen_empire_task
			}
			add_opinion_modifier = {
				who = root
				modifier = opinion_majorly_failed_fallen_empire_task
			}
		}
    }
	
    option = {
        name = dark_matter_event.3.b
		custom_tooltip = dark_matter_event.3.b.desc
		set_country_flag = know_dark_power_generation
		set_country_flag = know_dark_power_container
		give_technology = { tech = tech_dark_matter_generation }
		give_technology = { tech = tech_dark_matter_container }
		add_research_option = tech_dark_matter_strategy
    }
}

#WARNING! YOU ARE TALKING TO RAPTORUS
country_event = {
	id = dark_matter_event.30
	title = dark_matter_event.30.name
	desc = {
		text = dark_matter_event.30.desc.a
		trigger = {
			NOT = {		
				has_country_flag = met_the_smuggler	
			}
		}
	}
	desc = {
		text = dark_matter_event.30.desc.b
		trigger = {
			has_country_flag = met_the_smuggler
		}
	}
	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		room = sofe_smuggler_room
	}

	immediate = {
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_SMUGGLER
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_SMUGGLER
			}	
		}
	}

	option = {
		name = dark_matter_event.30.a
		is_dialog_only = yes
		response_text = dark_matter_event.30.a.explain
	}

	option = {
		name = dark_matter_event.30.b
		response_text = dark_matter_event.30.b.explain
		default_hide_option = yes
		hidden_effect = {
			capital_scope = {
				enable_special_project = {
					name = "RESEARCH_DARK_POWER_SMUGGLER"
					location = this
					owner = root
				}
			}			
		}		
	}

	option = {
		name = dark_matter_event.30.c
		response_text = dark_matter_event.30.c.explain	
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value >= 25000	
			}
			resource_stockpile_compare = {
				resource = minerals
				value >= 25000	
			}
		}	
		add_resource = {
			minerals = -25000
			energy = -25000
		}
		hidden_effect = {
			random_list = {
				65 = {
					country_event = { id = dark_matter_event.3 days = 30 }
				}
				35 = {
					country_event = { id = dark_matter_event.31 days = 30 }
				}
			}
		}
	}

	after = {
		set_country_flag = met_the_smuggler	
	}
}

#Dark Matter CURATOR GOOD
country_event = {
	id = dark_matter_event.4
	title = dark_matter_event.4.name
	desc = dark_matter_event.4.desc.a
	picture = GFX_evt_ancient_databank
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
    immediate = {
		set_country_flag = learned_dark_rumor
		set_country_flag = know_dark_power_generation
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_CURATOR
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_CURATOR
			}	
		}
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_NORMAL
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_NORMAL
			}	
		}
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_SMUGGLER
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_SMUGGLER
			}	
		}
    }
	
    option = {
        name = dark_matter_event.4.a
		custom_tooltip = dark_matter_event.4.a.desc
		set_country_flag = know_dark_power_generation
		give_technology = { tech = tech_dark_matter_generation }
		add_research_option = tech_dark_matter_container
    }
}

#Dark Matter CURATOR BAD
country_event = {
	id = dark_matter_event.41
	title = dark_matter_event.4.name
	desc = dark_matter_event.4.desc.b
	picture = GFX_evt_ancient_databank
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
    immediate = {
		set_country_flag = learned_dark_rumor
		set_country_flag = know_dark_power_generation
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_CURATOR
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_CURATOR
			}	
		}
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_NORMAL
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_NORMAL
			}	
		}
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_SMUGGLER
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_SMUGGLER
			}	
		}
		every_country = {
			limit = {
				is_fallen_empire = yes
				is_fallen_empire_machine = no
			}
			add_opinion_modifier = {
				who = ROOT
				modifier = opinion_failed_fallen_empire_task
			}
		}
    }
	
    option = {
        name = dark_matter_event.4.b
		custom_tooltip = dark_matter_event.4.b.desc
		set_country_flag = know_dark_power_generation
		give_technology = { tech = tech_dark_matter_generation }
		add_research_option = tech_dark_matter_container
    }
}


#WARNING! YOU ARE TALKING TO CURATOR
country_event = {
	id = dark_matter_event.40
	title = dark_matter_event.40.name
	desc = {
		text = dark_matter_event.40.desc.a
		trigger = {
			NOT = {		
				has_country_flag = attacked_curators	
			}
		}
	}
	desc = {
		text = dark_matter_event.40.desc.b
		trigger = {
			has_country_flag = asked_curator_once
		}
	}
	is_triggered_only = yes
	diplomatic = yes

	custom_gui = "enclave_curator_window"

	picture_event_data = {
		portrait = event_target:dm_curators
		room = enclave_curator_room
	}
	immediate = {
		if = {
			limit = {
				has_special_project = RESEARCH_DARK_POWER_CURATOR
			 }
			 abort_special_project = {
				type = RESEARCH_DARK_POWER_CURATOR
			}	
		}
	}

	option = {
		name = dark_matter_event.40.a
		is_dialog_only = yes
		response_text = dark_matter_event.40.a.explain
	}

	option = {
		name = dark_matter_event.40.b
		response_text = dark_matter_event.40.b.explain
		default_hide_option = yes
		if = {
			limit = {
				NOT = {
					has_country_flag = asked_curator_once
				}
			 }
			set_country_flag = asked_curator_once
		}
		hidden_effect = {
			capital_scope = {
				enable_special_project = {
					name = "RESEARCH_DARK_POWER_CURATOR"
					location = this
					owner = root
				}
			}			
		}		
	}

	option = {
		name = dark_matter_event.40.c
		response_text = dark_matter_event.40.c.explain	
		custom_tooltip = dark_matter_event.40.c.tooltip	
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value >= 10000	
			}
			any_owned_leader = {
				leader_class = scientist
				has_skill >= 5 
				NOT = {
					has_trait = leader_trait_curator
				}
			}
		}	
		add_resource = {
			energy = -10000
		}
		random_owned_leader = {
			limit = {
				has_skill >= 5
				leader_class = scientist
				NOT = {
					has_trait = leader_trait_curator
				}
			}
			kill_leader = {
				show_notification = no
				type = scientist
			}	
		}
		hidden_effect = {
			random_list = {
				50 = {
					country_event = { id = dark_matter_event.4 days = 5 }
				}
				50 = {
					modifier = {
						add = 20
						event_target:dm_curators = {
							opinion = {
								who = ROOT
								value < 80
							}
						}
					}
					modifier = {
						add = 0
						event_target:dm_curators = {
							opinion = {
								who = ROOT
								value = 100
							}
						}
					}
					country_event = { id = dark_matter_event.41 days = 5 }
				}
			}
		}
	}
}

#Dark Matter Power Generation Learned
country_event = {
	id = dark_matter_event.5
	title = dark_matter_event.5.name
	desc = dark_matter_event.5.desc
	picture = GFX_evt_physics_research
	show_sound = event_power_dm
	is_triggered_only = yes

	trigger = {
		last_increased_tech = tech_dark_matter_generation
		NOR = {
			has_country_flag = know_dark_power_generation
			has_technology = "tech_dark_matter_power_core"
			has_tech_option = tech_dark_matter_power_core
		}
	}
	
	
	immediate = {
		set_country_flag = know_dark_power_generation
		add_resource = {
			sr_dark_matter = 500
		}
	}
	
    option = {
        name = dark_matter_event.5.a
        custom_tooltip = dark_matter_event.5.a.desc
		remove_point_of_interest = acot_dm_tech_poi.1
		capital_scope = {
			create_point_of_interest = {
				id = acot_dm_tech_poi.2
				name = "acot_dm_tech_engineers"
				desc = "acot_dm_tech_engineers_desc"
				event_chain = acot_dm_tech_chain
				location = this
			}				
		}
    }
}

#Dark Matter Power Container Learned
country_event = {
	id = dark_matter_event.6
	title = dark_matter_event.6.name
	desc = dark_matter_event.6.desc
	picture = GFX_evt_engineering_research
	show_sound = event_container_dm
	is_triggered_only = yes

	trigger = {
		last_increased_tech = tech_dark_matter_container
		NOR = {
			has_country_flag = know_dark_power_container
			has_technology = "tech_dark_matter_power_core"
			has_tech_option = tech_dark_matter_power_core
		}
	}

	
	immediate = {
		owner = {
			set_country_flag = know_dark_power_container
		}
	}
	
    option = {
        name = dark_matter_event.6.a
        custom_tooltip = dark_matter_event.6.a.desc
		remove_point_of_interest = acot_dm_tech_poi.2
		capital_scope = {
			create_point_of_interest = {
				id = acot_dm_tech_poi.3
				name = "acot_dm_tech_social"
				desc = "acot_dm_tech_social_desc"
				event_chain = acot_dm_tech_chain
				location = this
			}				
		}		
    }
}

#Dark Matter Power Application Learned
country_event = {
	id = dark_matter_event.7
	title = dark_matter_event.7.name
	desc = dark_matter_event.7.desc
	picture = GFX_evt_physics_research
	show_sound = event_mystic_reveal
	is_triggered_only = yes

	trigger = {
		last_increased_tech = tech_dark_matter_strategy
		NOR = {
			has_country_flag = know_dark_power_strategy
			has_technology = "tech_dark_matter_power_core"
			has_tech_option = tech_dark_matter_power_core
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = know_dark_power_strategy
		}
	}
	
    option = {
        name = dark_matter_event.7.a
        custom_tooltip = dark_matter_event.7.a.desc
		remove_point_of_interest = acot_dm_tech_poi.3
		add_research_option = tech_dark_matter_power_core
		add_research_option = tech_dark_matter_deflector
		add_research_option = tech_dark_matter_propulsion
    }
}

#Dark Matter Power FINAL
country_event = {
	id = dark_matter_event.8
	title = dark_matter_event.8.name
	desc = dark_matter_event.8.desc
	picture = GFX_evt_alien_propaganda
	show_sound = event_yes_yes
	is_triggered_only = yes

	trigger = {
		years_passed >= 2
		last_increased_tech = tech_dark_matter_power_core
		NOT = {	has_country_flag = know_dark_power_final }
	}
	
	immediate = {
		set_country_flag = know_dark_power_final
		set_timed_country_flag = {
			flag = ae_dark_power_delay
			years = 15
		}
	}
	
    option = {
        name = dark_matter_event.8.a
		custom_tooltip = dark_matter_event.8.a.desc
		save_event_target_as = new_dm_country
		if = {
			limit = {
				NOT = { has_technology = tech_dark_matter_generation }
			}
		give_technology = { tech = tech_dark_matter_generation message = no }
		}
		if = {
			limit = {
				NOT = { has_technology = tech_dark_matter_container }
			}
		give_technology = { tech = tech_dark_matter_container message = no }
		}
		if = {
			limit = {
				NOT = { has_technology = tech_dark_matter_strategy }
			}
		give_technology = { tech = tech_dark_matter_strategy message = no }
		}
		if = {
			limit = {
				has_event_chain = acot_dm_tech_chain
			 }
			end_event_chain = acot_dm_tech_chain
		}
		if = {
			limit = { 
				is_ai = yes
			}
			add_resource = {
				sr_dark_matter = 500
			}
		}
		hidden_effect = {
			every_playable_country = {
				limit = {
					ROOT = {
						is_country_type = default
					}
					NOT = {
						is_same_value = root
					}
				}
				country_event = { id = dark_matter_event.9 }
			}			
		}
    }
}

#Dark Matter Power Annoucement
country_event = {
	id = dark_matter_event.9
	title = dark_matter_event.9.name
	desc = dark_matter_event.9.desc
	picture = GFX_evt_physics_research
	show_sound = event_radio_chatter
	is_triggered_only = yes
	
    option = {
        name = dark_matter_event.9.a
	}
}