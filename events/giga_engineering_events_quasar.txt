namespace = gigaquasar

#main menu
country_event = {
	id = gigaquasar.1
	title = gigaquasar.1.name
	desc = gigaquasar.1.desc
	show_sound = event_mystic_reveal
	location = fromfrom

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = ROOT.species
		room = gigaquasar_room
	}

	#pick target
	option = {
		name = gigaquasar.1.fire
		hidden_effect = {
			country_event = { id = gigaquasar.10 }
		}
	}

	#parameters
	option = {
		name = gigaquasar.1.parameters
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
		}
	}

	#quit
	option = {
		name = gigaquasar.1.quit
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
		}
	}
}

###################################################################OPTIONS###################################################################


country_event = {
	id = gigaquasar.500
	title = gigaquasar.500.name
	desc = gigaquasar.500.desc
	location = fromfrom

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = ROOT.species
		room = gigaquasar_room
	}

	#increase
	option = {
		name = gigaquasar.500.increase
		allow = {
			NOT = {
				has_country_flag = qso_intensity_physicslimits
			}
		}
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
			if = {
				limit = {
					has_country_flag = qso_intensity_none
				}
				remove_country_flag = qso_intensity_none
				set_country_flag = qso_intensity_verylow
				add_modifier = { modifier = qso_intensity_verylow }
				remove_modifier = "qso_intensity_none"
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_verylow
				}
				remove_country_flag = qso_intensity_verylow
				set_country_flag = qso_intensity_low
				add_modifier = { modifier = qso_intensity_low }
				remove_modifier = "qso_intensity_verylow"
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_low
				}
				remove_country_flag = qso_intensity_low
				set_country_flag = qso_intensity_med
				remove_modifier = "qso_intensity_low"
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_med
				}
				remove_country_flag = qso_intensity_med
				set_country_flag = qso_intensity_high
				add_modifier = { modifier = qso_intensity_high }
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_high
				}
				remove_country_flag = qso_intensity_high
				set_country_flag = qso_intensity_veryhigh
				add_modifier = { modifier = qso_intensity_veryhigh }
				remove_modifier = "qso_intensity_high"
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_veryhigh
				}
				remove_country_flag = qso_intensity_veryhigh
				set_country_flag = qso_intensity_extremely
				add_modifier = { modifier = qso_intensity_extremely }
				remove_modifier = "qso_intensity_veryhigh"
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_extremely
				}
				remove_country_flag = qso_intensity_extremely
				set_country_flag = qso_intensity_insane
				add_modifier = { modifier = qso_intensity_insane }
				remove_modifier = "qso_intensity_extremely"
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_insane
				}
				remove_country_flag = qso_intensity_insane
				set_country_flag = qso_intensity_physicslimits
				add_modifier = { modifier = qso_intensity_physicslimits }
				remove_modifier = "qso_intensity_insane"
			}
		}
	}

	#intensity display
	option = {
		name = gigaquasar.500.intensityphysicslimits
		trigger = {
			has_country_flag = qso_intensity_physicslimits
		}
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
		}
	}

	option = {
		name = gigaquasar.500.intensityinsane
		trigger = {
			has_country_flag = qso_intensity_insane
		}
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
		}
	}

	option = {
		name = gigaquasar.500.intensityextremely
		trigger = {
			has_country_flag = qso_intensity_extremely
		}
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
		}
	}

	option = {
		name = gigaquasar.500.intensityveryhigh
		trigger = {
			has_country_flag = qso_intensity_veryhigh
		}
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
		}
	}

	option = {
		name = gigaquasar.500.intensityhigh
		trigger = {
			has_country_flag = qso_intensity_high
		}
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
		}
	}

	option = {
		name = gigaquasar.500.intensitymed
		trigger = {
			has_country_flag = qso_intensity_med
		}
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
		}
	}

	option = {
		name = gigaquasar.500.intensitylow
		trigger = {
			has_country_flag = qso_intensity_low
		}
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
		}
	}

	option = {
		name = gigaquasar.500.intensityverylow
		trigger = {
			has_country_flag = qso_intensity_verylow
		}
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
		}
	}

	option = {
		name = gigaquasar.500.intensitynone
		trigger = {
			has_country_flag = qso_intensity_none
		}
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
		}
	}

	#decrease
	option = {
		name = gigaquasar.500.decrease
		allow = {
			NOT = {
				has_country_flag = qso_intensity_none
			}
		}
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
			if = {
				limit = {
					has_country_flag = qso_intensity_physicslimits
				}
				remove_country_flag = qso_intensity_physicslimits
				set_country_flag = qso_intensity_insane
				add_modifier = { modifier = qso_intensity_insane }
				remove_modifier = "qso_intensity_physicslimits"
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_insane
				}
				remove_country_flag = qso_intensity_insane
				set_country_flag = qso_intensity_extremely
				add_modifier = { modifier = qso_intensity_extremely }
				remove_modifier = "qso_intensity_insane"
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_extremely
				}
				remove_country_flag = qso_intensity_extremely
				set_country_flag = qso_intensity_veryhigh
				add_modifier = { modifier = qso_intensity_veryhigh }
				remove_modifier = "qso_intensity_extremely"
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_veryhigh
				}
				remove_country_flag = qso_intensity_veryhigh
				set_country_flag = qso_intensity_high
				add_modifier = { modifier = qso_intensity_high }
				remove_modifier = "qso_intensity_veryhigh"
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_high
				}
				remove_country_flag = qso_intensity_high
				set_country_flag = qso_intensity_med
				remove_modifier = "qso_intensity_high"
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_med
				}
				remove_country_flag = qso_intensity_med
				set_country_flag = qso_intensity_low
				add_modifier = { modifier = qso_intensity_low }
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_low
				}
				remove_country_flag = qso_intensity_low
				set_country_flag = qso_intensity_verylow
				add_modifier = { modifier = qso_intensity_verylow }
				remove_modifier = "qso_intensity_low"
			}
			else_if = {
				limit = {
					has_country_flag = qso_intensity_verylow
				}
				remove_country_flag = qso_intensity_verylow
				set_country_flag = qso_intensity_none
				add_modifier = { modifier = qso_intensity_none }
				remove_modifier = "qso_intensity_verylow"
			}
		}
	}

	#dump stuff
	option = {
		name = gigaquasar.500.dump
		hidden_effect = {
			country_event = { id = gigaquasar.501 }
		}
	}

	#back to menu
	option = {
		name = gigaquasar.1.menu
		hidden_effect = {
			country_event = { id = gigaquasar.1 }
		}
	}

	#quit
	option = {
		name = gigaquasar.1.quit
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
		}
	}
}

#dump resources
country_event = {
	id = gigaquasar.501
	title = gigaquasar.501.name
	desc = gigaquasar.501.desc
	location = fromfrom

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = ROOT.species
		room = gigaquasar_room
	}

	#dump minerals
	option = {
		name = gigaquasar.500.minerals
		allow = {
			resource_stockpile_compare = { resource = minerals value >= 100000 }
		}
		hidden_effect = {
			add_resource = {
				minerals = -100000
			}
			country_event = { id = gigaquasar.501 }
		}
	}

	#dump alloys
	option = {
		name = gigaquasar.500.alloys
		allow = {
			resource_stockpile_compare = { resource = alloys value >= 50000 }
		}
		hidden_effect = {
			add_resource = {
				sr_magical_neutronium = 30
			}
			add_resource = {
				alloys = -50000
			}
			country_event = { id = gigaquasar.501 }
		}
	}

	#dump food
	option = {
		name = gigaquasar.500.food
		allow = {
			resource_stockpile_compare = { resource = food value >= 50000 }
		}
		hidden_effect = {
			add_resource = {
				sr_magical_neutronium = 30
			}
			add_resource = {
				food = -50000
			}
			country_event = { id = gigaquasar.501 }
		}
	}

	#dump consumer goods
	option = {
		name = gigaquasar.500.goods
		allow = {
			resource_stockpile_compare = { resource = consumer_goods value >= 70000 }
		}
		hidden_effect = {
			add_resource = {
				sr_magical_neutronium = 30
			}
			add_resource = {
				consumer_goods = -70000
			}
			country_event = { id = gigaquasar.501 }
		}
	}

	#dump undesirables (that's messed up)
	option = {
		name = gigaquasar.500.undesirable
		custom_tooltip = gigaquasar.500.undesirable.tooltip
		allow = {
			count_owned_pops = {
				limit = {
					has_citizenship_type = { country = root type = citizenship_purge }
				}
				count > 25
			}
		}
		hidden_effect = {
			add_resource = {
				sr_magical_neutronium = 5
			}
			while = {
				count = 25
				random_owned_pop = {
					limit = {
						has_citizenship_type = { country = root type = citizenship_purge }
					}
					kill_pop = yes
				}
			}
			country_event = { id = gigaquasar.501 }
		}
	}

	option = {
		name = gigaquasar.1.panel
		hidden_effect = {
			country_event = { id = gigaquasar.500 }
		}
	}

	#back to menu
	option = {
		name = gigaquasar.1.menu
		hidden_effect = {
			country_event = { id = gigaquasar.1 }
		}
	}

	#quit
	option = {
		name = gigaquasar.1.quit
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
		}
	}
}

###################################################################DESTRUCTION###################################################################
#fire panel
country_event = {
	id = gigaquasar.10
	title = gigaquasar.10.name
	desc = gigaquasar.10.desc
	location = fromfrom

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = ROOT.species
		room = gigaquasar_room
	}

	#fleet
	option = {
		name = gigaquasar.10.fleet
		hidden_effect = {
			country_event = { id = gigaquasar.200 } #initiates fire at fleet event chain
		}
	}

	#planet
	option = {
		name = gigaquasar.10.planet
		hidden_effect = {
			country_event = { id = gigaquasar.100 } #initiates fire at planet event chain
		}
	}

	#star
	option = {
		name = gigaquasar.10.star
		hidden_effect = {
			country_event = { id = gigaquasar.300 } #initiates fire at star event chain
		}
	}

	#several stars
	option = {
		name = gigaquasar.10.starcluster
		hidden_effect = {
			country_event = { id = gigaquasar.400 } #initiates fire at cluster event chain
		}
	}

	#back to menu
	option = {
		name = gigaquasar.1.menu
		hidden_effect = {
			country_event = { id = gigaquasar.1 }
		}
	}

	#quit
	option = {
		name = gigaquasar.1.quit
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
		}
	}
}

###################################################################CLUSTER DESTRUCTION###################################################################
country_event = {
	id = gigaquasar.400
	title = gigaquasar.400.name
	desc = gigaquasar.400.desc
	location = fromfrom

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = ROOT.species
		room = gigaquasar_room
	}

	#destroy star
	option = {
		name = gigaquasar.100.yes
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 120 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			set_country_flag = quasistellar_cluster_busting #used to bring up the different menu when opening the panel again
			save_global_event_target_as = quasistellar_owner #used to scope to the country owning the quasistellar
		}
	}
	#cancel
	option = {
		name = gigaquasar.100.no
		hidden_effect = {
			country_event = { id = gigaquasar.10 }
		}
	}
}

#place the markers
country_event = {
	id = gigaquasar.401
	title = gigaquasar.401.name
	desc = gigaquasar.401.desc
	show_sound = event_mystic_reveal
	location = fromfrom

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = ROOT.species
		room = gigaquasar_room
	}

	#FIRE!
	option = {
		name = gigaquasar.401.fire #STAR CLUSTER
		trigger = {
			has_country_flag = qso_1
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 120 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_cluster_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.402 }
		}
	}

	#not done with markers
	option = {
		name = gigaquasar.401.markers
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
		}
	}


	#cancel
	option = {
		name = gigaquasar.101.cancel
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_cluster_busting
			remove_country_flag = qso_1
			no_scope = {
				every_megastructure = {
					limit = { is_megastructure_type = quasi_stellar_marker_cluster }
					remove_megastructure = THIS
				}
				every_planet = {
					limit = { has_planet_flag = quasistellar_target_cluster }
					remove_planet_flag = quasistellar_target_cluster
				}
			}
		}
	}
}

#upgrade all markers
country_event = {
	id = gigaquasar.402
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		country_event = { id = gigaquasar.4031 days = 15 }
		every_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_marker_cluster
			}
			upgrade_megastructure_to = quasi_stellar_marker_cluster_open
		}
	}
}


country_event = { #blast
	id = gigaquasar.4031
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		country_event = { id = gigaquasar.403 days = 5 }
		every_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_marker_cluster_open
			}
			upgrade_megastructure_to = quasi_stellar_marker_cluster_firing
		}
	}
}

country_event = { #blast
	id = gigaquasar.403
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		event_target:quasistellar_owner = {
			country_event = { id = gigaquasar.405 days = 2 } #after 15 days of blasting, delete all portals and reset the QSO system
		}
		every_planet = {
			limit = {
				has_planet_flag = quasistellar_target_cluster
			}
			add_threat = { who = root amount = 4 } #threat
			solar_system = {
				if = { #system inhabited and has a colony
					limit = {
						any_system_planet = {
							is_colony = yes
						}
						NOT = {
							space_owner = {
								is_country_type = ai_empire
								is_country_type = swarm
								is_country_type = extradimensional
								is_country_type = extradimensional_2
								is_country_type = extradimensional_3
							}
						}
					}
					every_country = {
						limit = {
							NOT = { is_country_type = primitive }
							NOT = { is_country = ROOT }
							NOT = { is_in_federation_with = ROOT }
							NOR = { #purgers don't care
								has_valid_civic = civic_fanatic_purifiers
								has_valid_civic = civic_hive_devouring_swarm
								has_valid_civic = civic_machine_terminator
							}
						}
						add_opinion_modifier = { who = ROOT modifier = opinion_broke_system }
					}
					space_owner = {
						remove_opinion_modifier = { who = ROOT modifier = opinion_broke_system }
						add_opinion_modifier = { who = ROOT modifier = opinion_broke_our_system }
					}
				}
				else_if = { #system claimed but no colony
					limit = {
						NOT = { any_system_planet = { is_colony = yes } }
						exists = owner
						owner = {
							NOR = {
								is_country_type = ai_empire
								is_country_type = swarm
								is_country_type = extradimensional
								is_country_type = extradimensional_2
								is_country_type = extradimensional_3
							}
						}
					}
					every_country = {
						limit = {
							NOR = {
								is_country_type = primitive
								is_country = ROOT
								is_in_federation_with = ROOT
								has_valid_civic = civic_fanatic_purifiers
								has_valid_civic = civic_hive_devouring_swarm
								has_valid_civic = civic_machine_terminator
							}
						}
						add_opinion_modifier = { who = ROOT modifier = opinion_broke_empty_system }
					}
					space_owner = {
						remove_opinion_modifier = { who = ROOT modifier = opinion_broke_empty_system }
						add_opinion_modifier = { who = ROOT modifier = opinion_broke_our_empty_system }
					}
				}
				if = { #automatically declare war (lol)
					limit = {
						space_owner = {
							exists = THIS
							NOT = {
								is_at_war_with = event_target:quasistellar_owner
							}
							NOR = {
								is_country_type = ai_empire
								is_country_type = swarm
								is_country_type = extradimensional
								is_country_type = extradimensional_2
								is_country_type = extradimensional_3
							}
						}
					}
					space_owner = {
						declare_war = {
							target = event_target:quasistellar_owner
							attacker_war_goal = "wg_end_threat_hyperweapon"
						}
					}
				}
				if = {
					limit = {
						any_system_planet = {
							is_planet_class = pc_ai
							NOT = {
								has_planet_flag = machine_lair
							}
						}
					}
					random_system_planet = {
						limit = {
							is_planet_class = pc_ai
						}
						planet_event = { id = gigaquasar.111 } #contingency planet
						every_country = {
							country_event = { id = gigaquasar.110 } #message
						}
					}
				}
				if = {
					limit = {
						any_system_planet = {
							is_planet_class = pc_ai
							has_planet_flag = machine_lair
						}
					}
					random_system_planet = {
						limit = {
							is_planet_class = pc_ai
						}
						planet_event = { id = gigaquasar.113 } #contingency planet
						every_country = {
							country_event = { id = gigaquasar.112 } #message to everyone
						}
					}
				}
				every_system_planet = {
					limit = {
						is_colony = yes
					}
					planet_event = { id = gigaquasar.130 }
				}
				every_system_planet = {
					limit = {
						is_planet_class = pc_infested
					}
					planet_event = { id = gigaquasar.115 } #infested world
				}
				every_neighbor_system = {
					random_system_planet = {
						limit = {
							is_star = yes
						}
						planet_event = { id = gigaquasar.404 days = 2 }
					}
					remove_hyperlane = {
						from = PREV
						to = THIS
					}
				}
				every_system_planet = {
					limit = {
						is_star = no
					}
					remove_planet = yes
				}
				every_system_planet = {
					limit = {
						is_star = yes
						NOT = {
							is_planet_class = pc_core_quasar
						}
					}
					clear_deposits = yes
					change_pc = pc_giga_empty_space
					set_name = "Empty Space"
				}
				set_asteroid_belt = {
					radius = 0
				}
				every_system_megastructure = {
					limit = {
						NOT = {
							is_megastructure_type = quasi_stellar_marker_cluster_firing
						}
					}
					remove_megastructure = this
				}
				every_fleet_in_system = { destroy_fleet = this }
				every_system_ambient_object = { destroy_ambient_object = this }
				every_system_planet = {
					limit = {
						is_star = yes
					}
					planet_event = { id = gigaquasar.406 }
				}
			}
			remove_planet_flag = quasistellar_target_cluster
		}
	}
}

planet_event = { #blast (neighbors)
	id = gigaquasar.404
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		add_threat = { who = event_target:quasistellar_owner amount = 4 } #threat
		solar_system = {
			if = { #system inhabited and has a colony
				limit = {
					any_system_planet = {
						is_colony = yes
					}
					NOT = {
						space_owner = {
							is_country_type = ai_empire
							is_country_type = swarm
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
						}
					}
				}
				every_country = {
					limit = {
						NOT = { is_country_type = primitive }
						NOT = { is_country = event_target:quasistellar_owner }
						NOT = { is_in_federation_with = event_target:quasistellar_owner }
						NOR = { #purgers don't care
							has_valid_civic = civic_fanatic_purifiers
							has_valid_civic = civic_hive_devouring_swarm
							has_valid_civic = civic_machine_terminator
						}
					}
					add_opinion_modifier = { who = event_target:quasistellar_owner modifier = opinion_broke_system }
				}
				space_owner = {
					remove_opinion_modifier = { who = event_target:quasistellar_owner modifier = opinion_broke_system }
					add_opinion_modifier = { who = event_target:quasistellar_owner modifier = opinion_broke_our_system }
				}
			}
			else_if = { #system claimed but no colony
				limit = {
					NOT = {
						any_system_planet = {
							is_colony = yes
						}
					}
					space_owner = {
						exists = THIS
					}
					NOT = {
						space_owner = {
							is_country_type = ai_empire
							is_country_type = swarm
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
						}
					}
				}
				every_country = {
					limit = {
						NOT = { is_country_type = primitive }
						NOT = { is_country = event_target:quasistellar_owner }
						NOT = { is_in_federation_with = event_target:quasistellar_owner }
						NOR = { #purgers don't care
							has_valid_civic = civic_fanatic_purifiers
							has_valid_civic = civic_hive_devouring_swarm
							has_valid_civic = civic_machine_terminator
						}
					}
					add_opinion_modifier = { who = event_target:quasistellar_owner modifier = opinion_broke_empty_system }
				}
				space_owner = {
					remove_opinion_modifier = { who = event_target:quasistellar_owner modifier = opinion_broke_empty_system }
					add_opinion_modifier = { who = event_target:quasistellar_owner modifier = opinion_broke_our_empty_system }
				}
			}
			if = { #automatically declare war (lol)
				limit = {
					space_owner = {
						exists = THIS
						NOT = {
							is_at_war_with = event_target:quasistellar_owner
						}
						NOR = {
							is_country_type = ai_empire
							is_country_type = swarm
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
						}
					}
				}
				space_owner = {
					declare_war = {
						target = event_target:quasistellar_owner
						attacker_war_goal = "wg_end_threat_hyperweapon"
					}
				}
			}
			if = {
				limit = {
					any_system_planet = {
						is_planet_class = pc_ai
						NOT = {
							has_planet_flag = machine_lair
						}
					}
				}
				random_system_planet = {
					limit = {
						is_planet_class = pc_ai
					}
					planet_event = { id = gigaquasar.111 } #contingency planet
					every_country = {
						country_event = { id = gigaquasar.110 } #message
					}
				}
			}
			if = {
				limit = {
					any_system_planet = {
						is_planet_class = pc_ai
						has_planet_flag = machine_lair
					}
				}
				random_system_planet = {
					limit = {
						is_planet_class = pc_ai
					}
					planet_event = { id = gigaquasar.113 } #contingency planet
					every_country = {
						country_event = { id = gigaquasar.112 } #message to everyone
					}
				}
			}
			every_system_planet = {
				limit = {
					is_colony = yes
				}
				planet_event = { id = gigaquasar.130 }
			}
			every_neighbor_system = {
				remove_hyperlane = {
					from = PREV
					to = THIS
				}
			}
			every_system_planet = {
				limit = {
					is_star = no
				}
				remove_planet = yes
			}
			every_system_planet = {
				limit = {
					is_star = yes
					NOT = {
						is_planet_class = pc_core_quasar
					}
				}
				clear_deposits = yes
				change_pc = pc_giga_empty_space
				set_name = "Empty Space"
			}
			set_asteroid_belt = {
				radius = 0
			}
			every_fleet_in_system = { destroy_fleet = this }
			every_system_ambient_object = { destroy_ambient_object = this }
			every_system_planet = {
				limit = {
					is_star = yes
				}
				planet_event = { id = gigaquasar.406 }
			}
		}
	}
}

country_event = {
	id = gigaquasar.405 #reset everything
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		remove_country_flag = quasistellar_firing
		remove_country_flag = qso_1
		every_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_marker_cluster_firing
			}
			remove_megastructure = this
		}
		random_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_obliterator_firing_1
			}
			solar_system = {
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_1
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_2
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_3
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_4
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_5
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_6
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_big
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_gateway_on
					}
					remove_megastructure = this
				}
				spawn_megastructure = {
					type = quasi_stellar_gateway_off
					location = solar_system
					owner = space_owner
				}
				spawn_megastructure = {
					type = quasi_stellar_obliterator_5
					location = solar_system
					owner = space_owner
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_1
					}
					remove_megastructure = this
				}
			}
		}
	}
}

planet_event = {
	id = gigaquasar.406 #explosion
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		create_ambient_object = {
			type = penrose_sphere_explosion_object
			location = ROOT
			duration = 20

			use_3d_location = yes

			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }

			entity_scale_to_size = no
			scale = 2
		}
		create_ambient_object = {
			type = penrose_sphere_explosion_object
			location = ROOT
			duration = 20

			use_3d_location = yes

			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }

			entity_scale_to_size = no
			scale = 2
		}
		create_ambient_object = {
			type = "nebula_L8_entity"
			location = THIS
		}
		create_ambient_object = {
			type = "nebula_L10_entity"
			location = THIS
		}
	}
}


###################################################################STAR DESTRUCTION###################################################################
country_event = {
	id = gigaquasar.300
	title = gigaquasar.300.name
	desc = gigaquasar.300.desc
	location = fromfrom

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = ROOT.species
		room = gigaquasar_room
	}

	#destroy star
	option = {
		name = gigaquasar.100.yes
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 40 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			set_country_flag = quasistellar_stellar_busting #used to bring up the different menu when opening the panel again
			save_global_event_target_as = quasistellar_owner #used to scope to the country owning the quasistellar
		}
	}
	#cancel
	option = {
		name = gigaquasar.100.no
		hidden_effect = {
			country_event = { id = gigaquasar.10 }
		}
	}
}

#place the markers
country_event = {
	id = gigaquasar.301
	title = gigaquasar.301.name
	desc = gigaquasar.301.desc
	show_sound = event_mystic_reveal
	location = fromfrom

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = ROOT.species
		room = gigaquasar_room
	}

	#FIRE!
	option = {
		name = gigaquasar.301.fire.1 #1 stars
		trigger = {
			has_country_flag = qso_1
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 40 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_stellar_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.302 }
		}
	}

	option = {
		name = gigaquasar.301.fire.2 #2 stars
		trigger = {
			has_country_flag = qso_2
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 80 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_stellar_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.302 }
		}
	}

	option = {
		name = gigaquasar.301.fire.3 #3 stars
		trigger = {
			has_country_flag = qso_3
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 120 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_stellar_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.302 }
		}
	}

	option = {
		name = gigaquasar.301.fire.4 #4 stars
		trigger = {
			has_country_flag = qso_4
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 160 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_stellar_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.302 }
		}
	}


	#not done with markers
	option = {
		name = gigaquasar.301.markers
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
		}
	}


	#cancel
	option = {
		name = gigaquasar.101.cancel
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_stellar_busting
			remove_country_flag = qso_4
			remove_country_flag = qso_3
			remove_country_flag = qso_2
			remove_country_flag = qso_1
			no_scope = {
				every_megastructure = {
					limit = { is_megastructure_type = quasi_stellar_marker_star }
					remove_megastructure = THIS
				}
				every_planet = {
					limit = { has_planet_flag = quasistellar_target_star }
					remove_planet_flag = quasistellar_target_star
				}
			}
		}
	}
}

#upgrade all markers
country_event = {
	id = gigaquasar.302
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		country_event = { id = gigaquasar.3031 days = 15 }
		every_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_marker_star
			}
			upgrade_megastructure_to = quasi_stellar_marker_star_open
		}
	}
}

country_event = { #blast
	id = gigaquasar.3031
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		country_event = { id = gigaquasar.303 days = 5 }
		every_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_marker_star_open
			}
			upgrade_megastructure_to = quasi_stellar_marker_star_firing
		}
	}
}

country_event = { #blast
	id = gigaquasar.303
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		event_target:quasistellar_owner = {
			country_event = { id = gigaquasar.305 days = 2 } #after 15 days of blasting, delete all portals and reset the QSO system
		}
		every_planet = {
			limit = {
				has_planet_flag = quasistellar_target_star
			}
			remove_planet_flag = quasistellar_target_star
			add_threat = { who = root amount = 4 } #threat
			solar_system = {
				if = { #system inhabited and has a colony
					limit = {
						any_system_planet = {
							is_colony = yes
						}
						NOT = {
							space_owner = {
								is_country_type = ai_empire
								is_country_type = swarm
								is_country_type = extradimensional
								is_country_type = extradimensional_2
								is_country_type = extradimensional_3
							}
						}
					}
					every_country = {
						limit = {
							NOT = { is_country_type = primitive }
							NOT = { is_country = ROOT }
							NOT = { is_in_federation_with = ROOT }
							NOR = { #purgers don't care
								has_valid_civic = civic_fanatic_purifiers
								has_valid_civic = civic_hive_devouring_swarm
								has_valid_civic = civic_machine_terminator
							}
						}
						add_opinion_modifier = { who = ROOT modifier = opinion_broke_system }
					}
					space_owner = {
						remove_opinion_modifier = { who = ROOT modifier = opinion_broke_system }
						add_opinion_modifier = { who = ROOT modifier = opinion_broke_our_system }
					}
				}
				else_if = { #system claimed but no colony
					limit = {
						NOT = {
							any_system_planet = {
								is_colony = yes
							}
						}
						space_owner = {
							exists = THIS
						}
						NOT = {
							space_owner = {
								is_country_type = ai_empire
								is_country_type = swarm
								is_country_type = extradimensional
								is_country_type = extradimensional_2
								is_country_type = extradimensional_3
							}
						}
					}
					every_country = {
						limit = {
							NOT = { is_country_type = primitive }
							NOT = { is_country = ROOT }
							NOT = { is_in_federation_with = ROOT }
							NOR = { #purgers don't care
								has_valid_civic = civic_fanatic_purifiers
								has_valid_civic = civic_hive_devouring_swarm
								has_valid_civic = civic_machine_terminator
							}
						}
						add_opinion_modifier = { who = ROOT modifier = opinion_broke_empty_system }
					}
					space_owner = {
						remove_opinion_modifier = { who = ROOT modifier = opinion_broke_empty_system }
						add_opinion_modifier = { who = ROOT modifier = opinion_broke_our_empty_system }
					}
				}
				if = { #automatically declare war (lol)
					limit = {
						space_owner = {
							exists = THIS
							NOT = {
								is_at_war_with = event_target:quasistellar_owner
							}
							NOR = {
								is_country_type = ai_empire
								is_country_type = swarm
								is_country_type = extradimensional
								is_country_type = extradimensional_2
								is_country_type = extradimensional_3
							}
						}
					}
					space_owner = {
						declare_war = {
							target = event_target:quasistellar_owner
							attacker_war_goal = "wg_end_threat_hyperweapon"
						}
					}
				}
				if = {
					limit = {
						any_system_planet = {
							is_planet_class = pc_ai
							NOT = {
								has_planet_flag = machine_lair
							}
						}
					}
					random_system_planet = {
						limit = {
							is_planet_class = pc_ai
						}
						planet_event = { id = gigaquasar.111 } #contingency planet
						every_country = {
							country_event = { id = gigaquasar.110 } #message
						}
					}
				}
				if = {
					limit = {
						any_system_planet = {
							is_planet_class = pc_ai
							has_planet_flag = machine_lair
						}
					}
					random_system_planet = {
						limit = {
							is_planet_class = pc_ai
						}
						planet_event = { id = gigaquasar.113 } #contingency planet
						every_country = {
							country_event = { id = gigaquasar.112 } #message to everyone
						}
					}
				}
				every_system_planet = {
					limit = {
						is_planet_class = pc_infested
					}
					planet_event = { id = gigaquasar.115 } #infested world
				}
				every_system_planet = {
					limit = {
						is_colony = yes
					}
					planet_event = { id = gigaquasar.130 }
				}
				every_neighbor_system = {
					remove_hyperlane = {
						from = PREV
						to = THIS
					}
				}
				every_system_planet = {
					limit = {
						is_star = no
					}
					remove_planet = yes
				}
				every_system_planet = {
					limit = {
						is_star = yes
						NOT = {
							is_planet_class = pc_core_quasar
						}
					}
					clear_deposits = yes
					change_pc = pc_giga_empty_space
					set_name = "Empty Space"
				}
				set_asteroid_belt = {
					radius = 0
				}
				every_system_megastructure = {
					limit = {
						NOT = {
							is_megastructure_type = quasi_stellar_marker_star_firing
						}
					}
					remove_megastructure = this
				}
				every_fleet_in_system = { destroy_fleet = this }
				every_system_ambient_object = { destroy_ambient_object = this }
				every_system_planet = {
					limit = {
						is_star = yes
					}
					planet_event = { id = gigaquasar.306 }
				}
			}
		}
	}
}

country_event = {
	id = gigaquasar.305 #reset everything
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		remove_country_flag = quasistellar_firing
		remove_country_flag = qso_4
		remove_country_flag = qso_3
		remove_country_flag = qso_2
		remove_country_flag = qso_1
		every_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_marker_star_firing
			}
			remove_megastructure = this
		}
		random_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_obliterator_firing_1
			}
			solar_system = {
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_1
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_2
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_3
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_4
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_5
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_6
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_big
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_gateway_on
					}
					remove_megastructure = this
				}
				spawn_megastructure = {
					type = quasi_stellar_gateway_off
					location = solar_system
					owner = space_owner
				}
				spawn_megastructure = {
					type = quasi_stellar_obliterator_5
					location = solar_system
					owner = space_owner
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_1
					}
					remove_megastructure = this
				}
			}
		}
	}
}

planet_event = {
	id = gigaquasar.306 #explosion
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		create_ambient_object = {
			type = penrose_sphere_explosion_object
			location = ROOT
			duration = 20

			use_3d_location = yes

			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }

			entity_scale_to_size = no
			scale = 1.25
		}
		create_ambient_object = {
			type = penrose_sphere_explosion_object
			location = ROOT
			duration = 20

			use_3d_location = yes

			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }

			entity_scale_to_size = no
			scale = 1.25
		}
		create_ambient_object = {
			type = "nebula_L8_entity"
			location = THIS
		}
		create_ambient_object = {
			type = "nebula_L10_entity"
			location = THIS
		}
	}
}


###################################################################FLEET DESTRUCTION###################################################################
#first event, asks you to confirm
country_event = {
	id = gigaquasar.200
	title = gigaquasar.200.name
	desc = gigaquasar.200.desc
	location = fromfrom

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = ROOT.species
		room = gigaquasar_room
	}

	#destroy planet
	option = {
		name = gigaquasar.200.yes
		hidden_effect = {
			country_event = { id = gigaquasar.201 }
			remove_country_flag = quasistellar_menu_active
			set_country_flag = quasistellar_fleet_busting #used to bring up the different menu when opening the panel again
			save_global_event_target_as = quasistellar_owner #used to scope to the country owning the quasistellar
			random_megastructure = {
				limit = {
					is_megastructure_type = quasi_stellar_obliterator_5
				}
				solar_system = {
					random_system_planet = {
						limit = {
							is_planet_class = pc_core_quasar
						}
						save_global_event_target_as = quasar_gun_blackhole
					}
				}
			}
			create_fleet = {
				name = "Quasi-Stellar Calibrator"
				settings = {
					spawn_debris = no
					can_change_composition = no
				}
				effect = {
					set_owner = event_target:quasistellar_owner
					create_ship = {
						name = "Quasi-Stellar Calibrator"
						design = "Quasistellar Calibrator"
						effect = {
							set_ship_flag = calibrator_ship
						}
					}
					set_location = event_target:quasar_gun_blackhole
				}
			}
		}
	}
	#cancel
	option = {
		name = gigaquasar.100.no
		hidden_effect = {
			country_event = { id = gigaquasar.10 }
		}
	}
}

country_event = { #the ship is there
	id = gigaquasar.201
	title = gigaquasar.201.name
	desc = gigaquasar.201.desc
	location = fromfrom

	picture = GFX_evt_fleet_neutral
	show_sound = event_mystic_reveal

	is_triggered_only = yes


	option = {
		name = gigaquasar.201.a
	}
}

country_event = { #the ship is gone (disbanded)
	id = gigaquasar.202
	title = gigaquasar.202.name
	desc = gigaquasar.202.desc

	picture = GFX_evt_fleet_neutral
	show_sound = event_mystic_reveal

	is_triggered_only = yes

	trigger = {
		THIS = {
			NOT = {
				has_country_flag = quasistellar_fleet_busting_successful
			}
		}
		from = {
			is_ship_size = quasi_stellar_calibrator
		}
	}

	immediate = {
		if = { #the firing procedure has NOT started
			limit = {
				has_country_flag = quasistellar_fleet_busting
			}
			THIS = {
				remove_country_flag = quasistellar_fleet_busting
			}
		}
		else_if = { #the firing procedure HAS started
			limit = {
				has_country_flag = quasistellar_firing
			}
			set_country_flag = quasistellar_fleet_busting_failed
			add_resource = { #refund
				sr_magical_neutronium = 20
			}
			random_megastructure = {
				limit = {
					is_megastructure_type = quasi_stellar_gateway_on
				}
				remove_megastructure = this
				solar_system = {
					spawn_megastructure = {
						type = quasi_stellar_gateway_off
						location = solar_system
						owner = space_owner
					}
					spawn_megastructure = {
						type = quasi_stellar_obliterator_5
						location = solar_system
						owner = space_owner
					}
					random_system_megastructure = {
						limit = {
							is_megastructure_type = quasi_stellar_obliterator_firing_1
						}
						remove_megastructure = this
					}
				}
			}
			remove_country_flag = quasistellar_firing
		}
	}

	option = {
		name = gigaquasar.202.a
	}
}

country_event = { #the ship is gone (destroyed)
	id = gigaquasar.203
	title = gigaquasar.203.name
	desc = gigaquasar.203.desc

	picture = GFX_evt_fleet_neutral
	show_sound = event_mystic_reveal

	is_triggered_only = yes

	trigger = {
		fromfrom = {
			is_ship_size = quasi_stellar_calibrator
		}
	}

	immediate = {
		if = { #the firing procedure has NOT started
			limit = {
				has_country_flag = quasistellar_fleet_busting
			}
			THIS = {
				remove_country_flag = quasistellar_fleet_busting
			}
		}
		else_if = { #the firing procedure HAS started
			limit = {
				has_country_flag = quasistellar_firing
			}
			set_country_flag = quasistellar_fleet_busting_failed
			add_resource = { #refund
				sr_magical_neutronium = 20
			}
			random_megastructure = {
				limit = {
					is_megastructure_type = quasi_stellar_gateway_on
				}
				remove_megastructure = this
				solar_system = {
					spawn_megastructure = {
						type = quasi_stellar_gateway_off
						location = solar_system
						owner = space_owner
					}
					spawn_megastructure = {
						type = quasi_stellar_obliterator_5
						location = solar_system
						owner = space_owner
					}
					random_system_megastructure = {
						limit = {
							is_megastructure_type = quasi_stellar_obliterator_firing_1
						}
						remove_megastructure = this
					}
				}
			}
			remove_country_flag = quasistellar_firing
		}
	}


	option = {
		name = gigaquasar.203.a
	}
}

country_event = { #target locked
	id = gigaquasar.204
	title = gigaquasar.204.name
	desc = gigaquasar.204.desc
	show_sound = event_mystic_reveal
	location = fromfrom

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = ROOT.species
		room = gigaquasar_room
	}

	#FIRE!
	option = {
		name = gigaquasar.204.fire
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 20 }
		}
		hidden_effect = {
			random_owned_ship = {
				limit = {
					is_ship_size = quasi_stellar_calibrator
				}
				solar_system = {
					random_system_planet = {
						limit = {
							is_star = yes
						}
						save_global_event_target_as = quasi_stellar_fleet_target
					}
				}
			}
			country_event = { id = gigaquasar.206 days = 30 }
			country_event = { id = gigaquasar.2061 days = 30 }
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_fleet_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.205 }
			set_country_flag = quasistellar_fleet_busting_successful
			every_ship = {
				limit = { is_ship_size = quasi_stellar_calibrator }
				save_event_target_as = quasistellar_calibrator
			}
			create_fleet = { #lock the calibrator
				name = "Quasi-Stellar Calibrator"
				settings = {
					spawn_debris = no
					can_change_composition = no
				}
				effect = {
					set_owner = event_target:quasistellar_owner
					create_ship = {
						name = "Quasi-Stellar Calibrator"
						design = "Locked Quasistellar Calibrator"
						effect = {
							set_ship_flag = calibrator_ship
						}
					}
					set_location = event_target:quasistellar_calibrator
				}
			}
			event_target:quasistellar_calibrator = {
				delete_ship = THIS
			}
			remove_country_flag = quasistellar_fleet_busting_successful
			random_megastructure = {
				limit = {
					is_megastructure_type = quasi_stellar_obliterator_5
				}
				remove_megastructure = this
				solar_system = {
					spawn_megastructure = {
						type = quasi_stellar_obliterator_firing_1
						location = solar_system
						owner = space_owner
					}
					random_system_megastructure = {
						limit = {
							is_megastructure_type = quasi_stellar_gateway_off
						}
						upgrade_megastructure_to = quasi_stellar_gateway_on
					}
				}
			}
		}
	}

	#not done with markers
	option = {
		name = gigaquasar.204.markers
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
		}
	}


	#cancel
	option = {
		name = gigaquasar.101.cancel
		hidden_effect = {
			hidden_effect = {
				country_event = { id = gigaquasar.10 }
			}
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_fleet_busting
			no_scope = {
				every_ship = {
					limit = { is_ship_size = quasi_stellar_calibrator }
					delete_ship = THIS
				}
			}
		}
	}
}

country_event = { #calibrating
	id = gigaquasar.205
	title = gigaquasar.205.name
	desc = gigaquasar.205.desc
	location = fromfrom

	picture = GFX_evt_fleet_neutral
	show_sound = event_mystic_reveal

	is_triggered_only = yes


	option = {
		name = gigaquasar.205.a
	}
}

country_event = { #firing!
	id = gigaquasar.206
	title = gigaquasar.206.name
	desc = gigaquasar.206.desc
	location = fromfrom

	picture = GFX_evt_machine_space_battle
	show_sound = event_air_raid_siren

	is_triggered_only = yes

	trigger = {
		NOT = { has_country_flag = quasistellar_fleet_busting_failed }
	}

	immediate = {
		set_country_flag = quasistellar_fleet_busting_successful
		every_ship = {
			limit = { is_ship_size = quasi_stellar_calibrator }
			delete_ship = THIS
		}
		country_event = { id = gigaquasar.1001 } #initiate firing sequence
		country_event = { id = gigaquasar.207 days = 10 } #the wormhole opens
	}

	option = {
		name = gigaquasar.206.a
	}
}

country_event = { #remove failed flag
	id = gigaquasar.2061

	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_country_flag = quasistellar_fleet_busting_failed
	}

	immediate = {
		remove_country_flag = quasistellar_fleet_busting_failed
	}
}

country_event = { #firing!
	id = gigaquasar.207
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		remove_country_flag = quasistellar_fleet_busting_successful
		country_event = { id = gigaquasar.208 days = 30 } #delete it
		create_fleet = {
			name = "Quasistellar Wormhole"
			settings = {
				spawn_debris = no
				can_change_composition = no
				is_boss = yes
			}
			effect = {
				set_owner = event_target:quasistellar_owner
				create_ship = {
					name = "Quasistellar Wormhole"
					design = "Quasistellar Wormhole"
					effect = {
						set_ship_flag = quasistellarwormhole_ship
					}
				}
				set_location = event_target:quasi_stellar_fleet_target
			}
		}
	}
}

country_event = { #delete it
	id = gigaquasar.208
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		remove_country_flag = quasistellar_firing
		no_scope = {
			every_ship = {
				limit = { is_ship_size = quasi_stellar_wormhole }
				delete_ship = THIS
			}
		}
		every_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_marker_planet_firing
			}
			remove_megastructure = this
		}
		random_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_obliterator_firing_1
			}
			solar_system = {
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_1
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_2
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_3
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_4
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_5
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_6
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_big
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_gateway_on
					}
					remove_megastructure = this
				}
				spawn_megastructure = {
					type = quasi_stellar_gateway_off
					location = solar_system
					owner = space_owner
				}
				spawn_megastructure = {
					type = quasi_stellar_obliterator_5
					location = solar_system
					owner = space_owner
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_1
					}
					remove_megastructure = this
				}
			}
		}	}
}


###################################################################PLANET DESTRUCTION###################################################################
#first event, asks you to confirm
country_event = {
	id = gigaquasar.100
	title = gigaquasar.100.name
	desc = gigaquasar.100.desc
	location = fromfrom

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = ROOT.species
		room = gigaquasar_room
	}

	#destroy planet
	option = {
		name = gigaquasar.100.yes
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 5 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			set_country_flag = quasistellar_planet_busting #used to bring up the different menu when opening the panel again
			save_global_event_target_as = quasistellar_owner #used to scope to the country owning the quasistellar
		}
	}
	#cancel
	option = {
		name = gigaquasar.100.no
		hidden_effect = {
			country_event = { id = gigaquasar.10 }
		}
	}
}

#place the markers
country_event = {
	id = gigaquasar.101
	title = gigaquasar.101.name
	desc = gigaquasar.101.desc
	show_sound = event_mystic_reveal
	location = fromfrom

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = ROOT.species
		room = gigaquasar_room
	}

	#FIRE!
	option = {
		name = gigaquasar.101.fire.1 #1 planets
		trigger = {
			has_country_flag = qso_1
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 5 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_planet_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.102 }
		}
	}

	option = {
		name = gigaquasar.101.fire.2 #2 planets
		trigger = {
			has_country_flag = qso_2
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 10 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_planet_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.102 }
		}
	}

	option = {
		name = gigaquasar.101.fire.3 #3 planets
		trigger = {
			has_country_flag = qso_3
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 15 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_planet_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.102 }
		}
	}

	option = {
		name = gigaquasar.101.fire.4 #4 planets
		trigger = {
			has_country_flag = qso_4
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 20 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_planet_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.102 }
		}
	}

	option = {
		name = gigaquasar.101.fire.5 #5 planets
		trigger = {
			has_country_flag = qso_5
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 25 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_planet_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.102 }
		}
	}

	option = {
		name = gigaquasar.101.fire.6 #6 planets
		trigger = {
			has_country_flag = qso_6
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 30 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_planet_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.102 }
		}
	}

	option = {
		name = gigaquasar.101.fire.7 #7 planets
		trigger = {
			has_country_flag = qso_7
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 35 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_planet_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.102 }
		}
	}

	option = {
		name = gigaquasar.101.fire.8 #8 planets
		trigger = {
			has_country_flag = qso_8
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 40 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_planet_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.102 }
		}
	}

	option = {
		name = gigaquasar.101.fire.9 #9 planets
		trigger = {
			has_country_flag = qso_9
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 45 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_planet_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.102 }
		}
	}

	option = {
		name = gigaquasar.101.fire.10 #10 planets
		trigger = {
			has_country_flag = qso_10
		}
		allow = {
			resource_stockpile_compare = { resource = sr_magical_neutronium value >= 50 }
		}
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_planet_busting
			set_country_flag = quasistellar_firing
			country_event = { id = gigaquasar.1000 }
			country_event = { id = gigaquasar.102 }
		}
	}

	#not done with markers
	option = {
		name = gigaquasar.101.markers
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
		}
	}


	#cancel
	option = {
		name = gigaquasar.101.cancel
		hidden_effect = {
			remove_country_flag = quasistellar_menu_active
			remove_country_flag = quasistellar_planet_busting
			remove_country_flag = qso_10
			remove_country_flag = qso_9
			remove_country_flag = qso_8
			remove_country_flag = qso_7
			remove_country_flag = qso_6
			remove_country_flag = qso_5
			remove_country_flag = qso_4
			remove_country_flag = qso_3
			remove_country_flag = qso_2
			remove_country_flag = qso_1
			no_scope = {
				every_megastructure = {
					limit = { is_megastructure_type = quasi_stellar_marker_planet }
					remove_megastructure = THIS
				}
				every_planet = {
					limit = { has_planet_flag = quasistellar_target_planet }
					remove_planet_flag = quasistellar_target_planet
				}
			}
		}
	}
}

#upgrade all markers#
country_event = {
	id = gigaquasar.102
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		country_event = { id = gigaquasar.103 days = 15 }
		every_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_marker_planet
			}
			upgrade_megastructure_to = quasi_stellar_marker_planet_open
		}
	}
}

country_event = { #blast
	id = gigaquasar.103
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		add_threat = { who = root amount = 3 } #threat
		every_planet = {
			limit = {
				has_planet_flag = quasistellar_target_planet
			}
			if = { #planet inhabited and has a colony
				limit = {
					is_colony = yes
					NOT = {
						space_owner = {
							is_country_type = ai_empire
							is_country_type = swarm
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
						}
					}
				}
				every_country = {
					limit = {
						NOT = { is_country_type = primitive }
						NOT = { is_country = ROOT }
						NOT = { is_in_federation_with = ROOT }
						NOR = { #purgers don't care
							has_valid_civic = civic_fanatic_purifiers
							has_valid_civic = civic_hive_devouring_swarm
							has_valid_civic = civic_machine_terminator
						}
					}
					add_opinion_modifier = { who = ROOT modifier = opinion_broke_planet }
				}
				space_owner = {
					remove_opinion_modifier = { who = ROOT modifier = opinion_broke_planet }
					add_opinion_modifier = { who = ROOT modifier = opinion_broke_our_planet }
				}
			}
			else_if = { #planet claimed but no colony
				limit = {
					NOT = {
						is_colony = yes
					}
					space_owner = {
						exists = THIS
					}
					NOT = {
						space_owner = {
							is_country_type = ai_empire
							is_country_type = swarm
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
						}
					}
				}
				space_owner = {
					add_opinion_modifier = { who = ROOT modifier = opinion_broke_our_empty_planet }
				}
			}
			if = { #automatically declare war (lol)
				limit = {
					space_owner = {
						exists = THIS
						NOT = {
							is_at_war_with = event_target:quasistellar_owner
						}
						NOR = {
							is_country_type = ai_empire
							is_country_type = swarm
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
						}
					}
				}
				space_owner = {
					declare_war = {
						target = event_target:quasistellar_owner
						attacker_war_goal = "wg_end_threat_hyperweapon"
					}
				}
			}
			if = {
				limit = {
					exists = owner
					is_colony = yes
				}
				planet_event = { id = gigaquasar.130 } #war exhaustion event
			}
			planet_event = { id = gigaquasar.104 days = 2 } #run planetary obliteration script
			if = {
				limit = {
					is_planet_class = pc_ai
					NOT = {
						has_planet_flag = machine_lair
					}
				}
				planet_event = { id = gigaquasar.111 } #contingency planet
				every_country = {
					country_event = { id = gigaquasar.110 } #message
				}
			}
			if = {
				limit = {
					is_planet_class = pc_ai
					has_planet_flag = machine_lair #final machine world
				}
				planet_event = { id = gigaquasar.113 } #contingency planet
				every_country = {
					country_event = { id = gigaquasar.112 } #message to everyone
				}
			}
			if = {
				limit = {
					is_planet_class = pc_infested
				}
				planet_event = { id = gigaquasar.115 } #infested world
			}
		}
		every_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_marker_planet_open
			}
			upgrade_megastructure_to = quasi_stellar_marker_planet_firing
		}
		event_target:quasistellar_owner = {
			country_event = { id = gigaquasar.105 days = 15 } #after 15 days of blasting, delete all portals and reset the QSO system
		}
	}
}

planet_event = { #blast
	id = gigaquasar.104
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		if = {
			limit = {
				OR = {
					planet_size < 25
					habitable_structure = yes
					is_planet_class = pc_ice_asteroid
					is_planet_class = pc_asteroid
					is_planet_class = pc_crystal_asteroid
				}
			}
			remove_planet = yes #the planet is too small, or is artificial, instantly obliterated
		}
		if = {
			limit = {
				NOT = {
					has_planet_flag = quasistellar_impact
				}
			}
			if = { #check if its a gaseous body
				limit = {
					is_planet_class = pc_gas_giant
					is_planet_class = pc_gigabrown_dwarf
				}
				change_pc = pc_metallic_hydrogen
			}
			else = {
				change_pc = pc_molten
			}
			set_planet_flag = quasistellar_impact #turn the planet molten while it is getting obliterated
		}
		if = {
			limit = {
				planet_size > 23
			}
			change_planet_size = -3
			planet_event = { id = gigaquasar.104 days = 1} #run it until the planet is too small
		}
	}
}

country_event = {
	id = gigaquasar.105 #reset everything
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		remove_country_flag = quasistellar_firing
		remove_country_flag = qso_10
		remove_country_flag = qso_9
		remove_country_flag = qso_8
		remove_country_flag = qso_7
		remove_country_flag = qso_6
		remove_country_flag = qso_5
		remove_country_flag = qso_4
		remove_country_flag = qso_3
		remove_country_flag = qso_2
		remove_country_flag = qso_1
		every_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_marker_planet_firing
			}
			remove_megastructure = this
		}
		random_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_obliterator_firing_1
			}
			solar_system = {
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_1
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_2
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_3
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_4
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_5
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_6
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_laser_big
					}
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_gateway_on
					}
					remove_megastructure = this
				}
				spawn_megastructure = {
					type = quasi_stellar_gateway_off
					location = solar_system
					owner = space_owner
				}
				spawn_megastructure = {
					type = quasi_stellar_obliterator_5
					location = solar_system
					owner = space_owner
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_obliterator_firing_1
					}
					remove_megastructure = this
				}
			}
		}
	}
}

###Crisis stuff###
country_event = { #message about planet obliterated
	id = gigaquasar.110
	title = gigaquasar.110.name
	desc = gigaquasar.110.desc

	picture = GFX_evt_exploding_planet
	show_sound = event_super_explosion
	location = from

	is_triggered_only = yes

	option = {
		name = gigaquasar.110.a
	}
}

planet_event = { #planet destroyed
	id = gigaquasar.111
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { has_planet_flag = machine_world_1 }
			every_country = {
				limit = { has_event_chain = "ai_crisis_chain" }
				remove_point_of_interest = ai_crisis_poi.1
			}
		}
		if = {
			limit = { has_planet_flag = machine_world_2 }
			every_country = {
				limit = { has_event_chain = "ai_crisis_chain" }
				remove_point_of_interest = ai_crisis_poi.2
			}
		}
		if = {
			limit = { has_planet_flag = machine_world_3 }
			every_country = {
				limit = { has_event_chain = "ai_crisis_chain" }
				remove_point_of_interest = ai_crisis_poi.3
			}
		}
		if = {
			limit = { has_planet_flag = machine_world_4 }
			every_country = {
				limit = { has_event_chain = "ai_crisis_chain" }
				remove_point_of_interest = ai_crisis_poi.4
			}
		}
		if = {
			limit = {
				OR = {
					NOT = { has_planet_flag = destroyed_by_colossus }
					has_planet_flag = planet_godrayed
				}
			}
			destroy_colony = yes
			change_pc = pc_broken
			reset_planet = yes
			hidden_effect = { clear_deposits = yes }
			add_deposit = d_living_metal_deposit
			add_deposit = d_minerals_3
			add_deposit = d_energy_3
		}

		every_country = {
			limit = { has_event_chain = "ai_crisis_chain" }
			add_event_chain_counter = {
				event_chain = "ai_crisis_chain"
				counter = "active_machine_worlds"
				amount = -1
			}
		}
		random_country = {
			limit = { is_country_type = "ai_empire" }
			change_variable = {
				which = "machine_worlds_destroyed"
				value = 1
			}
			if = {
				limit = {
					check_variable = {
						which = "machine_worlds_destroyed"
						value = 1
					}
				}
				remove_global_flag = ghost_signal_5_flag
				set_global_flag = ghost_signal_4_flag
				every_country = {
					limit = { has_notification_modifier = ghost_signal_5 }
					remove_notification_modifier = ghost_signal_5
					add_notification_modifier = ghost_signal_4
					every_owned_pop = {
						limit = { has_modifier = pop_ghost_signal_5 }
						remove_modifier = "pop_ghost_signal_5"
						add_modifier = { modifier = "pop_ghost_signal_4" days = -1 }
					}
					every_owned_ship = {
						limit = {
							has_sapient_combat_computer = yes
						}
						remove_modifier = "ship_ghost_signal_5"
						add_modifier = { modifier = "ship_ghost_signal_4" days = -1 }
					}
				}
				every_country = {
					limit = { has_notification_modifier = ghost_signal_5_machine }
					remove_notification_modifier = ghost_signal_5_machine
					add_notification_modifier = ghost_signal_4_machine
					every_owned_pop = {
						limit = { has_trait = trait_machine_unit }
						remove_modifier = "pop_ghost_signal_5_machine"
						add_modifier = { modifier = "pop_ghost_signal_4_machine" days = -1 }
					}
					every_owned_ship = {
						limit = {
							has_sapient_combat_computer = yes
						}
						remove_modifier = "ship_ghost_signal_5"
						add_modifier = { modifier = "ship_ghost_signal_4" days = -1 }
					}
				}
				observer_event = { id = observer.50 }
				break = yes
			}
			if = {
				limit = {
					check_variable = {
						which = "machine_worlds_destroyed"
						value = 2
					}
				}
				set_global_flag = first_machine_world_destroyed
				remove_global_flag = ghost_signal_4_flag
				set_global_flag = ghost_signal_3_flag
				every_country = {
					limit = { has_notification_modifier = ghost_signal_4 }
					remove_notification_modifier = ghost_signal_4
					add_notification_modifier = ghost_signal_3
					every_owned_pop = {
						limit = { has_modifier = "pop_ghost_signal_4" }
						remove_modifier = "pop_ghost_signal_4"
						add_modifier = { modifier = "pop_ghost_signal_3" days = -1 }
					}
					every_owned_ship = {
						limit = {
							has_sapient_combat_computer = yes
						}
						remove_modifier = "ship_ghost_signal_4"
						add_modifier = { modifier = "ship_ghost_signal_3" days = -1 }
					}
				}
				every_country = {
					limit = { has_notification_modifier = ghost_signal_4_machine }
					remove_notification_modifier = ghost_signal_4_machine
					every_owned_pop = {
						limit = { has_trait = trait_machine_unit }
						remove_modifier = "pop_ghost_signal_4_machine"
					}
					every_owned_ship = {
						limit = {
							has_sapient_combat_computer = yes
						}
						remove_modifier = "ship_ghost_signal_4"
					}
				}

				every_country = {
					limit = { has_special_project = AI_CRISIS_PROJECT }
					abort_special_project = { type = AI_CRISIS_PROJECT }
				}
				observer_event = { id = observer.50 }
				break = yes
			}
			if = {
				limit = {
					check_variable = {
						which = "machine_worlds_destroyed"
						value = 3
					}
				}
				remove_global_flag = ghost_signal_3_flag
				set_global_flag = ghost_signal_2_flag
				every_country = {
					limit = { has_notification_modifier = ghost_signal_3 }
					remove_notification_modifier = ghost_signal_3
					add_notification_modifier = ghost_signal_2
					every_owned_pop = {
						limit = { has_modifier = pop_ghost_signal_3 }
						remove_modifier = "pop_ghost_signal_3"
						add_modifier = { modifier = "pop_ghost_signal_2" days = -1 }
					}
					every_owned_ship = {
						limit = {
							has_sapient_combat_computer = yes
						}
						remove_modifier = "ship_ghost_signal_3"
						add_modifier = { modifier = "ship_ghost_signal_2" days = -1 }
					}
				}
				observer_event = { id = observer.50 }
				break = yes
			}
			if = {
				limit = {
					check_variable = {
						which = "machine_worlds_destroyed"
						value = 4
					}
				}
				remove_global_flag = ghost_signal_2_flag
				every_country = {
					limit = { has_notification_modifier = ghost_signal_2 }
					remove_notification_modifier = ghost_signal_2
					add_notification_modifier = ghost_signal_1
					every_owned_pop = {
						limit = { has_modifier = pop_ghost_signal_2 }
						remove_modifier = "pop_ghost_signal_2"
						add_modifier = { modifier = "pop_ghost_signal_1" days = -1 }
					}
					every_owned_ship = {
						limit = {
							has_sapient_combat_computer = yes
						}
						remove_modifier = "ship_ghost_signal_2"
						add_modifier = { modifier = "ship_ghost_signal_1" days = -1 }
					}
				}
				observer_event = { id = observer.50 }
				country_event = { id = crisis.2035 }
				break = yes
			}
		}
	}
}

country_event = { #message about final planet obliterated
	id = gigaquasar.112
	title = gigaquasar.112.name
	desc = gigaquasar.112.desc

	picture = GFX_evt_exploding_planet
	show_sound = event_super_explosion
	location = from

	is_triggered_only = yes

	option = {
		name = gigaquasar.112.a
	}
}

planet_event = {
	id = gigaquasar.113 #Final planet obliterated
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		stop_crisis_sound = yes
		solar_system = {
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = extradimensional_system_effect_2 }
				destroy_ambient_object = this
			}
		}
		event_target:quasistellar_owner = { save_event_target_as = final_machine_world_destroyer }
		planet_event = { id = gigaquasar.114 }
	}
}

planet_event = {
	id = gigaquasar.114 #contingency gone
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		set_global_flag = ai_invasion_defeated
		event_target:final_machine_world_destroyer = { set_country_flag = does_not_compute }
		if = {
			limit = {
				event_target:final_machine_world_destroyer = { is_ai = no }
				NOT = { has_planet_flag = planet_shielded }
			}
			event_target:final_machine_world_destroyer = {
				country_event = { id = crisis.2480 days = 10 random = 10 }
			}
		}
		if = {
			limit = {
				event_target:final_machine_world_destroyer = { is_ai = no }
				has_planet_flag = planet_shielded
			}
			event_target:final_machine_world_destroyer = {
				country_event = { id = crisis.2481 days = 10 random = 10 }
			}
		}
		remove_global_flag = synth_terror
		remove_global_flag = ai_ghost_signal
		remove_global_flag = ai_invasion_ongoing
		if = {
			limit = {
				OR = {
					NOT = { has_planet_flag = destroyed_by_colossus }
					has_planet_flag = planet_godrayed
				}
			}
			destroy_colony = yes
			change_pc = pc_broken
			reset_planet = yes
		}
		every_country = {
			limit = { has_notification_modifier = ghost_signal_1 }
			remove_notification_modifier = ghost_signal_1
			every_owned_pop = {
				limit = { has_modifier = "pop_ghost_signal_1" }
				remove_modifier = "pop_ghost_signal_1"
			}
			every_owned_ship = {
				limit = {
					has_sapient_combat_computer = yes
				}
				remove_modifier = "ship_ghost_signal_1"
			}
		}
		every_country = {
			limit = { has_event_chain = "ai_crisis_chain" }
			end_event_chain = "ai_crisis_chain"
		}
		every_country = {
			limit = { has_special_project = SYNTH_INFILTRATION_PROJECT }
			abort_special_project = { type = SYNTH_INFILTRATION_PROJECT }
		}
		every_country = {
			limit = { has_modifier = unity_reduction_crisis_2204 }
			remove_modifier = unity_reduction_crisis_2204
		}
		random_country = { observer_event = { id = observer.51 } }
		every_country = {
			limit = {
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}
			every_owned_planet = {
				limit = { has_modifier = synth_planet_paranoia }
				remove_modifier = synth_planet_paranoia
			}
		}
		every_country = {
			limit = {
				is_fallen_machine_empire = yes
			}
			country_event = { id = fallen_machine_empire.3 days = 1 }
		}
		random_country = {
			limit = { is_country_type = ai_empire }
			destroy_country = yes # Destroy the Contingency
			# should end their purges too
		}

		event_target:final_machine_world_destroyer = { set_country_flag = final_machine_world_destroyed }

		# Cybrex
		if = {
			limit = {
				has_global_flag = cybrex_resurface
				NOT = { has_global_flag = cybrex_destroyed }
			}
			random_country = {
				limit = { is_country_type = cybrex_empire }

				# Cybrex recall expeditionary fleets
				every_country = {
					limit = { has_country_flag = cybrex_donation }
					country_event = { id = crisis.2474 days = 20 random = 30 }
				}

				# Cybrex Depart Galaxy
				country_event = { id = crisis.2406 days = 365 random = 800 }

			}
		}
	}
}

planet_event = {
	id = gigaquasar.115 #infested world destroyed
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		set_planet_flag = previously_infested
		destroy_colony = yes
		random_list = {
			50 = { change_pc = pc_barren }
			50 = { change_pc = pc_barren_cold }
		}
		reset_planet = yes
		add_modifier = { modifier = "terraforming_candidate" days = -1 }
		planet_event = { id = crisis.216 }
	}
}

###other stuff###
planet_event = {
	id = gigaquasar.130 #war exhaustion
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		owner = {
			add_static_war_exhaustion = {
				attacker = event_target:quasistellar_owner
				location = root
				value_for_planet_destruction = 1
			}
		}
	}
}

###FIRING ANIMATION###
country_event = {
	id = gigaquasar.1000 #the barrel & gateway lights up
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		country_event = { id = gigaquasar.1001 days = 1 }
		random_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_obliterator_5
			}
			remove_megastructure = this
			solar_system = {
				spawn_megastructure = {
					type = quasi_stellar_obliterator_firing_1
					location = solar_system
					owner = space_owner
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = quasi_stellar_gateway_off
					}
					upgrade_megastructure_to = quasi_stellar_gateway_on
				}
			}
		}
	}
}

country_event = {
	id = gigaquasar.1001 #1 laser
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		country_event = { id = gigaquasar.1002 days = 1 }
		random_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_obliterator_firing_1
			}
			solar_system = {
				spawn_megastructure = {
					type = quasi_stellar_obliterator_firing_laser_1
					location = solar_system
					owner = space_owner
				}
			}
		}
	}
}

country_event = {
	id = gigaquasar.1002 #2 lasers
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		country_event = { id = gigaquasar.1003 days = 1 }
		random_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_obliterator_firing_1
			}
			solar_system = {
				spawn_megastructure = {
					type = quasi_stellar_obliterator_firing_laser_2
					location = solar_system
					owner = space_owner
				}
			}
		}
	}
}

country_event = {
	id = gigaquasar.1003 #3 lasers
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		country_event = { id = gigaquasar.1004 days = 1 }
		random_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_obliterator_firing_1
			}
			solar_system = {
				spawn_megastructure = {
					type = quasi_stellar_obliterator_firing_laser_3
					location = solar_system
					owner = space_owner
				}
			}
		}
	}
}

country_event = {
	id = gigaquasar.1004 #4 lasers
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		country_event = { id = gigaquasar.1005 days = 1 }
		random_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_obliterator_firing_1
			}
			solar_system = {
				spawn_megastructure = {
					type = quasi_stellar_obliterator_firing_laser_4
					location = solar_system
					owner = space_owner
				}
			}
		}
	}
}

country_event = {
	id = gigaquasar.1005 #5 lasers
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		country_event = { id = gigaquasar.1006 days = 1 }
		random_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_obliterator_firing_1
			}
			solar_system = {
				spawn_megastructure = {
					type = quasi_stellar_obliterator_firing_laser_5
					location = solar_system
					owner = space_owner
				}
			}
		}
	}
}

country_event = {
	id = gigaquasar.1006 #6 lasers
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		country_event = { id = gigaquasar.1007 days = 3 }
		random_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_obliterator_firing_1
			}
			solar_system = {
				spawn_megastructure = {
					type = quasi_stellar_obliterator_firing_laser_6
					location = solar_system
					owner = space_owner
				}
			}
		}
	}
}

country_event = {
	id = gigaquasar.1007 #BIG laser
	location = fromfrom

	is_triggered_only = yes

	hide_window = yes

	immediate = {
		random_megastructure = {
			limit = {
				is_megastructure_type = quasi_stellar_obliterator_firing_1
			}
			solar_system = {
				spawn_megastructure = {
					type = quasi_stellar_obliterator_firing_laser_big
					location = solar_system
					owner = space_owner
				}
			}
		}
	}
}

####BUILDING EVENTS####
country_event = {
	id = gigaquasar.2000
	title = gigaquasar.2000.name
	desc = gigaquasar.2000.desc
	show_sound = event_dyson_sphere_build_start
	picture = GFX_evt_qso
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		from = { is_megastructure_type = quasi_stellar_obliterator_0 }
	}

	option = {
		name = gigaquasar.2000.a
	}
}

country_event = {
	id = gigaquasar.2001
	title = gigaquasar.2001.name
	desc = gigaquasar.2001.desc
	show_sound = event_dyson_sphere_build_upgrade_panel
	picture = GFX_evt_qso
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		from = { is_megastructure_type = quasi_stellar_obliterator_1 }
	}

	immediate = {
		add_threat = { who = root amount = 10 } #threat
		every_country = {
			limit = {
				NOT = { is_country_type = primitive }
				NOT = { is_country = ROOT }
				NOT = { is_in_federation_with = ROOT }
			}
			add_opinion_modifier = { who = ROOT modifier = opinion_threatening_all_life }
		}
	}

	option = {
		name = gigaquasar.2001.a
	}
}

country_event = { #at this point, the hyperweapon is actually being constructed, and empires may agree to a galactic ceasefire. the ceasefire can then lead to the formation of a hyperstate
	id = gigaquasar.2002
	title = gigaquasar.2002.name
	desc = gigaquasar.2002.desc
	show_sound = event_dyson_sphere_build_upgrade_panel
	picture = GFX_evt_qso
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		from = { is_megastructure_type = quasi_stellar_obliterator_2 }
	}

	option = {
		name = gigaquasar.2002.a
	}
}

country_event = {
	id = gigaquasar.2003
	title = gigaquasar.2003.name
	desc = gigaquasar.2003.desc
	show_sound = event_dyson_sphere_build_upgrade_panel
	picture = GFX_evt_qso
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		from = { is_megastructure_type = quasi_stellar_obliterator_3 }
	}

	immediate = { #possibility of the ai banding together
		if = {
			limit = {
				has_global_flag = giga_galactic_fed_always
				NOR = {
					has_global_flag = galactic_hyperstate_formed
					has_global_flag = war_in_heaven_ongoing
				}
			}
			country_event = { id = gigafed.4000 }
			set_global_flag = galactic_hyperstate_formed
		}
		else_if = { #player is genocidal
			limit = {
				ROOT = {
					has_valid_civic = civic_fanatic_purifiers
					has_valid_civic = civic_hive_devouring_swarm
					has_valid_civic = civic_machine_terminator
				}
				NOR = { #cant happen twice
					has_global_flag = galactic_pact_formed
					has_global_flag = galactic_hyperstate_formed
					has_global_flag = war_in_heaven_ongoing
				}
			}
			random_list = {
				25 = { #big federation
					country_event = { id = gigafed.3000 }
					set_global_flag = galactic_pact_formed
				}
				50 = { #hyperstate
					if = {
						limit = {
							NOT = {
								has_global_flag = giga_galactic_fed_disabled
							}
						}
						country_event = { id = gigafed.4000 } #hyperstate
						set_global_flag = galactic_hyperstate_formed
					}
				}
				10 = {} #nothing
			}
		}
		else_if = {
			limit = {
				NOR = { #cant happen twice
					has_global_flag = galactic_pact_formed
					has_global_flag = galactic_hyperstate_formed
					has_global_flag = war_in_heaven_ongoing
				}
			}
			random_list = {
				50 = { #big federation
					country_event = { id = gigafed.3000 }
					set_global_flag = galactic_pact_formed
				}
				30 = { #hyperstate
					if = {
						limit = {
							NOT = {
								has_global_flag = giga_galactic_fed_disabled
							}
						}
						country_event = { id = gigafed.4000 } #hyperstate
						set_global_flag = galactic_hyperstate_formed
					}
				}
				80 = {} #nothing
			}
		}
	}

	option = {
		name = gigaquasar.2003.a
	}
}

country_event = {
	id = gigaquasar.2004
	title = gigaquasar.2004.name
	desc = gigaquasar.2004.desc
	show_sound = event_dyson_sphere_build_upgrade_panel
	picture = GFX_evt_qso
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		from = { is_megastructure_type = quasi_stellar_obliterator_4 }
	}

	immediate = { #possibility of the ai banding together
		if = {
			limit = {
				has_global_flag = giga_galactic_fed_always
				NOR = {
					has_global_flag = galactic_hyperstate_formed
					has_global_flag = war_in_heaven_ongoing
				}
			}
			country_event = { id = gigafed.4000 }
			set_global_flag = galactic_hyperstate_formed
		}
		else_if = { #player is genocidal
			limit = {
				ROOT = {
					has_valid_civic = civic_fanatic_purifiers
					has_valid_civic = civic_hive_devouring_swarm
					has_valid_civic = civic_machine_terminator
				}
				NOR = { #cant happen twice
					has_global_flag = galactic_pact_formed
					has_global_flag = galactic_hyperstate_formed
					has_global_flag = war_in_heaven_ongoing
				}
			}
			random_list = {
				25 = { #big federation
					country_event = { id = gigafed.3000 }
					set_global_flag = galactic_pact_formed
				}
				50 = { #hyperstate
					if = {
						limit = {
							NOT = {
								has_global_flag = giga_galactic_fed_disabled
							}
						}
						country_event = { id = gigafed.4000 } #hyperstate
						set_global_flag = galactic_hyperstate_formed
					}
				}
				10 = {} #nothing
			}
		}
		else_if = {
			limit = {
				NOR = { #cant happen twice
					has_global_flag = galactic_pact_formed
					has_global_flag = galactic_hyperstate_formed
					has_global_flag = war_in_heaven_ongoing
				}
			}
			random_list = {
				50 = { #big federation
					country_event = { id = gigafed.3000 }
					set_global_flag = galactic_pact_formed
				}
				30 = { #hyperstate
					if = {
						limit = {
							NOT = {
								has_global_flag = giga_galactic_fed_disabled
							}
						}
						country_event = { id = gigafed.4000 } #hyperstate
						set_global_flag = galactic_hyperstate_formed
					}
				}
				80 = {} #nothing
			}
		}
		if = { #hyperstate attacks
			limit = {
				has_global_flag = galactic_hyperstate_formed
				NOT = {
					has_global_flag = galactic_hyperstate_war
				}
			}
			random_list = {
				50 = {
					set_global_flag = galactic_hyperstate_war
					country_event = { id = gigafed.4012 days = 30 random = 10 }
				}
				50 = {}
			}
		}
		else_if = { #fed attacks
			limit = {
				has_global_flag = galactic_pact_formed
				NOT = {
					has_global_flag = galactic_pact_war
				}
			}
			random_list = {
				50 = {
					set_global_flag = galactic_pact_war
					country_event = { id = gigafed.3012 days = 30 random = 10 }
				}
				50 = {}
			}
		}
	}

	option = {
		name = gigaquasar.2004.a
	}
}


country_event = { #at this point, the hyperweapon is actually being constructed, and empires may agree to a galactic ceasefire. the ceasefire can then lead to the formation of a hyperstate
	id = gigaquasar.2005
	title = gigaquasar.2005.name
	desc = gigaquasar.2005.desc
	show_sound = event_dyson_sphere_build_complete
	picture = GFX_evt_qso
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		from = { is_megastructure_type = quasi_stellar_obliterator_5 }
	}

	immediate = { #possibility of the ai banding together
		if = {
			limit = {
				has_global_flag = giga_galactic_fed_always
				NOR = {
					has_global_flag = galactic_hyperstate_formed
					has_global_flag = war_in_heaven_ongoing
				}
			}
			country_event = { id = gigafed.4000 }
			set_global_flag = galactic_hyperstate_formed
		}
		else_if = { #player is genocidal
			limit = {
				ROOT = {
					has_valid_civic = civic_fanatic_purifiers
					has_valid_civic = civic_hive_devouring_swarm
					has_valid_civic = civic_machine_terminator
				}
				NOR = { #cant happen twice
					has_global_flag = galactic_pact_formed
					has_global_flag = galactic_hyperstate_formed
					has_global_flag = war_in_heaven_ongoing
				}
			}
			random_list = {
				25 = { #big federation
					country_event = { id = gigafed.3000 }
					set_global_flag = galactic_pact_formed
				}
				50 = { #hyperstate
					if = {
						limit = {
							NOT = {
								has_global_flag = giga_galactic_fed_disabled
							}
						}
						country_event = { id = gigafed.4000 } #hyperstate
						set_global_flag = galactic_hyperstate_formed
					}
				}
				10 = {} #nothing
			}
		}
		else_if = {
			limit = {
				NOR = { #cant happen twice
					has_global_flag = galactic_pact_formed
					has_global_flag = galactic_hyperstate_formed
					has_global_flag = war_in_heaven_ongoing
				}
			}
			random_list = {
				50 = { #big federation
					country_event = { id = gigafed.3000 }
					set_global_flag = galactic_pact_formed
				}
				30 = { #hyperstate
					if = {
						limit = {
							NOT = {
								has_global_flag = giga_galactic_fed_disabled
							}
						}
						country_event = { id = gigafed.4000 } #hyperstate
						set_global_flag = galactic_hyperstate_formed
					}
				}
				80 = {} #nothing
			}
		}
		if = { #hyperstate attacks
			limit = {
				has_global_flag = galactic_hyperstate_formed
				NOT = {
					has_global_flag = galactic_hyperstate_war
				}
			}
			set_global_flag = galactic_hyperstate_war
			country_event = { id = gigafed.4012 days = 30 random = 10 }
		}
		else_if = { #fed attacks
			limit = {
				has_global_flag = galactic_pact_formed
				NOT = {
					has_global_flag = galactic_pact_war
				}
			}
			set_global_flag = galactic_pact_war
			country_event = { id = gigafed.3012 days = 30 random = 10 }
		}
	}

	option = {
		name = gigaquasar.2005.a
	}
}

#######GALACTIC FEDERATION (fed only)#######
namespace = gigafed
country_event = { #galactic pact! send out invitations to the proposal
	id = gigafed.3000

	hide_window = yes

	is_triggered_only = yes

	immediate = {
		country_event = { id = gigafed.3002 days = 10 } #look for a leader
		country_event = { id = gigafed.3005 days = 12 } #message
		every_country = {
			limit = {
				NOR = {
					is_country = ROOT
					is_in_federation_with = ROOT
					is_country_type = ai_empire
					is_country_type = swarm
					is_country_type = extradimensional
					is_country_type = extradimensional_2
					is_country_type = extradimensional_3
					has_valid_civic = civic_fanatic_purifiers
					has_valid_civic = civic_hive_devouring_swarm
					has_valid_civic = civic_machine_terminator
				}
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}
			country_event = { id = gigafed.3001 }
		}
	}
}

country_event = { #galactic pact! send out invitations to the proposal
	id = gigafed.3001

	hide_window = yes

	is_triggered_only = yes

	immediate = {
		set_country_flag = giga_galactic_pact_member
	}
}

country_event = { #galactic pact! find a leader (either a FE/AE or just a random empire)
	id = gigafed.3002

	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				any_country = {
					OR = {
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
						is_country_type = default
					}
					has_country_flag = giga_galactic_pact_member
				}
			}
			random_country = {
				limit = {
					OR = {
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
						is_country_type = default
					}
					has_country_flag = giga_galactic_pact_member
				}
				set_country_flag = giga_galactic_pact_leader
			}
		}
		random_country = {
			limit = {
				has_country_flag = giga_galactic_pact_leader
			}
			remove_country_flag = giga_galactic_pact_member
			save_global_event_target_as = giga_galactic_pact_president
			set_timed_country_flag = { flag = ai_no_leave_fed days = 7200 }
			if = {
				limit = {
					has_federation = yes
				}
				leave_alliance = {
					override_requirements = yes
				}
			}
		}
		random_country = { #a random country joins the pact with the president
			limit = {
				has_country_flag = giga_galactic_pact_member
			}
			if = {
				limit = {
					has_federation = yes
				}
				leave_alliance = {
					override_requirements = yes
				}
			}
			remove_country_flag = giga_galactic_pact_member
			country_event = { id = gigafed.3003 }
		}
	}
}

country_event = { #galactic pact! make the fed
	id = gigafed.3003

	hide_window = yes

	is_triggered_only = yes

	immediate = {
		set_timed_country_flag = { flag = ai_no_leave_fed days = 7200 }
		join_alliance = {
			who = event_target:giga_galactic_pact_president
			name = "Galactic Defense Pact"
			override_requirements = yes
		}
		root.federation = {
			set_federation_flag = giga_galactic_pact
			if = {
				limit = {
					has_federation_perk = cohesion_join_1
				}
				add_cohesion = 50
			}
			else = { add_cohesion = 100 }
			add_federation_experience = 5600 #level 3 with some breathing room
		}
		every_country = {
			limit = {
				has_country_flag = giga_galactic_pact_member
			}
			country_event = { id = gigafed.3004 days = 1 }
		}
	}
}

country_event = { #invite everyone
	id = gigafed.3004

	hide_window = yes

	is_triggered_only = yes

	immediate = {
		set_timed_country_flag = { flag = ai_no_leave_fed days = 7200 }
		join_alliance = {
			who = event_target:giga_galactic_pact_president
			override_requirements = yes
		}
		root.federation = {
			if = { #counteract the -100 cohesion you'd normally get for new members
				limit = {
					has_federation_perk = cohesion_join_1
				}
				add_cohesion = 50
			}
			else = { add_cohesion = 100 }
			add_federation_experience = 150
		}
		if = {
			limit = {
				any_rival_country = {
					has_federation = yes
					federation = {
						is_same_value = root.federation
					}
				}
			}
			every_rival_country = {
				limit = {
					has_federation = yes
					federation = {
						is_same_value = root.federation
					}
				}
				prev = { end_rivalry = prev }
			}
		}
		root.federation = {
			if = {
				limit = {
					any_member = {
						is_rival = prevprev
					}
				}
				every_member = {
					limit = {
						is_rival = prevprev
					}
					end_rivalry = prevprev
				}
			}
		}
		if = {
			limit = {
				is_at_war = yes
			}
			every_war = {
				remove_war_participant = prev
			}
		}
	}
}

country_event = { #message
	id = gigafed.3005
	title = gigafed.3005.name
	desc = gigafed.3005.desc
	show_sound = event_radio_chatter
	picture = GFX_evt_galactic_community
	location = fromfrom

	is_triggered_only = yes

	option = {
		name = gigafed.3005.a
		hidden_effect = {
			country_event = { id = gigafed.3006 days = 10 }
		}
	}
}

country_event = { #message
	id = gigafed.3006
	title = gigafed.3006.name
	desc = gigafed.3006.desc
	location = fromfrom

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:giga_galactic_pact_president
		room = event_target:giga_galactic_pact_president.ruler
	}

	option = {
		name = gigafed.3006.a
	}

	option = {
		name = gigafed.3006.b
	}

	option = {
		name = gigafed.3006.c
	}

	option = {
		name = gigafed.3006.d
	}
}

country_event = { #the federation attacks!
	id = gigafed.3012
	title = gigafed.3012.name
	desc = gigafed.3012.desc
	location = fromfrom

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:pangalactic_federation_country
		room = event_target:pangalactic_federation_country.ruler
	}

	immediate = {
		event_target:pangalactic_federation_country = {
			declare_war = {
				target = ROOT
				attacker_war_goal = "wg_end_threat_hyperweapon"
			}
		}
	}

	option = {
		name = gigafed.3012.a
	}
}



#######GALACTIC FEDERATION#######
namespace = gigafed
country_event = { #galactic federation! send out invitations to the proposal
	id = gigafed.4000

	hide_window = yes

	is_triggered_only = yes

	immediate = {
		country_event = { id = gigafed.4002 days = 10 } #create the federation itself
		every_country = {
			limit = {
				NOR = {
					is_country = ROOT
					is_in_federation_with = ROOT
					is_country_type = ai_empire
					is_country_type = swarm
					is_country_type = extradimensional
					is_country_type = extradimensional_2
					is_country_type = extradimensional_3
					has_valid_civic = civic_fanatic_purifiers
					has_valid_civic = civic_hive_devouring_swarm
					has_valid_civic = civic_machine_terminator
				}
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}

			}
			country_event = { id = gigafed.4001 }
		}
	}
}

country_event = { #galactic federation! send out invitations to the proposal
	id = gigafed.4001

	hide_window = yes

	is_triggered_only = yes

	immediate = {
		set_country_flag = giga_galactic_federation_member
	}
}

country_event = { #galactic federation! create the country
	id = gigafed.4002

	hide_window = yes

	is_triggered_only = yes

	immediate = {
		random_country = {
			limit = {
				has_country_flag = giga_galactic_federation_member
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}
			save_global_event_target_as = giga_galactic_president_country #randomly pick a leader for the federation (FE or AE is required!)
		}
		country_event = { id = gigafed.4010 } #message about the federation
		event_target:giga_galactic_president_country = {
			random_planet_within_border = {
				limit = {
					is_colony = yes
					is_capital = yes
				}
				create_country = {
					name = "Pangalactic Defense League"
					species = event_target:giga_galactic_president_country.species
					type = default
					civics = {
						civic = civic_giga_common_cause
						civic = civic_against_hyperweapon
					}
					flag = {
						icon = {
							category = "corporate"
							file = "corporate_03.dds"
						}
						background = {
							category = "backgrounds"
							file = "circle.dds"
						}
						colors = {
							"purple"
							"purple"
							"null"
							"null"
						}
					}
					authority = auth_oligarchic
					ethos = {
						ethic = ethic_xenophile
						ethic = ethic_fanatic_militarist
					}
					origin = origin_pangalactic
					effect = {
						add_resource = {
							alloys = 500000
							food = 100000
							minerals = 100000
							energy = 100000
							consumer_goods = 100000
							unity = 1000000
						}
						every_planet = {
							surveyed = {
								set_surveyed = yes
								surveyor = root
							}
						}
						add_modifier = { modifier = pangalactic_federation }
						save_global_event_target_as = pangalactic_federation_country
						establish_communications_no_message = ROOT
						add_opinion_modifier = { who = ROOT modifier = opinion_giga_galactic_threat }
						set_country_flag = pangalactic_defense_league
						copy_techs_from = {
							target = event_target:giga_galactic_president_country
						}
					}
				}
				set_owner = event_target:pangalactic_federation_country
				set_capital = yes
			}
		}
		every_country = {
			limit = {
				has_country_flag = giga_galactic_federation_member
				is_gestalt = no
			}
			country_event = { id = gigafed.4003 days = 2 }
		}
		every_country = { #vassalize gestalts
			limit = {
				has_country_flag = giga_galactic_federation_member
				is_gestalt = yes
			}
			country_event = { id = gigafed.4004 days = 2 }
		}
	}
}

country_event = { #galactic federation! merge everything
	id = gigafed.4003

	hide_window = yes

	is_triggered_only = yes

	immediate = {
		every_owned_fleet = {
			set_owner = event_target:pangalactic_federation_country
		}
		every_owned_leader = {
			set_owner = event_target:pangalactic_federation_country
		}
		every_owned_army = {
			set_owner = event_target:pangalactic_federation_country
		}
		every_owned_planet = {
			set_owner = event_target:pangalactic_federation_country
			set_controller = event_target:pangalactic_federation_country
		}
		event_target:pangalactic_federation_country = {
			steal_relic = {
				target = prev
				relic = all
			}
		}
	}
}

country_event = { #galactic federation! vassalize gestalts
	id = gigafed.4004

	hide_window = yes

	is_triggered_only = yes

	immediate = {
		set_subject_of = {
			who = event_target:pangalactic_federation_country
			subject_type = vassal
		}
	}
}

country_event = { #remove weak genocidal empires
	id = gigafed.4005

	hide_window = yes

	is_triggered_only = yes

	immediate = {
		event_target:pangalactic_federation_country = {
			declare_war = {
				target = ROOT
				attacker_war_goal = "wg_end_threat"
			}
		}
	}
}

country_event = { #message
	id = gigafed.4010
	title = gigafed.4010.name
	desc = gigafed.4010.desc
	show_sound = event_celebration
	picture = GFX_evt_galactic_community
	location = fromfrom

	is_triggered_only = yes

	option = {
		name = gigafed.4010.a
		hidden_effect = {
			country_event = { id = gigafed.4011 days = 5 }
		}
	}
}

country_event = { #actual declaration message
	id = gigafed.4011
	title = gigafed.4011.name
	desc = gigafed.4011.desc
	location = fromfrom

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:pangalactic_federation_country
		room = event_target:pangalactic_federation_country.ruler
	}

	immediate = {
		every_country = { #terminate weak genocidals
			limit = {
				OR = {
					relative_power = {
						who = event_target:pangalactic_federation_country
						category = fleet
						value = inferior
					}
					relative_power = {
						who = event_target:pangalactic_federation_country
						category = fleet
						value = pathetic
					}
				}
				OR = {
					has_valid_civic = civic_machine_terminator
					has_valid_civic = civic_fanatic_purifiers
					has_valid_civic = civic_hive_devouring_swarm
				}
				is_ai = yes
			}
			country_event = { id = gigafed.4005 days = 30 }
		}
	}

	option = {
		name = gigafed.4011.a
	}
}

country_event = { #the federation attacks!
	id = gigafed.4012
	title = gigafed.4012.name
	desc = gigafed.4012.desc
	location = fromfrom

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:pangalactic_federation_country
		room = event_target:pangalactic_federation_country.ruler
	}

	immediate = {
		event_target:pangalactic_federation_country = {
			declare_war = {
				target = ROOT
				attacker_war_goal = "wg_end_threat_hyperweapon"
			}
		}
	}

	option = {
		name = gigafed.4012.a
	}
}
