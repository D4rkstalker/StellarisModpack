namespace = femegasmat

event = {
	id = femegasmat.1
	hide_window = yes
	
	fire_only_once = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = femegasinit_happened_mat }
	}
	
	immediate = {
		random_country = {
			limit = { is_country_type = fallen_empire }
			country_event = { id = femegasmat.2 days = 1 }
		}
	}
}

country_event = {
	id = femegasmat.2
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = femegasinit_happened_mat }
	}
	
	immediate = {
		every_country = {
			limit = {
				is_country_type = fallen_empire
				has_ethic = ethic_fanatic_materialist
			}
			random_list = {
				50 = {
					modifier = { factor = 0 always = yes }
					country_event = { id = femegasmat.10 }
				}
				50 = {
					modifier = {
						factor = 0
						NOT = { has_global_flag = gigastructures_enabled }
					}
					country_event = { id = femegasmat.20 }
				}
			}
		}
		set_global_flag = femegasinit_happened_mat
	}
}

country_event = { #science nexus
	id = femegasmat.10
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = fallen_empire
		has_ethic = ethic_fanatic_materialist
	}
	
	immediate = {
		random_list = {
			50 = {
				capital_scope = {
					solar_system = {
						random_system_planet = {
							limit = { is_star = no is_moon = no is_asteroid = no is_colony = no }
							solar_system = {
								spawn_megastructure = {
									type = think_tank_fe
									coords_from = PREV
									owner = ROOT
								}
							}
						}
					}
				}
				
				country_event = { id = FEMtech.1 } #give 20 repeatables
				country_event = { id = FEMtech.1  days = 25 }
				country_event = { id = FEMtech.1  days = 50 }
				country_event = { id = FEMtech.1  days = 75 }
			}
			50 = {
				modifier = {
					factor = 0
					NOT = { has_global_flag = gigastructures_enabled }
				}
				random_system_within_border = {
					limit = { NOT = { any_system_planet = { is_colony = yes } } }
					every_system_planet = {
						limit = { is_star = no }
						remove_planet = yes
					}
					set_asteroid_belt = {
						radius = 0
					}
					random_system_planet = {
						limit = { is_star = yes }
						solar_system = {
							spawn_megastructure = {
								type = matrioshka_brain_5
								coords_from = PREV
								owner = ROOT
							}
						}
					}
				}
				add_modifier = { modifier = fe_has_mega days = -1 }
				
				country_event = { id = FEMtech.1 } #give 40 repeatables
				country_event = { id = FEMtech.1  days = 25 }
				country_event = { id = FEMtech.1  days = 50 }
				country_event = { id = FEMtech.1  days = 75 }
				country_event = { id = FEMtech.1  days = 100 }
				country_event = { id = FEMtech.1  days = 125 }
				country_event = { id = FEMtech.1  days = 150 }
				country_event = { id = FEMtech.1  days = 175 }
			}
		}
	}
}

country_event = { #disinterested gamers
	id = femegasmat.20
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = fallen_empire
		has_ethic = ethic_fanatic_materialist
		has_global_flag = gigastructures_enabled
	}
	
	immediate = {
		capital_scope = { #Matrioshka Simulator
			solar_system = {
				every_system_planet = {
					limit = { is_star = no }
					remove_planet = yes
				}
			}
			star = {
				solar_system = {
					spawn_megastructure = {
						type = matrioshka_brain_6
						coords_from = PREV
						owner = ROOT
					}
					every_system_megastructure = {
						limit = { is_megastructure_type = matrioshka_brain_6 }
						upgrade_megastructure_to = matrioshka_brain_7
						finish_upgrade = yes
						upgrade_megastructure_to = matrioshka_brain_8
						finish_upgrade = yes
						upgrade_megastructure_to = matrioshka_brain_9
						finish_upgrade = yes
					}
					set_asteroid_belt = {
						radius = 0
					}
					create_species = {
						name = "Synthetic"
						class = "ROBOT"
						portrait = random
						traits = {
							trait = "trait_mechanical"
							trait = "trait_robot_domestic_protocols"
							trait = "trait_robot_luxurious"
						}
					}
					random_system_planet = {
						limit = { is_colony = no is_planet_class = pc_virtual_reality }
						set_name = "Gaming Center I"
						while = {
							count = 116
							create_pop = {
								species = ROOT.owner_species
								ethos = { ethic = ethic_materialist }
							}
						}
						while = {
							count = 116
							create_pop = {
								species = last_created_species
								ethos = random
							}
						}
						set_owner = ROOT
						set_capital = yes
						if = {
							limit = {
								any_system = {
									any_system_planet = {
										OR = {
											has_planet_flag = fallen_spiritualist_capital
											has_planet_flag = fallen_materialist_capital
											has_planet_flag = fallen_xenophile_capital
											has_planet_flag = fallen_xenophobe_capital
											has_planet_flag = fallen_machine_capital
										}
									}
								}
							}
							set_planet_flag = fallen_materialist_capital
						}
						while = {
							count = 6
							add_district = district_rw_city
						}
						add_building = building_ancient_palace
						add_building = building_fe_stronghold
						add_building = building_fe_stronghold
						add_building = building_fe_stronghold
						add_building = building_fe_stronghold
						add_building = building_affluence_center
						add_building = building_affluence_center
						add_building = building_affluence_center
						add_building = building_dimensional_fabricator
						add_building = building_dimensional_fabricator
						add_building = building_dimensional_fabricator
						add_building = building_nano_forge
						add_building = building_nano_forge
						add_building = building_nano_forge
						add_building = building_class_4_singularity
						add_building = building_class_4_singularity
					}
					random_system_planet = {
						limit = { is_colony = no is_planet_class = pc_virtual_reality }
						set_name = "Gaming Center II"
						while = {
							count = 116
							create_pop = {
								species = ROOT.owner_species
								ethos = { ethic = ethic_materialist }
							}
						}
						while = {
							count = 116
							create_pop = {
								species = last_created_species
								ethos = random
							}
						}
						set_owner = ROOT
						while = {
							count = 6
							add_district = district_rw_city
						}
						add_building = building_ancient_palace
						add_building = building_fe_stronghold
						add_building = building_fe_stronghold
						add_building = building_fe_stronghold
						add_building = building_fe_stronghold
						add_building = building_affluence_center
						add_building = building_affluence_center
						add_building = building_affluence_center
						add_building = building_dimensional_fabricator
						add_building = building_dimensional_fabricator
						add_building = building_dimensional_fabricator
						add_building = building_nano_forge
						add_building = building_nano_forge
						add_building = building_nano_forge
						add_building = building_class_4_singularity
						add_building = building_class_4_singularity
					}
					random_system_planet = {
						limit = { is_colony = no is_planet_class = pc_virtual_reality }
						set_name = "Gaming Center III"
						while = {
							count = 116
							create_pop = {
								species = ROOT.owner_species
								ethos = { ethic = ethic_materialist }
							}
						}
						while = {
							count = 116
							create_pop = {
								species = last_created_species
								ethos = random
							}
						}
						set_owner = ROOT
						while = {
							count = 6
							add_district = district_rw_city
						}
						add_building = building_ancient_palace
						add_building = building_fe_stronghold
						add_building = building_fe_stronghold
						add_building = building_fe_stronghold
						add_building = building_fe_stronghold
						add_building = building_affluence_center
						add_building = building_affluence_center
						add_building = building_affluence_center
						add_building = building_dimensional_fabricator
						add_building = building_dimensional_fabricator
						add_building = building_dimensional_fabricator
						add_building = building_nano_forge
						add_building = building_nano_forge
						add_building = building_nano_forge
						add_building = building_class_4_singularity
						add_building = building_class_4_singularity
					}
					random_system_planet = {
						limit = { is_colony = no is_planet_class = pc_virtual_reality }
						set_name = "Gaming Center IV"
						while = {
							count = 116
							create_pop = {
								species = ROOT.owner_species
								ethos = { ethic = ethic_materialist }
							}
						}
						while = {
							count = 116
							create_pop = {
								species = last_created_species
								ethos = random
							}
						}
						set_owner = ROOT
						while = {
							count = 6
							add_district = district_rw_city
						}
						add_building = building_ancient_palace
						add_building = building_fe_stronghold
						add_building = building_fe_stronghold
						add_building = building_fe_stronghold
						add_building = building_fe_stronghold
						add_building = building_affluence_center
						add_building = building_affluence_center
						add_building = building_affluence_center
						add_building = building_dimensional_fabricator
						add_building = building_dimensional_fabricator
						add_building = building_dimensional_fabricator
						add_building = building_nano_forge
						add_building = building_nano_forge
						add_building = building_nano_forge
						add_building = building_class_4_singularity
						add_building = building_class_4_singularity
					}
				}
			}
		}
		
		every_owned_planet = { #kill off other colonies
			limit = {
				NOR = {
					is_planet_class = pc_virtual_reality
					is_planet_class = pc_virtual_industry
				}
			}
			change_pc = pc_barren
			add_modifier = { modifier = terraforming_candidate days = -1 }
			remove_planet_flag = fallen_empire_world
		}
		set_policy = { #so that they don't kill off their robots.
			policy = appropriation
			option = appropriation_not_allowed
			cooldown = no
		}
		if = { #spawn ringworld
			limit = {
				capital_scope.solar_system = {
					any_neighbor_system = {
						exists = starbase
						starbase = {
							has_starbase_size = starbase_citadel
						}
					}
				}
			}
			random_system_within_border = {
				limit = {
					has_any_megastructure = no
					starbase = {
						has_starbase_size = starbase_citadel
					}
					any_neighbor_system = {
						has_megastructure = matrioshka_brain_9
					}
				}
				spawn_materialist_ringworld = yes
				set_asteroid_belt = {
					radius = 0
				}
			}
		}
		else_if = {
			limit = {
				capital_scope.solar_system = {
					any_neighbor_system = {
						any_neighbor_system = {
							exists = starbase
							NOT = { is_same_value = ROOT.capital_scope.solar_system }
							starbase = {
								has_starbase_size = starbase_citadel
							}
						}
					}
				}
			}
			random_system_within_border = {
				limit = {
					has_any_megastructure = no
					starbase = {
						has_starbase_size = starbase_citadel
					}
					any_neighbor_system = {
						any_neighbor_system = {
							has_megastructure = matrioshka_brain_9
						}
					}
				}
				spawn_materialist_ringworld = yes
			}
		}
		else_if = {
			limit = {
				capital_scope.solar_system = {
					any_neighbor_system = {
						any_neighbor_system = {
							any_neighbor_system = {
								exists = starbase
								NOT = { is_same_value = ROOT.capital_scope.solar_system }
								starbase = {
									has_starbase_size = starbase_citadel
								}
							}
						}
					}
				}
			}
			random_system_within_border = {
				limit = {
					has_any_megastructure = no
					starbase = {
						has_starbase_size = starbase_citadel
					}
					any_neighbor_system = {
						any_neighbor_system = {
							any_neighbor_system = {
								has_megastructure = matrioshka_brain_9
							}
						}
					}
				}
				spawn_materialist_ringworld = yes
			}
		}
		else = {
			random_system_within_border = {
				limit = {
					has_any_megastructure = no
					starbase = {
						has_starbase_size = starbase_citadel
					}
				}
				spawn_materialist_ringworld = yes
			}
		}
		
		every_owned_ship = {
			limit = {
				fleet = {
					any_owned_ship = {
						is_ship_size = starbase_citadel
					}
				}
				NOT = {
					owner = {
						any_owned_starbase = {
							is_same_value = PREVPREV
						}
					}
				}
				is_ship_size = military_station_small_fallen_empire
				NOT = {
					solar_system = {
						any_system_planet = {
							OR = {
								is_planet_class = pc_virtual_reality
								is_planet_class = pc_ringworld_habitable
							}
						}
					}
				}
			}
			delete_ship = THIS
			solar_system.starbase = {
				set_starbase_size = starbase_outpost
			}
		}
		
		change_government = { #change government to change personality
			authority = auth_imperial
			civics = {
				civic = civic_lethargic_leadership
				civic = civic_empire_in_decline
				civic = civic_disinterested_gamers
			}
		}
		country_event = { id = FEMtech.1 } #give 10 repeatables
		country_event = { id = FEMtech.1  days = 25 }
		
		set_name = "[owner.GetSpeciesName] Gaming Group"
		every_planet_within_border = {
			limit = { has_deposit = yes has_orbital_station = no }
			if = {
				limit = { has_deposit_for = shipclass_mining_station }
				create_mining_station = { owner = ROOT }
			}
			else_if = {
				limit = { has_deposit_for = shipclass_research_station }
				create_research_station = { owner = ROOT }
			}
		}
		add_modifier = { modifier = gamers_modifier days = -1 }
		add_modifier = { modifier = gamers_fallen_modifier days = -1 }
		every_owned_planet = {
			set_planet_flag = fallen_empire_world
			set_planet_flag = gamer_world
		}
	}
}