############################
#
# Expanded Game Start Events
#
############################

namespace = gamestartexpanded

# Start-Up Events
event = {
	id = gamestartexpanded.1
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = expanded_events_active }
	}
	
	immediate = {
		set_global_flag = expanded_events_active
		# Spawn Unique Systems
		# Mass Effect Citadel
		random_list = {
			60 = {
				random_system = {
					limit = { is_inside_nebula = yes }
					spawn_system = {
						min_distance = 10
						max_distance = 30
						initializer = "special_expanded_widow"
					}
				}
			}
			40 = {
				# Do not spawn
				modifier = {
					factor = 0.5
					count_system = { count > 975 }
				}
			}
		}
		# Dune
		random_list = {
			60 = {
				random_system = {
					limit = {
						NOT = { exists = space_owner }
						OR = {
							has_star_flag = enclave
							has_star_flag = primitive_system
						}
					}
					spawn_system = {
						min_distance = 10
						max_distance = 30
						initializer = "dune_arrakis_system"
					}
				}
			}
			40 = {
				# Do not spawn
				modifier = {
					factor = 0.5
					count_system = { count > 975 }
				}
			}
		}
		# Steven Universe, Gem Homeworld
		random_list = {
			60 = {
				random_system = {
					limit = {
						NOT = { exists = space_owner }
						NOT = {
							any_neighbor_system = { exists = space_owner }
						}
					}
					spawn_system = {
						min_distance = 10
						max_distance = 30
						initializer = "gem_homeworld_system"
					}
				}
			}
			40 = {
				# Do not spawn
				modifier = {
					factor = 0.5
					count_system = { count > 975 }
				}
			}
		}
		# Martin Anward, The Bubble
		random_list = {
			60 = {
				random_rim_system = {
					limit = {
						NOT = { exists = space_owner }
						NOT = {
							any_neighbor_system = { exists = space_owner }
						}
					}
					spawn_system = {
						min_distance = 10
						max_distance = 30
						initializer = "bubble_init"
					}
				}
			}
			40 = {
				# Do not spawn
				modifier = {
					factor = 0.5
					count_system = { count > 975 }
				}
			}
		}
		# MAT FE colony
		if = {
			limit = {
				has_ancrel = yes
				any_country = {
					is_country_type = fallen_empire
					has_ethic = ethic_fanatic_materialist
				}
			}
			random_country = {
				limit = {
					is_country_type = fallen_empire
					has_ethic = ethic_fanatic_materialist
				}
				random_system_within_border = {
					spawn_system = {
						min_distance = 40
						max_distance = 90
						initializer = "expanded_relic_system_1"
					}
				}
			}
		}
		# Mega-Ruins
		random_list = {
			80 = {
				if = {
					limit = {
						has_ancrel = yes
					}
					random_system = {
						limit = {
							NOT = { exists = space_owner }
							NOT = {
								any_neighbor_system = { exists = space_owner }
							}
						}
						spawn_system = { initializer = "mega_engineering_system_1" }
					}
				}
			}
			20 = {
				# Do Not Spawn
				modifier = {
					factor = 4
					NOT = { count_system = { count > 700 } }
				}
				modifier = {
					factor = 0
					count_system = { count > 975 }
				}
			}
		}
		# Spawn more tomb worlds on larger galaxies
		if = {
			limit = {
				has_distar = yes
				count_system = { count > 750 }
			}
			random_system = {
				limit = {
					NOT = { exists = space_owner }
					NOT = {
						any_neighbor_system = { exists = space_owner }
					}
				}
				spawn_system = { initializer = "nuked_init_01" }
			}
			random_system = {
				limit = {
					NOT = { exists = space_owner }
					NOT = {
						any_neighbor_system = { exists = space_owner }
					}
				}
				spawn_system = { initializer = "nuked_init_02" }
			}
			random_system = {
				limit = {
					NOT = { exists = space_owner }
					NOT = {
						any_neighbor_system = { exists = space_owner }
					}
				}
				spawn_system = { initializer = "nuked_init_03" }
			}
		}
		# Spawn more l-gates on large galaxies
		if = {
			limit = {
				has_distar = yes
				count_system = { count > 750 }
			}
			random_system = {
				limit = {
					NOT = { exists = space_owner }
					NOT = {
						any_neighbor_system = { exists = space_owner }
					}
				}
				spawn_system = { initializer = "distantstars_init_00" }
			}
			random_system = {
				limit = {
					NOT = { exists = space_owner }
					NOT = {
						any_neighbor_system = { exists = space_owner }
					}
				}
				spawn_system = { initializer = "distantstars_init_00" }
			}
		}
		if = {
			limit = {
				has_distar = yes
				count_system = { count > 950 }
			}
			random_system = {
				limit = {
					NOT = { exists = space_owner }
					NOT = {
						any_neighbor_system = { exists = space_owner }
					}
				}
				spawn_system = { initializer = "distantstars_init_00" }
			}
			random_system = {
				limit = {
					NOT = { exists = space_owner }
					NOT = {
						any_neighbor_system = { exists = space_owner }
					}
				}
				spawn_system = { initializer = "distantstars_init_00" }
			}
		}
		if = {
			limit = {
				has_distar = yes
				count_system = { count > 1450 }
			}
			random_system = {
				limit = {
					NOT = { exists = space_owner }
					NOT = {
						any_neighbor_system = { exists = space_owner }
					}
				}
				spawn_system = { initializer = "distantstars_init_00" }
			}
			random_system = {
				limit = {
					NOT = { exists = space_owner }
					NOT = {
						any_neighbor_system = { exists = space_owner }
					}
				}
				spawn_system = { initializer = "distantstars_init_00" }
			}
		}
		# Wasteful races can get damaged ecosystem on homeworld
		every_country = {
			limit = {
				is_country_type = default
				any_owned_pop = {
					OR = {
						pop_has_trait = trait_wasteful
						pop_has_trait = trait_industrious
						pop_has_trait = trait_rapid_breeders
					}
				}
				NOR = {
					any_owned_pop = { pop_has_trait = trait_conservational }
					any_owned_pop = { pop_has_trait = trait_communal }
					any_owned_pop = { pop_has_trait = trait_agrarian }
					any_owned_pop = { pop_has_trait = trait_traditional }
					has_ethic = ethic_gestalt_consciousness
					has_valid_civic = civic_environmentalist
					has_valid_civic = civic_agrarian_idyll
					has_valid_civic = civic_life_seeded
					has_valid_civic = civic_post_apocalyptic
					has_valid_civic = civic_terraformer
					has_valid_civic = civic_subterranean_evolution
					has_valid_civic = civic_subterranean_evolution_hive
					has_valid_civic = civic_agribusiness
					has_valid_civic = civic_hmo
					has_valid_civic = civic_biological_engineering
					has_valid_civic = civic_natural_hunters
					has_valid_civic = civic_lost_colony
					has_valid_civic = civic_voidborne
					has_country_flag = human_2 # capital is a colony
				}
			}
			country_event = { id = gamestartexpanded.6 days = 1 random = 10 }
		}
		# If any country UNE, chance to spawn CoM
		if = {
			limit = {
				any_country = {
					has_country_flag = human_1
					has_valid_civic = civic_beacon_of_liberty
					has_valid_civic = civic_idealistic_foundation
					has_ethic = ethic_xenophile
					has_ethic = ethic_fanatic_egalitarian
				}
				NOT = { any_country = { has_country_flag = human_2 } }
			}
			random_system = {
				limit = {
					NOT = { exists = space_owner }
					NOR = {
						any_neighbor_system = { exists = space_owner }
						has_star_flag = empire_cluster
						has_star_flag = hostile_system
						is_fe_cluster = yes
					}
				}
				spawn_system = {
					initializer = "une_deneb_system"
					min_distance >= 20
					max_distance <= 50
				}
				random_system = {
					limit = {
						exists = space_owner
						space_owner = { has_country_flag = human_2 is_ai = yes }
					}
					space_owner = {
						every_planet_within_border = {
							limit = {
								has_deposit_for = shipclass_mining_station
							}
							create_mining_station = { owner = PREV }
						}
					}
					add_hyperlane = { from = this to = prev }
				}
			}
		}
		# Start CoM event chain
		random_country = {
			limit = {
				has_country_flag = human_1
				has_valid_civic = civic_beacon_of_liberty
				has_valid_civic = civic_idealistic_foundation
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_egalitarian
			}
			country_event = { id = countryexpanded.30 days = 30 random = 30 }
		}
		if = {
			limit = { any_country = { has_country_flag = human_2 }  }
			random_country = {
				limit = { has_country_flag = human_2 }
				country_event = { id = gamestartexpanded.2 days = 5 }
			}
		}
		
		# Set if game has planetary diversity
		if = {
			limit = {
				any_system = {
					any_system_planet = {
						is_planet_class = pc_ammonia
					}
				}
			}
			set_global_flag = has_planetary_diversity
		}
		
		### spawn some primitives###
		random_system = {
			limit = {
				NOT = { has_star_flag = primitive_system }
				OR = {
					NOT = { exists = space_owner }
					AND = {
						exists = space_owner 
						space_owner = {
							NOT = { is_country_type = fallen_empire }
							NOT = { is_country_type = awakened_fallen_empire }
							NOT = { is_country_type = default }
						}
					}
				}
			}
			spawn_system = { initializer = "special_init_02" }
		}
		random_system = {
			limit = {
				NOT = { has_star_flag = primitive_system }
				OR = {
					NOT = { exists = space_owner }
					AND = {
						exists = space_owner 
						space_owner = {
							NOT = { is_country_type = fallen_empire }
							NOT = { is_country_type = awakened_fallen_empire }
							NOT = { is_country_type = default }
						}
					}
				}
			}
			spawn_system = { initializer = "special_init_02" }
		}
		random_system = {
			limit = {
				NOT = { has_star_flag = primitive_system }
				OR = {
					NOT = { exists = space_owner }
					AND = {
						exists = space_owner 
						space_owner = {
							NOT = { is_country_type = fallen_empire }
							NOT = { is_country_type = awakened_fallen_empire }
							NOT = { is_country_type = default }
						}
					}
				}
			}
			spawn_system = { initializer = "special_init_02" }
		}
		# primitive near player
		random_system = {
			limit = {
				exists = space_owner
				space_owner = { is_ai = no }
			}
			random_system = {
				limit = {
					distance = {
						source = prev
						use_bypasses = no
						min_jumps = 6
						max_jumps = 24
					}
					NOT = { has_star_flag = primitive_system }
					OR = {
						NOT = { exists = space_owner }
						AND = {
							exists = space_owner 
							space_owner = {
								NOT = { is_country_type = fallen_empire }
								NOT = { is_country_type = awakened_fallen_empire }
								NOT = { is_country_type = default }
							}
						}
					}
				}
				spawn_system = { initializer = "special_init_02" }
			}
		}
		
		# Terraforming Candidates
		every_planet = {
			limit = {
				has_modifier = terraforming_candidate
			}
			planet_event = { id = gamestartexpanded.4 days = 5 }
		}
		# Tidally Locked
		every_planet = {
			limit = {
				solar_system = {
					OR = {
						is_red_giant = yes
						is_yellow_giant = yes
						is_red_supergiant = yes
						is_yellow_supergiant = yes
						is_blue_supergiant = yes
						is_red_supergiant = yes
						is_yellow_supergiant = yes
						is_blue_supergiant = yes
					}
				}
			}
			remove_modifier = tidal_locked
		}
		# Xenophobes less likely to be megacorps
		every_country = {
			limit = {
				is_xenophobe = yes
				has_authority = auth_corporate
				NOT = { has_valid_civic = civic_criminal_heritage }
				NOT = { has_valid_civic = civic_gospel_of_the_masses }
			}
			country_event = { id = gamestartexpanded.5 }
		}
		# No Chthonian Moons
		every_planet = {
			limit = {
				has_modifier = chthonian_planet
				is_moon = yes
			}
			planet_event = { id = gamestartexpanded.7 days = 1 }
		}
		# Random Primitive Homeworld Names
		every_planet = {
			limit = {
				NOT = { is_planet_class = pc_habitat }
				exists = owner
				owner = {
					OR = {
						is_country_type = primitive
						is_country_type = vbp_hive
						is_country_type = vbp_machine
					}
				}
			}
			planet_event = { id = gamestartexpanded.8 days =  1 }
		}
		# Random country events
		every_country = {
			limit = {
				is_country_type = default
			}
			country_event = { id = gamestartexpanded.3 days = 1 random = 10 }
		}
		# Random Anomalies
		random_planet = {
			limit = {
				solar_system = {
					NOT = { exists = space_owner }
				}
				has_anomaly  = no
				OR = {
					is_planet_class = pc_ocean
					is_planet_class = pc_mangrove
					is_planet_class = pc_desertislands
				}
			}
			random_list = {
				1 = { add_anomaly = { category = SEA_CAT } }
				1 = { }
			}
		}
		random_planet = {
			limit = {
				solar_system = {
					NOT = { exists = space_owner }
				}
				has_anomaly  = no
				OR = {
					is_planet_class = pc_tropical
					is_planet_class = pc_continental
					is_planet_class = pc_tidallylocked
					is_planet_class = pc_mangrove
					is_planet_class = pc_hajungle
					is_planet_class = pc_arid
					is_planet_class = pc_mesa
					is_planet_class = pc_mushroom
					is_planet_class = pc_biolumen
					is_planet_class = pc_superhabitable
				}
			}
			random_list = {
				1 = { add_anomaly = { category = HAB_MAT_CAT } }
				1 = { }
			}
		}
		random_planet = {
			limit = {
				solar_system = {
					NOT = { exists = space_owner }
				}
				has_anomaly  = no
				OR = {
					is_planet_class = pc_desert
					is_planet_class = pc_sandsea
					is_planet_class = pc_oasis
				}
			}
			random_list = {
				1 = { add_anomaly = { category = GEN_DESERT_CAT } }
				1 = { }
			}
		}
		random_planet = {
			limit = {
				solar_system = {
					NOT = { exists = space_owner }
				}
				has_anomaly  = no
				is_star = yes
				is_star_class = sc_black_hole
			}
			random_list = {
				1 = { add_anomaly = { category = EXPANDED_WORMHOLE_CAT } }
				1 = { }
			}
		}
		random_planet = {
			limit = {
				solar_system = {
					NOT = { exists = space_owner }
				}
				has_anomaly  = no
				habitable_planet = yes
				NOR = {
					has_modifier = lush_planet
					has_modifier = bleak_planet
				}
			}
			random_list = {
				1 = { add_anomaly = { category = EXPANDED_STRANGE_SOIL_CAT } }
				1 = { }
			}
		}
	}
}

# Commonwealth of Man sets Earth as their homeworld
country_event = {
	id = gamestartexpanded.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = {
				OR = {
					has_country_flag = human_1
					has_country_flag = human_3
				}
			}
			capital_scope = { save_event_target_as = planet_earth }
			if = {
				limit = {
					has_civic = civic_parliamentary_system
					ROOT = {
						NOT = { has_civic = civic_lost_colony }
					}
				}
				ROOT = {
					change_government = {
						civics = {
							civic = civic_nationalistic_zeal
							civic = civic_distinguished_admiralty
							civic = civic_lost_colony
						}
					}
				}
			}
		}
		capital_scope = {
			if = {
				limit = { NOT = { has_deposit = d_chrysanthemum } }
				add_deposit = d_chrysanthemum
			}
			if = {
				limit = {
					NOT = { has_modifier = death_world }
					has_global_flag = has_new_frontiers_mod
				}
				add_modifier = { modifier = death_world days = -1 }
			}
			solar_system = {
				closest_system = {
					limit = { NOT = { has_hyperlane_to = prev } }
					add_hyperlane = { from = this to = prev }
				}
			}
		}
		owner_species = {
			set_species_homeworld = event_target:planet_earth
		}
	}
}

# random country events
country_event = {
	id = gamestartexpanded.3
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			92 = {
			}
			5 = {
				# Observation Post
				country_event = { id = countryexpanded.320 days = 15 random = 360 }
			}
			3 = {
				# Panspermia
				country_event = { id = countryexpanded.300 days = 30 random = 720 }
			}
		}
	}
}

planet_event = {
	id = gamestartexpanded.4
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					AND = {
						is_planetary_diversity_active = no
						OR = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
						}
					}
					has_modifier = scorched_world
					has_modifier = hot_barren_world
					has_planet_flag = hot_zone
					solar_system = {
						OR = {
							is_star_class = "sc_black_hole"
							is_star_class = "sc_neutron_star"
							is_star_class = "sc_pulsar"
							is_star_class = sc_o_super
							is_star_class = sc_o_hyper
							is_star_class = sc_b_super
							is_star_class = sc_a_super
							is_star_class = sc_f_super
							is_star_class = sc_g_super
							is_star_class = sc_k_super
							is_star_class = sc_m_super
							is_star_class = sc_m_hyper
							is_star_class = sc_nova_1
							is_star_class = sc_nova_2
							is_star_class = sc_collapsar
							is_star_class = sc_protostar
							is_star_class = sc_lbv_blue
							is_star_class = sc_lbv_green
							is_star_class = sc_lbv_red
							is_star_class = "sc_o"
							is_star_class = "sc_l"
							is_star_class = "sc_d"
							is_star_class = "sc_c_giant"
							is_star_class = "sc_s_giant"
							is_star_class = "sc_w_azure"
							is_star_class = "sc_w_red"
							is_star_class = "sc_w_green"
							is_star_class = "sc_w_purple"
							is_star_class = "sc_tt_red"
							is_star_class = "sc_tt_orange"
							is_star_class = "sc_tt_white"
							is_star_class = "sc_ae"
							is_star_class = "sc_p_purple"
							is_star_class = "sc_p_green"
							is_star_class = "sc_p_red"
							is_star_class = "sc_magnetar"
						}
					}
				}
			}
			remove_modifier = terraforming_candidate
		}
	}
}

country_event = {
	id = gamestartexpanded.5
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			40 = {
			}
			50 = {
				change_government = {
					authority = auth_oligarchic
					civics = random
				}
			}
			10 = {
				change_government = {
					authority = auth_corporate
					civics = {
						civic = civic_criminal_heritage
						civic = random
					}
				}
			}
		}
	}
}

country_event = {
	id = gamestartexpanded.6
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			25 = {
				modifier = {
					factor = 0.75
					has_ethic = ethic_fanatic_spiritualist
				}
				modifier = {
					factor = 0.85
					has_ethic = ethic_spiritualist
				}
				modifier = {
					factor = 0.75
					has_ethic = ethic_fanatic_pacifist
				}
				modifier = {
					factor = 0.85
					has_ethic = ethic_pacifist
				}
				modifier = {
					factor = 1.25
					has_country_flag = human_1
				}
				modifier = {
					factor = 1.25
					OR = {
						has_authority = auth_corporate
						has_civic = civic_corporate_dominion
					}
				}
				modifier = {
					factor = 1.25
					OR = {
						has_civic = civic_mining_guilds
						has_civic = civic_mining_company
					}
				}
				modifier = {
					factor = 1.25
					any_owned_pop = {
						AND = {
							pop_has_trait = trait_wasteful
							pop_has_trait = trait_industrious
						}
					}
				}
				country_event = { id = countryexpanded.20 days = 60 random = 120 }
			}
			75 = {
				# nothing
			}
		}
	}
}

# No Chthonian Moon
planet_event = {
	id = gamestartexpanded.7
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		remove_modifier = chthonian_planet
	}
}

# Random names for primitive worlds
planet_event = {
	id = gamestartexpanded.8
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		set_name = random
	}
}