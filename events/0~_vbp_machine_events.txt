namespace = vbp_machine

#Space age
country_event = {
	id = vbp_machine.200
	
	hide_window = yes
	
	trigger = {
		is_country_type = vbp_machine
		OR = {
			years_passed > 25
			has_global_flag = vbp_machine_testing
			exists = from
		}
	}
	
	mean_time_to_happen = {
		years = 100
		
		modifier = {
			factor = 0.01
			has_global_flag = vbp_machine_testing
		}
		
		modifier = {
			factor = 0.8
			has_country_flag = vbp_machine_angered
		}
	}
	
	immediate = {
		remove_country_flag = vbp_primitive_robots
		set_country_flag = primitives_can_into_space
		set_country_type = default
		IF = {
            limit = { 
                OR = {
                    AND = {
                        has_country_flag = vbp_machine_angered 
                        NOT = { exists = from } 
                    }
                    AND = {
                        exists = FROM
                        FROM = { has_civic = civic_machine_terminator }
                    }
                }
            }
            change_government = {
                civics = {
                    civic = civic_machine_terminator
                    civic = random
                }
            }
        }
        else = {
            change_government = {
                civics = random
            }
            while = { #Reroll civics terminator vassals not allowed
                limit = {
                    exists = from
                    FROM = { NOT = { has_civic = civic_machine_terminator } }
                    has_civic = civic_machine_terminator
                }
                change_government = {
                    civics = random
                }
            }
        }
		change_country_flag = random
		add_resource = {
            minerals = 1000
            energy = 500
        }
		set_name = random
		remove_country_flag = day_0
		
		capital_scope = {
			IF = {
				limit = { has_observation_outpost = yes }
				observation_outpost_owner = { country_event = { id = vbp_machine.201 } }
				observation_outpost = { dismantle = yes }
            }
            remove_all_buildings = yes
            remove_all_armies = yes
            add_district = district_nexus
            add_district = district_nexus
            add_district = district_nexus
            add_district = district_mining
            add_district = district_mining
            add_district = district_generator
            add_district = district_generator
            add_district = district_generator
            add_district = district_generator
            add_district = district_generator
            add_building = building_machine_capital	
            add_building = building_maintenance_depot
            add_building = building_research_lab_1
            add_building = building_foundry_1
            add_building = building_machine_assembly_plant
            while = {
                count = 3
                create_pop = { species = root }
            }
			solar_system = {
				if = {
					limit = {
						NOT = { exists = starbase }
					}
					create_starbase = {
						size = starbase_outpost
						owner = root
					}
				}
				else = {
					if = {
						limit = {
							starbase = {
								NOT = { owner = { is_same_value = root } }
							}								
						}	
						starbase = {
							owner = { country_event = { id = primitive.180 days = 10 } }
						}								
					}
				}
			}
		}
	}
}
