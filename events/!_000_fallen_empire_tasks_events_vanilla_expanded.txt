############################
#
# Fallen Empire Events
#
# Written by Martin Anward
#
############################

namespace = fallen_empires_tasks

# Patronizing Fallen Empire gives a gift
country_event = {
	id = fallen_empires_tasks.1
	title = OK
	desc = OK
	
	hide_window = yes
	
	trigger = {
		is_country_type = default				
		fleet_power < 100000	
		is_at_war = no
		
		any_country = {
			is_valid_fallen_empire_for_task = yes
			root = { NOT = { has_opinion_modifier = { who = prev modifier = opinion_fallen_empire_gift } }	}
			NOT = { has_opinion_modifier = { who = root modifier = opinion_spurned_fallen_empire_gift } }
			OR = {
				is_patronizing_to = root
				is_enigmatic_to = root
			}			
			has_communications = root
		}
	}
	
	mean_time_to_happen = {
		years = 100	

		modifier = {
			factor = 2.0
			NOT = {
				any_country = {
					is_valid_fallen_empire_for_task = yes
					root = { NOT = { has_opinion_modifier = { who = prev modifier = opinion_fallen_empire_gift } } }
					NOT = { has_opinion_modifier = { who = root modifier = opinion_spurned_fallen_empire_gift } }
					has_communications = root	
					OR = {
						is_patronizing_to = root
						AND = {
							is_enigmatic_to = root
							OR = {
								has_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }		
								has_opinion_modifier = { who = root modifier = opinion_completed_fallen_empire_task }									
							}
						}
					}			
				}				
			}		
		}		
		
		modifier = {
			factor = 0.25
			any_country = {
				is_valid_fallen_empire_for_task = yes
				root = { NOT = { has_opinion_modifier = { who = prev modifier = opinion_fallen_empire_gift } }}
				NOT = { has_opinion_modifier = { who = root modifier = opinion_spurned_fallen_empire_gift } }
				is_enigmatic_to = root
				has_communications = root	
				has_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }		
			}			
		}
		
		modifier = {
			factor = 0.10
			any_country = {
				is_valid_fallen_empire_for_task = yes
				root = { NOT = { has_opinion_modifier = { who = prev modifier = opinion_fallen_empire_gift } }}
				NOT = { has_opinion_modifier = { who = root modifier = opinion_spurned_fallen_empire_gift } }
				is_enigmatic_to = root
				has_communications = root	
				has_opinion_modifier = { who = root modifier = opinion_completed_fallen_empire_task }		
			}			
		}		
		
		modifier = {
			factor = 0.5
			any_country = {
				is_valid_fallen_empire_for_task = yes
				root = { NOT = { has_opinion_modifier = { who = prev modifier = opinion_fallen_empire_gift } }}
				NOT = { has_opinion_modifier = { who = root modifier = opinion_spurned_fallen_empire_gift } }
				is_patronizing_to = root
				has_communications = root	
				has_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }		
			}
		}
		
		modifier = {
			factor = 0.25
			any_country = {
				is_valid_fallen_empire_for_task = yes
				root = { NOT = { has_opinion_modifier = { who = prev modifier = opinion_fallen_empire_gift } }}
				NOT = { has_opinion_modifier = { who = root modifier = opinion_spurned_fallen_empire_gift } }
				is_patronizing_to = root
				has_communications = root	
				has_opinion_modifier = { who = root modifier = opinion_completed_fallen_empire_task }			
			}
		}
		
		modifier = {
			factor = 0.75
			any_country = {
				is_valid_fallen_empire_for_task = yes
				root = { NOT = { has_opinion_modifier = { who = prev modifier = opinion_fallen_empire_gift } } }
				NOT = { has_opinion_modifier = { who = root modifier = opinion_spurned_fallen_empire_gift } }
				is_patronizing_to = root			
				is_patronizing_to = root
				has_communications = root	
				opinion = { who = root value > 74 }
			}
		}
		
		modifier = {
			factor = 0.75
			any_country = {
				is_valid_fallen_empire_for_task = yes
				root = { NOT = { has_opinion_modifier = { who = prev modifier = opinion_fallen_empire_gift } }	}
				NOT = { has_opinion_modifier = { who = root modifier = opinion_spurned_fallen_empire_gift } }
				is_patronizing_to = root			
				is_patronizing_to = root
				has_communications = root	
				opinion = { who = root value > 99 }
			}
		}
		
		modifier = {
			factor = 0.75
			any_country = {
				is_valid_fallen_empire_for_task = yes
				root = { NOT = { has_opinion_modifier = { who = prev modifier =  opinion_fallen_empire_gift } }	}
				NOT = { has_opinion_modifier = { who = root modifier = opinion_spurned_fallen_empire_gift } }
				is_patronizing_to = root			
				is_patronizing_to = root
				has_communications = root	
				opinion = { who = root value > 149 }
			}
		}
		
		modifier = {
			factor = 0.75
			any_country = {
				is_valid_fallen_empire_for_task = yes
				root = { NOT = { has_opinion_modifier = { who = prev modifier =  opinion_fallen_empire_gift } }	}
				NOT = { has_opinion_modifier = { who = root modifier = opinion_spurned_fallen_empire_gift } }
				is_patronizing_to = root				
				is_patronizing_to = root
				has_communications = root	
				opinion = { who = root value > 199 }
			}
		}
	}
	
	immediate = {
		random_country = {
			limit = { 
				is_valid_fallen_empire_for_task = yes
				root = { NOT = { has_opinion_modifier = { who = prev modifier =  opinion_fallen_empire_gift } }	}
				NOT = { has_opinion_modifier = { who = root modifier = opinion_spurned_fallen_empire_gift } }
				OR = {
					is_patronizing_to = root
					is_enigmatic_to = root
				}				
				has_communications = root	
			}
			
			save_event_target_as = FallenEmpireTaskOrigin
			
			root = {
				random_list = {
					50 = { 
						if = {
							limit = { mid_game_years_passed >= 0 }
							set_country_flag = fe_gift_resources_large 
						}									
						else = {
							set_country_flag = fe_gift_resources_small
						}
					}
					20 = { set_country_flag = fe_gift_databanks }
					15 = {
						modifier = {
							factor = 0
							OR = {
								event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_xenophile } }
								NAND = {
									any_owned_planet = {
										has_planet_flag = damaged_homeworld
									}
									NOT = { has_special_project = SAVING_PLANET_EARTH_PROJECT }
								}
							}
						}
						set_country_flag = fe_gift_fix_homeworld
					}
					10 = {
						modifier = {
							factor = 0
							NOR = {
								has_technology = tech_combat_computers_3
								has_technology = tech_synthetic_workers
							}
						}
						modifier = {
							factor = 0
							OR = {
								NOT = { host_has_dlc = "Synthetic Dawn Story Pack" }
								event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_materialist } }
								has_ethic = ethic_gestalt_consciousness
								has_country_flag = synthetic_empire
								has_policy_flag = ai_full_rights
								has_policy_flag = robots_outlawed
								has_country_flag = no_machine_uprising
							}
						}
						set_country_flag = fe_gift_three_laws
					}
					15 = { set_country_flag = fe_gift_rare_tech }
					10 = { 
						if = {
							limit = { mid_game_years_passed >= 0 }
							set_country_flag = fe_gift_escorts 
						}					
						else = {
							set_country_flag = fe_gift_resources_large 
						}
					}
					5 = { 
						if = {
							limit = { mid_game_years_passed >= 0 }
							set_country_flag = fe_gift_battlecruiser 
						}
						else = {
							set_country_flag = fe_gift_resources_large
						}
					}
					5 = {
						modifier = {
							factor = 0
							OR = {
								has_country_flag = fe_l_cluster_clue
								NOT = { has_event_chain = l_cluster_chain }
								AND = {
									has_global_flag = l_cluster_opened
									has_completed_event_chain_counter = {
										event_chain = l_cluster_chain
										counter = clues
									}
								}
							}
						}
						set_country_flag = fe_gift_l_cluster
					}
					5 = {
						modifier = {
							factor = 0
							OR = {
								event_target:FallenEmpireTaskOrigin = { NOT = { has_ethic = ethic_fanatic_spiritualist } }
								has_policy_flag = no_wars
								NOT = {
									any_country = {
										is_country_type = default
										has_communications = root
										any_planet_within_border = {
											has_modifier = "holy_planet"
											is_colony = no # FE would take care of this themselves otherwise
											is_under_colonization = no
											root = { NOT = { has_claim = prev.solar_system } }
										}
										their_opinion = { who = event_target:FallenEmpireTaskOrigin value <= -33 }
										NOR = {
											is_in_federation_with = ROOT
											has_defensive_pact = ROOT
											has_non_aggression_pact = ROOT
										}
									}
								}
							}
						}
						random_country = {
							limit = {
								is_country_type = default
								has_communications = root
								any_planet_within_border = {
									has_modifier = "holy_planet"
									is_colony = no # FE would take care of this themselves otherwise
									is_under_colonization = no
									root = { NOT = { has_claim = prev.solar_system } }
								}
								their_opinion = { who = event_target:FallenEmpireTaskOrigin value <= -33 }
								NOR = {
									is_in_federation_with = ROOT
									has_defensive_pact = ROOT
									has_non_aggression_pact = ROOT
								}
							}
							save_event_target_as = FallenEmpireTaskCountry
							random_planet_within_border = {
								limit = {
									has_modifier = "holy_planet"
									is_colony = no # FE would take care of this themselves otherwise
									is_under_colonization = no
									root = { NOT = { has_claim = prev.solar_system } }
								}
								save_event_target_as = FallenEmpireTaskPlanet
							}
						}
						set_country_flag = fe_gift_holy_world_claims
					}
				}
			}
			
			root = { add_opinion_modifier = { who = prev modifier = opinion_fallen_empire_gift } }
			root = { country_event = { id = fallen_empires_tasks.2 } }
		}
	}
}

country_event = {
	id = fallen_empires_tasks.2
	title = fallen_empires_tasks.2.name
	
	is_triggered_only = yes
	diplomatic = yes
	
	picture_event_data = {
		portrait = event_target:FallenEmpireTaskOrigin
		planet_background = event_target:FallenEmpireTaskOrigin
		graphical_culture = event_target:FallenEmpireTaskOrigin
		city_level = event_target:FallenEmpireTaskOrigin
		room = event_target:FallenEmpireTaskOrigin.ruler
	}
		
	desc = {
		text = fallen_empires_tasks.2.desc.a.materialist
		trigger = {
			OR = {
				has_country_flag = fe_gift_resources_small
				has_country_flag = fe_gift_resources_large
			}
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_materialist }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.a.xenophile
		trigger = {
			OR = {
				has_country_flag = fe_gift_resources_small
				has_country_flag = fe_gift_resources_large
			}
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_xenophile }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.a.spiritualist
		trigger = {
			OR = {
				has_country_flag = fe_gift_resources_small
				has_country_flag = fe_gift_resources_large
			}
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_spiritualist }
		}
	}	
	desc = {
		text = fallen_empires_tasks.2.desc.a.machine.o
		trigger = {
			OR = {
				has_country_flag = fe_gift_resources_small
				has_country_flag = fe_gift_resources_large
			}
			NOR = {
				has_authority = auth_machine_intelligence 
				has_country_flag = synthetic_empire				
			}
			event_target:FallenEmpireTaskOrigin = { has_authority = auth_machine_intelligence }
		}
	}	
	desc = {
		text = fallen_empires_tasks.2.desc.a.machine.s
		trigger = {
			OR = {
				has_country_flag = fe_gift_resources_small
				has_country_flag = fe_gift_resources_large
			}
			OR = {
				has_authority = auth_machine_intelligence 
				has_country_flag = synthetic_empire				
			}			
			event_target:FallenEmpireTaskOrigin = { has_authority = auth_machine_intelligence }
		}
	}		
	desc = {
		text = fallen_empires_tasks.2.desc.b.materialist
		trigger = {
			OR = {
				has_country_flag = fe_gift_databanks
				has_country_flag = fe_gift_rare_tech
			}
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_materialist }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.b.xenophile
		trigger = {
			OR = {
				has_country_flag = fe_gift_databanks
				has_country_flag = fe_gift_rare_tech
			}
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_xenophile }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.b.spiritualist
		trigger = {
			OR = {
				has_country_flag = fe_gift_databanks
				has_country_flag = fe_gift_rare_tech
				has_country_flag = fe_gift_l_cluster
			}
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_spiritualist }
		}
	}	
	desc = {
		text = fallen_empires_tasks.2.desc.b.machine.o
		trigger = {
			OR = {
				has_country_flag = fe_gift_databanks
				has_country_flag = fe_gift_rare_tech
				has_country_flag = fe_gift_l_cluster
			}
			NOR = {
				has_authority = auth_machine_intelligence 
				has_country_flag = synthetic_empire				
			}			
			event_target:FallenEmpireTaskOrigin = { has_authority = auth_machine_intelligence }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.b.machine.s
		trigger = {
			OR = {
				has_country_flag = fe_gift_databanks
				has_country_flag = fe_gift_rare_tech
				has_country_flag = fe_gift_l_cluster
			}
			OR = {
				has_authority = auth_machine_intelligence 
				has_country_flag = synthetic_empire				
			}			
			event_target:FallenEmpireTaskOrigin = { has_authority = auth_machine_intelligence }
		}
	}		
	desc = {
		text = fallen_empires_tasks.2.desc.c.materialist
		trigger = {
			has_country_flag = fe_gift_escorts
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_materialist }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.c.xenophile
		trigger = {
			has_country_flag = fe_gift_escorts
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_xenophile }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.c.spiritualist
		trigger = {
			has_country_flag = fe_gift_escorts
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_spiritualist }
		}
	}	
	desc = {
		text = fallen_empires_tasks.2.desc.c.machine.o
		trigger = {
			OR = {
				has_country_flag = fe_gift_escorts
				has_country_flag = fe_gift_battlecruiser
			}
			NOR = {
				has_authority = auth_machine_intelligence 
				has_country_flag = synthetic_empire				
			}			
			event_target:FallenEmpireTaskOrigin = { has_authority = auth_machine_intelligence }
		}			
	}
	desc = {
		text = fallen_empires_tasks.2.desc.c.machine.s
		trigger = {
			OR = {
				has_country_flag = fe_gift_escorts
				has_country_flag = fe_gift_battlecruiser
			}
			OR = {
				has_authority = auth_machine_intelligence 
				has_country_flag = synthetic_empire				
			}				
			event_target:FallenEmpireTaskOrigin = { has_authority = auth_machine_intelligence }
		}		
	}	
	desc = {
		text = fallen_empires_tasks.2.desc.d.materialist
		trigger = {
			has_country_flag = fe_gift_battlecruiser
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_materialist }
		}
	}	
	desc = {
		text = fallen_empires_tasks.2.desc.d.xenophile
		trigger = {
			has_country_flag = fe_gift_battlecruiser
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_xenophile }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.d.spiritualist
		trigger = {
			has_country_flag = fe_gift_battlecruiser
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_spiritualist }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.e.xenophile
		trigger = {
			has_country_flag = fe_gift_fix_homeworld
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_xenophile }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.f.materialist
		trigger = {
			has_country_flag = fe_gift_three_laws
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_materialist }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.g.materialist
		trigger = {
			has_country_flag = fe_gift_l_cluster
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_materialist }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.g.xenophile
		trigger = {
			has_country_flag = fe_gift_l_cluster
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_xenophile }
		}
	}
	desc = {
		text = fallen_empires_tasks.2.desc.h.spiritualist
		trigger = {
			has_country_flag = fe_gift_holy_world_claims
			event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_spiritualist }
		}
	}
	
	option = {
		name = fallen_empires_tasks.2.a	
		hidden_effect = { set_country_flag = fe_gift_received }
		if = {
			limit = { has_country_flag = fe_gift_resources_small }
			add_resource = { minerals = 1500 }
			add_resource = { alloys = 500 }
			add_resource = { energy = 500 }
			add_resource = { volatile_motes = 50 }
			add_resource = { exotic_gases = 50 }
			add_resource = { rare_crystals = 50 }
		}
		if = {
			limit = { has_country_flag = fe_gift_resources_large }
			add_resource = { minerals = 3000 }
			add_resource = { alloys = 1000 }
			add_resource = { energy = 1000 }
			add_resource = { volatile_motes = 100 }
			add_resource = { exotic_gases = 100 }
			add_resource = { rare_crystals = 100 }
		}
		if = {
			limit = { has_country_flag = fe_gift_databanks }
			add_modifier = {
				modifier = fallen_empire_gift_databanks
				days = 3600
			}
		}
		if = {
			limit = { has_country_flag = fe_gift_rare_tech }
			give_fe_tech_gift = yes
			hidden_effect = { remove_country_flag = fe_gift_rare_tech }
		}
		if = {
			limit = { has_country_flag = fe_gift_escorts }
			custom_tooltip = fallen_empires_tasks.2.escorts_tooltip
			hidden_effect = {
				capital_scope = {
					create_fleet = {
						settings = {
							spawn_debris = no
						}
						effect = {
							set_owner = ROOT
							if = {
								limit = {
									event_target:FallenEmpireTaskOrigin = { has_authority = auth_machine_intelligence }
								}
								create_ship = {
									name = "NAME_Surplus_I"
									design = "NAME_Surplus_Gamma"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
								create_ship = {
									name = "NAME_Surplus_II"
									design = "NAME_Surplus_Gamma"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
								create_ship = {
									name = "NAME_Surplus_III"
									design = "NAME_Surplus_Gamma"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
							}
							if = {
								limit = {
									event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_materialist }
								}
								create_ship = {
									name = "NAME_Surplus_I"
									design = "NAME_Surplus_Sage"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
								create_ship = {
									name = "NAME_Surplus_II"
									design = "NAME_Surplus_Sage"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
								create_ship = {
									name = "NAME_Surplus_III"
									design = "NAME_Surplus_Sage"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
							}
							if = {
								limit = {
									event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_xenophile }
								}
								create_ship = {
									name = "NAME_Surplus_I"
									design = "NAME_Surplus_Warden"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
								create_ship = {
									name = "NAME_Surplus_II"
									design = "NAME_Surplus_Warden"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
								create_ship = {
									name = "NAME_Surplus_III"
									design = "NAME_Surplus_Warden"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
							}
							if = {
								limit = {
									event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_spiritualist }
								}
								create_ship = {
									name = "NAME_Surplus_I"
									design = "NAME_Surplus_Zealot"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
								create_ship = {
									name = "NAME_Surplus_II"
									design = "NAME_Surplus_Zealot"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
								create_ship = {
									name = "NAME_Surplus_III"
									design = "NAME_Surplus_Zealot"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
							}
							add_modifier = {
								modifier = fe_gift_ship
								days = -1
							}
							set_location = PREV
						}
					}
				}
			}
		}
		if = {
			limit = { has_country_flag = fe_gift_battlecruiser }
			custom_tooltip = fallen_empires_tasks.2.battlecruiser_tooltip
			hidden_effect = {
				capital_scope = {
					create_fleet = {
						settings = {
							spawn_debris = no
						}
						effect = {
							set_owner = ROOT
							if = {
								limit = {
									event_target:FallenEmpireTaskOrigin = { has_authority = auth_machine_intelligence }
								}
								create_ship = {
									name = "NAME_Progress"
									design = "NAME_Surplus_Beta"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
							}
							if = {
								limit = {
									event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_materialist }
								}
								create_ship = {
									name = "NAME_Progress"
									design = "NAME_Surplus_Scholar"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
							}
							if = {
								limit = {
									event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_xenophile }
								}
								create_ship = {
									name = "NAME_Benevolence"
									design = "NAME_Surplus_Custodian"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
							}
							if = {
								limit = {
									event_target:FallenEmpireTaskOrigin = { has_ethic = ethic_fanatic_spiritualist }
								}
								create_ship = {
									name = "NAME_Benevolence"
									design = "NAME_Surplus_Avatar"
									graphical_culture = event_target:FallenEmpireTaskOrigin
									upgradable = no
								}
							}
							add_modifier = {
								modifier = fe_gift_ship
								days = -1
							}
							set_location = PREV
						}
					}
				}
			}
		}
		if = {
			limit = { has_country_flag = fe_gift_fix_homeworld }
			custom_tooltip = fe_gift_fix_homeworld_tooltip
			hidden_effect = {
				random_owned_planet = {
					limit = { has_planet_flag = damaged_homeworld }
					planet_event = { id = countryexpanded.22 days = 180 random = 360 }
					create_fleet = {
						settings = {
							spawn_debris = no
						}
						effect = {
							set_owner = event_target:FallenEmpireTaskOrigin
							create_ship = {
								name = "NAME_FE_SCIENCE_SHIP_BIOLOGY"
								design = "NAME_FE_Science_Ship"
								graphical_culture = event_target:FallenEmpireTaskOrigin
								upgradable = no
							}
							set_location = PREV
							queue_actions = {
								find_closest_planet = {
									trigger = {
										id = "fe_damaged_world.1.trigger.1"
										has_planet_flag = damaged_homeworld
									}
									found_planet = {
										move_to = this
										orbit_planet = THIS
										wait = {
											duration = 540
										}
									}
								}
								find_random_system = {
									trigger = {
										id = "fe_damaged_world.2.trigger.2"
										exists = space_owner
										space_owner = { is_same_value = event_target:FallenEmpireTaskOrigin }
									}
									found_system = {
										move_to = this
									}
								}
							}
						}
					}
				}
			}
		}
		if = {
			limit = { has_country_flag = fe_gift_three_laws }
			custom_tooltip = fallen_empires_tasks.2.three_laws.tooltip
			hidden_effect = { set_country_flag = no_machine_uprising }
			add_modifier = {
				modifier = fallen_empire_gift_databanks
				days = 1800
			}
		}
		if = {
			limit = { has_country_flag = fe_gift_l_cluster }
			generate_lcluster_clue = yes
			add_modifier = {
				modifier = fallen_empire_gift_databanks
				days = 1800
			}
			hidden_effect = { set_country_flag = fe_l_cluster_clue }
		}
		if = {
			limit = { has_country_flag = fe_gift_holy_world_claims }
			custom_tooltip = fallen_empires_tasks.2.holy_planet.tooltip
			add_resource = { influence = 100 }
			hidden_effect = {
				event_target:FallenEmpireTaskCountry = {
					every_system_within_border = {
						limit = {
							any_system_planet = { has_modifier = "holy_planet" }
						}
						add_claims = {
							who = ROOT
							num_of_claims = 5
							show_notification = no
						}
						every_neighbor_system = {
							limit = {
								exists = space_owner
								space_owner = { is_same_value = event_target:FallenEmpireTaskCountry }
							}
							add_claims = {
								who = ROOT
								num_of_claims = 5
								show_notification = no
							}
						}
					}
				}				
			}
		}
		hidden_effect = {
			remove_country_flag = fe_gift_escorts
			remove_country_flag = fe_gift_resources_small
			remove_country_flag = fe_gift_battlecruiser
			remove_country_flag = fe_gift_resources_large
			remove_country_flag = fe_gift_databanks
			remove_country_flag = fe_gift_rare_tech
			remove_country_flag = fe_gift_fix_homeworld
			remove_country_flag = fe_gift_three_laws
			remove_country_flag = fe_gift_l_cluster
			remove_country_flag = fe_gift_holy_world_claims
		}
	}
	option = {
		name = fallen_empires_tasks.2.b
		ai_chance = { factor = 0 }
		hidden_effect = { event_target:FallenEmpireTaskOrigin = { add_opinion_modifier = { who = root modifier = opinion_spurned_fallen_empire_gift } }	}
		if = {
			limit = {
				event_target:FallenEmpireTaskOrigin = { 
					is_enigmatic_to = root
				}
			}
			custom_tooltip = fallen_empire_enigmatic_tooltip
		}
		else = {
			custom_tooltip = fallen_empire_unhappy_tooltip
		}
		hidden_effect = {
			remove_country_flag = fe_gift_escorts
			remove_country_flag = fe_gift_resources_small
			remove_country_flag = fe_gift_battlecruiser
			remove_country_flag = fe_gift_resources_large
			remove_country_flag = fe_gift_databanks
			remove_country_flag = fe_gift_rare_tech
			remove_country_flag = fe_gift_fix_homeworld
			remove_country_flag = fe_gift_three_laws
			remove_country_flag = fe_gift_l_cluster
			remove_country_flag = fe_gift_holy_world_claims
		}
	}
}

# Xenophile Fallen Empire asks an empire to stop another empire from purging
country_event = {
	id = fallen_empires_tasks.7
	title = OK
	desc = OK
	
	hide_window = yes
	
	mean_time_to_happen = {
		years = 200		
		modifier = {
			factor = 2.0
			OR = {
				has_ethic = ethic_authoritarian
				has_ethic = ethic_fanatic_authoritarian
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}				
		}
		modifier = {
			factor = 0.5
			OR = {
				has_ethic = ethic_egalitarian
				has_ethic = ethic_fanatic_egalitarian
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
			}
		}
		modifier = {
			factor = 2
			is_ai = yes
		}
	}
	
	trigger = {
		is_country_type = default
		is_homicidal = no
		OR = {
			is_gestalt = no
			has_valid_civic = civic_machine_servitor
		}
		NOT = { has_country_flag = fe_task_given }
		NOT = { has_global_flag = fe_task_stop_atrocity_active }
		is_at_war = no
		
		OR = {
			is_ai = no
			NOT = { any_federation_ally = { is_ai = no } }
		}
		
		NOT = { has_policy_flag = no_wars }

		allows_slavery = no
		allows_purge = no
		
		any_country = {
			is_valid_fallen_empire_for_task = yes
			has_ethic = ethic_fanatic_xenophile
			OR = {
				is_patronizing_to = root
				is_dismissive_to = root
			}
			has_communications = root
			NOT = { has_opinion_modifier = { who = prev modifier = opinion_refused_fallen_empire_task } }
			NOT = { has_opinion_modifier = { who = prev modifier = opinion_failed_fallen_empire_task } }
			NOT = { has_opinion_modifier = { who = prev modifier = opinion_majorly_failed_fallen_empire_task } }
			
			any_country = {
				is_country_type = default
				OR = {
					ROOT = { is_rival = prev }
					is_homicidal = yes
				}
				allows_purge = yes
				
				has_communications = root
				has_communications = prev
				OR = {
					AND = {
						root = { has_opinion_modifier = { who = prev modifier = opinion_genocidal } } # still on the hook if they stopped or finished purging
						is_homicidal = no # make sure there are pops left to rescue
					}
					any_owned_species = {
						has_citizenship_type = { type = citizenship_purge country = prev }
						NOT = { has_purge_type = { type = purge_displacement country = prev } }
					}
				}
				OR = {
					ROOT = { is_ai = no }
					relative_power = {
						who = ROOT
						value <= equivalent
					}
				}
			}
		}
	}
	
	immediate = {
		set_country_flag = fe_task_given
	
		random_country = {
			limit = { 
				is_valid_fallen_empire_for_task = yes
				has_ethic = ethic_fanatic_xenophile
				OR = {
					is_patronizing_to = root
					is_dismissive_to = root
				}
				has_communications = root
				NOT = { has_opinion_modifier = { who = prev modifier = opinion_refused_fallen_empire_task } }
				
				any_country = {
					is_country_type = default
					OR = {
						ROOT = { is_rival = prev }
						is_homicidal = yes
					}
					allows_purge = yes
					
					has_communications = root
					has_communications = prev
					OR = {
						AND = {
							root = { has_opinion_modifier = { who = prev modifier = opinion_genocidal } }
							is_homicidal = no # make sure there are pops left to rescue
						}
						any_owned_species = {
							has_citizenship_type = { type = citizenship_purge country = prev }
							NOT = { has_purge_type = { type = purge_displacement country = prev } }
						}
					}
					OR = {
						ROOT = { is_ai = no }
						relative_power = {
							who = ROOT
							value <= equivalent
						}
					}
				}
			}
			
			random_country = {
				limit = {
					is_country_type = default
					OR = {
						ROOT = { is_rival = prev }
						is_homicidal = yes
					}
					allows_purge = yes
					
					has_communications = root
					has_communications = prev
					OR = {
						AND = {
							root = { has_opinion_modifier = { who = prev modifier = opinion_genocidal } }
							is_homicidal = no # make sure there are pops left to rescue
						}
						any_owned_species = {
							has_citizenship_type = { type = citizenship_purge country = prev }
							NOT = { has_purge_type = { type = purge_displacement country = prev } }
						}
					}
					OR = {
						ROOT = { is_ai = no }
						relative_power = {
							who = ROOT
							value <= equivalent
						}
					}
				}
				
				save_event_target_as = FallenEmpireTaskTarget
			}
			
			save_event_target_as = FallenEmpireTaskOrigin
			root = { country_event = { id = fallen_empires_tasks.8 } }
		}
	}
}

country_event = {
	id = fallen_empires_tasks.8
	title = fallen_empires_tasks.8.name
	desc = {
		text = fallen_empires_tasks.8.desc
		trigger = {
			event_target:FallenEmpireTaskTarget = { is_homicidal = no }
		}
	}
	desc = {
		text = fallen_empires_tasks.8.homicidal.desc
		trigger = {
			event_target:FallenEmpireTaskTarget = { is_homicidal = yes }
		}
	}
	
	is_triggered_only = yes
	diplomatic = yes
	
	picture_event_data = {
		portrait = event_target:FallenEmpireTaskOrigin
		planet_background = event_target:FallenEmpireTaskOrigin
		graphical_culture = event_target:FallenEmpireTaskOrigin
		city_level = event_target:FallenEmpireTaskOrigin
		room = event_target:FallenEmpireTaskOrigin.ruler
	}
	
	option = {
		name = fallen_empires_tasks.8.a
		ai_chance = {
			factor = 90
			modifier = {
				factor = 2
				is_civic_free_haven = yes
			}
			modifier = {
				factor = 10
				has_valid_civic = civic_machine_servitor
			}
			modifier = {
				factor = 2
				has_ethic = ethic_xenophile
			}
			modifier = {
				factor = 10
				has_ethic = ethic_fanatic_xenophile
			}
			modifier = {
				factor = 2
				has_ethic = ethic_egalitarian
			}
			modifier = {
				factor = 10
				has_ethic = ethic_fanatic_egalitarian
			}
			modifier = {
				factor = 2
				has_ethic = ethic_militarist
			}			
			modifier = {
				factor = 10
				has_ethic = ethic_fanatic_militarist
			}
			modifier = {
				factor = 0.1
				has_ethic = ethic_xenophobe
			}
			modifier = {
				factor = 0.01
				has_ethic = ethic_fanatic_xenophobe
			}
			modifier = {
				factor = 0.1
				has_ethic = ethic_pacifist
			}
			modifier = {
				factor = 0.01
				has_ethic = ethic_fanatic_pacifist
			}
		}
		
		begin_event_chain = {
			event_chain = fe_stop_atrocity_task_chain
			target = root
		}
		
		hidden_effect = {
			set_global_flag = fe_task_stop_atrocity_active
			set_country_flag = fe_task_stop_atrocity
			set_timed_country_flag = { flag = fe_task_stop_atrocity_timer days = 7300 }
			event_target:FallenEmpireTaskOrigin = { set_country_flag = fe_task_stop_atrocity_origin }
			event_target:FallenEmpireTaskTarget = { set_country_flag = fe_task_stop_atrocity_target }
			if = {
				limit = {
					is_ai = yes
					event_target:FallenEmpireTaskTarget = { is_homicidal = no }
				}
				declare_war = {
					target = event_target:FallenEmpireTaskTarget
					attacker_war_goal = "wg_stop_atrocities"
				}
			}
			else_if = {
				limit = {
					is_ai = yes
					event_target:FallenEmpireTaskTarget = {
						OR = {
							has_valid_civic = civic_fanatic_purifiers
							has_valid_civic = civic_machine_terminator
						}
					}
				}
				declare_war = {
					target = event_target:FallenEmpireTaskTarget
					attacker_war_goal = "wg_end_threat"
				}
			}
			else_if = {
				limit = {
					is_ai = yes
					event_target:FallenEmpireTaskTarget = {
						has_valid_civic = civic_hive_devouring_swarm 
					}
				}
				declare_war = {
					target = event_target:FallenEmpireTaskTarget
					attacker_war_goal = "wg_end_threat_swarm"
				}
			}
		}
		hidden_effect = { remove_country_flag = fe_task_given }
	}
	option = {
		name = fallen_empires_tasks.8.b
		ai_chance = {
			factor = 10
		}		
		custom_tooltip = fallen_empire_unhappy_tooltip
		hidden_effect = { event_target:FallenEmpireTaskOrigin = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_task } } }
		hidden_effect = { remove_country_flag = fe_task_given }
	}
}

# Success
country_event = {
	id = fallen_empires_tasks.9
	title = fallen_empires_tasks.9.name
	desc = fallen_empires_tasks.9.desc
	
	is_triggered_only = yes
	
	immediate = {
		remove_global_flag = fe_task_stop_atrocity_active
		random_country = {
			limit = { has_country_flag = fe_task_stop_atrocity_origin }
			save_event_target_as = FallenEmpireTaskOrigin
		}
		random_country = {
			limit = { has_country_flag = fe_task_stop_atrocity_target }
			save_event_target_as = FallenEmpireTaskTarget
		}	
		end_event_chain = fe_stop_atrocity_task_chain
	}
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = event_target:FallenEmpireTaskOrigin
		planet_background = event_target:FallenEmpireTaskOrigin
		graphical_culture = event_target:FallenEmpireTaskOrigin
		city_level = event_target:FallenEmpireTaskOrigin
		room = event_target:FallenEmpireTaskOrigin.ruler
	}
	
	option = {
		name = fallen_empires_tasks.9.a
		custom_tooltip = fallen_empire_happy_tooltip
		hidden_effect = { event_target:FallenEmpireTaskOrigin = { add_opinion_modifier = { who = root modifier = opinion_completed_fallen_empire_task } } }		
		hidden_effect = {
			every_country = {
				remove_country_flag = fe_task_stop_atrocity
				remove_country_flag = fe_task_stop_atrocity_origin
				remove_country_flag = fe_task_stop_atrocity_target
			}
		}
	}
}

#Spiritualist Fallen Empire asks an empire to stop another empire from researching AI
country_event = {
	id = fallen_empires_tasks.14
	title = OK
	desc = OK
	
	hide_window = yes
	
	mean_time_to_happen = {
		years = 500	

		modifier = {
			factor = 0.5
			OR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
			}				
		}

		modifier = {
			factor = 0.5
			
			any_country = {
				is_country_type = default
				root = { is_rival = prev }
				OR = {
					has_policy_flag = ai_full_rights
					has_policy_flag = ai_servitude
				}
				NOT = { has_country_flag = synthetic_empire }
				has_technology = tech_droid_workers
				has_communications = prev
			}
		}
	
		modifier = {
			factor = 0.5
			
			any_country = {
				is_country_type = default
				root = { is_rival = prev }
				OR = {
					has_policy_flag = ai_full_rights
					has_policy_flag = ai_servitude
				}
				NOT = { has_country_flag = synthetic_empire }
				has_technology = tech_synthetic_workers
				has_communications = prev
			}
		}
		
		modifier = {
			factor = 0.5
			
			any_country = {
				is_country_type = default
				root = { is_rival = prev }
				has_country_flag = synthetic_empire
				has_communications = prev
			}
		}
		
		modifier = {
			factor = 2
			is_ai = yes
		}
	}
	
	trigger = {		
		is_country_type = default	
		is_homicidal = no
		is_robot_empire = no
		NOT = { has_country_flag = fe_task_given }
		NOT = { has_global_flag = fe_task_stop_robots_active }	
		is_at_war = no
		
		OR = {
			is_ai = no
			NOT = { any_federation_ally = { is_ai = no } }
		}
		
		NOT = { has_policy_flag = no_wars }

		NOR = {
			has_policy_flag = ai_full_rights
			has_policy_flag = ai_servitude
		}
		
		any_country = {
			is_valid_fallen_empire_for_task = yes
			has_ethic = ethic_fanatic_spiritualist
			OR = {
				is_patronizing_to = root
				is_dismissive_to = root
			}
			has_communications = root		
			NOT = { has_opinion_modifier = { who = prev modifier = opinion_refused_fallen_empire_task } }
			NOT = { has_opinion_modifier = { who = prev modifier = opinion_failed_fallen_empire_task } }
			NOT = { has_opinion_modifier = { who = prev modifier = opinion_majorly_failed_fallen_empire_task } }
			
			any_country = {
				is_country_type = default	
				root = { is_rival = prev }
				OR = {
					is_synthetic_empire = yes
					AND = {
						OR = {
							has_policy_flag = ai_full_rights
							has_policy_flag = ai_servitude
						}
						NOT = { has_country_flag = synthetic_empire }
						OR = {
							has_technology = tech_synthetic_workers
							is_researching_technology = tech_synthetic_workers
						}
					}
				}
				OR = {
					ROOT = { is_ai = no }
					relative_power = {
						who = ROOT
						value <= equivalent
					}
				}
				has_communications = root
				has_communications = prev
			}
		}
	}
	
	immediate = {
		set_country_flag = fe_task_given
	
		random_country = {
			limit = { 
				is_valid_fallen_empire_for_task = yes
				has_ethic = ethic_fanatic_spiritualist
				OR = {
					is_patronizing_to = root
					is_dismissive_to = root
				}
				has_communications = root		
				NOT = { has_opinion_modifier = { who = prev modifier = opinion_refused_fallen_empire_task } }
				
				any_country = {
					is_country_type = default	
					root = { is_rival = prev }
					OR = {
						is_synthetic_empire = yes
						AND = {
							OR = {
								has_policy_flag = ai_full_rights
								has_policy_flag = ai_servitude
							}
							NOT = { has_country_flag = synthetic_empire }
							OR = {
								has_technology = tech_synthetic_workers
								is_researching_technology = tech_synthetic_workers
							}
						}
					}
					OR = {
						ROOT = { is_ai = no }
						relative_power = {
							who = ROOT
							value <= equivalent
						}
					}
					has_communications = root
					has_communications = prev
				}
			}
			
			random_country = {	
				limit = {
					any_country = {
						is_country_type = default	
						root = { is_rival = prev }
						OR = {
							is_synthetic_empire = yes
							AND = {
								OR = {
									has_policy_flag = ai_full_rights
									has_policy_flag = ai_servitude
								}
								NOT = { has_country_flag = synthetic_empire }
								OR = {
									has_technology = tech_synthetic_workers
									is_researching_technology = tech_synthetic_workers
								}
							}
						}
						OR = {
							ROOT = { is_ai = no }
							relative_power = {
								who = ROOT
								value <= equivalent
							}
						}
						has_communications = root
						has_communications = prev
					}			
				}
				
				save_event_target_as = FallenEmpireTaskTarget
			}			
			
			save_event_target_as = FallenEmpireTaskOrigin
			root = { country_event = { id = fallen_empires_tasks.15 } }
		}
	}
}

country_event = {
	id = fallen_empires_tasks.15
	title = fallen_empires_tasks.15.name
	desc = {
		text = "fallen_empires_tasks.15.desc"
		trigger = {
			event_target:FallenEmpireTaskTarget = {
				is_synthetic_empire = no
			}
		}
	}
	desc = {
		text = "fallen_empires_tasks.15.machine.desc"
		trigger = {
			event_target:FallenEmpireTaskTarget = {
				has_authority = auth_machine_intelligence
				NOR = {
					has_valid_civic = civic_machine_terminator
					has_valid_civic = civic_machine_assimilator
					has_valid_civic = civic_machine_servitor
				}
			}
		}
	}
	desc = {
		text = "fallen_empires_tasks.15.terminator.desc"
		trigger = {
			event_target:FallenEmpireTaskTarget = {
				has_authority = auth_machine_intelligence
				has_valid_civic = civic_machine_terminator
			}
		}
	}
	desc = {
		text = "fallen_empires_tasks.15.assimilator.desc"
		trigger = {
			event_target:FallenEmpireTaskTarget = {
				has_authority = auth_machine_intelligence
				OR = {
					has_valid_civic = civic_machine_assimilator
					has_valid_civic = civic_machine_consciousness
				}
			}
		}
	}
	desc = {
		text = "fallen_empires_tasks.15.servitor.desc"
		trigger = {
			event_target:FallenEmpireTaskTarget = {
				has_authority = auth_machine_intelligence
				has_valid_civic = civic_machine_servitor
			}
		}
	}
	desc = {
		text = "fallen_empires_tasks.15.synthetic.desc"
		trigger = {
			event_target:FallenEmpireTaskTarget = {
				has_country_flag = synthetic_empire
			}
		}
	}
	
	is_triggered_only = yes
	diplomatic = yes
	
	picture_event_data = {
		portrait = event_target:FallenEmpireTaskOrigin
		planet_background = event_target:FallenEmpireTaskOrigin
		graphical_culture = event_target:FallenEmpireTaskOrigin
		city_level = event_target:FallenEmpireTaskOrigin
		room = event_target:FallenEmpireTaskOrigin.ruler
	}
	
	option = {
		name = fallen_empires_tasks.15.a
		ai_chance = {
			factor = 90
			modifier = {
				factor = 2
				has_ethic = ethic_spiritualist
			}			
			modifier = {
				factor = 10
				has_ethic = ethic_fanatic_spiritualist
			}
			modifier = {
				factor = 2
				has_ethic = ethic_militarist
			}			
			modifier = {
				factor = 10
				has_ethic = ethic_fanatic_militarist
			}
			modifier = {
				factor = 0.1
				has_ethic = ethic_xenophobe
				is_spiritualist = no
			}
			modifier = {
				factor = 0.01
				has_ethic = ethic_fanatic_xenophobe
				is_spiritualist = no
			}
			modifier = {
				factor = 0.1
				has_ethic = ethic_pacifist
			}
			modifier = {
				factor = 0.01
				has_ethic = ethic_fanatic_pacifist
			}
			modifier = {
				factor = 0.1
				has_ethic = ethic_materialist
			}
			modifier = {
				factor = 0.01
				has_ethic = ethic_fanatic_materialist
			}
		}		
		
		begin_event_chain = {
			event_chain = fe_stop_robots_task_chain
			target = root
		}
		
		hidden_effect = {
			set_global_flag = fe_task_stop_robots_active
			set_country_flag = fe_task_stop_robots
			set_timed_country_flag = { flag = fe_task_stop_robots_timer days = 7300 }
			event_target:FallenEmpireTaskOrigin = { set_country_flag = fe_task_stop_robots_origin }
			event_target:FallenEmpireTaskTarget = { set_country_flag = fe_task_stop_robots_target }
			if = {
				limit = {
					is_ai = yes
					event_target:FallenEmpireTaskTarget = { is_robot_empire = no }
				}
				declare_war = {
					target = event_target:FallenEmpireTaskTarget
					attacker_war_goal = "wg_stop_robots"
				}
			}
			else_if = {
				limit = {
					is_ai = yes
					event_target:FallenEmpireTaskTarget = { is_robot_empire = yes }
				}
				declare_war = {
					target = event_target:FallenEmpireTaskTarget
					attacker_war_goal = "wg_kill_robots"
				}
			}
		}
		hidden_effect = { remove_country_flag = fe_task_given }
	}
	option = {
		name = fallen_empires_tasks.15.b
		ai_chance = {
			factor = 10
		}		
		custom_tooltip = fallen_empire_unhappy_tooltip
		hidden_effect = { event_target:FallenEmpireTaskOrigin = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_task } } }
		hidden_effect = { remove_country_flag = fe_task_given }
	}
}

# Success
country_event = {
	id = fallen_empires_tasks.16
	title = fallen_empires_tasks.16.name
	desc = {
		text = "fallen_empires_tasks.16.desc"
		trigger = {
			event_target:FallenEmpireTaskTarget = {
				is_synthetic_empire = no
			}
		}
	}
	desc = {
		text = "fallen_empires_tasks.16.machine.desc"
		trigger = {
			event_target:FallenEmpireTaskTarget = {
				is_synthetic_empire = yes
			}
		}
	}
	
	trigger = {
		has_global_flag = fe_task_stop_robots_active
	}
	
	is_triggered_only = yes
	
	immediate = {
		remove_global_flag = fe_task_stop_robots_active
		random_country = {
			limit = { has_country_flag = fe_task_stop_robots_origin }
			save_event_target_as = FallenEmpireTaskOrigin
		}
		random_country = {
			limit = { has_country_flag = fe_task_stop_robots_target }
			save_event_target_as = FallenEmpireTaskTarget
		}	
		end_event_chain = fe_stop_robots_task_chain
	}
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = event_target:FallenEmpireTaskOrigin
		planet_background = event_target:FallenEmpireTaskOrigin
		graphical_culture = event_target:FallenEmpireTaskOrigin
		city_level = event_target:FallenEmpireTaskOrigin
		room = event_target:FallenEmpireTaskOrigin.ruler
	}
	
	option = {
		name = fallen_empires_tasks.16.a
		custom_tooltip = fallen_empire_happy_tooltip
		hidden_effect = { event_target:FallenEmpireTaskOrigin = { add_opinion_modifier = { who = root modifier = opinion_completed_fallen_empire_task } } }		
		hidden_effect = {
			every_country = {
				remove_country_flag = fe_task_stop_robots
				remove_country_flag = fe_task_stop_robots_origin
				remove_country_flag = fe_task_stop_robots_target
			}
		}
	}
}

# Failure - they're no longer roboting it up
country_event = {
	id = fallen_empires_tasks.18
	title = fallen_empires_tasks.18.name
	desc = fallen_empires_tasks.18.desc
	
	trigger = {
		has_global_flag = fe_task_stop_robots_active
		has_country_flag = fe_task_stop_robots
		any_country = {
			has_country_flag = fe_task_stop_robots_target
			has_policy_flag = ai_outlawed
			is_synthetic_empire = no
		}
	}
	
	mean_time_to_happen = {
		days = 10
	}
	
	immediate = {
		remove_global_flag = fe_task_stop_robots_active
		random_country = {
			limit = { has_country_flag = fe_task_stop_robots_origin }
			save_event_target_as = FallenEmpireTaskOrigin
		}
		random_country = {
			limit = { has_country_flag = fe_task_stop_robots_target }
			save_event_target_as = FallenEmpireTaskTarget
		}	
		end_event_chain = fe_stop_robots_task_chain
	}
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = event_target:FallenEmpireTaskOrigin
		planet_background = event_target:FallenEmpireTaskOrigin
		graphical_culture = event_target:FallenEmpireTaskOrigin
		city_level = event_target:FallenEmpireTaskOrigin
		room = event_target:FallenEmpireTaskOrigin.ruler
	}
	
	option = {
		name = fallen_empires_tasks.18.a
		hidden_effect = {
			remove_global_flag = fe_task_stop_robots_active
			every_country = {
				remove_country_flag = fe_task_stop_robots
				remove_country_flag = fe_task_stop_robots_origin
				remove_country_flag = fe_task_stop_robots_target
			}
		}
	}
}

# Failure - a country involved is no longer valid
country_event = {
	id = fallen_empires_tasks.19	
	title = OK
	desc = OK
	
	hide_window = yes
	
	trigger = {
		has_global_flag = fe_task_stop_robots_active
		OR = {
			NOT = { any_country = { has_country_flag = fe_task_stop_robots } }
			NOT = { any_country = { has_country_flag = fe_task_stop_robots_origin } }
			NOT = { any_country = { has_country_flag = fe_task_stop_robots_target } }
			any_country = {
				has_country_flag = fe_task_stop_robots_origin
				OR = {
					NOT = {	is_country_type = fallen_empire }
					any_country = {
						has_country_flag = fe_task_stop_robots
						is_at_war_with = prev
					}
				}			
			}			
		}
	}
	
	mean_time_to_happen = {
		days = 10
	}
	
	immediate = {
		remove_global_flag = fe_task_stop_robots_active
		hidden_effect = {
			remove_global_flag = fe_task_stop_robots_active
			every_country = {
				if = {
					limit = { has_country_flag = fe_task_stop_robots }
					end_event_chain = fe_stop_robots_task_chain
				}
				remove_country_flag = fe_task_stop_robots
				remove_country_flag = fe_task_stop_robots_origin
				remove_country_flag = fe_task_stop_robots_target
			}
		}
	}
}

# Xenophile Fallen Empire asks for brain scans found in anomaly
country_event = {
	id = fallen_empires_tasks.23
	title = OK
	desc = OK
	
	hide_window = yes
	
	mean_time_to_happen = {
		years = 10		
	}
	
	trigger = {		
		is_ai = no
		is_country_type = default	
		NOR = {
			has_valid_civic = civic_machine_terminator
			has_valid_civic = civic_hive_devouring_swarm
			has_valid_civic = civic_fanatic_purifiers
		}		
		is_at_war = no
		has_country_flag = limbo_downloaded
		NOR = { 
			has_global_flag = fe_xenophile_asked_brain_scans 
			has_country_flag = limbo_uploaded_robots 
		}	
		
		any_country = {
			is_valid_fallen_empire_for_task = yes
			has_ethic = ethic_fanatic_xenophile
			OR = {
				is_patronizing_to = root
				is_dismissive_to = root
			}
			has_communications = root		
			any_owned_planet = {
				has_planet_flag = fe_the_preserve
				free_housing > 0
			}			
		}
	}
	
	immediate = {
		set_global_flag = fe_xenophile_asked_brain_scans
		
		if = {
			limit = { has_global_flag = expanded_pops_active }
			create_species = {
				name = random
				class = FUN
				portrait = random
				traits = {
					trait = trait_decomposers
					trait = trait_erudite
					trait = trait_solitary
					trait = trait_decadent
				}
				#allow_negative_traits = no
				extra_trait_points = 1
			}
		}
		else = {
			create_species = {
				name = random
				class = FUN
				portrait = random
				traits = {
					trait = trait_erudite
					trait = trait_solitary
					trait = trait_decadent
				}
				#allow_negative_traits = no
				extra_trait_points = 1
			}
		}
		create_country = {
			name = "NAME_Dead_Species"
			species = last_created_species
			type = global_event
			effect = {
				save_event_target_as = FallenEmpireDeadSpecies
			}		
		}
	
		random_country = {
			limit = { 
				is_valid_fallen_empire_for_task = yes
				has_ethic = ethic_fanatic_xenophile
				OR = {
					is_patronizing_to = root
					is_dismissive_to = root
				}
				has_communications = root		
				any_owned_planet = {
					has_planet_flag = fe_the_preserve
					free_housing > 0
				}
			}		
			
			save_event_target_as = FallenEmpireTaskOrigin
		}
		country_event = { id = fallen_empires_tasks.24 }
	}
}