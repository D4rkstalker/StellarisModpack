namespace = bwm_ancestor

# Ancestor Crisis
# Code & idea by Frog, writing by Cc

# Swarm generated on ship destruction

country_event = {
	id = bwm_ancestor.1
	
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = {
			has_global_flag = bwm_ancestor_crisis_end
		}
		FROMFROM = {
			OR = {
				is_ship_size = bwm_apostle_1
				is_ship_size = bwm_apostle_2
				is_ship_size = bwm_apostle_3
				is_ship_size = bwm_apostle_4
				is_ship_size = bwm_apostle_egg
				is_ship_size = bwm_apostle_child
				is_ship_size = bwm_apostle_scout
				is_ship_size = bwm_apostle_station
				is_ship_size = bwm_apostle_xxl_cloud
				is_ship_size = bwm_apostle_xl_cloud
				is_ship_size = bwm_apostle_l_cloud
				is_ship_size = bwm_apostle_m_cloud
				is_ship_size = bwm_apostle_s_cloud
			}
		}
	}
	
	immediate = {
		this = {
			save_event_target_as = bwm_ancestor_swarm_owner
		}
		if = {
			limit = {
				FROMFROM = {
					exists = this
				}
			}
			FROMFROM = {
				save_event_target_as = bwm_ancestor_spawn
			}
		}
		else_if = {
			limit = {
				FROMFROM = {
					solar_system = {
						exists = this
					}
				}
			}
			FROMFROM = {
				solar_system = {
					random_system_planet = {
						limit = {
							is_star = yes 
						}
						save_event_target_as = bwm_ancestor_spawn
					}
				}
			}
		}
		else = {
			random_system = {
				random_system_planet = {
					limit = {
						is_star = yes 
					}
					save_event_target_as = bwm_ancestor_spawn
				}
			}
		}
		if = {
			limit = {
				check_variable = { 
					which = "bwm_ancestor_evolve_token" 
					value < 1
				}
			}
			set_variable = {
				which = "bwm_ancestor_evolve_token"
				value = 1
			}
		}
		else = {
			change_variable = {
				which = "bwm_ancestor_evolve_token"
				value = 1
			}
			if = {
				limit ={
					check_variable = {
						which = "bwm_ancestor_evolve_token"
						value > 5
					}
				}
				set_variable = {
					which = "bwm_ancestor_evolve_token"
					value = 5
				}
			}
			if = {
				limit = {
					check_variable = {
						which = "bwm_ancestor_evolve_token"
						value = 5
					}
				}
				if = {
					limit = {
						any_owned_fleet = {
							exists = this
							OR = {
								has_fleet_flag = bwm_ancestor_infant_spawn
								has_fleet_flag = bwm_ancestor_young_spawn
								has_fleet_flag = bwm_ancestor_adult_spawn
								has_fleet_flag = bwm_ancestor_elder_spawn
								has_fleet_flag = bwm_ancestor_dying_spawn
								has_fleet_flag = bwm_ancestor_boss_decay
							}
						}
					}
					random_owned_fleet = {
						limit = {
							exists = this
							OR = {
								has_fleet_flag = bwm_ancestor_infant_spawn
								has_fleet_flag = bwm_ancestor_young_spawn
								has_fleet_flag = bwm_ancestor_adult_spawn
								has_fleet_flag = bwm_ancestor_elder_spawn
								has_fleet_flag = bwm_ancestor_dying_spawn
								has_fleet_flag = bwm_ancestor_boss_decay
							}
						}
						fleet_event = { id = bwm_ancestor.4 }
					}
				}
				change_variable = {
					which = "bwm_ancestor_evolve_token"
					value = -5
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					NOR = {
						is_ship_size = corvette
						is_ship_size = destroyer
						is_ship_size = cruiser
						is_ship_size = battleship
						is_ship_size = constructor
						is_ship_size = colonizer
						is_ship_size = science
						is_ship_size = transport
						is_ship_size = military_station_small
						is_ship_size = military_station_medium
						is_ship_size = military_station_large
						is_ship_size = starbase_outpost
						is_ship_size = mining_station
						is_ship_size = research_station
						is_ship_size = observation_station
					}
				}
			}
			if = {
				limit = {
					FROMFROMFROM = {
						is_ship_class = shipclass_transport
					}
				}
				random_list = {
					50 = {
						bwm_ancestor_infant = yes
						last_created_fleet = {
							bwm_effect_explosion_7 = yes
						}
						break = yes
					}
					50 = {
						break = yes
					}
				}
			}
			if = {
				limit = {
					FROMFROMFROM = {
						is_ship_class = shipclass_constructor
					}
				}
				random_list = {
					50 = {
						bwm_ancestor_young = yes
						last_created_fleet = {
							bwm_effect_explosion_7 = yes
						}
						break = yes
					}
					50 = {
						break = yes
					}
				}
			}
			if = {
				limit = {
					FROMFROMFROM = {
						is_ship_class = shipclass_science_ship
					}
				}
				random_list = {
					50 = {
						bwm_ancestor_adult = yes
						last_created_fleet = {
							bwm_effect_explosion_7 = yes
						}
						break = yes
					}
					50 = {
						break = yes
					}
				}
			}
			if = {
				limit = {
					FROMFROMFROM = {
						is_ship_class = shipclass_colonizer
					}
				}
				random_list = {
					50 = {
						bwm_ancestor_elder = yes
						last_created_fleet = {
							bwm_effect_explosion_7 = yes
						}
						break = yes
					}
					50 = {
						break = yes
					}
				}
			}
			if = {
				limit = {
					FROMFROMFROM = {
						OR = {
							is_ship_class = shipclass_military
							is_ship_class = shipclass_military_station
						}
					}
				}
				random_list = {
					10 = {
						bwm_ancestor_infant = yes
						last_created_fleet = {
							bwm_effect_explosion_7 = yes
						}
						break = yes
					}
					10 = {
						bwm_ancestor_young = yes
						last_created_fleet = {
							bwm_effect_explosion_7 = yes
						}
						break = yes
					}
					10 = {
						bwm_ancestor_adult = yes
						last_created_fleet = {
							bwm_effect_explosion_7 = yes
						}
						break = yes
					}
					10 = {
						bwm_ancestor_elder = yes
						last_created_fleet = {
							bwm_effect_explosion_7 = yes
						}
						break = yes
					}
					10 = {
						bwm_ancestor_immortal = yes
						last_created_fleet = {
							bwm_effect_explosion_7 = yes
						}
						break = yes
					}
					50 = {
						break = yes
					}
				}
				
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = corvette
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_infant = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = destroyer
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_young = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = cruiser
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_adult = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = battleship
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_elder = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = transport
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_infant = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = constructor
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_young = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = science
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_adult = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = colonizer
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_elder = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = mining_station
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_young = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = research_station
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_adult = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = observation_station
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_elder = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = military_station_small
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_infant = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = military_station_medium
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_young = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = military_station_large
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_adult = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = starbase_outpost
				}
			}
			random_list = {
				50 = {
					bwm_ancestor_immortal = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
				}
				50 = {
				}
			}
		}
	}	
}

# Swarm downgrade and split on death

country_event = {
	id = bwm_ancestor.2
	
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = {
			has_global_flag = bwm_ancestor_crisis_end
		}
		FROMFROMFROM = {
			OR = {
				is_ship_size = bwm_apostle_4
				is_ship_size = bwm_apostle_scout
				is_ship_size = bwm_apostle_xxl_cloud
				is_ship_size = bwm_apostle_xl_cloud
				is_ship_size = bwm_apostle_l_cloud
				is_ship_size = bwm_apostle_m_cloud
			}
		}
	}
	
	immediate = {
		FROM = {
			save_event_target_as = bwm_ancestor_swarm_owner_1
		}
		if = {
			limit = {
				FROMFROM = {
					exists = this
				}
			}
			FROMFROM = {
				save_event_target_as = bwm_ancestor_spawn_1
			}
		}
		else_if = {
			limit = {
				FROMFROM = {
					solar_system = {
						exists = this
					}
				}
			}
			FROMFROM = {
				solar_system = {
					random_system_planet = {
						limit = { is_star = yes }
						save_event_target_as = bwm_ancestor_spawn_1
					}
				}
			}
		}
		else = {
			random_system = {
				random_system_planet = {
					limit = {
						is_star = yes 
					}
					save_event_target_as = bwm_ancestor_spawn_1
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = bwm_apostle_4
				}
			}
			random_list = {
				50 = {
					while = {
						count = 8
						bwm_ancestor_immortal_1 = yes
					}
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = bwm_apostle_scout
				}
			}
			random_list = {
				50 = {
					while = {
						count = 4
						bwm_ancestor_immortal_1 = yes
					}
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = bwm_apostle_station
				}
			}
			random_list = {
				50 = {
					while = {
						count = 2
						bwm_ancestor_immortal_1 = yes
					}
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = bwm_apostle_xxl_cloud
				}
			}
			random_list = {
				50 = {
					while = {
						count = 2
						bwm_ancestor_elder_1 = yes
					}
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = bwm_apostle_xl_cloud
				}
			}
			random_list = {
				50 = {
					while = {
						count = 2
						bwm_ancestor_adult_1 = yes
					}
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
			
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = bwm_apostle_l_cloud
				}
			}
			random_list = {
				50 = {
					while = {
						count = 2
						bwm_ancestor_young_1 = yes
					}
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_ship_size = bwm_apostle_m_cloud
				}
			}
			random_list = {
				50 = {
					while = {
						count = 2
						bwm_ancestor_infant_1 = yes
					}
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					break = yes
				}
				50 = {
				}
			}
		}	
	}
}

# Leviathan evolves

country_event = {
	id = bwm_ancestor.3
	
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = bwm_ancestor_guardian
		has_country_flag = bwm_ancestor_country
		NAND = {
			has_country_flag = bwm_ancestor_evolve_1
			has_country_flag = bwm_ancestor_evolve_2
			has_country_flag = bwm_ancestor_evolve_3
			has_country_flag = bwm_ancestor_evolve_4
		}
		NAND = {
			has_country_flag = bwm_ancestor_evolve_1
			has_country_flag = bwm_ancestor_evolve_2
			has_country_flag = bwm_ancestor_evolve_3
			has_country_flag = bwm_ancestor_evolve_4
		}
		any_owned_ship = {
			OR = {
				is_ship_size = bwm_apostle_1
				is_ship_size = bwm_apostle_2
				is_ship_size = bwm_apostle_3
				is_ship_size = bwm_apostle_egg
			}
		}
	}
	
	immediate = {
		FROMFROM = {
			OWNER = {
				save_event_target_as = bwm_ancestor_evolve_owner
			}
			save_event_target_as = bwm_ancestor_evolve_spawn
		}
		if = {
			limit = {
				FROMFROM = {
					OWNER = {
						NOT = { has_country_flag = bwm_ancestor_evolve_1 }
						count_owned_ship = {
							limit = {
								is_ship_size = bwm_apostle_1
								FLEET = { is_same_value = event_target:bwm_ancestor_evolve_spawn }
							}
							count > 0
						}
						num_owned_planets > 10
					}
				}
			}
			bwm_ancestor_fanu_1 = yes
			FROMFROM = {
				OWNER = {
					add_modifier = {
						modifier = "bwm_ancestor_buff_1"
						days = -1
					}
				}
				delete_fleet = this
			}
			last_created_fleet = {
				bwm_effect_explosion_8 = yes
			}
			set_country_flag = bwm_ancestor_evolve_1
			every_country = {
				limit = {
					is_ai = no
				}
				country_event = { id = bwm_ancestor.45 days = 10 }
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					OWNER = {
						has_country_flag = bwm_ancestor_evolve_1
						NOT = { has_country_flag = bwm_ancestor_evolve_2 }
						count_owned_ship = {
							limit = {
								is_ship_size = bwm_apostle_2
								FLEET = { is_same_value = event_target:bwm_ancestor_evolve_spawn }
							}
							count > 0
						}
						num_owned_planets > 20
					}
				}
			}
			bwm_ancestor_fanu_2 = yes
			FROMFROM = {
				OWNER = {
					add_modifier = {
						modifier = "bwm_ancestor_buff_2"
						days = -1
					}
				}
				delete_fleet = this
			}
			last_created_fleet = {
				bwm_effect_explosion_8 = yes
			}
			set_country_flag = bwm_ancestor_evolve_2
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					OWNER = {
						AND = {
							has_country_flag = bwm_ancestor_evolve_1
							has_country_flag = bwm_ancestor_evolve_2
						}
						NOT = { has_country_flag = bwm_ancestor_evolve_3 }
						count_owned_ship = {
							limit = {
								is_ship_size = bwm_apostle_3
								FLEET = { is_same_value = event_target:bwm_ancestor_evolve_spawn }
							}
							count > 0
						}
						num_owned_planets > 30
					}
				}
			}
			bwm_ancestor_fanu_3 = yes
			bwm_ancestor_thesan_1 = yes
			FROMFROM = {
				OWNER = {
					add_modifier = {
						modifier = "bwm_ancestor_buff_3"
						days = -1
					}
				}
				delete_fleet = this
			}
			last_created_fleet = {
				bwm_effect_explosion_8 = yes
			}
			set_country_flag = bwm_ancestor_evolve_3
			every_country = {
				limit = {
					is_ai = no
				}
				country_event = { id = bwm_ancestor.46 days = 10 }
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					OWNER = {
						AND = {
							has_country_flag = bwm_ancestor_evolve_1
							has_country_flag = bwm_ancestor_evolve_2
							has_country_flag = bwm_ancestor_evolve_3
						}
						NOT = { has_country_flag = bwm_ancestor_evolve_4 }
						count_owned_ship = {
							limit = {
								is_ship_size = bwm_apostle_egg
								FLEET = { is_same_value = event_target:bwm_ancestor_evolve_spawn }
							}
							count > 0
						}
						num_owned_planets > 40
					}
				}
			}
			bwm_ancestor_thesan_2 = yes
			FROMFROM = {
				OWNER = {
					add_modifier = {
						modifier = "bwm_ancestor_buff_4"
						days = -1
					}
				}
				delete_fleet = this
			}
			last_created_fleet = {
				bwm_effect_explosion_8 = yes
			}
			set_country_flag = bwm_ancestor_evolve_4
			break = yes
		}
	}
}

# Swarm evolves

fleet_event = {
	id = bwm_ancestor.4
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		exists = this
		OR = {
			has_fleet_flag = bwm_ancestor_infant_spawn
			has_fleet_flag = bwm_ancestor_young_spawn
			has_fleet_flag = bwm_ancestor_adult_spawn
			has_fleet_flag = bwm_ancestor_elder_spawn
			has_fleet_flag = bwm_ancestor_dying_spawn
			has_fleet_flag = bwm_ancestor_boss_decay
		}
	}

	immediate = {
		OWNER = {
			save_event_target_as = bwm_ancestor_swarm_owner_2
		}
		save_event_target_as = bwm_ancestor_spawn_2
		if = {
			limit = {
				has_fleet_flag = bwm_ancestor_infant_spawn
			}
			random_list = {
				50 = {
					bwm_ancestor_young_2 = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					destroy_fleet = THIS
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = bwm_ancestor_young_spawn
			}
			random_list = {
				50 = {
					bwm_ancestor_adult_2 = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					destroy_fleet = THIS
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = bwm_ancestor_adult_spawn
			}
			random_list = {
				50 = {
					bwm_ancestor_elder_2 = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					destroy_fleet = THIS
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = bwm_ancestor_elder_spawn
			}
			random_list = {
				50 = {
					bwm_ancestor_immortal_2 = yes
					last_created_fleet = {
						bwm_effect_explosion_7 = yes
					}
					destroy_fleet = THIS
					break = yes
				}
				50 = {
					break = yes
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = bwm_ancestor_dying_spawn
			}
			destroy_fleet = THIS
			break = yes
		}
		if = {
			limit = {
				has_fleet_flag = bwm_ancestor_boss_decay
			}
			while = {
				count = 16
				bwm_ancestor_immortal_2 = yes
			}
			last_created_fleet = {
				bwm_effect_explosion_7 = yes
			}
			destroy_fleet = THIS
		}
	}
}

# Planet conversion

planet_event = {
	id = bwm_ancestor.5
	hide_window = yes
	
	trigger = {
		FROM = {
			is_country_type = bwm_ancestor_guardian
		}
	}
	
	is_triggered_only = yes
	
	immediate = {
		add_threat = {
			who = from
			amount = 10
		}
		from = {
			save_event_target_as = bwm_ancestor_swarm_owner_3
		}
		this = {
			solar_system = {
				if = {
					limit = {
						NOT = {
							any_ship_in_system = { 
								is_ship_size = bwm_apostle_station
							}
						}
					}
					random_system_planet = {
						limit = { is_star = yes }
						save_event_target_as = bwm_ancestor_spawn_3
						bwm_ancestor_ward = yes
					}
				}
			}
		}
		create_ambient_object = {
			type = bwm_effect_explosion_6_object
			location = THIS
			duration = 10
				
			use_3d_location = yes
				
			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }
				
			entity_scale_to_size = yes
			scale = 100
		}
		random_list = {
			25 = {
				create_ambient_object = {
				type = "small_debris_object"
				location = THIS
				}
			}
			25 = {
				create_ambient_object = {
				type = "medium_debris_01_object"
				location = THIS
				}
			}
			25 = {
				create_ambient_object = {
				type = "medium_debris_02_object"
				location = THIS
				}
			}
			25 = {
				create_ambient_object = {
				type = "large_debris_object"
				location = THIS
				}
			}
		}
		OWNER = {
			country_event = { id = bwm_ancestor.47 days = 10 }
		}
		if = {
			limit = {
				NOR = {
					is_planet_class = pc_habitat
					is_planet_class = pc_ringworld_habitable 
					has_planet_flag = fallen_empire_world
					has_modifier = holy_planet
				}
			}
			destroy_colony = yes
			remove_all_buildings = yes
			if = {
				limit = {
					NOT = {
						is_planet_class = pc_gaia
					}
				}
				change_pc = pc_gaia
			}
			bwm_ancestor_terraform = yes
			set_owner = event_target:bwm_ancestor_swarm_owner_3
			set_planet_flag = bwm_ancestor_world
			remove_planet_flag = bwm_ancestor_touched
			#every_deposit = {
				#add_deposit = tb_bwm_nature
				#deposit_type = tb_bwm_nature
			#}
			while = {
				count = planet_size
				add_deposit = tb_bwm_nature
			}
			add_deposit = d_alien_pets_deposit
			add_modifier = {
				modifier = "bwm_ancestor_garden_world"
				days = -1
			}
			planet_event = { id = bwm_ancestor.200 }
			break = yes
		}
		if = {
			limit = {
					has_planet_flag = fallen_empire_world
					NOT = {
						is_planet_class = pc_ringworld_habitable
					}
			}
			destroy_colony = yes
			remove_all_buildings = yes
			change_pc = pc_nuked
			remove_planet_flag = bwm_ancestor_touched
			bwm_ancestor_terraform = yes
			#every_tile = {
			#	if = {
			#		limit = {
			#			has_building = yes
			#		}
			#		set_building = bwm_building_crisis_ruin
			#	}
			#}
			#random_tile = {
			#	add_deposit = d_betharian_deposit
			#}
			break = yes
		}
		if = {
			limit = {
				has_modifier = holy_planet 
			}
			destroy_colony = yes
			remove_all_buildings = yes
			change_pc = pc_bwm_cracked	
			bwm_ancestor_terraform = yes
			#set_planet_max_health = 0
			#orbital_deposit_tile = {
				add_deposit = d_dark_matter_deposit_1 
			#}
			break = yes
		}
		if = {
			limit = {
				is_planet_class = pc_ringworld_habitable 
			}
			destroy_colony = yes
			remove_all_buildings = yes
			change_pc = pc_ringworld_habitable_damaged
			bwm_ancestor_terraform = yes
			#set_planet_max_health = 0
			#orbital_deposit_tile = {
				add_deposit = d_living_metal_deposit
			#}
			break = yes
		}
		if = {
			limit = {
				is_planet_class = pc_habitat
			}
			destroy_colony = yes
			remove_planet = yes 
		}
	}
}

# Player planet reclamation

planet_event = {
	id = bwm_ancestor.6
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			FROM = {
				is_country_type = bwm_ancestor_guardian
			}
		}
		has_planet_flag = bwm_ancestor_world
	}
	
	immediate = {
		THIS = {
			solar_system = {
				random_system_planet = {
					limit = { is_star = yes }
					save_event_target_as = bwm_ancestor_spawn_4
				}
			}
			OWNER = {
				save_event_target_as = bwm_ancestor_swarm_owner_4
				add_modifier = {
					modifier = "bwm_ancestor_world_debuff"
					days = 360
				}
			}
		}
		random_list = {
			50 = {
				bwm_ancestor_immortal_3 = yes
			}
			50 = {
			}
		}
		destroy_colony = yes
		remove_all_buildings = yes
		#set_planet_max_health = 0
		remove_planet_flag = bwm_ancestor_world
		if = {
			limit = {
				has_modifier = bwm_ancestor_garden_world
			}
			remove_modifier = "bwm_ancestor_garden_world"
		}
		random_list = {
			75 = {
				every_deposit = {
					limit = {
						is_deposit_type = "tb_bwm_nature"
					}
					clear_blocker = yes
				}
			}
			25 = {
				if = {
					limit = {
						is_planet_class = pc_ringworld_habitable 
					}
					change_pc = pc_ringworld_habitable_damaged
					FROM = {
						country_event = { id = bwm_ancestor.48 days = 10 }
					}
				}
				else = {
					random_list = {
						25 = { change_pc = pc_nuked }
						25 = { change_pc = pc_toxic }
						25 = { change_pc = pc_molten }
						25 = { change_pc = pc_barren }
					}
					FROM = {
						country_event = { id = bwm_ancestor.48 days = 10 }
					}
				}
			}
		}
		create_ambient_object = {
			type = bwm_effect_explosion_6_object
			location = THIS
			duration = 10
				
			use_3d_location = yes
				
			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }
				
			entity_scale_to_size = yes
			scale = 100
		}
		planet_event = { id = bwm_ancestor.201 }
	}
}

#Crisis bombardment buff

planet_event = {
	id = bwm_ancestor.7
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			OWNER = {
				is_country_type = bwm_ancestor_guardian
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				NOT = {
					has_planet_flag = bwm_ancestor_touched
				}
			}
			set_planet_flag = bwm_ancestor_touched
		}
		random_list = {
			1 = {
				if = {
					limit = {
						count_owned_pop = {
							count = 1
						}
					}						
					random_owned_pop = {
						kill_pop = yes
					}
					FROM = {
						OWNER = {
							#country_event = { id = action.23 }
							save_event_target_as = bwm_ancestor_swarm_owner_6
						}
					}
					THIS = {
						solar_system = {
							random_system_planet = {
								limit = {
									is_star = yes
								}
								save_event_target_as = bwm_ancestor_spawn_6
							}
						}
					}
					random_list = {
						50 = {
							bwm_ancestor_infant_6 = yes
						}
						50 = {
						}
					}
					add_threat = {
						who = FROM.OWNER
						amount = 10
					}
				}
			}
			99 = {
			}
		}
		random_list = {
			1 = {
				if = {
					limit = {
						count_owned_pop = {
							count > 1
						}
					}						
					random_owned_pop = {
						limit = {
							NOT = {
								has_modifier = bwm_pop_ancestor
							}
						}
						add_modifier = {
							modifier = "bwm_pop_ancestor"
							days = 360
						}
					}
					add_threat = {
						who = FROM.OWNER
						amount = 10
					}
				}
			}
			99 = {
			}
		}
		random_list = {
			1 = {
				if = {
					limit = {
						count_owned_pop = {
							count > 1
						}
						any_owned_pop = {
							has_modifier = bwm_pop_ancestor
						}
					}						
					random_owned_pop = {
						limit = {
							has_modifier = bwm_pop_ancestor
						}
						kill_pop = yes
					}
					FROM = {
						OWNER = {
							#country_event = { id = action.23 }
							save_event_target_as = bwm_ancestor_swarm_owner_6
						}
					}
					THIS = {
						solar_system = {
							random_system_planet = {
								limit = {
									is_star = yes
								}
								save_event_target_as = bwm_ancestor_spawn_6
							}
						}
					}
					random_list = {
						50 = {
							bwm_ancestor_infant_6 = yes
						}
						50 = {
						}
					}
					add_threat = {
						who = FROM.OWNER
						amount = 10
					}
				}
			}
			99 = {
			}
		}
		random_list = {
			1 = {
				if = {
					limit = {
						has_army = yes
						count_owned_pop = {
							count > 1
						}
					}					
					random_planet_army = {
						limit = {
							exists = this
						}
						remove_army = yes  
					}
					FROM = {
						OWNER = {
							save_event_target_as = bwm_ancestor_swarm_owner_6
						}
					}
					THIS = {
						solar_system = {
							random_system_planet = {
								limit = {
									is_star = yes
								}
								save_event_target_as = bwm_ancestor_spawn_6
							}
						}
					}
					random_list = {
						50 = {
							bwm_ancestor_infant_6 = yes
						}
						50 = {
						}
					}
					add_threat = {
						who = FROM.OWNER
						amount = 10
					}
				}
			}
			99 = {
			}
		}
		random_list = {
			1 = {
				#random_tile = {
				#	limit = {
				#		has_building = yes
				#		is_ruined = no
				#	}
				#	set_ruined = yes
				#}
				add_threat = {
					who = FROM.OWNER
					amount = 10
				}
			}
			99 = {
			}
		}
		random_list = {
			1 = {
				if = {
					limit = {
						planet = {
							count_owned_pop = {
								count > 1
							}
						}
					}
					#random_tile = {
					#	limit = {
					#		has_grown_pop = no
					#		has_growing_pop = no 
					#		has_blocker = no
					#		has_building = yes
					#		is_ruined = yes
					#	}
						add_deposit = "tb_bwm_nature"
					#}
					add_threat = {
						who = FROM.OWNER
						amount = 10
					}
				}
			}
			99 = {
			}
		}
		random_list = {
			1 = {	
				if = {
					limit = {
						planet = {
							count_owned_pop = {
								count > 1
							}
						}
					}
					#random_tile = {
					#	limit = {
					#		has_grown_pop = no
					#		has_growing_pop = no 
					#		has_blocker = no
					#		has_building = no
					#	}
						add_deposit = "tb_bwm_nature"
					#}
					add_threat = {
						who = FROM.OWNER
						amount = 10
					}
				}
			}
			99 = {
			}
		}
	}
}

#Crisis galaxy wide effect - convert touched planets

event = {
	id = bwm_ancestor.8
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = bwm_ancestor_crisis_start
		NOT = {
			has_global_flag = bwm_ancestor_crisis_end
		}
	}

	immediate = {
		every_galaxy_planet = {
			if = {
				limit = {
					exists = this
					num_pops > 0
					AND = {
						solar_system = {
							any_ship_in_system = {
								OR = {
									is_ship_size = bwm_apostle_1
									is_ship_size = bwm_apostle_2
									is_ship_size = bwm_apostle_3
									is_ship_size = bwm_apostle_4
									is_ship_size = bwm_apostle_egg
									is_ship_size = bwm_apostle_child
									is_ship_size = bwm_apostle_scout
									is_ship_size = bwm_apostle_station
									is_ship_size = bwm_apostle_xxl_cloud
									is_ship_size = bwm_apostle_xl_cloud
									is_ship_size = bwm_apostle_l_cloud
									is_ship_size = bwm_apostle_m_cloud
								}
							}
						}
						NOT = {
							has_modifier = bwm_ancestor_in_system
						}
					}
				}
				add_modifier = {
					modifier = "bwm_ancestor_in_system"
					days = 30
				} 
			}
			if = {
				limit = {
					exists = this
					num_pops = 0
					has_planet_flag = bwm_ancestor_touched
					NOT = {
						has_planet_flag = bwm_ancestor_world
						OR = {
							is_planet_class = pc_habitat
							is_planet_class = pc_ringworld_habitable 
							has_planet_flag = fallen_empire_world
							has_modifier = holy_planet
						}
					}
				}
				bwm_ancestor_delayed_conversion = yes
				bwm_ancestor_terraform = yes
				change_pc = pc_gaia
				set_owner = event_target:bwm_ancestor_country
				set_planet_flag = bwm_ancestor_world
				remove_planet_flag = bwm_ancestor_touched
				#every_tile = {
					add_deposit = tb_bwm_nature
				#}
				#random_tile = {
					add_deposit = d_alien_pets_deposit
				#}
				add_modifier = {
					modifier = "bwm_ancestor_garden_world"
					days = -1
				}
				add_threat = {
					who = event_target:bwm_ancestor_country
					amount = 10
				}
				planet_event = { id = bwm_ancestor.200 }
			}
			if = {
				limit = {
					exists = this
					num_pops = 0
					AND = {
						has_planet_flag = fallen_empire_world
						has_planet_flag = bwm_ancestor_touched
					}
					NOT = {
						is_planet_class = pc_nuked
						has_planet_flag = bwm_ancestor_world
						OR = {
							is_planet_class = pc_ringworld_habitable
							is_planet_class = pc_ringworld_habitable_damaged
						}
					}
				}
				bwm_ancestor_delayed_conversion = yes
				bwm_ancestor_terraform = yes
				change_pc = pc_nuked
				remove_planet_flag = bwm_ancestor_touched
				#every_tile = {
				#	if = {
				#		limit = {
				#			has_building = yes
				#		}
				#		set_building = bwm_building_crisis_ruin
				#	}
				#}
				#random_tile = {
					add_deposit = d_betharian_deposit
				#}
				add_threat = {
					who = event_target:bwm_ancestor_country
					amount = 10
				}
			}
			if = {
				limit = {
					exists = this
					num_pops = 0
					AND = {
						has_modifier = holy_planet 
						has_planet_flag = bwm_ancestor_touched
					}
					NOT = {
						is_planet_class = pc_bwm_cracked
						has_planet_flag = bwm_ancestor_world
					}
				}
				bwm_ancestor_delayed_conversion = yes
				bwm_ancestor_terraform = yes
				change_pc = pc_bwm_cracked	
				remove_planet_flag = bwm_ancestor_touched
				#set_planet_max_health = 0
				#orbital_deposit_tile = {
					add_deposit = d_dark_matter_deposit_1
				#}
				add_threat = {
					who = event_target:bwm_ancestor_country
					amount = 10
				}
			}
			if = {
				limit = {
					exists = this
					num_pops = 0
					has_planet_flag = bwm_ancestor_touched
					is_planet_class = pc_ringworld_habitable 
					NOT = {
						is_planet_class = pc_ringworld_habitable_damaged
						has_planet_flag = bwm_ancestor_world
					}
				}
				bwm_ancestor_delayed_conversion = yes
				bwm_ancestor_terraform = yes
				change_pc = pc_ringworld_habitable_damaged
				remove_planet_flag = bwm_ancestor_touched
				#set_planet_max_health = 0
				#orbital_deposit_tile = {
					add_deposit = d_living_metal_deposit
				#}
				add_threat = {
					who = event_target:bwm_ancestor_country
					amount = 10
				}
			}
			if = {
				limit = {
					exists = this
					num_pops = 0
					has_planet_flag = bwm_ancestor_touched
					is_planet_class = pc_habitat
				}
				bwm_ancestor_delayed_conversion = yes
				remove_planet = yes 
				add_threat = {
					who = event_target:bwm_ancestor_country
					amount = 10
				}
			}
		}
	}
}

#Crisis Starspawn fleet action

fleet_event = {
	id = bwm_ancestor.9
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		this = {
			owner = {
				save_event_target_as = bwm_ancestor_star_spawn_owner
			}
		}
		queue_actions = {
			repeat = {
				find_closest_system = {
					trigger = {
						id = bwm_ancestor_monstrosity.roam.1
						NOT = {
							OR = {
								has_star_flag = enclave
								has_star_flag = guardian
								has_star_flag = bwm_ring_system
								has_star_flag = bwm_grave_system
								has_star_flag = bwm_garden_system
								has_star_flag = bwm_prison_system
								has_star_flag = bwm_gate_system
							}
							any_ship_in_system = {
								OR = {
									is_ship_size = bwm_apostle_xxl_cloud 
									is_ship_size = bwm_artifact_ship
									is_ship_size = bwm_artifact_relic_frame
									is_ship_size = bwm_artifact_bomb_1
									is_ship_size = bwm_artifact_bomb_2 
									is_ship_size = bwm_titan
									is_ship_size = bwm_grave_awakened_pc
									is_ship_size = bwm_conduit_avatar
									is_ship_size = bwm_ancient_weapon
								}
							}
						}
						OR = {
							any_ship_in_system = {
								exists = owner
								NOT = {
									owner = {
										is_same_value = event_target:bwm_ancestor_star_spawn_owner
									}
								}
							}
							AND = {
								exists = space_owner
								any_system_planet = {
									OR = {
										#has_spaceport = yes  
										has_observation_outpost = yes
										has_mining_station = yes
										has_research_station = yes 
									}
								}
								NOT = {
									space_owner = {
										OR = {
											is_same_value = event_target:bwm_ancestor_star_spawn_owner
											fleet_power > 50000
										}
									}
								}
							}
						}
					}
					found_system = {
						move_to = this
						
						find_closest_planet = {
							trigger = {
								id = bwm_ancestor_monstrosity.roam.2
								OR = {
									is_star = yes
									#has_spaceport = yes  
									has_observation_outpost = yes
									has_mining_station = yes
									has_research_station = yes 
								}
							}
							found_planet = {
								move_to = this
								wait = {
									duration = 25
									random = 15
								}
							}
						}
					}
				}
			}
		}
	}
}

#Crisis Herald fleet action

fleet_event = {
	id = bwm_ancestor.10
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		queue_actions = {
			repeat = {
				find_random_system = {
					trigger = {
						id = bwm_ancestor_herald.roam.1a
						NOT = {
							OR = {
								has_star_flag = enclave
								has_star_flag = guardian
								has_star_flag = bwm_ring_system
								has_star_flag = bwm_grave_system
								has_star_flag = bwm_garden_system
								has_star_flag = bwm_prison_system
								has_star_flag = bwm_gate_system
							}
							any_ship_in_system = {
								OR = {
									is_ship_size = bwm_artifact_ship
									is_ship_size = bwm_artifact_relic_frame
									is_ship_size = bwm_artifact_bomb_1
									is_ship_size = bwm_artifact_bomb_2 
									is_ship_size = bwm_titan
									is_ship_size = bwm_grave_awakened_pc
									is_ship_size = bwm_conduit_avatar
									is_ship_size = bwm_ancient_weapon
									is_ship_size = bwm_apostle_scout 
									is_ship_size = bwm_apostle_1
									is_ship_size = bwm_apostle_2
									is_ship_size = bwm_apostle_3
									is_ship_size = bwm_apostle_4
									is_ship_size = bwm_apostle_egg
									is_ship_size = bwm_apostle_child
								}
							}
						}
						OR = {
							any_ship_in_system = {
								exists = owner
								NOT = {
									owner = {
										is_same_value = event_target:bwm_ancestor_country
									}
								}
							}
							AND = {
								exists = space_owner
								any_system_planet = {
									OR = {
										#has_spaceport = yes  
										has_observation_outpost = yes
										has_mining_station = yes
										has_research_station = yes 
									}
								}
								NOT = {
									space_owner = {
										OR = {
											is_same_value = event_target:bwm_ancestor_country
											fleet_power > 50000
										}
									}
								}
							}
						}
					}
					found_system = {
						move_to = this
						
						find_closest_planet = {
							trigger = {
								id = bwm_ancestor_herald.roam.1b
								OR = {
									is_star = yes
									#has_spaceport = yes  
									has_observation_outpost = yes
									has_mining_station = yes
									has_research_station = yes 
								}
							}
							found_planet = {
								move_to = this
								effect = {
									id = bwm_ancestor_herald.roam.1c
									solar_system = {
										if = {
											limit = {
												any_ship_in_system = {
													has_ship_flag = bwm_ancestor_herald_1
												}
											}
											save_event_target_as = bwm_ancestor_herald_1_loc
											every_country = {
												limit = {
													AND = {
														has_country_flag = bwm_apostle_1_tracker
														has_event_chain = bwm_lex_ancestor_chain
													}
												}
												remove_point_of_interest = bwm_ancestor_herald_poi.1
												create_point_of_interest = {
													id = bwm_ancestor_herald_poi.1
													name = "bwm_ancestor_herald_1_poi"
													desc = "bwm_ancestor_herald_1_poi_desc"
													event_chain = bwm_lex_ancestor_chain
													location = event_target:bwm_ancestor_herald_1_loc
												}
											}
										}
										if = {
											limit = {
												any_ship_in_system = {
													has_ship_flag = bwm_ancestor_herald_2
												}
											}
											save_event_target_as = bwm_ancestor_herald_2_loc
											every_country = {
												limit = {
													AND = {
														has_country_flag = bwm_apostle_2_tracker
														has_event_chain = bwm_lex_ancestor_chain
													}
												}
												remove_point_of_interest = bwm_ancestor_herald_poi.2
												create_point_of_interest = {
													id = bwm_ancestor_herald_poi.2
													name = "bwm_ancestor_herald_2_poi"
													desc = "bwm_ancestor_herald_2_poi_desc"
													event_chain = bwm_lex_ancestor_chain
													location = event_target:bwm_ancestor_herald_2_loc
												}
											}
										}
										if = {
											limit = {
												any_ship_in_system = {
													has_ship_flag = bwm_ancestor_herald_3
												}
											}
											save_event_target_as = bwm_ancestor_herald_3_loc
											every_country = {
												limit = {
													AND = {
														has_country_flag = bwm_apostle_3_tracker
														has_event_chain = bwm_lex_ancestor_chain
													}
												}
												remove_point_of_interest = bwm_ancestor_herald_poi.3
												create_point_of_interest = {
													id = bwm_ancestor_herald_poi.3
													name = "bwm_ancestor_herald_3_poi"
													desc = "bwm_ancestor_herald_3_poi_desc"
													event_chain = bwm_lex_ancestor_chain
													location = event_target:bwm_ancestor_herald_3_loc
												}
											}
										}
										if = {
											limit = {
												any_ship_in_system = {
													has_ship_flag = bwm_ancestor_herald_4
												}
											}
											save_event_target_as = bwm_ancestor_herald_4_loc
											every_country = {
												limit = {
													AND = {
														has_country_flag = bwm_apostle_4_tracker
														has_event_chain = bwm_lex_ancestor_chain
													}
												}
												remove_point_of_interest = bwm_ancestor_herald_poi.4
												create_point_of_interest = {
													id = bwm_ancestor_herald_poi.4
													name = "bwm_ancestor_herald_4_poi"
													desc = "bwm_ancestor_herald_4_poi_desc"
													event_chain = bwm_lex_ancestor_chain
													location = event_target:bwm_ancestor_herald_4_loc
												}
											}
										}
										if = {
											limit = {
												any_ship_in_system = {
													has_ship_flag = bwm_ancestor_herald_5
												}
											}
											save_event_target_as = bwm_ancestor_herald_5_loc
											every_country = {
												limit = {
													AND = {
														has_country_flag = bwm_apostle_5_tracker
														has_event_chain = bwm_lex_ancestor_chain
													}
												}
												remove_point_of_interest = bwm_ancestor_herald_poi.5
												create_point_of_interest = {
													id = bwm_ancestor_herald_poi.5
													name = "bwm_ancestor_herald_5_poi"
													desc = "bwm_ancestor_herald_5_poi_desc"
													event_chain = bwm_lex_ancestor_chain
													location = event_target:bwm_ancestor_herald_5_loc
												}
											}
										}
										if = {
											limit = {
												any_ship_in_system = {
													has_ship_flag = bwm_ancestor_herald_6
												}
											}
											save_event_target_as = bwm_ancestor_herald_6_loc
											every_country = {
												limit = {
													AND = {
														has_country_flag = bwm_apostle_6_tracker
														has_event_chain = bwm_lex_ancestor_chain
													}
												}
												remove_point_of_interest = bwm_ancestor_herald_poi.6
												create_point_of_interest = {
													id = bwm_ancestor_herald_poi.6
													name = "bwm_ancestor_herald_6_poi"
													desc = "bwm_ancestor_herald_6_poi_desc"
													event_chain = bwm_lex_ancestor_chain
													location = event_target:bwm_ancestor_herald_6_loc
												}
											}
										}
									}
								}
								wait = {
									duration = 45
									random = 25
								}
							}
						}
					}
				}
			}
		}
	}
}

#Crisis Leviathan special ability

fleet_event = {
	id = bwm_ancestor.11
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = bwm_ancestor_guardian
				NAND = {
					has_modifier = bwm_ancestor_herald_debuff_1
					has_modifier = bwm_ancestor_herald_debuff_2
					has_modifier = bwm_ancestor_herald_debuff_3
					has_modifier = bwm_ancestor_herald_debuff_4
					has_modifier = bwm_ancestor_herald_debuff_5
					has_modifier = bwm_ancestor_herald_debuff_6
				}
			}
			NOT = { 
				has_fleet_flag = bwm_ancestor_ftl_cooldown
			}
			any_owned_ship = {
				OR = {
					is_ship_size = bwm_apostle_1
					is_ship_size = bwm_apostle_2
					is_ship_size = bwm_apostle_3
					is_ship_size = bwm_apostle_egg
					is_ship_size = bwm_apostle_child
				}
				has_hp_percentage < 0.25
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = bwm_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = bwm_ancestor_ftl_cooldown
				}
				any_owned_ship = {
					OR = {
						is_ship_size = bwm_apostle_1
						is_ship_size = bwm_apostle_2
						is_ship_size = bwm_apostle_3
						is_ship_size = bwm_apostle_egg
						is_ship_size = bwm_apostle_child
					}
				}
			}
			solar_system = {
				save_event_target_as = bwm_ancestor_escape_loc_1
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
				}
				if = {
					limit = {
						NOT = {
							any_ship_in_system = {
								is_ship_size = bwm_ancient_weapon
							}
						}
					}
					every_fleet_in_system = {
						limit = {
							exists = owner
							NOT = {
								owner = {
									is_country_type = bwm_ancestor_guardian
								}
							}
						}
						owner = {
							if = {
								limit = {
									is_ai = no
								}
								country_event = { id = bwm_ancestor.53 }
							}
						}
						clear_orders = yes 
						add_modifier = {
							modifier = "bwm_ancestor_pc_boss_debuff"
							days = 30
						}
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:bwm_ancestor_escape_loc_1
						use_bypasses = no
						min_jumps = 8
						max_jumps = 120
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					save_event_target_as = bwm_ancestor_escape_loc_2
				}
			}
			set_location = event_target:bwm_ancestor_escape_loc_2
			owner = {
				random_owned_ship = {
					limit = {
						OR = {
							is_ship_size = bwm_apostle_1
							is_ship_size = bwm_apostle_2
							is_ship_size = bwm_apostle_3
							is_ship_size = bwm_apostle_egg
							is_ship_size = bwm_apostle_child
						}
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = bwm_ancestor_boss_enraged
							}
						}
						add_modifier = {
							modifier = "bwm_ancestor_boss_enraged"
							days = 30
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = bwm_ancestor_ftl_cooldown
				days = 90
			}
		}
	}
}

#Crisis Leviathan Herald 1 special ability

fleet_event = {
	id = bwm_ancestor.12
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = bwm_ancestor_guardian
			}
			NOT = { 
				has_fleet_flag = bwm_ancestor_scout_ftl_cooldown_1
			}
			any_owned_ship = {
				is_ship_size = bwm_apostle_scout
				has_ship_flag = bwm_ancestor_herald_1
				has_hp_percentage < 0.5
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = bwm_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = bwm_ancestor_scout_ftl_cooldown_1
				}
				any_owned_ship = {
					is_ship_size = bwm_apostle_scout
					has_ship_flag = bwm_ancestor_herald_1
				}
			}
			solar_system = {
				save_event_target_as = bwm_ancestor_escape_loc_1_scout_1
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
				}
				if = {
					limit = {
						NOT = {
							any_ship_in_system = {
								is_ship_size = bwm_ancient_weapon
							}
						}
					}
					every_fleet_in_system = {
						limit = {
							exists = owner
							NOT = {
								owner = {
									is_country_type = bwm_ancestor_guardian
								}
							}
						}
						owner = {
							if = {
								limit = {
									is_ai = no
								}
								country_event = { id = bwm_ancestor.53 }
							}
						}
						clear_orders = yes 
						add_modifier = {
							modifier = "bwm_ancestor_pc_herald_debuff"
							days = 30
						}
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:bwm_ancestor_escape_loc_1_scout_1
						use_bypasses = no
						min_jumps = 8
						max_jumps = 120
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
					save_event_target_as = bwm_ancestor_escape_loc_2_scout_1
				}
			}
			set_location = event_target:bwm_ancestor_escape_loc_2_scout_1
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = bwm_apostle_scout
						has_ship_flag = bwm_ancestor_herald_1
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = bwm_ancestor_herald_enraged
							}
						}
						add_modifier = {
							modifier = "bwm_ancestor_herald_enraged"
							days = 30
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = bwm_ancestor_scout_ftl_cooldown_1
				days = 180
			}
		}
	}
}

#Crisis Leviathan Herald 2 special ability

fleet_event = {
	id = bwm_ancestor.13
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = bwm_ancestor_guardian
			}
			NOT = { 
				has_fleet_flag = bwm_ancestor_scout_ftl_cooldown_2
			}
			any_owned_ship = {
				is_ship_size = bwm_apostle_scout
				has_ship_flag = bwm_ancestor_herald_2
				has_hp_percentage < 0.5
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = bwm_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = bwm_ancestor_scout_ftl_cooldown_2
				}
				any_owned_ship = {
					is_ship_size = bwm_apostle_scout
					has_ship_flag = bwm_ancestor_herald_2
				}
			}
			solar_system = {
				save_event_target_as = bwm_ancestor_escape_loc_1_scout_2
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
				}
				if = {
					limit = {
						NOT = {
							any_ship_in_system = {
								is_ship_size = bwm_ancient_weapon
							}
						}
					}
					every_fleet_in_system = {
						limit = {
							exists = owner
							NOT = {
								owner = {
									is_country_type = bwm_ancestor_guardian
								}
							}
						}
						owner = {
							if = {
								limit = {
									is_ai = no
								}
								country_event = { id = bwm_ancestor.53 }
							}
						}
						clear_orders = yes 
						add_modifier = {
							modifier = "bwm_ancestor_pc_herald_debuff"
							days = 30
						}
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:bwm_ancestor_escape_loc_1_scout_2
						use_bypasses = no
						min_jumps = 8
						max_jumps = 120
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
					save_event_target_as = bwm_ancestor_escape_loc_2_scout_2
				}
			}
			set_location = event_target:bwm_ancestor_escape_loc_2_scout_2
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = bwm_apostle_scout
						has_ship_flag = bwm_ancestor_herald_2
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = bwm_ancestor_herald_enraged
							}
						}
						add_modifier = {
							modifier = "bwm_ancestor_herald_enraged"
							days = 30
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = bwm_ancestor_scout_ftl_cooldown_2
				days = 180
			}
		}
	}
}

#Crisis Leviathan Herald 3 special ability

fleet_event = {
	id = bwm_ancestor.14
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = bwm_ancestor_guardian
			}
			NOT = { 
				has_fleet_flag = bwm_ancestor_scout_ftl_cooldown_3
			}
			any_owned_ship = {
				is_ship_size = bwm_apostle_scout
				has_ship_flag = bwm_ancestor_herald_3
				has_hp_percentage < 0.5
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = bwm_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = bwm_ancestor_scout_ftl_cooldown_3
				}
				any_owned_ship = {
					is_ship_size = bwm_apostle_scout
					has_ship_flag = bwm_ancestor_herald_3
				}
			}
			solar_system = {
				save_event_target_as = bwm_ancestor_escape_loc_1_scout_3
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
				}
				if = {
					limit = {
						NOT = {
							any_ship_in_system = {
								is_ship_size = bwm_ancient_weapon
							}
						}
					}
					every_fleet_in_system = {
						limit = {
							exists = owner
							NOT = {
								owner = {
									is_country_type = bwm_ancestor_guardian
								}
							}
						}
						owner = {
							if = {
								limit = {
									is_ai = no
								}
								country_event = { id = bwm_ancestor.53 }
							}
						}
						clear_orders = yes 
						add_modifier = {
							modifier = "bwm_ancestor_pc_herald_debuff"
							days = 30
						}
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:bwm_ancestor_escape_loc_1_scout_3
						use_bypasses = no
						min_jumps = 8
						max_jumps = 120
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
					save_event_target_as = bwm_ancestor_escape_loc_2_scout_3
				}
			}
			set_location = event_target:bwm_ancestor_escape_loc_2_scout_3
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = bwm_apostle_scout
						has_ship_flag = bwm_ancestor_herald_3
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = bwm_ancestor_herald_enraged
							}
						}
						add_modifier = {
							modifier = "bwm_ancestor_herald_enraged"
							days = 30
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = bwm_ancestor_scout_ftl_cooldown_3
				days = 180
			}
		}
	}
}

#Crisis Leviathan Herald 4 special ability

fleet_event = {
	id = bwm_ancestor.15
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = bwm_ancestor_guardian
			}
			NOT = { 
				has_fleet_flag = bwm_ancestor_scout_ftl_cooldown_4
			}
			any_owned_ship = {
				is_ship_size = bwm_apostle_scout
				has_ship_flag = bwm_ancestor_herald_4
				has_hp_percentage < 0.5
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = bwm_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = bwm_ancestor_scout_ftl_cooldown_4
				}
				any_owned_ship = {
					is_ship_size = bwm_apostle_scout
					has_ship_flag = bwm_ancestor_herald_4
				}
			}
			solar_system = {
				save_event_target_as = bwm_ancestor_escape_loc_1_scout_4
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
				}
				if = {
					limit = {
						NOT = {
							any_ship_in_system = {
								is_ship_size = bwm_ancient_weapon
							}
						}
					}
					every_fleet_in_system = {
						limit = {
							exists = owner
							NOT = {
								owner = {
									is_country_type = bwm_ancestor_guardian
								}
							}
						}
						owner = {
							if = {
								limit = {
									is_ai = no
								}
								country_event = { id = bwm_ancestor.53 }
							}
						}
						clear_orders = yes 
						add_modifier = {
							modifier = "bwm_ancestor_pc_herald_debuff"
							days = 30
						}
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:bwm_ancestor_escape_loc_1_scout_4
						use_bypasses = no
						min_jumps = 8
						max_jumps = 120
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
					save_event_target_as = bwm_ancestor_escape_loc_2_scout_4
				}
			}
			set_location = event_target:bwm_ancestor_escape_loc_2_scout_4
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = bwm_apostle_scout
						has_ship_flag = bwm_ancestor_herald_4
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = bwm_ancestor_herald_enraged
							}
						}
						add_modifier = {
							modifier = "bwm_ancestor_herald_enraged"
							days = 30
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = bwm_ancestor_scout_ftl_cooldown_4
				days = 180
			}
		}
	}
}

#Crisis Leviathan Herald 5 special ability

fleet_event = {
	id = bwm_ancestor.16
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = bwm_ancestor_guardian
			}
			NOT = { 
				has_fleet_flag = bwm_ancestor_scout_ftl_cooldown_5
			}
			any_owned_ship = {
				is_ship_size = bwm_apostle_scout
				has_ship_flag = bwm_ancestor_herald_5
				has_hp_percentage < 0.5
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = bwm_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = bwm_ancestor_scout_ftl_cooldown_5
				}
				any_owned_ship = {
					is_ship_size = bwm_apostle_scout
					has_ship_flag = bwm_ancestor_herald_5
				}
			}
			solar_system = {
				save_event_target_as = bwm_ancestor_escape_loc_1_scout_5
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
				}
				if = {
					limit = {
						NOT = {
							any_ship_in_system = {
								is_ship_size = bwm_ancient_weapon
							}
						}
					}
					every_fleet_in_system = {
						limit = {
							exists = owner
							NOT = {
								owner = {
									is_country_type = bwm_ancestor_guardian
								}
							}
						}
						owner = {
							if = {
								limit = {
									is_ai = no
								}
								country_event = { id = bwm_ancestor.53 }
							}
						}
						clear_orders = yes 
						add_modifier = {
							modifier = "bwm_ancestor_pc_herald_debuff"
							days = 30
						}
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:bwm_ancestor_escape_loc_1_scout_5
						use_bypasses = no
						min_jumps = 8
						max_jumps = 120
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
					save_event_target_as = bwm_ancestor_escape_loc_2_scout_5
				}
			}
			set_location = event_target:bwm_ancestor_escape_loc_2_scout_5
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = bwm_apostle_scout
						has_ship_flag = bwm_ancestor_herald_5
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = bwm_ancestor_herald_enraged
							}
						}
						add_modifier = {
							modifier = "bwm_ancestor_herald_enraged"
							days = 30
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = bwm_ancestor_scout_ftl_cooldown_5
				days = 180
			}
		}
	}
}

#Crisis Leviathan Herald 6 special ability

fleet_event = {
	id = bwm_ancestor.17
	hide_window = yes
	
	trigger = {
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = bwm_ancestor_guardian
			}
			NOT = { 
				has_fleet_flag = bwm_ancestor_scout_ftl_cooldown_6
			}
			any_owned_ship = {
				is_ship_size = bwm_apostle_scout
				has_ship_flag = bwm_ancestor_herald_6
				has_hp_percentage < 0.5
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = bwm_ancestor_guardian
				}
				NOT = { 
					has_fleet_flag = bwm_ancestor_scout_ftl_cooldown_6
				}
				any_owned_ship = {
					is_ship_size = bwm_apostle_scout
					has_ship_flag = bwm_ancestor_herald_6
				}
			}
			solar_system = {
				save_event_target_as = bwm_ancestor_escape_loc_1_scout_6
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
				}
				if = {
					limit = {
						NOT = {
							any_ship_in_system = {
								is_ship_size = bwm_ancient_weapon
							}
						}
					}
					every_fleet_in_system = {
						limit = {
							exists = owner
							NOT = {
								owner = {
									is_country_type = bwm_ancestor_guardian
								}
							}
						}
						owner = {
							if = {
								limit = {
									is_ai = no
								}
								country_event = { id = bwm_ancestor.53 }
							}
						}
						clear_orders = yes 
						add_modifier = {
							modifier = "bwm_ancestor_pc_herald_debuff"
							days = 30
						}
					}
				}
			}
			random_rim_system = {
				limit = {
					distance = {
						source = event_target:bwm_ancestor_escape_loc_1_scout_6
						use_bypasses = no
						min_jumps = 8
						max_jumps = 120
					} 
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_5_big = yes
					save_event_target_as = bwm_ancestor_escape_loc_2_scout_6
				}
			}
			set_location = event_target:bwm_ancestor_escape_loc_2_scout_6
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = bwm_apostle_scout
						has_ship_flag = bwm_ancestor_herald_6
					}
					repair_ship = yes
					if = {
						limit = {
							NOT = {
								has_modifier = bwm_ancestor_herald_enraged
							}
						}
						add_modifier = {
							modifier = "bwm_ancestor_herald_enraged"
							days = 30
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = bwm_ancestor_scout_ftl_cooldown_6
				days = 180
			}
		}
	}
}

#Crisis Ship Encounter check

fleet_event = {
	id = bwm_ancestor.19
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_ship = {
			OR = {
				is_ship_size = bwm_apostle_scout
				is_ship_size = bwm_apostle_1
				is_ship_size = bwm_apostle_2
				is_ship_size = bwm_apostle_3
				is_ship_size = bwm_apostle_4
				is_ship_size = bwm_apostle_egg
				is_ship_size = bwm_apostle_child
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					OR = {
						is_ship_size = bwm_apostle_1
						is_ship_size = bwm_apostle_2
						is_ship_size = bwm_apostle_3
						is_ship_size = bwm_apostle_4
						is_ship_size = bwm_apostle_egg
						is_ship_size = bwm_apostle_child
					}
				}
				from = {
					any_ship_in_system = {
						exists = owner
						owner = {
							is_ai = no
							NOT = {
								has_country_flag = bwm_apostle_encounter
							}
						}
					}
				}
			}
			from = {
				every_fleet_in_system = {
					if = {
						limit = {
							owner = {
								is_ai = no
								NOT = {
									has_country_flag = bwm_apostle_encounter
								}
							}
						}
						owner = {
							set_country_flag = bwm_apostle_encounter
						}
					}
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = bwm_ancestor_herald_1
				from = {
					any_ship_in_system = {
						exists = owner
						owner = {
							is_ai = no
							NOT = {
								has_country_flag = bwm_apostle_1_tracker
							}
						}
					}
				}
			}
			from = {
				every_fleet_in_system = {
					if = {
						limit = {
							owner = {
								is_ai = no
							}
						}
						owner = {
							set_country_flag = bwm_apostle_1_tracker
							country_event = { id = bwm_ancestor.52 days = 10 }
						}
					}
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = bwm_ancestor_herald_2
				from = {
					any_ship_in_system = {
						exists = owner
						owner = {
							is_ai = no
							NOT = {
								has_country_flag = bwm_apostle_2_tracker
							}
						}
					}
				}
			}
			from = {
				every_fleet_in_system = {
					if = {
						limit = {
							owner = {
								is_ai = no
							}
						}
						owner = {
							set_country_flag = bwm_apostle_2_tracker
							country_event = { id = bwm_ancestor.52 days = 10 }
						}
					}
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = bwm_ancestor_herald_3
				from = {
					any_ship_in_system = {
						exists = owner
						owner = {
							is_ai = no
							NOT = {
								has_country_flag = bwm_apostle_3_tracker
							}
						}
					}
				}
			}
			from = {
				every_fleet_in_system = {
					if = {
						limit = {
							owner = {
								is_ai = no
							}
						}
						owner = {
							set_country_flag = bwm_apostle_3_tracker
							country_event = { id = bwm_ancestor.52 days = 10 }
						}
					}
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = bwm_ancestor_herald_4
				from = {
					any_ship_in_system = {
						exists = owner
						owner = {
							is_ai = no
							NOT = {
								has_country_flag = bwm_apostle_4_tracker
							}
						}
					}
				}
			}
			from = {
				every_fleet_in_system = {
					if = {
						limit = {
							owner = {
								is_ai = no
							}
						}
						owner = {
							set_country_flag = bwm_apostle_4_tracker
							country_event = { id = bwm_ancestor.52 days = 10 }
						}
					}
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = bwm_ancestor_herald_5
				from = {
					any_ship_in_system = {
						exists = owner
						owner = {
							is_ai = no
							NOT = {
								has_country_flag = bwm_apostle_5_tracker
							}
						}
					}
				}
			}
			from = {
				every_fleet_in_system = {
					if = {
						limit = {
							owner = {
								is_ai = no
							}
						}
						owner = {
							set_country_flag = bwm_apostle_5_tracker
							country_event = { id = bwm_ancestor.52 days = 10 }
						}
					}
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = bwm_ancestor_herald_6
				from = {
					any_ship_in_system = {
						exists = owner
						owner = {
							is_ai = no
							NOT = {
								has_country_flag = bwm_apostle_6_tracker
							}
						}
					}
				}
			}
			from = {
				every_fleet_in_system = {
					if = {
						limit = {
							owner = {
								is_ai = no
							}
						}
						owner = {
							set_country_flag = bwm_apostle_6_tracker
							country_event = { id = bwm_ancestor.52 days = 10 }
						}
					}
				}
			}
		}
	}
}

#Seal bursts

ship_event = {
	id = bwm_ancestor.20
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		is_ship_size = bwm_apostle_seal
	}

	immediate = {
		from = {
			owner = {
				if = {
					limit = {
						NOT = {
							has_country_flag = bwm_ancestor_seal_destroyer
						}
					}
				}
				country_event = { id = bwm_ancestor.41 days = 10 }
				set_country_flag = bwm_ancestor_seal_destroyer
			}
		}
		bwm_ancestor_seal_change_1 = yes
		bwm_ancestor_seal_change_2 = yes
		bwm_ancestor_seal_change_3 = yes
		bwm_ancestor_seal_change_4 = yes
		bwm_ancestor_seal_change_5 = yes
		bwm_ancestor_seal_change_6 = yes
	}
}

#Seal turns into miniature black hole

planet_event = {
	id = bwm_ancestor.21
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_prison_system
			}
			save_event_target_as = bwm_prison_system
			every_system_ambient_object = {
				if = {
					limit = {
						has_ambient_object_flag = bwm_ancestor_seal_1_burst
					}
					this = {
						bwm_effect_explosion_2 = yes
					}
					event_target:bwm_prison_system = {
						every_system_planet = {
							limit = { has_planet_flag = bwm_ancestor_prison_planet_1 }
							#orbital_deposit_tile = {
								clear_deposits = yes
							#}
							#orbital_deposit_tile = {
								add_deposit = d_bwm_seal_exhausted
							#}
							change_pc = pc_black_hole
							bwm_ancestor_clear_station = yes	
						}
					}
					destroy_ambient_object = this
					set_global_flag = bwm_ancestor_seal_1_global
					bwm_ancestor_seal_chain = yes
					break = yes
				}
				if = {
					limit = {
						has_ambient_object_flag = bwm_ancestor_seal_2_burst
					}
					this = {
						bwm_effect_explosion_2 = yes
					}
					event_target:bwm_prison_system = {
						every_system_planet = {
							limit = { has_planet_flag = bwm_ancestor_prison_planet_2 }
							#orbital_deposit_tile = {
								clear_deposits = yes
							#}
							#orbital_deposit_tile = {
								add_deposit = d_bwm_seal_exhausted
							#}
							change_pc = pc_black_hole
							bwm_ancestor_clear_station = yes
						}
					}
					destroy_ambient_object = this
					set_global_flag = bwm_ancestor_seal_2_global
					bwm_ancestor_seal_chain = yes
					break = yes
				}
				if = {
					limit = {
						has_ambient_object_flag = bwm_ancestor_seal_3_burst
					}
					this = {
						bwm_effect_explosion_2 = yes
					}
					event_target:bwm_prison_system = {
						every_system_planet = {
							limit = { has_planet_flag = bwm_ancestor_prison_planet_3 }
							#orbital_deposit_tile = {
								clear_deposits = yes
							#}
							#orbital_deposit_tile = {
								add_deposit = d_bwm_seal_exhausted
							#}
							change_pc = pc_black_hole
							bwm_ancestor_clear_station = yes
						}
					}
					destroy_ambient_object = this
					set_global_flag = bwm_ancestor_seal_3_global
					bwm_ancestor_seal_chain = yes
					break = yes
				}
				if = {
					limit = {
						has_ambient_object_flag = bwm_ancestor_seal_4_burst
					}
					this = {
						bwm_effect_explosion_2 = yes
					}
					event_target:bwm_prison_system = {
						every_system_planet = {
							limit = { has_planet_flag = bwm_ancestor_prison_planet_4 }
							#orbital_deposit_tile = {
								clear_deposits = yes
							#}
							#orbital_deposit_tile = {
								add_deposit = d_bwm_seal_exhausted
							#}
							change_pc = pc_black_hole
							bwm_ancestor_clear_station = yes
						}
					}
					destroy_ambient_object = this
					set_global_flag = bwm_ancestor_seal_4_global
					bwm_ancestor_seal_chain = yes
					break = yes
				}
				if = {
					limit = {
						has_ambient_object_flag = bwm_ancestor_seal_5_burst
					}
					this = {
						bwm_effect_explosion_2 = yes
					}
					event_target:bwm_prison_system = {
						every_system_planet = {
							limit = { has_planet_flag = bwm_ancestor_prison_planet_5 }
							#orbital_deposit_tile = {
								clear_deposits = yes
							#}
							#orbital_deposit_tile = {
								add_deposit = d_bwm_seal_exhausted
							#}
							change_pc = pc_black_hole
							bwm_ancestor_clear_station = yes
						}
					}
					destroy_ambient_object = this
					set_global_flag = bwm_ancestor_seal_5_global
					bwm_ancestor_seal_chain = yes
					break = yes
				}
				if = {
					limit = {
						has_ambient_object_flag = bwm_ancestor_seal_6_burst
					}
					this = {
						bwm_effect_explosion_2 = yes
					}
					event_target:bwm_prison_system = {
						every_system_planet = {
							limit = { has_planet_flag = bwm_ancestor_prison_planet_6 }
							#orbital_deposit_tile = {
								clear_deposits = yes
							#}
							#orbital_deposit_tile = {
								add_deposit = d_bwm_seal_exhausted
							#}
							change_pc = pc_black_hole
							bwm_ancestor_clear_station = yes
						}
					}
					destroy_ambient_object = this
					set_global_flag = bwm_ancestor_seal_6_global
					bwm_ancestor_seal_chain = yes
					break = yes
				}
			}
		}
	}
}

# Tesseract init

country_event = {
	id = bwm_ancestor.22
	hide_window = yes
	fire_only_once = yes
	
	trigger = {
		AND = {
			has_global_flag = bwm_ancestor_seal_1_global
			has_global_flag = bwm_ancestor_seal_2_global
			has_global_flag = bwm_ancestor_seal_3_global
			has_global_flag = bwm_ancestor_seal_4_global
			has_global_flag = bwm_ancestor_seal_5_global
			has_global_flag = bwm_ancestor_seal_6_global
		}
	}

	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_prison_system
			}
			save_event_target_as = bwm_prison_system_local
			every_system_ambient_object = { 
				limit = {
					has_ambient_object_flag = bwm_ancestor_prison_ambient
				}
				this = {
				 save_event_target_as = bwm_ancestor_prison_failure_1
				}
				create_ambient_object = {
					type = "bwm_prison_weakened_1_object"
				}
				last_created_ambient_object = {
					set_location = event_target:bwm_ancestor_prison_failure_1
					set_ambient_object_flag = bwm_ancestor_prison_weakened_1
				}
				create_ambient_object = {
					type = bwm_effect_explosion_2_object
					duration = 10
					
					use_3d_location = yes
					
					entity_offset = { min = 0 max = 0 }
					entity_offset_angle = { min = 0 max = 0 }
					entity_offset_height = { min = 0 max = 0 }
					
					entity_scale_to_size = yes
					scale = 100
				}
				last_created_ambient_object = {
					set_location = event_target:bwm_ancestor_prison_failure_1
				}
				destroy_ambient_object = this
			}
			every_system_planet = {
				limit = {
					has_planet_flag = bwm_ancestor_prison_star 
				}
				#orbital_deposit_tile = {
					add_deposit = d_bwm_prison_1
				#}
			}
		}
		every_country = {
			limit = {
				is_ai = no
				has_country_flag = bwm_ancestor_seal_destroyer
			}
			country_event = { id = bwm_ancestor.42 days = 10 }
		}
		country_event = { id = bwm_ancestor.23 days = 1800 }
	}
}

# Tesseract Stage 2

country_event = {
	id = bwm_ancestor.23
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_prison_system
			}
			every_system_ambient_object = { 
				limit = {
					has_ambient_object_flag = bwm_ancestor_prison_weakened_1
				}
				this = {
				 save_event_target_as = bwm_ancestor_prison_failure_2
				}
				create_ambient_object = {
					type = "bwm_prison_weakened_2_object"
				}
				last_created_ambient_object = {
					set_location = event_target:bwm_ancestor_prison_failure_2
					set_ambient_object_flag = bwm_ancestor_prison_weakened_2
				}
				create_ambient_object = {
					type = bwm_effect_explosion_2_object
					duration = 10
					
					use_3d_location = yes
					
					entity_offset = { min = 0 max = 0 }
					entity_offset_angle = { min = 0 max = 0 }
					entity_offset_height = { min = 0 max = 0 }
					
					entity_scale_to_size = yes
					scale = 100
				}
				last_created_ambient_object = {
					set_location = event_target:bwm_ancestor_prison_failure_2
				}
				destroy_ambient_object = this
			}
			every_system_planet = {
				limit = {
					has_planet_flag = bwm_ancestor_prison_star 
				}
				#orbital_deposit_tile = {
					clear_deposits = yes
				#}
				#orbital_deposit_tile = {
					add_deposit = d_bwm_prison_2
				#}
				bwm_ancestor_clear_station = yes
			}
		}
		country_event = { id = bwm_ancestor.24 days = 1800 }
	}
}

# Tesseract Stage 3

country_event = {
	id = bwm_ancestor.24
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_prison_system
			}
			every_system_ambient_object = { 
				limit = {
					has_ambient_object_flag = bwm_ancestor_prison_weakened_2
				}
				this = {
				 save_event_target_as = bwm_ancestor_prison_failure_3
				}
				create_ambient_object = {
					type = "bwm_prison_damaged_object"
				}
				last_created_ambient_object = {
					set_location = event_target:bwm_ancestor_prison_failure_3
					set_ambient_object_flag = bwm_ancestor_prison_weakened_3
				}
				create_ambient_object = {
					type = bwm_effect_explosion_2_object
					duration = 10
					
					use_3d_location = yes
					
					entity_offset = { min = 0 max = 0 }
					entity_offset_angle = { min = 0 max = 0 }
					entity_offset_height = { min = 0 max = 0 }
					
					entity_scale_to_size = yes
					scale = 100
				}
				last_created_ambient_object = {
					set_location = event_target:bwm_ancestor_prison_failure_3
				}
				destroy_ambient_object = this
			}
			every_system_planet = {
				limit = {
					has_planet_flag = bwm_ancestor_prison_star 
				}
				#orbital_deposit_tile = {
					clear_deposits = yes
				#}
				#orbital_deposit_tile = {
					add_deposit = d_bwm_prison_3
				#}
				bwm_ancestor_clear_station = yes
			}
		}
		country_event = { id = bwm_ancestor.25 days = 1800 }
	}
}

# Massive black hole appears.

country_event = {
	id = bwm_ancestor.25
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_prison_system
			}
			save_event_target_as = bwm_prison_system_local
			every_system_ambient_object = { 
				limit = {
					has_ambient_object_flag = bwm_ancestor_prison_weakened_3
				}
				destroy_ambient_object = this
			}
			every_system_planet = {
				limit = {
					has_planet_flag = bwm_ancestor_prison_star
				}
				change_pc = pc_black_hole
				change_planet_size = 100
				#orbital_deposit_tile = {
					clear_deposits = yes
				#}
				#orbital_deposit_tile = {
					add_deposit = d_bwm_prison_exhausted
				#}
				bwm_effect_explosion_6_big = yes
				bwm_ancestor_clear_station = yes
			}
			every_system_planet = {
				limit = {
					OR = {
						has_planet_flag = bwm_ancestor_prison_planet_1
						has_planet_flag = bwm_ancestor_prison_planet_2
						has_planet_flag = bwm_ancestor_prison_planet_3
						has_planet_flag = bwm_ancestor_prison_planet_4
						has_planet_flag = bwm_ancestor_prison_planet_5
						has_planet_flag = bwm_ancestor_prison_planet_6
					}
				}
				bwm_ancestor_clear_station = yes
				remove_planet = yes 
			}
			every_fleet_in_system = {
				destroy_fleet = this
			}
		}
		every_country = {
			limit = {
				is_ai = no
				has_country_flag = bwm_ancestor_seal_destroyer
			}
			country_event = { id = bwm_ancestor.43 days = 10 }
		}
		country_event = { id = bwm_ancestor.27 days = 360 }
	}
}

#Crisis Init

country_event = {
	id = bwm_ancestor.27
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes
	
	trigger = {
		NOT = {
			has_global_flag = bwm_ancestor_crisis_start
		}
	}
	
	immediate =  {
		bwm_ancestor_target = yes
		random_system = {
			limit = {
				has_star_flag = bwm_prison_system
			}
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_ancestor_prison_star
				}
				create_country = {
					name = "Chosen of Thesan"
					type = bwm_ancestor_guardian
					flag = {
						icon = {
							category = "ornate"
							file = "flag_ornate_23.dds"
						}
						background= {
							category = "backgrounds"
							file = "00_solid.dds"
						}
						 colors={
							"pink"
							"pink"
							"null"
							"null"
						}
					}
				}
				last_created_country = {
					if = {
						limit = {
							NOT = {
								has_modifier = bwm_ancestor_power
							}
						}
						add_modifier = {
							modifier = bwm_ancestor_power
							days = -1
						}
					}
					add_modifier = {
						modifier = bwm_ancestor_escape_power
						days = 90
					}
					save_global_event_target_as = bwm_ancestor_country
					set_country_flag = bwm_ancestor_country
					set_graphical_culture = fallen_empire_01
					#guardian_difficulty = yes
				}
				bwm_effect_explosion_6_big = yes
				event_target:bwm_ancestor_escape = {
					change_pc = pc_black_hole
					solar_system = {
						if = {
							limit = {
								exists = space_owner
								space_owner = {
									fleet_power > 1000000
									NOT = {
										is_country_type = bwm_ancestor_guardian
									}
								}
							}
							space_owner = {
								add_modifier = {
									modifier = "bwm_ancestor_ai_debuff"
									days = 90
								}
							}
						}
						every_fleet_in_system = {
							if = {
								limit = {
									exists = this
									NOT = {
										owner = {
											is_country_type = bwm_ancestor_guardian
										}
									}
								}
								add_modifier = {
									modifier = "bwm_ancestor_ai_fleet_debuff"
									days = 90
								}
							}
						}
					}
				}
				bwm_ancestor_vessel_init = yes
				bwm_ancestor_herald_1 = yes
				bwm_ancestor_herald_2 = yes
				bwm_ancestor_herald_3 = yes
				bwm_ancestor_herald_4 = yes
				bwm_ancestor_herald_5 = yes
				bwm_ancestor_herald_6 = yes
			}
		}
		if = {
			limit = {
				any_country = {
					has_country_flag = bwm_ancestor_seal_destroyer
				}
			}
			every_country = {
				limit = {
					has_country_flag = bwm_ancestor_seal_destroyer
				}
				save_event_target_as = bwm_ancestor_seal_destroyer_target
			}
			every_country = {
				limit = {
					NOT = {
						is_country = event_target:bwm_ancestor_seal_destroyer_target
					}
					OR = {
						is_country_type = default
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
				}
				add_opinion_modifier = {
					modifier = opinion_doomed_us_all
					who = event_target:bwm_ancestor_seal_destroyer_target
				}
			}
		}
		every_country = {
			if = {
				limit = {
					is_ai = no
				}
				country_event = { id = bwm_ancestor.44 }
				establish_communications_no_message = event_target:bwm_ancestor_country
			}
			if = {
				limit = {
					OR = {
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
				}
				country_event = { id = bwm_ancestor.28 days = 30 }
			}
		}
		set_global_flag = bwm_ancestor_crisis_start
	}
}

#Fallen and Awakened Empires declare war on the seal destroyer.

country_event = {
	id = bwm_ancestor.28
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				is_country_type = fallen_empire
				NOT = {
					has_ethic = ethic_gestalt_consciousness 
				}
			}
			country_event = { id = bwm_ancestor.29 }
		}
		if = {
			limit = {
				any_country = {
					has_country_flag = bwm_ancestor_seal_destroyer
				}
			}
			this = {
				save_event_target_as = bwm_ancestor_fallen
			}
			every_country = {
				limit = {
					has_country_flag = bwm_ancestor_seal_destroyer
				}
				save_event_target_as = bwm_ancestor_sealing_war_target
			}
			if = {
				limit = {
					NOT = {
						has_communications = event_target:bwm_ancestor_sealing_war_target
					}
				}
				establish_communications_no_message = event_target:bwm_ancestor_sealing_war_target
			}
			if = {
				limit = {
					NOT = {
						is_at_war_with = event_target:bwm_ancestor_sealing_war_target
					}
				}
				add_casus_belli = {
					type = bwm_cb_seal_breaker 
					who = event_target:bwm_ancestor_sealing_war_target
					days = 720
				}
				declare_war = {
					target = event_target:bwm_ancestor_sealing_war_target
					#major_war = yes
					name = "War of Sealing"
					attacker_war_goal = bwm_wg_seal_breaker 
				}
				event_target:bwm_ancestor_sealing_war_target = {
					country_event = { id = bwm_ancestor.49 }
				}
			}
		}
	}
}

#Forced awakening at start of crisis

country_event = {
	id = bwm_ancestor.29
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		set_country_type = awakened_fallen_empire
		change_government = {
			civics = {
				civic = civic_revanchist_fervor
				civic = civic_ancient_caches_of_technology
			}
		}
		add_resource = {
			minerals = 20000
			energy = 10000
			influence = 1000
		}
		
		every_country = {
			limit = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}		
				NOT = { has_communications = root }
			}
			establish_communications_no_message = root	
			root = { save_event_target_as = contact_empire }
			country_event = { id = action.1 }				
		}
	}
}

#Seal Chain Reaction

country_event = {
	id = bwm_ancestor.30
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NAND = {
			has_global_flag = bwm_ancestor_seal_1_global
			has_global_flag = bwm_ancestor_seal_2_global
			has_global_flag = bwm_ancestor_seal_3_global
			has_global_flag = bwm_ancestor_seal_4_global
			has_global_flag = bwm_ancestor_seal_5_global
			has_global_flag = bwm_ancestor_seal_6_global
		}
	}

	immediate = {
		every_country = { 
			if = {
				limit = {
					has_country_flag = bwm_prison_country
				}
				every_owned_ship = {
					bwm_ancestor_seal_change_1 = yes
					bwm_ancestor_seal_change_2 = yes
					bwm_ancestor_seal_change_3 = yes
					bwm_ancestor_seal_change_4 = yes
					bwm_ancestor_seal_change_5 = yes
					bwm_ancestor_seal_change_6 = yes
				}
			}
		}		
	}
}

#Keep AI out of the Vanth System

fleet_event = {
	id = bwm_ancestor.31
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = bwm_ancestor_black_hole
		owner = {
			is_ai = yes
		}
		FROM = {
			has_star_flag = bwm_prison_system
		}
	}
	
	immediate = {
		owner = {
			save_event_target_as = bwm_prison_survey
		}
		FROM = {
			save_event_target_as = bwm_ancestor_bounce_1_loc
			every_system_planet = {
				set_surveyed = {
					surveyed = yes
					surveyor = event_target:bwm_prison_survey
				}
			}
		}
		random_system = {
			limit = {
				distance = {
					source = event_target:bwm_ancestor_bounce_1_loc
					use_bypasses = no
					min_jumps = 8
					max_jumps = 120
				} 
			}
			random_system_planet = {
				limit = {
					is_star = yes
				}
				save_event_target_as = bwm_ancestor_bounce_2_loc
			}
		}
		set_location = event_target:bwm_ancestor_bounce_2_loc
		clear_orders = yes 
	}		
}

# Entering system

ship_event = {
	id = bwm_ancestor.40
	title = "bwm_ancestor.40"
	desc = "bwm_ancestor.40.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_mystic_reveal_light
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		NOR = {
			has_global_flag = bwm_ancestor_seal_1_global
			has_global_flag = bwm_ancestor_seal_2_global
			has_global_flag = bwm_ancestor_seal_3_global
			has_global_flag = bwm_ancestor_seal_4_global
			has_global_flag = bwm_ancestor_seal_5_global
			has_global_flag = bwm_ancestor_seal_6_global
			has_global_flag = bwm_ancestor_crisis_start
		}
		owner = {
			NOT = {
				has_country_flag = bwm_ancestor_seal_destroyer
				has_country_flag = encountered_bwm_prison 
			}
			is_ai = no
		}
		FROM = {
			has_star_flag = bwm_prison_system
			any_ship_in_system = { 
				AND = {
					is_ship_size = bwm_apostle_seal
					owner = { is_country_type = bwm_prison_passive }
				}
			}
		}
	}
	
	immediate = {
		from = {
			save_event_target_as = bwm_prison_loc
		}
		owner = {
			establish_communications_no_message = event_target:bwm_prison_country_1
			establish_communications_no_message = event_target:bwm_prison_country_2
			establish_communications_no_message = event_target:bwm_prison_country_3
			establish_communications_no_message = event_target:bwm_prison_country_4
			establish_communications_no_message = event_target:bwm_prison_country_5
			establish_communications_no_message = event_target:bwm_prison_country_6
			set_country_flag = encountered_bwm_prison
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_prison_chain" 
				}
				end_event_chain = "bwm_lex_prison_chain"
			}
		}
	}	
	
	option = {
		name =  CURIOUS
		custom_tooltip = bwm_ancestor.40.a.tooltip
	}
}

# Notification - seal busted

country_event = {
	id = bwm_ancestor.41
	title = "bwm_ancestor.41"
	desc = "bwm_ancestor.41.desc"
	picture = GFX_evt_star_pulsar
	
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = bwm_ancestor_seal_destroyer
		NOT = {
			has_country_flag = bwm_ancestor_seal_notification
		}
	}
	
	immediate = {
		set_country_flag = bwm_ancestor_seal_notification
	}
	
	option = {
		name = "bwm_ancestor.41.a"
	}
}

# Notification - tesseract breaks down

country_event = {
	id = bwm_ancestor.42
	title = "bwm_ancestor.42"
	desc = "bwm_ancestor.42.desc"
	picture = GFX_evt_physics_research
	location = event_target:bwm_prison_system_local
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_ancestor_prison_notification
		}
	}
	
	immediate = {
		set_country_flag = bwm_ancestor_prison_notification
	}
	
	option = {
		name = "bwm_ancestor.42.a"
	}
}

# Notification - tesseract explodes

country_event = {
	id = bwm_ancestor.43
	title = "bwm_ancestor.43"
	desc = "bwm_ancestor.43.desc"
	picture = GFX_evt_black_hole
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_ancestor_explosion_notification
		}
	}
	
	immediate = {
		set_country_flag = bwm_ancestor_explosion_notification
	}
	
	option = {
		name = "bwm_ancestor.43.a"
	}
}

# Notification - Leviathan appears

country_event = {
	id = bwm_ancestor.44
	title = "bwm_ancestor.44"
	desc = "bwm_ancestor.44.desc"
	picture = GFX_evt_wormhole
	show_sound = event_red_alert
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_ancestor_crisis_notification
		}
	}
	
	immediate = {
		set_country_flag = bwm_ancestor_crisis_notification
	}
	
	option = {
		name = "bwm_ancestor.44.a"
		begin_event_chain = {
			event_chain = "bwm_lex_ancestor_chain"
			target = ROOT
		}
	}
}

# Notification - Leviathan evolves

country_event = {
	id = bwm_ancestor.45
	title = "bwm_ancestor.45"
	desc = "bwm_ancestor.45.desc"
	picture = GFX_evt_unspeakable_horror
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_ancestor_boss_evolution_notification
		}
	}
	
	immediate = {
		set_country_flag = bwm_ancestor_boss_evolution_notification
	}
	
	option = {
		name = "bwm_ancestor.45.a"
	}
}

# Notification - Leviathan gives birth

country_event = {
	id = bwm_ancestor.46
	title = "bwm_ancestor.46"
	desc = "bwm_ancestor.46.desc"
	picture = GFX_evt_psionics
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_ancestor_boss_birth_notification
		}
	}
	
	immediate = {
		set_country_flag = bwm_ancestor_boss_birth_notification
	}
	
	option = {
		name = "bwm_ancestor.46.a"
	}
}

# Notification - Crisis harvest

country_event = {
	id = bwm_ancestor.47
	title = "bwm_ancestor.47"
	desc = "bwm_ancestor.47.desc"
	picture = GFX_evt_nuclear_explosion
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_ancestor_genocide_notification
		}
	}
	
	immediate = {
		set_country_flag = bwm_ancestor_genocide_notification
	}
	
	option = {
		name = "bwm_ancestor.47.a"
	}
}

# Notification - World reclaimed

country_event = {
	id = bwm_ancestor.48
	title = "bwm_ancestor.48"
	desc = "bwm_ancestor.48.desc"
	picture = GFX_evt_nuclear_explosion
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_ancestor_world_bombed
		}
	}
	
	immediate = {
		set_country_flag = bwm_ancestor_world_bombed
	}
	
	option = {
		name = "bwm_ancestor.48.a"
	}
}

# Diplomacy Window War Declaration

country_event = {
	id = bwm_ancestor.49
	title = "bwm_ancestor.49"
	desc = "bwm_ancestor.49.desc"
	picture = GFX_evt_nuclear_explosion
	
	is_triggered_only = yes
	
	diplomatic = yes
	
	trigger = {
		NOT = {
			has_global_flag = bwm_ancestor_sealing_war
		}
	}

	picture_event_data = {
		portrait = event_target:bwm_ancestor_fallen
		planet_background = event_target:bwm_ancestor_fallen
		graphical_culture = event_target:bwm_ancestor_fallen
		city_level = event_target:bwm_ancestor_fallen
		room = event_target:bwm_ancestor_fallen
	}

	immediate = {
		set_global_flag = bwm_ancestor_sealing_war
	}
	
	option = {
		name = "bwm_ancestor.49.a"
		response_text = "bwm_ancestor.49.a.response"
	}
}

# Crisis ends with the death of the Leviathan.

country_event = {
	id = bwm_ancestor.50
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_ancestor_guardian
		has_country_flag = bwm_ancestor_country
		FROMFROM = { 
			OR = {
				is_ship_size = bwm_apostle_1
				is_ship_size = bwm_apostle_2
				is_ship_size = bwm_apostle_3
				is_ship_size = bwm_apostle_egg
				is_ship_size = bwm_apostle_child
			}	
		}
	}
	
	immediate = {
		if = {
			limit = {
				has_global_flag = bwm_ancestor_crisis_start
				NOT = {
					has_global_flag = bwm_ancestor_crisis_end
				}
			}
			remove_global_flag = bwm_ancestor_crisis_start
			set_global_flag = bwm_ancestor_crisis_end
		}
		if = {
			limit = {
				has_modifier = bwm_ancestor_power
			}
			remove_modifier = "bwm_ancestor_power"
		}
		FROMFROM = {
			create_ambient_object = {
				type = bwm_effect_explosion_8_object
				location = THIS
				duration = 10
				
				use_3d_location = yes
				
				entity_offset = { min = 0 max = 0 }
				entity_offset_angle = { min = 0 max = 0 }
				entity_offset_height = { min = 0 max = 0 }
				
				entity_scale_to_size = yes
				scale = 100
			}
		}
		FROM = {
			country_event = { id = bwm_ancestor.51 }
			set_country_flag = bwm_ancestor_slayer
		}
		every_galaxy_planet = {
			if ={
				limit = {
					has_planet_flag = bwm_ancestor_world
				}
				every_deposit = {
					limit = { is_deposit_type = "tb_bwm_nature" }
					clear_blocker = yes
				}
			}
		}
		every_country = {
			if = {
				limit = { 
					has_modifier = bwm_ancestor_weakness
				}
				remove_modifier = "bwm_ancestor_weakness"
			}
			if = {
				limit = {
					has_special_project = bwm_ANCESTOR_WEAKNESS_PROJECT
				}
				abort_special_project = {
					type = "bwm_ANCESTOR_WEAKNESS_PROJECT"
					location = capital_scope
				}
			}
			if = {
				limit = {
					has_event_chain = "bwm_lex_ancestor_chain" 
				}
				end_event_chain = "bwm_lex_ancestor_chain"
			}
		}
		add_threat = {
			who = FROM
			amount = 10
		}
	}
}

#Crisis end notification.

country_event = {
	id = bwm_ancestor.51
	title = "bwm_ancestor.51"
	desc = "bwm_ancestor.51.desc"
	picture = GFX_evt_small_space_battle
	
	is_triggered_only = yes
	
	option = {
		name = "bwm_ancestor.51.a"
	}
}

#Herald POI

country_event = {
	id = bwm_ancestor.52
	title = "bwm_ancestor.52"
	desc = "bwm_ancestor.52.desc"
	picture = GFX_evt_satellite_in_orbit
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_ancestor_herald_tracker_notify
		}
	}
	
	immediate = {
		set_country_flag = bwm_ancestor_herald_tracker_notify
	}
	
	option = {
		name = "EXCELLENT"
	}
}

#Leviathan special ability notification

country_event = {
	id = bwm_ancestor.53
	title = "bwm_ancestor.53"
	desc = "bwm_ancestor.53.desc"
	picture = GFX_evt_unknown_ships
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_ancestor_special_ability_notify
		}
	}
	
	immediate = {
		set_timed_country_flag = {
			flag = bwm_ancestor_special_ability_notify
			days = 30
		}
	}
	
	option = {
		name = "CURSES"
	}
}

#Crisis research init

country_event = {
	id = bwm_ancestor.60
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = bwm_ancestor_guardian
		
		from = {
			NOT = {
				has_country_flag = bwm_ancestor_weakness_check
			}
			has_country_flag = bwm_apostle_encounter
			is_ai = no
	
			AND = {
				OR = {
					has_technology = "tech_ship_armor_5"
					has_technology = "tech_dragon_armor"
					has_technology = "tech_bwm_lex_armor"
				}
				OR = {
					has_technology = "tech_shields_5"
					has_technology = "tech_psionic_shield"
					#has_technology = "tech_enigmatic_deflector"
					has_technology = "tech_bwm_lex_shield"
				}		
				OR = {
					has_technology = "tech_zero_point_power"
					#has_technology = "tech_enigmatic_power_core"
					has_technology = "tech_bwm_lex_power"
				}
				OR = {
					has_technology = "tech_energy_lance_2"
					has_technology = "tech_arc_emitter_2"
					has_technology = "tech_mass_accelerator_2"
				}
			}
		}
	}

	immediate = {
		random_list = {
			50 = {
				if = {
					limit = {
						check_variable = {
							which = "bwm_ancestor_kill_counter"
							value < 1
						}
					}
					set_variable = {
						which = "bwm_ancestor_kill_counter"
						value = 1
					}
				}
				else = {
					change_variable = {
						which = "bwm_ancestor_kill_counter"
						value = 1
					}
					if = {
						limit ={
							check_variable = {
								which = "bwm_ancestor_kill_counter"
								value > 5
							}
						}
						set_variable = {
							which = "bwm_ancestor_kill_counter"
							value = 5
						}
					}
					if = {
						limit = {
							AND = {
								check_variable = {
									which = "bwm_ancestor_kill_counter"
									value = 5
								}
							}
						}
						from = {
							set_country_flag = bwm_ancestor_weakness_check
							country_event = { id = bwm_ancestor.61 days = 30 }
						}
					}
				}
			}
			50 = {
			}
		}
	}
}

#Crisis research project

country_event = {
	id = bwm_ancestor.61
	title = "bwm_ancestor.61"
	desc = "bwm_ancestor.61.desc"
	picture = GFX_evt_exploding_ship
	is_triggered_only = yes

	trigger = {
		NOT = {
			any_country = {
				has_country_flag = bwm_ancestor_slayer
			}
			has_country_flag = bwm_ancestor_weakness_researched 
		}
	}

	option = {
		name = bwm_ancestor.61.a
		allow = {
			hidden_trigger = {
				NOT = { has_modifier = bwm_ancestor_weakness }
			}
		}
		hidden_effect = { set_country_flag = bwm_ancestor_weakness_researched }
		capital_scope = { save_event_target_as = bwm_pc_home }
		enable_special_project = {
			name = "bwm_ANCESTOR_WEAKNESS_PROJECT"
			location = event_target:bwm_pc_home
			owner = ROOT
		}
	}	
	option = {
		name = bwm_ancestor.61.b
		add_resource = { influence = 100 }
	}
}

#Crisis research project complete

country_event = {
	id = bwm_ancestor.62
	title = "bwm_ancestor.62"
	desc = "bwm_ancestor.62.desc"
	picture = GFX_evt_physics_research
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_modifier = bwm_ancestor_weakness
		}
	}

	option = {
		name = bwm_ancestor.62.a
		add_modifier = {
			modifier = bwm_ancestor_weakness
			days = -1
		}
	}
}

#Crisis Herald 1 destruction

country_event = {
	id = bwm_ancestor.70
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = bwm_ancestor_guardian
		has_country_flag = bwm_ancestor_country
		FROMFROM = {
			has_ship_flag = bwm_ancestor_herald_1
			is_ship_size = bwm_apostle_scout
		}
	}

	immediate = {
		FROMFROM = {
			bwm_effect_explosion_8 = yes
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_ancestor_chain" 
				}
				remove_point_of_interest = bwm_ancestor_herald_poi.1
				add_event_chain_counter = { 
					event_chain = "bwm_lex_ancestor_chain" 
					counter = "bwm_ancestor_herald_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_ancestor_guardian
				}
				add_modifier = {
					modifier = "bwm_ancestor_herald_debuff_1"
					days = -1
				}
			}
		}
	}
}

#Crisis Herald 2 destruction

country_event = {
	id = bwm_ancestor.71
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = bwm_ancestor_guardian
		has_country_flag = bwm_ancestor_country
		FROMFROM = {
			has_ship_flag = bwm_ancestor_herald_2
			is_ship_size = bwm_apostle_scout
		}
	}

	immediate = {
		FROMFROM = {
			bwm_effect_explosion_8 = yes
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_ancestor_chain" 
				}
				remove_point_of_interest = bwm_ancestor_herald_poi.2
				add_event_chain_counter = { 
					event_chain = "bwm_lex_ancestor_chain" 
					counter = "bwm_ancestor_herald_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_ancestor_guardian
				}
				add_modifier = {
					modifier = "bwm_ancestor_herald_debuff_2"
					days = -1
				}
			}
		}
	}
}

#Crisis Herald 3 destruction

country_event = {
	id = bwm_ancestor.72
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = bwm_ancestor_guardian
		has_country_flag = bwm_ancestor_country
		FROMFROM = {
			has_ship_flag = bwm_ancestor_herald_3
			is_ship_size = bwm_apostle_scout
		}
	}

	immediate = {
		FROMFROM = {
			bwm_effect_explosion_8 = yes
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_ancestor_chain" 
				}
				remove_point_of_interest = bwm_ancestor_herald_poi.3
				add_event_chain_counter = { 
					event_chain = "bwm_lex_ancestor_chain" 
					counter = "bwm_ancestor_herald_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_ancestor_guardian
				}
				add_modifier = {
					modifier = "bwm_ancestor_herald_debuff_3"
					days = -1
				}
			}
		}
	}
}

#Crisis Herald 4 destruction

country_event = {
	id = bwm_ancestor.73
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = bwm_ancestor_guardian
		has_country_flag = bwm_ancestor_country
		FROMFROM = {
			has_ship_flag = bwm_ancestor_herald_4
			is_ship_size = bwm_apostle_scout
		}
	}

	immediate = {
		FROMFROM = {
			bwm_effect_explosion_8 = yes
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_ancestor_chain" 
				}
				remove_point_of_interest = bwm_ancestor_herald_poi.4
				add_event_chain_counter = { 
					event_chain = "bwm_lex_ancestor_chain" 
					counter = "bwm_ancestor_herald_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_ancestor_guardian
				}
				add_modifier = {
					modifier = "bwm_ancestor_herald_debuff_4"
					days = -1
				}
			}
		}
	}
}

#Crisis Herald 5 destruction

country_event = {
	id = bwm_ancestor.74
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = bwm_ancestor_guardian
		has_country_flag = bwm_ancestor_country
		FROMFROM = {
			has_ship_flag = bwm_ancestor_herald_5
			is_ship_size = bwm_apostle_scout
		}
	}

	immediate = {
		FROMFROM = {
			bwm_effect_explosion_8 = yes
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_ancestor_chain" 
				}
				remove_point_of_interest = bwm_ancestor_herald_poi.5
				add_event_chain_counter = { 
					event_chain = "bwm_lex_ancestor_chain" 
					counter = "bwm_ancestor_herald_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_ancestor_guardian
				}
				add_modifier = {
					modifier = "bwm_ancestor_herald_debuff_5"
					days = -1
				}
			}
		}
	}
}

#Crisis Herald 6 destruction

country_event = {
	id = bwm_ancestor.75
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = bwm_ancestor_guardian
		has_country_flag = bwm_ancestor_country
		FROMFROM = {
			has_ship_flag = bwm_ancestor_herald_6
			is_ship_size = bwm_apostle_scout
		}
	}

	immediate = {
		FROMFROM = {
			bwm_effect_explosion_8 = yes
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_ancestor_chain" 
				}
				remove_point_of_interest = bwm_ancestor_herald_poi.6
				add_event_chain_counter = { 
					event_chain = "bwm_lex_ancestor_chain" 
					counter = "bwm_ancestor_herald_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_ancestor_guardian
				}
				add_modifier = {
					modifier = "bwm_ancestor_herald_debuff_6"
					days = -1
				}
			}
		}
	}
}

# World Terraformed (HIDDEN)

planet_event = {
	id = bwm_ancestor.200
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			limit = { has_event_chain = "bwm_lex_ancestor_chain" }
			add_event_chain_counter = {
				event_chain = "bwm_lex_ancestor_chain"
				counter = "bwm_ancestor_worlds"
				amount = 1 
			}
		}
	}
}

# Thesan World Cleansed (HIDDEN)

planet_event = {
	id = bwm_ancestor.201
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			limit = { has_event_chain = "bwm_lex_ancestor_chain" }
			add_event_chain_counter = {
				event_chain = "bwm_lex_ancestor_chain"
				counter = "bwm_ancestor_worlds"
				amount = -1 
			}
			add_event_chain_counter = {
				event_chain = "bwm_lex_ancestor_chain"
				counter = "bwm_ancestor_worlds_cleansed"
				amount = 1 
			}
		}
	}
}

# Thesan Kill Count (HIDDEN)

country_event = {
	id = bwm_ancestor.202
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_ancestor_guardian
		NOT = {
			FROM = {
				is_country_type = bwm_shroud_guardian
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				FROM = {
					has_event_chain = "bwm_lex_ancestor_chain" 
				}
			}
			FROM = {
				add_event_chain_counter = { 
					event_chain = "bwm_lex_ancestor_chain" 
					counter = "bwm_ancestor_kills_us" 
					amount = 1 
				}
			}
		}
		every_country = {
			limit = { 
				has_event_chain = "bwm_lex_ancestor_chain" 
				NOT = {
					is_same_value = FROM 
				}
			}
			add_event_chain_counter = { 
				event_chain = "bwm_lex_ancestor_chain" 
				counter = "bwm_ancestor_kills_others" 
				amount = 1 
			}
		}
	}
}

# Thesan Victims (HIDDEN)

country_event = {
	id = bwm_ancestor.203
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_ancestor_guardian
	}
	
	immediate = {
		every_country = {
			limit = {
				has_event_chain = "bwm_lex_ancestor_chain"
			}
			add_event_chain_counter = { 
				event_chain = "bwm_lex_ancestor_chain" 
				counter = "bwm_ancestor_victims" 
				amount = 1 
			}
		}
	}
}
