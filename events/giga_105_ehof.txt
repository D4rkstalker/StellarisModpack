namespace = ehof_megastructure

#########################################################################################################
############################################ EHOF On Actions ############################################
#########################################################################################################
# Ship is built in the EHOF system [on_ship_built]
ship_event = {
    id = ehof_megastructure.001
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = owner
		exists = solar_system
		owner = { is_same_value = solar_system.starbase.owner }
		solar_system = { has_star_flag = ehof_megastructure_system@root.owner }
		fleet = { can_use_ehof = yes }
	}

	immediate = {
		if = {
			limit = { NOT = { has_ship_flag = ehof_already_counted } }
			if = { limit = { is_ship_size = science }						owner = { change_variable = { which = ehof_pre_flight_science value = 1 } } }
			if = { limit = { is_ship_size = constructor }					owner = { change_variable = { which = ehof_pre_flight_constructor value = 1 } } }
			if = { limit = { is_ship_class = shipclass_military }			owner = { change_variable = { which = ehof_pre_flight_military value = 1 } } }
			if = { limit = { is_ship_class = shipclass_military_special }	owner = { change_variable = { which = ehof_pre_flight_colossus value = 1 } } }
			if = { limit = { is_ship_size = juggernaut }					owner = { change_variable = { which = ehof_pre_flight_juggernaut value = 1 } } }
			set_ship_flag = ehof_already_counted
		}

		if = {
			limit = {
				fleet = { NOT = { has_fleet_flag = recently_triggered_ehof } }
				owner = {
					NOR = {
						has_country_flag = ehof_is_upgrading
						has_country_flag = ehof_can_activate
					}
					OR = {
						check_variable = { which = ehof_pre_flight_science value > 0 }
						check_variable = { which = ehof_pre_flight_constructor value > 0 }
						check_variable = { which = ehof_pre_flight_military value > 0 }
						check_variable = { which = ehof_pre_flight_colossus value > 0 }
						check_variable = { which = ehof_pre_flight_juggernaut value > 0 }
					}
				}
			}
			fleet = {
				set_timed_fleet_flag = { flag = recently_triggered_ehof days = 1 } # stop triggering ehof twice
				owner = { country_event = { id = ehof_megastructure.009 days = 2 } } # Check EHOF state
			}
		}
	}
}

# Fleet enters a system [on_entering_system_fleet]
fleet_event = {
    id = ehof_megastructure.002
    hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = owner
		exists = solar_system
		owner = { is_same_value = solar_system.starbase.owner }
		solar_system = { has_star_flag = ehof_megastructure_system@root.owner }
		can_use_ehof = yes
	}

	immediate = {
		every_owned_ship = {
			limit = { NOT = { has_ship_flag = ehof_already_counted } }
			set_ship_flag = ehof_already_counted
			if = { limit = { is_ship_size = science }						owner = { change_variable = { which = ehof_pre_flight_science value = 1 } } }
			if = { limit = { is_ship_size = constructor }					owner = { change_variable = { which = ehof_pre_flight_constructor value = 1 } } }
			if = { limit = { is_ship_class = shipclass_military }			owner = { change_variable = { which = ehof_pre_flight_military value = 1 } } }
			if = { limit = { is_ship_class = shipclass_military_special }	owner = { change_variable = { which = ehof_pre_flight_colossus value = 1 } } }
			if = { limit = { is_ship_size = juggernaut }					owner = { change_variable = { which = ehof_pre_flight_juggernaut value = 1 } } }
		}

		if = {
			limit = {
				NOT = { has_fleet_flag = recently_triggered_ehof }
				owner = {
					NOR = {
						has_country_flag = ehof_is_upgrading
						has_country_flag = ehof_can_activate
					}
					OR = {
						check_variable = { which = ehof_pre_flight_science value > 0 }
						check_variable = { which = ehof_pre_flight_constructor value > 0 }
						check_variable = { which = ehof_pre_flight_military value > 0 }
						check_variable = { which = ehof_pre_flight_colossus value > 0 }
						check_variable = { which = ehof_pre_flight_juggernaut value > 0 }
					}
				}
			}
			set_timed_fleet_flag = { flag = recently_triggered_ehof days = 1 } # stop triggering ehof twice
			owner = { country_event = { id = ehof_megastructure.009 days = 2 } } # Check EHOF state
		}
	}
}

# Fleets leave EHOF system [on_entering_system_fleet]
fleet_event = {
    id = ehof_megastructure.015
    hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_owned_ship = { has_ship_flag = ehof_already_counted }
		exists = solar_system
		solar_system = { NOT = { has_star_flag = ehof_megastructure_system@root.owner } }
	}

	immediate = {
		every_owned_ship = {
			limit = { has_ship_flag = ehof_already_counted }
			remove_ship_flag = ehof_already_counted
			if = { limit = { is_ship_size = science }						owner = { subtract_variable = { which = ehof_pre_flight_science value = 1 } } }
			if = { limit = { is_ship_size = constructor }					owner = { subtract_variable = { which = ehof_pre_flight_constructor value = 1 } } }
			if = { limit = { is_ship_class = shipclass_military }			owner = { subtract_variable = { which = ehof_pre_flight_military value = 1 } } }
			if = { limit = { is_ship_class = shipclass_military_special }	owner = { subtract_variable = { which = ehof_pre_flight_colossus value = 1 } } }
			if = { limit = { is_ship_size = juggernaut }					owner = { subtract_variable = { which = ehof_pre_flight_juggernaut value = 1 } } }
		}
		owner = {
			if = {
				limit = {
					check_variable = { which = ehof_pre_flight_science value = 0 }
					check_variable = { which = ehof_pre_flight_constructor value = 0 }
					check_variable = { which = ehof_pre_flight_military value = 0 }
					check_variable = { which = ehof_pre_flight_colossus value = 0 }
					check_variable = { which = ehof_pre_flight_juggernaut value = 0 }
				}
				country_event = { id = ehof_megastructure.010 days = 2 } # Check EHOF state
			}
		}
	}
}

country_event = {
	id = ehof_megastructure.006
	hide_window = yes
	is_triggered_only = yes
	trigger = { from = { any_system_megastructure = { is_any_ehof = yes } } }

	immediate = {
		from = { remove_star_flag = ehof_megastructure_system@root }

		# Previous owner of system
		country_event = { id = ehof_megastructure.003 }

		# New owner of system
		fromfrom = { country_event = { id = ehof_megastructure.003 } }
	}
}

country_event = {
    id = ehof_megastructure.003
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		ehof_default_country = yes
		NOR = {
			has_country_flag = ehof_activated
			has_country_flag = ehof_activating
		}
		OR = {
			count_owned_megastructure = { limit = { is_any_ehof = yes } count > 1 }
			AND = {
				has_any_ehof = no
				NOT = { check_variable = { which = ehof_phase value = 0 } }
			}
			AND = {
				count_owned_megastructure = { limit = { is_any_ehof = yes } count = 1 }
				has_an_active_ehof = no
			}
			AND = {
				count_owned_megastructure = { limit = { is_an_active_ehof = yes } count = 1 }
				OR = {
					AND = {
						has_megastructure = ehof_megastructure_phase1_activating
						has_megastructure = ehof_megastructure_phase1_active
						has_megastructure = ehof_megastructure_phase1_idle
						NOT = { check_variable = { which = ehof_phase value = 1 } }
					}
					AND = {
						has_megastructure = ehof_megastructure_phase2_activating
						has_megastructure = ehof_megastructure_phase2_active
						has_megastructure = ehof_megastructure_phase2_idle
						NOT = { check_variable = { which = ehof_phase value = 2 } }
					}
					AND = {
						has_megastructure = ehof_megastructure_phase3_activating
						has_megastructure = ehof_megastructure_phase3_active
						has_megastructure = ehof_megastructure_phase3_idle
						NOT = { check_variable = { which = ehof_phase value = 3 } }
					}
					AND = {
						has_megastructure = ehof_megastructure_phase4_activating
						has_megastructure = ehof_megastructure_phase4_active
						has_megastructure = ehof_megastructure_phase4_idle
						NOT = { check_variable = { which = ehof_phase value = 4 } }
					}
				}
			}
		}
	}

	immediate = {
		# We dont have any ehof
		if = {
			limit = {
				has_any_ehof = no
				NOT = { check_variable = { which = ehof_phase value = 0 } }
			}
			set_variable = { which = ehof_phase value = 0 }
			remove_country_flag = ehof_destination_picked
			remove_country_flag = ehof_travel_diplomacy
			remove_country_flag = ehof_can_activate
			remove_country_flag = ehof_can_deactivate
			remove_country_flag = ehof_is_upgrading
			remove_country_flag = ehof_on_cooldown
		}

		# We have an ehof, but it's innactive
		else_if = {
			limit = {
				count_owned_megastructure = { limit = { is_any_ehof = yes } count = 1 }
				has_an_active_ehof = no
			}
			remove_country_flag = ehof_destination_picked
			remove_country_flag = ehof_travel_diplomacy
			remove_country_flag = ehof_can_activate
			remove_country_flag = ehof_can_deactivate
			remove_country_flag = ehof_is_upgrading
			remove_country_flag = ehof_on_cooldown
			activate_an_ehof = yes
		}

		# We have an active ehof, but dont have the correct flags
		else_if = {
			limit = {
				count_owned_megastructure = { limit = { is_an_active_ehof = yes } count = 1 }
				OR = {
					AND = {
						has_megastructure = ehof_megastructure_phase1_activating
						has_megastructure = ehof_megastructure_phase1_active
						has_megastructure = ehof_megastructure_phase1_idle
						NOT = { check_variable = { which = ehof_phase value = 1 } }
					}
					AND = {
						has_megastructure = ehof_megastructure_phase2_activating
						has_megastructure = ehof_megastructure_phase2_active
						has_megastructure = ehof_megastructure_phase2_idle
						NOT = { check_variable = { which = ehof_phase value = 2 } }
					}
					AND = {
						has_megastructure = ehof_megastructure_phase3_activating
						has_megastructure = ehof_megastructure_phase3_active
						has_megastructure = ehof_megastructure_phase3_idle
						NOT = { check_variable = { which = ehof_phase value = 3 } }
					}
					AND = {
						has_megastructure = ehof_megastructure_phase4_activating
						has_megastructure = ehof_megastructure_phase4_active
						has_megastructure = ehof_megastructure_phase4_idle
						NOT = { check_variable = { which = ehof_phase value = 4 } }
					}
				}
			}
			remove_country_flag = ehof_destination_picked
			remove_country_flag = ehof_travel_diplomacy
			remove_country_flag = ehof_can_activate
			remove_country_flag = ehof_can_deactivate
			remove_country_flag = ehof_is_upgrading
			remove_country_flag = ehof_on_cooldown
			random_system_within_border = {
				limit = { has_an_active_ehof = yes }
				set_star_flag = ehof_megastructure_system@root
			}
			if = {
				limit = {
					has_megastructure = ehof_megastructure_phase1_activating
					has_megastructure = ehof_megastructure_phase1_active
					has_megastructure = ehof_megastructure_phase1_idle
					NOT = { check_variable = { which = ehof_phase value = 1 } }
				}
				set_variable = { which = ehof_phase value = 1 }
			}
			else_if = {
				limit = {
					has_megastructure = ehof_megastructure_phase2_activating
					has_megastructure = ehof_megastructure_phase2_active
					has_megastructure = ehof_megastructure_phase2_idle
					NOT = { check_variable = { which = ehof_phase value = 2 } }
				}
				set_variable = { which = ehof_phase value = 2 }
			}
			else_if = {
				limit = {
					has_megastructure = ehof_megastructure_phase3_activating
					has_megastructure = ehof_megastructure_phase3_active
					has_megastructure = ehof_megastructure_phase3_idle
					NOT = { check_variable = { which = ehof_phase value = 3 } }
				}
				set_variable = { which = ehof_phase value = 3 }
			}
			else_if = {
				limit = {
					has_megastructure = ehof_megastructure_phase4_activating
					has_megastructure = ehof_megastructure_phase4_active
					has_megastructure = ehof_megastructure_phase4_idle
					NOT = { check_variable = { which = ehof_phase value = 4 } }
				}
				set_variable = { which = ehof_phase value = 4 }
			}
		}

		# We have more than 1 ehof
		else_if = {
			limit = { count_owned_megastructure = { limit = { is_any_ehof = yes } count > 1 } }

			# There is a better ehof available to use
			if = {
				limit = {
					NOT = { has_country_flag = ehof_asked_to_move }
					OR = {
						AND = {
							check_variable = { which = ehof_phase value = 0 }
							any_owned_megastructure = {
								OR = {
									has_megastructure_flag = ehof_phase_01
									has_megastructure_flag = ehof_phase_01_decommissioned
									has_megastructure_flag = ehof_phase_02
									has_megastructure_flag = ehof_phase_02_decommissioned
									has_megastructure_flag = ehof_phase_03
									has_megastructure_flag = ehof_phase_03_decommissioned
									has_megastructure_flag = ehof_phase_04
									has_megastructure_flag = ehof_phase_04_decommissioned
								}
							}
						}
						AND = {
							check_variable = { which = ehof_phase value = 1 }
							any_owned_megastructure = {
								OR = {
									has_megastructure_flag = ehof_phase_02
									has_megastructure_flag = ehof_phase_02_decommissioned
									has_megastructure_flag = ehof_phase_03
									has_megastructure_flag = ehof_phase_03_decommissioned
									has_megastructure_flag = ehof_phase_04
									has_megastructure_flag = ehof_phase_04_decommissioned
								}
							}
						}
						AND = {
							check_variable = { which = ehof_phase value = 2 }
							any_owned_megastructure = {
								OR = {
									has_megastructure_flag = ehof_phase_03
									has_megastructure_flag = ehof_phase_03_decommissioned
									has_megastructure_flag = ehof_phase_04
									has_megastructure_flag = ehof_phase_04_decommissioned
								}
							}
						}
						AND = {
							check_variable = { which = ehof_phase value = 3 }
							any_owned_megastructure = {
								OR = {
									has_megastructure_flag = ehof_phase_04
									has_megastructure_flag = ehof_phase_04_decommissioned
								}
							}
						}
					}
				}
				country_event = { id = ehof_megastructure.008 }
			}
			# There is not any ehof that we own that is better than our active ehof
			else = {
				random_owned_megastructure = {
					limit = {
						is_an_active_ehof = yes
						exists = solar_system
						solar_system = { has_star_flag = ehof_megastructure_system@root }
					}
					root = {
						every_owned_megastructure = {
							limit = {
								is_an_active_ehof = yes
								NOT = { is_same_value = prevprev }
							}
							decomission_this_ehof = yes
						}
					}
				}
			}
		}
		country_event = { id = ehof_megastructure.009 }		# Check EHOF State.
	}
}

# There is a better ehof available to use
country_event = {
	id = ehof_megastructure.008
	title = "ehof_ehof"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "ehof_mainui_window"
	picture_event_data = {
		portrait = root
		graphical_culture = root
		room = "ehof_room"
	}
	location = event_target:ehof_megastructure_system
	desc = "ehof_megastructure.008.desc"

	option = {	# Keep current EHOF, never ask again
		custom_gui = "ehof_mainui_option_big"
		name = "ehof_megastructure.008.a"
		hidden_effect = {
			set_country_flag = ehof_asked_to_move
			random_owned_megastructure = {
				limit = {
					is_an_active_ehof = yes
					exists = solar_system
					solar_system = { has_star_flag = ehof_megastructure_system@root }
				}
				root = {
					every_owned_megastructure = {
						limit = {
							is_an_active_ehof = yes
							NOT = { is_same_value = prevprev }
						}
						decomission_this_ehof = yes
					}
				}
			}
		}
	}

	option = {	# Swap to better ehof
		custom_gui = "ehof_mainui_option_big"
		name = "ehof_megastructure.008.b"
		hidden_effect = {
			decomission_all_ehofs = yes
			activate_an_ehof = yes
		}
	}
}

# Toggle mod flags (cwtools error check)
country_event = {
    id = ehof_megastructure.004
	hide_window = yes
	is_triggered_only = yes
	trigger = { NOT = { has_global_flag = ehof_compatibility } }
	immediate = {
		set_global_flag = ehof_compatibility
		if = { limit = { NOT = { has_global_flag = has_real_space_mod } }				set_global_flag = has_real_space_mod				remove_global_flag = has_real_space_mod }
		if = { limit = { NOT = { has_global_flag = planetarydiversity } }				set_global_flag = planetarydiversity				remove_global_flag = planetarydiversity }
		if = { limit = { NOT = { has_global_flag = acot_activated } }					set_global_flag = acot_activated					remove_global_flag = acot_activated }
		if = { limit = { NOT = { has_global_flag = has_guillis_planet_modifiers_mod } }	set_global_flag = has_guillis_planet_modifiers_mod	remove_global_flag = has_guillis_planet_modifiers_mod }
	}
}

# EHOF precursor
country_event = {
    id = ehof_megastructure.005
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = { has_country_flag = ehof_precursor_spawned }
		OR = {
			is_ai = no
			any_country = {
				is_country_type = global_event
				check_variable = { which = chk_precursor_cap value < giga_ehof_ai_cap }
			}
		}
	}

	immediate = {
		if = {
			limit = {
				any_planet_within_border = {
					solar_system = { NOT = { has_star_flag = empire_home_system } }
					is_planet_habitable = no
					is_star = no
					is_asteroid = no
					has_anomaly = no
					NOR = {
						exists = archaeological_site
						is_planet_class = pc_gas_giant
					}
				}
			}
			random_planet_within_border = {
				limit = {
					solar_system = { NOT = { has_star_flag = empire_home_system } }
					is_planet_habitable = no
					is_star = no
					is_asteroid = no
					has_anomaly = no
					NOR = {
						exists = archaeological_site
						is_planet_class = pc_gas_giant
					}
				}
				create_archaeological_site = ehof_precursor
				set_planet_flag = ehof_precursor@root
				root = {
					set_country_flag = ehof_precursor_spawned
					if = {
						limit = { is_ai = yes }
						random_country = {
							limit = { is_country_type = global_event }
							change_variable = { which = chk_precursor_cap value = 1 }
						}
					}
				}
			}
		}
		else = { country_event = { id = ehof_megastructure.005 days = 30 } } # Try again in a month
	}
}

# Stage 1
fleet_event = {
	id = ehof_megastructure.0051
	title = "ehof_megastructure.0051.name"
	desc = "ehof_megastructure.0051.desc"
	picture = GFX_evt_barren_dig_site
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 2
fleet_event = {
	id = ehof_megastructure.0052
	title = "ehof_megastructure.0052.name"
	desc = "ehof_megastructure.0052.desc"
	picture = GFX_evt_landing_ship
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 3
fleet_event = {
	id = ehof_megastructure.0053
	title = "ehof_megastructure.0053.name"
	desc = "ehof_megastructure.0053.desc"
	picture = GFX_evt_atmospheric_flight
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 4
fleet_event = {
	id = ehof_megastructure.00531
	title = "ehof_megastructure.00531.name"
	desc = "ehof_megastructure.00531.desc"
	picture = GFX_evt_orange_bolt
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	after = { from = { set_site_progress_locked = no } }
	immediate = {
		from = { set_site_progress_locked = yes }

		owner.capital_scope.solar_system = {
			random_list = {
				75 = {
					spawn_system = {
						initializer = "special_init_01"
						min_distance = 10
						max_distance = 40
						max_jumps = 0
					}
					last_created_system = {
						# Add extra hyperlanes
						random_list = {
							1 = { while = { count = 1 giga_generate_hyperlane = yes } }
							1 = { while = { count = 2 giga_generate_hyperlane = yes } }
						}

						giga_field_system_debris = yes
						set_star_flag = ehof_blackhole_@root.owner
						root.owner = {
							enable_special_project = {
								name = "EXPLORE_EHOF_PRECURSOR_NO_RUINED"
								location = prev.star
								owner = this
							}
						}
					}
				}
				25 = {
					spawn_system = {
						initializer = "ehof_unique_ruined"
						min_distance = 10
						max_distance = 40
						max_jumps = 0
					}
					last_created_system = {
						# Add extra hyperlanes
						random_list = {
							1 = { while = { count = 1 giga_generate_hyperlane = yes } }
							1 = { while = { count = 2 giga_generate_hyperlane = yes } }
						}

						set_star_flag = ehof_blackhole_@root.owner
						root.owner = {
							enable_special_project = {
								name = "EXPLORE_EHOF_PRECURSOR_RUINED"
								location = prev.star
								owner = this
							}
						}
					}
				}
			}
		}
	}

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

country_event = {
	id = ehof_megastructure.0054
	title = "ehof_megastructure.0054_name"
	desc = "ehof_megastructure.0054_desc"
	picture = GFX_evt_black_hole
	show_sound = event_radio_chatter_02
	location = this
	is_triggered_only = yes

	option = {
		name = "FASCINATING"
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
		add_research_option = tech_abstract_1
		add_tech_progress = { tech = tech_abstract_1 progress = 0.1 }
		add_monthly_resource_mult = {
			resource = unity
			value = 30
			min = 60
			max = 2500
		}
		add_monthly_resource_mult = {
			resource = physics_research
			value = @tier1researchreward
			min = @tier1researchmin
			max = @tier1researchmax
		}
		add_monthly_resource_mult = {
			resource = society_research
			value = @tier1researchreward
			min = @tier1researchmin
			max = @tier1researchmax
		}
		add_monthly_resource_mult = {
			resource = engineering_research
			value = @tier1researchreward
			min = @tier1researchmin
			max = @tier1researchmax
		}
	}
}

country_event = {
	id = ehof_megastructure.0055
	title = "ehof_megastructure.0055_name"
	desc = "ehof_megastructure.0055_desc"
	picture = GFX_evt_ruined_system
	show_sound = event_radio_chatter
	location = this
	is_triggered_only = yes

	option = {
		name = "FASCINATING"
		add_research_option = tech_abstract_1
		add_tech_progress = { tech = tech_abstract_1 progress = 0.1 }
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Mark system as visited (FTL Exploration)
ship_event = {
    id = ehof_megastructure.007
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		owner = { ehof_default_country = yes }
		exists = from
		from = {
			NOR = {
				has_star_flag = empire_has_visited_anyone
				has_star_flag = empire_has_visited@root.owner
			}
			cohesive_system = no
		}
	}

	immediate = {
		from = {
			set_star_flag = empire_has_visited_anyone
			set_star_flag = empire_has_visited@root.owner
		}
	}
}

# Should it activate? [Monthly Pulse]
country_event = {
	id = ehof_megastructure.009
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		check_variable = { which = ehof_phase value > 0 }
		any_system_within_border = {
			has_star_flag = ehof_megastructure_system@root
			any_fleet_in_system = {
				can_use_ehof = yes
				exists = owner
				owner = { is_same_value = root }
			}
		}
		NOR = {
			has_country_flag = ehof_can_activate
			has_country_flag = ehof_can_deactivate
			has_country_flag = ehof_activating
			has_country_flag = ehof_activated
			has_country_flag = ehof_on_cooldown
			has_country_flag = ehof_is_upgrading
		}
	}

	immediate = {
		set_country_flag = ehof_alerted_recently
		set_country_flag = ehof_can_activate
		if = {
			limit = {
				is_ai = no
				is_multiplayer = no
			}
			random_list = {
				1 = { play_sound = sfx_ehof_activate_01 }
				1 = { play_sound = sfx_ehof_activate_02 }
			}
		}
	}
}

# Should it deactivate?
country_event = {
	id = ehof_megastructure.010
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_system_within_border = {
			has_star_flag = ehof_megastructure_system@root
			NOT = {
				any_fleet_in_system = {
					can_use_ehof = yes
					exists = owner
					owner = { is_same_value = root }
				}
			}
		}
		has_country_flag = ehof_can_activate
	}

	immediate = {
		remove_country_flag = ehof_can_activate
		remove_country_flag = ehof_alerted_recently
	}
}

# Is EHOF Active too long?
country_event = {
	id = ehof_megastructure.011
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOR = {
			has_country_flag = ehof_wormhole_open
			has_country_flag = ehof_permanent
		}
		any_owned_megastructure = {
			OR = {
				is_ehof_activating = yes
				is_ehof_active = yes
			}
		}
	}

	immediate = { country_event = { id = ehof_megastructure.307 } }
}

#########################################################################################################
########################################### EHOF Construction ###########################################
#########################################################################################################
country_event = {
	id = ehof_megastructure.101
	title = "ehof_megastructure.101_name"
	picture = GFX_evt_ehof
	show_sound = event_dyson_sphere_build_complete
	location = event_target:ehof_megastructure_system
	is_triggered_only = yes
	desc = { trigger = { check_variable = { which = ehof_phase value = 4 } } text = "ehof_megastructure.101_desc_4" }
	desc = { trigger = { check_variable = { which = ehof_phase value = 3 } } text = "ehof_megastructure.101_desc_3" }
	desc = { trigger = { NOT = { has_country_flag = ehof_restored } check_variable = { which = ehof_phase value = 2 } } text = "ehof_megastructure.101_desc_2" }
	desc = { trigger = { check_variable = { which = ehof_phase value = 1 } } text = "ehof_megastructure.101_desc_1" }
	desc = { trigger = { check_variable = { which = ehof_phase value = 0 } } text = "ehof_megastructure.101_desc_0" }
	desc = { trigger = { has_country_flag = ehof_restored check_variable = { which = ehof_phase value = 2 } } text = "ehof_megastructure.101_desc_restored" }

	trigger = {
		OR = {
			AND = {
				has_megastructure = ehof_megastructure_phase2_idle
				has_country_flag = ehof_restored
				NOT = { has_country_flag = ehof_restored_first_time }
			}
			AND = {
				has_megastructure = ehof_megastructure_phase0
				NOT = { has_country_flag = ehof_p0_first_time }
			}
			AND = {
				has_megastructure = ehof_megastructure_phase4_idle
				NOT = { has_country_flag = ehof_p4_first_time }
			}
			AND = {
				has_megastructure = ehof_megastructure_phase3_idle
				NOT = { has_country_flag = ehof_p3_first_time }
			}
			AND = {
				has_megastructure = ehof_megastructure_phase2_idle
				NOT = { has_country_flag = ehof_restored }
				NOT = { has_country_flag = ehof_p2_first_time }
			}
			AND = {
				has_megastructure = ehof_megastructure_phase1_idle
				NOT = { has_country_flag = ehof_p1_first_time }
			}
		}
	}

	immediate = {
		# Restored
		if = {
			limit = { has_country_flag = ehof_restored }
			set_country_flag = ehof_restored_first_time
			remove_country_flag = ehof_restored
			set_country_flag = ehof_p2_first_time
			set_country_flag = ehof_p1_first_time
			set_country_flag = ehof_p0_first_time
			set_timed_global_flag = { flag = ehof_recently_built_phase_2 days = 2 }
		}

		# Phase 4
		else_if = {
			limit = { has_megastructure = ehof_megastructure_phase4_idle }
			set_country_flag = has_built_or_repaired_gigastructure
			set_country_flag = ehof_p4_first_time
			set_timed_global_flag = { flag = ehof_recently_built_phase_4 days = 2 }
		}

		# Phase 3
		else_if = {
			limit = { has_megastructure = ehof_megastructure_phase3_idle }
			set_country_flag = has_built_or_repaired_megastructure
			set_country_flag = ehof_p3_first_time
			set_timed_global_flag = { flag = ehof_recently_built_phase_3 days = 2 }
		}

		# Phase 2
		else_if = {
			limit = { has_megastructure = ehof_megastructure_phase2_idle }
			set_country_flag = ehof_p2_first_time
			set_timed_global_flag = { flag = ehof_recently_built_phase_2 days = 2 }
		}

		# Phase 1
		else_if = {
			limit = { has_megastructure = ehof_megastructure_phase1_idle }
			set_country_flag = ehof_p1_first_time
			set_timed_global_flag = { flag = ehof_recently_built_phase_1 days = 2 }
		}

		# Phase 0
		else_if = {
			limit = { has_megastructure = ehof_megastructure_phase0 }
			set_country_flag = ehof_p0_first_time
			set_timed_global_flag = { flag = ehof_recently_built_phase_0 days = 2 }
			set_variable = { which = ehof_pre_flight_science value = 0 }
			set_variable = { which = ehof_pre_flight_constructor value = 0 }
			set_variable = { which = ehof_pre_flight_military value = 0 }
			set_variable = { which = ehof_pre_flight_colossus value = 0 }
			set_variable = { which = ehof_pre_flight_juggernaut value = 0 }
		}

		# Set globals for localization
		if = { limit = { exists = event_target:ehof_recently_built_system } clear_global_event_target = ehof_recently_built_system }
		random_system_within_border = {
			limit = { has_star_flag = ehof_megastructure_system@root }
			save_global_event_target_as = ehof_recently_built_system
		}
		country_event = { id = ehof_megastructure.009 days = 2 } # Check EHOF state
	}

	option = { name = GOOD }
}

########################################################################################################
########################################## EHOF State Changes ##########################################
########################################################################################################
# Set to Idle
country_event = {
	id = ehof_megastructure.201
	hide_window = yes
	is_triggered_only = yes

	trigger = { any_system_within_border = { has_star_flag = ehof_megastructure_system@root } }

	immediate = {
		remove_country_flag = ehof_on_cooldown
		ehof_set_to_idle = yes
		country_event = { id = ehof_megastructure.009 days = 2 } # Check EHOF state
	}
}

# Set to Firing
country_event = {
	id = ehof_megastructure.202
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = { limit = { has_country_flag = ehof_can_activate }	remove_country_flag = ehof_can_activate }
		set_timed_country_flag = { flag = ehof_wormhole_open days = 30 }
		set_country_flag = ehof_activating
		ehof_set_to_activating = yes
	}
}

# Set to Active
country_event = {
	id = ehof_megastructure.203
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = { limit = { is_ai = yes } ehof_set_to_activated = yes }
		else = {
			if = { limit = { has_country_flag = ehof_destination_picked }	remove_country_flag = ehof_destination_picked }
			if = { limit = { has_country_flag = ehof_travel_diplomacy }		remove_country_flag = ehof_travel_diplomacy }
			if = { limit = { has_country_flag = ehof_activating }			remove_country_flag = ehof_activating }
			set_country_flag = ehof_activated
			ehof_set_to_activated = yes
		}
	}
}

# Set to Cooldown
country_event = {
	id = ehof_megastructure.205
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = { limit = { is_ai = yes } ehof_set_to_idle = yes }
		else = {
			remove_country_flag = ehof_activated
			set_country_flag = ehof_on_cooldown
			ehof_set_to_idle = yes
			if = {		limit = { check_variable = { which = ehof_phase value = 1 } } country_event = { id = ehof_megastructure.201 days = @ehof_phase1_cooldown_days } }
			else_if = {	limit = { check_variable = { which = ehof_phase value = 2 } } country_event = { id = ehof_megastructure.201 days = @ehof_phase2_cooldown_days } }
			else_if = {	limit = { check_variable = { which = ehof_phase value = 3 } } country_event = { id = ehof_megastructure.201 days = @ehof_phase3_cooldown_days } }
			else_if = {	limit = { check_variable = { which = ehof_phase value = 4 } } country_event = { id = ehof_megastructure.201 days = @ehof_phase4_cooldown_days } }
		}
	}
}

########################################################################################################
########################################## Open the wormholes ##########################################
########################################################################################################
country_event = {
	id = ehof_megastructure.304
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_country_flag = ehof_destination_picked
		random_system = {
			limit = { has_star_flag = ehof_destination_system@root }
			spawn_megastructure = {
				type = "ehof_megastructure_wormhole_destination"
				orbit_angle = @ehof_wormhole_angle
				orbit_distance = @ehof_wormhole_distance
				owner = root
				init_effect = {
					set_megastructure_flag = ehof_wormhole_nexus
					set_megastructure_flag = ehof_wormhole_opened_by_@root
				}
			}
		}
		country_event = { id = ehof_megastructure.203 days = 2 } # Set to Active
		country_event = { id = ehof_megastructure.305 days = 4 } # Sent fleets through
	}
}

########################################################################################################
######################################### Send Fleets Through ##########################################
########################################################################################################
country_event = {
	id = ehof_megastructure.305
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_system_within_border = {
			limit = { has_an_active_ehof = yes }
			every_fleet_in_system = {
				limit = { has_fleet_flag = ehof_ready_for_travel@root }

				every_owned_ship = {
					limit = { has_ship_flag = ehof_already_counted }
					remove_ship_flag = ehof_already_counted
					if = { limit = { is_ship_size = science }						owner = { subtract_variable = { which = ehof_pre_flight_science value = 1 } } }
					if = { limit = { is_ship_size = constructor }					owner = { subtract_variable = { which = ehof_pre_flight_constructor value = 1 } } }
					if = { limit = { is_ship_class = shipclass_military }			owner = { subtract_variable = { which = ehof_pre_flight_military value = 1 } } }
					if = { limit = { is_ship_class = shipclass_military_special }	owner = { subtract_variable = { which = ehof_pre_flight_colossus value = 1 } } }
					if = { limit = { is_ship_size = juggernaut }					owner = { subtract_variable = { which = ehof_pre_flight_juggernaut value = 1 } } }
				}

				set_fleet_stance = passive
				remove_auto_move_target = yes
				ehof_dest_system = yes
				event_target:ehof_destination_system.star = {
					save_event_target_as = ehof_move_to_destination
				}
				auto_move_to_planet = {
					target = event_target:ehof_move_to_destination
					clear_auto_move_on_arrival = yes
				}
			}
		}
	}
}

#########################################################################################################
##################################### Check if travel was successful ####################################
#########################################################################################################
fleet_event = {
	id = ehof_megastructure.308
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_fleet_flag = ehof_ready_for_travel@root.owner
		exists = owner
		owner = {
			NOR = {
				has_country_flag = ehof_already_shown_success
				is_ai = yes
			}
		}
	}

	immediate = {
		log = "Travel report triggered for [from.GetName]"
		remove_fleet_flag = ehof_ready_for_travel@root.owner

		if = {
			limit = {
				exists = from
				from = {
					has_star_flag = ehof_destination_system@root.owner
					NOT = { has_star_flag = ehof_permanent_connection@root.owner }
				}
			}
			owner = {
				set_timed_country_flag = { flag = ehof_already_shown_success days = @ehof_short_cooldown }	# Stop double reporting.
				log = "Travel report pass to ui"
				country_event = { id = ehof_megastructure.309 days = 2 }									# Travel report
				if = {
					limit = {
						check_variable = { which = ehof_phase value = 4 }
						has_country_flag = ehof_permanent
					}
					set_country_flag = ehof_can_deactivate
					root.from = { set_star_flag = ehof_permanent_connection@root.owner }
				}
				else = { country_event = { id =  ehof_megastructure.307 days = 2 } }
			}
		}
		else = { fleet_event = { id = ehof_megastructure.308 days = 2 } }	# Try again
	}
}

########################################################################################################
######################################### Close the Wormholes ##########################################
########################################################################################################
country_event = {
	id = ehof_megastructure.307
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		country_event = { id = ehof_megastructure.205 } # Set to Cooldown
		every_megastructure = {
			limit = {
				has_megastructure_flag = ehof_wormhole_nexus
				has_megastructure_flag = ehof_wormhole_opened_by_@root
			}
			remove_megastructure = this
		}
	}
}

########################################################################################################
############################################ Travel Report #############################################
########################################################################################################
country_event = {
	id = ehof_megastructure.309
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		log = "Travel report fired"
		ehof_mega_system = yes
		ehof_dest_system = yes

		# Save system details for situation log
		event_target:ehof_destination_system = {
			if = {
				limit = {
					cohesive_system = yes
					empire_has_visited = no
				}

				# Create Point of Interest
				root = {
					if = {
						limit = { NOT = { has_event_chain = ehof_system_list } }
						begin_event_chain = {
							event_chain = ehof_system_list
							target = root
						}
					}
					if = {		limit = { NOT = { has_point_of_interest = { poi = ehof_sys_001 } } } create_point_of_interest = { id = ehof_sys_001 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_002 } } } create_point_of_interest = { id = ehof_sys_002 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_003 } } } create_point_of_interest = { id = ehof_sys_003 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_004 } } } create_point_of_interest = { id = ehof_sys_004 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_005 } } } create_point_of_interest = { id = ehof_sys_005 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_006 } } } create_point_of_interest = { id = ehof_sys_006 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_007 } } } create_point_of_interest = { id = ehof_sys_007 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_008 } } } create_point_of_interest = { id = ehof_sys_008 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_009 } } } create_point_of_interest = { id = ehof_sys_009 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_010 } } } create_point_of_interest = { id = ehof_sys_010 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_011 } } } create_point_of_interest = { id = ehof_sys_011 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_012 } } } create_point_of_interest = { id = ehof_sys_012 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_013 } } } create_point_of_interest = { id = ehof_sys_013 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_014 } } } create_point_of_interest = { id = ehof_sys_014 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_015 } } } create_point_of_interest = { id = ehof_sys_015 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_016 } } } create_point_of_interest = { id = ehof_sys_016 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_017 } } } create_point_of_interest = { id = ehof_sys_017 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_018 } } } create_point_of_interest = { id = ehof_sys_018 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_019 } } } create_point_of_interest = { id = ehof_sys_019 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_020 } } } create_point_of_interest = { id = ehof_sys_020 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_021 } } } create_point_of_interest = { id = ehof_sys_021 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_022 } } } create_point_of_interest = { id = ehof_sys_022 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_023 } } } create_point_of_interest = { id = ehof_sys_023 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_024 } } } create_point_of_interest = { id = ehof_sys_024 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_025 } } } create_point_of_interest = { id = ehof_sys_025 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_026 } } } create_point_of_interest = { id = ehof_sys_026 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_027 } } } create_point_of_interest = { id = ehof_sys_027 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_028 } } } create_point_of_interest = { id = ehof_sys_028 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_029 } } } create_point_of_interest = { id = ehof_sys_029 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_030 } } } create_point_of_interest = { id = ehof_sys_030 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_031 } } } create_point_of_interest = { id = ehof_sys_031 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_032 } } } create_point_of_interest = { id = ehof_sys_032 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_033 } } } create_point_of_interest = { id = ehof_sys_033 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_034 } } } create_point_of_interest = { id = ehof_sys_034 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_035 } } } create_point_of_interest = { id = ehof_sys_035 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_036 } } } create_point_of_interest = { id = ehof_sys_036 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_037 } } } create_point_of_interest = { id = ehof_sys_037 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_038 } } } create_point_of_interest = { id = ehof_sys_038 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_039 } } } create_point_of_interest = { id = ehof_sys_039 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_040 } } } create_point_of_interest = { id = ehof_sys_040 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_041 } } } create_point_of_interest = { id = ehof_sys_041 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_042 } } } create_point_of_interest = { id = ehof_sys_042 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_043 } } } create_point_of_interest = { id = ehof_sys_043 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_044 } } } create_point_of_interest = { id = ehof_sys_044 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_045 } } } create_point_of_interest = { id = ehof_sys_045 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_046 } } } create_point_of_interest = { id = ehof_sys_046 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_047 } } } create_point_of_interest = { id = ehof_sys_047 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_048 } } } create_point_of_interest = { id = ehof_sys_048 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_049 } } } create_point_of_interest = { id = ehof_sys_049 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_050 } } } create_point_of_interest = { id = ehof_sys_050 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_051 } } } create_point_of_interest = { id = ehof_sys_051 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_052 } } } create_point_of_interest = { id = ehof_sys_052 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_053 } } } create_point_of_interest = { id = ehof_sys_053 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_054 } } } create_point_of_interest = { id = ehof_sys_054 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_055 } } } create_point_of_interest = { id = ehof_sys_055 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_056 } } } create_point_of_interest = { id = ehof_sys_056 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_057 } } } create_point_of_interest = { id = ehof_sys_057 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_058 } } } create_point_of_interest = { id = ehof_sys_058 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_059 } } } create_point_of_interest = { id = ehof_sys_059 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_060 } } } create_point_of_interest = { id = ehof_sys_060 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_061 } } } create_point_of_interest = { id = ehof_sys_061 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_062 } } } create_point_of_interest = { id = ehof_sys_062 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_063 } } } create_point_of_interest = { id = ehof_sys_063 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_064 } } } create_point_of_interest = { id = ehof_sys_064 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_065 } } } create_point_of_interest = { id = ehof_sys_065 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_066 } } } create_point_of_interest = { id = ehof_sys_066 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_067 } } } create_point_of_interest = { id = ehof_sys_067 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_068 } } } create_point_of_interest = { id = ehof_sys_068 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_069 } } } create_point_of_interest = { id = ehof_sys_069 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_070 } } } create_point_of_interest = { id = ehof_sys_070 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_071 } } } create_point_of_interest = { id = ehof_sys_071 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_072 } } } create_point_of_interest = { id = ehof_sys_072 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_073 } } } create_point_of_interest = { id = ehof_sys_073 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_074 } } } create_point_of_interest = { id = ehof_sys_074 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_075 } } } create_point_of_interest = { id = ehof_sys_075 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_076 } } } create_point_of_interest = { id = ehof_sys_076 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_077 } } } create_point_of_interest = { id = ehof_sys_077 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_078 } } } create_point_of_interest = { id = ehof_sys_078 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_079 } } } create_point_of_interest = { id = ehof_sys_079 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_080 } } } create_point_of_interest = { id = ehof_sys_080 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_081 } } } create_point_of_interest = { id = ehof_sys_081 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_082 } } } create_point_of_interest = { id = ehof_sys_082 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_083 } } } create_point_of_interest = { id = ehof_sys_083 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_084 } } } create_point_of_interest = { id = ehof_sys_084 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_085 } } } create_point_of_interest = { id = ehof_sys_085 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_086 } } } create_point_of_interest = { id = ehof_sys_086 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_087 } } } create_point_of_interest = { id = ehof_sys_087 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_088 } } } create_point_of_interest = { id = ehof_sys_088 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_089 } } } create_point_of_interest = { id = ehof_sys_089 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_090 } } } create_point_of_interest = { id = ehof_sys_090 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_091 } } } create_point_of_interest = { id = ehof_sys_091 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_092 } } } create_point_of_interest = { id = ehof_sys_092 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_093 } } } create_point_of_interest = { id = ehof_sys_093 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_094 } } } create_point_of_interest = { id = ehof_sys_094 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_095 } } } create_point_of_interest = { id = ehof_sys_095 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_096 } } } create_point_of_interest = { id = ehof_sys_096 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_097 } } } create_point_of_interest = { id = ehof_sys_097 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_098 } } } create_point_of_interest = { id = ehof_sys_098 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_099 } } } create_point_of_interest = { id = ehof_sys_099 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					else_if = {	limit = { NOT = { has_point_of_interest = { poi = ehof_sys_100 } } } create_point_of_interest = { id = ehof_sys_100 name = "ehof_sys" desc = "ehof_sys_desc" event_chain = ehof_system_list location = prev } }
					add_event_chain_counter = { event_chain = ehof_system_list counter = total_systems amount = 1 }
				}
			}

			# Count planetary bodies/deposits
			every_system_planet = {
				if = { limit = { is_moon = yes }				prev = { change_variable = { which = ehof_sys_moons value = 1 } } }
				if = { limit = { is_star = yes }				prev = { change_variable = { which = ehof_sys_stars value = 1 } } }
				if = { limit = { is_asteroid = yes }			prev = { change_variable = { which = ehof_sys_asteroids value = 1 } } }
				if = {
					limit = { is_planet_habitable = yes }
					if = {
						limit = {
							root = {
								OR = {
									is_machine_empire = yes
									any_owned_pop = {
										is_organic_species = yes
										prevprev = { habitability = { who = prev value >= 0.7 } }
									}
								}
							}
						}
						prev = { change_variable = { which = ehof_sys_green_habitable value = 1 } }
					}
					else_if = {
						limit = {
							root = {
								any_owned_pop = {
									is_organic_species = yes
									prevprev = {
										habitability = { who = prev value >= 0.4 }
										habitability = { who = prev value < 0.7 }
									}
								}
							}
						}
						prev = { change_variable = { which = ehof_sys_yellow_habitable value = 1 } }
					}
					else = { prev = { change_variable = { which = ehof_sys_red_habitable value = 1 } } }
				}
				if = {
					limit = {
						is_moon = no
						is_asteroid = no
						is_star = no
						is_planet_habitable = no
					}
					prev = { change_variable = { which = ehof_sys_planets value = 1 } }
				}
				if = { limit = { has_deposit = d_minerals_1 }				prev = { change_variable = { which = ehof_minerals value = 1 } } }
				if = { limit = { has_deposit = d_minerals_2 }				prev = { change_variable = { which = ehof_minerals value = 2 } } }
				if = { limit = { has_deposit = d_minerals_3 }				prev = { change_variable = { which = ehof_minerals value = 3 } } }
				if = { limit = { has_deposit = d_minerals_4 }				prev = { change_variable = { which = ehof_minerals value = 4 } } }
				if = { limit = { has_deposit = d_minerals_5 }				prev = { change_variable = { which = ehof_minerals value = 5 } } }
				if = { limit = { has_deposit = d_minerals_6 }				prev = { change_variable = { which = ehof_minerals value = 6 } } }
				if = { limit = { has_deposit = d_minerals_7 }				prev = { change_variable = { which = ehof_minerals value = 7 } } }
				if = { limit = { has_deposit = d_minerals_8 }				prev = { change_variable = { which = ehof_minerals value = 8 } } }
				if = { limit = { has_deposit = d_minerals_9 }				prev = { change_variable = { which = ehof_minerals value = 9 } } }
				if = { limit = { has_deposit = d_minerals_10 }				prev = { change_variable = { which = ehof_minerals value = 10 } } }

				if = { limit = { has_deposit = d_energy_1 }					prev = { change_variable = { which = ehof_energy value = 1 } } }
				if = { limit = { has_deposit = d_energy_2 }					prev = { change_variable = { which = ehof_energy value = 2 } } }
				if = { limit = { has_deposit = d_energy_3 }					prev = { change_variable = { which = ehof_energy value = 3 } } }
				if = { limit = { has_deposit = d_energy_4 }					prev = { change_variable = { which = ehof_energy value = 4 } } }
				if = { limit = { has_deposit = d_energy_5 }					prev = { change_variable = { which = ehof_energy value = 5 } } }
				if = { limit = { has_deposit = d_energy_6 }					prev = { change_variable = { which = ehof_energy value = 6 } } }
				if = { limit = { has_deposit = d_energy_7 }					prev = { change_variable = { which = ehof_energy value = 7 } } }
				if = { limit = { has_deposit = d_energy_8 }					prev = { change_variable = { which = ehof_energy value = 8 } } }
				if = { limit = { has_deposit = d_energy_9 }					prev = { change_variable = { which = ehof_energy value = 9 } } }
				if = { limit = { has_deposit = d_energy_10 }				prev = { change_variable = { which = ehof_energy value = 10 } } }

				if = { limit = { has_deposit = d_physics_1 }				prev = { change_variable = { which = ehof_physics value = 1 } } }
				if = { limit = { has_deposit = d_physics_2 }				prev = { change_variable = { which = ehof_physics value = 2 } } }
				if = { limit = { has_deposit = d_physics_3 }				prev = { change_variable = { which = ehof_physics value = 3 } } }
				if = { limit = { has_deposit = d_physics_4 }				prev = { change_variable = { which = ehof_physics value = 4 } } }
				if = { limit = { has_deposit = d_physics_5 }				prev = { change_variable = { which = ehof_physics value = 5 } } }
				if = { limit = { has_deposit = d_physics_6 }				prev = { change_variable = { which = ehof_physics value = 6 } } }
				if = { limit = { has_deposit = d_physics_7 }				prev = { change_variable = { which = ehof_physics value = 7 } } }
				if = { limit = { has_deposit = d_physics_8 }				prev = { change_variable = { which = ehof_physics value = 8 } } }
				if = { limit = { has_deposit = d_physics_9 }				prev = { change_variable = { which = ehof_physics value = 9 } } }
				if = { limit = { has_deposit = d_physics_10 }				prev = { change_variable = { which = ehof_physics value = 10 } } }

				if = { limit = { has_deposit = d_society_1 }				prev = { change_variable = { which = ehof_society value = 1 } } }
				if = { limit = { has_deposit = d_society_2 }				prev = { change_variable = { which = ehof_society value = 2 } } }
				if = { limit = { has_deposit = d_society_3 }				prev = { change_variable = { which = ehof_society value = 3 } } }
				if = { limit = { has_deposit = d_society_4 }				prev = { change_variable = { which = ehof_society value = 4 } } }
				if = { limit = { has_deposit = d_society_5 }				prev = { change_variable = { which = ehof_society value = 5 } } }
				if = { limit = { has_deposit = d_society_6 }				prev = { change_variable = { which = ehof_society value = 6 } } }
				if = { limit = { has_deposit = d_society_7 }				prev = { change_variable = { which = ehof_society value = 7 } } }
				if = { limit = { has_deposit = d_society_8 }				prev = { change_variable = { which = ehof_society value = 8 } } }
				if = { limit = { has_deposit = d_society_9 }				prev = { change_variable = { which = ehof_society value = 9 } } }
				if = { limit = { has_deposit = d_society_10 }				prev = { change_variable = { which = ehof_society value = 10 } } }

				if = { limit = { has_deposit = d_engineering_1 }			prev = { change_variable = { which = ehof_engineering value = 1 } } }
				if = { limit = { has_deposit = d_engineering_2 }			prev = { change_variable = { which = ehof_engineering value = 2 } } }
				if = { limit = { has_deposit = d_engineering_3 }			prev = { change_variable = { which = ehof_engineering value = 3 } } }
				if = { limit = { has_deposit = d_engineering_4 }			prev = { change_variable = { which = ehof_engineering value = 4 } } }
				if = { limit = { has_deposit = d_engineering_5 }			prev = { change_variable = { which = ehof_engineering value = 5 } } }
				if = { limit = { has_deposit = d_engineering_6 }			prev = { change_variable = { which = ehof_engineering value = 6 } } }
				if = { limit = { has_deposit = d_engineering_7 }			prev = { change_variable = { which = ehof_engineering value = 7 } } }
				if = { limit = { has_deposit = d_engineering_8 }			prev = { change_variable = { which = ehof_engineering value = 8 } } }
				if = { limit = { has_deposit = d_engineering_9 }			prev = { change_variable = { which = ehof_engineering value = 9 } } }
				if = { limit = { has_deposit = d_engineering_10 }			prev = { change_variable = { which = ehof_engineering value = 10 } } }

				if = { limit = { has_deposit = d_alloys_1 }					prev = { change_variable = { which = ehof_alloys value = 1 } } }
				if = { limit = { has_deposit = d_alloys_2 }					prev = { change_variable = { which = ehof_alloys value = 2 } } }
				if = { limit = { has_deposit = d_alloys_3 }					prev = { change_variable = { which = ehof_alloys value = 3 } } }
				if = { limit = { has_deposit = d_alloys_4 }					prev = { change_variable = { which = ehof_alloys value = 4 } } }
				if = { limit = { has_deposit = d_alloys_5 }					prev = { change_variable = { which = ehof_alloys value = 5 } } }

				if = { limit = { has_deposit = d_exotic_gases_1 }			prev = { change_variable = { which = ehof_exotic_gases value = 1 } } }
				if = { limit = { has_deposit = d_exotic_gases_2 }			prev = { change_variable = { which = ehof_exotic_gases value = 2 } } }
				if = { limit = { has_deposit = d_exotic_gases_3 }			prev = { change_variable = { which = ehof_exotic_gases value = 3 } } }
				if = { limit = { has_deposit = d_exotic_gases_4 }			prev = { change_variable = { which = ehof_exotic_gases value = 4 } } }
				if = { limit = { has_deposit = d_exotic_gases_5 }			prev = { change_variable = { which = ehof_exotic_gases value = 5 } } }

				if = { limit = { has_deposit = d_volatile_motes_1 }			prev = { change_variable = { which = ehof_volatile_motes value = 1 } } }
				if = { limit = { has_deposit = d_volatile_motes_2 }			prev = { change_variable = { which = ehof_volatile_motes value = 2 } } }
				if = { limit = { has_deposit = d_volatile_motes_3 }			prev = { change_variable = { which = ehof_volatile_motes value = 3 } } }
				if = { limit = { has_deposit = d_volatile_motes_4 }			prev = { change_variable = { which = ehof_volatile_motes value = 4 } } }
				if = { limit = { has_deposit = d_volatile_motes_5 }			prev = { change_variable = { which = ehof_volatile_motes value = 5 } } }

				if = { limit = { has_deposit = d_rare_crystals_1 }			prev = { change_variable = { which = ehof_rare_crystals value = 1 } } }
				if = { limit = { has_deposit = d_rare_crystals_2 }			prev = { change_variable = { which = ehof_rare_crystals value = 2 } } }
				if = { limit = { has_deposit = d_rare_crystals_3 }			prev = { change_variable = { which = ehof_rare_crystals value = 3 } } }
				if = { limit = { has_deposit = d_rare_crystals_4 }			prev = { change_variable = { which = ehof_rare_crystals value = 4 } } }
				if = { limit = { has_deposit = d_rare_crystals_5 }			prev = { change_variable = { which = ehof_rare_crystals value = 5 } } }

				if = { limit = { has_deposit = d_dark_matter_deposit_1 }	prev = { change_variable = { which = ehof_dark_matter value = 1 } } }
				if = { limit = { has_deposit = d_dark_matter_deposit_2 }	prev = { change_variable = { which = ehof_dark_matter value = 2 } } }
				if = { limit = { has_deposit = d_dark_matter_deposit_3 }	prev = { change_variable = { which = ehof_dark_matter value = 3 } } }
				if = { limit = { has_deposit = d_dark_matter_deposit_4 }	prev = { change_variable = { which = ehof_dark_matter value = 4 } } }
				if = { limit = { has_deposit = d_dark_matter_deposit_5 }	prev = { change_variable = { which = ehof_dark_matter value = 5 } } }

				if = { limit = { has_deposit = d_negative_mass_deposit_1 }	prev = { change_variable = { which = ehof_negative_mass value = 1 } } }
				if = { limit = { has_deposit = d_negative_mass_deposit_2 }	prev = { change_variable = { which = ehof_negative_mass value = 2 } } }
				if = { limit = { has_deposit = d_negative_mass_deposit_3 }	prev = { change_variable = { which = ehof_negative_mass value = 3 } } }
				if = { limit = { has_deposit = d_negative_mass_deposit_4 }	prev = { change_variable = { which = ehof_negative_mass value = 4 } } }
				if = { limit = { has_deposit = d_negative_mass_deposit_5 }	prev = { change_variable = { which = ehof_negative_mass value = 5 } } }

				if = { limit = { has_deposit = d_zro_deposit_1 }			prev = { change_variable = { which = ehof_zro value = 1 } } }
				if = { limit = { has_deposit = d_zro_deposit_2 }			prev = { change_variable = { which = ehof_zro value = 2 } } }
				if = { limit = { has_deposit = d_zro_deposit_3 }			prev = { change_variable = { which = ehof_zro value = 3 } } }
				if = { limit = { has_deposit = d_zro_deposit_4 }			prev = { change_variable = { which = ehof_zro value = 4 } } }
				if = { limit = { has_deposit = d_zro_deposit_5 }			prev = { change_variable = { which = ehof_zro value = 5 } } }

				if = { limit = { has_deposit = d_living_metal_deposit }		prev = { change_variable = { which = ehof_living_metal value = 1 } } }
				if = { limit = { has_deposit = d_living_metal_deposit_2 }	prev = { change_variable = { which = ehof_living_metal value = 2 } } }
			}

			# Count Megastructures
			every_system_megastructure = {
				limit = {
					NOR = {
						is_megastructure_type = ehof_pgate_unknown
						is_megastructure_type = ehof_pgate_gateway
					}
				}
				prev = { change_variable = { which = ehof_sys_megastructures value = 1 } }
			}

			# Notify outcome
			if = {
				limit = {
					OR = {
						everchanging_system = yes
						annihilator_system = yes
						urmazin_system = yes
						quest_system = yes
					}
				}
				root.owner = { set_country_flag = ehof_report_quest }
			}
			else_if = {
				limit = { cohesive_system = no }
				root.owner = { set_country_flag = ehof_report_standard }
			}
			else_if = {
				limit = {
					cohesive_system = yes
					rare_system = no
				}
				root.owner = { set_country_flag = ehof_report_cohesive }
			}
			else_if = {
				limit = {
					cohesive_system = yes
					rare_system = yes
				}
				root.owner = { set_country_flag = ehof_report_bountiful }
			}

			# Visited via ehof
			set_star_flag = empire_has_visited_anyone
			set_star_flag = empire_has_visited@root
		}
	}
}

#########################################################################################################
################################################ Dialog #################################################
#########################################################################################################
# Standard
country_event = {
	id = ehof_megastructure.401
	diplomatic = yes
	custom_gui = "giga_standard_window"
	title = "ehof_report_standard_header"
	show_sound = "event_lootbox_galatron"
	location = event_target:ehof_destination_system
	is_triggered_only = yes
	desc = "ehof_report_desc"
	immediate = {
		ehof_dest_system = yes
		remove_country_flag = ehof_report_standard
	}
	option = { name = OK default_hide_option = yes }
}

# Cohesive
country_event = {
	id = ehof_megastructure.402
	diplomatic = yes
	custom_gui = "giga_cohesive_window"
	title = "ehof_report_cohesive_header"
	show_sound = "event_lootbox_galatron"
	location = event_target:ehof_destination_system
	is_triggered_only = yes
	desc = "ehof_report_desc"
	immediate = {
		ehof_dest_system = yes
		remove_country_flag = ehof_report_cohesive
	}
	option = { name = OK default_hide_option = yes }
}

# Bountiful
country_event = {
	id = ehof_megastructure.403
	diplomatic = yes
	custom_gui = "giga_bountiful_window"
	title = "ehof_report_bountiful_header"
	show_sound = "event_finding_loot"
	location = event_target:ehof_destination_system
	is_triggered_only = yes
	desc = "ehof_report_desc"
	immediate = {
		ehof_dest_system = yes
		remove_country_flag = ehof_report_bountiful
	}
	option = { name = OK default_hide_option = yes }
}

# Quest
country_event = {
	id = ehof_megastructure.404
	diplomatic = yes
	custom_gui = "giga_quest_window"
	title = "ehof_report_quest_header"
	show_sound = "event_finding_loot"
	location = event_target:ehof_destination_system
	is_triggered_only = yes
	desc = "ehof_report_desc"
	immediate = {
		ehof_dest_system = yes
		remove_country_flag = ehof_report_quest
	}
	option = { name = OK default_hide_option = yes }
}

# SA Standard
country_event = {
	id = ehof_megastructure.4011
	diplomatic = yes
	custom_gui = "giga_sa_standard_window"
	title = "ehof_report_standard_header"
	show_sound = "event_lootbox_galatron"
	location = event_target:ehof_destination_system
	is_triggered_only = yes
	desc = "ehof_report_desc"
	immediate = {
		ehof_dest_system = yes
		remove_country_flag = ehof_report_standard
	}
	option = { name = OK default_hide_option = yes }
}

# SA Cohesive
country_event = {
	id = ehof_megastructure.4021
	diplomatic = yes
	custom_gui = "giga_sa_cohesive_window"
	title = "ehof_report_cohesive_header"
	show_sound = "event_lootbox_galatron"
	location = event_target:ehof_destination_system
	is_triggered_only = yes
	desc = "ehof_report_desc"
	immediate = {
		ehof_dest_system = yes
		remove_country_flag = ehof_report_cohesive
	}
	option = { name = OK default_hide_option = yes }
}

# SA Bountiful
country_event = {
	id = ehof_megastructure.4031
	diplomatic = yes
	custom_gui = "giga_sa_bountiful_window"
	title = "ehof_report_bountiful_header"
	show_sound = "event_finding_loot"
	location = event_target:ehof_destination_system
	is_triggered_only = yes
	desc = "ehof_report_desc"
	immediate = {
		ehof_dest_system = yes
		remove_country_flag = ehof_report_bountiful
	}
	option = { name = OK default_hide_option = yes }
}

# SA Quest
country_event = {
	id = ehof_megastructure.4041
	diplomatic = yes
	custom_gui = "giga_sa_quest_window"
	title = "ehof_report_quest_header"
	show_sound = "event_finding_loot"
	location = event_target:ehof_destination_system
	is_triggered_only = yes
	desc = "ehof_report_desc"
	immediate = {
		ehof_dest_system = yes
		remove_country_flag = ehof_report_quest
	}
	option = { name = OK default_hide_option = yes }
}

# Dismantle Dialog
country_event = {
	id = ehof_megastructure.410
	title = "ehof_ehof"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "ehof_mainui_window"
	picture_event_data = {
		portrait = root
		graphical_culture = root
		room = "ehof_room"
	}
	location = event_target:ehof_megastructure_system
	desc = "ehof_megastructure.410.desc"

	option = {
		custom_gui = "ehof_mainui_option_big"
		name = "ehof_megastructure.410.a"
		hidden_effect = {
			if = { limit = { has_country_flag = ehof_travel_diplomacy }		remove_country_flag = ehof_travel_diplomacy }
			if = { limit = { has_country_flag = ehof_can_activate }			remove_country_flag = ehof_can_activate }
			if = { limit = { has_country_flag = ehof_can_deactivate }		remove_country_flag = ehof_can_deactivate }
			if = { limit = { has_country_flag = ehof_activating }			remove_country_flag = ehof_activating }
			if = { limit = { has_country_flag = ehof_activated }			remove_country_flag = ehof_activated }
			if = { limit = { has_country_flag = ehof_is_upgrading }			remove_country_flag = ehof_is_upgrading }
			if = { limit = { has_country_flag = ehof_on_cooldown }			remove_country_flag = ehof_on_cooldown }
			if = { limit = { has_country_flag = ehof_p0_first_time }		remove_country_flag = ehof_p0_first_time }
			if = { limit = { has_country_flag = ehof_p1_first_time }		remove_country_flag = ehof_p1_first_time }
			if = { limit = { has_country_flag = ehof_p2_first_time }		remove_country_flag = ehof_p2_first_time }
			if = { limit = { has_country_flag = ehof_p3_first_time }		remove_country_flag = ehof_p3_first_time }
			if = { limit = { has_country_flag = ehof_p4_first_time }		remove_country_flag = ehof_p4_first_time }
			if = { limit = { has_country_flag = ehof_restored_first_time }	remove_country_flag = ehof_restored_first_time }
			random_system_within_border = {
				limit = { has_an_active_ehof = yes }
				remove_star_flag = ehof_megastructure_system@root
				every_system_megastructure = { limit = { is_any_ehof = yes } remove_megastructure = this }
				every_system_planet = {
					remove_planet_flag = cant_target_this_planet
					remove_planet_flag = cant_build_here
					remove_planet_flag = has_megastructure
					remove_planet_flag = megastructure
				}
				star = { change_pc = pc_black_hole }
			}
			set_variable = { which = ehof_phase value = 0 }
		}
	}

	option = { custom_gui = "ehof_mainui_option_big" name = "ehof_goback"		ehof_go_back = yes }
	option = { custom_gui = "ehof_mainui_option_big" name = "ehof_leavestation" ehof_leave_station = yes default_hide_option = yes }
}