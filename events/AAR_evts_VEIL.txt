namespace = AAR_evt_VEIL
#	aar铁幕aura自毁
#	aar铁幕ai飞升
#	aar铁幕pc飞升	/aar铁幕lab建设/aar铁幕lab重建/aar铁幕lab完成	/aar铁幕lab领袖事故/aar铁幕lab领袖奖励	/aar铁幕lab星球事故	/aar铁幕lab研究结束
#	aar铁幕pc保底
#	aar铁幕协议半年




###	aar铁幕aura自毁
#_eft	<AAR铁幕AURA>
fleet_event = {
	id = AAR_evt_VEIL.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		destroy_fleet = this
	}
}




###	aar铁幕ai飞升
#_ap	<AP铁幕>
country_event = {
	id = AAR_evt_VEIL.2
	hide_window = yes
	is_triggered_only = yes
	trigger = { NOT = { has_technology = AAR_tech_AP_VEIL } }

	immediate = {
		give_technology = { message = no	tech = AAR_tech_AP_VEIL }	# 铁幕科技
		#	AAR铁幕LAB清理
		AAR_eft_glbl_VEIL_lab_CLEAN = yes
	}
}




###	aar铁幕pc飞升
#_ap	<AP铁幕>
country_event = {
	id = AAR_evt_VEIL.3
	title = AAR_evt_VEIL_ap_take
	desc = AAR_desc_VEIL_ap_take
	picture = GFX_evt_decryption
	show_sound = event_encrypted_comms
	location = root.capital_scope
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = AAR_flg_cntr_VEIL_ap_take } }

	immediate = {
		set_timed_country_flag = { flag = AAR_flg_cntr_VEIL_ap_take days = 1 }	# |单次触发|
		country_event = { id = AAR_evt_VEIL.30 days = 180 }	# aar铁幕lab建设
	}
}

###	aar铁幕lab建设
#_evt	<aar铁幕pc飞升>
country_event = {
	id = AAR_evt_VEIL.30
	title = AAR_evt_VEIL_lab
	desc = AAR_desc_VEIL_lab
	picture = GFX_AAR_evt_VEIL_project_1
	show_sound = event_laboratory_sound
	location = root.capital_scope
	is_triggered_only = yes

	##	母星		=25
	option = {
		name = AAR_option_VEIL_lab_capital
		custom_tooltip = AAR_tips_VEIL_lab_capital
		hidden_effect = {
			#	事件链
			if = { limit = { NOT = { has_event_chain = AAR_chain_CORE } }
				begin_event_chain = { event_chain = AAR_chain_CORE target = root }
			}
			#	|相位转移进度|
			set_variable = { which = AAR_var_cntr_VEIL_tech value = 25 }
			#	实验室建设
			capital_scope = {
				add_modifier = { modifier = AAR_mod_plnt_VEIL_lab_construction days = -1 }
				planet_event = { id = AAR_evt_VEIL.31 days = 180 }	# aar铁幕lab完成
			}
		}
	}
	##	其他星球	=10
	option = {
		name = AAR_option_VEIL_lab_other
		custom_tooltip = AAR_tips_VEIL_lab_other
		allow = {
			hidden_trigger = {
				count_owned_planet = { count > 0
					limit = {
						is_capital = no
						is_colony = yes
						is_under_colonization = no
					}
				}
			}
		}
		hidden_effect = {
			#	事件链
			if = { limit = { NOT = { has_event_chain = AAR_chain_CORE } }
				begin_event_chain = { event_chain = AAR_chain_CORE target = root }
			}
			#	|相位转移进度|
			set_variable = { which = AAR_var_cntr_VEIL_tech value = 10 }
			#	实验室建设
			random_owned_planet = { limit = { is_capital = no }
				add_modifier = { modifier = AAR_mod_plnt_VEIL_lab_construction days = -1 }
				planet_event = { id = AAR_evt_VEIL.31 days = 180 }	# aar铁幕lab完成
			}
		}
	}
}
###	aar铁幕lab重建
#_sp	<铁幕特殊项目>
country_event = {
	id = AAR_evt_VEIL.300
	title = AAR_evt_VEIL_lab_REBUILD
	desc = AAR_desc_VEIL_lab_REBUILD
	picture = GFX_evt_physics_research
	show_sound = event_laboratory_sound
	location = root.capital_scope
	is_triggered_only = yes

	##	母星
	option = {
		name = AAR_option_VEIL_lab_capital
		custom_tooltip = AAR_tips_VEIL_lab_capital
		hidden_effect = {
			#	事件链
			if = { limit = { NOT = { has_event_chain = AAR_chain_CORE } }
				begin_event_chain = { event_chain = AAR_chain_CORE target = root }
			}
			#	实验室建设
			capital_scope = {
				add_modifier = { modifier = AAR_mod_plnt_VEIL_lab_construction days = -1 }
				planet_event = { id = AAR_evt_VEIL.31 days = 180 }	# aar铁幕lab完成
			}
		}
	}
	##	其他星球
	option = {
		name = AAR_option_VEIL_lab_other
		custom_tooltip = AAR_tips_VEIL_lab_other
		allow = {
			hidden_trigger = {
				count_owned_planet = { count > 0
					limit = {
						is_capital = no
						is_colony = yes
						is_under_colonization = no
					}
				}
			}
		}
		hidden_effect = {
			#	事件链
			if = { limit = { NOT = { has_event_chain = AAR_chain_CORE } }
				begin_event_chain = { event_chain = AAR_chain_CORE target = root }
			}
			#	实验室建设
			random_owned_planet = { limit = { is_capital = no }
				add_modifier = { modifier = AAR_mod_plnt_VEIL_lab_construction days = -1 }
				planet_event = { id = AAR_evt_VEIL.31 days = 180 }	# aar铁幕lab完成
			}
		}
	}
}

###	aar铁幕lab完成
#_evt	<aar铁幕lab建设/aar铁幕lab重建>
planet_event = {
	id = AAR_evt_VEIL.31
	title = AAR_evt_VEIL_lab_done
	desc = AAR_desc_VEIL_lab_done
	picture = GFX_evt_physics_research
	show_sound = event_construction
	location = root
	is_triggered_only = yes
	
	##	OK
	option = {
		name = OK
		custom_tooltip = AAR_tips_VEIL_lab_done
		hidden_effect = {
			#	修正SWITCH
			remove_modifier = AAR_mod_plnt_VEIL_lab_construction
			add_modifier = { modifier = AAR_mod_plnt_VEIL_lab days = -1 }
			#	添加特殊项目
			enable_special_project = { name = AAR_sp_VEIL_tech_CLOSED	owner = owner }
			enable_special_project = { name = AAR_sp_VEIL_tech_OPEN		owner = owner }
		}
	}
}


###	aar铁幕lab领袖事故
#_sp	<铁幕特殊项目>
leader_event = {
	id = AAR_evt_VEIL.33
	title = AAR_evt_VEIL_lab_LDR_accident
	desc = AAR_desc_VEIL_lab_LDR_accident
	picture = GFX_evt_archaeologists_escaping
	show_sound = event_ship_explosion
	is_triggered_only = yes
	
	##	遗憾
	option = {
		name = AAR_option_VEIL_lab_LDR_accident_pity
		custom_tooltip = AAR_tips_VEIL_lab_LDR_accident_pity
		trigger = { has_leader_flag = AAR_flg_ldr_VEIL_lab_accident }
		hidden_effect = {
			owner = {
				#	条件不符
				AAR_eft_cntr_VEIL_sp_DB = yes	# AAR铁幕SP_DB
				#	|条件符合|	=重启
				if = { limit = { NOT = { has_country_flag = AAR_flg_cntr_VEIL_sp_CANCEL } }
					abort_special_project = { type = AAR_sp_VEIL_tech_CLOSED }
					abort_special_project = { type = AAR_sp_VEIL_tech_OPEN }
					enable_special_project = { name = AAR_sp_VEIL_tech_CLOSED	owner = this }
					enable_special_project = { name = AAR_sp_VEIL_tech_OPEN		owner = this }
				}
			}
			kill_leader = { show_notification = yes }
		}
	}
	##	受损_智械
	option = {
		name = AAR_option_VEIL_lab_LDR_accident_rescue
		custom_tooltip = AAR_tips_VEIL_lab_LDR_accident_rescue_R
		trigger = {
			NOT = { has_leader_flag = AAR_flg_ldr_VEIL_lab_accident }
			species = { is_robotic = yes }
		}
		hidden_effect = {
			set_leader_flag = AAR_flg_ldr_VEIL_lab_accident
		}
	}
	##	受损_有机
	option = {
		name = AAR_option_VEIL_lab_LDR_accident_rescue
		custom_tooltip = AAR_tips_VEIL_lab_LDR_accident_rescue_O
		trigger = {
			NOT = { has_leader_flag = AAR_flg_ldr_VEIL_lab_accident }
			species = { is_robotic = no }
		}
		random_list = {
			1 = { add_trait = leader_trait_maimed }
			1 = { add_trait = leader_trait_substance_abuser }
		}
		
		hidden_effect = {
			set_leader_flag = AAR_flg_ldr_VEIL_lab_accident
		}
	}
}
###	aar铁幕lab领袖奖励
#_sp	<铁幕特殊项目>
leader_event = {
	id = AAR_evt_VEIL.34
	title = AAR_evt_VEIL_lab_LDR_reward
	desc = AAR_desc_VEIL_lab_LDR_reward
	picture = GFX_evt_alien_propaganda
	show_sound = event_scanner
	is_triggered_only = yes
	
	##	好耶
	option = {
		name = AAR_option_VEIL_lab_LDR_reward
	}
}


###	aar铁幕lab星球事故
#_sp	<铁幕特殊项目>
planet_event = {
	id = AAR_evt_VEIL.35
	title = AAR_evt_VEIL_lab_PLNT_accident
	desc = AAR_desc_VEIL_lab_PLNT_accident
	picture = GFX_AAR_evt_VEIL_project_3
	show_sound = event_ship_explosion
	is_triggered_only = yes
	
	##	遗憾
	option = {
		name = AAR_option_VEIL_lab_PLNT_accident_pity
	}
}


###	aar铁幕lab研究结束
#_sp	<铁幕特殊项目>
#_evt	<aar铁幕pc保底>
country_event = {
	id = AAR_evt_VEIL.36
	title = AAR_evt_VEIL_lab_SUCCESS
	desc = AAR_desc_VEIL_lab_SUCCESS
	picture = GFX_AAR_evt_VEIL_project_2
	show_sound = event_scanner
	is_triggered_only = yes
	
	##	完成
	option = {
		name = AAR_option_VEIL_lab_SUCCESS
	}
}




###	aar铁幕pc保底
#_ap	<AP铁幕>
country_event = {
	id = AAR_evt_VEIL.4
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOR = {
			has_country_flag = AAR_flg_cntr_VEIL_tech_guarantee
			has_technology = AAR_tech_AP_VEIL
		}
	}
	
	immediate = {
		set_timed_country_flag = { flag = AAR_flg_cntr_VEIL_tech_guarantee days = 1 }
		
		give_technology = { message = no	tech = AAR_tech_AP_VEIL }	# 铁幕科技
		AAR_eft_glbl_VEIL_lab_CLEAN = yes		#	AAR铁幕LAB清理
		abort_special_project = { type = AAR_sp_VEIL_tech_CLOSED }
		abort_special_project = { type = AAR_sp_VEIL_tech_OPEN }
		country_event = { id = AAR_evt_VEIL.36 }
	}
}




###	aar铁幕协议半年
#_<VOP_on_monthly_pulse>
event = {
	id = AAR_evt_VEIL.5
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		#	半年
		OR = {
			has_global_flag = FW_MONTH_1
			has_global_flag = FW_MONTH_7
		}
		#	存在铁幕AP国家
		any_country = { has_ascension_perk = AAR_ap_VEIL }
	}

	immediate = {
		every_country = {
			limit = {
			#	has_spynetwork = yes
				OR = {
					is_ai = no
					is_country_type = default
				}
			}

			##	AI
			if = { limit = { is_ai = yes }
				every_spynetwork = {
					limit = {
						is_spynetwork_level > 55
						target = { has_ascension_perk = AAR_ap_VEIL }
					}
					#	破坏间谍网
					switch = { trigger = is_spynetwork_level
						100		> { add_spy_network_level = -45 }
						95		> { add_spy_network_level = -40 }
						90		> { add_spy_network_level = -35 }
						85		> { add_spy_network_level = -30 }
						80		> { add_spy_network_level = -25 }
						75		> { add_spy_network_level = -20 }
						70		> { add_spy_network_level = -15 }
						65		> { add_spy_network_level = -10 }
						60		> { add_spy_network_level = -5 }
						default	= { add_spy_network_level = -1 }
					}
				}
			}
			##	PC
			else = {
				#	信息黑洞
				every_relation = {
					limit = {
						has_ascension_perk = AAR_ap_VEIL
						NOT = { has_overlord = prev }	# 非附庸
						prev = { intel = { who = prev value > 55 } }	# 信息超标
					}
					prev = {
						export_trigger_value_to_variable = {
							trigger = intel
							parameters = { who = prev }
							variable = TEMP_intel
						}
						subtract_variable = { which = TEMP_intel value = 55 }
						random_list = {
							5 = { multiply_variable = { which = TEMP_intel value = 0.75 } }
							5 = { multiply_variable = { which = TEMP_intel value = 1 } }
							5 = { multiply_variable = { which = TEMP_intel value = 1.25 } }
						}
						ceiling_variable = TEMP_intel	# 想上取整
						multiply_variable = { which = TEMP_intel value = -1 }
						add_intel = { amount = TEMP_intel who = prev }
					}
				}
				if = { limit = { is_variable_set = TEMP_intel }		clear_variable = TEMP_intel }
				
				#	破坏间谍网
				every_spynetwork = {
					limit = {
						is_spynetwork_level > 55
						target = {
							has_ascension_perk = AAR_ap_VEIL
							NOT = { has_overlord = prevprev }	# 非附庸
						}
					}
					#	刺杀特使
					if = { limit = { is_spynetwork_level > 75 }
						random_list = {
							50 = { leader = { kill_leader = { show_notification = no } } }
							50 = {}
						}
					}
					#	破坏间谍网
					switch = { trigger = is_spynetwork_level
						100		> { add_spy_network_level = -45 }
						95		> { add_spy_network_level = -40 }
						90		> { add_spy_network_level = -35 }
						85		> { add_spy_network_level = -30 }
						80		> { add_spy_network_level = -25 }
						75		> { add_spy_network_level = -20 }
						70		> { add_spy_network_level = -15 }
						65		> { add_spy_network_level = -10 }
						60		> { add_spy_network_level = -5 }
						default	= { add_spy_network_level = -1 }
					}
				}
			}
		}
	}
}


