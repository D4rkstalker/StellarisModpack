namespace = ag_primitive

# Archaeological Site: Artificial Structures
# Stage 1
fleet_event = {
	id = ag_primitive.11
	title = "ag_primitive.11.name"
	desc = "ag_primitive.11.desc"
	picture = GFX_evt_outpost
	show_sound = event_dig_site
	
	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = "ag_primitive.11.a"
	}
}
# Stage 2
fleet_event = {
	id = ag_primitive.12
	title = "ag_primitive.12.name"
	desc = "ag_primitive.12.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_dig_site
	
	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = "ag_primitive.12.a"
	}
}
# Stage 3
fleet_event = {
	id = ag_primitive.13
	title = "ag_primitive.13.name"
	desc = "ag_primitive.13.desc"
	picture = GFX_evt_underground_city
	show_sound = event_finding_loot
	
	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = "ag_primitive.13.a"
		leader = { add_experience = 100 }
	}
}
# Stage 4
fleet_event = {
	id = ag_primitive.14
	title = "ag_primitive.14.name"
	desc = "ag_primitive.14.desc"
	picture = GFX_evt_ag_ancient_AI
	show_sound = event_finding_loot
	
	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = "ag_primitive.14.a"
		small_artifact_reward = yes
	}
}
# Stage 5
fleet_event = {
	id = ag_primitive.15
	title = "ag_primitive.15.name"
	desc = "ag_primitive.15.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_finding_loot
	
	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = "ag_primitive.15.a"
		small_artifact_reward = yes
	}
}
# Stage 6
fleet_event = {
	id = ag_primitive.16
	title = "ag_primitive.16.name"
	desc = "ag_primitive.16.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_finding_loot
	
	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
		owner = {
			save_event_target_as = ag_system_discover_country
			if = {
				limit = {
					any_system = {
						ag_spawnsystem_trigger = yes
					}
				}
				random_system = {
					limit = {
						ag_spawnsystem_trigger = yes
					}
					save_event_target_as = ag_spawn_system_target
					set_star_flag = ag_spawn_system_target
				}
			}
			else_if = {
				limit = {
					any_rim_system = {
						ag_spawnsystem_trigger_fallback_1 = yes
					}
				}
				random_rim_system = {
					limit = {
						ag_spawnsystem_trigger_fallback_1 = yes
					}
					save_event_target_as = ag_spawn_system_target
					set_star_flag = ag_spawn_system_target
				}
			}
			else_if = {
				limit = {
					any_system = {
						ag_spawnsystem_trigger_fallback_2 = yes
					}
				}
				random_system = {
					limit = {
						ag_spawnsystem_trigger_fallback_2 = yes
					}
					save_event_target_as = ag_spawn_system_target
					set_star_flag = ag_spawn_system_target
				}
			}
			else_if = {
				limit = {
					always = yes
				}
				random_system = {
					save_event_target_as = ag_spawn_system_target
					set_star_flag = ag_spawn_system_target
				}
			}
		}
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = "ag_primitive.16.a"
		large_artifact_reward = yes
		owner = {
			if = {
				limit = {
					NOT = {
						has_event_chain = "ag_hidden_system_chain"
					}
				}
				begin_event_chain = {
					event_chain = "ag_hidden_system_chain"
					target = root.owner
				}
			}
			# ag_spawn_ancient_system = { ag_system_to_spawn = "ag_primitive_system" }
			event_target:ag_spawn_system_target = {
				spawn_system = {
					min_distance >= 20
					max_distance <= 50
					initializer = "ag_primitive_system"
					hyperlane = yes
				}
			}
			if = {
				limit = {
					NOT = {
						has_event_chain = "ag_hidden_system_chain"
					}
				}
				begin_event_chain = {
					event_chain = "ag_hidden_system_chain"
					target = root.owner
				}
			}
			if = {
				limit = {
					OR = {
						has_ethic = ethic_xenophile
						has_ethic = ethic_fanatic_xenophile
					}
				}
				add_resource = { unity = 1000 }
			}
			if = {
				limit = {
					OR = {
						has_ethic = ethic_materialist
						has_ethic = ethic_fanatic_materialist
					}
				}
				add_resource = { physics_research = 1000 }
			}
			if = {
				limit = {
					OR = {
						has_ethic = ethic_spiritualist
						has_ethic = ethic_fanatic_spiritualist
					}
				}
				add_resource = { unity = 1000 }
			}
		}
		hidden_effect = {
			every_country = {
				limit = { NOT = { is_same_value = event_target:ag_system_discover_country } }
				country_event = { id = ag_spawn.33 }
			}
			owner = {
				create_point_of_interest = {
					id = ag_ancient_location_1_poi
					name = "ag_ancient_location_1_poi"
					desc = "ag_ancient_location_1_desc"
					event_chain = "ag_hidden_system_chain"
					location = event_target:ag_primitive_world.solar_system
				}
			}
		}
	}
	# option = {
	# 	name = "ag_primitive.16.b"
	# 	trigger = {
	# 		owner = {
	# 			has_ethic = ethic_fanatic_pacifist
	# 		}
	# 	}
	# 	owner = {
	# 		add_resource = { influence = 200 }
	# 	}
	# 	large_artifact_reward = yes
	# }
}

# on_survey, Scanned 4762 Preserved World
ship_event = {
	id = ag_primitive.31
	title = "ag_primitive.31.name"
	desc = "ag_primitive.31.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_medieval_alien_civilization_room }
	show_sound = event_primitive_civilization
	location = event_target:ag_primitive_world
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_planet_flag = ag_primitive_world
			owner = {
				is_same_value = event_target:ag_primitive_country
			}
		}
		owner = {
			is_ai = no
			NOT = {
				has_country_flag = ag_primitive_31_fired
			}
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = ag_primitive_31_fired
			# remove_point_of_interest = ag_ancient_location_1_poi
			# if = {
			# 	limit = {
			# 		NOT = {
			# 			has_event_chain = "ag_hidden_system_chain"
			# 		}
			# 	}
			# 	begin_event_chain = {
			# 		event_chain = "ag_hidden_system_chain"
			# 		target = root.owner
			# 	}
			# }
			# add_event_chain_counter = {
			# 	event_chain = "ag_hidden_system_chain"
			# 	counter = "ag_ancient_system"
			# 	amount = 1
			# }
		}
	}
	
	option = {
		name = "ag_primitive.31.a"
	}
}

# on_survey, Scanned Shielded World
ship_event = {
	id = ag_primitive.32
	title = "ag_primitive.32.name"
	desc = "ag_primitive.32.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_shielded_planet_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_shielded_moon
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_planet_flag = ag_primitive_shielded_moon
			is_planet_class = pc_shielded
		}
		owner = {
			is_ai = no
			NOT = {
				has_country_flag = ag_primitive_32_fired
			}
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = ag_primitive_32_fired
		}
	}
	
	option = {
		name = "ag_primitive.32.a"
	}
}

# on_planet_attackers_win, Invaded 4762 Preserved World
country_event = {
	id = ag_primitive.41
	title = "ag_primitive.41.name"
	desc = "ag_primitive.41.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_building_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_world
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = ag_primitive_research_mission_flag
		}
		from = {
			is_country_type = primitive
			is_same_value = event_target:ag_primitive_country
		}
		fromfrom = {
			NOT = {
				has_planet_flag = ag_primitive_invaded
			}
		}
	}
	
	immediate = {
		set_country_flag = ag_invaded_primitive_world
		fromfrom = {
			set_planet_flag = ag_primitive_invaded
			set_owner = root
			add_building = ag_ancient_structure
			random_list = {
				50 = {
					remove_building = ag_class_5_singularity
					add_deposit = ag_class_5_singularity_crater
					add_planet_devastation = 15
					root = {
						country_event = { id = ag_primitive.43 }
					}
				}
				50 = {
				}
			}
		}
	}
	
	option = {
		name = "ag_primitive.41.a"
		enable_special_project = {
			name = "ag_primitive_world_research"
			location = event_target:ag_primitive_world
			owner = root
		}
	}
}

# on_planet_attackers_win, Invaded 4762 Preserved World
country_event = {
	id = ag_primitive.42
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = ag_primitive_research_mission_flag
		from = {
			is_country_type = primitive
			is_same_value = event_target:ag_primitive_country
		}
		fromfrom = {
			NOT = {
				has_planet_flag = ag_primitive_invaded
			}
		}
	}
	
	immediate = {
		set_country_flag = ag_invaded_primitive_world
		fromfrom = {
			set_planet_flag = ag_primitive_invaded
			set_owner = root
			add_building = ag_ancient_structure
			random_list = {
				50 = {
					remove_building = ag_class_5_singularity
					add_deposit = ag_class_5_singularity_crater
					add_planet_devastation = 15
					root = {
						country_event = { id = ag_primitive.43 }
					}
				}
				50 = {
				}
			}
		}
	}
}

# Class 5 singularity explode if unlucky
country_event = {
	id = ag_primitive.43
	title = "ag_primitive.43.name"
	desc = "ag_primitive.43.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_nuclear_explosion_room }
	show_sound = event_super_explosion
	location = event_target:ag_primitive_world
	
	is_triggered_only = yes
	
	option = {
		name = "ag_primitive.43.a"
		custom_tooltip = "ag_primitive.43.a.tooltip"
	}
}

# Failsafe Event
country_event = {
	id = ag_primitive.44
	title = "ag_primitive.44.name"
	desc = "ag_primitive.44.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_building_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_world
	
	is_triggered_only = yes

	trigger = {
		NOR = {
			has_country_flag = ag_primitive_research_mission_flag
			has_country_flag = ag_invaded_primitive_world
			has_country_flag = ag_primitive_world_failsafe_flag
		}
		is_primitive = no
		exists = event_target:ag_primitive_world
		event_target:ag_primitive_world = {
			exists = owner
			owner = { is_same_value = root }
		}
		# any_owned_planet = {
		# 	is_same_value = event_target:ag_primitive_world
		# }
	}

	immediate = {
		set_country_flag = ag_primitive_world_failsafe_flag
	}
	
	option = {
		name = "ag_primitive.44.a"
		enable_special_project = {
			name = "ag_primitive_world_research_alt"
			location = event_target:ag_primitive_world
			owner = root
		}
	}
}

# Observation mission
# Stage 1
planet_event = {
	id = ag_primitive.51
	hide_window = yes
	
	trigger = {
		has_observation_outpost = yes
		observation_outpost = {
			has_mission = ag_primitive_research_mission
			mission_progress > 0.25
		}
		observation_outpost_owner = {
			NOT = {
				has_country_flag = ag_primitive_51_fired
			}
		}
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		observation_outpost_owner = {
			set_country_flag = ag_primitive_51_fired
			random_list = {
				50 = {
					modifier = {
						factor = 0.75
						has_ethic = ethic_xenophobe
					}
					modifier = {
						factor = 0.5
						has_ethic = ethic_fanatic_xenophobe
					}
					country_event = { id = ag_primitive.52 }
				}
				50 = {
					country_event = { id = ag_primitive.53 }
				}
			}
		}
	}
}
# Stage 1 succeed
country_event = {
	id = ag_primitive.52
	title = "ag_primitive.52.name"
	desc = "ag_primitive.52.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_medieval_alien_civilization_room }
	show_sound = event_primitive_civilization
	location = event_target:ag_primitive_world
	
	is_triggered_only = yes
	
	option = {
		name = "ag_primitive.52.a"
	}
}
# Stage 1 failed
country_event = {
	id = ag_primitive.53
	title = "ag_primitive.53.name"
	desc = "ag_primitive.53.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_medieval_alien_civilization_room }
	show_sound = event_primitive_civilization
	location = event_target:ag_primitive_world
	
	is_triggered_only = yes
	
	immediate = {
		event_target:ag_primitive_world = {
			observation_outpost = { add_mission_progress = -0.1 }
		}
	}
	
	option = {
		name = "ag_primitive.53.a"
		tooltip = {
			event_target:ag_primitive_world = {
				observation_outpost = { add_mission_progress = -0.1 }
			}
		}
	}
}

# Stage 2
planet_event = {
	id = ag_primitive.54
	hide_window = yes
	
	trigger = {
		has_observation_outpost = yes
		observation_outpost = {
			has_mission = ag_primitive_research_mission
			mission_progress > 0.50
		}
		observation_outpost_owner = {
			NOT = {
				has_country_flag = ag_primitive_54_fired
			}
		}
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		observation_outpost_owner = {
			set_country_flag = ag_primitive_54_fired
			random_list = {
				50 = {
					modifier = {
						factor = 0.75
						has_ethic = ethic_xenophobe
					}
					modifier = {
						factor = 0.5
						has_ethic = ethic_fanatic_xenophobe
					}
					country_event = { id = ag_primitive.55 }
				}
				50 = {
					country_event = { id = ag_primitive.56 }
				}
			}
		}
	}
}
# Stage 2 succeed
country_event = {
	id = ag_primitive.55
	title = "ag_primitive.55.name"
	desc = "ag_primitive.55.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_building_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_world
	
	is_triggered_only = yes
	
	option = {
		name = "ag_primitive.55.a"
	}
}
# Stage 2 failed
country_event = {
	id = ag_primitive.56
	title = "ag_primitive.56.name"
	desc = "ag_primitive.56.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_building_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_world
	
	is_triggered_only = yes
	
	immediate = {
		event_target:ag_primitive_world = {
			observation_outpost = { add_mission_progress = -0.1 }
		}
	}
	
	option = {
		name = "ag_primitive.56.a"
		tooltip = {
			event_target:ag_primitive_world = {
				observation_outpost = { add_mission_progress = -0.1 }
			}
		}
	}
}
# Stage 3
planet_event = {
	id = ag_primitive.57
	hide_window = yes
	
	trigger = {
		has_observation_outpost = yes
		observation_outpost = {
			has_mission = ag_primitive_research_mission
			mission_progress > 0.75
		}
		observation_outpost_owner = {
			NOT = {
				has_country_flag = ag_primitive_57_fired
			}
		}
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		observation_outpost_owner = {
			set_country_flag = ag_primitive_57_fired
			random_list = {
				50 = {
					modifier = {
						factor = 0.75
						has_ethic = ethic_xenophobe
					}
					modifier = {
						factor = 0.5
						has_ethic = ethic_fanatic_xenophobe
					}
					country_event = { id = ag_primitive.58 }
				}
				50 = {
					country_event = { id = ag_primitive.59 }
				}
			}
		}
	}
}
# Stage 3 succeed
country_event = {
	id = ag_primitive.58
	title = "ag_primitive.58.name"
	desc = "ag_primitive.58.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_world
	
	is_triggered_only = yes
	
	option = {
		name = "ag_primitive.58.a"
	}
}
# Stage 3 failed
country_event = {
	id = ag_primitive.59
	title = "ag_primitive.59.name"
	desc = "ag_primitive.59.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_world
	
	is_triggered_only = yes
	
	immediate = {
		event_target:ag_primitive_world = {
			observation_outpost = { add_mission_progress = -0.1 }
		}
	}
	
	option = {
		name = "ag_primitive.59.a"
		tooltip = {
			event_target:ag_primitive_world = {
				observation_outpost = { add_mission_progress = -0.1 }
			}
		}
	}
}

# Research completed
country_event = {
	id = ag_primitive.61
	title = "ag_primitive.61.name"
	desc = {
		trigger = {
			has_country_flag = ag_primitive_research_mission_flag
		}
		text = "ag_primitive.61.a.desc"
	}
	desc = {
		trigger = {
			has_country_flag = ag_invaded_primitive_world
		}
		text = "ag_primitive.61.b.desc"
	}
	desc = {
		trigger = {
			NOR = {
				has_country_flag = ag_primitive_research_mission_flag
				has_country_flag = ag_invaded_primitive_world
			}
		}
		text = "ag_primitive.61.c.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_archaeological_dig_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_world_2
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = ag_primitive_61_fired
		}
	}
	
	immediate = {
		set_country_flag = ag_primitive_61_fired
		if = {
			limit = {
				NOT = { has_country_flag = ag_primitive_world_failsafe_flag }
			}
			set_country_flag = ag_primitive_research_mission_flag
		}
		set_global_flag = ag_primitive_research_mission_global_flag
		save_event_target_as = ag_system_discover_country
	}
	
	option = {
		name = "ag_primitive.61.a"
		ag_spawn_ancient_system = { ag_system_to_spawn = "ag_primitive_system_2" }
		hidden_effect = {
			change_variable = { which = ag_ancient_preserved_world_events_counter value = 1 }
			every_country = {
				limit = { NOT = { is_same_value = event_target:ag_system_discover_country } }
				country_event = { id = ag_spawn.33 }
			}
			if = {
				limit = {
					NOT = {
						has_event_chain = "ag_hidden_system_chain"
					}
				}
				begin_event_chain = {
					event_chain = "ag_hidden_system_chain"
					target = root
				}
			}
			create_point_of_interest = {
				id = ag_ancient_location_2_poi
				name = "ag_ancient_location_2_poi"
				desc = "ag_ancient_location_2_desc"
				event_chain = "ag_hidden_system_chain"
				location = event_target:ag_primitive_world_2.solar_system
			}
		}
	}
}

# on_survey, Scanned 5524 Preserved World
ship_event = {
	id = ag_primitive.71
	title = "ag_primitive.71.name"
	desc = "ag_primitive.71.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_metropolis_room }
	show_sound = event_scanner
	location = event_target:ag_primitive_world_2
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_planet_flag = ag_primitive_world_2
			owner = {
				is_same_value = event_target:ag_primitive_country_2
			}
		}
		owner = {
			is_ai = no
			NOT = {
				has_country_flag = ag_primitive_71_fired
			}
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = ag_primitive_71_fired
		}
	}
	
	option = {
		name = "ag_primitive.71.a"
	}
}

# Observation mission
# Stage 1
planet_event = {
	id = ag_primitive.81
	hide_window = yes
	
	trigger = {
		has_observation_outpost = yes
		observation_outpost = {
			has_mission = ag_primitive_2_research_mission
			mission_progress > 0.33
		}
		observation_outpost_owner = {
			NOT = {
				has_country_flag = ag_primitive_81_fired
			}
		}
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		event_target:ag_primitive_country_2 = {
			set_name = "NAME_ag_primitive_country_2"
		}
		observation_outpost_owner = {
			set_country_flag = ag_primitive_81_fired
			random_list = {
				50 = {
					modifier = {
						factor = 0.75
						has_ethic = ethic_xenophobe
					}
					modifier = {
						factor = 0.5
						has_ethic = ethic_fanatic_xenophobe
					}
					country_event = { id = ag_primitive.82 }
				}
				50 = {
					country_event = { id = ag_primitive.83 }
				}
			}
		}
	}
}
# Stage 1 succeed
country_event = {
	id = ag_primitive.82
	title = "ag_primitive.82.name"
	desc = "ag_primitive.82.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_metropolis_room }
	show_sound = event_scanner
	location = event_target:ag_primitive_world_2
	
	is_triggered_only = yes
	
	option = {
		name = "ag_primitive.82.a"
		custom_tooltip = "ag_primitive.82.a.tooltip"
		hidden_effect = {
			country_event = { id = ag_primitive.84 }
		}
	}
	option = {
		name = "ag_primitive.82.b"
		custom_tooltip = "ag_primitive.82.b.tooltip"
		hidden_effect = {
			country_event = { id = ag_primitive.86 }
		}
	}
	option = {
		name = "ag_primitive.82.c"
		custom_tooltip = "ag_primitive.82.c.tooltip"
	}
}
# Stage 1 failed
country_event = {
	id = ag_primitive.83
	title = "ag_primitive.83.name"
	desc = "ag_primitive.83.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_metropolis_room }
	show_sound = event_scanner
	location = event_target:ag_primitive_world_2
	
	is_triggered_only = yes
	
	immediate = {
		event_target:ag_primitive_world_2 = {
			observation_outpost = { add_mission_progress = -0.15 }
		}
	}
	
	option = {
		name = "ag_primitive.83.a"
		tooltip = {
			event_target:ag_primitive_world_2 = {
				observation_outpost = { add_mission_progress = -0.15 }
			}
		}
	}
}
# Stage 1-a
country_event = {
	id = ag_primitive.84
	title = "ag_primitive.84.name"
	desc = "ag_primitive.84.desc"
	
	is_triggered_only = yes
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		portrait = event_target:ag_primitive_species
		planet_background = event_target:ag_primitive_world_2
		graphical_culture = fallen_empire_04
		city_level = event_target:ag_primitive_world_2
		room = personality_metalheads_room
	}
	
	option = {
		name = "ag_primitive.84.a"
		is_dialog_only = yes
		response_text = "ag_primitive.84.a.response"
	}
	option = {
		name = "ag_primitive.84.b"
		hidden_effect = {
			country_event = { id = ag_primitive.85 }
		}
	}
}
country_event = {
	id = ag_primitive.85
	title = "ag_primitive.85.name"
	desc = "ag_primitive.85.desc"
	
	is_triggered_only = yes
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		portrait = event_target:ag_primitive_species
		planet_background = event_target:ag_primitive_world_2
		graphical_culture = fallen_empire_04
		city_level = event_target:ag_primitive_world_2
		room = personality_metalheads_room
	}
	
	option = {
		name = "ag_primitive.85.a"
		response_text = "ag_primitive.85.a.response"
		add_resource = {
			energy = -25
			minerals = -25
			food = -10
			alloys = -5
		}
		hidden_effect = {
			set_country_flag = ag_primitive_2_research_researcher
		}
	}
	option = {
		name = "ag_primitive.85.b"
		response_text = "ag_primitive.85.b.response"
	}
}
# Stage 1-b
country_event = {
	id = ag_primitive.86
	title = "ag_primitive.86.name"
	desc = "ag_primitive.86.desc"
	
	is_triggered_only = yes
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		portrait = event_target:ag_primitive_species
		planet_background = event_target:ag_primitive_world_2
		graphical_culture = fallen_empire_04
		city_level = event_target:ag_primitive_world_2
		room = personality_fallen_empire_red_room
	}
	
	option = {
		name = "ag_primitive.86.a"
		is_dialog_only = yes
		response_text = "ag_primitive.86.a.response"
	}
	option = {
		name = "ag_primitive.86.b"
		hidden_effect = {
			country_event = { id = ag_primitive.87 }
		}
	}
}
country_event = {
	id = ag_primitive.87
	title = "ag_primitive.87.name"
	desc = "ag_primitive.87.desc"
	
	is_triggered_only = yes
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		portrait = event_target:ag_primitive_species
		planet_background = event_target:ag_primitive_world_2
		graphical_culture = fallen_empire_04
		city_level = event_target:ag_primitive_world_2
		room = personality_fallen_empire_red_room
	}
	
	option = {
		name = "ag_primitive.87.a"
		response_text = "ag_primitive.87.a.response"
		add_resource = {
			energy = -50
			minerals = -25
			alloys = -5
		}
		hidden_effect = {
			set_country_flag = ag_primitive_2_research_priest
		}
	}
	option = {
		name = "ag_primitive.87.b"
	}
}
# Stage 2
planet_event = {
	id = ag_primitive.88
	hide_window = yes
	
	trigger = {
		has_observation_outpost = yes
		observation_outpost = {
			has_mission = ag_primitive_2_research_mission
			mission_progress > 0.67
		}
		observation_outpost_owner = {
			NOT = {
				has_country_flag = ag_primitive_88_fired
			}
		}
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		observation_outpost_owner = {
			set_country_flag = ag_primitive_88_fired
			random_list = {
				50 = {
					modifier = {
						factor = 0.75
						has_ethic = ethic_xenophobe
					}
					modifier = {
						factor = 0.5
						has_ethic = ethic_fanatic_xenophobe
					}
					country_event = { id = ag_primitive.89 }
				}
				50 = {
					modifier = {
						factor = 0.1
						OR = {
							has_country_flag = ag_primitive_2_research_researcher
							has_country_flag = ag_primitive_2_research_priest
						}
					}
					country_event = { id = ag_primitive.90 }
				}
			}
		}
	}
}
# Stage 2 succeed
country_event = {
	id = ag_primitive.89
	title = "ag_primitive.89.name"
	desc = {
		trigger = {
			NOR = {
				has_country_flag = ag_primitive_2_research_researcher
				has_country_flag = ag_primitive_2_research_priest
			}
		}
		text = "ag_primitive.89.c.desc"
	}
	desc = {
		trigger = {
			has_country_flag = ag_primitive_2_research_researcher
		}
		text = "ag_primitive.89.a.desc"
	}
	desc = {
		trigger = {
			has_country_flag = ag_primitive_2_research_priest
		}
		text = "ag_primitive.89.b.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_building_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_world_2
	
	is_triggered_only = yes
	
	option = {
		name = "ag_primitive.89.a"
	}
}
# Stage 2 failed
country_event = {
	id = ag_primitive.90
	title = "ag_primitive.90.name"
	desc = {
		trigger = {
			NOR = {
				has_country_flag = ag_primitive_2_research_researcher
				has_country_flag = ag_primitive_2_research_priest
			}
		}
		text = "ag_primitive.90.a.desc"
	}
	desc = {
		trigger = {
			has_country_flag = ag_primitive_2_research_researcher
		}
		text = "ag_primitive.90.b.desc"
	}
	desc = {
		trigger = {
			has_country_flag = ag_primitive_2_research_priest
		}
		text = "ag_primitive.90.c.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_building_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_world_2
	
	is_triggered_only = yes
	
	immediate = {
		event_target:ag_primitive_world_2 = {
			observation_outpost = { add_mission_progress = -0.2 }
		}
	}
	
	option = {
		name = "ag_primitive.90.a"
		tooltip = {
			event_target:ag_primitive_world_2 = {
				observation_outpost = { add_mission_progress = -0.2 }
			}
		}
	}
}

# Research completed
country_event = {
	id = ag_primitive.91
	title = "ag_primitive.91.name"
	desc = {
		trigger = {
			has_country_flag = ag_primitive_2_research_mission_flag
			NOR = {
				has_country_flag = ag_primitive_2_research_researcher
				has_country_flag = ag_primitive_2_research_priest
				has_country_flag = ag_invaded_primitive_2_world
			}
		}
		text = "ag_primitive.91.a.desc"
	}
	desc = {
		trigger = {
			has_country_flag = ag_primitive_2_research_mission_flag
			OR = {
				has_country_flag = ag_primitive_2_research_researcher
				has_country_flag = ag_primitive_2_research_priest
			}
			NOT = {
				has_country_flag = ag_invaded_primitive_2_world
			}
		}
		text = "ag_primitive.91.b.desc"
	}
	desc = {
		trigger = {
			has_country_flag = ag_invaded_primitive_2_world
		}
		text = "ag_primitive.91.c.desc"
	}
	desc = {
		trigger = {
			NOR = {
				has_country_flag = ag_primitive_2_research_mission_flag
				has_country_flag = ag_invaded_primitive_2_world
			}
		}
		text = "ag_primitive.91.d.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_archaeological_dig_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_broken_world
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = ag_primitive_91_fired
		}
	}
	
	immediate = {
		set_country_flag = ag_primitive_91_fired
		if = {
			limit = {
				NOT = { has_country_flag = ag_primitive_world_2_failsafe_flag }
			}
			set_country_flag = ag_primitive_2_research_mission_flag
		}
		set_global_flag = ag_primitive_2_research_mission_global_flag
		save_event_target_as = ag_system_discover_country
		if = {
			limit = {
				OR = {
					has_country_flag = ag_primitive_2_research_researcher
					has_country_flag = ag_primitive_2_research_priest
				}
				NOT = {
					has_country_flag = ag_invaded_primitive_2_world
				}
			}
			event_target:ag_primitive_country_2 = {
				remove_country_flag = ag_primitive_age_2
				set_country_flag = early_space_age
				set_primitive_age = early_space_age
				set_name = "NAME_ag_primitive_country_2"
				change_government = {
					civics = {
						civic = civic_increasing_urbanization
						civic = civic_atmospheric_pollution
					}
				}
			}
			if = {
				limit = {
					has_country_flag = ag_primitive_2_research_researcher
				}
				event_target:ag_primitive_country_2 = {
					random_list = {
						75 = { shift_ethic = "ethic_materialist" }
						25 = { shift_ethic = "ethic_fanatic_materialist" }
					}
					random_owned_pop = { pop_change_ethic = "ethic_materialist" }
				}
			}
			event_target:ag_primitive_world_2 = {
				remove_building = ag_class_5_singularity
				remove_building = ag_primitive_factory
				remove_building = ag_primitive_mine
				remove_building = ag_primitive_power_plant
				remove_building = ag_primitive_farm
				remove_building = ag_urban_dwellings
				remove_building = ag_ancient_structure_primitive_2
				add_building = ag_ancient_structure
				add_building = building_primitive_factory
				add_building = building_primitive_factory
				add_building = building_primitive_mine
				add_building = building_primitive_mine
				add_building = building_primitive_power_plant
				add_building = building_primitive_farm
				add_building = building_urban_dwellings
				add_building = building_primitive_capital
			}
		}
		if = {
			limit = {
				OR = {
					has_country_flag = ag_primitive_2_research_researcher
					has_country_flag = ag_primitive_2_research_priest
				}
				NOR = {
					has_country_flag = ag_invaded_primitive_2_world
					has_ethic = ethic_fanatic_xenophile
					has_ethic = ethic_xenophile
				}
			}
			country_event = { id = ag_primitive.92 days = 5 random = 1 }
		}
	}
	
	option = {
		name = "ag_primitive.91.a"
		ag_spawn_ancient_system = { ag_system_to_spawn = "ag_primitive_system_3" }
		hidden_effect = {
			change_variable = { which = ag_ancient_preserved_world_events_counter value = 1 }
			every_country = {
				limit = { NOT = { is_same_value = event_target:ag_system_discover_country } }
				country_event = { id = ag_spawn.33 }
			}
			if = {
				limit = {
					NOT = {
						has_event_chain = "ag_hidden_system_chain"
					}
				}
				begin_event_chain = {
					event_chain = "ag_hidden_system_chain"
					target = root
				}
			}
			create_point_of_interest = {
				id = ag_ancient_location_3_poi
				name = "ag_ancient_location_3_poi"
				desc = "ag_ancient_location_3_desc"
				event_chain = "ag_hidden_system_chain"
				location = event_target:ag_primitive_broken_world
			}
		}
	}
}

# Give a class 5 singularity if observation mission finished
country_event = {
	id = ag_primitive.92
	title = "ag_primitive.92.name"
	desc = "ag_primitive.92.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_metropolis_room }
	show_sound = event_alien_signal

	is_triggered_only = yes
	
	option = {
		name = "ag_primitive.92.a"
		custom_tooltip = "ag_primitive.92.a.tooltip"
		hidden_effect = {
			change_variable = {
				which = ag_class_5_singularity_counter
				value = 1
			}
		}
	}
}

# Primitive's revenge
planet_event = {
	id = ag_primitive.101
	hide_window = yes
	
	mean_time_to_happen = {
		months = 24
	}
	
	trigger = {
		has_observation_outpost = yes
		observation_outpost = {
			has_mission = ag_primitive_2_research_mission
			mission_progress > 0.67
			mission_progress < 0.90
		}
		observation_outpost_owner = {
			NOT = {
				has_country_flag = ag_primitive_101_fired
			}
			has_country_flag = ag_primitive_88_fired
			OR = {
				has_country_flag = ag_primitive_2_research_researcher
				has_country_flag = ag_primitive_2_research_priest
			}
		}
	}
	
	immediate ={
		observation_outpost_owner = {
			set_country_flag = ag_primitive_101_fired
			country_event = { id = ag_primitive.102 }
		}
	}
}
country_event = {
	id = ag_primitive.102
	title = "ag_primitive.102.name"
	desc = "ag_primitive.102.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_star_chart_room }
	show_sound = event_radio_chatter
	location = event_target:ag_primitive_world_2

	is_triggered_only = yes
	
	option = {
		name = "ag_primitive.102.a"
		hidden_effect = {
			if = {
				limit = {
					has_country_flag = ag_primitive_2_research_researcher
				}
				country_event = { id = ag_primitive.103 }
			}
			if = {
				limit = {
					has_country_flag = ag_primitive_2_research_priest
				}
				country_event = { id = ag_primitive.104 }
			}
		}
	}
}
country_event = {
	id = ag_primitive.103
	title = "ag_primitive.103.name"
	desc = "ag_primitive.103.desc"
	
	is_triggered_only = yes
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		portrait = event_target:ag_primitive_species
		planet_background = event_target:ag_primitive_world_2
		graphical_culture = fallen_empire_04
		city_level = event_target:ag_primitive_world_2
		room = personality_fallen_empire_red_room
	}
	
	option = {
		name = "ag_primitive.103.a"
		hidden_effect = {
			country_event = { id = ag_primitive.105 days = 10 random = 10 }
		}
	}
	option = {
		name = "ag_primitive.103.b"
		hidden_effect = {
			country_event = { id = ag_primitive.105 days = 10 random = 10 }
		}
	}
	option = {
		name = "ag_primitive.103.c"
		hidden_effect = {
			country_event = { id = ag_primitive.105 days = 10 random = 10 }
		}
	}
}
country_event = {
	id = ag_primitive.104
	title = "ag_primitive.104.name"
	desc = "ag_primitive.104.desc"
	
	is_triggered_only = yes
	
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	
	picture_event_data = {
		portrait = event_target:ag_primitive_species
		planet_background = event_target:ag_primitive_world_2
		graphical_culture = fallen_empire_04
		city_level = event_target:ag_primitive_world_2
		room = personality_metalheads_room
	}
	
	option = {
		name = "ag_primitive.104.a"
		hidden_effect = {
			country_event = { id = ag_primitive.105 days = 10 random = 10 }
		}
	}
	option = {
		name = "ag_primitive.104.b"
		hidden_effect = {
			country_event = { id = ag_primitive.105 days = 10 random = 10 }
		}
	}
	option = {
		name = "ag_primitive.104.c"
		hidden_effect = {
			country_event = { id = ag_primitive.105 days = 10 random = 10 }
		}
	}
}

# Spawn Primitive fleet
country_event = {
	id = ag_primitive.105
	title = "ag_primitive.105.name"
	desc = "ag_primitive.105.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_fleet_evil_room }
	show_sound = event_radio_chatter
	location = event_target:ag_primitive_world_2

	is_triggered_only = yes
	
	immediate = {
		create_country = {
			name = "NAME_ag_primitive_country_2"
			type = ag_ancient_guardian_passive
			flag = {
				icon={
					category="special"
					file="extradimensional_01.dds"
				}
				background={
					category="backgrounds"
					file="circle.dds"
				}
				colors={
					"dark_grey"
					"green"
					"null"
					"null"
				}
			}
		}
		last_created_country = {
			set_country_flag = ag_primitive_country_2_fleet
			save_global_event_target_as = ag_primitive_country_2_fleet
			set_faction_hostility = {
				target = event_target:ag_primitive_country_2
				set_hostile = no
				set_neutral = no
				set_friendly = yes
			}
			set_faction_hostility = {
				target = root
				set_hostile = yes
				set_neutral = no
				set_friendly = no
			}
		}
		if = {
			limit = {
				has_country_flag = ag_primitive_2_research_researcher
			}
			create_fleet = {
				name = "NAME_ag_primitive_fleet_1"
				settings = {
					spawn_debris = no
				}
				effect = {
					set_owner = event_target:ag_primitive_country_2_fleet
					set_fleet_flag = ag_primitive_2_fleet
					while = {
						count = 2
						create_ship = {
							name = "NAME_ag_primitive_titan"
							design = "NAME_ag_primitive_titan_2"
							prefix = no
							
							effect = {
								ag_difficulty_bonus = yes
							}
						}
					}
					while = {
						count = 10
						create_ship = {
							name = "NAME_ag_primitive_corvette"
							design = "NAME_ag_primitive_corvette_1"
							prefix = no
							
							effect = {
								ag_difficulty_bonus = yes
							}
						}
					}
					while = {
						count = 10
						create_ship = {
							name = "NAME_ag_primitive_corvette"
							design = "NAME_ag_primitive_corvette_2"
							prefix = no
							
							effect = {
								ag_difficulty_bonus = yes
							}
						}
					}
					set_location = {
						target = event_target:ag_primitive_world_2
						distance = 20
						angle = 233
					}
				}
			}
		}
		else = {
			create_fleet = {
				name = "NAME_ag_primitive_fleet_2"
				settings = {
					spawn_debris = no
				}
				effect = {
					set_owner = event_target:ag_primitive_country_2_fleet
					set_fleet_flag = ag_primitive_2_fleet
					while = {
						count = 1
						create_ship = {
							name = "NAME_ag_primitive_titan"
							design = "NAME_ag_primitive_titan_1"
							prefix = no
							
							effect = {
								add_modifier = {
									modifier = ag_primitive_ship_ancient
									days = -1
								}
								ag_difficulty_bonus = yes
							}
						}
					}
					set_location = {
						target = event_target:ag_primitive_world_2
						distance = 20
						angle = 233
					}
				}
			}
		}
	}
	
	option = {
		name = "ag_primitive.105.a"
	}
}

# on_fleet_destroyed_perp, Primitive fleet destroyed
country_event = {
	id = ag_primitive.106
	title = "ag_primitive.106.name"
	desc = "ag_primitive.106.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_space_battle
	location = event_target:ag_primitive_world_2

	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		from = {
			count_owned_ship = {
				count < 1
			}
		}
		fromfromfrom = {
			has_fleet_flag = ag_primitive_2_fleet
		}
	}
	
	immediate = {
		from = {
			destroy_country = yes
		}
	}
	
	option = {
		name = "ag_primitive.106.a"
	}
}

# on_planet_attackers_win, Invaded 5524 Preserved World
country_event = {
	id = ag_primitive.111
	title = "ag_primitive.111.name"
	desc = "ag_primitive.111.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_building_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_world_2
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = ag_primitive_2_research_mission_flag
		}
		from = {
			is_country_type = primitive
			is_same_value = event_target:ag_primitive_country_2
		}
		fromfrom = {
			NOT = {
				has_planet_flag = ag_primitive_2_invaded
			}
		}
	}
	
	immediate = {
		set_country_flag = ag_invaded_primitive_2_world
		fromfrom = {
			set_planet_flag = ag_primitive_2_invaded
			set_owner = root
			add_building = ag_ancient_structure
			random_list = {
				50 = {
					remove_building = ag_class_5_singularity
					add_deposit = ag_class_5_singularity_crater
					add_planet_devastation = 15
					root = {
						country_event = { id = ag_primitive.113 }
					}
				}
				50 = {
				}
			}
		}
	}
	
	option = {
		name = "ag_primitive.111.a"
		enable_special_project = {
			name = "ag_primitive_world_2_research"
			location = event_target:ag_primitive_world_2
			owner = root
		}
	}
}
# on_planet_attackers_win, Invaded 5524 Preserved World
country_event = {
	id = ag_primitive.112
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = ag_primitive_2_research_mission_flag
		from = {
			is_country_type = primitive
			is_same_value = event_target:ag_primitive_country_2
		}
		fromfrom = {
			NOT = {
				has_planet_flag = ag_primitive_2_invaded
			}
		}
	}
	
	immediate = {
		set_country_flag = ag_invaded_primitive_2_world
		fromfrom = {
			set_planet_flag = ag_primitive_2_invaded
			set_owner = root
			add_building = ag_ancient_structure
			random_list = {
				50 = {
					remove_building = ag_class_5_singularity
					add_deposit = ag_class_5_singularity_crater
					add_planet_devastation = 15
					root = {
						country_event = { id = ag_primitive.113 }
					}
				}
				50 = {
				}
			}
		}
	}
}

# Class 5 singularity explode if unlucky
country_event = {
	id = ag_primitive.113
	title = "ag_primitive.113.name"
	desc = "ag_primitive.113.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_nuclear_explosion_room }
	show_sound = event_super_explosion
	location = event_target:ag_primitive_world_2
	
	is_triggered_only = yes
	
	option = {
		name = "ag_primitive.113.a"
		custom_tooltip = "ag_primitive.113.a.tooltip"
	}
}

# Failsafe Event
country_event = {
	id = ag_primitive.114
	title = "ag_primitive.114.name"
	desc = "ag_primitive.114.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_building_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_world_2
	
	is_triggered_only = yes

	trigger = {
		NOR = {
			has_country_flag = ag_primitive_2_research_researcher
			has_country_flag = ag_primitive_2_research_priest
			has_country_flag = ag_invaded_primitive_2_world
			has_country_flag = ag_primitive_world_2_failsafe_flag
		}
		is_primitive = no
		exists = event_target:ag_primitive_world_2
		event_target:ag_primitive_world_2 = {
			exists = owner
			owner = { is_same_value = root }
		}
		# any_owned_planet = {
		# 	is_same_value = event_target:ag_primitive_world_2
		# }
	}

	immediate = {
		set_country_flag = ag_primitive_world_2_failsafe_flag
	}
	
	option = {
		name = "ag_primitive.114.a"
		enable_special_project = {
			name = "ag_primitive_world_2_research_alt"
			location = event_target:ag_primitive_world_2
			owner = root
		}
	}
}

# on_survey, Scanned 9102 Preserved World
ship_event = {
	id = ag_primitive.121
	title = "ag_primitive.121.name"
	desc = "ag_primitive.121.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_shattered_planet_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_primitive_broken_world
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_planet_flag = ag_primitive_broken_world
		}
		owner = {
			is_ai = no
			NOT = {
				has_country_flag = ag_primitive_121_fired
			}
		}
	}
	
	immediate = {
		owner = { set_country_flag = ag_primitive_121_fired }
	}
	
	option = {
		name = "ag_primitive.121.a"
		event_target:ag_primitive_broken_world = {
			create_archaeological_site = ag_shielded_broken_planet_site
		}
		owner = {
			enable_special_project = {
				name = "ag_ancient_station_research"
				location = event_target:ag_ancient_station
				owner = root.owner
			}
		}
	}
}

# Archaeology Site: Shattered Planet
# Stage 1
fleet_event = {
	id = ag_primitive.131
	title = "ag_primitive.131.name"
	desc = "ag_primitive.131.desc"
	picture = GFX_evt_barren_dig_site
	show_sound = event_dig_site
	
	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = "ag_primitive.131.a"
	}
}
# Stage 2
fleet_event = {
	id = ag_primitive.132
	title = "ag_primitive.132.name"
	desc = "ag_primitive.132.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_dig_site
	
	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = "ag_primitive.132.a"
	}
}
# Stage 3
fleet_event = {
	id = ag_primitive.133
	title = "ag_primitive.133.name"
	desc = {
		trigger = {
			NOT = { has_global_flag = ag_ancient_shield_unlocked }
		}
		text = "ag_primitive.133.a.desc"
	}
	desc = {
		trigger = {
			has_global_flag = ag_ancient_shield_unlocked
		}
		text = "ag_primitive.133.b.desc"
	}
	picture = GFX_evt_generator_powerup
	show_sound = event_finding_loot
	
	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = {
			set_site_progress_locked = yes
		}
		if = {
			limit = {
				NOT = { has_global_flag = ag_ancient_shield_unlocked }
			}
			set_global_flag = ag_ancient_shield_locked
		}
	}

	after = {
		if = {
			limit = { NOT = { has_global_flag = ag_ancient_shield_locked } }
			from = { set_site_progress_locked = no }
		}
		else = {
			clear_orders = yes
			clear_fleet_actions = this
		}
	}
	
	option = {
		name = "ag_primitive.133.a"
	}
}
# Stage 4
fleet_event = {
	id = ag_primitive.134
	title = "ag_primitive.134.name"
	desc = "ag_primitive.134.desc"
	picture = GFX_evt_underground_city
	show_sound = event_finding_loot
	
	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = "ag_primitive.134.a"
		leader = { add_experience = 100 }
		small_artifact_reward = yes
	}
}
# Stage 5
fleet_event = {
	id = ag_primitive.135
	title = "ag_primitive.135.name"
	desc = "ag_primitive.135.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_finding_loot
	
	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = "ag_primitive.135.a"
		small_artifact_reward = yes
	}
	option = {
		name = "ag_primitive.135.b"
		trigger = {
			OR = {
				has_ethic = ethic_pacifist
				has_ethic = ethic_fanatic_pacifist
			}
		}
		small_artifact_reward = yes
	}
	option = {
		name = "ag_primitive.135.c"
		trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		small_artifact_reward = yes
	}
}
# Stage 6
fleet_event = {
	id = ag_primitive.136
	title = "ag_primitive.136.name"
	desc = "ag_primitive.136.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_finding_loot
	
	archaeology = yes

	is_triggered_only = yes
	
	immediate = {
		from = { set_site_progress_locked = yes }
		owner = {
			save_event_target_as = ag_system_discover_country
		}
	}

	after = {
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = "ag_primitive.136.a"
		large_artifact_reward = yes
		hidden_effect = {
			set_global_flag = ag_primitive_136_fired
			if = {
				limit = {
					has_global_flag = ag_primitive_136_fired
					has_global_flag = ag_primitive_139_fired
				}
				owner = {
					country_event = { id = ag_primitive.141 }
					change_variable = { which = ag_ancient_preserved_world_events_counter value = 1 }
				}
			}
		}
	}
}

# Unlock ancient shield, make archaeological dig could proceed
ship_event = {
	id = ag_primitive.137
	title = "ag_primitive.137.name"
	desc = "ag_primitive.137.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sapient_AI_room }
	show_sound = event_power_down
	location = event_target:ag_ancient_station

	is_triggered_only = yes
	
	immediate = {
		event_target:ag_primitive_broken_world = {
			set_planet_entity = {
				entity = "broken_planet_01_entity"
			}
		}
		set_global_flag = ag_ancient_shield_unlocked
		if = {
			limit = {
				has_global_flag = ag_ancient_shield_locked
			}
			remove_global_flag = ag_ancient_shield_locked
			event_target:ag_primitive_broken_world = {
				archaeological_site = {
					set_site_progress_locked = no
				}
			}
		}
		owner = {
			country_event = { id = ag_primitive.138 days = 3 }
		}
	}
	
	option = {
		name = "ag_primitive.137.a"
	}
}

# Spawn ancient drones
country_event = {
	id = ag_primitive.138
	title = "ag_primitive.138.name"
	desc = "ag_primitive.138.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_fleet_evil_room }
	show_sound = event_red_alert
	location = event_target:ag_ancient_station

	is_triggered_only = yes
	
	immediate = {
		ag_create_ancient_guardian = {
			ag_country_name = "NAME_ag_ancient_primitive_monitor"
			ag_country_type = ag_ancient_primitive_monitor
		}
		last_created_country = {
			save_global_event_target_as = ag_ancient_primitive_monitor_country
			set_country_flag = ag_ancient_primitive_monitor_country
			ag_ancient_country_friendly_to_each_other = yes
			create_fleet = {
				name = "NAME_ag_ancient_fleet"
				settings = {
					spawn_debris = no
					is_boss = yes
				}
				effect = {
					set_owner = event_target:ag_ancient_primitive_monitor_country
					while = {
						count = @ag_ancient_monitor_drone_squardron_num_drones
						create_ship = {
							name = random
							design = "NAME_ag_ancient_monitor_drone_hostile"
							prefix = no
							effect = {
								ag_difficulty_bonus = yes
							}
						}
					}
					set_location = {
						target = event_target:ag_primitive_broken_world
						distance = 0
						angle = random
					}
				}
			}
		}
		every_country = {
			limit = {
				NOT = {
					is_same_value = event_target:ag_ancient_primitive_monitor_country
				}
			}
			establish_communications_no_message = event_target:ag_ancient_primitive_monitor_country
		}
	}
	
	option = {
		name = "ag_primitive.138.a"
	}
}

# on_ship_destroyed_victim, Destroy ancient drones
country_event = {
	id = ag_primitive.139
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = ag_ancient_primitive_monitor_country
		NOT = {
			has_global_flag = ag_primitive_139_fired
		}
		count_owned_ship = {
			count < 1
		}
	}
	
	immediate = {
		destroy_country = yes
		set_global_flag = ag_primitive_139_fired
		event_target:ag_ancient_station = {
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
			create_ambient_object = {
				type = "ag_ancient_station_small_0_object"
			}
			last_created_ambient_object = {
				set_location = {
					target = event_target:ag_ancient_station
					distance = -1
					angle = 128
				}
				set_ambient_object_flag = ag_ancient_station
			}
			destroy_ambient_object = this
		}
		if = {
			limit = {
				has_global_flag = ag_primitive_136_fired
				has_global_flag = ag_primitive_139_fired
			}
			from = {
				country_event = { id = ag_primitive.141 }
			}
		}
		every_country = {
			if = {
				limit = { 
					has_modifier = ag_ancient_primitive_monitor_weakness
				}
				remove_modifier = "ag_ancient_primitive_monitor_weakness"
			}
			if = {
				limit = {
					has_special_project = ag_find_ancient_primitive_monitor_weakness
				}
				abort_special_project = {
					type = "ag_find_ancient_primitive_monitor_weakness"
					location = capital_scope
				}
			}
		}
	}
}

# Located Theta Area
country_event = {
	id = ag_primitive.141
	title = "ag_primitive.141.name"
	desc = "ag_primitive.141.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_archaeological_dig_room }
	show_sound = event_ship_bridge

	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = ag_system_discover_country
		add_seen_bypass_type = wormhole
	}
	
	option = {
		name = "ag_primitive.141.a"
		hidden_effect = {
			set_global_flag = ag_theta_area_spawned
			no_scope = {
				spawn_system = {
					min_distance = 555
					max_distance = 555
					min_orientation_angle = 95
					max_orientation_angle = 97
					initializer = "ag_ancient_theta_init"
					hyperlane = no
				}
			}
			random_system = {
				limit = {
					has_star_flag = ag_ancient_theta_system
				}
				save_event_target_as = ag_ancient_theta_system
				isolate_system = yes
			}
			if = {
				limit = {
					any_system = {
						ag_spawnsystem_trigger = yes
						has_natural_wormhole = no
					}
				}
				random_system = {
					limit = {
						ag_spawnsystem_trigger = yes
						has_natural_wormhole = no
					}
					set_star_flag = ag_ancient_theta_area_entry
					save_event_target_as = ag_ancient_theta_area_entry
					event_target:ag_ancient_theta_system = {
						prev = {
							spawn_natural_wormhole = {
								bypass_type = wormhole
								random_pos = no
								orbit_angle = 233
							}
						}
						spawn_natural_wormhole = {
							bypass_type = wormhole
							random_pos = no
							orbit_angle = 126
						}
						link_wormholes = prev
					}
				}
			}
			else_if = {
				limit = {
					any_rim_system = {
						ag_spawnsystem_trigger_fallback_1 = yes
						has_natural_wormhole = no
					}
				}
				random_rim_system = {
					limit = {
						ag_spawnsystem_trigger_fallback_1 = yes
						has_natural_wormhole = no
					}
					set_star_flag = ag_ancient_theta_area_entry
					save_event_target_as = ag_ancient_theta_area_entry
					event_target:ag_ancient_theta_system = {
						prev = {
							spawn_natural_wormhole = {
								bypass_type = wormhole
								random_pos = no
								orbit_angle = 233
							}
						}
						spawn_natural_wormhole = {
							bypass_type = wormhole
							random_pos = no
							orbit_angle = 126
						}
						link_wormholes = prev
					}
				}
			}
			else_if = {
				limit = {
					any_system = {
						ag_spawnsystem_trigger_fallback_2 = yes
						has_natural_wormhole = no
					}
				}
				random_system = {
					limit = {
						ag_spawnsystem_trigger_fallback_2 = yes
						has_natural_wormhole = no
					}
					set_star_flag = ag_ancient_theta_area_entry
					save_event_target_as = ag_ancient_theta_area_entry
					event_target:ag_ancient_theta_system = {
						prev = {
							spawn_natural_wormhole = {
								bypass_type = wormhole
								random_pos = no
								orbit_angle = 233
							}
						}
						spawn_natural_wormhole = {
							bypass_type = wormhole
							random_pos = no
							orbit_angle = 126
						}
						link_wormholes = prev
					}
				}
			}
			else_if = {
				limit = { always = yes }
				random_system = {
					limit = { has_natural_wormhole = no }
					set_star_flag = ag_ancient_theta_area_entry
					save_event_target_as = ag_ancient_theta_area_entry
					event_target:ag_ancient_theta_system = {
						prev = {
							spawn_natural_wormhole = {
								bypass_type = wormhole
								random_pos = no
								orbit_angle = 233
							}
						}
						spawn_natural_wormhole = {
							bypass_type = wormhole
							random_pos = no
							orbit_angle = 126
						}
						link_wormholes = prev
					}
				}
			}
			every_country = {
				limit = { NOT = { is_same_value = event_target:ag_system_discover_country } }
				country_event = { id = ag_spawn.33 }
			}
			if = {
				limit = {
					NOT = {
						has_event_chain = "ag_hidden_system_chain"
					}
				}
				begin_event_chain = {
					event_chain = "ag_hidden_system_chain"
					target = root
				}
			}
			create_point_of_interest = {
				id = ag_ancient_theta_area
				name = "ag_ancient_theta_area"
				desc = "ag_ancient_theta_area_desc"
				event_chain = "ag_hidden_system_chain"
				location = event_target:ag_ancient_theta_star
			}
			create_point_of_interest = {
				id = ag_ancient_theta_area_entry
				name = "ag_ancient_theta_area_entry"
				desc = "ag_ancient_theta_area_entry_desc"
				event_chain = "ag_hidden_system_chain"
				location = event_target:ag_ancient_theta_area_entry
			}
			add_event_chain_counter = {
				event_chain = "ag_hidden_system_chain"
				counter = "ag_ancient_system"
				amount = 1
			}
		}
	}
}

# Give special project to research weakness if lost too many ships
country_event = {
	id = ag_primitive.151
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			OR = {
				is_country_type = ag_ancient_primitive_monitor
			}
			has_country_flag = ag_ancient_primitive_monitor_country
			is_same_value = event_target:ag_ancient_primitive_monitor_country
		}
		is_ai = no
		NOR = {
			has_global_flag = ag_primitive_139_fired
			has_country_flag = ag_has_ancient_primitive_monitor_weakness
		}
	}
	
	immediate = {
		if = {
			limit = {
				check_variable = {
					which = ag_ancient_primitive_monitor_killcount
					value < 1
				}
			}
			set_variable = {
				which = ag_ancient_primitive_monitor_killcount
				value = 1
			}
		}
		fromfrom = {
			root = {
				ag_hostile_kill_counter = {
					ag_variable_name = ag_ancient_primitive_monitor_killcount
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = ag_ancient_primitive_monitor_killcount
					value > 512
				}
				NOR = {
					has_global_flag = ag_primitive_139_fired
					has_country_flag = ag_has_ancient_primitive_monitor_weakness
				}
			}
			set_variable = {
				which = ag_ancient_primitive_monitor_killcount
				value = 512
			}
			random_list = {
				25 = {
					country_event = {
						id = ag_primitive.152
						days = 30
						random = 30
					}
					set_country_flag = ag_has_ancient_primitive_monitor_weakness
				}
				75 = {
				}
			}
		}
	}
}
country_event = {
	id = ag_primitive.152
	title = "ag_primitive.152.name"
	desc = "ag_primitive.152.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes

	trigger = {
		NOT = {
			has_global_flag = ag_primitive_139_fired
		}
	}
	
	option = {
		name = "ag_primitive.152.a"
		enable_special_project = {
			name = "ag_find_ancient_primitive_monitor_weakness"
			location = capital_scope
			owner = root
		}
	}
	option = {
		name = "ag_primitive.152.b"
		add_resource = { influence = 120 }
	}
}
country_event = {
	id = ag_primitive.153
	title = "ag_primitive.153.name"
	desc = "ag_primitive.153.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	
	is_triggered_only = yes

	option = {
		name = "ag_primitive.153.a"
		if = {
			limit = {
				NOT = {
					has_modifier = ag_ancient_primitive_monitor_weakness
				}
			}
			add_modifier = {
				modifier = ag_ancient_primitive_monitor_weakness
				days = -1
			}
		}
	}
}

# on_entering_system_fleet, # Notification for entering 4762 Preserved World's neighbor system
fleet_event = {
	id = ag_primitive.301
	title = "ag_primitive.301.name"
	desc = "ag_primitive.301.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_sensor_ping
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_star_flag = ag_spawn_system_target
		}
		owner = {
			is_ai = no
			NOT = {
				has_country_flag = ag_primitive_301_fired
			}
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = ag_primitive_301_fired
		}
	}
	
	option = {
		name = "ag_primitive.301.a"
	}
}
# on_entering_system_fleet, # Notification for entering 4762 Preserved World's system
fleet_event = {
	id = ag_primitive.302
	title = "ag_primitive.302.name"
	desc = "ag_primitive.302.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_star_flag = ag_primitive_system
		}
		owner = {
			is_ai = no
			NOT = {
				has_country_flag = ag_primitive_302_fired
			}
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = ag_primitive_302_fired
			remove_point_of_interest = ag_ancient_location_1_poi
			if = {
				limit = {
					NOT = {
						has_event_chain = "ag_hidden_system_chain"
					}
				}
				begin_event_chain = {
					event_chain = "ag_hidden_system_chain"
					target = root.owner
				}
			}
			add_event_chain_counter = {
				event_chain = "ag_hidden_system_chain"
				counter = "ag_ancient_system"
				amount = 1
			}
			create_point_of_interest = {
				id = ag_ancient_location_1_poi_alt
				name = "ag_ancient_location_1_poi"
				desc = "ag_ancient_coordinate"
				event_chain = "ag_hidden_system_chain"
				location = event_target:ag_primitive_world.solar_system
			}
		}
	}
	
	option = {
		name = "ag_primitive.302.a"
	}
}
# on_entering_system_fleet, # Notification for entering 5524 Preserved World's system
fleet_event = {
	id = ag_primitive.701
	title = "ag_primitive.701.name"
	desc = "ag_primitive.701.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_star_flag = ag_primitive_system_2
		}
		owner = {
			is_ai = no
			NOT = {
				has_country_flag = ag_primitive_701_fired
			}
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = ag_primitive_701_fired
			remove_point_of_interest = ag_ancient_location_2_poi
			if = {
				limit = {
					NOT = {
						has_event_chain = "ag_hidden_system_chain"
					}
				}
				begin_event_chain = {
					event_chain = "ag_hidden_system_chain"
					target = root.owner
				}
			}
			add_event_chain_counter = {
				event_chain = "ag_hidden_system_chain"
				counter = "ag_ancient_system"
				amount = 1
			}
			create_point_of_interest = {
				id = ag_ancient_location_2_poi_alt
				name = "ag_ancient_location_2_poi"
				desc = "ag_ancient_coordinate"
				event_chain = "ag_hidden_system_chain"
				location = event_target:ag_primitive_world_2.solar_system
			}
		}
	}
	
	option = {
		name = "ag_primitive.701.a"
	}
}
# on_entering_system_fleet, # Notification for entering 9102 Preserved World's system
fleet_event = {
	id = ag_primitive.1201
	title = "ag_primitive.1201.name"
	desc = "ag_primitive.1201.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_star_flag = ag_primitive_system_3
		}
		owner = {
			is_ai = no
			NOT = {
				has_country_flag = ag_primitive_1201_fired
			}
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = ag_primitive_1201_fired
			remove_point_of_interest = ag_ancient_location_3_poi
			if = {
				limit = {
					NOT = {
						has_event_chain = "ag_hidden_system_chain"
					}
				}
				begin_event_chain = {
					event_chain = "ag_hidden_system_chain"
					target = root.owner
				}
			}
			add_event_chain_counter = {
				event_chain = "ag_hidden_system_chain"
				counter = "ag_ancient_system"
				amount = 1
			}
			create_point_of_interest = {
				id = ag_ancient_location_3_poi_alt
				name = "ag_ancient_location_3_poi"
				desc = "ag_ancient_coordinate"
				event_chain = "ag_hidden_system_chain"
				location = event_target:ag_primitive_broken_world.solar_system
			}
		}
	}
	
	option = {
		name = "ag_primitive.1201.a"
	}
}
