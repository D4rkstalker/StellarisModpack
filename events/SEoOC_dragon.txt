namespace = nep_dragon

#Create cluster,portal
country_event = {
	id = nep_dragon.1
	title = "nep_dragon.1.name"
	desc = "nep_dragon.1.desc"	
	picture = GFX_evt_black_hole
	
	is_triggered_only = yes
	
	fire_only_once = yes
	
	immediate = {
		#cluster
		if = {
			limit = { NOT = { has_global_flag = nep_heptagram_system_spawn } }
			set_spawn_system_batch = begin
			no_scope = {
				spawn_system = {
					min_distance >= 540
					max_distance <= 550
					min_orientation_angle = 133
					max_orientation_angle = 135
					hyperlane = no
					initializer = nep_Aemethms_init
				}
			}
			random_system = {
				limit = {
					has_star_flag = nep_dragon_system
				}
				spawn_system = {
					min_distance >= 20
					max_distance <= 20
					min_orientation_angle = 0
					max_orientation_angle = 0
					hyperlane = no
					initializer = nep_Auriel_init
				}
				spawn_system = {
					min_distance >= 20
					max_distance <= 20
					min_orientation_angle = -51.42
					max_orientation_angle = -51.42
					hyperlane = no
					initializer = nep_Gabriel_init
				}
				spawn_system = {
					min_distance >= 20
					max_distance <= 20
					min_orientation_angle = -102.85
					max_orientation_angle = -102.85
					hyperlane = no
					initializer = nep_Sabriel_init
				}
				spawn_system = {
					min_distance >= 20
					max_distance <= 20
					min_orientation_angle = -154.28
					max_orientation_angle = -154.28
					hyperlane = no
					initializer = nep_Samuel_init
				}
				spawn_system = {
					min_distance >= 20
					max_distance <= 20
					min_orientation_angle = -205.71
					max_orientation_angle = -205.71
					hyperlane = no
					initializer = nep_Michael_init
				}
				spawn_system = {
					min_distance >= 20
					max_distance <= 20
					min_orientation_angle = -257.14
					max_orientation_angle = -257.14
					hyperlane = no
					initializer = nep_Jauiel_init
				}
				spawn_system = {
					min_distance >= 20
					max_distance <= 20
					min_orientation_angle = -308.57
					max_orientation_angle = -308.57
					hyperlane = no
					initializer = nep_Anael_init
				}
			}
			random_system = {
				limit = { has_star_flag = nep_Auriel_system }
				save_event_target_as = nep_heptagram_system_1
			}
			random_system = {
				limit = { has_star_flag = nep_Gabriel_system }
				save_event_target_as = nep_heptagram_system_2
			}
			random_system = {
				limit = { has_star_flag = nep_Sabriel_system }
				save_event_target_as = nep_heptagram_system_3
			}
			random_system = {
				limit = { has_star_flag = nep_Samuel_system }
				save_event_target_as = nep_heptagram_system_4
			}
			random_system = {
				limit = { has_star_flag = nep_Michael_system }
				save_global_event_target_as = nep_heptagram_system_5
			}
			random_system = {
				limit = { has_star_flag = nep_Jauiel_system }
				save_event_target_as = nep_heptagram_system_6
			}
			random_system = {
				limit = { has_star_flag = nep_Anael_system }
				save_event_target_as = nep_heptagram_system_7
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_1
				to = event_target:nep_heptagram_system_2
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_2
				to = event_target:nep_heptagram_system_3
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_3
				to = event_target:nep_heptagram_system_4
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_4
				to = event_target:nep_heptagram_system_5
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_6
				to = event_target:nep_heptagram_system_5
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_6
				to = event_target:nep_heptagram_system_7
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_1
				to = event_target:nep_heptagram_system_7
			}
			
			add_hyperlane = {
				from = event_target:nep_heptagram_system_1
				to = event_target:nep_heptagram_system_3
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_3
				to = event_target:nep_heptagram_system_5
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_5
				to = event_target:nep_heptagram_system_7
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_7
				to = event_target:nep_heptagram_system_2
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_2
				to = event_target:nep_heptagram_system_4
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_4
				to = event_target:nep_heptagram_system_6
			}
			add_hyperlane = {
				from = event_target:nep_heptagram_system_1
				to = event_target:nep_heptagram_system_6
			}
			set_spawn_system_batch = end
			set_global_flag = nep_heptagram_system_spawn
		}
		#portal		
		random_galaxy_planet = {
			limit = { has_planet_flag = nep_seal_1 }
			solar_system = {
				spawn_megastructure = {
					name = "NAME_Sub_Seal_1"
					type = "nep_sealportal_node"
					orbit_angle = 0
					orbit_distance = 0
					planet = prev
				}
			}
			remove_planet = yes
		}
		set_global_flag = nep_not_pass_sealportal
		set_global_flag = nep_not_pass_Aemethms
	}
	
	option = {
		name = nep_dragon.1.a
		add_research_option = tech_sealportal_dive
		hidden_effect = {
			set_global_flag = nep_dragon_begin
			set_country_flag = nep_dragon_founder #...in future
			if = { 
				limit = { 
					event_target:nep_Auriel_planet = { is_planet_class = pc_gaia }
				}
				country_event = { id = nep_dragon.2000 }
			}
		}
	}
	
	option = {
		name = nep_dragon.1.b
		hidden_effect = { 			
			event_target:nep_grand_seal_planet = {
				planet_event = { id = nep_finalweapon.4001 days = 18000 random = 3600 }
			}
		}
	}
}

country_event = {
	id = nep_dragon.2000
	title = "nep_dragon.2000.name"
	desc = "nep_dragon.2000.desc"	
	picture = GFX_evt_black_hole
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_not_pass_sealportal
	}
	
	immediate = {
		remove_global_flag = nep_not_pass_sealportal
		event_target:nep_Auriel_planet = {
			add_modifier = {
				modifier = "nep_Auriel_modifier"
				days = -1
			}
			add_deposit = "d_nep_unknown_vortex"
		}
		event_target:nep_Gabriel_planet = {
			add_modifier = {
				modifier = "nep_Gabriel_modifier"
				days = -1
			}
			add_deposit = "d_nep_unknown_vortex"
		}
		event_target:nep_Sabriel_planet = {
			add_modifier = {
				modifier = "nep_Sabriel_modifier"
				days = -1
			}
			add_deposit = "d_nep_unknown_vortex"
		}
		event_target:nep_Samuel_planet = {
			add_modifier = {
				modifier = "nep_Samuel_modifier"
				days = -1
			}
			add_deposit = "d_nep_unknown_vortex"
		}
		event_target:nep_Michael_planet = {
			add_modifier = {
				modifier = "nep_Michael_modifier"
				days = -1
			}
			add_deposit = "d_nep_unknown_vortex"
		}
		event_target:nep_Jauiel_planet = {
			add_modifier = {
				modifier = "nep_Jauiel_modifier"
				days = -1
			}
			add_deposit = "d_nep_unknown_vortex"
		}
		event_target:nep_Anael_planet = {
			add_modifier = {
				modifier = "nep_Anael_modifier"
				days = -1
			}
			add_deposit = "d_nep_unknown_vortex"
		}
	}
	option = {
		name = nep_dragon.2000.a
	}
}

fleet_event = {
	id = nep_dragon.2
	title = "nep_dragon.2.name"
	desc = "nep_dragon.2.desc"	
	picture = GFX_evt_black_hole
	
	fire_only_once = yes

	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_global_flag = nep_dragon_begin
			has_country_flag = nep_dragon_founder
			has_technology = tech_sealportal_dive
		}
		has_global_flag = nep_not_pass_sealportal
		NOT = { event_target:nep_Auriel_planet = { is_planet_class = pc_gaia } }
	}

	immediate = {
		remove_global_flag = nep_not_pass_sealportal
	}
	
	option = {
		name = nep_dragon.2.a
		owner = {
			begin_event_chain = {
				event_chain = "nep_heptagram_chain"
				target = THIS
			}
			enable_special_project = {
				name = "nep_dragon_shielded_planet"
				location = event_target:nep_Auriel_planet
				owner = THIS.owner
			}
			enable_special_project = {
				name = "nep_dragon_shielded_planet"
				location = event_target:nep_Gabriel_planet
				owner = THIS.owner
			}
			enable_special_project = {
				name = "nep_dragon_shielded_planet"
				location = event_target:nep_Sabriel_planet
				owner = THIS.owner
			}
			enable_special_project = {
				name = "nep_dragon_shielded_planet"
				location = event_target:nep_Samuel_planet
				owner = THIS.owner
			}
			enable_special_project = {
				name = "nep_dragon_shielded_planet"
				location = event_target:nep_Michael_planet
				owner = THIS.owner
			}
			enable_special_project = {
				name = "nep_dragon_shielded_planet"
				location = event_target:nep_Jauiel_planet
				owner = THIS.owner
			}
			enable_special_project = {
				name = "nep_dragon_shielded_planet"
				location = event_target:nep_Anael_planet
				owner = THIS.owner
			}
			remove_point_of_interest = grand_seal_system_poi.a
		}
	}
}

ship_event = {
	id = nep_dragon.3
	title = "nep_dragon.3.name"
	desc = "nep_dragon.3.desc"	
	picture = GFX_evt_gaia
	
	is_triggered_only = yes
	
	fire_only_once = yes
		
	immediate = {
		owner = {
			if = {
				limit = {
					has_special_project = nep_dragon_shielded_planet
				}
				abort_special_project = {
					type = "nep_dragon_shielded_planet"
				}
			}
		}
	}
	
	option = {
		name = nep_dragon.3.a
		owner = {
			end_event_chain = "nep_heptagram_chain"
		}
		hidden_effect = {
			event_target:nep_Auriel_planet = {
				change_pc = pc_gaia
				set_planet_entity = {
					entity = "gaia_planet_01_entity"
				}
				reroll_planet = yes
				add_modifier = {
					modifier = "nep_Auriel_modifier"
					days = -1
				}
				add_deposit = "d_nep_unknown_vortex"
			}
			event_target:nep_Gabriel_planet = {
				change_pc = pc_gaia
				set_planet_entity = {
					entity = "gaia_planet_01_entity"
				}
				reroll_planet = yes
				add_modifier = {
					modifier = "nep_Gabriel_modifier"
					days = -1
				}
				add_deposit = "d_nep_unknown_vortex"
				add_deposit = d_rich_mountain
				add_deposit = d_rich_mountain
			}
			event_target:nep_Sabriel_planet = {
				change_pc = pc_gaia
				set_planet_entity = {
					entity = "gaia_planet_01_entity"
				}
				reroll_planet = yes
				add_modifier = {
					modifier = "nep_Sabriel_modifier"
					days = -1
				}
				add_deposit = "d_nep_unknown_vortex"
				add_deposit = d_underwater_vent
				add_deposit = d_underwater_vent
			}
			event_target:nep_Samuel_planet = {
				change_pc = pc_gaia
				set_planet_entity = {
					entity = "gaia_planet_01_entity"
				}
				reroll_planet = yes
				add_modifier = {
					modifier = "nep_Samuel_modifier"
					days = -1
				}
				add_deposit = "d_nep_unknown_vortex"
			}
			event_target:nep_Michael_planet = {
				change_pc = pc_gaia
				set_planet_entity = {
					entity = "gaia_planet_01_entity"
				}
				reroll_planet = yes
				add_modifier = {
					modifier = "nep_Michael_modifier"
					days = -1
				}
				add_deposit = "d_nep_unknown_vortex"
			}
			event_target:nep_Jauiel_planet = {
				change_pc = pc_gaia
				set_planet_entity = {
					entity = "gaia_planet_01_entity"
				}
				reroll_planet = yes
				add_modifier = {
					modifier = "nep_Jauiel_modifier"
					days = -1
				}
				add_deposit = "d_nep_unknown_vortex"
			}
			event_target:nep_Anael_planet = {
				change_pc = pc_gaia
				set_planet_entity = {
					entity = "gaia_planet_01_entity"
				}
				reroll_planet = yes
				add_modifier = {
					modifier = "nep_Anael_modifier"
					days = -1
				}
				add_deposit = "d_nep_unknown_vortex"
			}
			#owner = {
			#	country_event = { id = nep_dragon.3000 days = 360 random = 720 }
			#}
		}
	}
	option = {
		name = nep_dragon.3.b
		owner = {
			end_event_chain = "nep_heptagram_chain"
		}
		hidden_effect = {
			event_target:nep_grand_seal_planet = {
				planet_event = { id = nep_finalweapon.4001 days = 18000 random = 1800 }
			}
		}
	}
}

# country_event = {
	# id = nep_dragon.3000
	# hide_window = yes
	
	# is_triggered_only = yes

	# immediate = {
		# if = {
			# limit = {
				# OR = {
					# event_target:nep_Auriel_planet = {
						# exists = owner
						# owner = { is_same_value = root }
					# }
					# event_target:nep_Gabriel_planet = {
						# exists = owner
						# owner = { is_same_value = root }
					# }
					# event_target:nep_Sabriel_planet = {
						# exists = owner
						# owner = { is_same_value = root }
					# }
					# event_target:nep_Samuel_planet = {
						# exists = owner
						# owner = { is_same_value = root }
					# }
					# event_target:nep_Jauiel_planet = {
						# exists = owner
						# owner = { is_same_value = root }
					# }
					# event_target:nep_Anael_planet = {
						# exists = owner
						# owner = { is_same_value = root }
					# }
				# }
			# }
			# random_list = {
				# 10 = { 
					# event_target:nep_Auriel_planet = { 
						# if = {
							# limit = {
								# exists = owner
								# owner = { is_same_value = root }
							# }
							# planet_event = { id = nep_dragon.3001 }
						# }
						# else = { root = { country_event = { id = nep_dragon.3000 days = 180 random = 180 } } }
					# }
				# }
				# 10 = { 
					# event_target:nep_Gabriel_planet = { 
						# if = {
							# limit = {
								# exists = owner
								# owner = { is_same_value = root }
							# }
							# planet_event = { id = nep_dragon.3001 }
						# }
						# else = { root = { country_event = { id = nep_dragon.3000 days = 180 random = 180 } } }
					# }
				# }
				# 10 = { 
					# event_target:nep_Sabriel_planet = { 
						# if = {
							# limit = {
								# exists = owner
								# owner = { is_same_value = root }
							# }
							# planet_event = { id = nep_dragon.3001 }
						# }
						# else = { root = { country_event = { id = nep_dragon.3000 days = 180 random = 180 } } }
					# }
				# }
				# 10 = { 
					# event_target:nep_Samuel_planet = { 
						# if = {
							# limit = {
								# exists = owner
								# owner = { is_same_value = root }
							# }
							# planet_event = { id = nep_dragon.3001 }
						# }
						# else = { root = { country_event = { id = nep_dragon.3000 days = 180 random = 180 } } }
					# }
				# }
				##No Michael
				# 10 = { 
					# event_target:nep_Jauiel_planet = { 
						# if = {
							# limit = {
								# exists = owner
								# owner = { is_same_value = root }
							# }
							# planet_event = { id = nep_dragon.3001 }
						# }
						# else = { root = { country_event = { id = nep_dragon.3000 days = 180 random = 180 } } }
					# }
				# }
				# 10 = { 
					# event_target:nep_Anael_planet = { 
						# if = {
							# limit = {
								# exists = owner
								# owner = { is_same_value = root }
							# }
							# planet_event = { id = nep_dragon.3001 }
						# }
						# else = { root = { country_event = { id = nep_dragon.3000 days = 180 random = 180 } } }
					# }
				# }
			# }
		# }
		# else = { country_event = { id = nep_dragon.3000 days = 180 random = 180 } }
	# }
# }

# planet_event = {
	# id = nep_dragon.3001
	# hide_window = yes
	# is_triggered_only = yes
	
	# immediate = {
		# owner = { country_event = { id = nep_dragon.3002 } }
		# solar_system = {
			# spawn_natural_wormhole = {
				# bypass_type = wormhole
				# random_pos = yes
			# }
		# }
		# owner = {
			# capital_scope = {
				# solar_system = {
					# closest_system = {
						# limit = {
							# is_star_class = sc_black_hole
						# }
						# spawn_natural_wormhole = {
							# bypass_type = wormhole
							# orbit_distance = 0
							# orbit_angle = 0
						# }
						# link_wormholes = root.solar_system
					# }
				# }
			# }
		# }
	# }
# }

# country_event = {
	# id = nep_dragon.3002
	# title = "nep_dragon.3002.name"
	# desc = "nep_dragon.3002.desc"	
	# picture = GFX_evt_black_hole
	# location = from
	# is_triggered_only = yes
	
	# immediate = {
		
	# }
	
	# option = {
		# name = nep_dragon.3002.a
	# }
# }

#Legnahcras appears
planet_event = {
	id = nep_dragon.4000
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_dragon_begin
		OR = {
			has_planet_flag = nep_Auriel_planet
			has_planet_flag = nep_Gabriel_planet
			has_planet_flag = nep_Sabriel_planet
			has_planet_flag = nep_Samuel_planet
			has_planet_flag = nep_Michael_planet
			has_planet_flag = nep_Jauiel_planet
			has_planet_flag = nep_Anael_planet
		}
		has_deposit = d_nep_dragon_temple
	}
	
	immediate = {
		log = "4000 fired"
		if = {
			limit = {
				AND = {
					event_target:nep_Auriel_planet = {
						exists = owner
						owner = { has_country_flag = nep_dragon_founder }
						has_deposit = d_nep_dragon_temple
					}
					event_target:nep_Gabriel_planet = {
						exists = owner
						owner = { has_country_flag = nep_dragon_founder }
						has_deposit = d_nep_dragon_temple
					}
					event_target:nep_Sabriel_planet = {
						exists = owner
						owner = { has_country_flag = nep_dragon_founder }
						has_deposit = d_nep_dragon_temple
					}
					event_target:nep_Samuel_planet = {
						exists = owner
						owner = { has_country_flag = nep_dragon_founder }
						has_deposit = d_nep_dragon_temple
					}
					event_target:nep_Michael_planet = {
						exists = owner
						owner = { has_country_flag = nep_dragon_founder }
						has_deposit = d_nep_dragon_temple
					}
					event_target:nep_Jauiel_planet = {
						exists = owner
						owner = { has_country_flag = nep_dragon_founder }
						has_deposit = d_nep_dragon_temple
					}
					event_target:nep_Anael_planet = {
						exists = owner
						owner = { has_country_flag = nep_dragon_founder }
						has_deposit = d_nep_dragon_temple
					}
				}
			}
			log = "4 may fired"
			OWNER = { country_event = {	id = nep_dragon.4 days = 180 random = 360 } }
		}
	}
}

country_event = {
	id = nep_dragon.4
	title = "nep_dragon.4.name"
	desc = "nep_dragon.4.desc"	
	picture = GFX_evt_ground_combat
		
	fire_only_once = yes
	
	is_triggered_only = yes

	immediate = {
		event_target:nep_Auriel_planet = {
			create_country = {
				name = "NAME_Legnahcras"
				type = nep_Legnahcras_country
				auto_delete = yes
				effect = {
					establish_communications_no_message = root
					nep_easy_mod = yes
				}
			}
			while = {
				count = 13
				create_army = {
					name = "NAME_Legnahcras_existences"
					owner = last_created_country
					type = nep_Legnahcras_defensive_army
				}
			}
		}
		event_target:nep_Gabriel_planet = {
			create_country = {
				name = "NAME_Legnahcras"
				type = nep_Legnahcras_country
				auto_delete = yes
				effect = {
					establish_communications_no_message = root
					nep_easy_mod = yes
				}
			}
			while = {
				count = 13
				create_army = {
					name = "NAME_Legnahcras_existences"
					owner = last_created_country
					type = nep_Legnahcras_defensive_army
				}
			}
		}
		event_target:nep_Sabriel_planet = {
			create_country = {
				name = "NAME_Legnahcras"
				type = nep_Legnahcras_country
				auto_delete = yes
				effect = {
					establish_communications_no_message = root
					nep_easy_mod = yes
				}
			}
			while = {
				count = 13
				create_army = {
					name = "NAME_Legnahcras_existences"
					owner = last_created_country
					type = nep_Legnahcras_defensive_army
				}
			}
		}
		event_target:nep_Samuel_planet = {
			create_country = {
				name = "NAME_Legnahcras"
				type = nep_Legnahcras_country
				auto_delete = yes
				effect = {
					establish_communications_no_message = root
					nep_easy_mod = yes
				}
			}
			while = {
				count = 13
				create_army = {
					name = "NAME_Legnahcras_existences"
					owner = last_created_country
					type = nep_Legnahcras_defensive_army
				}
			}
		}
		event_target:nep_Michael_planet = {
			create_country = {
				name = "NAME_Legnahcras"
				type = nep_Legnahcras_country
				auto_delete = yes
				effect = {
					establish_communications_no_message = root
					nep_easy_mod = yes
				}
			}
			while = {
				count = 13
				create_army = {
					name = "NAME_Legnahcras_existences"
					owner = last_created_country
					type = nep_Legnahcras_defensive_army
				}
			}
		}
		event_target:nep_Jauiel_planet = {
			create_country = {
				name = "NAME_Legnahcras"
				type = nep_Legnahcras_country
				auto_delete = yes
				effect = {
					establish_communications_no_message = root
					nep_easy_mod = yes
				}
			}
			while = {
				count = 13
				create_army = {
					name = "NAME_Legnahcras_existences"
					owner = last_created_country
					type = nep_Legnahcras_defensive_army
				}
			}
		}
		event_target:nep_Anael_planet = {
			create_country = {
				name = "NAME_Legnahcras"
				type = nep_Legnahcras_country
				auto_delete = yes
				effect = {
					establish_communications_no_message = root
					nep_easy_mod = yes
				}
			}
			while = {
				count = 13
				create_army = {
					name = "NAME_Legnahcras_existences"
					owner = last_created_country
					type = nep_Legnahcras_defensive_army
				}
			}
		}
		set_global_flag = nep_Legnahcras_begin
	}
	option = {
		name = nep_dragon.4.a
	}
}

#on_planet_attackers_win
country_event = {
	id = nep_dragon.4001
	title = "nep_dragon.4001.name"
	desc = "nep_dragon.4001.desc"	
	picture = GFX_evt_ground_combat
	
	is_triggered_only = yes
	
	fire_only_once = yes
	
	trigger = {
		OR = {
			and = { 
				exists = from 
				from = { is_country_type = nep_Legnahcras_country }
			}
			and = {
				exists = fromfrom
				fromfrom = {
					AND = {
						exists = controller
						controller = { is_country_type = nep_Legnahcras_country }
					}
				}
			}
		}
	}
	
	immediate = {
		
	}
	
	option = {
		name = nep_dragon.4001.a
		every_galaxy_planet = {
			limit = { 
				NOT = { is_same_value = root.fromfrom }
				OR = {
					has_planet_flag = nep_Auriel_planet
					has_planet_flag = nep_Gabriel_planet
					has_planet_flag = nep_Sabriel_planet
					has_planet_flag = nep_Samuel_planet
					has_planet_flag = nep_Michael_planet
					has_planet_flag = nep_Jauiel_planet
					has_planet_flag = nep_Anael_planet					
				}
			}
			enable_special_project = {
				name = "nep_Legnahcras_HQ_assault"
				owner = root
				location = this
			}
		}
	}
}

#on_planet_attackers_win
country_event = {
	id = nep_dragon.4002
	hide_window = yes
	
	is_triggered_only = yes
		
	trigger = {
		OR = {		
			and = { 
				exists = from 
				from = { is_country_type = nep_Legnahcras_country }
			}
			and = { 
				exists = fromfrom
				fromfrom = {
					AND = {
						exists = controller
						controller = { is_country_type = nep_Legnahcras_country }
					}
				}
			}
		}
	}
	
	immediate = {
		abort_special_project = {
			type = nep_Legnahcras_HQ_assault
			location = fromfrom
		}
	}
	
	after = {
		random_country = {
			limit = { has_country_flag = nep_dragon_founder }
			country_event = { id = nep_dragon.5 days = 3 }
		}
	}
}
#research
country_event = {
	id = nep_dragon.5
	title = "nep_dragon.5.name"
	desc = "nep_dragon.5.desc"
	picture = GFX_evt_victorious_army
	is_triggered_only = yes
		
	trigger = {
		has_global_flag = nep_Legnahcras_begin
		is_ai = no
		has_country_flag = nep_dragon_founder
		NOT = { any_country = { is_country_type = nep_Legnahcras_country } }
	}
	
	immediate = {
		remove_global_flag = nep_Legnahcras_begin
	}
	
	option = {
		name = nep_dragon.5.a
		enable_special_project = {
			name = "nep_Legnahcras_research"
			location = ROOT.capital_scope
			owner = ROOT
		}		
	}
	option = {
		name = nep_dragon.5.b
		hidden_effect = { 
			event_target:nep_grand_seal_planet = {
				planet_event = { id = nep_finalweapon.4001 days = 16000 random = 1800 }
			}
		}
	}
}

#Dragon appear
country_event = {
	id = nep_dragon.6
	title = "nep_dragon.6.name"
	desc = {
		trigger = { NOT = { has_global_flag = nep_SEoOC_easy } }
		text = "nep_dragon.6.desc"
	}
	desc = {
		trigger = { has_global_flag = nep_SEoOC_easy }
		text = "nep_dragon.6.desc2"
	}
	picture = GFX_evt_engineering_research

	is_triggered_only = yes	

	fire_only_once = yes
	
	immediate = {
		remove_global_flag = nep_not_pass_Aemethms
		random_galaxy_planet = {
			limit = {
				has_planet_flag = nep_dragon_star
			}
			save_global_event_target_as = nep_dragon_star
		}
		create_country = {
			name = "NAME_Heptagram_Dragon_country"
			type = nep_dragon_country
			auto_delete = no
			effect = {
				establish_communications_no_message = root.owner
			}
		}
		last_created_country = {
			save_global_event_target_as = nep_dragon_country
			nep_easy_mod = yes
		}
		create_fleet = {
			name = "NAME_Astaroth"
			settings = {
				spawn_debris = no
				can_upgrade = no
				uses_naval_capacity = no
				can_change_composition = no
				can_change_leader = no
			}
			effect = {
				set_owner = event_target:nep_dragon_country
				create_ship = {
					name = "NAME_Heptagram_Dragon"
					design = "NAME_Heptagram_Dragon_design"
				}
				while = {
					count = 100
					create_ship = {
						name = "NAME_Summoned_Babys"
						design = "NAME_Summoned_Babys_design"
					}
				}
				set_location = event_target:nep_dragon_star
				set_formation_scale = 2.0
				set_fleet_stance = aggressive
				set_aggro_range = 500
				set_aggro_range_measure_from = self
				if = {
					limit = { has_global_flag = nep_SEoOC_easy }
					add_modifier = {
						modifier = nep_dragon_boss_buff
						days = -1
					}
				}
			}
		}
		event_target:nep_dragon_country = {
			set_country_flag = nep_dragon_country
		}
		
		if = {
			limit = {
				NOT = { has_global_flag = nep_SEoOC_easy }
			}
			event_target:nep_Auriel_planet = {
				while = {
					count = 2
					create_army = {
						name = "NAME_Legnahcras_existences"
						owner = root
						type = nep_Legnahcras_assault_army
					}
				}
			}		
			event_target:nep_Gabriel_planet = {
				while = {
					count = 2
					create_army = {
						name = "NAME_Legnahcras_existences"
						owner = root
						type = nep_Legnahcras_assault_army
					}
				}
			}		
			event_target:nep_Sabriel_planet = {
				while = {
					count = 2
					create_army = {
						name = "NAME_Legnahcras_existences"
						owner = root
						type = nep_Legnahcras_assault_army
					}
				}
			}		
			event_target:nep_Samuel_planet = {
				while = {
					count = 2
					create_army = {
						name = "NAME_Legnahcras_existences"
						owner = root
						type = nep_Legnahcras_assault_army
					}
				}
			}		
			event_target:nep_Michael_planet = {
				while = {
					count = 2
					create_army = {
						name = "NAME_Legnahcras_existences"
						owner = root
						type = nep_Legnahcras_assault_army
					}
				}
			}		
			event_target:nep_Jauiel_planet = {
				while = {
					count = 2
					create_army = {
						name = "NAME_Legnahcras_existences"
						owner = root
						type = nep_Legnahcras_assault_army
					}
				}
			}		
			event_target:nep_Anael_planet = {
				while = {
					count = 2
					create_army = {
						name = "NAME_Legnahcras_existences"
						owner = root
						type = nep_Legnahcras_assault_army
					}
				}
			}
		}
	}
	
	option = {
		name = nep_dragon.6.a
		create_point_of_interest = {
			id = nep_dragon_system_poi.1
			name = "nep_dragon_system_poi_name"
			desc = "nep_dragon_system_poi_desc"
			location = event_target:nep_dragon_star
		}
		if = {
			limit = { has_global_flag = nep_SEoOC_easy }
			add_resource = {
				alloys = 5000
			}
		}
	}
}

#on_entering_system target = nep_dragon_star
ship_event = {
	id = nep_dragon.64
	title = "nep_dragon.64.name"
	desc = "nep_dragon.64.desc"	
	picture = GFX_evt_space_dragon
	location = THIS
	
	fire_only_once = yes
	
	is_triggered_only = yes		
	
	trigger = {
		owner = {
			is_ai = no
		}
		FROM = {
			has_star_flag = nep_dragon_system
			any_ship_in_system = {
				is_ship_size = nep_dragon
			}
		}
	}
	
	option = {
		name = nep_dragon.64.a
	}
}

#Buff the boss
country_event = {
	id = nep_dragon.60
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_global_flag = nep_dragon_in_battle
		}
	}
	
	immediate = {
		random_owned_ship = {
			limit = {
				is_ship_size = nep_dragon
			}
			set_global_flag = nep_dragon_in_battle
			ship_event = { id = nep_dragon.61 days = 3 }
		}
	}
}
			
ship_event = {
	id = nep_dragon.61
	hide_window = yes
				
	is_triggered_only = yes
	
	trigger = {
		exists = this
	}
	
	immediate = {
		if = {
			limit = {
				has_hp_percentage > 0
			}
			repair_percentage = 0.25
		}
		else = {
			remove_global_flag = nep_dragon_in_battle
		}
		if = {
			limit = {
				is_in_combat = yes
			}
			ship_event = { id = nep_dragon.61 days = 3 }
		}
		else = {
			remove_global_flag = nep_dragon_in_battle
		}
	}
}

country_event = {
	id = nep_dragon.62
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_global_flag = nep_dragon_in_battle_2
		}
	}
	
	immediate = {
		random_owned_ship = {
			limit = {
				is_ship_size = nep_dragon
			}
			set_global_flag = nep_dragon_in_battle_2
			ship_event = { id = nep_dragon.63 days = 10 }
		}
	}
}
			
ship_event = {
	id = nep_dragon.63
	hide_window = yes
				
	is_triggered_only = yes
	
	trigger = {
		exists = this
	}
	
	immediate = {
		if = {
			limit = {
				has_hp_percentage > 0
			}
			create_dragon_babys = yes
		}
		else = {
			remove_global_flag = nep_dragon_in_battle_2
		}
		if = {
			limit = {
				is_in_combat = yes
			}
			ship_event = { id = nep_dragon.63 days = 10 }
		}
		else = {
			remove_global_flag = nep_dragon_in_battle_2
		}
	}
}

country_event = {
	id = nep_dragon.7
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = nep_dragon_begin
		from = {
			has_country_flag = nep_dragon_country
		}
	}

	immediate = { country_event = { id = nep_dragon.7000 days = 1} }
	
}
#Get reward.ready(HIDDEN)
country_event = {
	id = nep_dragon.7000
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_dragon_begin
		fromfrom = {
			or = {
				NOT = { exists = this }
				num_fleets < 1
			}
		}
	}
	
	immediate = {
		remove_global_flag = nep_dragon_begin
		set_global_flag = nep_dragon_end
		event_target:nep_dragon_country = {
			every_owned_fleet = {
				delete_fleet = this
			}
			destroy_country = yes
		}
		random_country = {
			limit = {
				is_ai = no
				has_country_flag = nep_dragon_founder
			}
			country_event = { id = nep_dragon.71 }
		}
	}
}
country_event = {
	id = nep_dragon.71
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = nep_dragon_summoner
		remove_country_flag = nep_dragon_founder
		remove_point_of_interest = nep_dragon_system_poi.1
		country_event = { id = nep_dragon.8 }
		country_event = { id = nep_inva.1 days = 180 random = 180 }
	}
}

#Get reward.project
country_event = {
	id = nep_dragon.8
	title = "nep_dragon.8.name"
	desc = {
		trigger = {
			NOT = { has_country_flag = nep_dragon_8_notfirst }
		}
		text = "nep_dragon.8.desc.a"
	}
	desc = {
		trigger = {
			has_country_flag = nep_dragon_8_notfirst
		}
		text = "nep_dragon.8.desc.b"
	}
	picture = GFX_evt_space_dragon


	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_dragon_end
		has_country_flag = nep_dragon_summoner
		NOT = { 
			any_owned_ship = { 
				OR = {
					is_ship_size = nep_dragon_reward
					is_ship_size = nep_dragon_reward_kai
				}
			}
		}
	}
	
	immediate = {
	
	}
	
	#summon
	option = {
		name = nep_dragon.8.a
		custom_tooltip = nep_dragon.8.a.tooltip
		trigger = {
			has_country_resource = { type = minerals amount >= 5000 }
			has_country_resource = { type = energy amount >= 40000 }
		}
		add_resource = {
			alloys = -5000
			energy = -40000
		}
		enable_special_project = {
			name = "nep_dragon_summon"
			location = event_target:nep_dragon_star
			owner = ROOT
		}
		hidden_effect = { 
			if = {
				limit = { NOT = { has_country_flag = nep_dragon_8_notfirst } }
				set_country_flag = nep_dragon_8_notfirst
			}
		}
	}
	
	#Maybe later
	option = {
		name = nep_dragon.8.b
		custom_tooltip = nep_dragon.8.b.tooltip
		hidden_effect = { 
			set_country_flag = nep_dragon_summoner_hold
			if = {
				limit = { NOT = { has_country_flag = nep_dragon_8_notfirst } }
				set_country_flag = nep_dragon_8_notfirst
			}
			country_event = { id = nep_dragon.81 days = 360 }
		}
	}
	
	#It's dangerous
	option = {
		name = nep_dragon.8.c		
		hidden_effect = { 
			set_country_flag = nep_dragon_summoner_hold
			if = {
				limit = { NOT = { has_country_flag = nep_dragon_8_notfirst } }
				set_country_flag = nep_dragon_8_notfirst
			}
			event_target:nep_grand_seal_planet = {
				planet_event = { id = nep_finalweapon.4001 days = 15000 random = 3600 }
			}
		}
	}
}

country_event = {
	id = nep_dragon.81
	hide_window = yes

	is_triggered_only = yes
	
	immediate = {
		remove_country_flag = nep_dragon_summoner_hold
		country_event = { id = nep_dragon.8 }
	}
}

country_event = {
	id = nep_dragon.82
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		has_country_flag = nep_dragon_summoner
		FromFrom = { 
			OR = {
				is_ship_size = nep_dragon_reward 
				is_ship_size = nep_dragon_reward_kai			
			}
		}
	}
	
	immediate = {
		country_event = { id = nep_dragon.8 }
	}
}

event = {
	id = nep_dragon.83
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		any_country = {
			has_country_flag = nep_dragon_summoner_summoned
			NOT = { has_country_flag = nep_dragon_summoner_hold }
			NOT = { has_special_project = nep_dragon_summon }
			NOT = {
				any_owned_ship = {
					OR = {
						is_ship_size = nep_dragon_reward 
						is_ship_size = nep_dragon_reward_kai			
					}
				}
			}
		}
	}
	
	immediate = {
		random_country = {
			limit = { has_country_flag = nep_dragon_summoner }
			country_event = { id = nep_dragon.8 }
		}
	}
}

#summon success
country_event = {
	id = nep_dragon.9
	title = "nep_dragon.9.name"
	desc = "nep_dragon.9.desc"
	picture = GFX_evt_space_dragon
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_dragon_end
		any_country = {
			has_country_flag = nep_dragon_summoner
		}
	}

	immediate = {
		create_fleet = {
			name = "NAME_Astaroth"
			settings = {
				spawn_debris = no
				can_upgrade = no
				uses_naval_capacity = no
				can_change_composition = no
				can_change_leader = no
			}
			effect = {
				set_owner = root
				create_ship = {
					name = "NAME_Heptagram_Dragon"
					design = "NAME_Heptagram_Dragon_Rebirth_design"
					effect = {
						nep_easy_mod_reward = yes
					}
				}
				set_location = {
					target = event_target:nep_dragon_star
					distance = 1
					angle = random
				}
			}
		}
		event_target:nep_Auriel_planet = {
			if = {
				limit = {
					has_modifier = nep_Auriel_modifier
				}
				remove_modifier = nep_Auriel_modifier
				add_modifier = {
					modifier = "nep_Auriel_debuff"
					days = 1800
				}
			}
		}
		event_target:nep_Gabriel_planet = {
			if = {
				limit = {
					has_modifier = nep_Gabriel_modifier
				}
				remove_modifier = nep_Gabriel_modifier
				add_modifier = {
					modifier = "nep_Gabriel_debuff"
					days = 1800
				}
			}
		}
		event_target:nep_Sabriel_planet = {
			if = {
				limit = {
					has_modifier = nep_Sabriel_modifier
				}
				remove_modifier = nep_Sabriel_modifier
				add_modifier = {
					modifier = "nep_Sabriel_debuff"
					days = 1800
				}
			}
		}
		event_target:nep_Samuel_planet = {
			if = {
				limit = {
					has_modifier = nep_Samuel_modifier
				}
				remove_modifier = nep_Samuel_modifier
				add_modifier = {
					modifier = "nep_Samuel_debuff"
					days = 1800
				}
			}
		}		
		event_target:nep_Michael_planet = {
			if = {
				limit = {
					has_modifier = nep_Michael_modifier
				}
				remove_modifier = nep_Michael_modifier
				add_modifier = {
					modifier = "nep_Michael_debuff"
					days = 1800
				}
			}
		}		
		event_target:nep_Jauiel_planet = {
			if = {
				limit = {
					has_modifier = nep_Jauiel_modifier
				}
				remove_modifier = nep_Jauiel_modifier
				add_modifier = {
					modifier = "nep_Jauiel_debuff"
					days = 1800
				}
			}
		}		
		event_target:nep_Anael_planet = {
			if = {
				limit = {
					has_modifier = nep_Anael_modifier
				}
				remove_modifier = nep_Anael_modifier
				add_modifier = {
					modifier = "nep_Anael_debuff"
					days = 1800
				}
			}
		}
		set_country_flag = nep_dragon_summoner_summoned
		country_event = { id = nep_dragon.92 days = 1800 }
	}
	
	option = {
		name = nep_dragon.9.a
	}
}

#summon failed
country_event = {
	id = nep_dragon.91
	title = "nep_dragon.91.name"
	desc = "nep_dragon.91.desc"
	picture = GFX_evt_space_dragon
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_dragon_end
		has_country_flag = nep_dragon_summoner
	}

	immediate = {
		enable_special_project = {
			name = "nep_dragon_summon"
			location = event_target:nep_dragon_star
			owner = this
		}
	}
	
	option = {
		name = nep_dragon.9.a
	}
}

#Buff reward
country_event = {
	id = nep_dragon.910
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_global_flag = nep_dragon_r_in_battle
		}
	}
	
	immediate = {
		random_owned_ship = {
			limit = {
				is_ship_size = nep_dragon_reward
			}
			set_global_flag = nep_dragon_r_in_battle
			ship_event = { id = nep_dragon.911 days = 3 }
		}
	}
}
			
ship_event = {
	id = nep_dragon.911
	hide_window = yes
				
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_hp_percentage > 0
			}
			repair_percentage = 0.05
		}
		else = {
			remove_global_flag = nep_dragon_r_in_battle
		}
		if = {
			limit = {
				is_in_combat = yes
			}
			ship_event = { id = nep_dragon.911 days = 3 }
		}
		else = {
			remove_global_flag = nep_dragon_r_in_battle
		}
	}
}

#Starforce return(HIDDEN)
country_event = {
	id = nep_dragon.92
	hide_window = yes
	
	is_triggered_only = yes

	immediate = {
		event_target:nep_Auriel_planet = {
			add_modifier = {
				modifier = "nep_Auriel_modifier"
				days = -1
			}
		}
		event_target:nep_Gabriel_planet = {
			add_modifier = {
				modifier = "nep_Gabriel_modifier"
				days = -1
			}
		}
		event_target:nep_Sabriel_planet = {
			add_modifier = {
				modifier = "nep_Sabriel_modifier"
				days = -1
			}
		}
		event_target:nep_Samuel_planet = {
			add_modifier = {
				modifier = "nep_Samuel_modifier"
				days = -1
			}
		}		
		event_target:nep_Michael_planet = {
			add_modifier = {
				modifier = "nep_Michael_modifier"
				days = -1
			}
		}		
		event_target:nep_Jauiel_planet = {
			add_modifier = {
				modifier = "nep_Jauiel_modifier"
				days = -1
			}
		}		
		event_target:nep_Anael_planet = {
			add_modifier = {
				modifier = "nep_Anael_modifier"
				days = -1
			}
		}
		random_country = {
			limit = {
				has_country_flag = nep_dragon_summoner
			}
			if = {
				limit = {
					any_owned_ship = { is_ship_size = nep_dragon_reward }
				}
				country_event = { id = nep_dragon.93 }
			}
		}
	}
}

#dragon_kai.project
country_event = {
	id = nep_dragon.93
	title = "nep_dragon.93.name"
	desc = "nep_dragon.93.desc"
	picture = GFX_evt_space_dragon
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_dragon_end
		has_country_flag = nep_dragon_summoner
		any_owned_ship = { is_ship_size = nep_dragon_reward }
		NOT = { any_owned_ship = { is_ship_size = nep_dragon_reward_kai } }
	}
	
	immediate = {
		set_country_flag = nep_dragon_kaier
	}
	
	#agree
	option = {
		name = nep_dragon.93.a
		enable_special_project = {
			name = "nep_dragon_kaier"
			location = event_target:nep_dragon_star
			owner = ROOT
		}
	}
	
	#Maybe later
	option = {
		name = nep_dragon.93.b
		custom_tooltip = nep_dragon.8.b.tooltip
		hidden_effect = { remove_country_flag = nep_dragon_kaier }
		country_event = { id = nep_dragon.931 days = 360 }
	}
	
	#It's dangerous
	option = {
		name = nep_dragon.93.c
		hidden_effect = { remove_country_flag = nep_dragon_kaier }
	}
}

country_event = {
	id = nep_dragon.931
	hide_window = yes

	is_triggered_only = yes
	
	immediate = {
		set_country_flag = nep_dragon_kaier
		country_event = { id = nep_dragon.93 }
	}
}

#kai success
country_event = {
	id = nep_dragon.94
	title = "nep_dragon.94.name"
	desc = "nep_dragon.94.desc"
	picture = GFX_evt_space_dragon
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_dragon_end
		has_country_flag = nep_dragon_kaier
	}

	immediate = {
		random_system = {
			limit = { has_star_flag = nep_dragon_system }
			every_fleet_in_system = {
				destroy_fleet = {
					target = this
					destroy_template= yes
				}
			}
		}
		create_fleet = {
			name = "NAME_Astaroth"
			settings = {
				spawn_debris = no
				can_upgrade = no
				uses_naval_capacity = no
				can_change_composition = no
				can_change_leader = no
			}
			effect = {
				set_owner = root
				create_ship = {
					name = "NAME_Heptagram_Dragon"
					design = "NAME_Heptagram_Dragon_Kai_design"
					effect = {
						nep_easy_mod_reward = yes
					}
				}
				set_location = {
					target = event_target:nep_dragon_star
					distance = 1
					angle = random
				}
			}
		}
		event_target:nep_Auriel_planet = {
			if = {
				limit = {
					has_modifier = nep_Auriel_modifier
				}
				remove_modifier = nep_Auriel_modifier
				add_modifier = {
					modifier = "nep_Auriel_debuff"
					days = 1800
				}
			}
		}
		event_target:nep_Gabriel_planet = {
			if = {
				limit = {
					has_modifier = nep_Gabriel_modifier
				}
				remove_modifier = nep_Gabriel_modifier
				add_modifier = {
					modifier = "nep_Gabriel_debuff"
					days = 1800
				}
			}
		}
		event_target:nep_Sabriel_planet = {
			if = {
				limit = {
					has_modifier = nep_Sabriel_modifier
				}
				remove_modifier = nep_Sabriel_modifier
				add_modifier = {
					modifier = "nep_Sabriel_debuff"
					days = 1800
				}
			}
		}
		event_target:nep_Samuel_planet = {
			if = {
				limit = {
					has_modifier = nep_Samuel_modifier
				}
				remove_modifier = nep_Samuel_modifier
				add_modifier = {
					modifier = "nep_Samuel_debuff"
					days = 1800
				}
			}
		}		
		event_target:nep_Michael_planet = {
			if = {
				limit = {
					has_modifier = nep_Michael_modifier
				}
				remove_modifier = nep_Michael_modifier
				add_modifier = {
					modifier = "nep_Michael_debuff"
					days = 1800
				}
			}
		}		
		event_target:nep_Jauiel_planet = {
			if = {
				limit = {
					has_modifier = nep_Jauiel_modifier
				}
				remove_modifier = nep_Jauiel_modifier
				add_modifier = {
					modifier = "nep_Jauiel_debuff"
					days = 1800
				}
			}
		}		
		event_target:nep_Anael_planet = {
			if = {
				limit = {
					has_modifier = nep_Anael_modifier
				}
				remove_modifier = nep_Anael_modifier
				add_modifier = {
					modifier = "nep_Anael_debuff"
					days = 1800
				}
			}
		}
		country_event = { id = nep_dragon.92 days = 1800 }
	}
	
	option = {
		name = nep_dragon.94.a
	}
}

country_event = {
	id = nep_dragon.941
	title = "nep_dragon.941.name"
	desc = "nep_dragon.941.desc"
	picture = GFX_evt_space_dragon
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_dragon_end
		any_country = {
			has_country_flag = nep_dragon_kaier
		}
	}

	immediate = {
		random_country = {
			limit = {
				has_country_flag = nep_dragon_kaier
			}
			enable_special_project = {
				name = "nep_dragon_kaier"
				location = event_target:nep_dragon_star
				owner = this
			}
		}
	}
	
	option = {
		name = nep_dragon.941.a
	}
}

#Buff reward kai
country_event = {
	id = nep_dragon.9400
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_global_flag = nep_dragon_rk_in_battle
		}
	}
	
	immediate = {
		random_owned_ship = {
			limit = {
				is_ship_size = nep_dragon_reward_kai
				is_in_combat = yes
			}
			set_global_flag = nep_dragon_rk_in_battle
			ship_event = { id = nep_dragon.9401 days = 3 }
		}
	}
}
			
ship_event = {
	id = nep_dragon.9401
	hide_window = yes
				
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_hp_percentage > 0
				is_in_combat = yes
			}
			repair_percentage = 0.25
		}
		else = {
			remove_global_flag = nep_dragon_rk_in_battle
		}
		if = {
			limit = {
				is_in_combat = yes
			}
			ship_event = { id = nep_dragon.9401 days = 3 }
		}
		else = {
			remove_global_flag = nep_dragon_rk_in_battle
		}
	}
}

country_event = {
	id = nep_dragon.9402
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_global_flag = nep_dragon_rk_in_battle_2
		}
	}
	
	immediate = {
		random_owned_ship = {
			limit = {
				is_ship_size = nep_dragon_reward_kai
				is_in_combat = yes
			}
			set_global_flag = nep_dragon_rk_in_battle_2
			ship_event = { id = nep_dragon.9403 days = 10 }
		}
	}
}
			
ship_event = {
	id = nep_dragon.9403
	hide_window = yes
				
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_hp_percentage > 0
				is_in_combat = yes
			}
			create_dragon_babys = yes
		}
		else = {
			remove_global_flag = nep_dragon_rk_in_battle_2
		}
		if = {
			limit = {
				is_in_combat = yes
			}
			ship_event = { id = nep_dragon.9403 days = 10 }
		}
		else = {
			remove_global_flag = nep_dragon_rk_in_battle_2
		}
	}
}

#restore temples
planet_event = {
	id = nep_dragon.991
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_dragon_begin
		OR = {
			has_planet_flag = nep_Auriel_planet
			has_planet_flag = nep_Gabriel_planet
			has_planet_flag = nep_Sabriel_planet
			has_planet_flag = nep_Samuel_planet
			has_planet_flag = nep_Michael_planet
			has_planet_flag = nep_Jauiel_planet
			has_planet_flag = nep_Anael_planet
		}
	}
	
	immediate = {
		planet_event = { id = nep_dragon.4000 }
		if = {
			limit = {
				NOR = {
					has_deposit = d_nep_dragon_temple
					has_deposit = d_nep_unknown_vortex
				}
			}
			add_deposit = d_nep_unknown_vortex
		}
	}
}

#Destroy Babys
fleet_event = {
	id = nep_dragon.999
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		exists = this
	}
	
	immediate = {
		destroy_fleet = {
			target = this
			destroy_template = yes
		}		
	}
}

#Destroy Babys
#on_ship_destroyed_victim
country_event = {
	id = nep_dragon.998
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		FromFrom = {
			OR = {
				is_ship_size = nep_dragon
				is_ship_size = nep_dragon_reward
				is_ship_size = nep_dragon_reward_kai
			}
		}
	}
	
	immediate = {
		every_owned_ship = {
			limit = { is_ship_size = nep_dragon_baby }
			if = {
				limit = {
					exists = this
					fleet = { any_owned_ship = { NOT = { is_ship_size = nep_dragon_baby } } } 
				}
				fleet = {
					destroy_fleet = {
						target = this
						destroy_template = yes
					}
				}
			}
			else = {
				destroy_ship = this
			}
		}
	}
}

namespace = nep_dragon_origin
event = {
	id = nep_dragon_origin.1
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		any_country = { 
			has_origin = nep_heptagram_origin 
		}
	}
	
	immediate = {
		every_country = {
			limit = { has_origin = nep_heptagram_origin }
			if = {
				limit = { is_ai = yes }
				set_origin = origin_default
			}
			else = {
				if = {
					limit = { NOT = { has_global_flag = nep_heptagram_system_spawn } }
					set_spawn_system_batch = begin
					no_scope = {
						spawn_system = {
							min_distance >= 540
							max_distance <= 550
							min_orientation_angle = 133
							max_orientation_angle = 135
							hyperlane = no
							initializer = nep_Aemethms_init
						}
					}
					random_system = {
						limit = {
							has_star_flag = nep_dragon_system
						}
						spawn_system = {
							min_distance >= 20
							max_distance <= 20
							min_orientation_angle = 0
							max_orientation_angle = 0
							hyperlane = no
							initializer = nep_Auriel_init
						}
						spawn_system = {
							min_distance >= 20
							max_distance <= 20
							min_orientation_angle = -51.42
							max_orientation_angle = -51.42
							hyperlane = no
							initializer = nep_Gabriel_init
						}
						spawn_system = {
							min_distance >= 20
							max_distance <= 20
							min_orientation_angle = -102.85
							max_orientation_angle = -102.85
							hyperlane = no
							initializer = nep_Sabriel_init
						}
						spawn_system = {
							min_distance >= 20
							max_distance <= 20
							min_orientation_angle = -154.28
							max_orientation_angle = -154.28
							hyperlane = no
							initializer = nep_Samuel_init
						}
						spawn_system = {
							min_distance >= 20
							max_distance <= 20
							min_orientation_angle = -205.71
							max_orientation_angle = -205.71
							hyperlane = no
							initializer = nep_Michael_init
						}
						spawn_system = {
							min_distance >= 20
							max_distance <= 20
							min_orientation_angle = -257.14
							max_orientation_angle = -257.14
							hyperlane = no
							initializer = nep_Jauiel_init
						}
						spawn_system = {
							min_distance >= 20
							max_distance <= 20
							min_orientation_angle = -308.57
							max_orientation_angle = -308.57
							hyperlane = no
							initializer = nep_Anael_init
						}
					}
					random_system = {
						limit = { has_star_flag = nep_Auriel_system }
						save_event_target_as = nep_heptagram_system_1
					}
					random_system = {
						limit = { has_star_flag = nep_Gabriel_system }
						save_event_target_as = nep_heptagram_system_2
					}
					random_system = {
						limit = { has_star_flag = nep_Sabriel_system }
						save_event_target_as = nep_heptagram_system_3
					}
					random_system = {
						limit = { has_star_flag = nep_Samuel_system }
						save_event_target_as = nep_heptagram_system_4
					}
					random_system = {
						limit = { has_star_flag = nep_Michael_system }
						save_global_event_target_as = nep_heptagram_system_5
					}
					random_system = {
						limit = { has_star_flag = nep_Jauiel_system }
						save_event_target_as = nep_heptagram_system_6
					}
					random_system = {
						limit = { has_star_flag = nep_Anael_system }
						save_event_target_as = nep_heptagram_system_7
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_1
						to = event_target:nep_heptagram_system_2
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_2
						to = event_target:nep_heptagram_system_3
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_3
						to = event_target:nep_heptagram_system_4
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_4
						to = event_target:nep_heptagram_system_5
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_6
						to = event_target:nep_heptagram_system_5
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_6
						to = event_target:nep_heptagram_system_7
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_1
						to = event_target:nep_heptagram_system_7
					}
					
					add_hyperlane = {
						from = event_target:nep_heptagram_system_1
						to = event_target:nep_heptagram_system_3
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_3
						to = event_target:nep_heptagram_system_5
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_5
						to = event_target:nep_heptagram_system_7
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_7
						to = event_target:nep_heptagram_system_2
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_2
						to = event_target:nep_heptagram_system_4
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_4
						to = event_target:nep_heptagram_system_6
					}
					add_hyperlane = {
						from = event_target:nep_heptagram_system_1
						to = event_target:nep_heptagram_system_6
					}
					set_spawn_system_batch = end
					set_global_flag = nep_heptagram_system_spawn
					
					event_target:nep_Auriel_planet = {
						change_pc = pc_gaia
						set_planet_entity = {
							entity = "gaia_planet_01_entity"
						}
						reroll_planet = yes
						# add_modifier = {
							# modifier = "nep_Auriel_modifier"
							# days = -1
						# }
						# add_deposit = "d_nep_unknown_vortex"
					}
					event_target:nep_Gabriel_planet = {
						change_pc = pc_gaia
						set_planet_entity = {
							entity = "gaia_planet_01_entity"
						}
						reroll_planet = yes
						# add_modifier = {
							# modifier = "nep_Gabriel_modifier"
							# days = -1
						# }
						# add_deposit = "d_nep_unknown_vortex"
						add_deposit = d_rich_mountain
						add_deposit = d_rich_mountain
					}
					event_target:nep_Sabriel_planet = {
						change_pc = pc_gaia
						set_planet_entity = {
							entity = "gaia_planet_01_entity"
						}
						reroll_planet = yes
						# add_modifier = {
							# modifier = "nep_Sabriel_modifier"
							# days = -1
						# }
						# add_deposit = "d_nep_unknown_vortex"
						add_deposit = d_underwater_vent
						add_deposit = d_underwater_vent
					}
					event_target:nep_Samuel_planet = {
						change_pc = pc_gaia
						set_planet_entity = {
							entity = "gaia_planet_01_entity"
						}
						reroll_planet = yes
						# add_modifier = {
							# modifier = "nep_Samuel_modifier"
							# days = -1
						# }
						# add_deposit = "d_nep_unknown_vortex"
					}
					event_target:nep_Michael_planet = {
						change_pc = pc_gaia
						set_planet_entity = {
							entity = "gaia_planet_01_entity"
						}
						reroll_planet = yes
						# add_modifier = {
							# modifier = "nep_Michael_modifier"
							# days = -1
						# }
						# add_deposit = "d_nep_unknown_vortex"
					}
					event_target:nep_Jauiel_planet = {
						change_pc = pc_gaia
						set_planet_entity = {
							entity = "gaia_planet_01_entity"
						}
						reroll_planet = yes
						# add_modifier = {
							# modifier = "nep_Jauiel_modifier"
							# days = -1
						# }
						# add_deposit = "d_nep_unknown_vortex"
					}
					event_target:nep_Anael_planet = {
						change_pc = pc_gaia
						set_planet_entity = {
							entity = "gaia_planet_01_entity"
						}
						reroll_planet = yes
						# add_modifier = {
							# modifier = "nep_Anael_modifier"
							# days = -1
						# }
						# add_deposit = "d_nep_unknown_vortex"
					}
					random_galaxy_planet = {
						limit = { 
							is_star = yes
							is_planet_class = pc_black_hole
							solar_system = {
								nep_st_is_not_outer_or_fe_system = yes 
								has_special_star_flag_trigger = no
								NOT = { exists = starbase }
							} 
						}
						solar_system = {
							spawn_megastructure = {
								name = "NAME_Sub_Seal_1"
								type = "nep_sealportal_node"
								orbit_angle = 0
								orbit_distance = 0
								planet = prev
							}
							set_star_flag = nep_dragon_origin_system
						}
						remove_planet = yes
					}
				}
				if = {
					limit = {
						any_galaxy_planet = {
							OR = {
								has_planet_flag = nep_Auriel_planet
								has_planet_flag = nep_Gabriel_planet
								has_planet_flag = nep_Sabriel_planet
								has_planet_flag = nep_Samuel_planet
								has_planet_flag = nep_Michael_planet
								has_planet_flag = nep_Jauiel_planet
								has_planet_flag = nep_Anael_planet
							}
							is_colony = no
						}
					}
					random_owned_leader = {
						limit = {
							leader_class = governor
						}
						unassign_leader = this
						save_global_event_target_as = nep_governor_temp
					}
					random_galaxy_planet = {
						limit = {
							OR = {
								has_planet_flag = nep_Auriel_planet
								has_planet_flag = nep_Gabriel_planet
								has_planet_flag = nep_Sabriel_planet
								has_planet_flag = nep_Samuel_planet
								has_planet_flag = nep_Michael_planet
								has_planet_flag = nep_Jauiel_planet
								has_planet_flag = nep_Anael_planet
							}
							is_colony = no
						}
						create_colony = { owner = prev }
						save_event_target_as = nep_dragon_origin_world
						generate_start_deposits_and_blockers = yes
						generate_start_buildings_and_districts = yes
						generate_start_pops = yes
						solar_system = { 
							create_starbase = {
								size = "starbase_starport"
								module = "shipyard"
								building = "crew_quarters"
								owner = prev
							}
						}
						prev.capital_scope = {
							event_target:nep_dragon_origin_world = {
								set_capital = yes
								assign_leader = event_target:nep_governor_temp
							}
							destroy_colony = yes
							clear_deposits = yes
							remove_all_buildings = yes
							remove_all_districts = yes
							change_pc = pc_barren_cold
							solar_system = {
								starbase = {
									fleet = {
										destroy_fleet = this
									}
								}
							}
						}
						prev = {
							every_owned_fleet = {
								limit = {
									any_owned_ship = {
										OR = {
											is_ship_size = constructor
											is_ship_size = science
											is_ship_size = corvette
										}
									}
								}
								if = {
									limit = {
										exists = leader
									}
									leader = {
										unassign_leader = this
										save_event_target_as = nep_scientist_temp
									}
								}
								destroy_fleet = this
							}
							add_research_option = tech_sealportal_dive
							add_tech_progress = {
								tech = tech_sealportal_dive
								progress = 0.80
							}
						}
						create_fleet = {
							effect = {
								set_owner = prev
								create_ship = {
									name = random
									random_existing_design = science
								}
								set_fleet_stance = evasive
								set_location = event_target:nep_dragon_origin_world
								set_leader = event_target:nep_scientist_temp
							}
						}
						create_fleet = {
							effect = {
								set_owner = prev
								create_ship = {
									name = random
									random_existing_design = constructor
								}
								set_fleet_stance = evasive
								set_location = event_target:nep_dragon_origin_world
							}
						}
						create_fleet = {
							set_take_point = yes
							effect = {
								set_owner = prev
								while = {
									count = 3
									create_ship = {
										name = random
										random_existing_design = corvette
									}
								}
								set_location = event_target:nep_dragon_origin_world
							}
						}
					}
				}
				else = {
					set_origin = origin_default
					country_event = { id = nep_dragon_origin.1000 }
				}
			}
		}
	}
}

country_event = {
	id = nep_dragon_origin.1000
	title = "nep_dragon_origin.1000.name"
	desc = "nep_dragon_origin.1000.desc"
	picture = GFX_evt_black_hole

	is_triggered_only = yes
	
	option = {
		name = OK
	}
}