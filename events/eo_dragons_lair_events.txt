namespace = eo_dragons_lair

#####Reset Ravinax's patrol
planet_event = {
	id = eo_dragons_lair.1
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_planet_flag = ravinax_alive
	}
	
	immediate = {
		solar_system = {
			every_system_planet = {
				remove_planet_flag = ravinax_patrol_1
				remove_planet_flag = ravinax_patrol_2
				remove_planet_flag = ravinax_patrol_3
				remove_planet_flag = ravinax_patrol_4
				remove_planet_flag = ravinax_patrol_5
			}
			random_system_planet = {
				limit = {
					NOT = {
						has_planet_flag = ravinax_world
						has_planet_flag = ravinax_lair
					}
				}
				set_planet_flag = ravinax_patrol_1
			}
			random_system_planet = {
				limit = {
					NOT = {
						has_planet_flag = ravinax_world
						has_planet_flag = ravinax_lair
						has_planet_flag = ravinax_patrol_1
					}
				}
				set_planet_flag = ravinax_patrol_2
			}
			random_system_planet = {
				limit = {
					NOT = {
						has_planet_flag = ravinax_world
						has_planet_flag = ravinax_lair
						has_planet_flag = ravinax_patrol_1
						has_planet_flag = ravinax_patrol_2
					}
				}
				set_planet_flag = ravinax_patrol_3
			}
			random_system_planet = {
				limit = {
					NOT = {
						has_planet_flag = ravinax_world
						has_planet_flag = ravinax_lair
						has_planet_flag = ravinax_patrol_1
						has_planet_flag = ravinax_patrol_2
						has_planet_flag = ravinax_patrol_3
					}
				}
				set_planet_flag = ravinax_patrol_4
			}
			random_system_planet = {
				limit = {
					NOT = {
						has_planet_flag = ravinax_world
						has_planet_flag = ravinax_lair
						has_planet_flag = ravinax_patrol_1
						has_planet_flag = ravinax_patrol_2
						has_planet_flag = ravinax_patrol_3
						has_planet_flag = ravinax_patrol_4
					}
				}
				set_planet_flag = ravinax_patrol_5
			}
		}
		if = {
			limit = {
				has_planet_flag = ravinax_alive
			}
			planet_event = { id = eo_dragons_lair.1 days = 1825 random = 5 }
		}
	}
}

#####Ravinax dies
country_event = {
	id = eo_dragons_lair.2
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = ravinax_country
	}

	immediate = {
		random_galaxy_planet = {
			limit = {
				has_planet_flag = ravinax_alive
			}
			remove_planet_flag = ravinax_alive
		}
	}
}

#####Set Ravinax's hunger
planet_event = {
	id = eo_dragons_lair.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_planet_flag = ravinax_world
		solar_system = {
			any_system_planet = {
				has_planet_flag = ravinax_alive
			}
		}
	}

	immediate = {
		if = {
			limit = {
				has_planet_flag = dragon_feed_0
			}
			remove_planet_flag = dragon_feed_0
			set_planet_flag = dragon_feed_1
		}
		else_if = {
			limit = {
				has_planet_flag = dragon_feed_1
			}
			remove_planet_flag = dragon_feed_1
			set_planet_flag = dragon_feed_2
		}
		else_if = {
			limit = {
				has_planet_flag = dragon_feed_2
			}
			remove_planet_flag = dragon_feed_2
			set_planet_flag = dragon_feed_3
		}
	}
}

#Ravinax eats
country_event = {
	id = eo_dragons_lair.4
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		any_owned_planet = {
			has_planet_flag = ravinax_world
			has_planet_flag = dragon_feed_3
			any_fleet_in_orbit = {
				has_fleet_flag = ravinax
			}
		}
	}
	immediate = {
		random_owned_planet = {
			limit = {
				has_planet_flag = ravinax_world
			}
			save_event_target_as = ravinax_world
		}
		event_target:ravinax_world = {
			remove_planet_flag = dragon_feed_3
			set_planet_flag = dragon_feed_0
			planet_event = { id = eo_dragons_lair.5 days = 10 random = 10 }
		}
	}
}

planet_event = {
	id = eo_dragons_lair.5
	title = eo_dragons_lair.5.name
	picture = GFX_evt_space_dragon_green
	show_sound = distance_dragon_attack_mouth
	location = this
	
	is_triggered_only = yes

	desc = {
		text = eo_dragons_lair.5.desc.a
		trigger = {
			owner = {
				is_gestalt = no
			}
		}
	}

	desc = {
		text = eo_dragons_lair.5.desc.b
		trigger = {
			owner = {
				is_gestalt = yes
			}
		}
	}

	immediate = {
		random_owned_pop = {
			limit = {
				is_being_purged = no
			}
			save_event_target_as = snack
		}
	}

	option = {
		name = eo_dragons_lair.5.a
		ai_chance = {
			factor = 10
		}
		event_target:snack = {
			kill_pop = yes
		}
		add_planet_devastation = 20
	}

	option = {
		name = eo_dragons_lair.5.b
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				owner = {
					fleet_power < 15000
				}
			}
			modifier = {
				factor = 0
				owner = {
					is_at_war = yes
				}
			}
			modifier = {
				factor = 0.5
				owner = {
					fleet_power < 30000
				}
			}
			modifier = {
				factor = 5
				owner = {
					fleet_power > 30000
					fleet_power < 40000
				}
			}
			modifier = {
				factor = 10
				owner = {
					fleet_power > 40000
				}
			}
			modifier = {
				factor = 0.1
    			owner = {
					OR = {
						has_ethic = ethic_fanatic_spiritualist
						has_ethic = ethic_spiritualist
					}
				}
			}
			modifier = {
				factor = 1.5
    			owner = {
					OR = {
						has_ethic = ethic_fanatic_militarist
						has_ethic = ethic_militarist
					}
				}
			}
		}
		event_target:snack = {
			kill_pop = yes
		}
		add_planet_devastation = 20
		event_target:ravinax_country = {
			set_faction_hostility = {
				target = prev.owner
				set_hostile = yes
				set_neutral = no
				set_friendly = no
			}
		}
	}
}

#Make Ravinax friendly
country_event = {
	id = eo_dragons_lair.6
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		OR = {
			this = {
				OR = {
					has_country_flag = dragons_lair_country
					any_federation_ally = {
						has_country_flag = dragons_lair_country
					}
				}
			}
			from = {
				has_country_flag = dragons_lair_country
			}
		}
	}
	immediate = {
		this = {
			random_country = {
				limit = {
					has_country_flag = ravinax_country
				}
				set_faction_hostility = {
					target = prev
					set_hostile = no
					set_neutral = yes
					set_friendly = no
				}
				save_event_target_as = ravinax_country
			}
			every_federation_ally = {
				event_target:ravinax_country = {
					set_faction_hostility = {
						target = prev
						set_hostile = no
						set_neutral = yes
						set_friendly = no
					}
				}
			}
		}
		from = {
			event_target:ravinax_country = {
				set_faction_hostility = {
					target = prev
					set_hostile = no
					set_neutral = yes
					set_friendly = no
				}
			}
		}
	}
}

#Make Ravinax hostile
country_event = {
	id = eo_dragons_lair.7
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		OR = {
			this = {
				OR = {
					has_country_flag = dragons_lair_country
					any_federation_ally = {
						has_country_flag = dragons_lair_country
					}
				}
			}
			from = {
				has_country_flag = dragons_lair_country
			}
		}
	}
	immediate = {
		random_country = {
			limit = {
				has_country_flag = ravinax_country
			}
			save_event_target_as = ravinax_country
		}
		if = {
			limit = {
				from = {
					has_country_flag = dragons_lair_country
				}
			}
			this = {
				event_target:ravinax_country = {
					set_faction_hostility = {
						target = prev
						set_hostile = yes
						set_neutral = no
						set_friendly = no
					}
				}
				every_federation_ally = {
					event_target:ravinax_country = {
						set_faction_hostility = {
							target = prev
							set_hostile = yes
							set_neutral = no
							set_friendly = no
						}
					}
				}
			}
		}
		else = {
			from = {
				event_target:ravinax_country = {
					set_faction_hostility = {
						target = prev
						set_hostile = no
						set_neutral = yes
						set_friendly = no
					}
				}
			}
		}
	}
}