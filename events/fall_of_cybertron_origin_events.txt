namespace = cybertron_shutdown

#CYBERTRON SHUTTING DOWN
#SET UP
country_event = {
	id = cybertron_shutdown.1
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_origin = origin_cybertron
	}
	
	immediate = {
		save_event_target_as = cybertron_shutdown_owner
		capital_scope = {
			set_planet_flag = cybertron_shutdown_origin
			add_modifier = {
				modifier = core_shutdown_0
			}
			planet_event = { id = cybertron_shutdown.2 days = 5 }
		}
	}
}

#CORE SHUTDOWN 2
planet_event = {
	id = cybertron_shutdown.2
	title = "origin_cybertron_shutdown.2.name"
	desc = "origin_cybertron_shutdown.2.desc"
	picture = "GFX_evt_cybertron_shutdown"
	show_sound = event_wind_ruins
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			is_planet_class = pc_restored_cybertron
			is_planet_class = pc_corrupted_cybertron
		}
	}
	
	immediate = {
		add_planet_devastation = 10
		planet_event = { id = cybertron_shutdown.3 days = 1400 random = 1200 }
	}
	
	option = {
		name = DISCONCERTING
		tooltip = {
			add_planet_devastation = 10
			add_modifier = {
				modifier = core_shutdown_1
			}
		}
	}
}
#CORE SHUTDOWN 3
planet_event = {
	id = cybertron_shutdown.3
	title = "origin_cybertron_shutdown.3.name"
	desc = "origin_cybertron_shutdown.3.desc"
	picture = "GFX_evt_cybertron_shutdown"
	show_sound = event_wind_ruins
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			is_planet_class = pc_restored_cybertron
			is_planet_class = pc_corrupted_cybertron
		}
	}
	
	immediate = {
		remove_modifier = core_shutdown_0
		add_modifier = {
			modifier = core_shutdown_1
		}
		add_planet_devastation = 25
		planet_event = { id = cybertron_shutdown.4 days = 1200 random = 1000 }
	}
	option = {
		name = DISCONCERTING
		tooltip = {
			add_planet_devastation = 25
			add_modifier = {
				modifier = core_shutdown_1
			}
		}
	}
}
#CORE SHUTDOWN 4
planet_event = {
	id = cybertron_shutdown.4
	title = "origin_cybertron_shutdown.4.name"
	desc = "origin_cybertron_shutdown.4.desc"
	picture = "GFX_evt_cybertron_shutdown"
	show_sound = event_wind_ruins
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			is_planet_class = pc_restored_cybertron
			is_planet_class = pc_corrupted_cybertron
		}
	}
	
	immediate = {
		remove_modifier = core_shutdown_1
		add_modifier = {
			modifier = core_shutdown_2
		}
		add_planet_devastation = 50
		planet_event = { id = cybertron_shutdown.45 days = 1000 random = 700 }
	}
	option = {
		name = DISCONCERTING
		tooltip = {
			add_planet_devastation = 50
			add_modifier = {
				modifier = core_shutdown_2
			}
		}
	}
}

#CORE SHUTDOWN 5
planet_event = {
	id = cybertron_shutdown.45
	title = "origin_cybertron_shutdown.45.name"
	desc = "origin_cybertron_shutdown.45.desc"
	picture = "GFX_evt_cybertron_shutdown"
	show_sound = event_wind_ruins
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			is_planet_class = pc_restored_cybertron
			is_planet_class = pc_corrupted_cybertron
		}
	}
	
	immediate = {
		remove_modifier = core_shutdown_2
		add_modifier = {
			modifier = core_shutdown_3
		}
		add_planet_devastation = 75
		planet_event = { id = cybertron_shutdown.5 days = 800 random = 600 }
	}
	option = {
		name = DISCONCERTING
		tooltip = {
			add_planet_devastation = 75
			add_modifier = {
				modifier = core_shutdown_3
			}
		}
	}
}

#CORE SHUTDOWN COMPLETE
planet_event = {
	id = cybertron_shutdown.5
	title = "origin_cybertron_shutdown.5.name"
	desc = {
		trigger = {
			has_planet_flag = cybertron_lost_some_pops
			has_planet_flag = cybertron_shutdown_still_original_owner
			event_target:cybertron_shutdown_owner = {
				has_origin = origin_cybertron
			}
		}
		text = "origin_cybertron_shutdown.5b.desc"
	}
	desc = {
		trigger = {
			has_planet_flag = cybertron_lost_everything
			has_planet_flag = cybertron_shutdown_still_original_owner
			event_target:cybertron_shutdown_owner = {
				has_origin = origin_cybertron
			}
		}
		text = "origin_cybertron_shutdown.5a.desc"
	}
	picture = "GFX_evt_cybertron_shutdown_total"
	show_sound = event_screams
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			is_planet_class = pc_restored_cybertron
			is_planet_class = pc_corrupted_cybertron
		}
	}

	immediate = {
		if = {
			limit = {
				has_owner = yes
				owner = { is_same_value = event_target:cybertron_shutdown_owner }
			}
			set_planet_flag = cybertron_shutdown_still_original_owner
			if = {
				limit = {
					owner = { num_owned_planets = 1 }
				}
				set_planet_flag = cybertron_lost_everything
				owner = { set_country_flag = silence_destroy_event }
			}
			else_if = {
				limit = {
					owner = { num_owned_planets > 1 }
					num_pops >= 20
				}
				set_planet_flag = cybertron_lost_many_pops
			}
			else_if = {
				limit = {
					owner = { num_owned_planets > 1 }
					num_pops >= 19
					num_pops > 0
				}
				set_planet_flag = cybertron_lost_some_pops
			}
			event_target:cybertron_shutdown_owner = {
				every_relation = {
					limit = {
						is_ai = no
						has_communications = prev
						OR = {
							has_intel_level = {
								who = prev
								category = government
								level >= 1
							}
							has_intel_level = {
								who = prev
								category = economy
								level >= 1
							}
						}
					}
					country_event = { id = cybertron_shutdown.90 }
				}
			}
		}
		else = {
			event_target:cybertron_shutdown_owner = {
				country_event = { id = cybertron_shutdown.81 }
				every_relation = {	
					limit = {
						is_ai = no
						has_communications = prev 
						OR = {
							has_intel_level = {
								who = prev
								category = government
								level >= 1
							}
							has_intel_level = {
								who = prev
								category = economy
								level >= 1
							}
						}
					}
					country_event = { id = cybertron_shutdown.91 }
				}
			}
		}
		every_owned_pop = { kill_pop = yes }
		destroy_colony = yes
		change_pc = pc_dead_cybertron
		set_planet_entity = {
			entity = "dead_cybertron_planet_01_entity"
			picture = pc_dead_cybertron
		}
		clear_deposits = yes
		add_deposit = d_crystal_city_ruins
		add_deposit = d_cybertron_ruins
		add_deposit = d_cybertron_ruins
		add_deposit = d_insecticon_infestation
		add_deposit = d_damaged_cybertron_core
		add_deposit = d_sea_of_rust
		add_deposit = d_deactivated_space_bridge
		add_deposit = d_inactive_well_of_all_sparks
		add_deposit = d_dead_iacon_city
		add_deposit = d_dead_kaon_city
		add_deposit = d_dead_teletraan_one
		remove_modifier = core_shutdown_3
		remove_modifier = core_shutdown_4
		add_modifier = {
			modifier = core_shutdown_5
			days = -1
		}
		add_planet_devastation = 100
	}
	
	option = {
		name = TERRIBLE
		trigger = {
			has_planet_flag = cybertron_lost_everything
		}
	}
	option = {
		name = UNFORTUNATE
		trigger = {
			has_planet_flag = cybertron_lost_many_pops
		}
	}
	option = {
		name = UNFORTUNATE
		trigger = {
			has_planet_flag = cybertron_lost_some_pops
		}
	}
	option = {
		name = UNFORTUNATE
		trigger = {
			NOR = {
				has_planet_flag = cybertron_lost_everything
				has_planet_flag = cybertron_lost_many_pops
				has_planet_flag = cybertron_lost_some_pops
			}
		}
	}
}

# Cybertron Shutdown 6 - Cybertron Evacuated
country_event = {
	id = cybertron_shutdown.81
	title = "cybertron_shutdown.81.name"
	desc = "cybertron_shutdown.81.desc"
	picture = GFX_evt_cybertron_shutdown_total
	show_sound = event_ground_battle
	location = from
	
	is_triggered_only = yes 
	
	option = {
		name = "cybertron_shutdown.81.a"
	}
}

# Cybertronian's Colonized Planet (HIDDEN)
planet_event = {
	id = cybertron_shutdown.84
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		owner = {
			has_origin = origin_cybertron
			NOT = { has_country_flag = first_cybertronian_colony }
		}
	}

	immediate = {
		owner = { set_country_flag = first_cybertronian_colony }
		planet_event = { id = cybertron_shutdown.85 days = 5 }
	}
}


# Cybertronian's Colonized Planet
planet_event = {
	id = cybertron_shutdown.85
	title = "cybertron_shutdown.85.name"
	desc = {
		trigger = {
			owner = { is_gestalt = no }
			habitability = {
				who = root.owner.owner_species
				value >= 0.5
			}
		}
		text = "cybertron_shutdown.85.1.desc"
	}
	desc = {
		trigger = {
			owner = { is_gestalt = no }
			habitability = {
				who = root.owner.owner_species
				value < 0.5
			}
		}
		text = "cybertron_shutdown.85.2.desc"
	}
	desc = {
		trigger = {
			owner = { is_gestalt = yes }
		}
		text = "cybertron_shutdown.85.3.desc"
	}
	picture = GFX_evt_landing_ship
	show_sound = event_ship_thrusters
	location = root

	is_triggered_only = yes
	
	immediate = {
		add_deposit = d_cybertronian_colony
		add_deposit = d_energon_crystals
		add_building = building_energon_mine
		add_modifier = {
			modifier = "cybertron_shutdown_first_colony"
			days = 1800
		}
	}
	option = {
		name = cybertron_shutdown.85.a
		owner = {
			if = {
				limit = { is_gestalt = yes }
				add_modifier = {
					modifier = "doomsday_first_colony_gestalt"
					days = 1800
				}
			}
			add_monthly_resource_mult = {
				resource = unity
				value = @tier2unityreward
				min = @tier2unitymin
				max = @tier2unitymax
			}
		}
		
	}
}


# Fall of Cybertron - Neighbors Informed
country_event = {
	id = cybertron_shutdown.90
	title = "cybertron_shutdown.90.name"
	desc = {
		trigger = {
			from = { has_planet_flag = cybertron_lost_some_pops }
			event_target:doomsday_owner = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
			}
		}
		text = "cybertron_shutdown.90.1.desc"
	}
	desc = {
		trigger = {
			from = { has_planet_flag = cybertron_lost_some_pops }
			event_target:doomsday_owner = { has_ethic = ethic_gestalt_consciousness }
		}
		text = "cybertron_shutdown.90.1.gestalt.desc"
	}
	desc = {
		trigger = {
			from = { has_planet_flag = cybertron_lost_many_pops }
			event_target:doomsday_owner = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
			}
		}
		text = "cybertron_shutdown.90.2.desc"
	}
	desc = {
		trigger = {
			from = { has_planet_flag = cybertron_lost_many_pops }
			event_target:doomsday_owner = { has_ethic = ethic_gestalt_consciousness }
		}
		text = "cybertron_shutdown.90.2.gestalt.desc"
	}
	desc = {
		trigger = {
			from = { has_planet_flag = cybertron_lost_everything }
		}
		text = "cybertron_shutdown.90.3.desc"
	}
	picture = GFX_evt_cybertron_shutdown_total
	show_sound = event_wind_ruins
	location = from

	is_triggered_only = yes

	option = {
		name = cybertron_shutdown.90.a
	}
}

# Cybertron - Neighbors Informed, Planet Completely Evacuated (Mostly)
country_event = {
	id = cybertron_shutdown.91
	title = "cybertron_shutdown.91.name"
	desc = "cybertron_shutdown.91.desc"
	picture = GFX_evt_cybertron_shutdown_total
	show_sound = event_wind_ruins
	location = from

	is_triggered_only = yes

	option = {
		name = cybertron_shutdown.91.a
	}
}

#CYBERTRON RESTORED
country_event = {
	id = cybertron_shutdown.6
	title = "origin_cybertron_shutdown.6.name"
	desc = "origin_cybertron_shutdown.6.desc"
	picture = GFX_evt_cybertron_restored
	show_sound = event_celebration
	location = from
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		
		add_monthly_resource_mult = {
			resource = unity
			value = @tier2unityreward
			min = @tier2unitymin
			max = @tier2unitymax
		}
		owner = {
			country_event = { id = cybertron_shutdown.12 days = 30 }
		}
	}
	
	
}

#ALLSPARK RELIC
country_event = {
	id = cybertron_shutdown.12
	title = "origin_cybertron_shutdown.12.name"
	desc = "origin_cybertron_shutdown.12.desc"
	picture = GFX_evt_vector_sigma_key_location
	show_sound = event_wind_ruins
	location = from
	
	is_triggered_only = yes 
	
	fire_only_once = yes 
	
	trigger = {
		owner = {
			is_ai = no
		}
	}
	
	immediate = {
	}
	
	option = {
		name = "allspark.1.a"
		trigger = {
			owner = {
				is_cybertronian = yes
			}
		}
		owner = {
			add_resource = {
				energy = -5000
			}
			country_event = { id = cybertron_shutdown.13 days = 360 } 
		}
	}
	option = {
		name = "allspark.1.b"
		trigger = {
			owner = {
				NOT = {
					is_cybertronian = yes 
				}
			}
		}
		owner = {
			add_resource = {
				energy = -5000
			}
			country_event = { id = cybertron_shutdown.13 days = 360 } 
		}
	}
	option = {
		name = "allspark.1.c"
		add_monthly_resource_mult = {
			resource = unity
			value = @tier2unityreward
			min = @tier2unitymin
			max = @tier2unitymax
		}
	}
}


country_event = {
	id = cybertron_shutdown.13
	title = "origin_cybertron_shutdown.13.name"
	desc = "origin_cybertron_shutdown.13.desc"
	picture = GFX_evt_hall_of_records
	show_sound = event_door_opening
	
	is_triggered_only = yes
	
	option = {
		name = "allspark.2.a"
		small_artifact_reward = yes 
		owner = { country_event = { id = cybertron_shutdown.14 days = 120 } }
	}
}

country_event = {
	id = cybertron_shutdown.14
	title = "origin_cybertron_shutdown.14.name"
	desc = "origin_cybertron_shutdown.14.desc"
	picture = GFX_evt_hall_of_records_vault
	show_sound = event_metal_fatigue 
	
	is_triggered_only = yes
	
	option = {
		name = "allspark.3.a"
		small_artifact_reward = yes 
		owner = { country_event = { id = cybertron_shutdown.100 } }
	}
	option = {
		name = "allspark.3.b"
		small_artifact_reward = yes 
		add_monthly_resource_mult = {
			resource = physics_research
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
		add_monthly_resource_mult = {
			resource = society_research
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
		add_monthly_resource_mult = {
			resource = engineering_research
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
	}
}

# Theta Scorpii System Discovered (HIDDEN)
country_event = {
	id = cybertron_shutdown.100
	hide_window = yes 
	
	fire_only_once = yes 
	
	is_triggered_only = yes 
	
	immediate = {
		set_global_flag = theta_scorpii_system_discovered
		set_country_flag = theta_scorpii_system 
		
		random_system_within_border = {
			if = {
				limit = {
					any_system = {
						has_star_flag = cybertronian_home_system
					}
				}
			}
			save_event_target_as = theta_scorpii_spawn_system
		}
		event_target:theta_scorpii_spawn_system = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				max_jumps = 0
				initializer = "theta_scorpii_system"
			}
			if = {
				limit = { last_created_system = { NOT = { has_hyperlane_to = prev } } }
				add_hyperlane = {
					from = this 
					to = last_created_system
				}
			}
			else = {
				add_extra_hyperlane_to_spawned_system_effect = yes 
			}
		}
		country_event = { id = cybertron_shutdown.101 days = 2 }
	}
}

# Theta Scorpii System Discovered
country_event = {
	id = cybertron_shutdown.101
	title = "origin_cybertron_shutdown.101.name"
	desc = "origin_cybertron_shutdown.101.desc"
	picture = GFX_evt_star_chart
	location = event_target:theta_scorpii
	show_sound = event_energy_field
	
	is_triggered_only = yes 
	
	immediate = {
		random_system = {
			limit = { has_star_flag = theta_scorpii }
			save_event_target_as = theta_scorpii
			root = { set_visited = prev }
			random_system_planet = {
				limit = { has_planet_flag = allspark_location }
				save_event_target_as = allspark_location
			}
		}
		observer_event = { id = cybertron_shutdown.56 }
	}
	option = {
		name = "allspark.3.c"
		begin_event_chain = {
			event_chain = "allspark_reclamation_chain"
			target = ROOT 
		}
		event_target:allspark_location = {
			enable_special_project = {
				name = "ALLSPARK_PROJECT"
				location = event_target:allspark_location
				owner = ROOT 
			}
		}
	}
}

# Theta Scorpii System Discovered
observer_event = {
	id = cybertron_shutdown.56
	title = "precursor.100.name"
	desc = "observer.56.desc"
	picture = GFX_evt_star_chart
	show_sound = event_radio_chatter
	location = event_target:theta_scorpii

	is_triggered_only = yes

	option = {
		name = OK
	}
}

# Theta Scorpii Maelstrom
ship_event = {
	id = cybertron_shutdown.15
	title = "origin_cybertron_shutdown.15.name"
	desc = "origin_cybertron_shutdown.15.desc"
	picture = GFX_evt_allspark
	show_sound = event_finding_loot
	location = from
	
	is_triggered_only = yes
	
	trigger = {
		fromfrom = { has_planet_flag = allspark_location }
		owner = {
			is_ai = no 
			has_country_flag = theta_scorpii_system
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = allspark_location_found  
			set_global_flag = allspark_found
			if = {
				limit = { has_event_chain = "allspark_reclamation_chain" }
				end_event_chain = "allspark_reclamation_chain"
			}
		}
	}
	
	option = {
		name = "allspark.4.a"
		owner = {
			add_relic = r_allspark
			large_artifact_reward = yes 
			add_monthly_resource_mult = {
				resource = unity
				value = @tier3unityreward
				min = @tier3unitymin
				max = @tier3unitymax
			}
		}
	}
	option = {
		name = "allspark.4.b"
		custom_tooltip = allspark.4.tooltip 
		owner = {
			large_artifact_reward = yes
			add_resource = {
				energy = 20000
				energon = 5000
				rare_crystals = 1000
			}
		}
	}
}

#CYBERTRON CORRUPTED
country_event = {
	id = cybertron_shutdown.7
	title =  "origin_cybertron_shutdown.7.name"
	desc =  "origin_cybertron_shutdown.7.desc"
	picture = GFX_evt_cybertron_corrupted
	show_sound = event_screams
	location = from
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		
		add_monthly_resource_mult = {
			resource = unity
			value = @tier2unityreward
			min = @tier2unitymin
			max = @tier2unitymax
		}
		owner = {
			country_event = { id = cybertron_shutdown.8 days = 30 }
		}
	}
}

#DARK SPARK RELIC
country_event = {
	id = cybertron_shutdown.8
	title = "origin_cybertron_shutdown.8.name"
	desc = "origin_cybertron_shutdown.8.desc"
	picture = GFX_evt_vector_sigma_key_location
	show_sound = event_wind_ruins
	location = from
	
	is_triggered_only = yes 
	
	fire_only_once = yes 
	
	trigger = {
		owner = {
			is_ai = no
		}
	}
	
	immediate = {
	}
	
	option = {
		name = "dark_spark.1.a"
		trigger = {
			owner = {
				is_cybertronian = yes
			}
		}
		owner = {
			add_resource = {
				energy = -5000
			}
			country_event = { id = cybertron_shutdown.9 days = 360 } 
		}
	}
	option = {
		name = "dark_spark.1.b"
		trigger = {
			owner = {
				NOT = {
					is_cybertronian = yes 
				}
			}
		}
		owner = {
			add_resource = {
				energy = -5000
			}
			country_event = { id = cybertron_shutdown.9 days = 360 } 
		}
	}
	option = {
		name = "dark_spark.1.c"
		add_monthly_resource_mult = {
			resource = unity
			value = @tier2unityreward
			min = @tier2unitymin
			max = @tier2unitymax
		}
	}
}


country_event = {
	id = cybertron_shutdown.9
	title = "origin_cybertron_shutdown.9.name"
	desc = "origin_cybertron_shutdown.9.desc"
	picture = GFX_evt_vector_sigma_crypt
	show_sound = event_metal_fatigue
	
	is_triggered_only = yes
	
	option = {
		name = "dark_spark.2.a"
		small_artifact_reward = yes 
		owner = { country_event = { id = cybertron_shutdown.10 days = 120 } }
	}
}

country_event = {
	id = cybertron_shutdown.10
	title = "origin_cybertron_shutdown.10.name"
	desc = "origin_cybertron_shutdown.10.desc"
	picture = GFX_evt_dark_spark
	show_sound = event_screams 
	
	is_triggered_only = yes
	
	option = {
		name = "dark_spark.3.a"
		small_artifact_reward = yes 
		owner = { country_event = { id = cybertron_shutdown.11 days = 30 } }
	}
}

country_event = {
	id = cybertron_shutdown.11
	title = "origin_cybertron_shutdown.11.name"
	desc = "origin_cybertron_shutdown.11.desc"
	picture = GFX_evt_dark_spark
	show_sound = event_whispering
	
	is_triggered_only = yes
	
	option = {
		name = "dark_spark.4.a"
		large_artifact_reward = yes 
		owner = {
			add_relic = r_dark_spark
		}
	}
	option = {
		name = "dark_spark.4.b"
		custom_tooltip = dark_spark.4.tooltip
		large_artifact_reward = yes 
		add_monthly_resource_mult = {
			resource = unity
			value = @tier3unityreward
			min = @tier3unitymin
			max = @tier3unitymax
		}
		add_resource = {
			energy = 10000
			dark_energon = 2500
			rare_crystals = 1000
			sr_dark_matter = 500
		}
	}
}