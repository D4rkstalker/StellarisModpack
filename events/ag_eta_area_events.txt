namespace = ag_eta

# Spawn Eta Area(Hidden)
country_event = {
    id = ag_eta.1
    hide_window = yes
	is_triggered_only = yes
	
    immediate = {
		ag_spawn_ancient_system = { ag_system_to_spawn = "ag_ancient_eta_init" ag_hyperlane = no }
		ag_spawned_system_effect = yes
		create_point_of_interest = {
			id = ag_eta_area
			name = "ag_eta_area"
			desc = "ag_eta_area_desc"
			event_chain = ag_hidden_system_chain
			location = event_target:ag_ancient_eta_star
		}
		random_system = {
			limit = { has_star_flag = ag_ancient_eta_system }
			isolate_system = yes
		}
    }
	
	after = {
		every_country = {
			limit = { has_special_project = ag_located_eta_area }
			abort_special_project = {
				type = "ag_located_eta_area"
				location = capital_scope
			}
		}
	}
}

# on_entering_system_fleet, Notification for entering the Eta Area first time
fleet_event = {
	id = ag_eta.2
	title = "ag_eta.2.name"
	desc = "ag_eta.2.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ruined_system_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	
	trigger = {
		from = { has_star_flag = ag_ancient_eta_system }
		owner = {
			is_ai = no
			NOT = { has_country_flag = ag_eta_area_entered }
		}
		NOT = { has_global_flag = ag_eta_gateway_restored }
	}
	
    immediate = {
		owner = {
			set_country_flag = ag_eta_area_entered
			ag_refresh_ancient_system_poi = { ag_system_id = ag_eta_area }
		}
		solar_system = {
			random_system_megastructure = {
				limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_damaged }
				save_event_target_as = ag_target_megastructure
			}
		}
	}
	
	option = {
		name = "ag_eta.2.a"
		owner = {
			enable_special_project = {
				name = "ag_eta_gateway_damaged_project"
				location = event_target:ag_target_megastructure
				owner = root.owner
			}
		}
	}
	option = {
		name = "ag_eta.2.b"
		custom_tooltip = "ag_eta.2.b.tooltip"
		owner = { add_resource = { influence = @ag_end_event_influence_large } }
	}
}

# Special Project completed, set technology's flag
ship_event = {
	id = ag_eta.3
	title = "ag_eta.3.name"
	desc = {
		trigger = { NOT = { owner = { has_country_flag = encountered_first_gateway } } }
		text = "ag_eta.3.desc.a"
	}
	desc = {
		trigger = { owner = { has_country_flag = encountered_first_gateway } }
		text = "ag_eta.3.desc.b"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_debris_room }
	show_sound = event_default
	location = root
	is_triggered_only = yes
	immediate = { owner = {
		set_country_flag = ag_eta_3_fired
		if = {
			limit = { NOT = { has_country_flag = encountered_first_gateway } }
			set_country_flag = encountered_first_gateway
			add_seen_bypass_type = gateway
		}
	} }
	option = { name = "ag_eta.3.a" }
	option = { name = "ag_eta.3.b" }
}

# Notification for restore ancient gateway.
country_event = {
	id = ag_eta.4
	title = "ag_eta.4.name"
	desc = "ag_eta.4.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_debris_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	option = { name = "ag_eta.4.a" }
}

# Restored ancient gateway in eta area.
country_event = {
	id = ag_eta.11
	title = "ag_eta.11.name"
	desc = "ag_eta.11.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_eta_gateway_opened_blue_room }
	show_sound = event_dyson_sphere_build_complete
	location = root
	is_triggered_only = yes
	immediate = { event_target:global_event_country = {
		country_event = { id = ag_eta.12 days = @ag_eta_stage_1_intro_delay random = @ag_eta_stage_1_intro_random }
	} }
	option = { name = "ag_eta.11.a" }
}

# Ancient gateway turn in red.
country_event = {
	id = ag_eta.12
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		country_event = { id = ag_eta.14 days = @ag_eta_stage_1_intro_delay random = @ag_eta_stage_1_intro_random }
		event_target:ag_ancient_eta_star.solar_system = { random_system_megastructure = {
			limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_1 }
			ag_eta_upgrade_gateway_frame = { ag_target_level = 2 }
		} }
		every_playable_country = {
			limit = { intel_level = {
				system = event_target:ag_ancient_eta_star.solar_system
				level >= medium
			} }
			country_event = { id = ag_eta.13 }
		}
	}
}
# Notification.
country_event = {
	id = ag_eta.13
	title = "ag_eta.13.name"
	desc = "ag_eta.13.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	option = { name = "ag_eta.13.a" }
}

# Ancient gateway particle effect.
country_event = {
	id = ag_eta.14
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		country_event = { id = ag_eta.21 days = @ag_eta_stage_1_intro_delay random = @ag_eta_stage_1_intro_random }
		event_target:ag_ancient_eta_star.solar_system = {
			random_system_megastructure = {
				limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_2 }
				ag_eta_upgrade_gateway_frame = { ag_target_level = burst }
			}
			random_system_megastructure = {
				limit = { is_megastructure_type = ag_ancient_eta_gateway_galactic_gateway }
				remove_megastructure = this
			}
		}
		event_target:ag_ancient_eta_shielded_world = {
			ag_set_ancient_ringworld = {
				ag_color = red
				ag_type = habitable
				ag_surface_type = desert_01
				ag_shield_color = red
			}
		}
		every_playable_country = {
			limit = { intel_level = {
				system = event_target:ag_ancient_eta_star.solar_system
				level >= low
			} }
			country_event = { id = ag_eta.15 }
		}
	}
}
# Notification.
country_event = {
	id = ag_eta.15
	title = "ag_eta.15.name"
	desc = "ag_eta.15.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	option = { name = "ag_eta.15.a" }
}

# First ancient ship spawned.
country_event = {
	id = ag_eta.21
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		set_global_flag = ag_eta_titan_spawned
		set_global_flag = ag_eta_titan_stage_1
		random_system = {
			limit = {
				NOR = { is_star_class = sc_black_hole is_star_class = sc_ag_void }
				exists = space_owner
				space_owner = { is_fallen_empire = yes exists = capital_scope }
				is_same_value = space_owner.capital_scope.solar_system
			}
			save_event_target_as = ag_eta_titan_spawn_loc
		}
		if = {
			limit = { NOT = { exists = event_target:ag_eta_titan_spawn_loc } }
			random_system = {
				limit = {
					NOR = { is_star_class = sc_black_hole is_star_class = sc_ag_void }
					exists = space_owner
					space_owner = { is_fallen_empire = yes }
				}
				save_event_target_as = ag_eta_titan_spawn_loc
			}
			if = {
				limit = { NOT = { exists = event_target:ag_eta_titan_spawn_loc } }
				random_system = {
					limit = {
						NOR = { is_star_class = sc_black_hole is_star_class = sc_ag_void }
						exists = space_owner
						space_owner = { is_ai = yes exists = capital_scope }
						is_same_value = space_owner.capital_scope.solar_system
					}
					save_event_target_as = ag_eta_titan_spawn_loc
				}
				if = {
					limit = { NOT = { exists = event_target:ag_eta_titan_spawn_loc } }
					random_system = {
						limit = {
							NOR = { is_star_class = sc_black_hole is_star_class = sc_ag_void }
							exists = space_owner
							space_owner = { is_ai = yes }
						}
						save_event_target_as = ag_eta_titan_spawn_loc
					}
					if = {
						limit = { NOT = { exists = event_target:ag_eta_titan_spawn_loc } }
						random_system = {
							limit = { NOR = { is_star_class = sc_black_hole is_star_class = sc_ag_void exists = space_owner } }
							save_event_target_as = ag_eta_titan_spawn_loc
						}
						if = {
							limit = { NOT = { exists = event_target:ag_eta_titan_spawn_loc } }
							random_system = {
								limit = {
									NOR = { is_star_class = sc_black_hole is_star_class = sc_ag_void }
									exists = space_owner
									space_owner = { is_ai = no }
								}
								save_event_target_as = ag_eta_titan_spawn_loc
							}
							if = {
								limit = { NOT = { exists = event_target:ag_eta_titan_spawn_loc } }
								random_system = { save_event_target_as = ag_eta_titan_spawn_loc }
							}
						}
					}
				}
			}
		}
		event_target:ag_eta_titan_spawn_loc = { ag_eta_titan_stage_1_init = { ag_eta_titan_seq = 1 } }
		every_playable_country = { country_event = { id = ag_eta.22 } country_event = { id = ag_ancient.1056 days = 2 random = 3 } add_modifier = { modifier = "ag_eta_titan_anti_cloaking" days = -1 } }
		event_target:global_event_country = { ag_clear_ship_cloaking_effect = yes }
	}
}
# Notification for first titan spawned.
country_event = {
	id = ag_eta.22
	title = "ag_eta.22.name"
	desc = {
		trigger = {
			exists = event_target:ag_ancient_eta_star
			event_target:ag_ancient_eta_star = { exists = space_owner }
			is_same_value = event_target:ag_ancient_eta_star.space_owner
		}
		text = "ag_eta.22.a.desc"
	}
	desc = {
		trigger = { NAND = {
			exists = event_target:ag_ancient_eta_star
			event_target:ag_ancient_eta_star = { exists = space_owner }
			is_same_value = event_target:ag_ancient_eta_star.space_owner
		} }
		text = "ag_eta.22.b.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_black_hole_room }
	show_sound = event_activating_unknown_technology
	location = event_target:ag_eta_titan_spawn_loc.star
	is_triggered_only = yes
	option = {
		name = "ag_eta.22.a"
		begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
		add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
		create_point_of_interest = {
			id = ag_eta_titan_loc_1_poi
			name = ag_eta_titan_loc_1
			desc = ag_eta_titan_loc_1_desc
			event_chain = "ag_eta_titan_chain_stage_1"
			location = event_target:ag_eta_titan_hostile_fleet_1.solar_system
		}
		hidden_effect = { set_country_flag = ag_tracks_eta_titan_1 enable_special_project = { name = "ag_stop_tracking_eta_titan_1_1" owner = root } }
		ai_chance = { factor = 0 }
	}
	option = {
		name = "ag_eta.22.b"
		begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
		add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
		if  = { limit = { is_ai = no } enable_special_project = { name = "ag_tracking_eta_titan_1_1" owner = root } }
		ai_chance = { factor = 1000 }
	}
}

# Second ancient ship spawned.
country_event = {
	id = ag_eta.23
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		ag_get_eta_titan_spawn_location = yes
		event_target:ag_eta_titan_spawn_loc = { ag_eta_titan_stage_1_init = { ag_eta_titan_seq = 2 } }
		every_playable_country = { country_event = { id = ag_eta.24 } }
	}
}
# Notification for second titan spawned.
country_event = {
	id = ag_eta.24
	title = "ag_eta.24.name"
	desc = {
		trigger = {
			exists = event_target:ag_ancient_eta_star
			event_target:ag_ancient_eta_star = { exists = space_owner }
			is_same_value = event_target:ag_ancient_eta_star.space_owner
		}
		text = "ag_eta.24.a.desc"
	}
	desc = {
		trigger = { NAND = {
			exists = event_target:ag_ancient_eta_star
			event_target:ag_ancient_eta_star = { exists = space_owner }
			is_same_value = event_target:ag_ancient_eta_star.space_owner
		} }
		text = "ag_eta.24.b.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_black_hole_room }
	show_sound = event_activating_unknown_technology
	location = event_target:ag_eta_titan_spawn_loc.star
	is_triggered_only = yes
	option = {
		name = "ag_eta.24.a"
		if = {
			limit = { NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
		}
		add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
		create_point_of_interest = {
			id = ag_eta_titan_loc_2_poi
			name = ag_eta_titan_loc_2
			desc = ag_eta_titan_loc_2_desc
			event_chain = "ag_eta_titan_chain_stage_1"
			location = event_target:ag_eta_titan_hostile_fleet_2.solar_system
		}
		hidden_effect = { set_country_flag = ag_tracks_eta_titan_2 enable_special_project = { name = "ag_stop_tracking_eta_titan_2_1" owner = root } }
		ai_chance = { factor = 0 }
	}
	option = {
		name = "ag_eta.24.b"
		if = {
			limit = { NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
		}
		add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
		if  = { limit = { is_ai = no } enable_special_project = { name = "ag_tracking_eta_titan_2_1" owner = root } }
		ai_chance = { factor = 1000 }
	}
}

# Third ancient ship spawned.
country_event = {
	id = ag_eta.25
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		ag_get_eta_titan_spawn_location = yes
		event_target:ag_eta_titan_spawn_loc = { ag_eta_titan_stage_1_init = { ag_eta_titan_seq = 3 } }
		every_playable_country = { country_event = { id = ag_eta.26 } }
	}
}
# Notification for third titan spawned.
country_event = {
	id = ag_eta.26
	title = "ag_eta.26.name"
	desc = {
		trigger = {
			exists = event_target:ag_ancient_eta_star
			event_target:ag_ancient_eta_star = { exists = space_owner }
			is_same_value = event_target:ag_ancient_eta_star.space_owner
		}
		text = "ag_eta.26.a.desc"
	}
	desc = {
		trigger = { NAND = {
			exists = event_target:ag_ancient_eta_star
			event_target:ag_ancient_eta_star = { exists = space_owner }
			is_same_value = event_target:ag_ancient_eta_star.space_owner
		} }
		text = "ag_eta.26.b.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_black_hole_room }
	show_sound = event_activating_unknown_technology
	location = event_target:ag_eta_titan_spawn_loc.star
	is_triggered_only = yes
	option = {
		name = "ag_eta.26.a"
		if = {
			limit = { NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 2 }
		}
		add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
		create_point_of_interest = {
			id = ag_eta_titan_loc_3_poi
			name = ag_eta_titan_loc_3
			desc = ag_eta_titan_loc_3_desc
			event_chain = "ag_eta_titan_chain_stage_1"
			location = event_target:ag_eta_titan_hostile_fleet_3.solar_system
		}
		hidden_effect = { set_country_flag = ag_tracks_eta_titan_3 enable_special_project = { name = "ag_stop_tracking_eta_titan_3_1" owner = root } }
		ai_chance = { factor = 0 }
	}
	option = {
		name = "ag_eta.26.b"
		if = {
			limit = { NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 2 }
		}
		add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
		if  = { limit = { is_ai = no } enable_special_project = { name = "ag_tracking_eta_titan_3_1" owner = root } }
		ai_chance = { factor = 1000 }
	}
}

# Forth ancient ship spawned.
country_event = {
	id = ag_eta.27
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		ag_get_eta_titan_spawn_location = yes
		event_target:ag_eta_titan_spawn_loc = { ag_eta_titan_stage_1_init = { ag_eta_titan_seq = 4 } }
		every_playable_country = { country_event = { id = ag_eta.28 } }
	}
}
# Notification for forth titan spawned.
country_event = {
	id = ag_eta.28
	title = "ag_eta.28.name"
	desc = {
		trigger = {
			exists = event_target:ag_ancient_eta_star
			event_target:ag_ancient_eta_star = { exists = space_owner }
			is_same_value = event_target:ag_ancient_eta_star.space_owner
		}
		text = "ag_eta.28.a.desc"
	}
	desc = {
		trigger = { NAND = {
			exists = event_target:ag_ancient_eta_star
			event_target:ag_ancient_eta_star = { exists = space_owner }
			is_same_value = event_target:ag_ancient_eta_star.space_owner
		} }
		text = "ag_eta.28.b.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_black_hole_room }
	show_sound = event_activating_unknown_technology
	location = event_target:ag_eta_titan_spawn_loc.star
	is_triggered_only = yes
	option = {
		name = "ag_eta.28.a"
		if = {
			limit = { NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 3 }
		}
		add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
		create_point_of_interest = {
			id = ag_eta_titan_loc_4_poi
			name = ag_eta_titan_loc_4
			desc = ag_eta_titan_loc_4_desc
			event_chain = "ag_eta_titan_chain_stage_1"
			location = event_target:ag_eta_titan_hostile_fleet_4.solar_system
		}
		hidden_effect = { set_country_flag = ag_tracks_eta_titan_4 enable_special_project = { name = "ag_stop_tracking_eta_titan_4_1" owner = root } }
		ai_chance = { factor = 0 }
	}
	option = {
		name = "ag_eta.28.b"
		if = {
			limit = { NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 3 }
		}
		add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
		if  = { limit = { is_ai = no } enable_special_project = { name = "ag_tracking_eta_titan_4_1" owner = root } }
		ai_chance = { factor = 1000 }
	}
}

# Ancient ship action, find target planet.
fleet_event = {
	id = ag_eta.31
	hide_window = yes
	is_triggered_only = yes
	trigger = { exists = this }
	immediate = {
		clear_orders = yes
		clear_fleet_actions = this
		if = { limit = { NOT = { has_global_flag = ag_eta_titan_stage_2 } } ag_eta_titan_stage_1_action = yes }
		else_if = { limit = { NOT = { has_global_flag = ag_eta_titan_event_ended } } ag_eta_titan_stage_2_action = yes }
		else_if = { limit = { always = yes } ag_eta_titan_event_ended_action = yes }
	}
}

# on_fleet_auto_move_arrival, Ancient ship action, found planet to orbit.
country_event = {
	id = ag_eta.32
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		OR = { is_country_type = ag_ancient_eta_guardian_passive is_country_type = ag_ancient_eta_guardian }
		from = { has_fleet_flag = ag_eta_titan_hostile_fleet NOT = { has_fleet_flag = ag_eta_32_mutex } }
		fromfrom = { NOT = { has_planet_flag = ag_eta_ship_left_planet } }
	}
	immediate = {
		from = { set_timed_fleet_flag = { flag = ag_eta_32_mutex days = 2 } clear_orders = yes clear_fleet_actions = this }
		if = {
			limit = { NOT = { has_global_flag = ag_eta_titan_stage_2 } }
			if = {
				limit = { fromfrom = { OR = {
					NOR = { exists = owner num_pops > 0 }
					has_modifier = "ag_eta_titan_in_orbit"
				} } }
				from = { fleet_event = { id = ag_eta.31 days = 5 random = 5 } }
			}
			else = {
				fromfrom = {
					add_modifier = { modifier = "ag_eta_titan_in_orbit" days = -1 }
					every_owned_pop = {
						limit = { OR = {
							has_ethic = ethic_fanatic_xenophobe
							has_ethic = ethic_xenophobe
						} }
						add_modifier = { modifier = "ag_eta_titan_in_orbit_phobe" days = -1 }
					}
					planet_event = { id = ag_eta.33 days = @ag_eta_titan_scan_planet_days random = @ag_eta_titan_scan_planet_random }
					save_event_target_as = ag_target_planet
					owner = {
						if = {
							limit = { NOT = { has_country_flag = ag_eta_35_fired } }
							set_country_flag = ag_eta_35_fired
							country_event = { id = ag_eta.35 days = 1 random = 2 }
						}
						else = { create_message = {
							type = message_ag_eta_titan_enter_orbit
							localization = message_ag_eta_titan_enter_orbit_desc
							days = 20
							target = prev
							variable = {
								type = name
								localization = "ag_target_planet"
								scope = prev
							}
						} }
					}
				}
			}
		}
		else = {
			if = {
				limit = { NOT = { has_global_flag = ag_eta_titan_event_ended } }
				if = {
					limit = {
						from = { NOT = { has_fleet_flag = ag_eta_titan_building_starbase } }
						fromfrom = {
							is_star = yes
							NOT = { any_fleet_in_orbit = {
								exists = owner owner = { is_same_value = root }
								NOT = { is_same_value = root.from }
							} }
						}
					}
					if = {
						limit = { event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value < 0 } } }
						from = { set_timed_fleet_flag = { flag = ag_eta_titan_building_starbase days = @ag_eta_titan_starbase_construction_days_easy } }
						fromfrom.solar_system = { system_event = { id = ag_eta.37 days = @ag_eta_titan_starbase_construction_days_easy scopes = { from = root.from } } }
					}
					else_if = {
						limit = { event_target:global_event_country = {
							check_variable = { which = ag_scaled_difficulty value >= 0 }
							check_variable = { which = ag_scaled_difficulty value < 1 }
						} }
						from = { set_timed_fleet_flag = { flag = ag_eta_titan_building_starbase days = @ag_eta_titan_starbase_construction_days_normal } }
						fromfrom.solar_system = { system_event = { id = ag_eta.37 days = @ag_eta_titan_starbase_construction_days_normal scopes = { from = root.from } } }
					}
					else_if = {
						limit = { event_target:global_event_country = {
							check_variable = { which = ag_scaled_difficulty value >= 1 }
							check_variable = { which = ag_scaled_difficulty value <= 2 }
						} }
						from = { set_timed_fleet_flag = { flag = ag_eta_titan_building_starbase days = @ag_eta_titan_starbase_construction_days_hard_1 } }
						fromfrom.solar_system = { system_event = { id = ag_eta.37 days = @ag_eta_titan_starbase_construction_days_hard_1 scopes = { from = root.from } } }
					}
					else_if = {
						limit = { event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } } }
						from = { set_timed_fleet_flag = { flag = ag_eta_titan_building_starbase days = @ag_eta_titan_starbase_construction_days_hard_2 } }
						fromfrom.solar_system = { system_event = { id = ag_eta.37 days = @ag_eta_titan_starbase_construction_days_hard_2 scopes = { from = root.from } } }
					}
				}
				else_if = {
					limit = { NOT = { fromfrom = {
						is_star = no exists = owner
						OR = { is_colony = yes is_under_colonization = yes }
						NOT = { any_fleet_in_orbit = {
							exists = owner
							owner = { is_same_value = root }
							NOT = { is_same_value = root.from }
						} }
					} } }
					from = { fleet_event = { id = ag_eta.31 days = 5 random = 5 } }
				}
			}
			else = {
				from = {
					fleet_event = { id = ag_eta.31 days = 5 random = 5 }
					solar_system = {
						if = { limit = { has_star_flag = ag_eta_titan_recently_visited } remove_star_flag = ag_eta_titan_recently_visited }
						set_timed_star_flag = { flag = ag_eta_titan_recently_visited days = 360 }
					}
				}
			}
		}
	}
}

# Ancient ship's scanned planet
planet_event = {
	id = ag_eta.33
	hide_window = yes
	is_triggered_only = yes
	trigger = { has_global_flag = ag_eta_titan_stage_1 NOT = { has_global_flag = ag_eta_titan_stage_2 } }
	immediate = {
		set_timed_planet_flag = { flag = ag_eta_ship_left_planet days = 2 }
		if = {
			limit = { has_modifier = "ag_eta_titan_in_orbit" } remove_modifier = "ag_eta_titan_in_orbit"
			every_owned_pop = { limit = { has_modifier = "ag_eta_titan_in_orbit_phobe" } remove_modifier = "ag_eta_titan_in_orbit_phobe" }
		}
		if = {
			limit = { solar_system = { any_fleet_in_system = {
				has_fleet_flag = ag_eta_titan_hostile_fleet
				is_in_combat = no
				is_fleet_idle = yes
				exists = owner
				owner = { is_country_type = ag_ancient_eta_guardian_passive }
				exists = orbit
				orbit = { is_same_value = root }
			} } }
			set_planet_flag = ag_eta_titan_scanned_planet
			random_list = {
				5 = { planet_event = { id = ag_eta.41 days = 2 random = 2 } }
				5 = { planet_event = { id = ag_eta.42 days = 2 random = 2 } }
				5 = { planet_event = { id = ag_eta.43 days = 2 random = 2 } }
				160 = {
					modifier = { add = 10 num_pops < 4 }
					if = {
						limit = { owner = { NOT = { has_country_flag = ag_eta_44_fired } } }
						owner = { set_country_flag = ag_eta_44_fired }
						planet_event = { id = ag_eta.44 days = 2 random = 2 }
					}
					else = { owner = { create_message = {
						type = message_ag_eta_titan_exit_orbit
						localization = message_ag_eta_titan_exit_orbit_desc
						days = 20
						target = root
						variable = {
							type = name
							localization = "ag_target_planet"
							scope = root
						}
					} } }
				}
				10 = { planet_event = { id = ag_eta.45 days = 2 random = 2 } }
				10 = { planet_event = { id = ag_eta.46 days = 2 random = 2 } }
				10 = { planet_event = { id = ag_eta.47 days = 2 random = 2 } }
				10 = { modifier = { factor = 0 num_pops < 4 } planet_event = { id = ag_eta.48 days = 2 random = 2 } }
				10 = { planet_event = { id = ag_eta.49 days = 2 random = 2 } }
			}
			reroll_random = yes
			random_list = {
				25 = { }
				75 = {
					if = { limit = { NOT = { has_global_flag = ag_eta_titan_2_spawned } } event_target:global_event_country = { country_event = { id = ag_eta.23 days = 360 random = 360 } } }
					else_if = { limit = { NOT = { has_global_flag = ag_eta_titan_3_spawned } } event_target:global_event_country = { country_event = { id = ag_eta.25 days = 360 random = 360 } } }
					else_if = { limit = { NOT = { has_global_flag = ag_eta_titan_4_spawned } } event_target:global_event_country = { country_event = { id = ag_eta.27 days = 360 random = 360 } } }
					else_if = { limit = { always = yes } event_target:global_event_country = { country_event = { id = ag_eta.61 days = 480 random = 480 } } }
				}
			}
			reroll_random = yes
			solar_system = { every_fleet_in_system = {
				limit = {
					has_fleet_flag = ag_eta_titan_hostile_fleet
					is_in_combat = no
					is_fleet_idle = yes
					exists = owner
					owner = { is_country_type = ag_ancient_eta_guardian_passive }
					exists = orbit
					orbit = { is_same_value = root }
				}
				clear_orders = yes
				clear_fleet_actions = this
				fleet_event = { id = ag_eta.31 days = 2 random = 2 }
			} }
		}
	}
}

# on_entering_system_fleet, Ancient ship system effect
fleet_event = {
	id = ag_eta.34
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = ag_eta_titan_spawned
		NOT = { has_global_flag = ag_eta_titan_destroyed }
		has_fleet_flag = ag_eta_titan_hostile_fleet
		exists = owner
		owner = { has_country_flag = ag_ancient_eta_guardian }
	}
	immediate = {
		every_system = {
			limit = {
				has_star_flag = ag_eta_titan_in_system
				NOR = {
					AND = {
						exists = event_target:ag_eta_titan_hostile_fleet_1
						event_target:ag_eta_titan_hostile_fleet_1 = { exists = solar_system }
						is_same_value = event_target:ag_eta_titan_hostile_fleet_1.solar_system
					}
					AND = {
						exists = event_target:ag_eta_titan_hostile_fleet_2
						event_target:ag_eta_titan_hostile_fleet_2 = { exists = solar_system }
						is_same_value = event_target:ag_eta_titan_hostile_fleet_2.solar_system
					}
					AND = {
						exists = event_target:ag_eta_titan_hostile_fleet_3
						event_target:ag_eta_titan_hostile_fleet_3 = { exists = solar_system }
						is_same_value = event_target:ag_eta_titan_hostile_fleet_3.solar_system
					}
					AND = {
						exists = event_target:ag_eta_titan_hostile_fleet_4
						event_target:ag_eta_titan_hostile_fleet_4 = { exists = solar_system }
						is_same_value = event_target:ag_eta_titan_hostile_fleet_4.solar_system
					}
				}
			}
			remove_star_flag = ag_eta_titan_in_system
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_eta_system_effect_1 }
				destroy_ambient_object = this
			}
		}
		from = { if = {
			limit = { NOT = { has_star_flag = ag_eta_titan_in_system } }
			set_star_flag = ag_eta_titan_in_system
			if = {
				limit = { ag_eta_titan_event_active = yes NAND = { exists = space_owner space_owner = { is_same_value = prevprev.owner } } }
				random_system_planet = {
					limit = { is_primary_star = yes }
					create_ambient_object = { type = "ag_eta_system_effect_1_object" location = this }
					last_created_ambient_object = {
						set_ambient_object_flag = ag_eta_system_effect_1
						set_location = { target = prev distance = 0 angle = random }
					}
				}
			}
		} }
		ag_refresh_eta_titans_tracker = yes
	}
}
country_event = {
	id = ag_eta.35
	title = "ag_eta.35.name"
	desc = "ag_eta.35.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	option = { name = "ag_eta.35.a" }
	option = { name = "ag_eta.35.b" }
}

# on_monthly_pulse, Failsafe for ancient ship stoped for unknown reasons.
event = {
	id = ag_eta.36
	hide_window = yes
	is_triggered_only = yes
	trigger = { ag_eta_titan_event_active = yes }
	immediate = {
		if = {
			limit = { has_global_flag = ag_eta_titan_1_spawned NOT = { exists = event_target:ag_eta_titan_hostile_fleet_1 } }
			ag_get_eta_titan_spawn_location = { ag_index = 1 }
			event_target:ag_eta_titan_spawn_loc_1.star = { ag_eta_titan_hostile_spawn = { ag_eta_titan_seq = 1 } }
			event_target:ag_eta_titan_hostile_fleet_1 = { ag_refresh_eta_titans_tracker = yes }
		}
		else_if = {
			limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 event_target:ag_eta_titan_hostile_fleet_1 = { ag_eta_titan_is_idle = yes } }
			event_target:ag_eta_titan_hostile_fleet_1 = { fleet_event = { id = ag_eta.31 days = 5 random = 5 } }
		}
		if = {
			limit = { has_global_flag = ag_eta_titan_2_spawned NOT = { exists = event_target:ag_eta_titan_hostile_fleet_2 } }
			ag_get_eta_titan_spawn_location = { ag_index = 2 }
			event_target:ag_eta_titan_spawn_loc_2.star = { ag_eta_titan_hostile_spawn = { ag_eta_titan_seq = 2 } }
			event_target:ag_eta_titan_hostile_fleet_2 = { ag_refresh_eta_titans_tracker = yes }
		}
		else_if = {
			limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 event_target:ag_eta_titan_hostile_fleet_2 = { ag_eta_titan_is_idle = yes } }
			event_target:ag_eta_titan_hostile_fleet_2 = { fleet_event = { id = ag_eta.31 days = 5 random = 5 } }
		}
		if = {
			limit = { has_global_flag = ag_eta_titan_3_spawned NOT = { exists = event_target:ag_eta_titan_hostile_fleet_3 } }
			ag_get_eta_titan_spawn_location = { ag_index = 3 }
			event_target:ag_eta_titan_spawn_loc_3.star = { ag_eta_titan_hostile_spawn = { ag_eta_titan_seq = 3 } }
			event_target:ag_eta_titan_hostile_fleet_3 = { ag_refresh_eta_titans_tracker = yes }
		}
		else_if = {
			limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 event_target:ag_eta_titan_hostile_fleet_3 = { ag_eta_titan_is_idle = yes } }
			event_target:ag_eta_titan_hostile_fleet_3 = { fleet_event = { id = ag_eta.31 days = 5 random = 5 } }
		}
		if = {
			limit = { has_global_flag = ag_eta_titan_4_spawned NOT = { exists = event_target:ag_eta_titan_hostile_fleet_4 } }
			ag_get_eta_titan_spawn_location = { ag_index = 4 }
			event_target:ag_eta_titan_spawn_loc_4.star = { ag_eta_titan_hostile_spawn = { ag_eta_titan_seq = 4 } }
			event_target:ag_eta_titan_hostile_fleet_4 = { ag_refresh_eta_titans_tracker = yes }
		}
		else_if = {
			limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 event_target:ag_eta_titan_hostile_fleet_4 = { ag_eta_titan_is_idle = yes } }
			event_target:ag_eta_titan_hostile_fleet_4 = { fleet_event = { id = ag_eta.31 days = 5 random = 5 } }
		}
		if = {
			limit = { has_global_flag = ag_eta_titan_stage_1 NOT = { has_global_flag = ag_eta_titan_stage_2 } }
			every_country = {
				limit = {
					NOR = {
						is_same_value = event_target:ag_ancient_eta_guardian_1
						is_same_value = event_target:ag_ancient_eta_guardian_2
						is_same_value = event_target:ag_ancient_eta_guardian_3
						is_same_value = event_target:ag_ancient_eta_guardian_4
					}
					OR = {
						is_hostile = event_target:ag_ancient_eta_guardian_1
						is_hostile = event_target:ag_ancient_eta_guardian_2
						is_hostile = event_target:ag_ancient_eta_guardian_3
						is_hostile = event_target:ag_ancient_eta_guardian_4
					}
				}
				if = {
					limit = {
						is_hostile = event_target:ag_ancient_eta_guardian_1
						event_target:ag_eta_titan_hostile_fleet_1 = { is_in_combat = no }
					}
					set_faction_hostility = {
						target = event_target:ag_ancient_eta_guardian_1
						set_hostile = no
						set_neutral = yes
						set_friendly = no
					}
					if = {
						limit = { NOT = { has_country_flag = ag_eta_38_fired } }
						set_country_flag = ag_eta_38_fired
						country_event = { id = ag_eta.38 scopes = { from = event_target:ag_eta_titan_hostile_fleet_1 } }
					}
				}
				if = {
					limit = {
						is_hostile = event_target:ag_ancient_eta_guardian_2
						event_target:ag_eta_titan_hostile_fleet_2 = { is_in_combat = no }
					}
					set_faction_hostility = {
						target = event_target:ag_ancient_eta_guardian_2
						set_hostile = no
						set_neutral = yes
						set_friendly = no
					}
					if = {
						limit = { NOT = { has_country_flag = ag_eta_38_fired } }
						set_country_flag = ag_eta_38_fired
						country_event = { id = ag_eta.38 scopes = { from = event_target:ag_eta_titan_hostile_fleet_2 } }
					}
				}
				if = {
					limit = {
						is_hostile = event_target:ag_ancient_eta_guardian_3
						event_target:ag_eta_titan_hostile_fleet_3 = { is_in_combat = no }
					}
					set_faction_hostility = {
						target = event_target:ag_ancient_eta_guardian_3
						set_hostile = no
						set_neutral = yes
						set_friendly = no
					}
					if = {
						limit = { NOT = { has_country_flag = ag_eta_38_fired } }
						set_country_flag = ag_eta_38_fired
						country_event = { id = ag_eta.38 scopes = { from = event_target:ag_eta_titan_hostile_fleet_3 } }
					}
				}
				if = {
					limit = {
						is_hostile = event_target:ag_ancient_eta_guardian_4
						event_target:ag_eta_titan_hostile_fleet_4 = { is_in_combat = no }
					}
					set_faction_hostility = {
						target = event_target:ag_ancient_eta_guardian_4
						set_hostile = no
						set_neutral = yes
						set_friendly = no
					}
					if = {
						limit = { NOT = { has_country_flag = ag_eta_38_fired } }
						set_country_flag = ag_eta_38_fired
						country_event = { id = ag_eta.38 scopes = { from = event_target:ag_eta_titan_hostile_fleet_4 } }
					}
				}
				remove_country_flag = ag_eta_38_fired
			}
		}
	}
}

# Construct a starbase
system_event = {
	id = ag_eta.37
	hide_window = yes
	is_triggered_only = yes
	trigger = { ag_eta_titan_event_active = yes from = { exists = solar_system solar_system = { is_same_value = root } } }
	immediate = {
		if = { limit = { from = { is_in_combat = no } } ag_create_eta_titan_starbase = yes }
		else = {
			system_event = { id = ag_eta.37 days = 30 scopes = { from = from } }
			from = {
				if = { limit = { has_fleet_flag = ag_eta_titan_building_starbase } remove_fleet_flag = ag_eta_titan_building_starbase }
				set_timed_fleet_flag = { flag = ag_eta_titan_building_starbase days = 30 }
			}
		}
	}
}

# Notification for ancient ship turn into neutral
country_event = {
	id = ag_eta.38
	title = "ag_eta.38.name"
	desc = "ag_eta.38.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_yellow_alert
	location = from
	is_triggered_only = yes
	option = { name = "ag_eta.38.a" }
}

# Ancient ship's effects on planet
# Positive Effects
planet_event = {
	id = ag_eta.41
	title = "ag_eta.41.name"
	desc = "ag_eta.41.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_colony_settlement_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes
	immediate = {
		random_list = {
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_1" days = 90 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_1" days = 120 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_1" days = 180 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_1" days = 270 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_1" days = 360 } }
		}
		reroll_random = yes
	}
	option = { name = "ag_eta.41.a" }
}
planet_event = {
	id = ag_eta.42
	title = "ag_eta.42.name"
	desc = "ag_eta.42.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_colony_settlement_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes
	immediate = {
		random_list = {
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_2" days = 90 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_2" days = 120 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_2" days = 180 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_2" days = 270 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_2" days = 360 } }
		}
		reroll_random = yes
	}
	option = { name = "ag_eta.42.a" }
}
planet_event = {
	id = ag_eta.43
	title = "ag_eta.43.name"
	desc = "ag_eta.43.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_colony_settlement_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes
	immediate = {
		random_list = {
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_3" days = 90 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_3" days = 120 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_3" days = 180 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_3" days = 270 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_3" days = 360 } }
		}
		reroll_random = yes
	}
	option = { name = "ag_eta.43.a" }
}
# Nothing Happened
planet_event = {
	id = ag_eta.44
	title = "ag_eta.44.name"
	desc = "ag_eta.44.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes
	option = { name = "ag_eta.44.a" }
	option = { name = "ag_eta.44.b" }
}
# Negative Effects
planet_event = {
	id = ag_eta.45
	title = "ag_eta.45.name"
	desc = "ag_eta.45.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_colony_settlement_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	immediate = {
		random_list = {
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_4" days = 180 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_4" days = 270 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_4" days = 360 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_4" days = 450 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_4" days = 540 } }
		}
		reroll_random = yes
	}
	option = { name = "ag_eta.45.a" }
}
planet_event = {
	id = ag_eta.46
	title = "ag_eta.46.name"
	desc = "ag_eta.46.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_colony_settlement_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	immediate = {
		random_list = {
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_5" days = 180 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_5" days = 270 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_5" days = 360 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_5" days = 450 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_5" days = 540 } }
		}
		reroll_random = yes
	}
	option = { name = "ag_eta.46.a" }
}
planet_event = {
	id = ag_eta.47
	title = "ag_eta.47.name"
	desc = "ag_eta.47.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_colony_settlement_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	immediate = {
		random_list = {
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_6" days = 180 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_6" days = 270 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_6" days = 360 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_6" days = 450 } }
			10 = { add_modifier = { modifier = "ag_eta_titan_after_effect_6" days = 540 } }
		}
		reroll_random = yes
	}
	option = { name = "ag_eta.47.a" }
}
planet_event = {
	id = ag_eta.48
	title = "ag_eta.48.name"
	desc = "ag_eta.48.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unspeakable_horror_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	immediate = {
		add_planet_devastation = 15
		add_deposit = ag_dimensional_rupture
		random_list = {
			10 = { while = { count = 1 random_owned_pop = { kill_pop = yes } } }
			10 = { while = { count = 2 random_owned_pop = { kill_pop = yes } } }
			10 = { while = { count = 3 random_owned_pop = { kill_pop = yes } } }
		}
		reroll_random = yes
		planet_event = { id = ag_eta.50 days = 180 random = 180 }
	}
	option = { name = "ag_eta.48.a" }
}
planet_event = {
	id = ag_eta.49
	title = "ag_eta.49.name"
	desc = "ag_eta.49.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unspeakable_horror_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	immediate = { every_owned_pop = {
		limit = { is_sapient = yes }
		if = {
			limit = { is_robot_pop = no }
			random_list = {
				390 = { }
				10 = { modifier = { factor = 0 has_trait = trait_nonadaptive } modify_species = { species = this add_trait = trait_nonadaptive } }
				10 = { modifier = { factor = 0 has_trait = trait_slow_breeders } modify_species = { species = this add_trait = trait_slow_breeders } }
				10 = { modifier = { factor = 0 has_trait = trait_slow_learners } modify_species = { species = this add_trait = trait_slow_learners } }
				10 = { modifier = { factor = 0 has_trait = trait_quarrelsome } modify_species = { species = this add_trait = trait_quarrelsome } }
				10 = { modifier = { factor = 0 has_trait = trait_unruly } modify_species = { species = this add_trait = trait_unruly } }
				10 = { modifier = { factor = 0 has_trait = trait_weak } modify_species = { species = this add_trait = trait_weak } }
				10 = { modifier = { factor = 0 has_trait = trait_sedentary } modify_species = { species = this add_trait = trait_sedentary } }
				10 = { modifier = { factor = 0 has_trait = trait_solitary } modify_species = { species = this add_trait = trait_solitary } }
				10 = { modifier = { factor = 0 has_trait = trait_repugnant } modify_species = { species = this add_trait = trait_repugnant } }
				10 = { modifier = { factor = 0 has_trait = trait_deviants } modify_species = { species = this add_trait = trait_deviants } }
				10 = { modifier = { factor = 0 has_trait = trait_decadent } modify_species = { species = this add_trait = trait_decadent } }
				10 = { modifier = { factor = 0 has_trait = trait_wasteful } modify_species = { species = this add_trait = trait_wasteful } }
				10 = {
					modifier = { factor = 0 OR = { has_trait = trait_fleeting has_trait = trait_fleeting_lithoid } }
					if = { limit = { is_lithoid = no } modify_species = { species = this add_trait = trait_fleeting } }
					else = { modify_species = { species = this add_trait = trait_fleeting_lithoid } }
				}
			}
			reroll_random = yes
		}
		else = {
			random_list = {
				210 = { }
				10 = { modifier = { factor = 0 has_trait = trait_robot_bulky } modify_species = { species = this add_trait = trait_robot_bulky } }
				10 = { modifier = { factor = 0 has_trait = trait_robot_uncanny } modify_species = { species = this add_trait = trait_robot_uncanny } }
				10 = { modifier = { factor = 0 has_trait = trait_robot_high_maintenance } modify_species = { species = this add_trait = trait_robot_high_maintenance } }
				10 = { modifier = { factor = 0 has_trait = trait_robot_repurposed_hardware } modify_species = { species = this add_trait = trait_robot_repurposed_hardware } }
				10 = { modifier = { factor = 0 has_trait = trait_robot_custom_made } modify_species = { species = this add_trait = trait_robot_custom_made } }
				10 = { modifier = { factor = 0 has_trait = trait_robot_luxurious } modify_species = { species = this add_trait = trait_robot_luxurious } }
				10 = { modifier = { factor = 0 has_trait = trait_robot_high_bandwidth } modify_species = { species = this add_trait = trait_robot_high_bandwidth } }
			}
			reroll_random = yes
		}
	} }
	option = { name = "ag_eta.49.a" }
}
planet_event = {
	id = ag_eta.50
	title = "ag_eta.50.name"
	desc = "ag_eta.50.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_colony_settlement_room }
	show_sound = event_sensor_ping
	location = root
	is_triggered_only = yes
	trigger = { exists = this }
	immediate = { if = {
		limit = { has_deposit = ag_dimensional_rupture }
		random_deposit = { limit = { is_deposit_type = ag_dimensional_rupture } remove_deposit = this }
	} }
	option = { name = "ag_eta.50.a" }
}

# on_entering_battle, Attack ancient ship, ancient ship's ability.
country_event = {
	id = ag_eta.51
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_country_flag = ag_ancient_eta_guardian
		fromfrom = { has_fleet_flag = ag_eta_titan_hostile_fleet }
	}
	immediate = {
		if = {
			limit = { has_global_flag = ag_eta_titan_stage_1 NOT = { has_global_flag = ag_eta_titan_stage_2 } }
			fromfrom.solar_system = { every_system_planet = {
				limit = { has_modifier = "ag_eta_titan_in_orbit" }
				remove_modifier = "ag_eta_titan_in_orbit"
				every_owned_pop = { limit = { has_modifier = "ag_eta_titan_in_orbit_phobe" } remove_modifier = "ag_eta_titan_in_orbit_phobe" }
			} }
		}
		if = {
			limit = { fromfrom = { check_variable = { which = ag_num_spawned_hallucinations value < ag_max_spawned_hallucinations } } }
			if = {
				limit = { check_variable_arithmetic = {
					which = fromfrom.ag_max_spawned_hallucinations
					subtract = fromfrom.ag_num_spawned_hallucinations
					value = 1
				} }
				fromfrom = {
					change_variable = { which = ag_num_spawned_hallucinations value = 1 }
					ag_eta_titan_phantom_hostile_spawn = { ag_target = prev ag_distance = 0 ag_angle = 0 }
				}
			}
			else_if = {
				limit = { check_variable_arithmetic = {
					which = fromfrom.ag_max_spawned_hallucinations
					subtract = fromfrom.ag_num_spawned_hallucinations
					value = 2
				} }
				fromfrom = {
					change_variable = { which = ag_num_spawned_hallucinations value = 2 }
					ag_eta_titan_phantom_hostile_spawn = { ag_target = prev ag_distance = 0 ag_angle = 0 }
				}
				fromfromfrom = { ag_eta_titan_phantom_hostile_spawn = { ag_target = prev ag_distance = 80 ag_angle = random } }
			}
			else_if = {
				limit = { check_variable_arithmetic = {
					which = fromfrom.ag_max_spawned_hallucinations
					subtract = fromfrom.ag_num_spawned_hallucinations
					value = 3
				} }
				fromfrom = {
					change_variable = { which = ag_num_spawned_hallucinations value = 3 }
					ag_eta_titan_phantom_hostile_spawn = { ag_target = prev ag_distance = 0 ag_angle = 0 }
				}
				fromfromfrom = {
					ag_eta_titan_phantom_hostile_spawn = { ag_target = prev ag_distance = 80 ag_angle = 90 }
					ag_eta_titan_phantom_hostile_spawn = { ag_target = prev ag_distance = 80 ag_angle = 270 }
				}
			}
		}
	}
}

# ag_on_disabled_event, Ancient ship disabled, ancient ship ability's effect.
ship_event = {
	id = ag_eta.52
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ship_size = ag_eta_titan_hostile }

	immediate = {
		change_variable = { which = ag_disabled_times value = 1 }
		if = {
			limit = { fleet = { check_variable = { which = ag_num_spawned_hallucinations value > 0 } } }
			repair_ship = yes set_disabled = no
			random_list = {
				100 = {
					modifier = { factor = 0 OR = { NOT = { is_variable_set = ag_eta_titan_invincible_revive_times } check_variable = { which = ag_eta_titan_invincible_revive_times value < 1 } } }
					modifier = { add = -10 is_variable_set = ag_eta_titan_invincible_revive_times check_variable = { which = ag_eta_titan_invincible_revive_times value < 2 } }
					modifier = { add = -20 is_variable_set = ag_eta_titan_invincible_revive_times check_variable = { which = ag_eta_titan_invincible_revive_times value < 3 } }
					modifier = { add = -50 is_variable_set = ag_eta_titan_invincible_revive_times check_variable = { which = ag_eta_titan_invincible_revive_times value < 5 } }
					clear_variable = ag_eta_titan_invincible_revive_times
					owner = { random_controlled_fleet = {
						limit = {
							exists = this
							NOT = { has_fleet_flag = ag_eta_titan_phantom_hostile_fleet_destroyed }
							has_fleet_flag = ag_eta_titan_phantom_hostile_fleet
							exists = solar_system
							solar_system = { is_same_value = root.fleet.solar_system }
						}
						set_fleet_flag = ag_eta_titan_phantom_hostile_fleet_destroyed
						# root.fleet = {
						# 	subtract_variable = { which = ag_num_spawned_hallucinations value = 1 }
						# 	if = {
						# 		limit = {
						# 			check_variable = { which = ag_num_spawned_hallucinations value = 0 }
						# 			event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
						# 		}
						# 		root = { random_list = { 33 = { } 33 = { ag_set_ship_invincible = { ag_days = 1 } } 33 = { ag_set_ship_invincible = { ag_days = 2 } } } }
						# 	}
						# }
						destroy_fleet = { target = this kill_leader = yes destroy_template = yes }
					} }
					fleet = {
						subtract_variable = { which = ag_num_spawned_hallucinations value = 1 }
						if = {
							limit = {
								check_variable = { which = ag_num_spawned_hallucinations value = 0 }
								event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
							}
							root = { random_list = { 33 = { } 33 = { ag_set_ship_invincible = { ag_days = 1 } } 33 = { ag_set_ship_invincible = { ag_days = 2 } } } }
						}
					}
				}
				50 = {
					modifier = { add = 10 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value >= 1 } } }
					modifier = { add = 20 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } } }
					modifier = { add = 20 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 4 } } }
					modifier = { factor = 0 check_variable = { which = ag_eta_titan_invincible_revive_times value > 4 } }
					change_variable = { which = ag_eta_titan_invincible_revive_times value = 1 }
				}
			}
			reroll_random = yes
		}
		else_if = {
			limit = { NOT = { has_global_flag = ag_eta_titan_stage_2 } }
			repair_ship = yes set_disabled = no
			random_list = {
				25 = {
					modifier = { factor = 0 check_variable = { which = ag_eta_titan_invincible_revive_times value > 4 } }
					change_variable = { which = ag_eta_titan_invincible_revive_times value = 1 }
					random_list = { 50 = { } 50 = { add_modifier = { modifier = "ag_eta_titan_revive_buff" days = 15 } } }
				}
				75 = {
					modifier = { factor = 0 OR = { NOT = { is_variable_set = ag_eta_titan_invincible_revive_times } check_variable = { which = ag_eta_titan_invincible_revive_times value < 1 } } }
					clear_variable = ag_eta_titan_invincible_revive_times
					if = { limit = { NOT = { has_global_flag = ag_eta_titan_2_spawned } } event_target:global_event_country = { country_event = { id = ag_eta.23 days = 15 random = 15 } } }
					else_if = { limit = { NOT = { has_global_flag = ag_eta_titan_3_spawned } } event_target:global_event_country = { country_event = { id = ag_eta.25 days = 15 random = 15 } } }
					else_if = { limit = { NOT = { has_global_flag = ag_eta_titan_4_spawned } } event_target:global_event_country = { country_event = { id = ag_eta.27 days = 15 random = 15 } } }
					else_if = { limit = { always = yes } event_target:global_event_country = { country_event = { id = ag_eta.61 days = 30 random = 30 } } }
					ag_get_eta_titan_jumpdrive_target = yes
					event_target:ag_eta_titan_spawn_loc.star = { prev.fleet = { ag_eta_titan_jumpdrive_to_target = yes } }
					while = { limit = { has_modifier = "ag_eta_titan_revive_buff" } remove_modifier = "ag_eta_titan_revive_buff" }
					from.fleet = { clear_fleet_actions = this clear_orders = yes }
					from.owner = { 
						if = { limit = { NOT = { has_country_flag = ag_eta_53_banned } } country_event = { id = ag_eta.53 } }
						else = { create_message = { type = message_ag_eta_titan_flee localization = ag_eta.53.b.desc days = 20 target = eoot.fleet } }
					}
				}
			}
			reroll_random = yes
		}
		else_if = {
			limit = { NOT = { has_global_flag = ag_eta_titan_event_ended } }
			repair_ship = yes set_disabled = no
			random_list = {
				50 = {
					modifier = { add = 15 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value >= 1 } } }
					modifier = { add = 25 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } } }
					modifier = { add = 10 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 4 } } }
					modifier = { factor = 0 check_variable = { which = ag_eta_titan_invincible_revive_times value > 4 } }
					add_modifier = { modifier = "ag_eta_titan_revive_buff" days = 20 }
					change_variable = { which = ag_eta_titan_invincible_revive_times value = 1 }
				}
				50 = {
					modifier = { factor = 0 OR = { NOT = { is_variable_set = ag_eta_titan_invincible_revive_times } check_variable = { which = ag_eta_titan_invincible_revive_times value < 1 } } }
					clear_variable = ag_eta_titan_invincible_revive_times
					ag_get_eta_titan_jumpdrive_target = yes
					event_target:ag_eta_titan_spawn_loc.star = { prev.fleet = { ag_eta_titan_jumpdrive_to_target = yes } }
					while = { limit = { has_modifier = "ag_eta_titan_revive_buff" } remove_modifier = "ag_eta_titan_revive_buff" }
					if = {
						limit = { from.solar_system = { any_ship_in_system = {
							exists = owner
							owner = { is_same_value = root.from.owner }
							is_ship_size = ag_eta_titan_measurer
							has_component = ag_eta_titan_measurer_component
						} } }
						from.owner = { ag_spawn_eta_titan_symbol = yes country_event = { id = ag_eta.54 } }
					}
					else = { from.owner = {
						if = { limit = { NOT = { has_country_flag = ag_eta_53_banned } } country_event = { id = ag_eta.53 } }
						else = { create_message = { type = message_ag_eta_titan_flee localization = ag_eta.53.b.desc days = 20 target = eoot.fleet } }
					} }
					from.fleet = { clear_fleet_actions = this clear_orders = yes }
					from.owner = {
						change_variable = { which = ag_destroy_eta_titans_times value = 1 }
						if = {
							limit = { NOT = { has_country_flag = ag_eta_101_fired } }
							if = {
								limit = { check_variable = { which = ag_destroy_eta_titans_times value = 10 } }
								random_list = {
									50 = { }
									50 = { country_event = { id = ag_eta.101 days = 5 random = 5 } }
								}
								reroll_random = yes
							}
							else_if = {
								limit = { check_variable = { which = ag_destroy_eta_titans_times value = 13 } }
								random_list = {
									25 = { }
									75 = { country_event = { id = ag_eta.101 days = 5 random = 5 } }
								}
								reroll_random = yes
							}
							else_if = {
								limit = { check_variable = { which = ag_destroy_eta_titans_times value = 15 } }
								country_event = { id = ag_eta.101 days = 5 random = 5 }
							}
						}
						add_event_chain_counter = {
							event_chain = "ag_eta_titan_chain_stage_2"
							counter = "ag_eta_titan_defeat_by_us"
							amount = 1
						}
					}
					every_country = {
						limit = { has_event_chain = "ag_eta_titan_chain_stage_2" NOT = { is_same_value = root.from.owner } }
						add_event_chain_counter = {
							event_chain = "ag_eta_titan_chain_stage_2"
							counter = "ag_eta_titan_defeat_by_others"
							amount = 1
						}
					}
				}
			}
			reroll_random = yes
			from.owner = { set_country_flag = ag_encountered_eta_titan }
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_event_ended }
			random_list = {
				50 = {
					from.owner = { country_event = { id = ag_eta.134 } }
					every_country = {
						limit = { NOT = { is_same_value = root.from.owner } }
						country_event = { id = ag_eta.135 }
					}
				}
				50 = { if = {
					limit = {
						from.owner = { NOR = {
							any_controlled_ship = { OR = {
								is_ship_size = ag_eta_titan_0
								is_ship_size = ag_eta_titan_1
							} }
							any_owned_megastructure = { OR = {
								is_megastructure_type = ag_eta_titan_megastructure_0
								is_megastructure_type = ag_eta_titan_megastructure_1
								is_megastructure_type = ag_eta_titan_megastructure_2
								is_megastructure_type = ag_eta_titan_megastructure_3
								is_megastructure_type = ag_eta_titan_megastructure_4
							} }
							has_special_project = ag_capture_eta_titan
							has_special_project = ag_structural_protection_system_602
						} }
					}
					create_ambient_object = { type = ag_ancient_eta_titan_debris_object }
					last_created_ambient_object = {
						set_location = { target = root distance = -1 angle = 0 }
						root.fleet = {
							if = {
								limit = { is_same_value = event_target:ag_eta_titan_hostile_fleet_1 }
								prev = { 
									save_global_event_target_as = ag_eta_titan_hostile_debris_1
									set_ambient_object_flag = ag_eta_titan_hostile_debris_1
									create_ambient_object = { type = large_debris_object }
									last_created_ambient_object = {
										set_location = { target = event_target:ag_eta_titan_hostile_debris_1 distance = 0 angle = random }
										set_ambient_object_flag = ag_eta_titan_hostile_debris_1
									}
								}
								root.from.owner = { country_event = { id = ag_eta.131 scopes = { from = event_target:ag_eta_titan_hostile_debris_1 } } }
							}
							else_if = {
								limit = { is_same_value = event_target:ag_eta_titan_hostile_fleet_2 }
								prev = { 
									save_global_event_target_as = ag_eta_titan_hostile_debris_2
									set_ambient_object_flag = ag_eta_titan_hostile_debris_2
									create_ambient_object = { type = large_debris_object }
									last_created_ambient_object = {
										set_location = { target = event_target:ag_eta_titan_hostile_debris_2 distance = 0 angle = random }
										set_ambient_object_flag = ag_eta_titan_hostile_debris_2
									}
								}
								root.from.owner = { country_event = { id = ag_eta.131 scopes = { from = event_target:ag_eta_titan_hostile_debris_2 } } }
							}
							else_if = {
								limit = { is_same_value = event_target:ag_eta_titan_hostile_fleet_3 }
								prev = { 
									save_global_event_target_as = ag_eta_titan_hostile_debris_3
									set_ambient_object_flag = ag_eta_titan_hostile_debris_3
									create_ambient_object = { type = large_debris_object }
									last_created_ambient_object = {
										set_location = { target = event_target:ag_eta_titan_hostile_debris_3 distance = 0 angle = random }
										set_ambient_object_flag = ag_eta_titan_hostile_debris_3
									}
								}
								root.from.owner = { country_event = { id = ag_eta.131 scopes = { from = event_target:ag_eta_titan_hostile_debris_3 } } }
							}
							else_if = {
								limit = { is_same_value = event_target:ag_eta_titan_hostile_fleet_4 }
								prev = { 
									save_global_event_target_as = ag_eta_titan_hostile_debris_4
									set_ambient_object_flag = ag_eta_titan_hostile_debris_4
									create_ambient_object = { type = large_debris_object }
									last_created_ambient_object = {
										set_location = { target = event_target:ag_eta_titan_hostile_debris_4 distance = 0 angle = random }
										set_ambient_object_flag = ag_eta_titan_hostile_debris_4
									}
								}
								root.from.owner = { country_event = { id = ag_eta.131 scopes = { from = event_target:ag_eta_titan_hostile_debris_4 } } }
							}
						}
					}
				} }
			}
			reroll_random = yes
			solar_system = { if = {
				limit = { has_star_flag = ag_eta_titan_in_system }
				remove_star_flag = ag_eta_titan_in_system
				every_system_ambient_object = {
					limit = { has_ambient_object_flag = ag_eta_system_effect_1 }
					destroy_ambient_object = this
				}
			} }
			event_target:global_event_country = { change_variable = { which = ag_num_eta_titan_destroyed value = 1 } }
			every_country = {
				limit = { has_event_chain = "ag_eta_titan_chain_stage_ended" }
				if = {
					limit = { root.fleet = { is_same_value = event_target:ag_eta_titan_hostile_fleet_1 } }
					if = { limit = { has_special_project = "ag_tracking_eta_titan_1_3" } abort_special_project = { type = "ag_tracking_eta_titan_1_3" } }
					if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_1_3" } abort_special_project = { type = "ag_stop_tracking_eta_titan_1_3" } }
					if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_1_poi } } remove_point_of_interest = ag_eta_titan_loc_1_poi }
					if = { limit = { has_country_flag = ag_tracks_eta_titan_1 } remove_country_flag = ag_tracks_eta_titan_1 }
					if = { limit = { exists = event_target:ag_ancient_eta_guardian_1 } event_target:ag_ancient_eta_guardian_1 = { destroy_country = yes } }
				}
				if = {
					limit = { root.fleet = { is_same_value = event_target:ag_eta_titan_hostile_fleet_2 } }
					if = { limit = { has_special_project = "ag_tracking_eta_titan_2_3" } abort_special_project = { type = "ag_tracking_eta_titan_2_3" } }
					if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_2_3" } abort_special_project = { type = "ag_stop_tracking_eta_titan_2_3" } }
					if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_2_poi } } remove_point_of_interest = ag_eta_titan_loc_2_poi }
					if = { limit = { has_country_flag = ag_tracks_eta_titan_2 } remove_country_flag = ag_tracks_eta_titan_2 }
					if = { limit = { exists = event_target:ag_ancient_eta_guardian_2 } event_target:ag_ancient_eta_guardian_2 = { destroy_country = yes } }
				}
				if = {
					limit = { root.fleet = { is_same_value = event_target:ag_eta_titan_hostile_fleet_3 } }
					if = { limit = { has_special_project = "ag_tracking_eta_titan_3_3" } abort_special_project = { type = "ag_tracking_eta_titan_3_3" } }
					if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_3_3" } abort_special_project = { type = "ag_stop_tracking_eta_titan_3_3" } }
					if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_3_poi } } remove_point_of_interest = ag_eta_titan_loc_3_poi }
					if = { limit = { has_country_flag = ag_tracks_eta_titan_3 } remove_country_flag = ag_tracks_eta_titan_3 }
					if = { limit = { exists = event_target:ag_ancient_eta_guardian_3 } event_target:ag_ancient_eta_guardian_3 = { destroy_country = yes } }
				}
				if = {
					limit = { root.fleet = { is_same_value = event_target:ag_eta_titan_hostile_fleet_4 } }
					if = { limit = { has_special_project = "ag_tracking_eta_titan_4_3" } abort_special_project = { type = "ag_tracking_eta_titan_4_3" } }
					if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_4_3" } abort_special_project = { type = "ag_stop_tracking_eta_titan_4_3" } }
					if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_4_poi } } remove_point_of_interest = ag_eta_titan_loc_4_poi }
					if = { limit = { has_country_flag = ag_tracks_eta_titan_4 } remove_country_flag = ag_tracks_eta_titan_4 }
					if = { limit = { exists = event_target:ag_ancient_eta_guardian_4 } event_target:ag_ancient_eta_guardian_4 = { destroy_country = yes } }
				}
				if = {
					limit = { event_target:global_event_country = { check_variable = { which = ag_num_eta_titan_destroyed value < 4 } } }
					add_event_chain_counter = {
						event_chain = "ag_eta_titan_chain_stage_ended"
						counter = "ag_num_eta_titans_stage_ended"
						amount = -1
					}
				}
				else = { end_event_chain = "ag_eta_titan_chain_stage_ended" }
				if = { limit = { NOT = { is_same_value = from.owner } } country_event = { id = ag_eta.135 } }
			}
			event_target:global_event_country = { if = {
				limit = { check_variable = { which = ag_num_eta_titan_destroyed value = 4 } }
				clear_variable = ag_num_eta_titan_destroyed
				set_global_flag = ag_eta_titan_destroyed
				every_country = {
					country_event = { id = ag_eta.137 days = 2 random = 3 }
					if = { limit = { has_special_project = ag_find_ancient_eta_titan_weakness } abort_special_project = { type = ag_find_ancient_eta_titan_weakness } }
					if = { limit = { has_modifier = "ag_ancient_eta_titan_weakness" } remove_modifier = "ag_ancient_eta_titan_weakness" }
				}
			} }
			destroy_ship = this
		}
	}
}

# Notification.
country_event = {
	id = ag_eta.53
	title = "ag_eta.53.name"
	desc = {
		trigger = { NOT = { has_country_flag = ag_eta_53_fired } }
		text = "ag_eta.53.a.desc"
	}
	desc = {
		trigger = { has_country_flag = ag_eta_53_fired }
		text = "ag_eta.53.b.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_yellow_alert
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = ag_eta_53_mutex } }
	immediate = { set_timed_country_flag = { flag = ag_eta_53_mutex days = 2 } }
	after = { if = { limit = { NOT = { has_country_flag = ag_eta_53_fired } } set_country_flag = ag_eta_53_fired } }
	option = { name = "ag_eta.53.a" }
	option = { name = "ag_no_notification" trigger = { NOT = { has_country_flag = ag_eta_53_banned } } hidden_effect = { set_country_flag = ag_eta_53_banned } }
}
country_event = {
	id = ag_eta.54
	title = "ag_eta.54.name"
	desc = "ag_eta.54.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_yellow_alert
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = ag_eta_54_mutex } }
	immediate = { set_timed_country_flag = { flag = ag_eta_54_mutex days = 2 } }
	option = { name = "ag_eta.54.a" custom_tooltip = "ag_eta.54.a.tooltip" }
}

# Stage 2
country_event = {
	id = ag_eta.61
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		set_global_flag = ag_eta_titan_stage_2
		if = {
			limit = { NOT = { exists = event_target:ag_ancient_eta_guardian } }
			ag_create_ancient_guardian = {
				ag_country_name = "NAME_ag_eta_gateway_guardian"
				ag_country_type = ag_ancient_eta_guardian
			}
			last_created_country = {
				set_country_flag = ag_ancient_eta_guardian
				set_country_flag = ag_ancient_eta_guardian_stage_2
				save_global_event_target_as = ag_ancient_eta_guardian
				ag_ancient_country_friendly_to_each_other = yes
				create_ship_design = { design = "NAME_ag_eta_titan_starbase_hostile" }
				add_ship_design = last_created_design
				every_country = {
					limit = { NOR = { is_same_value = prev has_communications = prev } }
					establish_communications_no_message = prev
				}
			}
		}
		if = {
			limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
			event_target:ag_eta_titan_hostile_fleet_1 = {
				set_owner = event_target:ag_ancient_eta_guardian
				while = {
					count = value:ag_num_ships_spawn|ag_fleet_index|eta_titan_drone_squardron|ag_ship_index|drones|
					create_ship = { name = "NAME_ag_eta_drone_ship_alt" design = "NAME_ag_eta_drone_hostile" prefix = no effect = { ag_difficulty_bonus = yes } }
					change_variable = { which = ag_num_eta_titan_drone_escorts value = 1 }
				}
			}
			if = {
				limit = { exists = event_target:ag_ancient_eta_guardian_1 }
				event_target:ag_ancient_eta_guardian_1 = { destroy_country = yes }
			}
		}
		else = {
			ag_get_eta_titan_spawn_location = { ag_index = 1 }
			event_target:ag_eta_titan_spawn_loc_1.star = { ag_eta_titan_hostile_spawn = { ag_eta_titan_seq = 1 } }
		}
		if = {
			limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
			event_target:ag_eta_titan_hostile_fleet_2 = {
				set_owner = event_target:ag_ancient_eta_guardian
				while = {
					count = value:ag_num_ships_spawn|ag_fleet_index|eta_titan_drone_squardron|ag_ship_index|drones|
					create_ship = { name = "NAME_ag_eta_drone_ship_alt" design = "NAME_ag_eta_drone_hostile" prefix = no effect = { ag_difficulty_bonus = yes } }
					change_variable = { which = ag_num_eta_titan_drone_escorts value = 1 }
				}
			}
			if = {
				limit = { exists = event_target:ag_ancient_eta_guardian_2 }
				event_target:ag_ancient_eta_guardian_2 = { destroy_country = yes }
			}
		}
		else = {
			ag_get_eta_titan_spawn_location = { ag_index = 2 }
			event_target:ag_eta_titan_spawn_loc_2.star = { ag_eta_titan_hostile_spawn = { ag_eta_titan_seq = 2 } }
		}
		if = {
			limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
			event_target:ag_eta_titan_hostile_fleet_3 = {
				set_owner = event_target:ag_ancient_eta_guardian
				while = {
					count = value:ag_num_ships_spawn|ag_fleet_index|eta_titan_drone_squardron|ag_ship_index|drones|
					create_ship = { name = "NAME_ag_eta_drone_ship_alt" design = "NAME_ag_eta_drone_hostile" prefix = no effect = { ag_difficulty_bonus = yes } }
					change_variable = { which = ag_num_eta_titan_drone_escorts value = 1 }
				}
			}
			if = {
				limit = { exists = event_target:ag_ancient_eta_guardian_3 }
				event_target:ag_ancient_eta_guardian_3 = { destroy_country = yes }
			}
		}
		else = {
			ag_get_eta_titan_spawn_location = { ag_index = 3 }
			event_target:ag_eta_titan_spawn_loc_3.star = { ag_eta_titan_hostile_spawn = { ag_eta_titan_seq = 3 } }
		}
		if = {
			limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
			event_target:ag_eta_titan_hostile_fleet_4 = {
				set_owner = event_target:ag_ancient_eta_guardian
				while = {
					count = value:ag_num_ships_spawn|ag_fleet_index|eta_titan_drone_squardron|ag_ship_index|drones|
					create_ship = { name = "NAME_ag_eta_drone_ship_alt" design = "NAME_ag_eta_drone_hostile" prefix = no effect = { ag_difficulty_bonus = yes } }
					change_variable = { which = ag_num_eta_titan_drone_escorts value = 1 }
				}
			}
			if = {
				limit = { exists = event_target:ag_ancient_eta_guardian_4 }
				event_target:ag_ancient_eta_guardian_4 = { destroy_country = yes }
			}
		}
		else = {
			ag_get_eta_titan_spawn_location = { ag_index = 4 }
			event_target:ag_eta_titan_spawn_loc_4.star = { ag_eta_titan_hostile_spawn = { ag_eta_titan_seq = 4 } }
		}
		event_target:ag_eta_titan_hostile_fleet_1 = {
			solar_system = {
				if = { limit = { exists = starbase } starbase.fleet = { destroy_fleet = { target = this kill_leader = yes destroy_template = yes } } }
				ag_create_eta_titan_starbase = { ag_forced_spawn = yes }
			}
			fleet_event = { id = ag_eta.31 days = 2 random = 2 }
		}
		event_target:ag_eta_titan_hostile_fleet_2 = {
			solar_system = {
				if = { limit = { exists = starbase } starbase.fleet = { destroy_fleet = { target = this kill_leader = yes destroy_template = yes } } }
				ag_create_eta_titan_starbase = { ag_forced_spawn = yes }
			}
			fleet_event = { id = ag_eta.31 days = 2 random = 2 }
		}
		event_target:ag_eta_titan_hostile_fleet_3 = {
			solar_system = {
				if = { limit = { exists = starbase } starbase.fleet = { destroy_fleet = { target = this kill_leader = yes destroy_template = yes } } }
				ag_create_eta_titan_starbase = { ag_forced_spawn = yes }
			}
			fleet_event = { id = ag_eta.31 days = 2 random = 2 }
		}
		event_target:ag_eta_titan_hostile_fleet_4 = {
			solar_system = {
				if = { limit = { exists = starbase } starbase.fleet = { destroy_fleet = { target = this kill_leader = yes destroy_template = yes } } }
				ag_create_eta_titan_starbase = { ag_forced_spawn = yes }
			}
			fleet_event = { id = ag_eta.31 days = 2 random = 2 }
		}
		every_galaxy_planet = {
			limit = { has_modifier = "ag_eta_titan_in_orbit" }
			remove_modifier = "ag_eta_titan_in_orbit"
			every_owned_pop = { limit = { has_modifier = "ag_eta_titan_in_orbit_phobe" } remove_modifier = "ag_eta_titan_in_orbit_phobe" }
		}
		every_playable_country = {
			if = {
				limit = { OR = {
					AND = { event_target:ag_eta_titan_hostile_fleet_1 = { exists = solar_system solar_system = { exists = space_owner space_owner = { is_same_value = prevprevprev } } } }
					AND = { event_target:ag_eta_titan_hostile_fleet_2 = { exists = solar_system solar_system = { exists = space_owner space_owner = { is_same_value = prevprevprev } } } }
					AND = { event_target:ag_eta_titan_hostile_fleet_3 = { exists = solar_system solar_system = { exists = space_owner space_owner = { is_same_value = prevprevprev } } } }
					AND = { event_target:ag_eta_titan_hostile_fleet_4 = { exists = solar_system solar_system = { exists = space_owner space_owner = { is_same_value = prevprevprev } } } }
				} }
				country_event = { id = ag_eta.62 }
			}
			else = { country_event = { id = ag_eta.63 } }
		}
	}
}
# Notification.
country_event = {
	id = ag_eta.62
	title = "ag_eta.62.name"
	desc = "ag_eta.62.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_fleet_evil_room }
	show_sound = event_red_alert
	is_triggered_only = yes
	option = {
		name = "ag_eta.62.a"
		ag_eta_stage_2_chain_swap = yes
	}
}
country_event = {
	id = ag_eta.63
	title = "ag_eta.63.name"
	desc = "ag_eta.63.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unknown_ships_room }
	show_sound = event_red_alert
	is_triggered_only = yes
	option = {
		name = "ag_eta.63.a"
		ag_eta_stage_2_chain_swap = yes
	}
	option = {
		name = "ag_eta.63.b"
		ag_eta_stage_2_chain_swap = yes
	}
	option = {
		name = "ag_eta.63.c"
		ag_eta_stage_2_chain_swap = yes
	}
}

# clear symbols randomly
country_event = {
	id = ag_eta.71
	hide_window = yes
	is_triggered_only = yes
	trigger = { ag_eta_titan_event_active = yes }
	immediate = {
		set_variable = { which = ag_eta_symbol_1_color_req value = 0 }
		set_variable = { which = ag_eta_symbol_1_req_1 value = 0 }
		set_variable = { which = ag_eta_symbol_1_req_2 value = 0 }
		set_variable = { which = ag_eta_symbol_1_req_3 value = 0 }
		set_variable = { which = ag_eta_symbol_1_req_4 value = 0 }
		set_variable = { which = ag_eta_symbol_1_color_req_0_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_1_color_req_0_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_1_color_req_0_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 1 ag_color_seq = 0 }
		set_variable = { which = ag_eta_symbol_1_color_req_1_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_1_color_req_1_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_1_color_req_1_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 1 ag_color_seq = 1 }
		set_variable = { which = ag_eta_symbol_1_color_req_2_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_1_color_req_2_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_1_color_req_2_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 1 ag_color_seq = 2 }
		set_variable = { which = ag_eta_symbol_1_color_req_3_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_1_color_req_3_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_1_color_req_3_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 1 ag_color_seq = 3 }
		set_variable = { which = ag_eta_symbol_1_color_req_4_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_1_color_req_4_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_1_color_req_4_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 1 ag_color_seq = 4 }
	}
}
country_event = {
	id = ag_eta.72
	hide_window = yes
	is_triggered_only = yes
	trigger = { ag_eta_titan_event_active = yes }
	immediate = {
		set_variable = { which = ag_eta_symbol_2_color_req value = 0 }
		set_variable = { which = ag_eta_symbol_2_req_1 value = 0 }
		set_variable = { which = ag_eta_symbol_2_req_2 value = 0 }
		set_variable = { which = ag_eta_symbol_2_req_3 value = 0 }
		set_variable = { which = ag_eta_symbol_2_req_4 value = 0 }
		set_variable = { which = ag_eta_symbol_2_color_req_0_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_2_color_req_0_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_2_color_req_0_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 2 ag_color_seq = 0 }
		set_variable = { which = ag_eta_symbol_2_color_req_1_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_2_color_req_1_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_2_color_req_1_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 2 ag_color_seq = 1 }
		set_variable = { which = ag_eta_symbol_2_color_req_2_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_2_color_req_2_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_2_color_req_2_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 2 ag_color_seq = 2 }
		set_variable = { which = ag_eta_symbol_2_color_req_3_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_2_color_req_3_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_2_color_req_3_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 2 ag_color_seq = 3 }
		set_variable = { which = ag_eta_symbol_2_color_req_4_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_2_color_req_4_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_2_color_req_4_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 2 ag_color_seq = 4 }
	}
}
country_event = {
	id = ag_eta.73
	hide_window = yes
	is_triggered_only = yes
	trigger = { ag_eta_titan_event_active = yes }
	immediate = {
		set_variable = { which = ag_eta_symbol_3_color_req value = 0 }
		set_variable = { which = ag_eta_symbol_3_req_1 value = 0 }
		set_variable = { which = ag_eta_symbol_3_req_2 value = 0 }
		set_variable = { which = ag_eta_symbol_3_req_3 value = 0 }
		set_variable = { which = ag_eta_symbol_3_req_4 value = 0 }
		set_variable = { which = ag_eta_symbol_3_color_req_0_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_3_color_req_0_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_3_color_req_0_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 3 ag_color_seq = 0 }
		set_variable = { which = ag_eta_symbol_3_color_req_1_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_3_color_req_1_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_3_color_req_1_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 3 ag_color_seq = 1 }
		set_variable = { which = ag_eta_symbol_3_color_req_2_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_3_color_req_2_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_3_color_req_2_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 3 ag_color_seq = 2 }
		set_variable = { which = ag_eta_symbol_3_color_req_3_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_3_color_req_3_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_3_color_req_3_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 3 ag_color_seq = 3 }
		set_variable = { which = ag_eta_symbol_3_color_req_4_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_3_color_req_4_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_3_color_req_4_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 3 ag_color_seq = 4 }
	}
}
country_event = {
	id = ag_eta.74
	hide_window = yes
	is_triggered_only = yes
	trigger = { ag_eta_titan_event_active = yes }
	immediate = {
		set_variable = { which = ag_eta_symbol_4_color_req value = 0 }
		set_variable = { which = ag_eta_symbol_4_req_1 value = 0 }
		set_variable = { which = ag_eta_symbol_4_req_2 value = 0 }
		set_variable = { which = ag_eta_symbol_4_req_3 value = 0 }
		set_variable = { which = ag_eta_symbol_4_req_4 value = 0 }
		set_variable = { which = ag_eta_symbol_4_color_req_0_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_4_color_req_0_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_4_color_req_0_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 4 ag_color_seq = 0 }
		set_variable = { which = ag_eta_symbol_4_color_req_1_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_4_color_req_1_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_4_color_req_1_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 4 ag_color_seq = 1 }
		set_variable = { which = ag_eta_symbol_4_color_req_2_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_4_color_req_2_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_4_color_req_2_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 4 ag_color_seq = 2 }
		set_variable = { which = ag_eta_symbol_4_color_req_3_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_4_color_req_3_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_4_color_req_3_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 4 ag_color_seq = 3 }
		set_variable = { which = ag_eta_symbol_4_color_req_4_r value = 0.2 }
		set_variable = { which = ag_eta_symbol_4_color_req_4_g value = 0.2 }
		set_variable = { which = ag_eta_symbol_4_color_req_4_b value = 0.2 }
		ag_randomize_eta_symbol_color = { ag_eta_titan_seq = 4 ag_color_seq = 4 }
	}
}

# Trackers
country_event = {
	id = ag_eta.81
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ai = no }
	immediate = {
		set_country_flag = ag_tracks_eta_titan_1
		if = {
			limit = { has_global_flag = ag_eta_titan_stage_1 NOT = { has_global_flag = ag_eta_titan_stage_2 } NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_stage_2 NOT = { has_global_flag = ag_eta_titan_event_ended } NOT = { has_event_chain = "ag_eta_titan_chain_stage_2" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_2" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_2" counter = ag_num_eta_titans_stage_2 amount = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_event_ended NOT = { has_global_flag = ag_eta_titan_destroyed } NOT = { has_event_chain = "ag_eta_titan_chain_stage_ended" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_ended" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
		}
		if = {
			limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 event_target:ag_eta_titan_hostile_fleet_1 = { exists = solar_system } }
			switch = {
				trigger = has_event_chain
				ag_eta_titan_chain_stage_1 = { create_point_of_interest = {
					id = ag_eta_titan_loc_1_poi
					name = ag_eta_titan_loc_1
					desc = ag_eta_titan_loc_1_desc
					event_chain = "ag_eta_titan_chain_stage_1"
					location = event_target:ag_eta_titan_hostile_fleet_1.solar_system
				} }
				ag_eta_titan_chain_stage_2 = { create_point_of_interest = {
					id = ag_eta_titan_loc_1_poi
					name = ag_eta_titan_loc_1
					desc = ag_eta_titan_loc_1_desc
					event_chain = "ag_eta_titan_chain_stage_2"
					location = event_target:ag_eta_titan_hostile_fleet_1.solar_system
				} }
				ag_eta_titan_chain_stage_ended = { create_point_of_interest = {
					id = ag_eta_titan_loc_1_poi
					name = ag_eta_titan_loc_1
					desc = ag_eta_titan_loc_1_desc
					event_chain = "ag_eta_titan_chain_stage_ended"
					location = event_target:ag_eta_titan_hostile_fleet_1.solar_system
				} }
			}
		}
		if = {
			limit = { NOR = {
				has_special_project = "ag_stop_tracking_eta_titan_1_1"
				has_special_project = "ag_stop_tracking_eta_titan_1_2"
				has_special_project = "ag_stop_tracking_eta_titan_1_3"
			} }
			switch = {
				trigger = has_event_chain
				ag_eta_titan_chain_stage_1 = { enable_special_project = { name = "ag_stop_tracking_eta_titan_1_1" owner = root } }
				ag_eta_titan_chain_stage_2 = { enable_special_project = { name = "ag_stop_tracking_eta_titan_1_2" owner = root } }
				ag_eta_titan_chain_stage_ended = { enable_special_project = { name = "ag_stop_tracking_eta_titan_1_3" owner = root } }
			}
		}
	}
	after = {
		if = { limit = { has_special_project = "ag_tracking_eta_titan_1_1" } abort_special_project = { type = "ag_tracking_eta_titan_1_1" } }
		else_if = { limit = { has_special_project = "ag_tracking_eta_titan_1_2" } abort_special_project = { type = "ag_tracking_eta_titan_1_2" } }
		else_if = { limit = { has_special_project = "ag_tracking_eta_titan_1_3" } abort_special_project = { type = "ag_tracking_eta_titan_1_3" } }
	}
}
country_event = {
	id = ag_eta.82
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ai = no }
	immediate = {
		remove_country_flag = ag_tracks_eta_titan_1
		if = {
			limit = { has_global_flag = ag_eta_titan_stage_1 NOT = { has_global_flag = ag_eta_titan_stage_2 } NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_stage_2 NOT = { has_global_flag = ag_eta_titan_event_ended } NOT = { has_event_chain = "ag_eta_titan_chain_stage_2" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_2" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_2" counter = ag_num_eta_titans_stage_2 amount = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_event_ended NOT = { has_global_flag = ag_eta_titan_destroyed } NOT = { has_event_chain = "ag_eta_titan_chain_stage_ended" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_ended" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
		}
		if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_1_poi } } remove_point_of_interest = ag_eta_titan_loc_1_poi }
		if = {
			limit = { NOR = {
				has_special_project = "ag_tracking_eta_titan_1_1"
				has_special_project = "ag_tracking_eta_titan_1_2"
				has_special_project = "ag_tracking_eta_titan_1_3"
			} }
			switch = {
				trigger = has_event_chain
				ag_eta_titan_chain_stage_1 = { enable_special_project = { name = "ag_tracking_eta_titan_1_1" owner = root } }
				ag_eta_titan_chain_stage_2 = { enable_special_project = { name = "ag_tracking_eta_titan_1_2" owner = root } }
				ag_eta_titan_chain_stage_ended = { enable_special_project = { name = "ag_tracking_eta_titan_1_3" owner = root } }
			}
		}
	}
	after = {
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_1_1" } abort_special_project = { type = "ag_stop_tracking_eta_titan_1_1" } }
		else_if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_1_2" } abort_special_project = { type = "ag_stop_tracking_eta_titan_1_2" } }
		else_if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_1_3" } abort_special_project = { type = "ag_stop_tracking_eta_titan_1_3" } }
	}
}
country_event = {
	id = ag_eta.83
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ai = no }
	immediate = {
		set_country_flag = ag_tracks_eta_titan_2
		if = {
			limit = { has_global_flag = ag_eta_titan_stage_1 NOT = { has_global_flag = ag_eta_titan_stage_2 } NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_stage_2 NOT = { has_global_flag = ag_eta_titan_event_ended } NOT = { has_event_chain = "ag_eta_titan_chain_stage_2" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_2" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_2" counter = ag_num_eta_titans_stage_2 amount = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_event_ended NOT = { has_global_flag = ag_eta_titan_destroyed } NOT = { has_event_chain = "ag_eta_titan_chain_stage_ended" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_ended" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
		}
		if = {
			limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 event_target:ag_eta_titan_hostile_fleet_2 = { exists = solar_system } }
			switch = {
				trigger = has_event_chain
				ag_eta_titan_chain_stage_1 = { create_point_of_interest = {
					id = ag_eta_titan_loc_2_poi
					name = ag_eta_titan_loc_2
					desc = ag_eta_titan_loc_2_desc
					event_chain = "ag_eta_titan_chain_stage_1"
					location = event_target:ag_eta_titan_hostile_fleet_2.solar_system
				} }
				ag_eta_titan_chain_stage_2 = { create_point_of_interest = {
					id = ag_eta_titan_loc_2_poi
					name = ag_eta_titan_loc_2
					desc = ag_eta_titan_loc_2_desc
					event_chain = "ag_eta_titan_chain_stage_2"
					location = event_target:ag_eta_titan_hostile_fleet_2.solar_system
				} }
				ag_eta_titan_chain_stage_ended = { create_point_of_interest = {
					id = ag_eta_titan_loc_2_poi
					name = ag_eta_titan_loc_2
					desc = ag_eta_titan_loc_2_desc
					event_chain = "ag_eta_titan_chain_stage_ended"
					location = event_target:ag_eta_titan_hostile_fleet_2.solar_system
				} }
			}
		}
		if = {
			limit = { NOR = {
				has_special_project = "ag_stop_tracking_eta_titan_2_1"
				has_special_project = "ag_stop_tracking_eta_titan_2_2"
				has_special_project = "ag_stop_tracking_eta_titan_2_3"
			} }
			switch = {
				trigger = has_event_chain
				ag_eta_titan_chain_stage_1 = { enable_special_project = { name = "ag_stop_tracking_eta_titan_2_1" owner = root } }
				ag_eta_titan_chain_stage_2 = { enable_special_project = { name = "ag_stop_tracking_eta_titan_2_2" owner = root } }
				ag_eta_titan_chain_stage_ended = { enable_special_project = { name = "ag_stop_tracking_eta_titan_2_3" owner = root } }
			}
		}
	}
	after = {
		if = { limit = { has_special_project = "ag_tracking_eta_titan_2_1" } abort_special_project = { type = "ag_tracking_eta_titan_2_1" } }
		else_if = { limit = { has_special_project = "ag_tracking_eta_titan_2_2" } abort_special_project = { type = "ag_tracking_eta_titan_2_2" } }
		else_if = { limit = { has_special_project = "ag_tracking_eta_titan_2_3" } abort_special_project = { type = "ag_tracking_eta_titan_2_3" } }
	}
}
country_event = {
	id = ag_eta.84
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ai = no }
	immediate = {
		remove_country_flag = ag_tracks_eta_titan_2
		if = {
			limit = { has_global_flag = ag_eta_titan_stage_1 NOT = { has_global_flag = ag_eta_titan_stage_2 } NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_stage_2 NOT = { has_global_flag = ag_eta_titan_event_ended } NOT = { has_event_chain = "ag_eta_titan_chain_stage_2" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_2" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_2" counter = ag_num_eta_titans_stage_2 amount = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_event_ended NOT = { has_global_flag = ag_eta_titan_destroyed } NOT = { has_event_chain = "ag_eta_titan_chain_stage_ended" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_ended" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
		}
		if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_2_poi } } remove_point_of_interest = ag_eta_titan_loc_2_poi }
		if = {
			limit = { NOR = {
				has_special_project = "ag_tracking_eta_titan_2_1"
				has_special_project = "ag_tracking_eta_titan_2_2"
				has_special_project = "ag_tracking_eta_titan_2_3"
			} }
			switch = {
				trigger = has_event_chain
				ag_eta_titan_chain_stage_1 = { enable_special_project = { name = "ag_tracking_eta_titan_2_1" owner = root } }
				ag_eta_titan_chain_stage_2 = { enable_special_project = { name = "ag_tracking_eta_titan_2_2" owner = root } }
				ag_eta_titan_chain_stage_ended = { enable_special_project = { name = "ag_tracking_eta_titan_2_3" owner = root } }
			}
		}
	}
	after = {
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_2_1" } abort_special_project = { type = "ag_stop_tracking_eta_titan_2_1" } }
		else_if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_2_2" } abort_special_project = { type = "ag_stop_tracking_eta_titan_2_2" } }
		else_if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_2_3" } abort_special_project = { type = "ag_stop_tracking_eta_titan_2_3" } }
	}
}
country_event = {
	id = ag_eta.85
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ai = no }
	immediate = {
		set_country_flag = ag_tracks_eta_titan_3
		if = {
			limit = { has_global_flag = ag_eta_titan_stage_1 NOT = { has_global_flag = ag_eta_titan_stage_2 } NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_stage_2 NOT = { has_global_flag = ag_eta_titan_event_ended } NOT = { has_event_chain = "ag_eta_titan_chain_stage_2" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_2" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_2" counter = ag_num_eta_titans_stage_2 amount = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_event_ended NOT = { has_global_flag = ag_eta_titan_destroyed } NOT = { has_event_chain = "ag_eta_titan_chain_stage_ended" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_ended" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
		}
		if = {
			limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 event_target:ag_eta_titan_hostile_fleet_3 = { exists = solar_system } }
			switch = {
				trigger = has_event_chain
				ag_eta_titan_chain_stage_1 = { create_point_of_interest = {
					id = ag_eta_titan_loc_3_poi
					name = ag_eta_titan_loc_3
					desc = ag_eta_titan_loc_3_desc
					event_chain = "ag_eta_titan_chain_stage_1"
					location = event_target:ag_eta_titan_hostile_fleet_3.solar_system
				} }
				ag_eta_titan_chain_stage_2 = { create_point_of_interest = {
					id = ag_eta_titan_loc_3_poi
					name = ag_eta_titan_loc_3
					desc = ag_eta_titan_loc_3_desc
					event_chain = "ag_eta_titan_chain_stage_2"
					location = event_target:ag_eta_titan_hostile_fleet_3.solar_system
				} }
				ag_eta_titan_chain_stage_ended = { create_point_of_interest = {
					id = ag_eta_titan_loc_3_poi
					name = ag_eta_titan_loc_3
					desc = ag_eta_titan_loc_3_desc
					event_chain = "ag_eta_titan_chain_stage_ended"
					location = event_target:ag_eta_titan_hostile_fleet_3.solar_system
				} }
			}
		}
		if = {
			limit = { NOR = {
				has_special_project = "ag_stop_tracking_eta_titan_3_1"
				has_special_project = "ag_stop_tracking_eta_titan_3_2"
				has_special_project = "ag_stop_tracking_eta_titan_3_3"
			} }
			switch = {
				trigger = has_event_chain
				ag_eta_titan_chain_stage_1 = { enable_special_project = { name = "ag_stop_tracking_eta_titan_3_1" owner = root } }
				ag_eta_titan_chain_stage_2 = { enable_special_project = { name = "ag_stop_tracking_eta_titan_3_2" owner = root } }
				ag_eta_titan_chain_stage_ended = { enable_special_project = { name = "ag_stop_tracking_eta_titan_3_3" owner = root } }
			}
		}
	}
	after = {
		if = { limit = { has_special_project = "ag_tracking_eta_titan_3_1" } abort_special_project = { type = "ag_tracking_eta_titan_3_1" } }
		else_if = { limit = { has_special_project = "ag_tracking_eta_titan_3_2" } abort_special_project = { type = "ag_tracking_eta_titan_3_2" } }
		else_if = { limit = { has_special_project = "ag_tracking_eta_titan_3_3" } abort_special_project = { type = "ag_tracking_eta_titan_3_3" } }
	}
}
country_event = {
	id = ag_eta.86
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ai = no }
	immediate = {
		remove_country_flag = ag_tracks_eta_titan_3
		if = {
			limit = { has_global_flag = ag_eta_titan_stage_1 NOT = { has_global_flag = ag_eta_titan_stage_2 } NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_stage_2 NOT = { has_global_flag = ag_eta_titan_event_ended } NOT = { has_event_chain = "ag_eta_titan_chain_stage_2" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_2" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_2" counter = ag_num_eta_titans_stage_2 amount = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_event_ended NOT = { has_global_flag = ag_eta_titan_destroyed } NOT = { has_event_chain = "ag_eta_titan_chain_stage_ended" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_ended" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
		}
		if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_3_poi } } remove_point_of_interest = ag_eta_titan_loc_3_poi }
		if = {
			limit = { NOR = {
				has_special_project = "ag_tracking_eta_titan_3_1"
				has_special_project = "ag_tracking_eta_titan_3_2"
				has_special_project = "ag_tracking_eta_titan_3_3"
			} }
			switch = {
				trigger = has_event_chain
				ag_eta_titan_chain_stage_1 = { enable_special_project = { name = "ag_tracking_eta_titan_3_1" owner = root } }
				ag_eta_titan_chain_stage_2 = { enable_special_project = { name = "ag_tracking_eta_titan_3_2" owner = root } }
				ag_eta_titan_chain_stage_ended = { enable_special_project = { name = "ag_tracking_eta_titan_3_3" owner = root } }
			}
		}
	}
	after = {
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_3_1" } abort_special_project = { type = "ag_stop_tracking_eta_titan_3_1" } }
		else_if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_3_2" } abort_special_project = { type = "ag_stop_tracking_eta_titan_3_2" } }
		else_if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_3_3" } abort_special_project = { type = "ag_stop_tracking_eta_titan_3_3" } }
	}
}
country_event = {
	id = ag_eta.87
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ai = no }
	immediate = {
		set_country_flag = ag_tracks_eta_titan_4
		if = {
			limit = { has_global_flag = ag_eta_titan_stage_1 NOT = { has_global_flag = ag_eta_titan_stage_2 } NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_stage_2 NOT = { has_global_flag = ag_eta_titan_event_ended } NOT = { has_event_chain = "ag_eta_titan_chain_stage_2" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_2" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_2" counter = ag_num_eta_titans_stage_2 amount = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_event_ended NOT = { has_global_flag = ag_eta_titan_destroyed } NOT = { has_event_chain = "ag_eta_titan_chain_stage_ended" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_ended" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
		}
		if = {
			limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 event_target:ag_eta_titan_hostile_fleet_4 = { exists = solar_system } }
			switch = {
				trigger = has_event_chain
				ag_eta_titan_chain_stage_1 = { create_point_of_interest = {
					id = ag_eta_titan_loc_4_poi
					name = ag_eta_titan_loc_4
					desc = ag_eta_titan_loc_4_desc
					event_chain = "ag_eta_titan_chain_stage_1"
					location = event_target:ag_eta_titan_hostile_fleet_4.solar_system
				} }
				ag_eta_titan_chain_stage_2 = { create_point_of_interest = {
					id = ag_eta_titan_loc_4_poi
					name = ag_eta_titan_loc_4
					desc = ag_eta_titan_loc_4_desc
					event_chain = "ag_eta_titan_chain_stage_2"
					location = event_target:ag_eta_titan_hostile_fleet_4.solar_system
				} }
				ag_eta_titan_chain_stage_ended = { create_point_of_interest = {
					id = ag_eta_titan_loc_4_poi
					name = ag_eta_titan_loc_4
					desc = ag_eta_titan_loc_4_desc
					event_chain = "ag_eta_titan_chain_stage_ended"
					location = event_target:ag_eta_titan_hostile_fleet_4.solar_system
				} }
			}
		}
		if = {
			limit = { NOR = {
				has_special_project = "ag_stop_tracking_eta_titan_4_1"
				has_special_project = "ag_stop_tracking_eta_titan_4_2"
				has_special_project = "ag_stop_tracking_eta_titan_4_3"
			} }
			switch = {
				trigger = has_event_chain
				ag_eta_titan_chain_stage_1 = { enable_special_project = { name = "ag_stop_tracking_eta_titan_4_1" owner = root } }
				ag_eta_titan_chain_stage_2 = { enable_special_project = { name = "ag_stop_tracking_eta_titan_4_2" owner = root } }
				ag_eta_titan_chain_stage_ended = { enable_special_project = { name = "ag_stop_tracking_eta_titan_4_3" owner = root } }
			}
		}
	}
	after = {
		if = { limit = { has_special_project = "ag_tracking_eta_titan_4_1" } abort_special_project = { type = "ag_tracking_eta_titan_4_1" } }
		else_if = { limit = { has_special_project = "ag_tracking_eta_titan_4_2" } abort_special_project = { type = "ag_tracking_eta_titan_4_2" } }
		else_if = { limit = { has_special_project = "ag_tracking_eta_titan_4_3" } abort_special_project = { type = "ag_tracking_eta_titan_4_3" } }
	}
}
country_event = {
	id = ag_eta.88
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ai = no }
	immediate = {
		remove_country_flag = ag_tracks_eta_titan_4
		if = {
			limit = { has_global_flag = ag_eta_titan_stage_1 NOT = { has_global_flag = ag_eta_titan_stage_2 } NOT = { has_event_chain = "ag_eta_titan_chain_stage_1" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_1" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_1" counter = ag_num_eta_titans_stage_1 amount = 1 }
			}
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_stage_2 NOT = { has_global_flag = ag_eta_titan_event_ended } NOT = { has_event_chain = "ag_eta_titan_chain_stage_2" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_2" target = root }
			add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_2" counter = ag_num_eta_titans_stage_2 amount = 4 }
		}
		else_if = {
			limit = { has_global_flag = ag_eta_titan_event_ended NOT = { has_global_flag = ag_eta_titan_destroyed } NOT = { has_event_chain = "ag_eta_titan_chain_stage_ended" } }
			begin_event_chain = { event_chain = "ag_eta_titan_chain_stage_ended" target = root }
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
			if = {
				limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 }
				add_event_chain_counter = { event_chain = "ag_eta_titan_chain_stage_ended" counter = ag_num_eta_titans_stage_ended amount = 1 }
			}
		}
		if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_4_poi } } remove_point_of_interest = ag_eta_titan_loc_4_poi }
		if = {
			limit = { NOR = {
				has_special_project = "ag_tracking_eta_titan_4_1"
				has_special_project = "ag_tracking_eta_titan_4_2"
				has_special_project = "ag_tracking_eta_titan_4_3"
			} }
			switch = {
				trigger = has_event_chain
				ag_eta_titan_chain_stage_1 = { enable_special_project = { name = "ag_tracking_eta_titan_4_1" owner = root } }
				ag_eta_titan_chain_stage_2 = { enable_special_project = { name = "ag_tracking_eta_titan_4_2" owner = root } }
				ag_eta_titan_chain_stage_ended = { enable_special_project = { name = "ag_tracking_eta_titan_4_3" owner = root } }
			}
		}
	}
	after = {
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_4_1" } abort_special_project = { type = "ag_stop_tracking_eta_titan_4_1" } }
		else_if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_4_2" } abort_special_project = { type = "ag_stop_tracking_eta_titan_4_2" } }
		else_if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_4_3" } abort_special_project = { type = "ag_stop_tracking_eta_titan_4_3" } }
	}
}

# on_ship_destroyed_perp, Counter for ships destroyed by eta titans
country_event = {
	id = ag_eta.91
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = ag_eta_titan_stage_2
		NOT = { has_global_flag = ag_eta_titan_event_ended }
		is_country_type = ag_ancient_eta_guardian
		from = { NOT = { is_country_type = ag_ancient_eta_guardian } }
	}

	immediate = {
		from = { change_variable = { which = ag_num_ships_destroyed_by_eta_titans value = 1 } }
		every_country = {
			limit = {
				NOT = { is_same_value = event_target:ag_ancient_eta_guardian }
				has_event_chain = "ag_eta_titan_chain_stage_2"
			}
			add_event_chain_counter = {
				event_chain = "ag_eta_titan_chain_stage_2"
				counter = ag_eta_titan_destroyed_ships
				amount = 1
			}
		}
	}
}

# on_planet_bombarded, Eta titan destroy a planet
planet_event = {
	id = ag_eta.92
	title = "ag_eta.92.name"
	desc = {
		trigger = { NOR = { AND = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no } ag_is_habitat = yes has_modifier = "holy_planet" } }
		text = "ag_eta.92.a.desc"
	}
	desc = {
		trigger = { AND = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no } }
		text = "ag_eta.92.b.desc"
	}
	desc = {
		trigger = { ag_is_habitat = yes }
		text = "ag_eta.92.c.desc"
	}
	desc = {
		trigger = { has_modifier = "ag_shattered_holy_planet" }
		text = "ag_eta.92.d.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_nuclear_explosion_room }
	show_sound = event_super_explosion
	location = root

	is_triggered_only = yes

	trigger = {
		has_global_flag = ag_eta_titan_stage_2
		NOT = { has_global_flag = ag_eta_titan_event_ended }
		OR = {
			planet_devastation >= 100
			AND = { num_pops < 2 owner = { ag_is_common_country = yes } }
		}
		exists = event_target:ag_ancient_eta_guardian
		from = {
			is_same_value = event_target:ag_ancient_eta_guardian
			has_country_flag = ag_ancient_eta_guardian
		}
	}
	
	immediate = {
		if = {
			limit = { exists = owner }
			owner = { change_variable = { which = ag_num_planets_destroyed_by_eta_titans value = 1 } }
		}
		add_threat = { who = from amount = 2 }
		add_planet_devastation = -100
		if = { limit = { has_modifier = "holy_planet" } set_planet_flag = ag_holy_planet }
		clear_planet_modifiers = yes
		remove_all_buildings = yes
		remove_all_districts = yes
		clear_deposits = yes
		if = { limit = { has_branch_office = yes } close_branch_office = yes }
		if = { limit = { is_colony = yes } destroy_colony = yes }
		ag_remove_all_modifier_common = yes
		if = {
			limit = {
				NOR = {
					AND = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no }
					ag_is_habitat = yes
					has_planet_flag = ag_holy_planet
				}
			}
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
			ag_change_pc = { ag_planet_class = pc_broken }
		}
		else_if = {
			limit = { ag_is_ringworld = yes ag_is_unhabitable_ringworld = no }
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
			ag_destroy_habitable_ringworld = yes
		}
		else_if = {
			limit = { ag_is_habitat = yes }
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
			ag_remove_planet = yes
		}
		else_if = {
			limit = { has_planet_flag = ag_holy_planet }
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
			ag_change_pc = { ag_planet_class = pc_shattered }
			remove_planet_flag = ag_holy_planet
			remove_modifier = "holy_planet"
			add_modifier = { modifier = "ag_shattered_holy_planet" days = -1 }
		}
		every_country = {
			limit = {
				NOT = { is_same_value = event_target:ag_ancient_eta_guardian }
				has_event_chain = "ag_eta_titan_chain_stage_2"
			}
			add_event_chain_counter = {
				event_chain = "ag_eta_titan_chain_stage_2"
				counter = "ag_eta_titan_destroyed_planets"
				amount = 1
			}
		}
		solar_system = { every_fleet_in_system = {
			limit = {
				exists = owner
				owner = { has_country_flag = ag_ancient_eta_guardian }
				has_fleet_flag = ag_eta_titan_hostile_fleet
				OR = {
					AND = { exists = orbit orbit = { is_same_value = root } }
					AND = { is_fleet_idle = yes NAND = {
						exists = orbit
						orbit = {
							NOT = { is_star = yes }
							exists = owner
							owner = { is_hostile = event_target:ag_ancient_eta_guardian }
						}
					} }
				}
			}
			clear_orders = yes
			clear_fleet_actions = this
			fleet_event = { id = ag_eta.31 days = 1 random = 2 }
		} }
	}
	
	option = { name = "ag_eta.92.a" }
}

# Give research project for close ancient gateway
country_event = {
	id = ag_eta.101
	title = "ag_eta.101.name"
	desc = "ag_eta.101.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_mystic_reveal

	mean_time_to_happen = {
		years = 8
		modifier = { factor = 0.5 is_variable_set = ag_num_planets_destroyed_by_eta_titans }
		modifier = { factor = 0.75 is_variable_set = ag_destroy_eta_titans_times }
		modifier = { factor = 0.75 check_variable = { which = ag_destroy_eta_titans_times value > 2 } }
		modifier = { factor = 0.75 check_variable = { which = ag_destroy_eta_titans_times value > 4 } }
		modifier = { factor = 0.75 check_variable = { which = ag_destroy_eta_titans_times value > 6 } }
		modifier = { factor = 0.75 check_variable = { which = ag_destroy_eta_titans_times value > 8 } }
	}

	trigger = {
		has_global_flag = ag_eta_titan_stage_2
		NOR = {
			has_global_flag = ag_eta_titan_event_ended
			has_country_flag = ag_eta_101_fired
		}
		has_country_flag = ag_encountered_eta_titan
	}

	immediate = { set_country_flag = ag_eta_101_fired }
	
	option = {
		name = "ag_eta.101.a"
		custom_tooltip = "ag_eta.101.a.tooltip"
		hidden_effect = { ag_give_research_project = { ag_project_id = @ag_eta_control_station_project_id ag_progress = 2.0 } }
	}
}

# Finished research of ancient control station
country_event = {
	id = ag_eta.102
	title = "ag_eta.102.name"
	desc = {
		trigger = { NOT = { has_global_flag = ag_ancient_eta_gateway_control_restored } }
		text = "ag_eta.102.a.desc"
	}
	desc = {
		trigger = { has_global_flag = ag_ancient_eta_gateway_control_restored }
		text = "ag_eta.102.b.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_mystic_reveal

	is_triggered_only = yes

	immediate = {
		set_country_flag = ag_eta_102_fired
		if = {
			limit = { NOT = { has_global_flag = ag_ancient_eta_gateway_control_restored } }
			event_target:ag_ancient_eta_star.solar_system = { random_system_ambient_object = {
				limit = { is_ambient_object_type = ag_eta_damaged_gateway_control_station }
				prev = {
					if = {
						limit = { exists = space_owner }
						spawn_megastructure = {
							type = ag_ancient_eta_gateway_control_damaged
							coords_from = prev
							owner = space_owner
						}
					}
					else = {
						spawn_megastructure = {
							type = ag_ancient_eta_gateway_control_damaged
							coords_from = prev
						}
					}
				}
				destroy_ambient_object = this
			} }
		}
	}
	
	option = {
		name = "ag_eta.102.a"
		if = {
			limit = { has_global_flag = ag_ancient_eta_gateway_control_restored }
			custom_tooltip = "ag_eta.102.b.tooltip"
		}
		else = { custom_tooltip = "ag_eta.102.a.tooltip" }
	}
}

# Restored ancient control station.
country_event = {
	id = ag_eta.103
	title = "ag_eta.103.name"
	desc = "ag_eta.103.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_complete
	location = fromfromfrom
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = ag_eta_103_fired } }
	immediate = { set_country_flag = ag_eta_103_fired }
	option = { name = "ag_eta.103.a" custom_tooltip = "ag_eta.102.b.tooltip" }
}

# Input Codes
country_event = {
	id = ag_eta.104
	title = "ag_eta.104.name"
	desc = "ag_eta.104.desc"
	diplomatic = yes
	custom_gui = "ag_eta_gateway_ctrl_station_window"
	custom_gui_option = "ag_eta_gateway_ctrl_station_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_default
	is_triggered_only = yes
	immediate = {
		if = { limit = { NOT = { has_country_flag = ag_eta_107_fired } } set_country_flag = ag_eta_107_fired country_event = { id = ag_eta.107 } }
		event_target:global_event_country = {
			if = { limit = { NOT = { is_variable_set = ag_eta_control_group_1_color } } set_variable = { which = ag_eta_control_group_1_color value = 1 } }
			if = { limit = { NOT = { is_variable_set = ag_eta_control_group_2_color } } set_variable = { which = ag_eta_control_group_2_color value = 1 } }
			if = { limit = { NOT = { is_variable_set = ag_eta_control_group_3_color } } set_variable = { which = ag_eta_control_group_3_color value = 1 } }
			if = { limit = { NOT = { is_variable_set = ag_eta_control_group_4_color } } set_variable = { which = ag_eta_control_group_4_color value = 1 } }
		}
	}
	after = { hidden_effect = { remove_global_flag = ag_ancient_eta_gateway_control_settings_opened } }
	option = {
		name = "ag_eta.104.a"
		hidden_effect = { if = {
			limit = { NOT = { has_global_flag = ag_eta_symbol_checking } }
			set_global_flag = ag_eta_symbol_checking
			event_target:global_event_country = { country_event = { id = ag_eta.106 days = 15 random = 15 } }
			country_event = { id = ag_eta.108 }
		} }
	}
	option = { name = "ag_eta.104.b" }
}

# Test Ancient Codes
country_event = {
	id = ag_eta.105
	title = "ag_eta.105.name"
	desc = ""
	diplomatic = yes
	custom_gui = "ag_eta_gateway_decoder_window"
	picture_event_data = { room = ag_ancient_empire_mod_settings_room }
	show_sound = event_default
	is_triggered_only = yes
	immediate = { if = { limit = { NOT = { has_country_flag = ag_eta_107_fired } } set_country_flag = ag_eta_107_fired country_event = { id = ag_eta.107 } } }
	after = { hidden_effect = {
		remove_global_flag = ag_ancient_eta_gateway_control_test
		if = { limit = { is_variable_set = ag_eta_symbol_exp_1_var } clear_variable = ag_eta_symbol_exp_1_var }
		if = { limit = { is_variable_set = ag_eta_symbol_exp_2_var } clear_variable = ag_eta_symbol_exp_2_var }
		if = { limit = { is_variable_set = ag_eta_symbol_exp_result_var } clear_variable = ag_eta_symbol_exp_result_var }
	} }
	option = {
		name = "ag_eta.105.a" custom_gui = "ag_eta_gateway_decoder_test_option" is_dialog_only = yes response_text = ""
		hidden_effect = {
			ag_eta_symbol_get = { ag_which = exp_result ag_value = exp_1 }
			ag_eta_symbol_add = { ag_which = exp_result ag_value = exp_2 }
		}
	}
	option = { name = "ag_eta.105.b" custom_gui = "ag_eta_gateway_decoder_confirm_option" default_hide_option = yes }
}

# Check symbols
country_event = {
	id = ag_eta.106
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		ag_check_input_symbols = yes
		if = {
			limit = { check_variable = { which = ag_eta_symbols_check_result value = 1 } }
			# Succeeded
			set_global_flag = ag_eta_titan_event_ended
			event_target:ag_ancient_eta_shielded_world = {
				ag_set_ancient_ringworld = {
					ag_color = red
					ag_type = habitable
					ag_surface_type = desert_01
					ag_shield_color = green
				}
				solar_system = {
					random_system_megastructure = {
						limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_burst }
						ag_spawn_explosion_effect = { ag_scale = l ag_color = blue }
						ag_eta_create_gateway_portal = { ag_type = galactic_gateway }
						ag_eta_upgrade_gateway_frame = { ag_target_level = 1 }
					}
					random_system_megastructure = {
						limit = { OR = {
							is_megastructure_type = ag_ancient_eta_gateway_control_restored
							is_megastructure_type = ag_ancient_eta_gateway_control_restored_1
							is_megastructure_type = ag_ancient_eta_gateway_control_restored_2
						} }
						solar_system = { spawn_megastructure = {
							type = ag_ancient_eta_gateway_control_megastructure_3
							coords_from = prev
							init_effect = {
								if = {
									limit = { solar_system = { exists = space_owner } }
									set_owner = solar_system.space_owner
									solar_system.space_owner = {
										save_global_event_target_as = ag_eta_gateway_controller
									}
								}
							}
						} }
						remove_megastructure = this
					}
				}
			}
			every_ambient_object = {
				limit = { OR = {
					has_ambient_object_flag = ag_eta_system_effect_1
					has_ambient_object_flag = ag_eta_system_effect_2
				} }
				destroy_ambient_object = this
			}
			every_country = {
				limit = { OR = {
					has_event_chain = "ag_eta_titan_chain_stage_1"
					has_event_chain = "ag_eta_titan_chain_stage_2"
				} }
				if = { limit = { is_same_value = from } country_event = { id = ag_eta.109 days = 1 random = 1 } }
				else = { country_event = { id = ag_eta.110 days = 2 random = 3 } }
			}
			if = {
				limit = { NOT = { exists = event_target:ag_ancient_eta_guardian_1 } }
				ag_create_ancient_guardian = {
					ag_country_name = "NAME_ag_eta_gateway_guardian"
					ag_country_type = ag_ancient_eta_guardian_passive
				}
				last_created_country = {
					set_country_flag = ag_ancient_eta_guardian
					set_country_flag = ag_ancient_eta_guardian_1
					save_global_event_target_as = ag_ancient_eta_guardian_1
					ag_ancient_country_friendly_to_each_other = yes
				}
			}
			if = { limit = { exists = event_target:ag_eta_titan_hostile_fleet_1 } event_target:ag_eta_titan_hostile_fleet_1 = { set_owner = event_target:ag_ancient_eta_guardian_1 } }
			else = { ag_get_eta_titan_spawn_location = { ag_index = 1 } event_target:ag_eta_titan_spawn_loc_1.star = { ag_eta_titan_hostile_spawn = { ag_eta_titan_seq = 1 } } }
			if = {
				limit = { NOT = { exists = event_target:ag_ancient_eta_guardian_2 } }
				ag_create_ancient_guardian = {
					ag_country_name = "NAME_ag_eta_gateway_guardian"
					ag_country_type = ag_ancient_eta_guardian_passive
				}
				last_created_country = {
					set_country_flag = ag_ancient_eta_guardian
					set_country_flag = ag_ancient_eta_guardian_2
					save_global_event_target_as = ag_ancient_eta_guardian_2
					ag_ancient_country_friendly_to_each_other = yes
				}
			}
			if = { limit = { exists = event_target:ag_eta_titan_hostile_fleet_2 } event_target:ag_eta_titan_hostile_fleet_2 = { set_owner = event_target:ag_ancient_eta_guardian_2 } }
			else = { ag_get_eta_titan_spawn_location = { ag_index = 2 } event_target:ag_eta_titan_spawn_loc_2.star = { ag_eta_titan_hostile_spawn = { ag_eta_titan_seq = 2 } } }
			if = {
				limit = { NOT = { exists = event_target:ag_ancient_eta_guardian_3 } }
				ag_create_ancient_guardian = {
					ag_country_name = "NAME_ag_eta_gateway_guardian"
					ag_country_type = ag_ancient_eta_guardian_passive
				}
				last_created_country = {
					set_country_flag = ag_ancient_eta_guardian
					set_country_flag = ag_ancient_eta_guardian_3
					save_global_event_target_as = ag_ancient_eta_guardian_3
					ag_ancient_country_friendly_to_each_other = yes
				}
			}
			if = { limit = { exists = event_target:ag_eta_titan_hostile_fleet_3 } event_target:ag_eta_titan_hostile_fleet_3 = { set_owner = event_target:ag_ancient_eta_guardian_3 } }
			else = { ag_get_eta_titan_spawn_location = { ag_index = 3 } event_target:ag_eta_titan_spawn_loc_3.star = { ag_eta_titan_hostile_spawn = { ag_eta_titan_seq = 3 } } }
			if = {
				limit = { NOT = { exists = event_target:ag_ancient_eta_guardian_4 } }
				ag_create_ancient_guardian = {
					ag_country_name = "NAME_ag_eta_gateway_guardian"
					ag_country_type = ag_ancient_eta_guardian_passive
				}
				last_created_country = {
					set_country_flag = ag_ancient_eta_guardian
					set_country_flag = ag_ancient_eta_guardian_4
					save_global_event_target_as = ag_ancient_eta_guardian_4
					ag_ancient_country_friendly_to_each_other = yes
				}
			}
			if = { limit = { exists = event_target:ag_eta_titan_hostile_fleet_4 } event_target:ag_eta_titan_hostile_fleet_4 = { set_owner = event_target:ag_ancient_eta_guardian_4 } }
			else = { ag_get_eta_titan_spawn_location = { ag_index = 4 } event_target:ag_eta_titan_spawn_loc_4.star = { ag_eta_titan_hostile_spawn = { ag_eta_titan_seq = 4 } } }
			event_target:ag_eta_titan_hostile_fleet_1 = { clear_orders = yes clear_fleet_actions = this fleet_event = { id = ag_eta.31 days = 2 random = 2 } }
			event_target:ag_eta_titan_hostile_fleet_2 = { clear_orders = yes clear_fleet_actions = this fleet_event = { id = ag_eta.31 days = 2 random = 2 } }
			event_target:ag_eta_titan_hostile_fleet_3 = { clear_orders = yes clear_fleet_actions = this fleet_event = { id = ag_eta.31 days = 2 random = 2 } }
			event_target:ag_eta_titan_hostile_fleet_4 = { clear_orders = yes clear_fleet_actions = this fleet_event = { id = ag_eta.31 days = 2 random = 2 } }
			if = { limit = { exists = event_target:ag_ancient_eta_guardian } event_target:ag_ancient_eta_guardian = { destroy_country = yes } }
			if = { limit = { exists = event_target:ag_ancient_eta_gateway_guardian } event_target:ag_ancient_eta_gateway_guardian = { destroy_country = yes } }
			every_country = {
				if = { limit = { has_special_project = ag_find_ancient_eta_gateway_guardian_weakness } abort_special_project = { type = ag_find_ancient_eta_gateway_guardian_weakness } }
				if = { limit = { has_modifier = "ag_ancient_eta_gateway_guardian_weakness" } remove_modifier = "ag_ancient_eta_gateway_guardian_weakness" }
				if = { limit = { has_modifier = "ag_eta_titan_anti_cloaking" } remove_modifier = "ag_eta_titan_anti_cloaking" }
				if = { limit = { has_point_of_interest = { poi = ag_eta_titan_symbol_1_poi } } remove_point_of_interest = ag_eta_titan_symbol_1_poi }
				if = { limit = { has_point_of_interest = { poi = ag_eta_titan_symbol_2_poi } } remove_point_of_interest = ag_eta_titan_symbol_2_poi }
				if = { limit = { has_point_of_interest = { poi = ag_eta_titan_symbol_3_poi } } remove_point_of_interest = ag_eta_titan_symbol_3_poi }
				if = { limit = { has_point_of_interest = { poi = ag_eta_titan_symbol_4_poi } } remove_point_of_interest = ag_eta_titan_symbol_4_poi }
				if = { limit = { has_event_chain = "ag_eta_titan_data_chain" } end_event_chain = "ag_eta_titan_data_chain" }
			}
			country_event = { id = ag_eta.119 days = 1 }
		}
		else = {
			# Failed
			set_global_flag = ag_eta_gateway_is_hostile
			if = {
				limit = { NOT = { exists = event_target:ag_ancient_eta_gateway_guardian } }
				ag_create_ancient_guardian = {
					ag_country_name = "NAME_ag_eta_gateway_guardian_alt"
					ag_country_type = ag_ancient_eta_gateway_guardian
				}
				last_created_country = {
					set_country_flag = ag_ancient_eta_gateway_guardian
					save_global_event_target_as = ag_ancient_eta_gateway_guardian
					ag_ancient_country_friendly_to_each_other = yes
					every_country = {
						limit = { NOR = { is_same_value = prev has_communications = prev } }
						establish_communications_no_message = prev
					}
				}
			}
			event_target:ag_ancient_eta_star.solar_system = { random_system_megastructure = {
				limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_burst }
				ag_eta_gateway_hostile_spawn = yes
				ag_eta_drones_spawn = yes
				random_list = { 25 = { ag_eta_drones_spawn = yes } 75 = { } }
				remove_megastructure = this
			} }
			from = {
				if = { limit = { has_country_flag = ag_eta_117_fired } country_event = { id = ag_eta.111 } }
				else_if = { limit = { is_variable_set = ag_eta_gateway_unlock_failed check_variable = { which = ag_eta_gateway_unlock_failed value > 3 } } country_event = { id = ag_eta.117 } }
				else_if = {
					limit = { always = yes }
					reroll_random = yes
					random_list = {
						60 = {
							modifier = { add = -10 has_country_flag = ag_eta_114_fired }
							modifier = { add = -10 has_country_flag = ag_eta_115_fired }
							modifier = { add = -10 has_country_flag = ag_eta_116_fired }
							modifier = { add = -10 check_variable = { which = ag_eta_gateway_unlock_failed value > 0 } }
							modifier = { add = -10 check_variable = { which = ag_eta_gateway_unlock_failed value > 1 } }
							modifier = { add = -5 check_variable = { which = ag_eta_gateway_unlock_failed value > 2 } }
							country_event = { id = ag_eta.111 }
							if = {
								limit = {
									has_country_flag = ag_eta_114_fired
									has_country_flag = ag_eta_115_fired
									has_country_flag = ag_eta_116_fired
								}
								change_variable = { which = ag_eta_gateway_unlock_failed value = 1 }
							}
						}
						10 = { modifier = { factor = 0 has_country_flag = ag_eta_114_fired } country_event = { id = ag_eta.114 } }
						10 = { modifier = { factor = 0 has_country_flag = ag_eta_115_fired } country_event = { id = ag_eta.115 } }
						10 = { modifier = { factor = 0 has_country_flag = ag_eta_116_fired } country_event = { id = ag_eta.116 } }
						30 = {
							modifier = {
								factor = 0
								OR = {
									has_country_flag = ag_eta_117_fired
									NAND = {
										has_country_flag = ag_eta_114_fired
										has_country_flag = ag_eta_115_fired
										has_country_flag = ag_eta_116_fired
									}
								}
							}
							country_event = { id = ag_eta.117 }
						}
					}
				}
			}
		}
	}
	after = { remove_global_flag = ag_eta_symbol_checking clear_variable = ag_eta_symbols_check_result }
}

# Notification for testing codes
country_event = {
	id = ag_eta.107
	title = "ag_eta.107.name"
	desc = "ag_eta.107.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_star_pulsar_room }
	show_sound = event_yellow_alert
	location = capital_scope
	is_triggered_only = yes
	immediate = { set_country_flag = ag_eta_gateway_control_test_available }
	option = {
		name = "ag_eta.107.a"
		if = {
			limit = { NOT = { has_event_chain = "ag_eta_titan_data_chain" } }
			begin_event_chain = { event_chain = "ag_eta_titan_data_chain" target = root }
		}
		ag_add_research_option = { ag_tech = tech_ag_eta_titan_measurer }
	}
}

# Notification for testing codes
country_event = {
	id = ag_eta.108
	title = "ag_eta.108.name"
	desc = "ag_eta.108.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_star_pulsar_room }
	show_sound = event_yellow_alert
	location = event_target:ag_ancient_eta_star
	is_triggered_only = yes
	option = { name = "ag_eta.108.a" }
}

# Noti: Success, ancient ship becomes destructable, unlocks ringworld for reward
country_event = {
	id = ag_eta.109
	title = "ag_eta.109.name"
	desc = "ag_eta.109.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_ancient_eta_star
	is_triggered_only = yes
	option = {
		name = "ag_eta.109.a"
		custom_tooltip = "ag_eta.109.a.tooltip"
		ag_eta_stage_ended_chain_swap = yes
	}
}
country_event = {
	id = ag_eta.110
	title = "ag_eta.110.name"
	desc = "ag_eta.110.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_ancient_eta_star
	is_triggered_only = yes
	option = {
		name = "ag_eta.110.a"
		custom_tooltip = "ag_eta.109.a.tooltip"
		ag_eta_stage_ended_chain_swap = yes
	}
}

# Noti: Failed, ancient gateway turn into hostile
country_event = {
	id = ag_eta.111
	title = "ag_eta.111.name"
	desc = "ag_eta.111.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_fleet_evil_room }
	show_sound = event_red_alert
	location = event_target:ag_ancient_eta_star
	is_triggered_only = yes
	option = { name = "ag_eta.111.a" }
}

# ag_on_disabled_event, Ancient gateway disabled, allows to input codes again
ship_event = {
	id = ag_eta.112
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ship_size = ag_eta_gateway_hostile_alt }
	immediate = {
		remove_global_flag = ag_eta_gateway_is_hostile
		solar_system = { spawn_megastructure = {
			type = ag_ancient_eta_gateway_megastructure_burst
			coords_from = root
			init_effect = { if = {
				limit = { root.solar_system = { exists = space_owner } }
				set_owner = root.solar_system.space_owner
			} }
		} }
		from.owner = { country_event = { id = ag_eta.113 } }
		delete_ship = this
		fleet = { delete_fleet = { target = this kill_leader = yes destroy_template = yes } }
	}
}

# Notification: Ancient gateway disabled, allows to input codes again
country_event = {
	id = ag_eta.113
	title = "ag_eta.113.name"
	desc = "ag_eta.113.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_space_battle
	location = fromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.113.a" }
}

# Noti: Failed, ancient gateway turn into hostile, give clues
country_event = {
	id = ag_eta.114
	title = "ag_eta.114.name"
	desc = "ag_eta.114.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_fleet_evil_room }
	show_sound = event_red_alert
	location = event_target:ag_ancient_eta_star
	is_triggered_only = yes
	immediate = { set_country_flag = ag_eta_114_fired }
	option = { name = "ag_eta.114.a" }
}
country_event = {
	id = ag_eta.115
	title = "ag_eta.115.name"
	desc = "ag_eta.115.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_fleet_evil_room }
	show_sound = event_red_alert
	location = event_target:ag_ancient_eta_star
	is_triggered_only = yes
	immediate = { set_country_flag = ag_eta_115_fired }
	option = { name = "ag_eta.115.a" }
}
country_event = {
	id = ag_eta.116
	title = "ag_eta.116.name"
	desc = "ag_eta.116.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_fleet_evil_room }
	show_sound = event_red_alert
	location = event_target:ag_ancient_eta_star
	is_triggered_only = yes
	immediate = { set_country_flag = ag_eta_116_fired }
	option = { name = "ag_eta.116.a" }
}
country_event = {
	id = ag_eta.117
	title = "ag_eta.117.name"
	desc = "ag_eta.117.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_fleet_evil_room }
	show_sound = event_red_alert
	location = event_target:ag_ancient_eta_star
	is_triggered_only = yes
	immediate = { set_country_flag = ag_eta_117_fired }
	option = {
		name = "ag_eta.117.a"
		event_target:ag_ancient_eta_star = { enable_special_project = {
			name = "ag_eta_gateway_event_overwrite_project"
			location = this
			owner = root
		} }
	}
	option = {
		name = "ag_eta.117.b"
		add_resource = { influence = @ag_end_event_influence_medium }
	}
}
country_event = {
	id = ag_eta.118
	title = "ag_eta.118.name"
	desc = "ag_eta.118.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_star_pulsar_room }
	show_sound = event_yellow_alert
	location = event_target:ag_ancient_eta_star
	is_triggered_only = yes
	option = { name = "ag_eta.118.a" }
}
country_event = {
	id = ag_eta.119
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = { every_country = {
		limit = { has_special_project = "ag_eta_gateway_event_overwrite_project" }
		abort_special_project = { type = "ag_eta_gateway_event_overwrite_project" }
	} }
}
country_event = {
	id = ag_eta.120
	title = "ag_eta.120.name"
	desc = "ag_eta.120.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_yellow_alert
	location = event_target:ag_ancient_eta_star
	is_triggered_only = yes
	option = { name = "ag_eta.120.a" }
}

# on_ship_destroyed_victim, Give eta ship's weakness research project if player lost too many ships
country_event = {
	id = ag_eta.121
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			OR = {
				is_country_type = ag_ancient_eta_guardian
				is_country_type = ag_ancient_eta_guardian_passive
			}
			has_country_flag = ag_ancient_eta_guardian
		}
		is_ai = no
		NOR = {
			has_global_flag = ag_eta_titan_destroyed
			has_country_flag = ag_has_ancient_eta_titan_weakness
		}
	}
	
	immediate = {
		if = {
			limit = { check_variable = { which = ag_ancient_eta_titan_guardian_killcount value < 1 } }
			set_variable = { which = ag_ancient_eta_titan_guardian_killcount value = 1 }
		}
		fromfrom = { root = { ag_hostile_kill_counter = { ag_variable_name = ag_ancient_eta_titan_guardian_killcount } } }
		if = {
			limit = {
				check_variable = { which = ag_ancient_eta_titan_guardian_killcount value > 512 }
				NOR = {
					has_global_flag = ag_eta_titan_destroyed
					has_country_flag = ag_has_ancient_eta_titan_weakness
				}
			}
			set_variable = { which = ag_ancient_eta_titan_guardian_killcount value = 512 }
			random_list = {
				25 = {
					country_event = { id = ag_eta.122 days = 30 random = 30 }
					set_country_flag = ag_has_ancient_eta_titan_weakness
				}
				75 = { }
			}
		}
	}
}
country_event = {
	id = ag_eta.122
	title = "ag_eta.122.name"
	desc = "ag_eta.122.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes

	trigger = { NOT = { has_global_flag = ag_eta_titan_destroyed } }
	
	option = {
		name = "ag_eta.122.a"
		enable_special_project = {
			name = "ag_find_ancient_eta_titan_weakness"
			location = capital_scope
			owner = root
		}
	}
	option = {
		name = "ag_eta.122.b"
		add_resource = { influence = @ag_end_event_influence_large }
	}
}
country_event = {
	id = ag_eta.123
	title = "ag_eta.123.name"
	desc = "ag_eta.123.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	
	is_triggered_only = yes

	option = {
		name = "ag_eta.123.a"
		if = {
			limit = { NOT = { has_modifier = "ag_ancient_eta_titan_weakness" } }
			add_modifier = { modifier = "ag_ancient_eta_titan_weakness" days = -1 }
		}
	}
}

# on_ship_destroyed_victim, Give gateway guardian's weakness research project if player lost too many ships
country_event = {
	id = ag_eta.124
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			is_country_type = ag_ancient_eta_gateway_guardian
			has_country_flag = ag_ancient_eta_gateway_guardian
		}
		is_ai = no
		NOR = {
			has_global_flag = ag_eta_titan_event_ended
			has_country_flag = ag_has_ancient_eta_gateway_guardian_weakness
		}
	}
	
	immediate = {
		if = {
			limit = { check_variable = { which = ag_ancient_eta_gateway_guardian_killcount value < 1 } }
			set_variable = { which = ag_ancient_eta_gateway_guardian_killcount value = 1 }
		}
		fromfrom = { root = { ag_hostile_kill_counter = { ag_variable_name = ag_ancient_eta_gateway_guardian_killcount } } }
		if = {
			limit = {
				check_variable = { which = ag_ancient_eta_gateway_guardian_killcount value > 512 }
				NOR = {
					has_global_flag = ag_eta_titan_destroyed
					has_country_flag = ag_has_ancient_eta_gateway_guardian_weakness
				}
			}
			set_variable = { which = ag_ancient_eta_gateway_guardian_killcount value = 512 }
			random_list = {
				25 = {
					country_event = { id = ag_eta.125 days = 30 random = 30 }
					set_country_flag = ag_has_ancient_eta_gateway_guardian_weakness
				}
				75 = { }
			}
		}
	}
}
country_event = {
	id = ag_eta.125
	title = "ag_eta.125.name"
	desc = "ag_eta.125.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes

	trigger = { NOT = { has_global_flag = ag_eta_titan_event_ended } }
	
	option = {
		name = "ag_eta.125.a"
		enable_special_project = {
			name = "ag_find_ancient_eta_gateway_guardian_weakness"
			location = capital_scope
			owner = root
		}
	}
	option = {
		name = "ag_eta.125.b"
		add_resource = { influence = @ag_end_event_influence_large }
	}
}
country_event = {
	id = ag_eta.126
	title = "ag_eta.126.name"
	desc = "ag_eta.126.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	
	is_triggered_only = yes

	option = {
		name = "ag_eta.126.a"
		if = {
			limit = { NOT = { has_modifier = "ag_ancient_eta_gateway_guardian_weakness" } }
			add_modifier = { modifier = "ag_ancient_eta_gateway_guardian_weakness" days = -1 }
		}
	}
}

# Noti at the ending of skip puzzle.
ship_event = {
	id = ag_eta.127
	title = "ag_eta.127.name"
	desc = "ag_eta.127.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_decryption_room }
	show_sound = event_yellow_alert
	location = root
	is_triggered_only = yes
	option = { name = "ag_eta.127.a" }
}

# Notifications:
# Destroyed ancient ship, give capture project.
country_event = {
	id = ag_eta.131
	title = "ag_eta.131.name"
	desc = "ag_eta.131.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_space_battle
	is_triggered_only = yes
	option = {
		name = "ag_eta.131.a"
		from = { enable_special_project = { name = ag_capture_eta_titan location = this owner = root } }
	}
	option = {
		name = "ag_eta.131.b"
		add_resource = {
			sr_living_metal = 8000
			nanites = 4500
			sr_dark_matter = 500
			minor_artifacts = 25
		}
		locked_random_list = {
			80 = { }
			20 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_ag_ship_hull_upgrade
						has_tech_option = tech_ag_ship_hull_upgrade
					}
				}
				ag_add_research_option = { ag_tech = tech_ag_ship_hull_upgrade }
			}
		}
	}
}
# Successfully capture ancient ship.
ship_event = {
	id = ag_eta.132
	title = "ag_eta.132.name"
	desc = "ag_eta.132.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_dyson_sphere_build_complete
	is_triggered_only = yes
	option = {
		name = "ag_eta.132.a"
		custom_tooltip = "ag_eta.132.a.tooltip"
		hidden_effect = { ag_eta_titan_player_spawn = {
			ag_unlock_ship = no
			ag_owner = root.owner
			ag_location = root
		} }
	}
}
# Failed to capture ancient ship.
ship_event = {
	id = ag_eta.133
	title = "ag_eta.133.name"
	desc = "ag_eta.133.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_debris_room }
	show_sound = event_yellow_alert
	is_triggered_only = yes
	option = {
		name = "ag_eta.133.a"
		owner = { add_resource = {
			sr_living_metal = 6000
			nanites = 3500
			sr_dark_matter = 300
			minor_artifacts = 15
		} }
	}
}
# Destroyed ancient ship.
country_event = {
	id = ag_eta.134
	title = "ag_eta.134.name"
	desc = "ag_eta.134.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_space_battle
	is_triggered_only = yes
	option = { name = "ag_eta.134.a" }
}
# Destroyed ancient ship, for others.
country_event = {
	id = ag_eta.135
	title = "ag_eta.135.name"
	desc = "ag_eta.135.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = { name = "ag_eta.135.a" }
}
# Captured ancient ship, for other.
country_event = {
	id = ag_eta.136
	title = "ag_eta.136.name"
	desc = "ag_eta.136.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = { name = "ag_eta.136.a" }
}
# Destroyed all ancient ships.
country_event = {
	id = ag_eta.137
	title = "ag_eta.137.name"
	desc = "ag_eta.137.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_sensor_ping
	is_triggered_only = yes
	option = { name = "ag_eta.137.a" }
}

# Unlock ringworld after event ended.
country_event = {
	id = ag_eta.141
	title = "ag_eta.141.name"
	desc = "ag_eta.141.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ringworld_room }
	show_sound = event_sensor_ping
	
	mean_time_to_happen = { months = 8 modifier = { factor = 0.5 has_global_flag = ag_eta_titan_destroyed } }

	trigger = {
		is_ai = no
		has_global_flag = ag_eta_titan_event_ended
		NOR = {
			has_global_flag = ag_eta_ringworld_unlocked
			has_country_flag = ag_eta_141_fired
		}
		exists = event_target:ag_ancient_eta_star
		event_target:ag_ancient_eta_star.solar_system = { exists = space_owner }
		is_same_value = event_target:ag_ancient_eta_star.solar_system.space_owner
	}
	immediate = { set_country_flag = ag_eta_141_fired }

	option = {
		name = "ag_eta.141.a"
		event_target:ag_ancient_eta_shielded_world = {
			enable_special_project = {
				name = "ag_unlock_eta_ringworld"
				location = this
				owner = root
			}
		}
	}
	option = {
		name = "ag_eta.141.b"
		add_resource = { influence = @ag_end_event_influence_large }
	}
}

# Finished special project, unlock ringworld.
ship_event = {
	id = ag_eta.142
	title = "ag_eta.142.name"
	desc = "ag_eta.142.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_desert_planet_room }
	show_sound = event_mystic_reveal
	location = root

	is_triggered_only = yes

	immediate = {
		set_global_flag = ag_eta_ringworld_unlocked
		event_target:ag_ancient_eta_shielded_world = {
			ag_change_pc = { ag_planet_class = pc_ag_ringworld_desert }
			ag_set_ancient_ringworld = {
				ag_picture = pc_ag_ringworld_desert
				ag_color = red
				ag_type = habitable
				ag_surface_type = desert_01
				ag_generate_ruins = yes
			}
			add_deposit = ag_ancient_city_ruins_1
			add_deposit = ag_ancient_city_ruins_2
			add_deposit = ag_ancient_city_ruins_3
			add_deposit = ag_ancient_city_ruins_4
			add_deposit = ag_ancient_city_ruins_4
			add_deposit = ag_ancient_city_ruins_5
			add_deposit = ag_ancient_city_ruins_5
			add_deposit = ag_ancient_city_ruins_5
			add_deposit = ag_ancient_city_ruins_5
		}
	}

	after = { every_country = {
		limit = { has_special_project = "ag_unlock_eta_ringworld" NOT = { is_same_value = root.owner } }
		abort_special_project = { type = "ag_unlock_eta_ringworld" }
	} }

	option = { name = "ag_eta.142.a" }
	option = { name = "ag_eta.142.b" trigger = { owner = { OR = { has_ethic = ethic_xenophile has_ethic = ethic_fanatic_xenophile } } } }
	option = { name = "ag_eta.142.c" trigger = { owner = { OR = { has_ethic = ethic_xenophobe has_ethic = ethic_fanatic_xenophobe } } } }
}

# on_colonized, Colonized Eta Area's ringworld
planet_event = {
	id = ag_eta.143
	title = "ag_eta.143.name"
	desc = "ag_eta.143.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_street_room }
	location = root
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = { is_same_value = event_target:ag_ancient_eta_shielded_world }
	
	option = { name = "ag_eta.143.a" }
}

# on_blocker_cleared, Clear blocker, add buildings
planet_event = {
	id = ag_eta.144
	title = "ag_eta.144.name"
	desc = "ag_eta.144.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_street_room }
	location = root
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		is_same_value = event_target:ag_ancient_eta_shielded_world
		from = { is_deposit_type = ag_ancient_city_ruins_1 }
	}
	
	option = {
		name = "ag_eta.144.a"
		if = { limit = { NOT = { has_building = ag_ancient_eta_monument } } add_building = ag_ancient_eta_monument }
	}
	option = {
		name = "ag_eta.144.b"
		owner = { add_resource = { minerals = 200 alloys = 200 minor_artifacts = 5 } }
	}
}
planet_event = {
	id = ag_eta.145
	title = "ag_eta.144.name"
	desc = "ag_eta.144.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_street_room }
	location = root
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		is_same_value = event_target:ag_ancient_eta_shielded_world
		from = { is_deposit_type = ag_ancient_city_ruins_2 }
	}
	
	option = {
		name = "ag_eta.144.a"
		if = { limit = { NOT = { has_building = ag_ancient_eta_archive } } add_building = ag_ancient_eta_archive }
	}
	option = {
		name = "ag_eta.144.b"
		owner = { add_resource = { minerals = 200 alloys = 200 minor_artifacts = 5 } }
	}
}
planet_event = {
	id = ag_eta.146
	title = "ag_eta.144.name"
	desc = "ag_eta.144.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_relic_world_street_room }
	location = root
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		is_same_value = event_target:ag_ancient_eta_shielded_world
		from = { is_deposit_type = ag_ancient_city_ruins_3 }
	}
	
	option = {
		name = "ag_eta.144.a"
		if = { limit = { NOT = { has_building = ag_ancient_eta_adm_building } } add_building = ag_ancient_eta_adm_building }
	}
	option = {
		name = "ag_eta.144.b"
		owner = { add_resource = { minerals = 200 alloys = 200 minor_artifacts = 5 } }
	}
}

# Reward: Ancient Ship
country_event = {
	id = ag_eta.151
	title = "ag_eta.151.name"
	desc = "ag_eta.151.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_finding_loot
	location = event_target:ag_ancient_eta_shielded_world
	is_triggered_only = yes
	
	option = {
		name = "ag_eta.151.a"
		ag_add_research_option = { ag_tech = tech_ag_eta_titan }
	}
}

# Reward: Ancient Gateways
country_event = {
	id = ag_eta.152
	title = "ag_eta.152.name"
	desc = {
		trigger = { event_target:ag_ancient_eta_shielded_world = { has_building = ag_ancient_eta_adm_building } }
		text = "ag_eta.152.a.desc"
	}
	desc = {
		trigger = { event_target:ag_ancient_eta_shielded_world = { NOT = { has_building = ag_ancient_eta_adm_building } } }
		text = "ag_eta.152.b.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_finding_loot
	location = event_target:ag_ancient_eta_shielded_world
	is_triggered_only = yes
	
	option = {
		name = "ag_eta.152.a"
		ag_add_research_option = { ag_tech = tech_ag_ancient_eta_gateway }
	}
}

# Construction Sections
country_event = {
	id = ag_eta.153
	title = "ag_eta.153.name"
	desc = {
		trigger = { NOT = { has_country_flag = ag_known_construction_section } }
		text = "ag_eta.153.a.desc"
	}
	desc = {
		trigger = { has_country_flag = ag_known_construction_section }
		text = "ag_eta.153.b.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ringworld_room }
	show_sound = event_finding_loot
	location = event_target:ag_ancient_eta_shielded_world
	is_triggered_only = yes
	
	immediate = {
		event_target:ag_ancient_eta_shielded_world = { solar_system = { random_system_planet = {
			limit = { has_planet_flag = ag_ancient_construction_section_0 }
			save_event_target_as = ag_ancient_construction_section_loc
		} } }
	}
	
	option = {
		name = "ag_eta.153.a"
		enable_special_project = {
			name = "ag_eta_construction_section"
			location = event_target:ag_ancient_construction_section_loc
			owner = root
		}
		ai_chance = { factor = 1000 }
	}
	option = {
		name = "ag_eta.153.b"
		add_resource = { influence = @ag_end_event_influence_medium }
		ai_chance = { factor = 0 }
	}
}

# Successfully unlocked Construction Sections
country_event = {
	id = ag_eta.154
	title = "ag_eta.154.name"
	desc = "ag_eta.154.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ringworld_room }
	show_sound = event_think_tank_build_complete
	location = from
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = ag_eta_construction_section_unlocked
		set_country_flag = ag_known_construction_section
		event_target:ag_ancient_eta_shielded_world = { solar_system = { ag_spawn_ancient_construction_section = yes } }
	}
	
	option = { name = "ag_eta.154.a" }
}

# Ancient security system
# country_event = {
	# id = ag_eta.161
	# title = "ag_eta.161.name"
	# desc = "ag_eta.161.desc"
	# diplomatic = yes
	# custom_gui = "ag_ancient_event_window"
	# custom_gui_option = "ag_ancient_event_option"
	# picture_event_data = { room = ag_event_ancient_AI_room }
	# show_sound = event_mystic_reveal
	
	# mean_time_to_happen = {
		# years = 5
		# modifier = { factor = 0.5 has_country_flag = ag_has_ancient_code }
	# }
	
	# trigger = {
		# NOR = {
			# has_country_flag = ag_eta_ships_unlocked
			# has_country_flag = ag_eta_161_fired
		# }
		# OR = {
			# any_controlled_ship = { OR = {
				# is_ship_size = ag_eta_titan_0
				# is_ship_size = ag_eta_gateway_0
			# } }
			# any_owned_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_1 }
		# }
		# any_owned_planet = {
			# is_same_value = event_target:ag_ancient_eta_shielded_world
			# has_building = ag_ancient_eta_archive
		# }
	# }
	
	# immediate = { set_country_flag = ag_eta_161_fired }
	
	# option = {
		# name = "ag_eta.161.a"
		# custom_tooltip = "ag_eta.161.a.tooltip"
		# hidden_effect = {
			# ag_give_research_project = { ag_project_id = @ag_eta_ship_unlock_project_id }
			# if = { limit = { is_ai = yes } country_event = { id = ag_eta.152 days = 1800 } }
		# }
		# ai_chance = { factor = 1000 }
	# }
	# option = {
		# name = "ag_eta.161.b"
		# add_resource = { influence = @ag_end_event_influence_medium }
		# ai_chance = { factor = 0 }
	# }
# }
country_event = {
	id = ag_eta.162
	title = "ag_eta.162.name"
	desc = "ag_eta.162.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = ag_has_ancient_code
		country_event = { id = ag_eta.163 days = 5 random = 55 }
	}
	
	option = { name = "ag_eta.162.a" }
}

# Upgrade ships(Hidden)
country_event = {
    id = ag_eta.163
    hide_window = yes
	is_triggered_only = yes
	
	trigger = { has_country_flag = ag_eta_ships_unlocked }
	
	immediate = {
		set_country_flag = ag_eta_163_fired
		if = {
			limit = { ag_has_ship_design = { ag_design = ag_eta_gateway_0 } }
			ag_add_ship_design = { ag_design = ag_eta_gateway_1 }
		}
		ag_remove_ship_design = { ag_design = ag_eta_gateway_0 }
		if = {
			limit = { any_controlled_ship = { is_ship_size = ag_eta_titan_0 } }
			while = {
				limit = { any_controlled_ship = { is_ship_size = ag_eta_titan_0 } }
				random_controlled_ship = {
					limit = { is_ship_size = ag_eta_titan_0 }
					ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
					fleet = {
						if = {
							limit = { exists = leader }
							leader = {
								save_global_event_target_as = ag_target_leader_on_fleet
								prev = { save_global_event_target_as = ag_target_fleet_swap }
								unassign_leader = this
							}
						}
						ag_create_eta_titan_player = { ag_unlock_ship = yes ag_owner = root ag_clone_disable_info = yes }
					}
					delete_ship = this
					if = {
						limit = { exists = event_target:ag_target_fleet_swap }
						event_target:ag_target_fleet_swap = {
							assign_leader = event_target:ag_target_leader_on_fleet
						}
						clear_global_event_target = ag_target_fleet_swap
						clear_global_event_target = ag_target_leader_on_fleet
					}
				}
			}
		}
		if = {
			limit = { any_controlled_ship = { is_ship_size = ag_eta_gateway_0 } }
			every_controlled_ship = {
				limit = { is_ship_size = ag_eta_gateway_0 }
				ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
				create_fleet = {
					name = "NAME_ag_eta_gateway_fleet"
					settings = {
						can_upgrade = no 
						can_change_composition = no 
						can_change_leader = no 
						spawn_debris = no 
					}
					effect = {
						set_owner = root
						create_ship = {
							name = "NAME_ag_eta_gateway_ship"
							design = "NAME_ag_eta_gateway_1"
							prefix = no
							effect = {
								copy_flags_and_variables_from = prevprev
								ag_difficulty_bonus = yes
							}
						}
						set_location = { target = prev.fleet distance = -1 angle = 0 }
					}
				}
				delete_ship = this
			}
		}
		if = {
			limit = { any_owned_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_1 } }
			every_owned_megastructure = {
				limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_1 }
				ag_eta_upgrade_gateway_frame = { ag_target_level = 2 }
			}
		}
	}
}

# Build first ancient gateway, give research project.
country_event = {
	id = ag_eta.170
	title = "ag_eta.171.name"
	desc = "ag_eta.171.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		is_ai = no
		has_technology = tech_ag_ancient_eta_gateway
		NOT = { has_country_flag = ag_eta_171_fired }
		OR = {
			any_owned_megastructure = { OR = {
				is_megastructure_type = ag_ancient_eta_gateway_megastructure_0
				is_megastructure_type = ag_ancient_eta_gateway_megastructure_1
				is_megastructure_type = ag_ancient_eta_gateway_megastructure_2
				is_megastructure_type = ag_ancient_eta_gateway_megastructure_3
				is_megastructure_type = ag_ancient_eta_gateway_megastructure_4
				is_megastructure_type = ag_ancient_eta_gateway_megastructure_5
				is_megastructure_type = ag_ancient_eta_gateway_megastructure_opening
				is_megastructure_type = ag_ancient_eta_gateway_megastructure_closing
				is_megastructure_type = ag_ancient_eta_gateway_megastructure_opening_blue
				is_megastructure_type = ag_ancient_eta_gateway_megastructure_closed_alt
				is_megastructure_type = ag_ancient_eta_gateway_megastructure_damaged_alt
			} }
			any_controlled_ship = { OR = {
				is_ship_size = ag_eta_gateway_0
				is_ship_size = ag_eta_gateway_1
			} }
		}
	}
	immediate = { set_country_flag = ag_eta_171_fired }
	option = {
		name = "ag_eta.171.a"
		custom_tooltip = "ag_eta.171.a.tooltip"
		hidden_effect = { ag_give_research_project = { ag_project_id = @ag_eta_gateway_project_id } }
	}
	option = { name = "ag_eta.171.b" add_resource = { influence = @ag_end_event_influence_medium } }
}
ship_event = {
	id = ag_eta.171
	title = "ag_eta.171.name"
	desc = "ag_eta.171.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes

	trigger = {
		OR = {
			is_ship_size = ag_eta_gateway_0
			is_ship_size = ag_eta_gateway_1
		}
		owner = { NOT = { has_country_flag = ag_eta_171_fired } }
	}
	
	immediate = {
		owner = { set_country_flag = ag_eta_171_fired }
	}
	
	option = {
		name = "ag_eta.171.a"
		custom_tooltip = "ag_eta.171.a.tooltip"
		hidden_effect = { owner = { ag_give_research_project = { ag_project_id = @ag_eta_gateway_project_id } } }
	}
	option = { name = "ag_eta.171.b" owner = { add_resource = { influence = @ag_end_event_influence_medium } } }
}
country_event = {
	id = ag_eta.172
	title = "ag_eta.172.name"
	desc = "ag_eta.172.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	immediate = { set_country_flag = ag_eta_gateway_research_completed }
	
	option = { name = "ag_eta.172.a" }
}

# Situation events.
country_event = {
	id = ag_eta.180
	title = "ag_eta.180.name"
	desc = "ag_eta.180.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	trigger = {
		NOT = { has_country_flag = ag_eta_situation_started }
		has_global_flag = ag_eta_titan_event_ended
		exists = event_target:ag_ancient_eta_shielded_world
		event_target:ag_ancient_eta_shielded_world = {
			exists = owner
			owner = { is_same_value = root }
			has_building = ag_ancient_eta_archive
			has_ground_combat = no
			ag_has_researcher = yes
		}
	}
	immediate = { set_country_flag = ag_eta_situation_started }
	option = {
		name = "ag_eta.180.a"
		start_situation = { type = "ag_eta_situation" target = event_target:ag_ancient_eta_shielded_world }
	}
}
country_event = {
	id = ag_eta.181
	title = "ag_eta.181.name"
	desc = "ag_eta.181.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_laboratory_sound
	location = event_target:ag_ancient_eta_shielded_world
	is_triggered_only = yes
	option = {
		name = "ag_eta.181.a"
		hidden_effect = { country_event = { id = ag_eta.151 days = 15 random = 15 } }
	}
}
country_event = {
	id = ag_eta.182
	title = "ag_eta.182.name"
	desc = "ag_eta.182.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_laboratory_sound
	location = event_target:ag_ancient_eta_shielded_world
	is_triggered_only = yes
	option = {
		name = "ag_eta.182.a"
		hidden_effect = { country_event = { id = ag_eta.152 days = 15 random = 15 } }
	}
}
country_event = {
	id = ag_eta.183
	title = "ag_eta.183.name"
	desc = "ag_eta.183.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_archaeological_dig_room }
	show_sound = event_laboratory_sound
	location = event_target:ag_ancient_eta_shielded_world
	is_triggered_only = yes
	immediate = {
		random_list = {
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 1 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 1.25 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 1.5 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 1.75 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 2 } }
		}
		reroll_random = yes
		random_list = {
			10 = { change_variable = { which = ag_ancient_knowledge_common_var value = 0.25 } }
			10 = { change_variable = { which = ag_ancient_knowledge_common_var value = 0.125 } }
			10 = { subtract_variable = { which = ag_ancient_knowledge_common_var value = 0.25 } }
			10 = { subtract_variable = { which = ag_ancient_knowledge_common_var value = 0.125 } }
			10 = { }
		}
		reroll_random = yes
	}
	after = { hidden_effect = { set_variable = { which = ag_ancient_knowledge_common_var value = 0 } } }
	option = {
		name = "ag_eta.183.a"
		ag_add_ancient_knowledge = {
			ag_value = ag_ancient_knowledge_common_var
			ag_notification_desc = ""
		}
	}
	option = {
		name = "ag_eta.183.b"
		ag_add_ancient_knowledge = {
			ag_value = ag_ancient_knowledge_common_var
			ag_notification_desc = ""
		}
		event_target:ag_ancient_eta_shielded_world = { if = { limit = { has_building = ag_ancient_eta_monument } remove_building = ag_ancient_eta_monument } }
	}
}
country_event = {
	id = ag_eta.184
	title = "ag_eta.184.name"
	desc = "ag_eta.184.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	immediate = {
		random_list = {
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 1 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 1.5 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 2 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 2.5 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 3 } }
		}
		reroll_random = yes
		random_list = {
			10 = { change_variable = { which = ag_ancient_knowledge_common_var value = 0.25 } }
			10 = { change_variable = { which = ag_ancient_knowledge_common_var value = 0.125 } }
			10 = { subtract_variable = { which = ag_ancient_knowledge_common_var value = 0.25 } }
			10 = { subtract_variable = { which = ag_ancient_knowledge_common_var value = 0.125 } }
			10 = { }
		}
		reroll_random = yes
	}
	after = { hidden_effect = {
		# clear_variable = ag_ancient_knowledge_common_var
		destroy_situation = from
	} }
	option = { name = "ag_eta.184.a" ag_add_ancient_knowledge = { ag_value = ag_ancient_knowledge_common_var ag_notification_desc = "" } }
}

# on_starbase_destroyed, Destroy starbase, create new starbase
starbase_event = {
	id = ag_eta.190
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		from.owner = { has_country_flag = ag_ancient_eta_guardian }
		NOT = { solar_system = { any_system_planet = { is_colony = yes } } }
	}
	immediate = { solar_system = { system_event = { id = ag_eta.191 days = 2 } } }
}
system_event = {
	id = ag_eta.191
	hide_window = yes
	is_triggered_only = yes
	immediate = { ag_create_eta_titan_starbase = yes }
}

###############################################
### 			Gateway Events
###############################################

# Notifications.
country_event = {
	id = ag_eta.1001
	title = "ag_eta.1001.name"
	desc = "ag_eta.1001.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_ringworld_build_start
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1001.a" }
}
# Build ancient gateway frame
ship_event = {
	id = ag_eta.1002
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		owner = { NOT = { has_country_flag = ag_eta_gateway_built } }
		OR = {
			is_ship_size = ag_eta_gateway_0
			is_ship_size = ag_eta_gateway_1
		}
	}
	immediate = { owner = {
		set_country_flag = ag_eta_gateway_built
		country_event = { id = ag_eta.1001 }
	} }
}
country_event = {
	id = ag_eta.1003
	title = "ag_eta.1003.name"
	desc = "ag_eta.1003.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_complete
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1003.a" }
}
country_event = {
	id = ag_eta.1004
	title = "ag_eta.1004.name"
	desc = "ag_eta.1004.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_complete
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1004.a" }
}
country_event = {
	id = ag_eta.1005
	title = "ag_eta.1005.name"
	desc = "ag_eta.1005.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_ringworld_build_start
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1005.a" }
}
country_event = {
	id = ag_eta.1006
	title = "ag_eta.1006.name"
	desc = "ag_eta.1006.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_upgrade_frame
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1006.a" }
}
country_event = {
	id = ag_eta.1007
	title = "ag_eta.1007.name"
	desc = "ag_eta.1007.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_upgrade_frame
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1007.a" }
}
country_event = {
	id = ag_eta.1008
	title = "ag_eta.1008.name"
	desc = "ag_eta.1008.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_complete
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1008.a" }
}
country_event = {
	id = ag_eta.1009
	title = "ag_eta.1009.name"
	desc = "ag_eta.1009.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_mega_structure_other_empire_build_complete
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1009.a" }
}
country_event = {
	id = ag_eta.1010
	title = "ag_eta.1010.name"
	desc = "ag_eta.1010.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_mega_structure_other_empire_build_complete
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1010.a" }
}

# on_megastructure_change_owner, Gateway closed when change owner.
country_event = {
	id = ag_eta.1011
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = fromfrom
		fromfrom = {
			exists = event_target:ag_eta_gateway_controller
			is_same_value = event_target:ag_eta_gateway_controller
			has_country_flag = ag_ancient_eta_gateway_close_when_change_owner
		}
		from = { OR = {
			is_megastructure_type = ag_ancient_eta_gateway_megastructure_1
			is_megastructure_type = ag_ancient_eta_gateway_megastructure_2
			is_megastructure_type = ag_ancient_eta_gateway_megastructure_3
			is_megastructure_type = ag_ancient_eta_gateway_megastructure_closed_alt
			is_megastructure_type = ag_ancient_eta_gateway_megastructure_damaged_alt
		} }
	}

	immediate = { from = {
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
		ag_eta_remove_all_gateway_portal = yes
		ag_eta_upgrade_gateway_frame = { ag_target_level = closed }
	} }
}

# on_megastructure_ownerless, Gateway closed when ownerless.
system_event = {
	id = ag_eta.1012
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = fromfrom
		fromfrom = {
			exists = event_target:ag_eta_gateway_controller
			is_same_value = event_target:ag_eta_gateway_controller
			has_country_flag = ag_ancient_eta_gateway_close_when_change_owner
		}
		from = { OR = {
			is_megastructure_type = ag_ancient_eta_gateway_megastructure_1
			is_megastructure_type = ag_ancient_eta_gateway_megastructure_2
			is_megastructure_type = ag_ancient_eta_gateway_megastructure_3
			is_megastructure_type = ag_ancient_eta_gateway_megastructure_closed_alt
			is_megastructure_type = ag_ancient_eta_gateway_megastructure_damaged_alt
		} }
	}

	immediate = { from = {
		ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
		ag_eta_remove_all_gateway_portal = yes
		ag_eta_upgrade_gateway_frame = { ag_target_level = closed }
	} }
}

# on_megastructure_change_owner, Gateway owner change with control station.
country_event = {
	id = ag_eta.1013
	title = "ag_eta.1013.name"
	desc = "ag_eta.1013.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes

	trigger = { from = { is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_3 } }

	immediate = {
		if = {
			limit = { exists = fromfrom fromfrom = { is_scope_type = country } }
			fromfrom = {
				country_event = { id = ag_eta.1015 }
				ag_eta_gateway_flags_cleans_up_effect = yes
			}
		}
		save_global_event_target_as = ag_eta_gateway_controller
	}
	
	option = { name = "ag_eta.1013.a" }
}

# on_megastructure_ownerless, Gateway owner change with control station.
system_event = {
	id = ag_eta.1014
	hide_window = yes
	is_triggered_only = yes

	trigger = { exists = fromfrom from = { is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_3 } }

	immediate = { fromfrom = {
		country_event = { id = ag_eta.1015 }
		ag_eta_gateway_flags_cleans_up_effect = yes
	} }
}

# Notification for original owner
country_event = {
	id = ag_eta.1015
	title = "ag_eta.1015.name"
	desc = "ag_eta.1015.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_yellow_alert
	location = fromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1015.a" }
}

# Ancient Gateway settings menu.
country_event = {
	id = ag_eta.1021
	title = "ag_eta.1021.name"
	desc = "ag_eta.1021.desc"
	diplomatic = yes
	custom_gui = "ag_eta_gateway_window"
	custom_gui_option = "ag_eta_gateway_option"
	picture_event_data = {
		room = ag_event_ancient_AI_room
		portrait = root.species
	}
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	trigger = { exists = event_target:ag_eta_gateway_ctrl_target_system }

	immediate = {
		if = {
			limit = { any_megastructure = { is_megastructure_type = lgate_base has_megastructure_flag = lgate_activated } }
			set_country_flag = ag_has_activated_lgate_in_system
		}
		if = {
			limit = {
				event_target:ag_eta_gateway_ctrl_target_system = { any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_wormhole_temporary } }
				NOT = { any_megastructure = {
					is_megastructure_type = ag_ancient_eta_gateway_wormhole_temporary_alt
					has_megastructure_flag = ag_eta_gateway_wormhole_temporary_@event_target:ag_eta_gateway_ctrl_target_system
				} }
			}
			event_target:ag_eta_gateway_ctrl_target_system = {
				every_system_megastructure = {
					limit = { is_megastructure_type = ag_ancient_eta_gateway_wormhole_temporary }
					remove_megastructure = this
				}
			}
		}
	}

	after = { hidden_effect = {
		remove_country_flag = ag_has_activated_lgate_in_system
	} }

	option = {
		name = "ag_eta.1021.d"
		is_dialog_only= yes
		response_text = "ag_eta.1021.desc"
		if = {
			limit = { hidden_trigger = { has_country_flag = ag_eta_gateway_default_settings_enabled } }
			if = {
				limit = { hidden_trigger = { has_country_flag = ag_eta_gateway_galactic_gateway } }
				custom_tooltip = "ag_eta.1021.d.galactic_gateway.true"
			}
			else = { custom_tooltip = "ag_eta.1021.d.galactic_gateway.false" }
			if = {
				limit = { hidden_trigger = { has_country_flag = ag_eta_gateway_lgate } }
				custom_tooltip = "ag_eta.1021.d.lgate.true"
			}
			else = { custom_tooltip = "ag_eta.1021.d.lgate.false" }
			if = {
				limit = { hidden_trigger = { has_country_flag = ag_eta_gateway_ancient_gateway } }
				custom_tooltip = "ag_eta.1021.d.ancient_gateway.true"
			}
			else = { custom_tooltip = "ag_eta.1021.d.ancient_gateway.false" }
		}
		allow = {
			custom_tooltip = {
				fail_text = "ag_eta_gateway_working"
				event_target:ag_eta_gateway_ctrl_target_system = { NOT = { any_system_megastructure = {
					has_megastructure_flag = ag_eta_gateway_working
					OR = {
						is_megastructure_type = ag_ancient_eta_gateway_megastructure_2
						is_megastructure_type = ag_ancient_eta_gateway_megastructure_4
						is_megastructure_type = ag_ancient_eta_gateway_megastructure_opening
						is_megastructure_type = ag_ancient_eta_gateway_megastructure_closing
					}
				} } }
			}
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = ag_eta_gateway_default_settings_enabled } }
				set_country_flag = ag_eta_gateway_default_settings_enabled
			}
			if = {
				limit = {
					exists = event_target:ag_eta_gateway_ctrl_target_system
					event_target:ag_eta_gateway_ctrl_target_system = {
						any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_galactic_gateway }
					}
				}
				set_country_flag = ag_eta_gateway_galactic_gateway
			}
			else = { remove_country_flag = ag_eta_gateway_galactic_gateway }
			if = {
				limit = {
					exists = event_target:ag_eta_gateway_ctrl_target_system
					event_target:ag_eta_gateway_ctrl_target_system = {
						any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_lgate }
					}
				}
				set_country_flag = ag_eta_gateway_lgate
			}
			else = { remove_country_flag = ag_eta_gateway_lgate }
			if = {
				limit = {
					exists = event_target:ag_eta_gateway_ctrl_target_system
					event_target:ag_eta_gateway_ctrl_target_system = {
						any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_ancient_gateway }
					}
				}
				set_country_flag = ag_eta_gateway_ancient_gateway
			}
			else = { remove_country_flag = ag_eta_gateway_ancient_gateway }
		}
	}
	option = {
		name = "ag_eta.1021.a"
		allow = {
			has_technology = tech_ag_ancient_eta_gateway_folds_up
			hidden_trigger = {
				event_target:ag_eta_gateway_ctrl_target_system = { any_system_megastructure = {
					NOT = { has_megastructure_flag = ag_eta_gateway_working }
					OR = {
						is_megastructure_type = ag_ancient_eta_gateway_megastructure_2
						is_megastructure_type = ag_ancient_eta_gateway_megastructure_4
					}
				} }
			}
		}
		hidden_effect = {
			if = {
				limit = { event_target:ag_eta_gateway_ctrl_target_system = { any_system_megastructure = { OR = {
					is_megastructure_type = ag_ancient_eta_gateway_galactic_gateway
					is_megastructure_type = ag_ancient_eta_gateway_lgate
					is_megastructure_type = ag_ancient_eta_gateway_ancient_gateway
					is_megastructure_type = ag_ancient_eta_gateway_wormhole_temporary
				} } } }
				event_target:ag_eta_gateway_ctrl_target_system = {
					every_system_megastructure = {
						limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_2 }
						ag_eta_remove_all_gateway_portal = yes
						set_megastructure_flag = ag_eta_gateway_working
						ag_eta_upgrade_gateway_frame = { ag_target_level = closing }
						solar_system = { system_event = { id = ag_eta.1034 days = @ag_eta_gateway_closing_anim_time } }
						remove_megastructure = this
					}
				}
			}
			else = { event_target:ag_eta_gateway_ctrl_target_system = { system_event = { id = ag_eta.1034 days = @ag_eta_gateway_closing_anim_time } } }
			remove_global_flag = ag_ancient_eta_gateway_menu_opened
			clear_global_event_target = ag_eta_gateway_ctrl_target_system
		}
	}
	option = {
		name = "ag_eta.1021.b"
		locked_random_list = {
			10 = { add_resource = { sr_living_metal = 4500 } }
			10 = { add_resource = { sr_living_metal = 4000 } }
			10 = { add_resource = { sr_living_metal = 3500 } }
			10 = { add_resource = { sr_living_metal = 3000 } }
		}
		locked_random_list = {
			10 = { add_resource = { nanites = 2250 } }
			10 = { add_resource = { nanites = 2000 } }
			10 = { add_resource = { nanites = 1750 } }
			10 = { add_resource = { nanites = 1500 } }
		}
		hidden_effect = {
			event_target:ag_eta_gateway_ctrl_target_system = { random_system_megastructure = {
				limit = { OR = {
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_0
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_1
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_2
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_3
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_4
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_5
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_opening
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_opening_blue
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_closing
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_damaged
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_damaged_alt
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_closed
					is_megastructure_type = ag_ancient_eta_gateway_megastructure_closed_alt
				} }
				ag_eta_remove_all_gateway_portal = yes
				ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
				remove_megastructure = this
			} }
			remove_global_flag = ag_ancient_eta_gateway_menu_opened
			clear_global_event_target = ag_eta_gateway_ctrl_target_system
		}
	}
	option = {
		name = "ag_eta.1021.c"
		default_hide_option = yes
		hidden_effect = {
			remove_global_flag = ag_ancient_eta_gateway_menu_opened
			clear_global_event_target = ag_eta_gateway_ctrl_target_system
		}
	}
}

# ag_on_country_selector_confirm, Set ancient gateway's white/black list.
country_event = {
	id = ag_eta.1022
	hide_window = yes
	is_triggered_only = yes
	trigger = { has_country_flag = ag_eta_gateway_country_selector }
	immediate = {
		remove_country_flag = ag_eta_gateway_country_selector
		every_country = {
			limit = { has_country_flag = ag_country_selector_selected_country }
			remove_country_flag = ag_country_selector_selected_country
			root = {
				if = {
					limit = { has_country_flag = ag_ancient_eta_gateway_policy_white NOT = { has_country_flag = ag_ancient_eta_gateway_allows_@prev } }
					set_country_flag = ag_ancient_eta_gateway_allows_@prev
				}
				else_if = {
					limit = { has_country_flag = ag_ancient_eta_gateway_policy_black NOT = { has_country_flag = ag_ancient_eta_gateway_disallows_@prev } }
					set_country_flag = ag_ancient_eta_gateway_disallows_@prev
				}
			}
		}
	}
	after = {
		ag_country_selector_cleans_up_effect = yes
		ag_clear_country_selection = yes
	}
}

# Remove Wormholes if it exists too long.
system_event = {
	id = ag_eta.1023
	hide_window = yes
	is_triggered_only = yes
	trigger = { any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_wormhole_temporary } }
	immediate = { random_system_megastructure = {
		limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_2 }
		ag_eta_remove_gateway_portal = { ag_type = wormhole_temporary }
		ag_eta_gateway_closing_effect = yes
		random_system = {
			limit = { any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_wormhole_temporary_alt } }
			random_system_megastructure = {
				limit = { is_megastructure_type = ag_ancient_eta_gateway_wormhole_temporary_alt }
				remove_megastructure = this
			}
		}
	} }
}

# ag_on_system_selector_confirm, System selector selected temp wormhole target.
country_event = {
	id = ag_eta.1024
	hide_window = yes
	is_triggered_only = yes
	trigger = { has_country_flag = ag_enabled_eta_wormhole_target_selector }
	immediate = {
		remove_country_flag = ag_enabled_eta_wormhole_target_selector
		if = {
			limit = { exists = event_target:ag_eta_gateway_wormhole_temporary_target_system }
			clear_global_event_target = ag_eta_gateway_wormhole_temporary_target_system
		}
		every_system = {
			limit = { has_star_flag = ag_system_selector_selected_system }
			remove_star_flag = ag_system_selector_selected_system
			if = {
				limit = { NOT = { exists = event_target:ag_eta_gateway_wormhole_temporary_target_system } }
				save_global_event_target_as = ag_eta_gateway_wormhole_temporary_target_system
			}
		}
	}
	after = {
		ag_system_selector_after_effect = yes
		ag_clear_system_selection = yes
	}
}

# on_yearly_pulse, Clear event target if no control station
event = {
	id = ag_eta.1025
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:ag_eta_gateway_controller
		event_target:ag_eta_gateway_controller = { NOR = {
			has_modifier = "ag_debug_modifier_buff_common"
			any_owned_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_control_megastructure_3 }
		} }
	}
	immediate = { clear_global_event_target = ag_eta_gateway_controller }
}

# Gateway opening animation
system_event = {
	id = ag_eta.1031
	hide_window = yes
	is_triggered_only = yes
	trigger = { any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_opening } }
	immediate = {
		random_system_megastructure = {
			limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_opening }
			create_ambient_object = {
				type = ag_eta_gateway_portal_windup_object
				location = this
				duration = -1
				use_3d_location = yes
				entity_offset = { min = 0 max = 0 }
				entity_offset_angle = { min = 0 max = 0 }
				entity_offset_height = { min = 0 max = 0 }
				entity_scale_to_size = yes
				scale = 0.01
			}
			ag_eta_upgrade_gateway_frame = { ag_target_level = 2 }
			last_created_ambient_object = { set_ambient_object_flag = ag_eta_gateway_portal_windup_object }
		}
	}
}

# Gateway closing animation
system_event = {
	id = ag_eta.1032
	hide_window = yes
	is_triggered_only = yes
	trigger = { any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_closing } }
	immediate = { random_system_megastructure = {
		limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_closing }
		remove_megastructure_flag = ag_eta_gateway_working
		ag_eta_upgrade_gateway_frame = { ag_target_level = 4 }
	} }
}

# Gateway opening animation
system_event = {
	id = ag_eta.1033
	hide_window = yes
	is_triggered_only = yes
	trigger = { any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_opening_blue } }
	immediate = {
		random_system_megastructure = {
			limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_opening_blue }
			ag_eta_create_gateway_portal = { ag_type = galactic_gateway }
			ag_eta_upgrade_gateway_frame = { ag_target_level = 1 }
		}
	}
}

# Create gateway ship
system_event = {
	id = ag_eta.1034
	hide_window = yes
	is_triggered_only = yes
	trigger = { any_system_megastructure = { OR = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_closing is_megastructure_type = ag_ancient_eta_gateway_megastructure_4 } } }
	immediate = { random_system_megastructure = {
		limit = { OR = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_closing is_megastructure_type = ag_ancient_eta_gateway_megastructure_4 } }
		if = {
			limit = { from = { has_country_flag = ag_eta_ships_unlocked } }
			ag_eta_gateway_player_spawn = { ag_owner = from ag_unlock_ship = yes ag_location_target = prev }
		}
		else = { ag_eta_gateway_player_spawn = { ag_owner = from ag_unlock_ship = no ag_location_target = prev } }
		remove_megastructure = this
	} }
}

# Spawn gateway portals
system_event = {
	id = ag_eta.1041
	hide_window = yes
	is_triggered_only = yes
	trigger = { any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_2 } }
	immediate = {
		random_system_ambient_object = {
			limit = {
				is_ambient_object_type = ag_eta_gateway_portal_windup_object
				has_ambient_object_flag = ag_eta_gateway_portal_windup_object
			}
			destroy_ambient_object = this
		}
		random_system_megastructure = {
			limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_2 }
			remove_megastructure_flag = ag_eta_gateway_working
			ag_eta_create_gateway_portal = { ag_type = galactic_gateway }
		}
	}
}
system_event = {
	id = ag_eta.1042
	hide_window = yes
	is_triggered_only = yes
	trigger = { any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_2 } }
	immediate = {
		set_star_flag = lgate
		random_system_ambient_object = {
			limit = {
				is_ambient_object_type = ag_eta_gateway_portal_windup_object
				has_ambient_object_flag = ag_eta_gateway_portal_windup_object
			}
			destroy_ambient_object = this
		}
		random_system_megastructure = {
			limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_2 }
			remove_megastructure_flag = ag_eta_gateway_working
			ag_eta_create_gateway_portal = { ag_type = lgate }
		}
	}
}
system_event = {
	id = ag_eta.1043
	hide_window = yes
	is_triggered_only = yes
	trigger = { any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_2 } }
	immediate = {
		random_system_ambient_object = {
			limit = {
				is_ambient_object_type = ag_eta_gateway_portal_windup_object
				has_ambient_object_flag = ag_eta_gateway_portal_windup_object
			}
			destroy_ambient_object = this
		}
		random_system_megastructure = {
			limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_2 }
			remove_megastructure_flag = ag_eta_gateway_working
			ag_eta_create_gateway_portal = { ag_type = ancient_gateway }
		}
	}
}
system_event = {
	id = ag_eta.1044
	hide_window = yes
	is_triggered_only = yes
	trigger = { any_system_megastructure = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_2 } }
	immediate = {
		random_system_ambient_object = {
			limit = {
				is_ambient_object_type = ag_eta_gateway_portal_windup_object
				has_ambient_object_flag = ag_eta_gateway_portal_windup_object
			}
			destroy_ambient_object = this
		}
		random_system_megastructure = {
			limit = { is_megastructure_type = ag_ancient_eta_gateway_megastructure_2 }
			remove_megastructure_flag = ag_eta_gateway_working
			ag_spawn_explosion_effect = { ag_color = red ag_scale = m }
			ag_eta_create_gateway_portal = { ag_type = wormhole_temporary }
		}
		event_target:ag_eta_gateway_wormhole_temporary_target_system = {
			random_system_ambient_object = {
				limit = {
					is_ambient_object_type = ag_eta_gateway_wormhole_windup_object
					has_ambient_object_flag = ag_eta_gateway_wormhole_windup_object
				}
				prev = {
					spawn_megastructure = {
						type = ag_ancient_eta_gateway_wormhole_temporary_alt
						coords_from = prev
						init_effect = {
							set_megastructure_flag = ag_eta_gateway_wormhole_temporary_@root
							ag_spawn_explosion_effect = { ag_color = red ag_scale = m }
							if = {
								limit = { solar_system = { exists = space_owner } }
								set_owner = solar_system.space_owner
							}
						}
					}
				}
				destroy_ambient_object = this
			}
		}
		random_system_megastructure = {
			limit = { is_megastructure_type = ag_ancient_eta_gateway_wormhole_temporary }
			set_megastructure_flag = ag_eta_gateway_wormhole_temporary_@event_target:ag_eta_gateway_wormhole_temporary_target_system
		}
		if = {
			limit = { exists = event_target:ag_eta_gateway_controller event_target:ag_eta_gateway_controller = { has_country_flag = ag_ship_subsystem_enabled_601_31 } }
			system_event = { id = ag_eta.1023 days = @ag_eta_gateway_wormhole_lifespan_extended random = @ag_eta_gateway_wormhole_lifespan_random_extended }
		}
		else = { system_event = { id = ag_eta.1023 days = @ag_eta_gateway_wormhole_lifespan random = @ag_eta_gateway_wormhole_lifespan_random } }
	}
}

# on_tech_increased, Ancient Gateway Frames are available for construction
country_event = {
	id = ag_eta.1051
	hide_window = yes
	is_triggered_only = yes
	trigger = { last_increased_tech = tech_ag_ancient_eta_gateway }
	immediate = {
		if = {
			limit = { has_country_flag = ag_eta_163_fired }
			ag_add_ship_design = { ag_design = ag_eta_gateway_1 }
		}
		else = { ag_add_ship_design = { ag_design = ag_eta_gateway_0 } }
	}
}
# Ancient Titan, stage 1/5
country_event = {
	id = ag_eta.1061
	title = "ag_eta.1061.name"
	desc = "ag_eta.1061.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_ringworld_build_start
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1061.a" }
	option = {
		name = "ag_auto_upgrade"
		trigger = { fromfromfrom = { NOT = { has_megastructure_flag = ag_auto_upgrade_megastructure } } }
		ag_set_auto_upgrade_megastructure = yes
	}
}
# Ancient Titan, stage 2/5
country_event = {
	id = ag_eta.1062
	title = "ag_eta.1062.name"
	desc = "ag_eta.1062.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_upgrade_frame
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1062.a" }
	option = {
		name = "ag_auto_upgrade"
		trigger = { fromfromfrom = { NOT = { has_megastructure_flag = ag_auto_upgrade_megastructure } } }
		ag_set_auto_upgrade_megastructure = yes
	}
}
# Ancient Titan, stage 3/5
country_event = {
	id = ag_eta.1063
	title = "ag_eta.1063.name"
	desc = "ag_eta.1063.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_upgrade_frame
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1063.a" }
	option = {
		name = "ag_auto_upgrade"
		trigger = { fromfromfrom = { NOT = { has_megastructure_flag = ag_auto_upgrade_megastructure } } }
		ag_set_auto_upgrade_megastructure = yes
	}
}
# Ancient Titan, stage 4/5
country_event = {
	id = ag_eta.1064
	title = "ag_eta.1064.name"
	desc = "ag_eta.1064.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_upgrade_frame
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1064.a" }
	option = {
		name = "ag_auto_upgrade"
		trigger = { fromfromfrom = { NOT = { has_megastructure_flag = ag_auto_upgrade_megastructure } } }
		ag_set_auto_upgrade_megastructure = yes
	}
}
# Ancient Titan, stage 5/5
country_event = {
	id = ag_eta.1065
	title = "ag_eta.1065.name"
	desc = "ag_eta.1065.desc"
	inline_script = "events/ag_ancient_titan_built_options"
}
# Ancient Titan, stage 1/5 (others)
country_event = {
	id = ag_eta.1066
	title = "ag_eta.1066.name"
	desc = "ag_eta.1066.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_mega_structure_other_empire_build_complete
	location = fromfromfrom
	is_triggered_only = yes
	option = { name = "ag_eta.1066.a" }
}
# Ancient Titan, stage 5/5 (others)
country_event = {
	id = ag_eta.1067
	title = "ag_eta.1067.name"
	desc = "ag_eta.1067.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_mega_structure_other_empire_build_complete
	location = fromfromfrom
	is_triggered_only = yes
	inline_script = "events/ag_ancient_titan_built_other_options"
}

# Refresh Pois
country_event = {
	id = ag_eta.2001
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_1_poi } } remove_point_of_interest = ag_eta_titan_loc_1_poi }
		if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_2_poi } } remove_point_of_interest = ag_eta_titan_loc_2_poi }
		if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_3_poi } } remove_point_of_interest = ag_eta_titan_loc_3_poi }
		if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_4_poi } } remove_point_of_interest = ag_eta_titan_loc_4_poi }
		if = { limit = { has_special_project = "ag_tracking_eta_titan_1_1" } abort_special_project = { type = "ag_tracking_eta_titan_1_1" } }
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_1_1" } abort_special_project = { type = "ag_stop_tracking_eta_titan_1_1" } }
		if = { limit = { has_special_project = "ag_tracking_eta_titan_2_1" } abort_special_project = { type = "ag_tracking_eta_titan_2_1" } }
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_2_1" } abort_special_project = { type = "ag_stop_tracking_eta_titan_2_1" }  }
		if = { limit = { has_special_project = "ag_tracking_eta_titan_3_1" } abort_special_project = { type = "ag_tracking_eta_titan_3_1" } }
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_3_1" } abort_special_project = { type = "ag_stop_tracking_eta_titan_3_1" } }
		if = { limit = { has_special_project = "ag_tracking_eta_titan_4_1" } abort_special_project = { type = "ag_tracking_eta_titan_4_1" } }
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_4_1" } abort_special_project = { type = "ag_stop_tracking_eta_titan_4_1" } }
	}

	after = {
		if = {
			limit = { has_country_flag = ag_tracks_eta_titan_1 }
			create_point_of_interest = {
				id = ag_eta_titan_loc_1_poi
				name = ag_eta_titan_loc_1
				desc = ag_eta_titan_loc_1_desc
				event_chain = "ag_eta_titan_chain_stage_2"
				location = event_target:ag_eta_titan_hostile_fleet_1.solar_system
			}
			enable_special_project = { name = "ag_stop_tracking_eta_titan_1_2" owner = root }
		}
		else = { enable_special_project = { name = "ag_tracking_eta_titan_1_2" owner = root } }
		if = {
			limit = { has_country_flag = ag_tracks_eta_titan_2 }
			create_point_of_interest = {
				id = ag_eta_titan_loc_2_poi
				name = ag_eta_titan_loc_2
				desc = ag_eta_titan_loc_2_desc
				event_chain = "ag_eta_titan_chain_stage_2"
				location = event_target:ag_eta_titan_hostile_fleet_2.solar_system
			}
			enable_special_project = { name = "ag_stop_tracking_eta_titan_2_2" owner = root }
		}
		else = { enable_special_project = { name = "ag_tracking_eta_titan_2_2" owner = root } }
		if = {
			limit = { has_country_flag = ag_tracks_eta_titan_3 }
			create_point_of_interest = {
				id = ag_eta_titan_loc_3_poi
				name = ag_eta_titan_loc_3
				desc = ag_eta_titan_loc_3_desc
				event_chain = "ag_eta_titan_chain_stage_2"
				location = event_target:ag_eta_titan_hostile_fleet_3.solar_system
			}
			enable_special_project = { name = "ag_stop_tracking_eta_titan_3_2" owner = root }
		}
		else = { enable_special_project = { name = "ag_tracking_eta_titan_3_2" owner = root } }
		if = {
			limit = { has_country_flag = ag_tracks_eta_titan_4 }
			create_point_of_interest = {
				id = ag_eta_titan_loc_4_poi
				name = ag_eta_titan_loc_4
				desc = ag_eta_titan_loc_4_desc
				event_chain = "ag_eta_titan_chain_stage_2"
				location = event_target:ag_eta_titan_hostile_fleet_4.solar_system
			}
			enable_special_project = { name = "ag_stop_tracking_eta_titan_4_2" owner = root }
		}
		else = { enable_special_project = { name = "ag_tracking_eta_titan_4_2" owner = root } }
	}
}
country_event = {
	id = ag_eta.2002
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_1_poi } } remove_point_of_interest = ag_eta_titan_loc_1_poi }
		if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_2_poi } } remove_point_of_interest = ag_eta_titan_loc_2_poi }
		if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_3_poi } } remove_point_of_interest = ag_eta_titan_loc_3_poi }
		if = { limit = { has_point_of_interest = { poi = ag_eta_titan_loc_4_poi } } remove_point_of_interest = ag_eta_titan_loc_4_poi }
		if = { limit = { has_special_project = "ag_tracking_eta_titan_1_1" } abort_special_project = { type = "ag_tracking_eta_titan_1_1" } }
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_1_1" } abort_special_project = { type = "ag_stop_tracking_eta_titan_1_1" } }
		if = { limit = { has_special_project = "ag_tracking_eta_titan_2_1" } abort_special_project = { type = "ag_tracking_eta_titan_2_1" } }
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_2_1" } abort_special_project = { type = "ag_stop_tracking_eta_titan_2_1" }  }
		if = { limit = { has_special_project = "ag_tracking_eta_titan_3_1" } abort_special_project = { type = "ag_tracking_eta_titan_3_1" } }
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_3_1" } abort_special_project = { type = "ag_stop_tracking_eta_titan_3_1" } }
		if = { limit = { has_special_project = "ag_tracking_eta_titan_4_1" } abort_special_project = { type = "ag_tracking_eta_titan_4_1" } }
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_4_1" } abort_special_project = { type = "ag_stop_tracking_eta_titan_4_1" } }
		if = { limit = { has_special_project = "ag_tracking_eta_titan_1_2" } abort_special_project = { type = "ag_tracking_eta_titan_1_2" } }
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_1_2" } abort_special_project = { type = "ag_stop_tracking_eta_titan_1_2" } }
		if = { limit = { has_special_project = "ag_tracking_eta_titan_2_2" } abort_special_project = { type = "ag_tracking_eta_titan_2_2" } }
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_2_2" } abort_special_project = { type = "ag_stop_tracking_eta_titan_2_2" } }
		if = { limit = { has_special_project = "ag_tracking_eta_titan_3_2" } abort_special_project = { type = "ag_tracking_eta_titan_3_2" } }
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_3_2" } abort_special_project = { type = "ag_stop_tracking_eta_titan_3_2" } }
		if = { limit = { has_special_project = "ag_tracking_eta_titan_4_2" } abort_special_project = { type = "ag_tracking_eta_titan_4_2" } }
		if = { limit = { has_special_project = "ag_stop_tracking_eta_titan_4_2" } abort_special_project = { type = "ag_stop_tracking_eta_titan_4_2" } }
	}

	after = {
		if = {
			limit = { has_country_flag = ag_tracks_eta_titan_1 }
			create_point_of_interest = {
				id = ag_eta_titan_loc_1_poi
				name = ag_eta_titan_loc_1
				desc = ag_eta_titan_loc_1_desc
				event_chain = "ag_eta_titan_chain_stage_ended"
				location = event_target:ag_eta_titan_hostile_fleet_1.solar_system
			}
			enable_special_project = { name = "ag_stop_tracking_eta_titan_1_3" owner = root }
		}
		else = { enable_special_project = { name = "ag_tracking_eta_titan_1_3" owner = root } }
		if = {
			limit = { has_country_flag = ag_tracks_eta_titan_2 }
			create_point_of_interest = {
				id = ag_eta_titan_loc_2_poi
				name = ag_eta_titan_loc_2
				desc = ag_eta_titan_loc_2_desc
				event_chain = "ag_eta_titan_chain_stage_ended"
				location = event_target:ag_eta_titan_hostile_fleet_2.solar_system
			}
			enable_special_project = { name = "ag_stop_tracking_eta_titan_2_3" owner = root }
		}
		else = { enable_special_project = { name = "ag_tracking_eta_titan_2_3" owner = root } }
		if = {
			limit = { has_country_flag = ag_tracks_eta_titan_3 }
			create_point_of_interest = {
				id = ag_eta_titan_loc_3_poi
				name = ag_eta_titan_loc_3
				desc = ag_eta_titan_loc_3_desc
				event_chain = "ag_eta_titan_chain_stage_ended"
				location = event_target:ag_eta_titan_hostile_fleet_3.solar_system
			}
			enable_special_project = { name = "ag_stop_tracking_eta_titan_3_3" owner = root }
		}
		else = { enable_special_project = { name = "ag_tracking_eta_titan_3_3" owner = root } }
		if = {
			limit = { has_country_flag = ag_tracks_eta_titan_4 }
			create_point_of_interest = {
				id = ag_eta_titan_loc_4_poi
				name = ag_eta_titan_loc_4
				desc = ag_eta_titan_loc_4_desc
				event_chain = "ag_eta_titan_chain_stage_ended"
				location = event_target:ag_eta_titan_hostile_fleet_4.solar_system
			}
			enable_special_project = { name = "ag_stop_tracking_eta_titan_4_3" owner = root }
		}
		else = { enable_special_project = { name = "ag_tracking_eta_titan_4_3" owner = root } }
	}
}

# on_monthly_pulse, Reset gateway'sowner
event = {
	id = ag_eta.2003
	hide_window = yes
	is_triggered_only = yes
	trigger = { exists = event_target:ag_eta_gateway_controller }
	immediate = {
		every_megastructure = {
			limit = {
				ag_is_ancient_gateway_megastructure_alt = yes
				NAND = { exists = owner owner = { is_same_value = event_target:ag_eta_gateway_controller } }
			}
			set_owner = event_target:ag_eta_gateway_controller
		}
	}
}

# on_ship_destroyed_victim, Destroy a starbase, remove particle effect.
country_event = {
	id = ag_eta.2004
	hide_window = yes
	is_triggered_only = yes
	trigger = { ag_eta_titan_event_active = yes fromfrom = { is_ship_size = ag_eta_titan_starbase_hostile } }
	immediate = {
		fromfrom.solar_system = {
			if = {
				limit = { any_system_ambient_object = { has_ambient_object_flag = ag_eta_system_effect_2 } }
				every_system_ambient_object = {
					limit = { has_ambient_object_flag = ag_eta_system_effect_2 }
					destroy_ambient_object = this
				}
			}
			if = {
				limit = { any_ship_in_system = { is_ship_size = ag_eta_titan_hostile } }
				random_system_planet = {
					limit = { is_primary_star = yes }
					create_ambient_object = { type = "ag_eta_system_effect_1_object" location = this }
					last_created_ambient_object = {
						set_ambient_object_flag = ag_eta_system_effect_1
						set_location = { target = prev distance = 0 angle = random }
					}
				}
			}
		}
	}
}
