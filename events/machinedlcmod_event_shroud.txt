namespace = endim #energy dimension, the Shroud

### Spawn the Shroud
event = {
	id = endim.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		create_country = {
			name = "NAME_The_Shroud"
			type = shroud_2
			flag = {
				icon = {
					category = "special"
					file = "the_shroud.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"blue"
					"black"
					"null"
					"null"
				}
			}
		}
		set_global_flag = shroud_2_created
	}
}
country_event = {
	id = endim.2
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		create_message = {
			type = EVENT_MESSAGE_TYPE
			localization = MACHINE_ENDIM_ACCESS_ENABLED
			target = this
			days = 30
		}
	}
}
# The Shroud Lobby
country_event = {
	id = endim.3000
	title = "endim.3000.name"
	desc = {
		text = endim.3000.intro.desc
		trigger = { has_country_flag = shroud_intro }
	}
	desc = {
		text = endim.3000.1.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.2.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.3.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.4.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.5.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.6.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.7.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.8.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.9.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.10.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.11.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.12.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.13.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.14.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.15.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.16.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.17.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.18.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	desc = {
		text = endim.3000.19.desc
		trigger = { NOT = { has_country_flag = shroud_intro } }
	}
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	trigger = {
		OR = {
			from = { is_country_type = shroud_2 } #changed for this mod
			has_country_flag = shroud_intro
		}
		NOR = {
			has_country_flag = shroud_diplomacy_engaged
			has_modifier = shroud_cooldown_2 #changed for this mod
			has_modifier = shroud_precog_cooldown_2 #changed for this mod
		}
	}

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			if = {
				limit = { has_country_flag = shroud_intro }
				remove_country_flag = shroud_intro
			}
		}
	}

	option = {
		name = "endim.3000.a"
		#custom_tooltip = "venture.shroud.tooltip"
		allow = {
			resource_stockpile_compare = { resource = energy value >= 2000 }
			any_owned_planet = { has_building = building_psi_emitter }
		}

		add_resource = { energy = -2000 }

		hidden_effect = {
			random_list = {
				10 = { 
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_1 } }
						country_event = { id = endim.3100 }
					}
					else = { country_event = { id = endim.3200 } }
				}
				10 = {
					if = {
						limit = { 
							count_owned_ships = {
								limit = { is_ship_size = psionic_avatar }
								count < 1
							}
							count_armies = {
								limit = { army_type = shroud_army }
								count < 1
							}
						}
						country_event = { id = endim.3110 }
					}
					else = { country_event = { id = endim.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_3 } }
						country_event = { id = endim.3120 }
					}
					else = { country_event = { id = endim.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_4 } }
						country_event = { id = endim.3130 }
					}
					else = { country_event = { id = endim.3200 } }
				}
				10 = {
					if = {
						limit = { NOT = { has_country_flag = shroud_vision_5 } }
						country_event = { id = endim.3140 }
					}
					else = { country_event = { id = endim.3200 } }
				}
				10 = {
					if = {
						limit = {
							any_country = {
								is_country_type = fallen_empire
								NOT = { has_ethic = ethic_gestalt_consciousness }
								has_communications = root
								NOT = { is_at_war_with = root }
							}
							NOT = { has_country_flag = shroud_fallen_empire }
						}
						country_event = { id = endim.3150 }
					}
					else = { country_event = { id = endim.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_psi_jump_drive_machinedlcmod
								has_technology = tech_psi_jump_drive_1
							}
						}
						country_event = { id = endim.3160 }
					}
					else = { country_event = { id = endim.3200 } }
				}	
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_psionic_shield_machinedlcmod
								has_technology = tech_psionic_shield
							}
						}
						country_event = { id = endim.3170 }
					}
					else = { country_event = { id = endim.3200 } }
				}
				10 = {
					if = {
						limit = {
							NOR = {
								has_technology = tech_precognition_interface_machinedlcmod
								has_technology = tech_precognition_interface
							}
						}
						country_event = { id = endim.3180 }
					}
					else = { country_event = { id = endim.3200 } }
				}			
				10 = {
					if = {
						limit = { 
							NOR = { 
								has_country_flag = shroud_vision_10
								any_owned_leader = {
									OR = {
										has_trait = leader_trait_admiral_chosen
										has_trait = leader_trait_general_chosen
										has_trait = leader_trait_governor_chosen
										has_trait = leader_trait_ruler_chosen_2
										has_trait = leader_trait_scientist_chosen
									}
								}
							} 

						}
						country_event = { id = endim.3190 }
					}
					else = { country_event = { id = endim.3200 } }
				}
				20 = {
					if = {
						limit = { 
							NOT = { 
								has_country_flag = has_shroud_patron
							} 

						}
						country_event = { id = endim.3300 }
					}				
					else = { country_event = { id = endim.3200 } }
				}
				10 = { country_event = { id = endim.3200 } }
			}
			if = {
				limit = {
					has_relic = r_zro_crystal
				}
				add_modifier = {
					modifier = "shroud_cooldown_2"
					days = 900
				}
				country_event = { id = endim.2 days = 900 }
			}				
			else = {
				add_modifier = {
					modifier = "shroud_cooldown_2"
					days = 1800
				}
				country_event = { id = endim.2 days = 1800 }
			}
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# The Shroud Unavailable
country_event = {
	id = endim.3010
	title = "endim.3000.name"
	desc = "endim.3010.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	trigger = {
		from = { is_country_type = shroud_2 } #changed for this mod
		NOT = { has_country_flag = shroud_diplomacy_engaged }
		OR = {
			has_modifier = shroud_cooldown_2 #changed for this mod
			has_modifier = shroud_precog_cooldown_2 #changed for this mod
		}
	}

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

### Summon Avatar

# Summon Avatar (SUCCESS SHIP)
country_event = {
	id = endim.3020
	title = "endim.3000.name"
	desc = "endim.3020.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		create_fleet = {
			name = "NAME_Psionic_Avatar"
			settings = { 
				can_upgrade = no 
				can_change_composition = no 
				can_change_leader = no 
				uses_naval_capacity = no
				spawn_debris = no
			}			
			effect = {
				set_owner = root
				create_ship = {
					name = "NAME_Avatar"
					design = "NAME_Shroud_Avatar"
					prefix = no
					upgradable = no
				}
				set_location = root.capital_scope
			}
		}
		default_hide_option = yes
	}
}

# Summon Avatar (SUCCESS ARMY)
country_event = {
	id = endim.3021
	title = "endim.3000.name"
	desc = "endim.3021.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		capital_scope = {
			create_army = {
				name = "NAME_Avatar"
				owner = root
				species = root
				type = "shroud_army"
			}
		}
		default_hide_option = yes
	}
}

# Summon Avatar (FAILURE)
country_event = {
	id = endim.3022
	title = "endim.3000.name"
	desc = "endim.3022.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = negative_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		default_hide_option = yes
	}
}

# Summon Avatar (CRITICAL FAILURE)
country_event = {
	id = endim.3023
	title = "endim.3000.name"
	desc = "endim.3023.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = negative_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		hidden_effect = {
			country_event = { id = endim.3024 }
		}
		default_hide_option = yes
	}
}

# Shroud Incursion
country_event = {
	id = endim.3024
	title = "endim.3024.name"
	desc = "endim.3024.desc"
	picture = GFX_evt_psionics
	show_sound = event_psionic
	location = event_target:shroud_spawn_system
	
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { NOT = { exists = event_target:shroud_country } }
			create_country = {
				name = "NAME_Creatures_of_the_Shroud"
				type = shroud_spirits
				flag = {
					icon = {
						category = "special"
						file = "the_shroud.dds"
					}
					background= {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors={
						"dark_purple"
						"black"
						"null"
						"null"
					}
				}
			}
			last_created_country = {
				establish_communications_no_message = root
				save_global_event_target_as = shroud_country
			}
		}

		random_system_within_border = {
			save_event_target_as = shroud_spawn_system
			random_system_planet = { save_event_target_as = shroud_spawn_planet }
		}
 
		create_fleet = {
			name = "NAME_Corrupted_Avatar"
			settings = {
				spawn_debris = no
				is_boss = yes
			}			
			effect = {
				set_owner = event_target:shroud_country
				create_ship = {
					name = "NAME_Corrupted_Avatar"
					design = "NAME_Corrupted_Avatar"
				}
				set_location = event_target:shroud_spawn_planet
				set_fleet_stance = aggressive
				set_aggro_range_measure_from = return_point
				set_aggro_range = 300
			}
		}
		observer_event = { id = observer.68 }
		last_created_fleet = { # Despawn if enough time passes without being destroyed
			fleet_event = { id = endim.3025 days = 3600 }
		}
	}
	
	option = {
		name = "endim.3024.a"
	}
}

# Shroud Avatar Banished (HIDDEN)
fleet_event = {
	id = endim.3025
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		from = {
			country_event = { id = endim.3026 }
		}
		destroy_fleet = this
	}
}

# Shroud Avatar Banished (HIDDEN)
country_event = {
	id = endim.3026
	title = "endim.3026.name"
	desc = "endim.3026.desc"
	picture = GFX_evt_psionics
	show_sound = event_psionic
	location = event_target:shroud_spawn_system
	
	is_triggered_only = yes
	
	option = {
		name = "endim.3026.a"
	}
}

### Modifiers
# Ship Upkeep (SUCCESS)
country_event = {
	id = endim.3031
	title = "boon.bestowed"
	desc = "endim.3031.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_ship_upkeep"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Research Speed (SUCCESS)
country_event = {
	id = endim.3032
	title = "boon.bestowed"
	desc = "endim.3032.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_research_speed"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Shield Boost (SUCCESS)
country_event = {
	id = endim.3033
	title = "boon.bestowed"
	desc = "endim.3033.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_shield_boost"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Weapon Boost (SUCCESS)
country_event = {
	id = endim.3034
	title = "boon.bestowed"
	desc = "endim.3034.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_weapon_boost"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Firing Rate (SUCCESS)
country_event = {
	id = endim.3035
	title = "boon.bestowed"
	desc = "endim.3035.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_firing_rate"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Influence Boost (SUCCESS)
country_event = {
	id = endim.3037
	title = "boon.bestowed"
	desc = "endim.3037.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_influence_boost"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Unity Boost (SUCCESS)
country_event = {
	id = endim.3038
	title = "boon.bestowed"
	desc = "endim.3038.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_unity_boost"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Evasion (SUCCESS)
country_event = {
	id = endim.3039
	title = "boon.bestowed"
	desc = "endim.3039.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_evasion"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Ship Repair (SUCCESS)
country_event = {
	id = endim.3040
	title = "boon.bestowed"
	desc = "endim.3040.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_repair"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Ship Speed (SUCCESS)
country_event = {
	id = endim.3042
	title = "boon.bestowed"
	desc = "endim.3042.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_speed"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Sensor Range (SUCCESS)
country_event = {
	id = endim.3044
	title = "boon.bestowed"
	desc = "endim.3044.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = positive_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_sensors"
			days = 1800
		}
		default_hide_option = yes
	}
}

# No Effect (FAILURE)
country_event = {
	id = endim.3045
	title = "endim.3000.name"
	desc = { text = endim.3045.1.desc }
	desc = { text = endim.3045.2.desc }
	desc = { text = endim.3045.3.desc }
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = negative_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Negative Ship Armor (CRITICAL FAILURE)
country_event = {
	id = endim.3052
	title = "curse.bestowed"
	desc = "endim.3052.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = negative_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_neg_armor"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Negative Population Growth (CRITICAL FAILURE)
country_event = {
	id = endim.3053
	title = "curse.bestowed"
	desc = "endim.3053.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = negative_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_neg_growth_2" #changed for this mod
			days = 1800
		}
		default_hide_option = yes
	}
}

# Negative Research (CRITICAL FAILURE)
country_event = {
	id = endim.3054
	title = "curse.bestowed"
	desc = "endim.3054.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = negative_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_neg_research"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Negative Influence (CRITICAL FAILURE)
country_event = {
	id = endim.3055
	title = "curse.bestowed"
	desc = "endim.3055.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = negative_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_neg_influence"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Negative Unity (CRITICAL FAILURE)
country_event = {
	id = endim.3056
	title = "curse.bestowed"
	desc = "endim.3056.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = negative_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_neg_unity"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Negative Ship Speed (CRITICAL FAILURE)
country_event = {
	id = endim.3057
	title = "curse.bestowed"
	desc = "endim.3057.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = negative_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_neg_speed"
			days = 1800
		}
		default_hide_option = yes
	}
}

# Negative Army Health (CRITICAL FAILURE)
country_event = {
	id = endim.3058
	title = "curse.bestowed"
	desc = "endim.3058.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = negative_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_neg_morale_2" #changed for this mod
			days = 1800
		}
		default_hide_option = yes
	}
}

# Negative Sensor Range (CRITICAL FAILURE)
country_event = {
	id = endim.3059
	title = "curse.bestowed"
	desc = "endim.3059.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			set_timed_country_flag = {
				flag = negative_shroud_outcome
				days = 1800 # 5 years
			}
		}
	}

	option = {
		name = "exit.shroud"
		add_modifier = {
			modifier = "shroud_neg_sensors"
			days = 1800
		}
		default_hide_option = yes
	}
}


### VISIONS

# Vision 1
country_event = {
	id = endim.3100
	title = "endim.3000.name"
	desc = "endim.3100.desc"
	diplomatic = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		set_country_flag = shroud_vision_1
		randomize_shroud_flags = yes 
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
		remove_shroud_flags = yes
	}

	### Constant
	# Summon Avatar
	option = {
		name = "endim.3100.a"
		custom_tooltip = "shroud.avatar.chances.high"
		hidden_effect = {
			random_list = {
				35 = { country_event = { id = endim.3020 }}
				35 = { country_event = { id = endim.3021 }}
				20 = { 
					modifier = {
						factor = 0.5
						has_relic = r_zro_crystal
					}
					country_event = { id = endim.3022 }
				}
				10 = { 
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = endim.3023 }
				}
			}
		}
	}

	### Medium
	option = {
		name = "boon.upkeep.medium"
		trigger = { has_country_flag = medium.2 }
		custom_tooltip = "shroud.boon.chances.medium"
		upkeep_shroud_medium_2 = yes
	}
	option = {
		name = "boon.research.medium"
		trigger = { has_country_flag = medium.3 }
		custom_tooltip = "shroud.boon.chances.medium"
		research_shroud_medium_2 = yes
	}
	option = {
		name = "boon.shields.medium"
		trigger = { has_country_flag = medium.4 }
		custom_tooltip = "shroud.boon.chances.medium"
		shields_shroud_medium_2 = yes
	}
	option = {
		name = "boon.weapons.medium"
		trigger = { has_country_flag = medium.5 }
		custom_tooltip = "shroud.boon.chances.medium"
		weapons_shroud_medium_2 = yes
	}
	option = {
		name = "boon.firing.medium"
		trigger = { has_country_flag = medium.6 }
		custom_tooltip = "shroud.boon.chances.medium"
		firingrate_shroud_medium_2 = yes
	}
	option = {
		name = "boon.influence.medium"
		trigger = { has_country_flag = medium.8 }
		custom_tooltip = "shroud.boon.chances.medium"
		influence_shroud_medium_2 = yes
	}
	option = {
		name = "boon.unity.medium"
		trigger = { has_country_flag = medium.9 }
		custom_tooltip = "shroud.boon.chances.medium"
		unity_shroud_medium_2 = yes
	}
	option = {
		name = "boon.evasion.medium"
		trigger = { has_country_flag = medium.10 }
		custom_tooltip = "shroud.boon.chances.medium"
		evasion_shroud_medium_2 = yes
	}
	option = {
		name = "boon.repair.medium"
		trigger = { has_country_flag = medium.11 }
		custom_tooltip = "shroud.boon.chances.medium"
		repair_shroud_medium_2 = yes
	}
	option = {
		name = "boon.speed.medium"
		trigger = { has_country_flag = medium.13 }
		custom_tooltip = "shroud.boon.chances.medium"
		speed_shroud_medium_2 = yes
	}
	option = {
		name = "boon.sensors.medium"
		trigger = { has_country_flag = medium.15 }
		custom_tooltip = "shroud.boon.chances.medium"
		sensor_shroud_medium_2 = yes
	}

	### Low
	option = {
		name = "boon.upkeep.low"
		trigger = { has_country_flag = low.2 }
		custom_tooltip = "shroud.boon.chances.low"
		upkeep_shroud_low_2 = yes
	}
	option = {
		name = "boon.research.low"
		trigger = { has_country_flag = low.3 }
		custom_tooltip = "shroud.boon.chances.low"
		research_shroud_low_2 = yes
	}
	option = {
		name = "boon.shields.low"
		trigger = { has_country_flag = low.4 }
		custom_tooltip = "shroud.boon.chances.low"
		shields_shroud_low_2 = yes
	}
	option = {
		name = "boon.weapons.low"
		trigger = { has_country_flag = low.5 }
		custom_tooltip = "shroud.boon.chances.low"
		weapons_shroud_low_2 = yes
	}
	option = {
		name = "boon.firing.low"
		trigger = { has_country_flag = low.6 }
		custom_tooltip = "shroud.boon.chances.low"
		firingrate_shroud_low_2 = yes
	}
	option = {
		name = "boon.influence.low"
		trigger = { has_country_flag = low.8 }
		custom_tooltip = "shroud.boon.chances.low"
		influence_shroud_low_2 = yes
	}
	option = {
		name = "boon.unity.low"
		trigger = { has_country_flag = low.9 }
		custom_tooltip = "shroud.boon.chances.low"
		unity_shroud_low_2 = yes
	}
	option = {
		name = "boon.evasion.low"
		trigger = { has_country_flag = low.10 }
		custom_tooltip = "shroud.boon.chances.low"
		evasion_shroud_low_2 = yes
	}
	option = {
		name = "boon.repair.low"
		trigger = { has_country_flag = low.11 }
		custom_tooltip = "shroud.boon.chances.low"
		repair_shroud_low_2 = yes
	}
	option = {
		name = "boon.speed.low"
		trigger = { has_country_flag = low.13 }
		custom_tooltip = "shroud.boon.chances.low"
		speed_shroud_low_2 = yes
	}
	option = {
		name = "boon.sensors.low"
		trigger = { has_country_flag = low.15 }
		custom_tooltip = "shroud.boon.chances.low"
		sensor_shroud_low_2 = yes
	}

	# Exit
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Vision 2
country_event = {
	id = endim.3110
	title = "endim.3000.name"
	desc = "endim.3110.desc"
	diplomatic = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		set_country_flag = shroud_vision_2
		randomize_shroud_flags = yes 
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
		remove_shroud_flags = yes
	}

	### Constant
	# Summon Archon
	option = {
		name = "shroud.avatar.high"
		custom_tooltip = "shroud.avatar.chances.high"
		hidden_effect = {
			random_list = {
				35 = { country_event = { id = endim.3020 }}
				35 = { country_event = { id = endim.3021 }}
				20 = { 
					modifier = {
						factor = 0.5
						has_relic = r_zro_crystal
					}
					country_event = { id = endim.3022 }
				}
				10 = { 
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = endim.3023 }
				}
			}
		}
	}

	### Medium
	option = {
		name = "boon.upkeep.medium"
		trigger = { has_country_flag = medium.2 }
		custom_tooltip = "shroud.boon.chances.medium"
		upkeep_shroud_medium_2 = yes
	}
	option = {
		name = "boon.research.medium"
		trigger = { has_country_flag = medium.3 }
		custom_tooltip = "shroud.boon.chances.medium"
		research_shroud_medium_2 = yes
	}
	option = {
		name = "boon.shields.medium"
		trigger = { has_country_flag = medium.4 }
		custom_tooltip = "shroud.boon.chances.medium"
		shields_shroud_medium_2 = yes
	}
	option = {
		name = "boon.weapons.medium"
		trigger = { has_country_flag = medium.5 }
		custom_tooltip = "shroud.boon.chances.medium"
		weapons_shroud_medium_2 = yes
	}
	option = {
		name = "boon.firing.medium"
		trigger = { has_country_flag = medium.6 }
		custom_tooltip = "shroud.boon.chances.medium"
		firingrate_shroud_medium_2 = yes
	}
	option = {
		name = "boon.influence.medium"
		trigger = { has_country_flag = medium.8 }
		custom_tooltip = "shroud.boon.chances.medium"
		influence_shroud_medium_2 = yes
	}
	option = {
		name = "boon.unity.medium"
		trigger = { has_country_flag = medium.9 }
		custom_tooltip = "shroud.boon.chances.medium"
		unity_shroud_medium_2 = yes
	}
	option = {
		name = "boon.evasion.medium"
		trigger = { has_country_flag = medium.10 }
		custom_tooltip = "shroud.boon.chances.medium"
		evasion_shroud_medium_2 = yes
	}
	option = {
		name = "boon.repair.medium"
		trigger = { has_country_flag = medium.11 }
		custom_tooltip = "shroud.boon.chances.medium"
		repair_shroud_medium_2 = yes
	}
	option = {
		name = "boon.speed.medium"
		trigger = { has_country_flag = medium.13 }
		custom_tooltip = "shroud.boon.chances.medium"
		speed_shroud_medium_2 = yes
	}
	option = {
		name = "boon.sensors.medium"
		trigger = { has_country_flag = medium.15 }
		custom_tooltip = "shroud.boon.chances.medium"
		sensor_shroud_medium_2 = yes
	}

	### Low
	option = {
		name = "boon.upkeep.low"
		trigger = { has_country_flag = low.2 }
		custom_tooltip = "shroud.boon.chances.low"
		upkeep_shroud_low_2 = yes
	}
	option = {
		name = "boon.research.low"
		trigger = { has_country_flag = low.3 }
		custom_tooltip = "shroud.boon.chances.low"
		research_shroud_low_2 = yes
	}
	option = {
		name = "boon.shields.low"
		trigger = { has_country_flag = low.4 }
		custom_tooltip = "shroud.boon.chances.low"
		shields_shroud_low_2 = yes
	}
	option = {
		name = "boon.weapons.low"
		trigger = { has_country_flag = low.5 }
		custom_tooltip = "shroud.boon.chances.low"
		weapons_shroud_low_2 = yes
	}
	option = {
		name = "boon.firing.low"
		trigger = { has_country_flag = low.6 }
		custom_tooltip = "shroud.boon.chances.low"
		firingrate_shroud_low_2 = yes
	}
	option = {
		name = "boon.influence.low"
		trigger = { has_country_flag = low.8 }
		custom_tooltip = "shroud.boon.chances.low"
		influence_shroud_low_2 = yes
	}
	option = {
		name = "boon.unity.low"
		trigger = { has_country_flag = low.9 }
		custom_tooltip = "shroud.boon.chances.low"
		unity_shroud_low_2 = yes
	}
	option = {
		name = "boon.evasion.low"
		trigger = { has_country_flag = low.10 }
		custom_tooltip = "shroud.boon.chances.low"
		evasion_shroud_low_2 = yes
	}
	option = {
		name = "boon.repair.low"
		trigger = { has_country_flag = low.11 }
		custom_tooltip = "shroud.boon.chances.low"
		repair_shroud_low_2 = yes
	}
	option = {
		name = "boon.speed.low"
		trigger = { has_country_flag = low.13 }
		custom_tooltip = "shroud.boon.chances.low"
		speed_shroud_low_2 = yes
	}
	option = {
		name = "boon.sensors.low"
		trigger = { has_country_flag = low.15 }
		custom_tooltip = "shroud.boon.chances.low"
		sensor_shroud_low_2 = yes
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Vision 3
country_event = {
	id = endim.3120
	title = "endim.3000.name"
	desc = "endim.3120.desc"
	diplomatic = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		set_country_flag = shroud_vision_3
		randomize_shroud_flags = yes 
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
		remove_shroud_flags = yes
	}

	### High
	option = {
		name = "boon.upkeep.high"
		trigger = { has_country_flag = high.2 }
		custom_tooltip = "shroud.boon.chances.high"
		upkeep_shroud_high_2 = yes
	}
	option = {
		name = "boon.research.high"
		trigger = { has_country_flag = high.3 }
		custom_tooltip = "shroud.boon.chances.high"
		research_shroud_high_2 = yes
	}
	option = {
		name = "boon.shields.high"
		trigger = { has_country_flag = high.4 }
		custom_tooltip = "shroud.boon.chances.high"
		shields_shroud_high_2 = yes
	}
	option = {
		name = "boon.weapons.high"
		trigger = { has_country_flag = high.5 }
		custom_tooltip = "shroud.boon.chances.high"
		weapons_shroud_high_2 = yes
	}
	option = {
		name = "boon.firing.high"
		trigger = { has_country_flag = high.6 }
		custom_tooltip = "shroud.boon.chances.high"
		firingrate_shroud_high_2 = yes
	}
	option = {
		name = "boon.influence.high"
		trigger = { has_country_flag = high.8 }
		custom_tooltip = "shroud.boon.chances.high"
		influence_shroud_high_2 = yes
	}
	option = {
		name = "boon.unity.high"
		trigger = { has_country_flag = high.9 }
		custom_tooltip = "shroud.boon.chances.high"
		unity_shroud_high_2 = yes
	}
	option = {
		name = "boon.evasion.high"
		trigger = { has_country_flag = high.10 }
		custom_tooltip = "shroud.boon.chances.high"
		evasion_shroud_high_2 = yes
	}
	option = {
		name = "boon.repair.high"
		trigger = { has_country_flag = high.11 }
		custom_tooltip = "shroud.boon.chances.high"
		repair_shroud_high_2 = yes
	}
	option = {
		name = "boon.speed.high"
		trigger = { has_country_flag = high.13 }
		custom_tooltip = "shroud.boon.chances.high"
		speed_shroud_high_2 = yes
	}
	option = {
		name = "boon.sensors.high"
		trigger = { has_country_flag = high.15 }
		custom_tooltip = "shroud.boon.chances.high"
		sensor_shroud_high_2 = yes
	}
	option = {
		name = "shroud.avatar.high"
		trigger = { has_country_flag = high.16 }
		custom_tooltip = "shroud.boon.chances.high"
		avatar_shroud_high_2 = yes
	}

	### Medium
	option = {
		name = "boon.upkeep.medium"
		trigger = { has_country_flag = medium.2 }
		custom_tooltip = "shroud.boon.chances.medium"
		upkeep_shroud_medium_2 = yes
	}
	option = {
		name = "boon.research.medium"
		trigger = { has_country_flag = medium.3 }
		custom_tooltip = "shroud.boon.chances.medium"
		research_shroud_medium_2 = yes
	}
	option = {
		name = "boon.shields.medium"
		trigger = { has_country_flag = medium.4 }
		custom_tooltip = "shroud.boon.chances.medium"
		shields_shroud_medium_2 = yes
	}
	option = {
		name = "boon.weapons.medium"
		trigger = { has_country_flag = medium.5 }
		custom_tooltip = "shroud.boon.chances.medium"
		weapons_shroud_medium_2 = yes
	}
	option = {
		name = "boon.firing.medium"
		trigger = { has_country_flag = medium.6 }
		custom_tooltip = "shroud.boon.chances.medium"
		firingrate_shroud_medium_2 = yes
	}
	option = {
		name = "boon.influence.medium"
		trigger = { has_country_flag = medium.8 }
		custom_tooltip = "shroud.boon.chances.medium"
		influence_shroud_medium_2 = yes
	}
	option = {
		name = "boon.unity.medium"
		trigger = { has_country_flag = medium.9 }
		custom_tooltip = "shroud.boon.chances.medium"
		unity_shroud_medium_2 = yes
	}
	option = {
		name = "boon.evasion.medium"
		trigger = { has_country_flag = medium.10 }
		custom_tooltip = "shroud.boon.chances.medium"
		evasion_shroud_medium_2 = yes
	}
	option = {
		name = "boon.repair.medium"
		trigger = { has_country_flag = medium.11 }
		custom_tooltip = "shroud.boon.chances.medium"
		repair_shroud_medium_2 = yes
	}
	option = {
		name = "boon.speed.medium"
		trigger = { has_country_flag = medium.13 }
		custom_tooltip = "shroud.boon.chances.medium"
		speed_shroud_medium_2 = yes
	}
	option = {
		name = "boon.sensors.medium"
		trigger = { has_country_flag = medium.15 }
		custom_tooltip = "shroud.boon.chances.medium"
		sensor_shroud_medium_2 = yes
	}
	option = {
		name = "shroud.avatar.medium"
		trigger = { has_country_flag = medium.16 }
		custom_tooltip = "shroud.boon.chances.medium"
		avatar_shroud_medium_2 = yes
	}

	### Low
	option = {
		name = "boon.upkeep.low"
		trigger = { has_country_flag = low.2 }
		custom_tooltip = "shroud.boon.chances.low"
		upkeep_shroud_low_2 = yes
	}
	option = {
		name = "boon.research.low"
		trigger = { has_country_flag = low.3 }
		custom_tooltip = "shroud.boon.chances.low"
		research_shroud_low_2 = yes
	}
	option = {
		name = "boon.shields.low"
		trigger = { has_country_flag = low.4 }
		custom_tooltip = "shroud.boon.chances.low"
		shields_shroud_low_2 = yes
	}
	option = {
		name = "boon.weapons.low"
		trigger = { has_country_flag = low.5 }
		custom_tooltip = "shroud.boon.chances.low"
		weapons_shroud_low_2 = yes
	}
	option = {
		name = "boon.firing.low"
		trigger = { has_country_flag = low.6 }
		custom_tooltip = "shroud.boon.chances.low"
		firingrate_shroud_low_2 = yes
	}
	option = {
		name = "boon.influence.low"
		trigger = { has_country_flag = low.8 }
		custom_tooltip = "shroud.boon.chances.low"
		influence_shroud_low_2 = yes
	}
	option = {
		name = "boon.unity.low"
		trigger = { has_country_flag = low.9 }
		custom_tooltip = "shroud.boon.chances.low"
		unity_shroud_low_2 = yes
	}
	option = {
		name = "boon.evasion.low"
		trigger = { has_country_flag = low.10 }
		custom_tooltip = "shroud.boon.chances.low"
		evasion_shroud_low_2 = yes
	}
	option = {
		name = "boon.repair.low"
		trigger = { has_country_flag = low.11 }
		custom_tooltip = "shroud.boon.chances.low"
		repair_shroud_low_2 = yes
	}
	option = {
		name = "boon.speed.low"
		trigger = { has_country_flag = low.13 }
		custom_tooltip = "shroud.boon.chances.low"
		speed_shroud_low_2 = yes
	}
	option = {
		name = "boon.sensors.low"
		trigger = { has_country_flag = low.15 }
		custom_tooltip = "shroud.boon.chances.low"
		sensor_shroud_low_2 = yes
	}
	option = {
		name = "shroud.avatar.low"
		trigger = { has_country_flag = low.16 }
		custom_tooltip = "shroud.boon.chances.low"
		avatar_shroud_low_2 = yes
	}

	# Never mind
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Vision 4
country_event = {
	id = endim.3130
	title = "endim.3000.name"
	desc = "endim.3130.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		set_country_flag = shroud_vision_4
		randomize_shroud_flags = yes 
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
		remove_shroud_flags = yes
	}

	### High
	option = {
		name = "endim.3130.a"
		trigger = { has_country_flag = high.2 }
		upkeep_shroud_high_2 = yes
	}
	option = {
		name = "endim.3130.a"
		trigger = { has_country_flag = high.3 }
		research_shroud_high_2 = yes
	}
	option = {
		name = "endim.3130.a"
		trigger = { has_country_flag = high.4 }
		shields_shroud_high_2 = yes
	}
	option = {
		name = "endim.3130.a"
		trigger = { has_country_flag = high.5 }
		weapons_shroud_high_2 = yes
	}
	option = {
		name = "endim.3130.a"
		trigger = { has_country_flag = high.6 }
		firingrate_shroud_high_2 = yes
	}
	option = {
		name = "endim.3130.a"
		trigger = { has_country_flag = high.8 }
		influence_shroud_high_2 = yes
	}
	option = {
		name = "endim.3130.a"
		trigger = { has_country_flag = high.9 }
		unity_shroud_high_2 = yes
	}
	option = {
		name = "endim.3130.a"
		trigger = { has_country_flag = high.10 }
		evasion_shroud_high_2 = yes
	}
	option = {
		name = "endim.3130.a"
		trigger = { has_country_flag = high.11 }
		repair_shroud_high_2 = yes
	}
	option = {
		name = "endim.3130.a"
		trigger = { has_country_flag = high.13 }
		speed_shroud_high_2 = yes
	}
	option = {
		name = "endim.3130.a"
		trigger = { has_country_flag = high.15 }
		sensor_shroud_high_2 = yes
	}
	option = {
		name = "endim.3130.a"
		trigger = { has_country_flag = high.16 }
		avatar_shroud_high_2 = yes
	}

	### Medium
	option = {
		name = "endim.3130.b"
		trigger = { has_country_flag = medium.2 }
		upkeep_shroud_medium_2 = yes
	}
	option = {
		name = "endim.3130.b"
		trigger = { has_country_flag = medium.3 }
		research_shroud_medium_2 = yes
	}
	option = {
		name = "endim.3130.b"
		trigger = { has_country_flag = medium.4 }
		shields_shroud_medium_2 = yes
	}
	option = {
		name = "endim.3130.b"
		trigger = { has_country_flag = medium.5 }
		weapons_shroud_medium_2 = yes
	}
	option = {
		name = "endim.3130.b"
		trigger = { has_country_flag = medium.6 }
		firingrate_shroud_medium_2 = yes
	}
	option = {
		name = "endim.3130.b"
		trigger = { has_country_flag = medium.8 }
		influence_shroud_medium_2 = yes
	}
	option = {
		name = "endim.3130.b"
		trigger = { has_country_flag = medium.9 }
		unity_shroud_medium_2 = yes
	}
	option = {
		name = "endim.3130.b"
		trigger = { has_country_flag = medium.10 }
		evasion_shroud_medium_2 = yes
	}
	option = {
		name = "endim.3130.b"
		trigger = { has_country_flag = medium.11 }
		repair_shroud_medium_2 = yes
	}
	option = {
		name = "endim.3130.b"
		trigger = { has_country_flag = medium.13 }
		speed_shroud_medium_2 = yes
	}
	option = {
		name = "endim.3130.b"
		trigger = { has_country_flag = medium.15 }
		sensor_shroud_medium_2 = yes
	}
	option = {
		name = "endim.3130.b"
		trigger = { has_country_flag = medium.16 }
		avatar_shroud_medium_2 = yes
	}

	### Low
	option = {
		name = "endim.3130.c"
		trigger = { has_country_flag = low.2 }
		upkeep_shroud_low_2 = yes
	}
	option = {
		name = "endim.3130.c"
		trigger = { has_country_flag = low.3 }
		research_shroud_low_2 = yes
	}
	option = {
		name = "endim.3130.c"
		trigger = { has_country_flag = low.4 }
		shields_shroud_low_2 = yes
	}
	option = {
		name = "endim.3130.c"
		trigger = { has_country_flag = low.5 }
		weapons_shroud_low_2 = yes
	}
	option = {
		name = "endim.3130.c"
		trigger = { has_country_flag = low.6 }
		firingrate_shroud_low_2 = yes
	}
	option = {
		name = "endim.3130.c"
		trigger = { has_country_flag = low.8 }
		influence_shroud_low_2 = yes
	}
	option = {
		name = "endim.3130.c"
		trigger = { has_country_flag = low.9 }
		unity_shroud_low_2 = yes
	}
	option = {
		name = "endim.3130.c"
		trigger = { has_country_flag = low.10 }
		evasion_shroud_low_2 = yes
	}
	option = {
		name = "endim.3130.c"
		trigger = { has_country_flag = low.11 }
		repair_shroud_low_2 = yes
	}
	option = {
		name = "endim.3130.c"
		trigger = { has_country_flag = low.13 }
		speed_shroud_low_2 = yes
	}
	option = {
		name = "endim.3130.c"
		trigger = { has_country_flag = low.15 }
		sensor_shroud_low_2 = yes
	}
	option = {
		name = "endim.3130.c"
		trigger = { has_country_flag = low.16 }
		avatar_shroud_low_2 = yes
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Vision 5
country_event = {
	id = endim.3140
	title = "endim.3000.name"
	desc = "endim.3140.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		set_country_flag = shroud_vision_5
		randomize_shroud_flags = yes 
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
		remove_shroud_flags = yes
	}

	### High
	option = {
		name = "boon.upkeep.high"
		trigger = { has_country_flag = high.2 }
		custom_tooltip = "shroud.boon.chances.high"
		upkeep_shroud_high_2 = yes
	}
	option = {
		name = "boon.research.high"
		trigger = { has_country_flag = high.3 }
		custom_tooltip = "shroud.boon.chances.high"
		research_shroud_high_2 = yes
	}
	option = {
		name = "boon.shields.high"
		trigger = { has_country_flag = high.4 }
		custom_tooltip = "shroud.boon.chances.high"
		shields_shroud_high_2 = yes
	}
	option = {
		name = "boon.weapons.high"
		trigger = { has_country_flag = high.5 }
		custom_tooltip = "shroud.boon.chances.high"
		weapons_shroud_high_2 = yes
	}
	option = {
		name = "boon.firing.high"
		trigger = { has_country_flag = high.6 }
		custom_tooltip = "shroud.boon.chances.high"
		firingrate_shroud_high_2 = yes
	}
	option = {
		name = "boon.influence.high"
		trigger = { has_country_flag = high.8 }
		custom_tooltip = "shroud.boon.chances.high"
		influence_shroud_high_2 = yes
	}
	option = {
		name = "boon.unity.high"
		trigger = { has_country_flag = high.9 }
		custom_tooltip = "shroud.boon.chances.high"
		unity_shroud_high_2 = yes
	}
	option = {
		name = "boon.evasion.high"
		trigger = { has_country_flag = high.10 }
		custom_tooltip = "shroud.boon.chances.high"
		evasion_shroud_high_2 = yes
	}
	option = {
		name = "boon.repair.high"
		trigger = { has_country_flag = high.11 }
		custom_tooltip = "shroud.boon.chances.high"
		repair_shroud_high_2 = yes
	}
	option = {
		name = "boon.speed.high"
		trigger = { has_country_flag = high.13 }
		custom_tooltip = "shroud.boon.chances.high"
		speed_shroud_high_2 = yes
	}
	option = {
		name = "boon.sensors.high"
		trigger = { has_country_flag = high.15 }
		custom_tooltip = "shroud.boon.chances.high"
		sensor_shroud_high_2 = yes
	}
	option = {
		name = "shroud.avatar.high"
		trigger = { has_country_flag = high.16 }
		custom_tooltip = "shroud.boon.chances.high"
		avatar_shroud_high_2 = yes
	}

	### Medium
	option = {
		name = "boon.upkeep.medium"
		trigger = { has_country_flag = medium.2 }
		custom_tooltip = "shroud.boon.chances.medium"
		upkeep_shroud_medium_2 = yes
	}
	option = {
		name = "boon.research.medium"
		trigger = { has_country_flag = medium.3 }
		custom_tooltip = "shroud.boon.chances.medium"
		research_shroud_medium_2 = yes
	}
	option = {
		name = "boon.shields.medium"
		trigger = { has_country_flag = medium.4 }
		custom_tooltip = "shroud.boon.chances.medium"
		shields_shroud_medium_2 = yes
	}
	option = {
		name = "boon.weapons.medium"
		trigger = { has_country_flag = medium.5 }
		custom_tooltip = "shroud.boon.chances.medium"
		weapons_shroud_medium_2 = yes
	}
	option = {
		name = "boon.firing.medium"
		trigger = { has_country_flag = medium.6 }
		custom_tooltip = "shroud.boon.chances.medium"
		firingrate_shroud_medium_2 = yes
	}
	option = {
		name = "boon.influence.medium"
		trigger = { has_country_flag = medium.8 }
		custom_tooltip = "shroud.boon.chances.medium"
		influence_shroud_medium_2 = yes
	}
	option = {
		name = "boon.unity.medium"
		trigger = { has_country_flag = medium.9 }
		custom_tooltip = "shroud.boon.chances.medium"
		unity_shroud_medium_2 = yes
	}
	option = {
		name = "boon.evasion.medium"
		trigger = { has_country_flag = medium.10 }
		custom_tooltip = "shroud.boon.chances.medium"
		evasion_shroud_medium_2 = yes
	}
	option = {
		name = "boon.repair.medium"
		trigger = { has_country_flag = medium.11 }
		custom_tooltip = "shroud.boon.chances.medium"
		repair_shroud_medium_2 = yes
	}
	option = {
		name = "boon.speed.medium"
		trigger = { has_country_flag = medium.13 }
		custom_tooltip = "shroud.boon.chances.medium"
		speed_shroud_medium_2 = yes
	}
	option = {
		name = "boon.sensors.medium"
		trigger = { has_country_flag = medium.15 }
		custom_tooltip = "shroud.boon.chances.medium"
		sensor_shroud_medium_2 = yes
	}
	option = {
		name = "shroud.avatar.medium"
		trigger = { has_country_flag = medium.16 }
		custom_tooltip = "shroud.boon.chances.medium"
		avatar_shroud_medium_2 = yes
	}

	### Low
	option = {
		name = "boon.upkeep.low"
		trigger = { has_country_flag = low.2 }
		custom_tooltip = "shroud.boon.chances.low"
		upkeep_shroud_low_2 = yes
	}
	option = {
		name = "boon.research.low"
		trigger = { has_country_flag = low.3 }
		custom_tooltip = "shroud.boon.chances.low"
		research_shroud_low_2 = yes
	}
	option = {
		name = "boon.shields.low"
		trigger = { has_country_flag = low.4 }
		custom_tooltip = "shroud.boon.chances.low"
		shields_shroud_low_2 = yes
	}
	option = {
		name = "boon.weapons.low"
		trigger = { has_country_flag = low.5 }
		custom_tooltip = "shroud.boon.chances.low"
		weapons_shroud_low_2 = yes
	}
	option = {
		name = "boon.firing.low"
		trigger = { has_country_flag = low.6 }
		custom_tooltip = "shroud.boon.chances.low"
		firingrate_shroud_low_2 = yes
	}
	option = {
		name = "boon.influence.low"
		trigger = { has_country_flag = low.8 }
		custom_tooltip = "shroud.boon.chances.low"
		influence_shroud_low_2 = yes
	}
	option = {
		name = "boon.unity.low"
		trigger = { has_country_flag = low.9 }
		custom_tooltip = "shroud.boon.chances.low"
		unity_shroud_low_2 = yes
	}
	option = {
		name = "boon.evasion.low"
		trigger = { has_country_flag = low.10 }
		custom_tooltip = "shroud.boon.chances.low"
		evasion_shroud_low_2 = yes
	}
	option = {
		name = "boon.repair.low"
		trigger = { has_country_flag = low.11 }
		custom_tooltip = "shroud.boon.chances.low"
		repair_shroud_low_2 = yes
	}
	option = {
		name = "boon.speed.low"
		trigger = { has_country_flag = low.13 }
		custom_tooltip = "shroud.boon.chances.low"
		speed_shroud_low_2 = yes
	}
	option = {
		name = "boon.sensors.low"
		trigger = { has_country_flag = low.15 }
		custom_tooltip = "shroud.boon.chances.low"
		sensor_shroud_low_2 = yes
	}
	option = {
		name = "shroud.avatar.low"
		trigger = { has_country_flag = low.16 }
		custom_tooltip = "shroud.boon.chances.low"
		avatar_shroud_low_2 = yes
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Vision 6 - Fallen Empire
country_event = {
	id = endim.3150
	title = "endim.3000.name"
	desc = "endim.3150.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		random_country = {
			limit = {
				is_country_type = fallen_empire
				NOT = { has_ethic = ethic_gestalt_consciousness }
				NOT = { is_at_war_with = root }
				has_communications = root
			}
			save_event_target_as = fallen_empire
		}
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "endim.3150.a"
		custom_tooltip = "shroud.unknown.chances.medium"
		hidden_effect = {
			random_list = {
				60 = {
					country_event = { id = endim.3151 }
				}
				40 = {
					modifier = {
						factor = 0.5
						has_relic = r_zro_crystal
					}
					country_Event = { id = endim.3152 }
				}
			}
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Stole Secrets
country_event = {
	id = endim.3151
	title = "endim.3000.name"
	desc = { text = endim.3151.v1.desc }
	desc = { text = endim.3151.v2.desc }
	desc = { text = endim.3151.v3.desc }
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		set_country_flag = shroud_fallen_empire
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		give_fe_tech = yes
		default_hide_option = yes
	}
}

# Failed to Steal Secrets
country_event = {
	id = endim.3152
	title = "endim.3000.name"
	desc = "endim.3152.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		set_country_flag = shroud_fallen_empire
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
		hidden_effect = {
			country_event = { id = endim.3153 days = 20 random = 15 }
		}
	}
}

# Diplomatic Consequences
country_event = {
	id = endim.3153
	title = "TRANSMISSION"
	desc = "endim.3153.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = event_target:fallen_empire
		room = event_target:fallen_empire
	}
	
	is_triggered_only = yes

	immediate = {
		event_target:fallen_empire = {
			add_opinion_modifier = {
				who = root 
				modifier = opinion_invaded_mind
			}
		}
	}

	option = {
		name = "endim.3053.a"
		tooltip = {
			event_target:fallen_empire = {
				add_opinion_modifier = {
					who = root 
					modifier = opinion_invaded_mind
				}
			}
		}
	}
}

# Vision 7 - Psi Jump Drives
country_event = {
	id = endim.3160
	title = "endim.3000.name"
	desc = "endim.3160.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "endim.3160.a"
		custom_tooltip = "shroud.unknown.chances.medium"
		hidden_effect = {
			random_list = {
				60 = { country_event = { id = endim.3161 } }
				40 = { 
					modifier = {
						factor = 0.5
						has_relic = r_zro_crystal
					}
					country_event = { id = endim.3162 } 
				}
			}
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Success
country_event = {
	id = endim.3161
	title = "endim.3161.name"
	desc = "endim.3161.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		if = {
			limit = { has_authority = auth_machine_intelligence }
			add_research_option = tech_psi_jump_drive_machinedlcmod
			else = { add_research_option = tech_psi_jump_drive_1 }
		}
		default_hide_option = yes
	}
}

# Failure
country_event = {
	id = endim.3162
	title = "curse.bestowed"
	desc = "endim.3162.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		default_hide_option = yes
		add_modifier = {
			modifier = "shroud_neg_speed"
			days = 1800
		}
	}
}

# Vision 8 - Psionic Shield
country_event = {
	id = endim.3170
	title = "endim.3000.name"
	desc = "endim.3170.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "endim.3170.a"
		custom_tooltip = "shroud.unknown.chances.medium"
		hidden_effect = {
			random_list = {
				60 = {
					country_event = { id = endim.3171 }
				}
				40 = {
					modifier = {
						factor = 0.5
						has_relic = r_zro_crystal
					}
					country_Event = { id = endim.3172 }
				}
			}
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Shield Penetrated
country_event = {
	id = endim.3171
	title = "endim.3171.name"
	desc = "endim.3171.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		if = {
			limit = { has_authority = auth_machine_intelligence }
			add_research_option = tech_psionic_shield_machinedlcmod
			else = { add_research_option = tech_psionic_shield }
		}
		default_hide_option = yes
	}
}

# Failed to Penetrate Shield
country_event = {
	id = endim.3172
	title = "endim.3000.name"
	desc = "endim.3172.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		hidden_effect = {
			country_event = { id = endim.3024 }
		}
		default_hide_option = yes
	}
}

# Vision 9 - Precognition Interface
country_event = {
	id = endim.3180
	title = "endim.3000.name"
	desc = "endim.3180.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "endim.3180.a"
		custom_tooltip = "shroud.unknown.chances.medium"
		hidden_effect = {
			random_list = {
				60 = {
					country_event = { id = endim.3181 }
				}
				40 = {
					modifier = {
						factor = 0.5
						has_relic = r_zro_crystal
					}
					country_Event = { id = endim.3182 }
				}
			}
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Success
country_event = {
	id = endim.3181
	title = "endim.3181.name"
	desc = "endim.3181.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		if = {
			limit = { has_authority = auth_machine_intelligence }
			add_research_option = tech_precognition_interface_machinedlcmod
			else = { add_research_option = tech_precognition_interface }
		}
		default_hide_option = yes
	}
}

# Failure
country_event = {
	id = endim.3182
	title = "endim.3000.name"
	desc = "endim.3182.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		default_hide_option = yes
		hidden_effect = {
			remove_modifier = "shroud_cooldown_2" #changed for this mod
			if = {
				limit = { 
					has_relic = r_zro_crystal
				}
				add_modifier = {
					modifier = "shroud_precog_cooldown_2" #changed for this mod
					days = 1800
				}
				country_event = { id = endim.2 days = 1800 }
			}				
			else = {
				add_modifier = {
					modifier = "shroud_precog_cooldown_2" #changed for this mod
					days = 3600
				}
				country_event = { id = endim.2 days = 3600 }
			}
		}
	}
}

# Vision 10
country_event = {
	id = endim.3190
	title = "endim.3000.name"
	desc = "endim.3190.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		random_owned_leader = {
			limit = { leader_class = ruler }
			save_event_target_as = leader_1
			random_list = {
				33 = { set_leader_flag = high_psi }
				33 = { set_leader_flag = medium_psi }
				33 = { set_leader_flag = low_psi }
			}
		}
		random_owned_leader = {
			limit = {
				NOT = { is_same_value = event_target:leader_1 } 
			}
			save_event_target_as = leader_2
			random_list = {
				33 = { set_leader_flag = high_psi }
				33 = { set_leader_flag = medium_psi }
				33 = { set_leader_flag = low_psi }
			}
		}
		random_owned_leader = {
			limit = {
				NOR = { 
					is_same_value = event_target:leader_1
					is_same_value = event_target:leader_2
				} 
			}
			save_event_target_as = leader_3
			random_list = {
				33 = { set_leader_flag = high_psi }
				33 = { set_leader_flag = medium_psi }
				33 = { set_leader_flag = low_psi }
			}
		}
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			event_target:leader_1 = {
				remove_leader_flag = high_psi
				remove_leader_flag = medium_psi
				remove_leader_flag = low_psi
			}
			event_target:leader_2 = {
				remove_leader_flag = high_psi
				remove_leader_flag = medium_psi
				remove_leader_flag = low_psi
			}
			event_target:leader_3 = {
				remove_leader_flag = high_psi
				remove_leader_flag = medium_psi
				remove_leader_flag = low_psi
			}
		}
	}

	option = {
		name = "endim.3190.1.a"
		custom_tooltip = "shroud.unknown.chances.high"
		trigger = {
			event_target:leader_1 = { has_leader_flag = high_psi }
		}
		event_target:leader_1 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				70 = { country_event = { id = endim.3191 }}
				20 = { country_event = { id = endim.3192 }}
				10 = { country_event = { id = endim.3193 }}
			}
		}
	}
	option = {
		name = "endim.3190.2.a"
		custom_tooltip = "shroud.unknown.chances.medium"
		trigger = {
			event_target:leader_1 = { has_leader_flag = medium_psi }
		}
		event_target:leader_1 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				50 = { country_event = { id = endim.3191 }}
				30 = { country_event = { id = endim.3192 }}
				20 = { country_event = { id = endim.3193 }}
			}
		}
	}
	option = {
		name = "endim.3190.3.a"
		custom_tooltip = "shroud.unknown.chances.low"
		trigger = {
			event_target:leader_1 = { has_leader_flag = low_psi }
		}
		event_target:leader_1 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				30 = { country_event = { id = endim.3191 }}
				40 = { country_event = { id = endim.3192 }}
				30 = { country_event = { id = endim.3193 }}
			}
		}
	}
	option = {
		name = "endim.3190.1.b"
		custom_tooltip = "shroud.unknown.chances.high"
		trigger = {
			event_target:leader_2 = { has_leader_flag = high_psi }
		}
		event_target:leader_2 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				70 = { country_event = { id = endim.3191 }}
				20 = { country_event = { id = endim.3192 }}
				10 = { country_event = { id = endim.3193 }}
			}
		}
	}
	option = {
		name = "endim.3190.2.b"
		custom_tooltip = "shroud.unknown.chances.medium"
		trigger = {
			event_target:leader_2 = { has_leader_flag = medium_psi }
		}
		event_target:leader_2 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				50 = { country_event = { id = endim.3191 }}
				30 = { country_event = { id = endim.3192 }}
				20 = { country_event = { id = endim.3193 }}
			}
		}
	}
	option = {
		name = "endim.3190.3.b"
		custom_tooltip = "shroud.unknown.chances.low"
		trigger = {
			event_target:leader_2 = { has_leader_flag = low_psi }
		}
		event_target:leader_2 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				30 = { country_event = { id = endim.3191 }}
				40 = { country_event = { id = endim.3192 }}
				30 = { country_event = { id = endim.3193 }}
			}
		}
	}

	option = {
		name = "endim.3190.1.c"
		custom_tooltip = "shroud.unknown.chances.high"
		trigger = {
			event_target:leader_3 = { has_leader_flag = high_psi }
		}
		event_target:leader_3 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				70 = { country_event = { id = endim.3191 }}
				20 = { country_event = { id = endim.3192 }}
				10 = { 
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = endim.3193 }
				}
			}
		}
	}
	option = {
		name = "endim.3190.2.c"
		custom_tooltip = "shroud.unknown.chances.medium"
		trigger = {
			event_target:leader_3 = { has_leader_flag = medium_psi }
		}
		event_target:leader_3 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				50 = { country_event = { id = endim.3191 }}
				30 = { country_event = { id = endim.3192 }}
				20 = { 
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = endim.3193 }
				}
			}
		}
	}
	option = {
		name = "endim.3190.3.c"
		custom_tooltip = "shroud.unknown.chances.low"
		trigger = {
			event_target:leader_3 = { has_leader_flag = low_psi }
		}
		event_target:leader_3 = { save_event_target_as = chosen_leader }
		hidden_effect = {
			random_list = {
				30 = { country_event = { id = endim.3191 }}
				40 = { country_event = { id = endim.3192 }}
				30 = { 
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					country_event = { id = endim.3193 }
				}
			}
		}
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Success
country_event = {
	id = endim.3191
	title = "endim.3000.name"
	desc = "endim.3191.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		set_country_flag = shroud_vision_10
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		default_hide_option = yes
		if = {
			limit = { event_target:chosen_leader = { leader_class = admiral } }
			event_target:chosen_leader = { 
				add_trait = leader_trait_admiral_chosen #changed for this mod
			}
			break = yes
		}
		if = {
			limit = { event_target:chosen_leader = { leader_class = general } }
			event_target:chosen_leader = { 
				add_trait = leader_trait_general_chosen #changed for this mod
			}
			break = yes
		}
		if = {
			limit = { event_target:chosen_leader = { leader_class = governor } }
			event_target:chosen_leader = { 
				add_trait = leader_trait_governor_chosen #changed for this mod 
			}
			break = yes
		}
		if = {
			limit = { event_target:chosen_leader = { leader_class = ruler } }
			event_target:chosen_leader = { 
				add_ruler_trait = leader_trait_ruler_chosen_2 #changed for this mod
			}
			break = yes
		}
		if = {
			limit = { event_target:chosen_leader = { leader_class = scientist } }
			event_target:chosen_leader = { 
				add_trait = leader_trait_scientist_chosen #changed for this mod
			}
			break = yes
		}
	}
}

# Failure
country_event = {
	id = endim.3192
	title = "endim.3000.name"
	desc = "endim.3192.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		event_target:chosen_leader = {
			kill_leader = { show_notification = no }
		}
		default_hide_option = yes
	}
}

# Critical Failure
country_event = {
	id = endim.3193
	title = "endim.3000.name"
	desc = "endim.3193.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		event_target:chosen_leader = {
			kill_leader = { show_notification = no }
		}
		hidden_effect = {
			country_event = { id = endim.3024 }
		}
		default_hide_option = yes
	}
}

# Generic Vision
country_event = {
	id = endim.3200
	title = "endim.3000.name"
	desc = { text = endim.3200.1.desc }
	desc = { text = endim.3200.2.desc }
	desc = { text = endim.3200.3.desc }
	desc = { text = endim.3200.4.desc }
	desc = { text = endim.3200.5.desc }
	desc = { text = endim.3200.6.desc }
	desc = { text = endim.3200.7.desc }
	desc = { text = endim.3200.8.desc }
	desc = { text = endim.3200.9.desc }
	
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		randomize_shroud_flags = yes 
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
		remove_shroud_flags = yes
	}

	### High
	option = {
		name = "boon.upkeep.high"
		trigger = { has_country_flag = high.2 }
		custom_tooltip = "shroud.boon.chances.high"
		upkeep_shroud_high_2 = yes
	}
	option = {
		name = "boon.research.high"
		trigger = { has_country_flag = high.3 }
		custom_tooltip = "shroud.boon.chances.high"
		research_shroud_high_2 = yes
	}
	option = {
		name = "boon.shields.high"
		trigger = { has_country_flag = high.4 }
		custom_tooltip = "shroud.boon.chances.high"
		shields_shroud_high_2 = yes
	}
	option = {
		name = "boon.weapons.high"
		trigger = { has_country_flag = high.5 }
		custom_tooltip = "shroud.boon.chances.high"
		weapons_shroud_high_2 = yes
	}
	option = {
		name = "boon.firing.high"
		trigger = { has_country_flag = high.6 }
		custom_tooltip = "shroud.boon.chances.high"
		firingrate_shroud_high_2 = yes
	}
	option = {
		name = "boon.influence.high"
		trigger = { has_country_flag = high.8 }
		custom_tooltip = "shroud.boon.chances.high"
		influence_shroud_high_2 = yes
	}
	option = {
		name = "boon.unity.high"
		trigger = { has_country_flag = high.9 }
		custom_tooltip = "shroud.boon.chances.high"
		unity_shroud_high_2 = yes
	}
	option = {
		name = "boon.evasion.high"
		trigger = { has_country_flag = high.10 }
		custom_tooltip = "shroud.boon.chances.high"
		evasion_shroud_high_2 = yes
	}
	option = {
		name = "boon.repair.high"
		trigger = { has_country_flag = high.11 }
		custom_tooltip = "shroud.boon.chances.high"
		repair_shroud_high_2 = yes
	}
	option = {
		name = "boon.speed.high"
		trigger = { has_country_flag = high.13 }
		custom_tooltip = "shroud.boon.chances.high"
		speed_shroud_high_2 = yes
	}
	option = {
		name = "boon.sensors.high"
		trigger = { has_country_flag = high.15 }
		custom_tooltip = "shroud.boon.chances.high"
		sensor_shroud_high_2 = yes
	}
	option = {
		name = "shroud.avatar.high"
		trigger = { has_country_flag = high.16 }
		custom_tooltip = "shroud.boon.chances.high"
		avatar_shroud_high_2 = yes
	}

	### Medium
	option = {
		name = "boon.upkeep.medium"
		trigger = { has_country_flag = medium.2 }
		custom_tooltip = "shroud.boon.chances.medium"
		upkeep_shroud_medium_2 = yes
	}
	option = {
		name = "boon.research.medium"
		trigger = { has_country_flag = medium.3 }
		custom_tooltip = "shroud.boon.chances.medium"
		research_shroud_medium_2 = yes
	}
	option = {
		name = "boon.shields.medium"
		trigger = { has_country_flag = medium.4 }
		custom_tooltip = "shroud.boon.chances.medium"
		shields_shroud_medium_2 = yes
	}
	option = {
		name = "boon.weapons.medium"
		trigger = { has_country_flag = medium.5 }
		custom_tooltip = "shroud.boon.chances.medium"
		weapons_shroud_medium_2 = yes
	}
	option = {
		name = "boon.firing.medium"
		trigger = { has_country_flag = medium.6 }
		custom_tooltip = "shroud.boon.chances.medium"
		firingrate_shroud_medium_2 = yes
	}
	option = {
		name = "boon.influence.medium"
		trigger = { has_country_flag = medium.8 }
		custom_tooltip = "shroud.boon.chances.medium"
		influence_shroud_medium_2 = yes
	}
	option = {
		name = "boon.unity.medium"
		trigger = { has_country_flag = medium.9 }
		custom_tooltip = "shroud.boon.chances.medium"
		unity_shroud_medium_2 = yes
	}
	option = {
		name = "boon.evasion.medium"
		trigger = { has_country_flag = medium.10 }
		custom_tooltip = "shroud.boon.chances.medium"
		evasion_shroud_medium_2 = yes
	}
	option = {
		name = "boon.repair.medium"
		trigger = { has_country_flag = medium.11 }
		custom_tooltip = "shroud.boon.chances.medium"
		repair_shroud_medium_2 = yes
	}
	option = {
		name = "boon.speed.medium"
		trigger = { has_country_flag = medium.13 }
		custom_tooltip = "shroud.boon.chances.medium"
		speed_shroud_medium_2 = yes
	}
	option = {
		name = "boon.sensors.medium"
		trigger = { has_country_flag = medium.15 }
		custom_tooltip = "shroud.boon.chances.medium"
		sensor_shroud_medium_2 = yes
	}
	option = {
		name = "shroud.avatar.medium"
		trigger = { has_country_flag = medium.16 }
		custom_tooltip = "shroud.boon.chances.medium"
		avatar_shroud_medium_2 = yes
	}

	### Low

	option = {
		name = "boon.upkeep.low"
		trigger = { has_country_flag = low.2 }
		custom_tooltip = "shroud.boon.chances.low"
		upkeep_shroud_low_2 = yes
	}
	option = {
		name = "boon.research.low"
		trigger = { has_country_flag = low.3 }
		custom_tooltip = "shroud.boon.chances.low"
		research_shroud_low_2 = yes
	}
	option = {
		name = "boon.shields.low"
		trigger = { has_country_flag = low.4 }
		custom_tooltip = "shroud.boon.chances.low"
		shields_shroud_low_2 = yes
	}
	option = {
		name = "boon.weapons.low"
		trigger = { has_country_flag = low.5 }
		custom_tooltip = "shroud.boon.chances.low"
		weapons_shroud_low_2 = yes
	}
	option = {
		name = "boon.firing.low"
		trigger = { has_country_flag = low.6 }
		custom_tooltip = "shroud.boon.chances.low"
		firingrate_shroud_low_2 = yes
	}
	option = {
		name = "boon.influence.low"
		trigger = { has_country_flag = low.8 }
		custom_tooltip = "shroud.boon.chances.low"
		influence_shroud_low_2 = yes
	}
	option = {
		name = "boon.unity.low"
		trigger = { has_country_flag = low.9 }
		custom_tooltip = "shroud.boon.chances.low"
		unity_shroud_low_2 = yes
	}
	option = {
		name = "boon.evasion.low"
		trigger = { has_country_flag = low.10 }
		custom_tooltip = "shroud.boon.chances.low"
		evasion_shroud_low_2 = yes
	}
	option = {
		name = "boon.repair.low"
		trigger = { has_country_flag = low.11 }
		custom_tooltip = "shroud.boon.chances.low"
		repair_shroud_low_2 = yes
	}
	option = {
		name = "boon.speed.low"
		trigger = { has_country_flag = low.13 }
		custom_tooltip = "shroud.boon.chances.low"
		speed_shroud_low_2 = yes
	}
	option = {
		name = "boon.sensors.low"
		trigger = { has_country_flag = low.15 }
		custom_tooltip = "shroud.boon.chances.low"
		sensor_shroud_low_2 = yes
	}
	option = {
		name = "shroud.avatar.low"
		trigger = { has_country_flag = low.16 }
		custom_tooltip = "shroud.boon.chances.low"
		avatar_shroud_low_2 = yes
	}

	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Patron Spirit
country_event = {
	id = endim.3300
	title = "endim.3000.name"
	desc = "endim.3300.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		if = {
			limit = {
				any_owned_leader = {
					OR = {
						has_trait = leader_trait_admiral_chosen
						has_trait = leader_trait_general_chosen
						has_trait = leader_trait_governor_chosen
						has_trait = leader_trait_ruler_chosen_2
						has_trait = leader_trait_scientist_chosen	
					}
				}
			}
			random_owned_leader = {
				limit = {
					OR = {
						has_trait = leader_trait_admiral_chosen
						has_trait = leader_trait_general_chosen
						has_trait = leader_trait_governor_chosen
						has_trait = leader_trait_ruler_chosen_2
						has_trait = leader_trait_scientist_chosen			
					}				
				}
				save_event_target_as = chosen_one
			}
			set_country_flag = has_chosen_one
		}		
		else = {
			random_list = {
				33 = { 
					modifier = {
						factor = 2
						has_relic = r_zro_crystal
					}
					set_country_flag = patron_deity_chance_high 
				}
				33 = { set_country_flag = patron_deity_chance_medium }
				33 = { 
					modifier = {
						factor = 0.5
						has_relic = r_zro_crystal
					}
					set_country_flag = patron_deity_chance_low 
				}
			}			
		}
	}
	
	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
			remove_country_flag = patron_deity_chance_high
			remove_country_flag = patron_deity_chance_medium
			remove_country_flag = patron_deity_chance_low
		}
	}
	
	option = {
		name = "endim.3300.1.a"
		custom_tooltip = "shroud.unknown.chances.high"
		trigger = {
			has_country_flag = patron_deity_chance_high
		}
		hidden_effect = {
			random_list = {
				70 = { country_event = { id = endim.3303 }}
				20 = { country_event = { id = endim.3302 }}
				10 = { country_event = { id = endim.3301 }}
			}
		}
	}
	option = {
		name = "endim.3300.1.b"
		custom_tooltip = "shroud.unknown.chances.medium"
		trigger = {
			has_country_flag = patron_deity_chance_medium
		}
		hidden_effect = {
			random_list = {
				50 = { country_event = { id = endim.3303 }}
				30 = { country_event = { id = endim.3302 }}
				20 = { country_event = { id = endim.3301 }}
			}
		}
	}
	option = {
		name = "endim.3300.1.c"
		custom_tooltip = "shroud.unknown.chances.low"
		trigger = {
			has_country_flag = patron_deity_chance_low
		}
		hidden_effect = {
			random_list = {
				30 = { country_event = { id = endim.3303 }}
				40 = { country_event = { id = endim.3302 }}
				30 = { country_event = { id = endim.3301 }}
			}
		}
	}
	option = {
		name = "endim.3300.1.d"
		custom_tooltip = "shroud.unknown.chances.high"
		trigger = {
			has_country_flag = has_chosen_one
		}
		hidden_effect = {
			random_list = {
				85 = { country_event = { id = endim.3303 }}
				10 = { country_event = { id = endim.3302 }}
				5 = { country_event = { id = endim.3301 }}
			}
		}
	}	
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Failure
country_event = {
	id = endim.3301
	title = "endim.3000.name"
	desc = "endim.3301.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		default_hide_option = yes
	}
}

# Critical Failure
country_event = {
	id = endim.3302
	title = "endim.3000.name"
	desc = "endim.3302.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
		random_owned_leader = {
			limit = {
				OR = {
					has_trait = leader_trait_admiral_chosen
					has_trait = leader_trait_general_chosen
					has_trait = leader_trait_governor_chosen
					has_trait = leader_trait_ruler_chosen_2
					has_trait = leader_trait_scientist_chosen
					has_trait = leader_trait_admiral_psionic
					has_trait = leader_trait_general_psionic
					has_trait = leader_trait_governor_psionic
					has_trait = leader_trait_ruler_psionic
					has_trait = leader_trait_scientist_psionic				
				}			
			}
			save_event_target_as = leader_to_kill
		}
	}

	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}

	option = {
		name = "exit.shroud"
		default_hide_option = yes
		event_target:leader_to_kill = {
			kill_leader = { show_notification = no }
		}
	}
}

# Pick a Patron to contact
country_event = {
	id = endim.3303
	
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			25 = { country_event = { id = endim.3304 } }	# The Whisperers in the Void
			25 = { country_event = { id = endim.3305 } }	# The Composer of Strands
			25 = { country_event = { id = endim.3306 } }	# The Eater of Worlds
			25 = { country_event = { id = endim.3307 } }	# The Instrument of Desire
			2 = {
				if = {
					limit = {
						NOT = { has_global_flag = end_of_the_cycle }
					}
					country_event = { id = endim.3308 }  # The End of the Cycle - extremely rare
				}
				else = {
					random_list = {
						25 = { country_event = { id = endim.3304 } }	# The Whisperers in the Void
						25 = { country_event = { id = endim.3305 } }	# The Composer of Strands
						25 = { country_event = { id = endim.3306 } }	# The Eater of Worlds
						25 = { country_event = { id = endim.3307 } }	# The Instrument of Desire		
					}
				}					
			}	
		}
	}
}

# The Whisperers in the Void
country_event = {
	id = endim.3304
	title = "endim.3000.name"
	desc = "endim.3304.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}
	
	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}
	
	option = {
		name = "endim.3304.a"
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_whisperers_in_the_void days = -1 }
		hidden_effect = {
			set_country_flag = has_shroud_patron
			country_event = { id = endim.3310 } # Covenant Sealed
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# The Composer of Strands
country_event = {
	id = endim.3305
	title = "endim.3000.name"
	desc = "endim.3305.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}
	
	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}
	
	option = {
		name = "endim.3305.a"
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_composer_of_strands_2 days = -1 }
		hidden_effect = {
			set_country_flag = has_shroud_patron
			country_event = { id = endim.3310 } # Covenant Sealed
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}


# The Eater of Worlds
country_event = {
	id = endim.3306
	title = "endim.3000.name"
	desc = "endim.3306.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}
	
	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}
	
	option = {
		name = "endim.3306.a"
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_eater_of_worlds_2 days = -1 }
		hidden_effect = {
			set_country_flag = has_shroud_patron
			country_event = { id = endim.3310 } # Covenant Sealed
			random_owned_planet = {
				limit = { 
					is_capital = no 
					any_owned_pop = {
						is_sapient = yes
						is_robot_pop = no					
					}				
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						is_robot_pop = no
					}
					kill_pop = yes
				}
			}
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# The Instrument of Desire
country_event = {
	id = endim.3307
	title = "endim.3000.name"
	desc = "endim.3307.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}
	
	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}
	
	option = {
		name = "endim.3307.a"
		custom_tooltip = "covenant.tooltip"
		add_modifier = { modifier = covenant_instrument_of_desire days = -1 }
		hidden_effect = {
			set_country_flag = has_shroud_patron
			country_event = { id = endim.3310 } # Covenant Sealed
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# The End of the Cycle
country_event = {
	id = endim.3308
	title = "endim.3000.name"
	desc = "endim.3308.desc"
	diplomatic = yes
	force_open = yes
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = shroud_diplomacy_engaged
	}
	
	after = {
		hidden_effect = {
			remove_country_flag = shroud_diplomacy_engaged
		}
	}
	
	option = {
		name = "endim.3308.a"	
		custom_tooltip = "covenant.cycle.tooltip"
		add_modifier = { modifier = covenant_end_of_the_cycle days = 18000 } # You really shouldn't have done that...
		hidden_effect = {
			set_global_flag = end_of_the_cycle
			set_country_flag = has_shroud_patron
			set_country_flag = covenant_end_of_the_cycle
			every_owned_planet = {
				limit = { NOT = { has_modifier = covenant_shroud_marked } }
				add_modifier = { modifier = covenant_shroud_marked days = -1 }
			}
			every_subject = {
				every_owned_planet = {
					limit = { NOT = { has_modifier = covenant_shroud_marked } }
					add_modifier = { modifier = covenant_shroud_marked days = -1 }
				}			
			}
			country_event = { id = endim.3310 } # Covenant Sealed
			country_event = { id = endim.3320 days = 18000 }
		}
	}
	option = {
		name = "exit.shroud"
		custom_tooltip = "exit.shroud.tooltip"
		default_hide_option = yes
	}
}

# Covenant Sealed
country_event = {
	id = endim.3310
	title = "endim.3310.name"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes

	desc = {
		text = covenant.whisperers.desc
		trigger = { has_modifier = covenant_whisperers_in_the_void }		
	}
	
	desc = {
		text = covenant.composer.desc
		trigger = { has_modifier = covenant_composer_of_strands_2 }		
	}

	desc = {
		text = covenant.eater.desc
		trigger = { has_modifier = covenant_eater_of_worlds_2 }		
	}
	
	desc = {
		text = covenant.instrument.desc
		trigger = { has_modifier = covenant_instrument_of_desire }		
	}
	
	desc = {
		text = covenant.cycle.desc
		trigger = { has_modifier = covenant_end_of_the_cycle }		
	}
	
	option = {
		trigger = {
			has_modifier = covenant_whisperers_in_the_void
		}
		name = covenant.whisperers.option
	}
	option = {
		trigger = {
			has_modifier = covenant_instrument_of_desire
		}
		name = covenant.instrument.option
	}
	option = {
		trigger = {
			has_modifier = covenant_eater_of_worlds_2
		}
		name = covenant.eater.option
	}
	option = {
		trigger = {
			has_modifier = covenant_composer_of_strands_2
		}
		name = covenant.composer.option
	}	
	option = {
		trigger = {
			has_modifier = covenant_end_of_the_cycle
		}	
		name = covenant.cycle.option
		hidden_effect = {
			every_owned_planet = {
				limit = { NOT = { has_modifier = covenant_shroud_marked } }
				add_modifier = { modifier = covenant_shroud_marked days = -1 }
			}
			every_subject = {
				every_owned_planet = {
					limit = { NOT = { has_modifier = covenant_shroud_marked } }
					add_modifier = { modifier = covenant_shroud_marked days = -1 }
				}			
			}
		}
	}
}

# The End of the Cycle: Reckoning
country_event = {
	id = endim.3320
	title = "endim.3320.name"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_red_alert
	location = root
	
	is_triggered_only = yes
	
	desc = {
		text = "endim.3320.desc.a"
		trigger = { has_country_flag = exile_world }
	}
	desc = {
		text = "endim.3320.desc.b"
		trigger = { NOT = { has_country_flag = exile_world } }
	}	
	
	immediate = {	
		set_global_flag = end_of_the_cycle_complete
		set_country_flag = end_of_the_cycle_reckoning
		clear_resources = yes
		add_resource = {
			minerals = 1000
			energy = 500
			food = 100
			influence = 100
		}
		
		if = {
			limit = { NOT = { exists = event_target:shroud_country } }
			create_country = {
				name = "NAME_Creatures_of_the_Shroud"
				type = shroud_spirits
				flag = {
					icon = {
						category = "special"
						file = "the_shroud.dds"
					}
					background= {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors={
						"dark_purple"
						"black"
						"null"
						"null"
					}
				}
			}
			last_created_country = {
				establish_communications_no_message = root
				save_global_event_target_as = shroud_country
			}
		}
		
		capital_scope = {
			save_event_target_as = former_capital
		}
		
		every_subject = {
			set_subject_of = {
				who = none
			}
		}		
		random_system = {
			limit = {
				NOT = {
					any_country = {
						any_system_within_border = {
							is_same_value = prevprev
						}
					}
				}
				any_system_planet = {
					has_owner = no
					is_colonizable = yes				
				}
			}
			random_planet = {
				limit = {
					has_owner = no
					is_colonizable = yes
				}	
				root = { set_country_flag = exile_world }
				set_planet_flag = exile_planet
				save_event_target_as = exile_world
			}	
		}
		random_system = {
			limit = {
				root = { NOT = { has_country_flag = exile_world } }
				any_system_planet = {
					has_owner = no
					is_colonizable = yes				
				}
			}
			random_planet = {
				limit = {
					has_owner = no
					is_colonizable = yes
				}	
				root = { set_country_flag = exile_world }
				save_event_target_as = exile_world
			}	
		}		
		if = {
			limit = { has_country_flag = exile_world }
			event_target:exile_world = {
				create_colony = {
					owner = root
					species = owner_main_species
					ethos = owner
				}
				set_name = "NAME_Exile"
				add_district = district_nexus
				add_district = district_nexus
				add_district = district_farming
				add_district = district_mining
				add_district = district_generator
				add_building = building_machine_capital
				add_building = building_research_lab_1
				add_building = building_foundry_1
				add_building = building_machine_assembly_plant
				while = {
					limit = { 
						num_pops < 8
						free_housing > 0
					}
					create_pop = {
						species = owner
					}
				}
			}
		}
		kill_leader = {
			type = ruler
			show_notification = no
			heir = yes
		}
		kill_leader = {
			type = ruler
			show_notification = no
			heir = no
		}	
		every_owned_leader = {
			kill_leader = { show_notification = no }
		}			
		if = {
			limit = { has_country_flag = exile_world }		
			create_leader = {
				class = ruler
				species = root.owner_species
				name = random
				skill = 5
			}
			assign_leader = last_created_leader
		}	
		every_owned_fleet = { 
			destroy_fleet = this 
		}		
		every_planet = {
			limit = { has_modifier = covenant_shroud_marked }
			remove_modifier = covenant_shroud_marked
			remove_all_armies = yes
			every_owned_pop = {
				root = { 
					change_variable = { 
						which = "end_power" 
						value = 1 
					}
				}
			}
			
			if = {
				limit = {
					has_owner = yes
					owner = { NOT = { has_country_flag = end_of_the_cycle_reckoning } }
				}
				owner = {
					set_country_flag = end_of_the_cycle_reckoning
					set_country_flag = end_of_cycle_lost_planets
					country_event = { id = endim.3321 }
				}			
			}
			
			if = {
				limit = { 
					NOT = { is_same_value = event_target:former_capital }
				}
				create_fleet = {
					name = "NAME_Shroud_Manifestation"
					settings = {
						spawn_debris = no
						is_boss = yes
					}				
					effect = {					
						set_owner = event_target:shroud_country
						create_ship = {
							name = "NAME_Fragment"
							design = "NAME_Shroud_Manifestation"
						}
						set_location = prev
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = return_point
						set_aggro_range = 3000
					}
				}
			}
				
			if = {
				limit = { 
					is_planet_class = pc_habitat 
				}
				destroy_colony = yes
				remove_planet = yes						
			}
			else_if = {
				limit = {
					is_planet_class = pc_ringworld_habitable
				}
				change_pc = pc_ringworld_habitable_damaged
				clear_planet_modifiers = yes
				clear_deposits = yes				
			}
			else = {
				change_pc = pc_shrouded
				clear_planet_modifiers = yes
				clear_deposits = yes
			}
		}	
		
		every_country = {
			limit = { 
				NOT = { is_same_value = root } 
				is_country_type = default
			}
			add_opinion_modifier = {
				modifier = opinion_doomed_us_all
				who = root
			}
			if = {
				limit = {
					NOT = { has_country_flag = end_of_the_cycle_reckoning }
				}
				set_country_flag = end_of_the_cycle_reckoning
				country_event = { id = endim.3321 }		
			}			
		}

		create_fleet = {
			name = "NAME_The_End"
			settings = {
				spawn_debris = no
				ai_ignore_strength = yes
				is_boss = yes
			}
			effect = {
				save_global_event_target_as = the_end_of_the_cycle
				set_name = "Absorbed [Root.GetSpeciesNamePlural]"
				set_owner = event_target:shroud_country
				create_ship = {
					name = "NAME_Reckoning"
					design = "NAME_Warped_Consciousness"
				}
				set_location = event_target:former_capital
				set_fleet_stance = aggressive
				set_aggro_range_measure_from = return_point
				set_aggro_range = 3000
				if = {
					limit = {
						root = { 
							check_variable = {
								which = "end_power"
								value < 500
							}
						}
					}
					add_modifier = {
						modifier = "absorbed_consciousness_1"
						days = -1
					}
				}
				else_if = {
					limit = {
						root = { 
							check_variable = {
								which = "end_power"
								value < 1000
							}
						}
					}
					add_modifier = {
						modifier = "absorbed_consciousness_2"
						days = -1
					}
				}
				else_if = {
					limit = {
						root = { 
							check_variable = {
								which = "end_power"
								value < 2500
							}
						}
					}
					add_modifier = {
						modifier = "absorbed_consciousness_3"
						days = -1
					}
				}
				else_if = {
					limit = {
						root = { 
							check_variable = {
								which = "end_power"
								value < 5000
							}
						}
					}
					add_modifier = {
						modifier = "absorbed_consciousness_4"
						days = -1
					}
				}	
				else = {
					add_modifier = {
						modifier = "absorbed_consciousness_5"
						days = -1
					}
				}
			}
		}
	}

	option = {
		name = "endim.3320.opt.a"
	}
}

country_event = {
	id = endim.3321
	title = "endim.3320.name"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_red_alert
	location = root
	
	desc = {
		text = "endim.3321.desc.a"
		trigger = { has_country_flag = end_of_cycle_lost_planets }
	}
	desc = {
		text = "endim.3321.desc.b"
		trigger = { NOT = { has_country_flag = end_of_cycle_lost_planets } }
	}
		
	
	is_triggered_only = yes
	
	option = {
		name = "endim.3321.opt.a"
	}
}

planet_event = {
	id = endim.3322
	hide_window = yes
	
	pre_triggers = {
		has_owner = yes
	}

	trigger = {
		owner = {
			OR = {
				has_modifier = covenant_end_of_the_cycle
				AND = {
					is_subject = yes
					overlord = { has_modifier = covenant_end_of_the_cycle }
				}				
			}	
		}
		NOT = { has_modifier = covenant_shroud_marked }
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		add_modifier = { modifier = covenant_shroud_marked days = -1 }
	}
}

fleet_event = {
	id = endim.3323
	hide_window = yes
	
	trigger = {
		has_global_flag = end_of_the_cycle_complete
		NOT = { has_global_flag = end_of_the_cycle_orders_cooldown }
		owner = { is_country_type = shroud_spirits }
		exists = event_target:the_end_of_the_cycle
		event_target:the_end_of_the_cycle = { is_same_value = root }	
		is_fleet_idle = yes
		any_system = {
			any_system_planet = {
				OR = {
					is_colonizable = yes
					has_owner = yes
				}
				OR = {
					NOT = { has_planet_flag = exile_planet }
					NOT = {
						any_system = {
							any_system_planet = {
								OR = {
									is_colonizable = yes
									has_owner = yes
								}
								NOT = { has_planet_flag = exile_planet }
							}
						}
					}
				}
			}		
		}
	}
	
	mean_time_to_happen = {
		months = 3
	}
	
	immediate = {
		set_timed_global_flag = { flag = end_of_the_cycle_orders_cooldown days = 30 }
		closest_system = {
			limit = {
				any_system_planet = {
					OR = {
						is_colonizable = yes
						has_owner = yes
					}
					OR = {
						NOT = { has_planet_flag = exile_planet }
						NOT = {
							any_system = {
								any_system_planet = {
									OR = {
										is_colonizable = yes
										has_owner = yes
									}
									NOT = { has_planet_flag = exile_planet }
								}
							}
						}
					}
				}
			}
			random_system_planet = {
				limit = {
					OR = {
						is_colonizable = yes
						has_owner = yes
					}
					OR = {
						NOT = { has_planet_flag = exile_planet }
						NOT = {
							any_system = {
								any_system_planet = {
									OR = {
										is_colonizable = yes
										has_owner = yes
									}
									NOT = { has_planet_flag = exile_planet }
								}
							}
						}
					}				
				}
				save_event_target_as = move_to_planet
			}
		}
		queue_actions = {
			find_closest_system = {
				trigger = {
					id = endim.3323.t1
					any_system_planet = {
						is_same_value = event_target:move_to_planet
					}
				}
				found_system = {
					move_to = this
					find_closest_planet = {
						trigger = {
							id = endim.3323.t2
							is_same_value = event_target:move_to_planet
						}
						found_planet = {
							move_to = this
							effect = {
								id = endim.3323.e1
								set_timed_global_flag = { flag = end_of_the_cycle_orders_cooldown days = 30 }
								planet_event = { id = endim.3324 }
							}
						}
					}
				}
			}
		}
	}
}

planet_event = {
	id = endim.3324
	title = "endim.3324.name"
	desc = "endim.3324.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_red_alert
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:the_end_of_the_cycle
	}
	
	immediate = {
		if = {
			limit = { 
				is_planet_class = pc_habitat 
			}
			destroy_colony = yes					
		}
		else_if = {
			limit = {
				is_planet_class = pc_ringworld_habitable
			}
			change_pc = pc_ringworld_habitable_damaged
			clear_planet_modifiers = yes
			clear_deposits = yes				
		}
		else = {
			change_pc = pc_shrouded
			clear_planet_modifiers = yes
			clear_deposits = yes
		}
	}
	
	option = {
		name = "endim.3324.opt.a"
		hidden_effect = {
			if = {
				limit = { 
					is_planet_class = pc_habitat 
				}
				# we do this here to prevent issues with removing planet mid-event	
				# might result in some weirdness if player is slow to click, but player having a habitat should be very rare at this point				
				remove_planet = yes		
			}		
		}
	}	
}

# Covenant Side Effects - Gatekeeper event
country_event = {
	id = endim.3330
	hide_window = yes
	
	trigger = {
		NOT = { has_country_flag = covenant_side_effects }
		OR = {
			has_modifier = covenant_whisperers_in_the_void
			has_modifier = covenant_composer_of_strands_2
			has_modifier = covenant_eater_of_worlds_2
			has_modifier = covenant_instrument_of_desire
		}
	}
	
	mean_time_to_happen = {
		years = 25
	}
	
	immediate = {
		set_timed_country_flag = { flag = covenant_side_effects days = 3600 }
		if = {
			limit = {
				has_modifier = covenant_whisperers_in_the_void
			}
			random_list = {
				45 = { country_event = { id = endim.3331 } }	# Leader turns to substance abuse
				25 = { country_event = { id = endim.3332 } }	# Suicide of leader
				20 = { country_event = { id = endim.3333 } }	# Planet succumbs to madness
				10 = { country_event = { id = endim.3334 } }	# Planet collapses into anarchy
			}
		}
		if = {
			limit = {
				has_modifier = covenant_eater_of_worlds_2
			}
			random_list = {
				65 = { country_event = { id = endim.3335 } }	# Pop devoured
				30 = { country_event = { id = endim.3336 } }	# Pops devoured
				5 = { country_event = { id = endim.3337 } }	# Planet devoured
			}
		}
		if = {
			limit = {
				has_modifier = covenant_instrument_of_desire
			}
			random_list = {
				40 = { country_event = { id = endim.3340 } }	# Planet gets increased desire for consumer goods
				40 = { country_event = { id = endim.3338 } }	# Planet gets deviant ethics
				20 = { country_event = { id = endim.3339 } }	# Empire gets deviant ethics
			}
		}
		if = {
			limit = {
				has_modifier = covenant_composer_of_strands_2
			}
			country_event = { id = endim.3341 }	# Composer messes with species traits
		}		
	}
}

# Whisperers - Voices in my Head
country_event = {
	id = endim.3331
	title = "endim.3331.name"
	desc = "endim.3331.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_leader = {
			NOT = { has_trait = "leader_trait_arrested_development" }		
		}
	}
	
	immediate = {
		random_owned_leader = {
			limit = {
				NOT = { has_trait = "leader_trait_arrested_development" }
			}
			save_event_target_as = leader_target		
		}
	}
	
	option = {
		name = "endim.3331.opt.a"
		event_target:leader_target = {
			add_trait = "leader_trait_arrested_development"
		}
	}
}


# Whisperers - Suicide
country_event = {
	id = endim.3332
	title = "endim.3332.name"
	desc = "endim.3332.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes

	immediate = {
		random_owned_leader = {
			save_event_target_as = leader_target		
		}
	}
	
	option = {
		name = "endim.3332.opt.a"
		event_target:leader_target = {
			kill_leader = { show_notification = no }		
		}
	}
}

# Whisperers - Madness
country_event = {
	id = endim.3333
	title = "endim.3333.name"
	desc = "endim.3333.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_planet = {
			num_pops > 1
			NOR = {
				has_modifier = whisperers_madness
				has_modifier = whisperers_psychosis
			}
		}
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				num_pops > 1
				NOR = {
					has_modifier = whisperers_madness
					has_modifier = whisperers_psychosis
				}				
			}
			save_event_target_as = planet_target
			random_owned_pop = {
				kill_pop = yes
			}			
		}
	}
	
	option = {
		name = "endim.3333.opt.a"
		event_target:planet_target = {
			add_modifier = {
				modifier = whisperers_madness
				days = 3600
			}
		}		
	}
}

# Whisperers - Psychosis
country_event = {
	id = endim.3334
	title = "endim.3334.name"
	desc = "endim.3334.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_planet = {
			num_pops > 5
			NOR = {
				has_modifier = whisperers_madness
				has_modifier = whisperers_psychosis
			}
		}
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				num_pops > 5
				NOR = {
					has_modifier = whisperers_madness
					has_modifier = whisperers_psychosis
				}				
			}
			save_event_target_as = planet_target
			if = {
				limit = {
					num_pops > 20
				}
				random_owned_pop = {
					kill_pop = yes
				}	
				random_owned_pop = {
					kill_pop = yes
				}				
			}
			if = {
				limit = {
					num_pops > 15
				}
				random_owned_pop = {
					kill_pop = yes
				}	
				random_owned_pop = {
					kill_pop = yes
				}				
			}	
			if = {
				limit = {
					num_pops > 10
				}
				random_owned_pop = {
					kill_pop = yes
				}	
				random_owned_pop = {
					kill_pop = yes
				}				
			}	
			random_owned_pop = {
				kill_pop = yes
			}	
			random_owned_pop = {
				kill_pop = yes
			}			
		}
	}
	
	option = {
		name = "endim.3334.opt.a"
		event_target:planet_target = {
			add_modifier = {
				modifier = whisperers_psychosis
				days = 3600
			}
		}		
	}
}


# Eater - Peckish
country_event = {
	id = endim.3335
	title = "endim.3335.name"
	desc = "endim.3335.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_planet = {
			num_pops > 1	
			NOR = {
				has_modifier = eater_unhappiness_planet_2_1
				has_modifier = eater_unhappiness_planet_2_2
			}			
		}
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				num_pops > 1
				NOR = {
					has_modifier = eater_unhappiness_planet_2_1
					has_modifier = eater_unhappiness_planet_2_2
				}				
			}
			save_event_target_as = planet_target
			random_owned_pop = {
				kill_pop = yes
			}			
		}
	}
	
	option = {
		name = "endim.3335.opt.a"
		event_target:planet_target = {
			add_modifier = {
				modifier = eater_unhappiness_planet_2_1
				days = 3600
			}
		}		
	}
}

# Eater - Hungry
country_event = {
	id = endim.3336
	title = "endim.3336.name"
	desc = "endim.3336.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_planet = {
			num_pops > 3	
			NOR = {
				has_modifier = eater_unhappiness_planet_2_1
				has_modifier = eater_unhappiness_planet_2_2
			}
		}
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				num_pops > 3
				NOR = {
					has_modifier = eater_unhappiness_planet_2_1
					has_modifier = eater_unhappiness_planet_2_2
				}				
			}
			save_event_target_as = planet_target
			random_owned_pop = {
				kill_pop = yes
			}
			random_owned_pop = {
				kill_pop = yes
			}	
			random_owned_pop = {
				kill_pop = yes
			}				
		}
	}
	
	option = {
		name = "endim.3336.opt.a"
		event_target:planet_target = {
			add_modifier = {
				modifier = eater_unhappiness_planet_2_2
				days = 3600
			}
		}		
	}
}

# Eater - Ravenous
country_event = {
	id = endim.3337
	title = "endim.3337.name"
	desc = "endim.3337.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_modifier = eater_unhappiness_empire_2 }
		any_owned_planet = {
			is_capital = no
			num_pops > 5
			NOR = {
				is_planet_class = pc_habitat
				is_planet_class = pc_ringworld_habitable
			}	
		}
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				is_capital = no
				num_pops > 5
				NOR = {
					is_planet_class = pc_habitat
					is_planet_class = pc_ringworld_habitable
				}
			}
			save_event_target_as = planet_target
			change_pc = pc_shrouded
			clear_planet_modifiers = yes
			clear_deposits = yes						
		}
	}
	
	option = {
		name = "endim.3337.opt.a"
		add_modifier = {
			modifier = eater_unhappiness_empire_2
			days = 3600
		}		
	}
}

# Instrument - Deviant Planet
country_event = {
	id = endim.3338
	title = "endim.3338.name"
	desc = "endim.3338.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_planet = {
			NOT = { has_modifier = instrument_deviance_planet_2 }
		}
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				NOT = { has_modifier = instrument_deviance_planet_2 }
			}
			save_event_target_as = planet_target
		}
	}
	
	option = {
		name = "endim.3338.opt.a"
		event_target:planet_target = {
			add_modifier = {
				modifier = instrument_deviance_planet_2
				days = 7200
			}
		}
	}
}

# Instrument - Deviant Empire
country_event = {
	id = endim.3339
	title = "endim.3339.name"
	desc = "endim.3339.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_modifier = instrument_deviance_empire_2 }
	}
	
	option = {
		name = "endim.3339.opt.a"
		add_modifier = {
			modifier = instrument_deviance_empire_2
			days = 3600
		}	
	}
}

# Instrument - Consumer Goods
country_event = {
	id = endim.3340
	title = "endim.3340.name"
	desc = "endim.3340.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_planet = {
			NOT = { has_modifier = instrument_consumer_goods_2 }
		}
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				NOT = { has_modifier = instrument_consumer_goods_2 }
			}
			save_event_target_as = planet_target
		}
	}
	
	option = {
		name = "endim.3338.opt.a"
		event_target:planet_target = {
			add_modifier = {
				modifier = instrument_consumer_goods_2
				days = 7200
			}	
		}
	}
}

# Composer of Strands does his thing... #changed for this mod
country_event = {
	id = endim.3341
	title = "endim.3341.name"
	desc = "endim.3341.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	immediate = {
		create_species = {
			name = this
			plural = this
			adjective = this
			class = "EXD"
			portrait = "exd1"
			name_list = "Extradimensional"
			traits = {
				trait = "trait_rapid_breeders"
				trait = "trait_nonadaptive"
				trait = "trait_quarrelsome"
				trait = "trait_repugnant"
			}
		}
	}

	option = {
		name = "endim.3341.opt.a"
		custom_tooltip = endim.3341.opt.a.tooltip
		hidden_effect = {
			every_owned_planet = {
				random_owned_pop = { change_species = last_created_species }
			}
		}
	}
}

#shroud trolling event
country_event = {
	id = endim.3400
	title = "endim.3400.name"
	desc = "endim.3400.desc"
	picture = GFX_evt_psionics
	show_sound = event_mystic_reveal
	
	trigger = {
		any_owned_leader = { has_trait = leader_trait_ruler_chosen_2 }
		NOT = { has_country_flag = shroud_trap_event }
		OR = {
			has_modifier = covenant_whisperers_in_the_void
			has_modifier = covenant_composer_of_strands_2
			has_modifier = covenant_eater_of_worlds_2
			has_modifier = covenant_instrument_of_desire
		}
		is_ai = no
		has_authority = auth_machine_intelligence
	}

	mean_time_to_happen = {
		months = 120
	}
	
	immediate = {
		set_country_flag = shroud_trap_event
	}
	
	option = {
		name = "endim.3400.a"
	}
	option = {
		name = "endim.3400.b"
		hidden_effect = {
			capital_scope = {
				enable_special_project = {
					name = "SHROUD_TROLLING_PROJECT"
                    location = this
                    owner = root
				}
			}
		}
	}
}

#shroud incursion
country_event = {
	id = endim.3401
	title = "endim.3401.name"
	desc = "endim.3401.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_psionic
	location = event_target:shroud_spawn_system
	
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { NOT = { exists = event_target:shroud_country } }
			create_country = {
				name = "NAME_Creatures_of_the_Shroud"
				type = shroud_spirits
				flag = {
					icon = {
						category = "special"
						file = "the_shroud.dds"
					}
					background = {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors = {
						"dark_purple"
						"black"
						"null"
						"null"
					}
				}
			}
			last_created_country = {
				establish_communications_no_message = root
				save_global_event_target_as = shroud_country
			}
		}

		random_system_within_border = {
			save_event_target_as = shroud_spawn_system
			random_system_planet = { save_event_target_as = shroud_spawn_planet }
		}
 
		create_fleet = {
			name = "NAME_Corrupted_Avatar"
			settings = {
				spawn_debris = no
				is_boss = yes
			}			
			effect = {
				set_owner = event_target:shroud_country
				create_ship = {
					name = "NAME_Corrupted_Avatar"
					design = "NAME_Corrupted_Avatar"
				}
				set_location = event_target:shroud_spawn_planet
				set_fleet_stance = aggressive
				set_aggro_range_measure_from = return_point
				set_aggro_range = 300
			}
		}
		last_created_fleet = { # Despawn if enough time passes without being destroyed
			fleet_event = { id = utopia.3025 days = 3600 }
		}
	}
	
	option = {
		name = "endim.3401.a"
	}
}