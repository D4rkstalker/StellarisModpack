#########################################
#
# Events concerning Primitive Aliens
#
# Written by Henrik Eklund
#
#########################################

namespace = primitive

# Splitting the Atom (HIDDEN)
country_event = {
	id = primitive.12
	hide_window = yes

	trigger = {
		is_country_type = primitive
		has_country_flag = machine_age
		NOT = { has_country_flag = recently_advanced }
	}

	mean_time_to_happen = {
		years = 7

		modifier = {
			factor = 0.6
			has_country_flag = acquired_tech
		}
	}

	immediate = {
		set_timed_country_flag = {
			flag = recently_advanced
			days = 2160 #60yrs
		}
		remove_country_flag = machine_age
		set_country_flag = atomic_age
		set_primitive_age = atomic_age
		change_country_flag = {
			icon = {
				category = "special"
				file = "primitive.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"beige"
				"brown"
				"null"
				"null"
			}
		}
			
		home_planet = {
			create_pop = { species = owner_main_species }
			create_pop = { species = owner_main_species }
			observation_outpost_owner = {
				country_event = { id = primitive.13 }
			}
		}
	}
}

# First Satellite (HIDDEN)
country_event = {
	id = primitive.14
	hide_window = yes

	trigger = {
		is_country_type = primitive
		has_country_flag = atomic_age
		NOT = { has_country_flag = recently_advanced }
	}

	mean_time_to_happen = {
		years = 5

		modifier = {
			factor = 0.6
			has_country_flag = acquired_tech
		}
	}

	immediate = {
		set_timed_country_flag = {
			flag = recently_advanced
			days = 2160 #60yrs
		}
		remove_country_flag = atomic_age
		set_country_flag = early_space_age
		set_primitive_age = early_space_age
		change_country_flag = {
			icon = {
				category = "special"
				file = "primitive.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"grey"
				"dark_grey"
				"null"
				"null"
			}
		}
		home_planet = {
			create_fleet = {
				name = "NAME_Space_Station"
				effect = {
					set_owner = root
					create_ship = {
						name = "NAME_Space_Station"
						design = "NAME_Space_Station"
					}
					set_location = PREV
				}
			}
			create_pop = { species = owner_main_species }
			create_pop = { species = owner_main_species }
			observation_outpost_owner = {
				country_event = { id = primitive.15 }
			}
		}
	}
}

# Entering Space Age (HIDDEN)
country_event = {
	id = primitive.16
	hide_window = yes

	trigger = {
		is_country_type = primitive
		has_country_flag = early_space_age
		OR = {
			AND = {
				exists = from
				from = {
					OR = {
						is_country_type = default
						is_country_type = ascended_empire
						is_country_type = lost_empire
						is_country_type = awakened_fallen_empire
					}
				}
			}
			AND = {
				NOT = { has_country_flag = recently_advanced }
				years_passed > 2
				exists = home_planet
				home_planet = { has_observation_outpost = no }			
			}
		}
	}

	mean_time_to_happen = {
		years = 12

		modifier = {
			factor = 0.6
			has_country_flag = acquired_tech
		}
		modifier = {
			factor = 0.4
			has_country_flag = primitives_ftl_experiments
		}
	}

	immediate = {
		remove_country_flag = early_space_age
		set_country_flag = primitives_can_into_space
		set_country_type = default
		change_country_flag = random
		if = {
			limit = { is_species_class = MAM }
			set_graphical_culture = mammalian_01
		}
		if = {
			limit = { is_species_class = REP }
			set_graphical_culture = reptilian_01
		}
		if = {
			limit = { is_species_class = AVI }
			set_graphical_culture = avian_01
		}
		if = {
			limit = { is_species_class = ART }
			set_graphical_culture = arthropoid_01
		}
		if = {
			limit = { is_species_class = MOL }
			set_graphical_culture = molluscoid_01
		}
		if = {
			limit = { is_species_class = FUN }
			set_graphical_culture = fungoid_01
		}
		if = {
			limit = { is_species_class = PLANT }
			set_graphical_culture = plantoid_01
		}
		if = {
			limit = { has_country_flag = human_primitive }
			change_government = {
				authority = auth_democratic
				civics = random
			}
		}
		else = {
			change_government = {
				authority = random
				civics = random
			}
		}
		# Governments Done
		#primitives_fanatic_purifier
		#primitives_fanatic_purifier
		#primitives_slave_revolt
		#primitives_mechanist
		#primitives_military_unification
		#primitives_agrarian_idyll
		#primitives_corporate_dominion
		#primitives_exalted_priesthood
		#primitives_idealistic_foundation
		#primitives_warrior_culture
		#primitives_feudal_elite
		#primitives_technocracy
		#primitives_shared_burden
		#primitives_slavers_guild
		switch = {
			trigger = has_country_flag
			primitives_fanatic_purifier = {
				if = {
					limit = {
						has_ethic = ethic_fanatic_xenophobe
						OR = {
							has_ethic = ethic_militarist
							has_ethic = ethic_spiritualist
						}
					}
					if = {
						limit = {
							has_authority = auth_corporate
						}
						change_government = {
							authority = auth_oligarchic
						}
					}
					change_government = {
						civics = {
							civic = civic_fanatic_purifiers
							civic = random
						}
					}
					add_resource = { minerals = 3000 }
					add_resource = { energy = 1000 }
					add_resource = { alloys = 1000 }
					create_fleet = {
						set_take_point = yes
						effect = {
							set_owner = prev
							
							while = {
								count = 8
								create_ship = {
									name = random
									random_existing_design = corvette
								}
							}
							
							set_location = prev.capital_star
						}
					}
				}
			}
			
			primitives_imperial_cult = {
				if = {
					limit = {
						OR = {
							has_ethic = ethic_authoritarian
							has_ethic = ethic_fanatic_authoritarian
						}
						OR = {
							has_ethic = ethic_spiritualist
							has_ethic = ethic_fanatic_spiritualist
						}
					}
					random_list = {
						55 = {
							change_government = {
								authority = auth_imperial
								civics = {
									civic = civic_imperial_cult
									civic = random
								}
							}
						}
						25 = {
							if = {
								limit = { has_global_flag = three_civics_active }
								change_government = {
									authority = auth_imperial
									civics = {
										civic = civic_imperial_cult
										civic = civic_aristocratic_elite
										civic = random
									}
								}
							}
							else = {
								change_government = {
									authority = auth_imperial
									civics = {
										civic = civic_imperial_cult
										civic = civic_aristocratic_elite
									}
								}
							}
						}
						20 = {
							if = {
								limit = { has_global_flag = three_civics_active }
								change_government = {
									authority = auth_imperial
									civics = {
										civic = civic_imperial_cult
										civic = civic_feudal_realm
										civic = random
									}
								}
							}
							else = {
								change_government = {
									authority = auth_imperial
									civics = {
										civic = civic_imperial_cult
										civic = civic_feudal_realm
									}
								}
							}
						}
					}
				}
			}
			primitives_slave_revolt = {
				if = {
					limit = {
						OR {
							has_ethic = ethic_xenophile
							has_ethic = ethic_fanatic_xenophile
						}
					}
					if = {
						limit = { has_global_flag = three_civics_active }
						change_government = {
							authority = auth_imperial
							civics = {
								civic = civic_beacon_of_liberty
								civic = civic_free_haven
								civic = random
							}
						}
					}
					else = {
						change_government = {
							authority = auth_imperial
							civics = {
								civic = civic_beacon_of_liberty
								civic = civic_free_haven
							}
						}
					}
				}
				if = {
					limit = {
						NOR {
							has_ethic = ethic_xenophile
							has_ethic = ethic_fanatic_xenophile
							has_ethic = ethic_xenophobe
							has_ethic = ethic_fanatic_xenophobe
						}
					}
					change_government = {
						authority = auth_democratic
						civics = {
							civic = civic_beacon_of_liberty
							civic = random
						}
					}
				}
				if = {
					limit = {
						OR {
							has_ethic = ethic_xenophobe
							has_ethic = ethic_fanatic_xenophobe
						}
					}
					change_government = {
						authority = auth_democratic
						civics = {
							civic = civic_idealistic_foundation
							civic = random
						}
					}
				}
			}
			primitives_mechanist = {
				if = {
					limit = {
						has_authority = auth_corporate
						has_global_flag = expanded_pops_active
					}
					change_government = {
						civics = {
							civic = civic_mechanists_megacorp
							civic = random
						}
					}
				}
				if = {
					limit = {
						has_authority = auth_corporate
						NOT = { has_global_flag = expanded_pops_active }
					}
					change_government = {
						authority = auth_oligarchic
						civics = {
							civic = civic_mechanists
							civic = random
						}
					}
				}
				else = {
					change_government = {
						civics = {
							civic = civic_mechanists
							civic = random
						}
					}
				}
			}
			primitives_military_unification = {
				change_government = {
					authority = auth_dictatorial
					civics = {
						civic = civic_police_state
						civic = random
					}
				}
			}
			primitives_agrarian_idyll = {
				if = {
					limit = {
						OR = {
							has_ethic = ethic_pacifist
							has_ethic = ethic_fanatic_pacifist
						}
					}
					if = {
						limit = {
							has_authority = auth_corporate
							has_global_flag = expanded_pops_active
						}
						change_government = {
							civics = {
								civic = civic_agribusiness
								civic = random
							}
						}
					}
					else_if = {
						limit = {
							has_authority = auth_corporate
							NOT = { has_global_flag = expanded_pops_active }
						}
						change_government = {
							authority = auth_oligarchic
							civics = {
								civic = civic_agrarian_idyll
								civic = random
							}
						}
					}
					else = {
						change_government = {
							civics = {
								civic = civic_agrarian_idyll
								civic = random
							}
						}
					}
				}
			}
			primitives_corporate_dominion = {
				if = {
					limit = {
						has_megacorp = yes
						OR = {
							has_ethic = ethic_fanatic_authoritarian
							has_ethic = ethic_fanatic_egalitarian
						}
					}
					change_government = {
						civics = {
							civic = civic_merchant_guilds
							civic = random
						}
					}
				}
				else_if = {
					limit = { has_megacorp = no }
					if = {
						limit = {
							OR = {
								has_ethic = ethic_spiritualist
								has_ethic = ethic_fanatic_spiritualist
							}
						}
						random_list = {
							25 = {
								if = {
									limit = { has_global_flag = three_civics_active }
									change_government = {
										authority = auth_imperial
										civics = {
											civic = civic_corporate_dominion
											civic = civic_exalted_priesthood
											civic = random
										}
									}
								}
								else = {
									change_government = {
										authority = auth_imperial
										civics = {
											civic = civic_corporate_dominion
											civic = civic_exalted_priesthood
										}
									}
								}
							}
							75 = {
								change_government = {
									authority = auth_oligarchic
									civics = {
										civic = civic_corporate_dominion
										civic = random
									}
								}
							}
						}
					}
					else = {
						change_government = {
							authority = auth_oligarchic
							civics = {
								civic = civic_corporate_dominion
								civic = random
							}
						}
					}
				}
				else_if = {
					limit = { has_megacorp = yes }
					if = {
						limit = {
							OR = {
								has_ethic = ethic_spiritualist
								has_ethic = ethic_fanatic_spiritualist
							}
						}
						random_list = {
							25 = {
								change_government = {
									authority = auth_corporate
									civics = {
										civic = civic_gospel_of_the_masses
										civic = random
									}
								}
							}
							10 = {
								if = {
									limit = { has_global_flag = three_civics_active }
									change_government = {
										authority = auth_imperial
										civics = {
											civic = civic_gospel_of_the_masses
											civic = civic_criminal_heritage
											civic = random
										}
									}
								}
								else = {
									change_government = {
										authority = auth_imperial
										civics = {
											civic = civic_gospel_of_the_masses
											civic = civic_criminal_heritage
										}
									}
								}
							}
							65 = {
								change_government = {
									authority = auth_corporate
									civics = {
										civic = random
										civic = random
									}
								}
							}
						}
					}
					else = {
						random_list = {
							90 = {
								change_government = {
									authority = auth_corporate
									civics = {
										civic = random
										civic = random
									}
								}
							}
							10 = {
								change_government = {
									authority = auth_corporate
									civics = {
										civic = civic_criminal_heritage
										civic = random
									}
								}
							}
						}
					}
				}
			}
			primitives_exalted_priesthood = {
				if = {
					limit = {
						OR = {
							has_ethic = ethic_spiritualist
							has_ethic = ethic_fanatic_spiritualist
						}
						NOR = {
							has_ethic = ethic_fanatic_authoritarian
							has_ethic = ethic_fanatic_egalitarian
						}
					}
					change_government = {
						authority = auth_oligarchic
						civics = {
							civic = civic_exalted_priesthood
							civic = random
						}
					}
				}
			}
			primitives_idealistic_foundation = {
				if = {
					limit = {
						OR = {
							has_ethic = ethic_egalitarian
							has_ethic = ethic_fanatic_egalitarian
						}
					}
					change_government = {
						authority = auth_democratic
						civics = {
							civic = civic_idealistic_foundation
							civic = random
						}
					}
				}
			}
			primitives_warrior_culture = {
				if = {
					limit = {
						OR = {
							has_ethic = ethic_militarist
							has_ethic = ethic_fanatic_militarist
						}
					}
					if = {
						limit = {
							has_authority = auth_corporate
						}
						change_government = {
							civics = {
								civic = civic_private_military_companies
								civic = random
							}
						}
					}
					else = {
						change_government = {
							civics = {
								civic = civic_warrior_culture
								civic = random
							}
						}
					}
				}
			}
			primitives_feudal_elite = {
				if = {
					limit = {
						NOR = {
							has_ethic = ethic_egalitarian
							has_ethic = ethic_fanatic_egalitarian
						}
					}
					if = {
						limit = { has_global_flag = three_civics_active }
						change_government = {
							authority = auth_imperial
							civics = {
								civic = civic_aristocratic_elite
								civic = civic_feudal_realm
								civic = random
							}
						}
					}
					else = {
						change_government = {
							authority = auth_imperial
							civics = {
								civic = civic_aristocratic_elite
								civic = civic_feudal_realm
							}
						}
					}
				}
			}
			primitives_technocracy = {
				if = {
					limit = {
						has_ethic = ethic_fanatic_materialist
					}
					if = {
						limit = {
							has_authority = auth_corporate
							has_global_flag = expanded_pops_active
						}
						change_government = {
							civics = {
								civic = civic_technocracy_corp
								civic = random
							}
						}
					}
					else_if = {
						limit = {
							has_authority = auth_corporate
							NOT = { has_global_flag = expanded_pops_active }
						}
						change_government = {
							authority = auth_oligarchic
							civics = {
								civic = civic_technocracy
								civic = random
							}
						}
					}
					else = {
						change_government = {
							civics = {
								civic = civic_technocracy
								civic = random
							}
						}
					}
				}
			}
			primitives_shared_burden = {
				if = {
					limit = {
						has_ethic = ethic_fanatic_egalitarian
						is_xenophobe = no
					}
					change_government = {
						civics = {
							civic = civic_shared_burden
							civic = random
						}
					}
				}
			}
			primitives_slavers_guild = {
				if = {
					limit = {
						is_authoritarian = yes
					}
					if = {
						limit = {
							has_authority = auth_corporate
						}
						change_government = {
							civics = {
								civic = civic_indentured_assets
								civic = random
							}
						}
					}
					else = {
						change_government = {
							civics = {
								civic = civic_slaver_guilds
								civic = random
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				home_planet = {
					has_observation_outpost = yes
				}
			}
			home_planet = {
				observation_outpost_owner = {
					country_event = { id = primitive.17 }
				}
			}
		}
		add_resource = {
			energy = 500
			minerals = 1000 # enough for a spaceport and then some
			food = 200
			alloys = 500
			consumer_goods = 100
			influence = 400
		}
		if = {
			limit = {
				capital_scope = { is_planet_class = pc_ringworld_habitable } 
			}
			# hope you find some mineral deposits out in the void. Here's an extra subsidy to tide you over until the resource shortages cripple you.
			add_resource = {
				energy = 4000
				food = 4000
				minerals = 4000
				alloys = 4000
				consumer_goods = 4000
				volatile_motes = 1000
				exotic_gases = 1000
				rare_crystals = 1000
			}
		}
		create_fleet = {
			effect = {
				set_owner = prev

				create_ship = {
					name = random
					random_existing_design = science
				}

				set_fleet_stance = evasive				
				#set_location = prev.capital_star
				set_location = prev.capital_scope.star
				
				owner = {
					create_leader = {
						class = scientist
						species = owner_main_species
						name = random
						skill = 2
					}
				}
				set_leader = last_created_leader
			}			
		}
			
		#constructor
		create_fleet = {
			effect = {
				set_owner = prev
				
				create_ship = {
					name = random
					random_existing_design = constructor
				}
				
				set_fleet_stance = evasive
				set_location = prev.capital_star
			}
		}
		
		#military
		create_fleet = {
			set_take_point = yes
			effect = {
				set_owner = prev
				
				while = {
					count = 2
					create_ship = {
						name = random
						random_existing_design = corvette
					}
				}
				
				set_location = prev.capital_star
			}
		}
		create_leader = {
			class = scientist
			species = owner_main_species
			name = random
			skill = 2
		}
		create_leader = {
			class = scientist
			species = owner_main_species
			name = random
			skill = 2
		}
		create_leader = {
			class = scientist
			species = owner_main_species
			name = random
			skill = 2
		}
		create_leader = {
			class = governor
			species = owner_main_species
			name = random
			skill = 2
		}
		capital_scope = {
			clear_blockers = yes
			while = {
				limit = { 
					num_pops < 8
					#free_housing > 0
				}
				create_pop = {
					species = owner
				}
			}
			remove_building = building_primitive_farm
			remove_building = building_primitive_factory
			remove_building = building_primitive_capital
			remove_building = building_urban_dwellings
			add_building = building_capital
			if = {
				limit = { NOT = { is_planet_class = pc_ringworld_habitable } }
				add_district = district_city
				add_district = district_city
				add_district = district_city
				add_district = district_city
				if = {
					limit = {
						exists = owner
						owner = { is_lithoid_empire = no }
					}
					add_district = district_farming
					add_district = district_farming
					add_district = district_farming
				}
				else_if = {
					limit = {
						exists = owner
						owner = { is_lithoid_empire = yes }
					}
					add_district = district_mining
					add_district = district_mining
					add_district = district_mining
				}
				add_district = district_mining
				add_district = district_mining
				add_district = district_generator
				add_district = district_generator

				add_building = building_research_lab_1
				add_building = building_foundry_1
				add_building = building_factory_1
			}
			if = {
				limit = { is_planet_class = pc_ringworld_habitable }
				add_district = district_rw_city
				add_district = district_rw_farming
				
				add_building = building_chemical_plant
				add_building = building_foundry_1
			}
			
			remove_all_armies = yes
			solar_system = {
				if = {
					limit = {
						NOT = { exists = starbase }
					}
					create_starbase = {
						size = starbase_starport
						owner = ROOT
						module = shipyard
						building = crew_quarters
						effect = {
							set_starbase_module = {
								slot = 1
								module = trading_hub
							}
						}
					}
				}
				else_if = {
					limit = {
						starbase = {
							NOT = { owner = { is_same_value = root } }
						}
					}	
					starbase = {
						owner = { country_event = { id = primitive.180 days = 10 } }
						if = {
							limit = { has_starbase_size = starbase_outpost }
							set_starbase_size = starbase_starport
							set_starbase_module = {
								slot = 0
								module = shipyard
							}
							set_starbase_module = {
								slot = 1
								module = trading_hub
							}
							set_starbase_building = {
								slot = 1
								building = crew_quarters
							}
						}
						else = {
							set_starbase_module = {
								slot = 0
								module = shipyard
							}
							set_starbase_module = {
								slot = 1
								module = trading_hub
							}
							set_starbase_building = {
								slot = 1
								building = crew_quarters
							}
						}
					}
				}
			}				
		}
		random_owned_ship = {
			limit = { is_ship_size = primitive_space_station }
			fleet = { destroy_fleet = THIS }
		}
		if = {
			limit = { cosmic_religion_active = yes }
			if = {
				limit = {
					has_valid_civic = civic_imperial_cult
				}
				set_country_flag = religion_set
				add_modifier = { modifier = "em_god_emperor" }
			}
			else_if = {
				limit = {
					has_valid_civic = civic_inwards_perfection
					is_materialist = no
				}
				set_country_flag = religion_set
				add_modifier = { modifier = "em_pantheism" }
				country_event = { id = ds_religion.2 }
			}
			else_if = {
				limit = {
					has_valid_civic = civic_agrarian_idyll
					is_materialist = no
				}
				set_country_flag = religion_set
				add_modifier = { modifier = "em_animism" }
				country_event = { id = ds_religion.2 }
			}
			else = {
				switch = {
					trigger = has_country_flag
					cosmic_animism = {
						set_country_flag = religion_set
						if = {
							limit = {is_spiritualist = yes }
							add_modifier = { modifier = "em_animism" }
						}
						else = { add_modifier = { modifier = "em_secularism" } }
						country_event = { id = ds_religion.2 }
					}
					cosmic_monotheism = {
						set_country_flag = religion_set
						if = {
							limit = {is_spiritualist = yes }
							add_modifier = { modifier = "em_monotheism" }
						}
						else = { add_modifier = { modifier = "em_secularism" } }
						country_event = { id = ds_religion.2 }
					}
					cosmic_polytheism = {
						set_country_flag = religion_set
						if = {
							limit = {is_spiritualist = yes }
							add_modifier = { modifier = "em_polytheism" }
						}
						else = { add_modifier = { modifier = "em_secularism" } }
						country_event = { id = ds_religion.2 }
					}
					cosmic_pantheism = {
						set_country_flag = religion_set
						if = {
							limit = {is_spiritualist = yes }
							add_modifier = { modifier = "em_pantheism" }
						}
						else = { add_modifier = { modifier = "em_secularism" } }
						country_event = { id = ds_religion.2 }
					}
					cosmic_secularism = {
						set_country_flag = religion_set
						if = {
							limit = { has_ethic = ethic_fanatic_materialist }
							add_modifier = { modifier = "em_materialism" }
						}
						else_if = {
							limit = { has_ethic = ethic_materialist }
							add_modifier = { modifier = "em_atheism" }
						}
						else_if = {
							limit = {
								is_spiritualist = yes
							}
							random_list = {
								1 = { add_modifier = { modifier = "em_animism" } }
								1 = { add_modifier = { modifier = "em_monotheism" } }
								1 = { add_modifier = { modifier = "em_polytheism" } }
								1 = { add_modifier = { modifier = "em_pantheism" } }
							}
						}
						else = {
							add_modifier = { modifier = "em_secularism" }
						}
						country_event = { id = ds_religion.2 }
					}
					cosmic_atheism = {
						set_country_flag = religion_set
						if = {
							limit = { has_ethic = ethic_fanatic_materialist }
							add_modifier = { modifier = "em_materialism" }
						}
						else_if = {
							limit = {
								is_spiritualist = yes
							}
							random_list = {
								1 = { add_modifier = { modifier = "em_animism" } }
								1 = { add_modifier = { modifier = "em_monotheism" } }
								1 = { add_modifier = { modifier = "em_polytheism" } }
								1 = { add_modifier = { modifier = "em_pantheism" } }
							}
						}
						else = {
							add_modifier = { modifier = "em_atheism" }
						}
						country_event = { id = ds_religion.2 }
					}
					cosmic_materialism = {
						set_country_flag = religion_set
						if = {
							limit = { is_materialist = yes }
							add_modifier = { modifier = "em_materialism" }
						}
						else_if = {
							limit = {
								is_spiritualist = yes
							}
							random_list = {
								1 = { add_modifier = { modifier = "em_animism" } }
								1 = { add_modifier = { modifier = "em_monotheism" } }
								1 = { add_modifier = { modifier = "em_polytheism" } }
								1 = { add_modifier = { modifier = "em_pantheism" } }
							}
						}
						else = {
							add_modifier = { modifier = "em_atheism" }
						}
						country_event = { id = ds_religion.2 }
					}
				}
			}
		}
	}
}

# Iron Age (HIDDEN)
country_event = {
	id = primitive.20
	hide_window = yes

	trigger = {
		is_country_type = primitive
		has_country_flag = bronze_age
		NOT = { has_country_flag = recently_advanced }
	}

	mean_time_to_happen = {
		years = 10
		modifier = {
			factor = 1.5
			any_owned_planet = { has_modifier = mineral_poor }
		}
		modifier = {
			factor = 0.75
			any_owned_planet = { has_modifier = mineral_rich }
		}
		modifier = {
			factor = 0.5
			any_owned_planet = { has_modifier = ultra_rich }
		}
	}

	immediate = {
		if = {
			limit = {
				any_owned_planet = {
					has_observation_outpost = yes
					observation_outpost_owner = {
						is_country_type = default
					}
					observation_outpost = {
						OR = {
							has_mission = technological_enlightenment_1
							has_mission = technological_enlightenment_2
							has_mission = technological_enlightenment_3
							has_mission = technological_enlightenment_4
							has_mission = technological_enlightenment_5
							has_mission = technological_enlightenment_6
							has_mission = technological_enlightenment_7
							has_mission = technological_enlightenment_8
							has_mission = technological_enlightenment_9
						}
					}
				}
			}
			set_country_flag = was_bronze
		}
		set_timed_country_flag = {
			flag = recently_advanced
			days = 144000 #400yrs
		}
		remove_country_flag = bronze_age
		change_government = {
			civics = {
				civic = civic_landed_nobility
				civic = civic_flat_world_theory
			}
		}
		set_country_flag = iron_age
		set_primitive_age = iron_age
		change_country_flag = {
			icon = {
				category = "special"
				file = "primitive.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"purple"
				"dark_purple"
				"null"
				"null"
			}
		}
		home_planet = {
			create_pop = { species = owner_main_species }
			create_pop = { species = owner_main_species }
			observation_outpost_owner = {
				country_event = { id = primitive.21 }
			}
		}
	}
}

# Printing Press (HIDDEN)
country_event = {
	id = primitive.22
	hide_window = yes

	trigger = {
		is_country_type = primitive
		has_country_flag = iron_age
		NOT = { has_country_flag = recently_advanced }
	}

	mean_time_to_happen = {
		years = 4
	}

	immediate = {
		set_timed_country_flag = {
			flag = recently_advanced
			days = 2160 #60yrs
		}
		remove_country_flag = iron_age
		set_country_flag = late_medieval_age
		set_primitive_age = late_medieval_age
		change_country_flag = {
			icon = {
				category = "special"
				file = "primitive.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"light_blue"
				"blue"
				"null"
				"null"
			}
		}
		home_planet = {
			add_building = building_primitive_dwellings
			create_pop = { species = owner_main_species }
			create_pop = { species = owner_main_species }
			observation_outpost_owner = {
				country_event = { id = primitive.23 }
			}
		}
	}
}

# Entering Industrial Age (HIDDEN)
country_event = {
	id = primitive.28
	hide_window = yes

	trigger = {
		is_country_type = primitive
		has_country_flag = steam_age
		NOT = { has_country_flag = recently_advanced }
	}

	mean_time_to_happen = {
		years = 7
		modifier = {
			factor = 0.75
			any_owned_planet = { has_modifier = mineral_rich }
		}
		modifier = {
			factor = 0.5
			any_owned_planet = { has_modifier = ultra_rich }
		}
	}

	immediate = {
		set_timed_country_flag = {
			flag = recently_advanced
			days = 2160 #60yrs
		}
		remove_country_flag = steam_age
		change_government = {
			civics = {
				civic = civic_increasing_urbanization
				civic = civic_atmospheric_pollution
			}
		}
		set_country_flag = industrial_age
		set_primitive_age = industrial_age
		set_graphical_culture = industrial_01
		change_country_flag = {
			icon = {
				category = "special"
				file = "primitive.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"beige"
				"yellow"
				"null"
				"null"
			}
		}
		home_planet = {
			clear_blockers = yes
			add_deposit = d_decrepit_dwellings
			add_deposit = d_failing_infrastructure
			remove_building = building_stone_palace
			remove_building = building_primitive_dwellings
			add_building = building_primitive_capital
			add_building = building_urban_dwellings
			add_building = building_primitive_farm
			create_pop = { species = owner_main_species }
			create_pop = { species = owner_main_species }
			observation_outpost_owner = {
				country_event = { id = primitive.29 }
			}
		}
	}
}

# Bronze Age (HIDDEN)
country_event = {
	id = primitive.30
	hide_window = yes

	trigger = {
		is_country_type = primitive
		has_country_flag = stone_age
		NOT = { has_country_flag = recently_advanced }
	}

	mean_time_to_happen = {
		years = 20
	}

	immediate = {
		if = {
			limit = {
				any_owned_planet = {
					has_observation_outpost = yes
					observation_outpost_owner = {
						is_country_type = default
					}
					observation_outpost = {
						OR = {
							has_mission = technological_enlightenment_1
							has_mission = technological_enlightenment_2
							has_mission = technological_enlightenment_3
							has_mission = technological_enlightenment_4
							has_mission = technological_enlightenment_5
							has_mission = technological_enlightenment_6
							has_mission = technological_enlightenment_7
							has_mission = technological_enlightenment_8
							has_mission = technological_enlightenment_9
						}
					}
				}
			}
			set_country_flag = was_stone
		}
		set_timed_country_flag = {
			flag = recently_advanced
			days = 180000 #500yrs
		}
		remove_country_flag = stone_age
		set_country_flag = bronze_age
		set_primitive_age = bronze_age
		change_country_flag = {
			icon = {
				category = "special"
				file = "primitive.dds"
			}
			background= {
				category = "backgrounds"
				file = "new_dawn.dds"
			}
			colors={
				"green"
				"dark_green"
				"null"
				"null"
			}
		}
		home_planet = {
			remove_building = building_crude_huts
			add_building = building_primitive_dwellings
			add_building = building_stone_palace
			create_pop = { species = owner_main_species }
			create_pop = { species = owner_main_species }
			observation_outpost_owner = {
				country_event = { id = primitive.31 }
			}
		}
	}
}

# Nuclear War Breaks Out (HIDDEN)
planet_event = {
	id = primitive.130
	hide_window = yes
	
	pre_triggers = {
		has_owner = yes
	}

	trigger = {
		NOT = { is_planet_class = pc_habitat }
		NOT = { is_planet_class = pc_ringworld_habitable }
		owner = {
			is_country_type = primitive
			NOT = { has_country_flag = human_primitive }
			OR = {
				has_country_flag = atomic_age
				has_country_flag = early_space_age
			}
		}
		OR = {
			has_observation_outpost = no
			AND = {
				has_observation_outpost = yes
				observation_outpost = { has_mission = passive_observation }
			}
			AND = {
				has_observation_outpost = yes
				observation_outpost = { has_mission = native_indoctrination }
			}			
			AND = {
				has_observation_outpost = yes
				observation_outpost = { has_mission = specimen_collection }
			}
		}
	}

	mean_time_to_happen = {
		years = 1
		modifier = {
			factor = 10
			owner = { has_country_flag = early_space_age }
		}
		modifier = {
			factor = 5
			owner = { has_ethic = ethic_pacifist }
		}
		modifier = {
			factor = 10
			owner = { has_ethic = ethic_fanatic_pacifist }
		}
		modifier = {
			factor = 0.75
			owner = {
				OR = {
					has_ethic = ethic_militarist
					has_ethic = ethic_fanatic_militarist
				}
			}
		}
		modifier = {
			factor = 0.75
			has_observation_outpost = yes
			observation_outpost = { has_mission = specimen_collection }
		}
		modifier = {
			factor = 0.5
			has_observation_outpost = yes
			observation_outpost = { has_mission = native_indoctrination }
		}		
	}

	immediate = {
		owner = {
			random_owned_ship = {
				limit = { is_ship_size = primitive_space_station }
				fleet = { destroy_fleet = THIS }
			}
		}
		if = {
			limit = {
				has_observation_outpost = yes
			}
			if = {
				limit = {
					exists = owner
					owner = { has_country_flag = primitives_discover_observer }
				}
				observation_outpost_owner = {
					country_event = { id = primitivesexpanded.311 }
					random_list = {
						50 = {
							modifier = {
								factor = 0
								ROOT = {
									exists = owner
									owner = { has_ethic = ethic_fanatic_xenophobe }
								}
							}
							modifier = {
								factor = 0.5
								ROOT = {
									exists = owner
									owner = { has_ethic = ethic_xenophobe }
								}
							}
							modifier = {
								factor = 0.5
								ROOT = {
									exists = owner
									owner = { has_ethic = ethic_fanatic_militarist }
								}
							}
							modifier = {
								factor = 0.75
								ROOT = {
									exists = owner
									owner = { has_ethic = ethic_militarist }
								}
							}
							modifier = {
								factor = 2
								ROOT = {
									exists = owner
									owner = {
										OR = {
											has_ethic = ethic_pacifist
											has_ethic = ethic_fanatic_pacifist
										}
									}
								}
							}
							modifier = {
								factor = 4
								ROOT = {
									exists = owner
									owner = {
										OR = {
											has_ethic = ethic_xenophile
											has_ethic = ethic_fanatic_xenophile
										}
									}
								}
							}
						}
						15 = {
							country_event = { id = primitive.131 }
							modifier = {
								factor = 0 # won't turn planet uninhabitable if it's not a planet
								root = {
									OR = {
										is_planet_class = pc_ringworld_habitable
										is_planet_class = pc_habitat
									}
								}
							}
						}
						35 = { country_event = { id = primitive.133 } }
					}
				}
			}
			else = {
				observation_outpost_owner = {
					random_list = {
						25 = {
							country_event = { id = primitive.131 }
							modifier = {
								factor = 0 # won't turn planet uninhabitable if it's not a planet
								root = {
									OR = {
										is_planet_class = pc_ringworld_habitable
										is_planet_class = pc_habitat
									}
								}
							}
						}
						75 = { country_event = { id = primitive.133 } }
					}
				}
			}
		}
		else = {
			owner = {
				random_list = {
					25 = {
						country_event = { id = primitive.131 }
						modifier = {
							factor = 0 # won't turn planet uninhabitable if it's not a planet
							root = {
								OR = {
									is_planet_class = pc_ringworld_habitable
									is_planet_class = pc_habitat
								}
							}
						}
					}
					75 = { country_event = { id = primitive.133 } }
				}
			}
		}
	}
}


### Aliens did it!
#Hidden trigger event
planet_event = {
	id = observation.3134
	hide_window = yes
	
	pre_triggers = {
		has_owner = yes
	}
	
	trigger = {
		has_observation_outpost = yes
		observation_outpost_owner = { exists = this }
		OR = {
			observation_outpost = { has_mission = passive_observation }
			observation_outpost = { has_mission = specimen_collection }
		}
		observation_outpost_owner = {
			NOR = {
				has_country_flag = observation_pyramid
				has_ethic = ethic_gestalt_consciousness
			}
		}
		exists = owner
		owner = {
			is_country_type = primitive
			OR = {
				has_country_flag = bronze_age
				has_country_flag = iron_age
				has_country_flag = late_medieval_age
				has_country_flag = renaissance_age
			}
		}
		NOT = { has_building = building_great_pyramid }
		num_pops > 0
	}
	
	mean_time_to_happen = {
		years = 4
		modifier = {
			factor = 0.75
			observation_outpost = { has_mission = specimen_collection }
		}
		modifier = {
			factor = 0.5
			observation_outpost = { has_mission = native_indoctrination }
		}		
	}
	
	immediate = {
		add_building = building_great_pyramid
		random_pop = {
			owner = {
				random_list = {
					40 = { }
					30 = {
						shift_ethic = ethic_spiritualist
						random_owned_pop = { pop_change_ethic = ethic_spiritualist }
						random_owned_pop = { pop_change_ethic = ethic_spiritualist }
					}
					30 = {
						shift_ethic = ethic_xenophile
						random_owned_pop = { pop_change_ethic = ethic_xenophile }
						random_owned_pop = { pop_change_ethic = ethic_xenophile }
					}
				}
			}
		}
		observation_outpost_owner = {
			set_country_flag = observation_pyramid
			country_event = { id = observation.3135 }
		}
		set_planet_flag = pyramid_observer_planet
		observation_outpost = {
			save_event_target_as = PyramidPlanetsObservationOutpost
		}
	}
}