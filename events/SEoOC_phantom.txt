namespace = nep_phantom

####################################
# scenario
####################################
country_event = {
	id = nep_phantom.1
	hide_window = yes
	
	fire_only_once = yes

	trigger = {
		is_ai = no
		has_global_flag = nep_Krahen_end
		has_country_flag = nep_Krahen_orb_get
		NOT = { has_global_flag = nep_corrupted_finalweapons_begin }
	}
	
	is_triggered_only = yes

	immediate = {
		set_global_flag = nep_phantom_begin
		set_global_flag = nep_phantom_passive_stage1
		event_target:global_event_country = {
			country_event = { id = nep_phantom.101 days = 1200 }
			country_event = { id = nep_phantom.102 days = 2400 }
			country_event = { id = nep_phantom.103 days = 4800 }
			country_event = { id = nep_phantom.104 days = 9600 }
		}
		create_phantom_country = yes
		random_system = {
			limit = { 
				is_neighbor_of = root
				nep_st_is_not_outer_or_fe_system = yes
			}
			save_event_target_as = nep_phantom_1_temp
			random_system = {
				limit = {
					distance = {
						source = event_target:nep_phantom_1_temp
						min_jumps = 2
						max_jumps = 4
					}
					NOT = { is_inside_border = root }
					nep_st_is_not_outer_or_fe_system = yes
				}
				log = "[This.GetName]"
				random_system_planet = {
					limit = {
						is_star = yes
					}
					create_fleet = {
						name = "NAME_phantom_fleet_krahen_unknown"
						settings = {
							spawn_debris = no 
							can_change_leader = no
							uses_naval_capacity = no
						}
						effect = {
							set_owner = last_created_country
							while = {
								count = 10
								create_ship = {
									name = "NAME_Krahen_invader_phantom"
									design = "NAME_Krahen_Battleship_phantom"
								}
							}
							set_location = {
								target = prev
								distance = 150
								angle = random
							}
							set_fleet_stance = aggressive
							set_aggro_range = 500
							set_aggro_range_measure_from = self
						}
					}
					last_created_fleet = {
						set_fleet_flag = nep_phantom_krahen
						set_fleet_flag = nep_phantom_fleet_passive
						closest_system = {
							use_bypasses = yes
							limit = {
								any_system_planet = {
									is_colony = yes
									if = {
										limit = {
											root = {
												num_owned_planets > 1
											}
										}
										is_capital = no
									}
									owner = { is_same_value = ROOT }
								}
							}
							random_system_planet = {
								limit = {
									is_colony = yes
									if = {
										limit = {
											root = {
												num_owned_planets > 1
											}
										}
										is_capital = no
									}
									owner = { is_same_value = ROOT }
								}
								PREVPREV = {
									auto_move_to_planet = {
										target = PREV
										clear_auto_move_on_arrival = yes
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

country_event = {
	id = nep_phantom.101
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_global_flag = nep_phantom_passive_stage1
	}
	
	immediate = {
		remove_global_flag = nep_phantom_passive_stage1
		set_global_flag = nep_phantom_passive_stage2
	}	
}

country_event = {
	id = nep_phantom.102
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_passive_stage2
	}

	immediate = {
		remove_global_flag = nep_phantom_passive_stage2
		set_global_flag = nep_phantom_passive_stage3
	}	
}

country_event = {
	id = nep_phantom.103
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_passive_stage3
	}

	immediate = {
		remove_global_flag = nep_phantom_passive_stage3
		set_global_flag = nep_phantom_passive_stage4
	}	
}

country_event = {
	id = nep_phantom.104
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_passive_stage4
	}

	immediate = {
		remove_global_flag = nep_phantom_passive_stage4
		set_global_flag = nep_phantom_passive_stage5
	}
}

country_event = {
	id = nep_phantom.2
	hide_window = yes

	trigger = {
		has_global_flag = nep_phantom_has_found
		NOT = { has_global_flag = nep_phantom_active_end }
		is_country_type = nep_phantom_global_event
	}
	
	mean_time_to_happen = {
		days = 30
	}
	
	immediate = {
		if = {
			limit = {
				if = {
					limit = {
						has_global_flag = nep_phantom_passive_stage1
					}
					count_country = {
						limit = { is_country_type = nep_phantom_passive }
						count < 10
					}
				}
				else_if = {
					limit = {
						has_global_flag = nep_phantom_passive_stage2
					}
					count_country = {
						limit = { is_country_type = nep_phantom_passive }
						count < 15
					}
				}
				else_if = {
					limit = {
						has_global_flag = nep_phantom_passive_stage3
					}
					count_country = {
						limit = { is_country_type = nep_phantom_passive }
						count < 20
					}
				}
				else_if = {
					limit = {
						has_global_flag = nep_phantom_passive_stage4
					}
					count_country = {
						limit = { is_country_type = nep_phantom_passive }
						count < 25
					}
				}
				else_if = {
					limit = {
						has_global_flag = nep_phantom_passive_stage5
					}
					count_country = {
						limit = { is_country_type = nep_phantom_passive }
						count < 30
					}
				}
			}
			#for test
			# random_country = {
				# limit = {
					# is_ai = no
				# }
				# country_event = { id = nep_phantom.31111 }
			# }
			create_phantom_country = yes
			random_system = {
				limit = { nep_st_is_not_outer_or_fe_system = yes }
				log = "This.GetName"
				random_system_planet = {
					random_list = {
						3 = { create_phantom_fleet_passive_Krahen = yes }
						5 = { create_phantom_fleet_passive_fallen_empire_01 = yes }
						5 = { create_phantom_fleet_passive_fallen_empire_02 = yes }
						10 = { create_phantom_fleet_passive_humanoid = yes }
						10 = { create_phantom_fleet_passive_mammalian = yes }
						10 = { create_phantom_fleet_passive_molluscoid = yes }
						10 = { create_phantom_fleet_passive_reptilian = yes }
						10 = { create_phantom_fleet_passive_arthropoid = yes }
						#10 = { create_phantom_fleet_passive_plantoid = yes } #To prevent DLC needed,rem it
						3 = { create_phantom_fleet_passive_pirate = yes }
					}
					last_created_fleet = {
						set_fleet_flag = nep_phantom_fleet_passive
						closest_system = {							
							use_bypasses = yes
							limit = {
								any_system_planet = {
									is_colony = yes
									exists = owner
									owner = {
										is_country_type = default
										is_primitive = no
									}
									if = {
										limit = {
											owner = { num_owned_planets > 1	}
										}
										is_capital = no
									}
								}
							}
							random_system_planet = {
								limit = {
									is_colony = yes
									exists = owner
									owner = {
										is_country_type = default
										is_primitive = no
									}
									if = {
										limit = {
											owner = { num_owned_planets > 1	}
										}
										is_capital = no
									}
								}
								PREVPREV = {
									auto_move_to_planet = {
										target = PREV
										clear_auto_move_on_arrival = yes
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

country_event = {
	id = nep_phantom.3
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		country_event = { id = nep_phantom.3003 } #notification
		add_research_option = tech_nep_phantom_phase_shift
		set_country_flag = nep_phantom_3_fired
	}
}

#on_fleet_destroyed_perp
country_event = {
	id = nep_phantom.4
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_begin
		from = { owner = { is_country_type = nep_phantom_passive } }
	}
	
	immediate = {
		fromfrom.solar_system = {
			every_system_planet = {
				limit = { has_planet_flag = nep_phantom_orbit }
				remove_planet_flag = nep_phantom_orbit
				if = {
					limit = {
						has_planet_flag = nep_phantom_planet_no_more_noti
					}
					remove_planet_flag = nep_phantom_planet_no_more_noti
				}
				if = {
					limit = {
						has_modifier = nep_phantom_orbit_stage1
					}
					remove_modifier = nep_phantom_orbit_stage1
				}
				if = {
					limit = {
						has_modifier = nep_phantom_orbit_stage2
					}
					remove_modifier = nep_phantom_orbit_stage2
				}
				if = {
					limit = {
						has_modifier = nep_phantom_orbit_stage3
					}
					remove_modifier = nep_phantom_orbit_stage3
				}
				if = {
					limit = {
						has_modifier = nep_phantom_orbit_stage4
					}
					remove_modifier = nep_phantom_orbit_stage4
				}
				if = {
					limit = {
						has_modifier = nep_phantom_planet_debuff_death
					}
					remove_modifier = nep_phantom_planet_debuff_death
				}
			}
		}
		if = {
			limit = {
				NOR = {
					has_country_flag = nep_phantom_passive_defeated_1
					has_country_flag = nep_phantom_passive_defeated_2
					has_country_flag = nep_phantom_passive_defeated_3
				}
			}
			set_country_flag = nep_phantom_passive_defeated_1
		}
		else_if = {
			limit = {
				has_country_flag = nep_phantom_passive_defeated_1
			}
			remove_country_flag = nep_phantom_passive_defeated_1
			set_country_flag = nep_phantom_passive_defeated_2
		}
		else_if = {
			limit = {
				has_country_flag = nep_phantom_passive_defeated_2
			}
			remove_country_flag = nep_phantom_passive_defeated_2
			set_country_flag = nep_phantom_passive_defeated_3
		}
		if = {
			limit = {
				has_country_flag = nep_phantom_passive_defeated_3
				is_ai = no
			}
			country_event = { id = nep_phantom.3004 } #notifaction
		}
	}
}

country_event = {
	id = nep_phantom.5
	hide_window = yes
	
	is_triggered_only = yes
	
	fire_only_once = yes
	
	trigger = {
		is_ai = no
	}
	
	immediate = {
		#Cluster spawn
		set_spawn_system_batch = begin
		no_scope = {
			spawn_system = {
				min_distance >= 499
				max_distance <= 499
				min_orientation_angle = -64
				max_orientation_angle = -64
				hyperlane = no
				initializer = nep_Gacrus_init
			}
			spawn_system = {
				min_distance >= 522
				max_distance <= 522
				min_orientation_angle = -64
				max_orientation_angle = -64
				hyperlane = no
				initializer = nep_Acrus_init
			}
			spawn_system = {
				min_distance >= 508
				max_distance <= 508
				min_orientation_angle = -63
				max_orientation_angle = -63
				hyperlane = no
				initializer = nep_Imai_init
			}
			spawn_system = {
				min_distance >= 508
				max_distance <= 508
				min_orientation_angle = -65
				max_orientation_angle = -65
				hyperlane = no
				initializer = nep_Mimosa_init
			}
			spawn_system = {
				min_distance >= 509
				max_distance <= 509
				min_orientation_angle = -64
				max_orientation_angle = -64
				hyperlane = no
				initializer = nep_Ginan_init
			}
		}
		every_system = {
			limit = {
				has_star_flag = nep_Scrus_cluster
				NOT = { is_same_value = event_target:nep_Ginan_system }
			}
			add_hyperlane = { from = this to = event_target:nep_Ginan_system }
		}
		set_spawn_system_batch = end
		if = {
			limit = { NOT = { any_country = { has_country_flag = nep_Scrus_cluster_territorys } } }
			create_country = {
				name = NAME_nep_Scrus_cluster_territorys
				type = nep_Scrus_cluster_territorys
				auto_delete = no
				flag = {
					icon = {
						category = "pirate"
						file = "flag_pirate_11.dds"
					}
					background = {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors ={
						"black"
						"dark_grey"
						"null"
						"null"
					}
				}
			}
			last_created_country = {
				save_event_target_as = nep_Scrus_cluster_territorys
				set_country_flag = nep_Scrus_cluster_territorys
				create_ship_design = {
					design = "NAME_nep_outpost"
				}
				add_ship_design = last_created_design
			}
		}
		every_system = {
			limit = { has_star_flag = nep_Scrus_cluster }
			if = {
				limit = { exists = starbase }
				starbase = { fleet = { destroy_fleet = this } }
			}
			create_starbase = {
				size = starbase_outpost
				owner = event_target:nep_Scrus_cluster_territorys
			}
		}
		random_galaxy_planet = {
			limit = { has_planet_flag = nep_seal_3 }
			solar_system = {
				spawn_megastructure = {
					name = "NAME_Sub_Seal_3"
					type = "nep_sealphantom_node"
					orbit_angle = 0
					orbit_distance = 0
					planet = prev
				}
			}
			remove_planet = yes
		}
		random_megastructure = {
			limit = { is_megastructure_type = nep_sealphantom_node }
			create_ambient_object = {
				type = nep_void
				location = this
			}
			last_created_ambient_object = {
				save_global_event_target_as = nep_sub_seal_3
			}
		}
		country_event = { id = nep_phantom.3005 } #notifaction
	}
}

fleet_event = {
	id = nep_phantom.6
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = nep_phantom_active_begin }
		NOT = { has_global_flag = nep_phantom_active_end }
	}
	
	immediate = {
		set_global_flag = nep_phantom_active_begin
		set_global_flag = nep_phantom_in_the_arena
		event_target:nep_Ginan_system = {
			random_system_planet = {
				save_global_event_target_as = nep_Ginan_star
			}
		}
	}
	
	after = {
		#notifaction
		owner = {
			country_event = { id = nep_phantom.3006 }
		}
	}
}

fleet_event = {
	id = nep_phantom.60
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_active_begin
		NOR = { 
			has_global_flag = nep_phantom_in_the_arena
			has_global_flag = nep_phantom_active_end
		}
		from = { has_star_flag = nep_Scrus_cluster }
	}
	
	immediate = {
		set_global_flag = nep_phantom_in_the_arena
	}
	
	after = {
		#notifaction
		owner = {
			country_event = { id = nep_phantom.3006 }
		}
	}
}


fleet_event = {
	id = nep_phantom.61
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_active_begin
		has_global_flag = nep_phantom_in_the_arena
		NOT = { has_global_flag = nep_phantom_active_end }
		fromfrom = { has_star_flag = nep_Scrus_cluster }
	}
	
	immediate = {
		remove_global_flag = nep_phantom_in_the_arena
	}
	
	after = {
		#notifaction
		owner = {
			country_event = { id = nep_phantom.30061 }
		}
	}
}

fleet_event = {
	id = nep_phantom.62
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_active_begin
		has_global_flag = nep_phantom_in_the_arena
		NOT = { has_global_flag = nep_phantom_active_end }
		from = { has_star_flag = nep_Scrus_cluster }
	}
	
	immediate = {		
		clear_fleet_actions = root
		set_event_locked = yes
		fleet_event = { id = nep_phantom.620 days = 3 }
	}
}

fleet_event = {
	id = nep_phantom.620
	hide_window = yes
	
	is_triggered_only = yes
		
	immediate = {
		random_megastructure = {
			limit = { is_megastructure_type = nep_sealphantom_node }
			root = { set_location = prev }
		}
		set_event_locked = no
		clear_orders = yes
	}
	
	after = {
		#notifaction
		owner = {
			country_event = { id = nep_phantom.30062 }
		}
	}
}

country_event = {
	id = nep_phantom.63
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_active_begin
		has_global_flag = nep_phantom_in_the_arena
		from = { 
			solar_system = { has_star_flag = nep_Scrus_cluster } 
			NOT = { owner = { is_country_type = nep_phantom_active } }
		}
	}
	
	immediate = {
		remove_global_flag = nep_phantom_in_the_arena
	}
	
	after = {
		#notifaction
		country_event = { id = nep_phantom.30061 }
	}
}

fleet_event = {
	id = nep_phantom.7
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_active_begin
		owner = { has_country_flag = nep_Krahen_orb_get }
		from = {
			has_star_flag = nep_Scrus_cluster
			NOR = { 
				has_star_flag = nep_Ginan_system 
				has_star_flag = nep_phantom_war_end
			}
		}
	}
	
	immediate = {
		if = {
			limit = { NOT = { any_country = { is_country_type = nep_phantom_active } } }
			create_country = {
				name = "NAME_nep_phantom_country"
				type = nep_phantom_active
				species = random
				auto_delete = no
				flag = {
					icon = {
						category = "zoological"
						file = "flag_zoological_17.dds"
					}
					background = {
						category = "backgrounds"
						file = "stripes.dds"
					}
					colors = {
						"black"
						"dark_grey"
						"null"
						"null"
					}
				}
				effect = {
					if = {
						limit = { has_global_flag = nep_code_ghost }
						set_name = "NAME_nep_ghost_country"
					}
					if = {
						limit = { has_global_flag = nep_code_illusion }
						set_name = "NAME_nep_illusion_country"
					}
					if = {
						limit = { has_global_flag = nep_code_blurs }
						set_name = "NAME_nep_blurs_country"
					}
					establish_communications_no_message = root.owner
					save_global_event_target_as = nep_phantom_active
					nep_easy_mod = yes
				}
			}
		}
		if = {
			limit = {
				NOT = { has_fleet_flag = nep_in_phantom_war }
			}
			set_fleet_flag = nep_in_phantom_war
			add_modifier = {
				modifier = nep_phantom_no_retreat
				days = -1
			}
		}
		solar_system = {
			if = {
				limit = {
					NOR = { 
						has_star_flag = nep_in_phantom_war
						has_star_flag = nep_phantom_war_end
					}
				}
				set_star_flag = nep_in_phantom_war
				remove_hyperlane = { from = this to = event_target:nep_Ginan_system }
			}
		}
		if = { 
			limit = {
				owner = {
					NOR = {
						has_country_flag = nep_phantom_active_stage_1
						has_country_flag = nep_phantom_active_stage_2
						has_country_flag = nep_phantom_active_stage_3
					}
				}
			}
			fleet_event = { id = nep_phantom.70 days = 25}
			fleet_event = { id = nep_phantom.71 }
			solar_system = {
				switch = {
					trigger = has_star_flag
					nep_phantom_energy_consume_1 = { root = { fleet_event = { id = nep_phantom.75 days = 90 } } }
					nep_phantom_energy_consume_2 = { root = { fleet_event = { id = nep_phantom.75 days = 80 } } }
					nep_phantom_energy_consume_3 = { root = { fleet_event = { id = nep_phantom.75 days = 70 } } }
					nep_phantom_energy_consume_4 = { root = { fleet_event = { id = nep_phantom.75 days = 60 } } }
					nep_phantom_energy_consume_5 = { root = { fleet_event = { id = nep_phantom.75 days = 50 } } }
					default = { root = { fleet_event = { id = nep_phantom.75 days = 100 } } }
				}
			}
			fleet_event = { id = nep_phantom.78 days = 25 }
			owner = {
				country_event = { id = nep_phantom.30071 }
			}
		}
		if = { 
			limit = {
				owner = {
					has_country_flag = nep_phantom_active_stage_1
				}
			}
			fleet_event = { id = nep_phantom.70 days = 25}
			fleet_event = { id = nep_phantom.72 }
			solar_system = {
				switch = {
					trigger = has_star_flag
					nep_phantom_energy_consume_1 = { root = { fleet_event = { id = nep_phantom.75 days = 100 } } }
					nep_phantom_energy_consume_2 = { root = { fleet_event = { id = nep_phantom.75 days = 90 } } }
					nep_phantom_energy_consume_3 = { root = { fleet_event = { id = nep_phantom.75 days = 80 } } }
					nep_phantom_energy_consume_4 = { root = { fleet_event = { id = nep_phantom.75 days = 70 } } }
					nep_phantom_energy_consume_5 = { root = { fleet_event = { id = nep_phantom.75 days = 60 } } }
					default = { root = { fleet_event = { id = nep_phantom.75 days = 110 } } }
				}
			}
			fleet_event = { id = nep_phantom.78 days = 25 }
			owner = {
				country_event = { id = nep_phantom.30072 }
			}
		}
		if = { 
			limit = {
				owner = {
					has_country_flag = nep_phantom_active_stage_2
				}
			}
			fleet_event = { id = nep_phantom.70 days = 25}
			fleet_event = { id = nep_phantom.73 }
			solar_system = {
				switch = {
					trigger = has_star_flag
					nep_phantom_energy_consume_1 = { root = { fleet_event = { id = nep_phantom.75 days = 110 } } }
					nep_phantom_energy_consume_2 = { root = { fleet_event = { id = nep_phantom.75 days = 100 } } }
					nep_phantom_energy_consume_3 = { root = { fleet_event = { id = nep_phantom.75 days = 90 } } }
					nep_phantom_energy_consume_4 = { root = { fleet_event = { id = nep_phantom.75 days = 80 } } }
					nep_phantom_energy_consume_5 = { root = {  fleet_event = { id = nep_phantom.75 days = 70 } } }
					default = { root = { fleet_event = { id = nep_phantom.75 days = 120 } } }
				}
			}
			fleet_event = { id = nep_phantom.78 days = 15 }
			owner = {
				country_event = { id = nep_phantom.30073 }
			}
		}
		if = { 
			limit = {
				owner = {
					has_country_flag = nep_phantom_active_stage_3
				}
			}
			fleet_event = { id = nep_phantom.70 days = 25 }
			fleet_event = { id = nep_phantom.74 }
			solar_system = {
				switch = {
					trigger = has_star_flag
					nep_phantom_energy_consume_1 = { root = { fleet_event = { id = nep_phantom.75 days = 116 } } }
					nep_phantom_energy_consume_2 = { root = { fleet_event = { id = nep_phantom.75 days = 107 } } }
					nep_phantom_energy_consume_3 = { root = { fleet_event = { id = nep_phantom.75 days = 98 } } }
					nep_phantom_energy_consume_4 = { root = { fleet_event = { id = nep_phantom.75 days = 89 } } }
					nep_phantom_energy_consume_5 = { root = { fleet_event = { id = nep_phantom.75 days = 80 } } }
					default = { root = { fleet_event = { id = nep_phantom.75 days = 125 } } }
				}
			}
			fleet_event = { id = nep_phantom.78 days = 15 }
			owner = {
				country_event = { id = nep_phantom.30074 }
			}
		}
	}
}

fleet_event = {
	id = nep_phantom.70
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_fleet_flag = nep_in_phantom_war
		solar_system = { NOT = { has_star_flag = nep_phantom_war_end } }
	}

	immediate = {
		solar_system = {
			switch = {
				trigger = has_star_flag
				nep_phantom_energy_consume_4 = { 
					set_star_flag = nep_phantom_energy_consume_5
					remove_star_flag = nep_phantom_energy_consume_4
				}
				nep_phantom_energy_consume_3 = { 
					set_star_flag = nep_phantom_energy_consume_4
					remove_star_flag = nep_phantom_energy_consume_3
				}
				nep_phantom_energy_consume_2 = { 
					set_star_flag = nep_phantom_energy_consume_3
					remove_star_flag = nep_phantom_energy_consume_2
				}
				nep_phantom_energy_consume_1 = { 
					set_star_flag = nep_phantom_energy_consume_2
					remove_star_flag = nep_phantom_energy_consume_1
				}
				default = { set_star_flag = nep_phantom_energy_consume_1 }
			}
		}
		fleet_event = { id = nep_phantom.70 days = 25 }
	}
}

fleet_event = {
	id = nep_phantom.71
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		has_fleet_flag = nep_in_phantom_war
		solar_system = { NOT = { has_star_flag = nep_phantom_war_end } }
	}
	
	immediate = {
		solar_system = {
			if = {
				limit = {
					count_ship_in_system = {
						limit = { owner = { is_same_value = event_target:nep_phantom_active } }
						count < 15
					}
				}
				random_system_ambient_object = { create_phantom_fleet_active_random = yes }
			}
		}
		fleet_event = { id = nep_phantom.71 days = 14 }
	}
}

fleet_event = {
	id = nep_phantom.72
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		has_fleet_flag = nep_in_phantom_war
		solar_system = { NOT = { has_star_flag = nep_phantom_war_end } }
	}
	
	immediate = {
		solar_system = {
			if = {
				limit = {
					count_ship_in_system = {
						limit = { owner = { is_same_value = event_target:nep_phantom_active } } 
						count < 20
					}
				}
				random_system_ambient_object = { create_phantom_fleet_active_random = yes }
			}
		}
		fleet_event = { id = nep_phantom.72 days = 12 }
	}
}

fleet_event = {
	id = nep_phantom.73
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		has_fleet_flag = nep_in_phantom_war
		solar_system = { NOT = { has_star_flag = nep_phantom_war_end } }
	}
	
	immediate = {
		solar_system = {
			if = {
				limit = {
					count_ship_in_system = {
						limit = { owner = { is_same_value = event_target:nep_phantom_active } } 
						count < 25
					}
				}
				random_system_ambient_object = { 
					create_phantom_fleet_active_random = yes
					random_list = {
						30 = { create_phantom_fleet_active_random = yes }
						70 = { }
					}
				}
			}
		}
		fleet_event = { id = nep_phantom.73 days = 15 }
	}
}


fleet_event = {
	id = nep_phantom.74
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		has_fleet_flag = nep_in_phantom_war
		solar_system = { NOT = { has_star_flag = nep_phantom_war_end } }
	}
	
	immediate = {
		solar_system = {
			if = {
				limit = {
					count_ship_in_system = {
						limit = { owner = { is_same_value = event_target:nep_phantom_active } } 
						count < 30
					}
				}
				random_system_ambient_object = { 
					create_phantom_fleet_active_random = yes
					random_list = {
						50 = { create_phantom_fleet_active_random = yes }
						50 = { }
					}
				}
			}
		}
		fleet_event = { id = nep_phantom.74 days = 13 }
	}
}


fleet_event = {
	id = nep_phantom.75
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_fleet_flag = nep_in_phantom_war
		exists = solar_system
		solar_system = { has_star_flag = nep_in_phantom_war }
	}
	
	immediate = {
		leader = {
			if = { 
				limit = { NOT = { has_trait = leader_trait_hero_of_mac } } 
				add_trait = leader_trait_hero_of_mac
			}
		}
		remove_fleet_flag = nep_in_phantom_war
		remove_modifier = nep_phantom_no_retreat
		remove_modifier = nep_energy_syphon_stage5
		remove_modifier = nep_energy_syphon_stage4
		remove_modifier = nep_energy_syphon_stage3
		remove_modifier = nep_energy_syphon_stage2
		remove_modifier = nep_energy_syphon_stage1
		solar_system = {
			remove_star_flag = nep_in_phantom_war
			set_star_flag = nep_phantom_war_end	
			every_fleet_in_system = {
				limit = { 
					owner = { is_country_type = nep_phantom_active }
				}
				destroy_fleet = this
			}
			add_hyperlane = { from = this to = event_target:nep_Ginan_system }
		}
		every_system = {
			limit = { has_star_flag = nep_phantom_energy_consume_1 }
			remove_star_flag = nep_phantom_energy_consume_1
		}
		every_system = {
			limit = { has_star_flag = nep_phantom_energy_consume_2 }
			remove_star_flag = nep_phantom_energy_consume_2
		}
		every_system = {
			limit = { has_star_flag = nep_phantom_energy_consume_3 }
			remove_star_flag = nep_phantom_energy_consume_3
		}
		every_system = {
			limit = { has_star_flag = nep_phantom_energy_consume_4 }
			remove_star_flag = nep_phantom_energy_consume_4
		}
		every_system = {
			limit = { has_star_flag = nep_phantom_energy_consume_5 }
			remove_star_flag = nep_phantom_energy_consume_5
		}
		owner = {
			if = {
				limit = { has_country_flag = nep_phantom_active_stage_3 }
				country_event = { id = nep_phantom.8 }
			}
			else_if = {
				limit = { has_country_flag = nep_phantom_active_stage_2 }
				remove_country_flag = nep_phantom_active_stage_2
				set_country_flag = nep_phantom_active_stage_3
				country_event = { id = nep_phantom.30075 }
			}
			else_if = {
				limit = { has_country_flag = nep_phantom_active_stage_1 }
				remove_country_flag = nep_phantom_active_stage_1
				set_country_flag = nep_phantom_active_stage_2
				country_event = { id = nep_phantom.30075 }
			}
			else = {
				set_country_flag = nep_phantom_active_stage_1
				country_event = { id = nep_phantom.30075 }
			}
		}	
	}
}

#on_yearly_pulse
event = {
	id = nep_phantom.76
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_active_begin
		NOT = { has_global_flag = nep_phantom_active_end }
	}
	
	immediate = {
		every_system = {
			limit = { has_star_flag = nep_Scrus_cluster }
			if = {
				limit = {
					any_fleet_in_system = { owner = { is_country_type = default } }
				}
			}
			else = {
				every_fleet_in_system = {
					delete_fleet = this
				}
				remove_star_flag = nep_in_phantom_war
			}
		}
		random_system = {
			limit = {
				NOT = { has_star_flag = nep_in_phantom_war }
				any_fleet_in_system = { has_fleet_flag = nep_in_phantom_war }
			}
			random_fleet_in_system = {
				limit = { has_fleet_flag = nep_in_phantom_war }
				remove_fleet_flag = nep_in_phantom_war
				remove_modifier = nep_phantom_no_retreat
			}
		}
		every_system = {
			limit = {
				has_star_flag = nep_Scrus_cluster
				NOT = { has_star_flag = nep_in_phantom_war }
				NOT = { has_hyperlane_to = event_target:nep_Ginan_system }
			}			
			add_hyperlane = { from = this to = event_target:nep_Ginan_system }
		}
		every_system = {
			limit = { has_star_flag = nep_phantom_energy_consume_1 }
			remove_star_flag = nep_phantom_energy_consume_1
		}
		every_system = {
			limit = { has_star_flag = nep_phantom_energy_consume_2 }
			remove_star_flag = nep_phantom_energy_consume_2
			set_star_flag = nep_phantom_energy_consume_1
		}
		every_system = {
			limit = { has_star_flag = nep_phantom_energy_consume_3 }
			remove_star_flag = nep_phantom_energy_consume_3
			set_star_flag = nep_phantom_energy_consume_2
		}
		every_system = {
			limit = { has_star_flag = nep_phantom_energy_consume_4 }
			remove_star_flag = nep_phantom_energy_consume_4
			set_star_flag = nep_phantom_energy_consume_3
		}
		every_system = {
			limit = { has_star_flag = nep_phantom_energy_consume_5 }
			remove_star_flag = nep_phantom_energy_consume_5
			set_star_flag = nep_phantom_energy_consume_4
		}
	}
}

#on_fleet_destroyed_perp
country_event = {
	id = nep_phantom.77
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = nep_phantom_active
		from = { NOT = { is_country_type = nep_phantom_active } }
	}
	
	immediate = {
		remove_global_flag = nep_phantom_in_the_arena
		from = { 
			country_event = { id = nep_phantom.30077 }
		}
		every_system = {
			limit = { has_star_flag = nep_in_phantom_war }
			every_fleet_in_system = {
				delete_fleet = this
			}
			remove_star_flag = nep_in_phantom_war
			if = { 
				limit = { exists = fromfromfrom }
				fromfromfrom = { remove_fleet_flag = nep_in_phantom_war }
			}			
			add_hyperlane = { from = this to = event_target:nep_Ginan_system }
		}
	}
}

#debuff
fleet_event = {
	id = nep_phantom.78
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_fleet_flag = nep_in_phantom_war
		solar_system = { 
			NOT = { has_star_flag = nep_phantom_war_end } 
		}
	}
	
	immediate = {
		owner = { country_event = { id = nep_phantom.30078 } }
		if = {
			limit = { NOT = { any_owned_ship = { has_modifier = nep_energy_syphon_stage1 } } }
			add_modifier = {
				modifier = nep_energy_syphon_stage1
				days = 125
			}
			fleet_event = { id = nep_phantom.78 days = 25 }
		}
		else_if = {
			limit = { 
				any_owned_ship = { 
					has_modifier = nep_energy_syphon_stage1
					NOT = { has_modifier = nep_energy_syphon_stage2 }
				} 
			}
			add_modifier = {
				modifier = nep_energy_syphon_stage2
				days = 100
			}
			fleet_event = { id = nep_phantom.78 days = 25 }
		}
		else_if = {
			limit = { 
				any_owned_ship = { 
					has_modifier = nep_energy_syphon_stage2
					NOT = { has_modifier = nep_energy_syphon_stage3 }
				}
			}
			add_modifier = {
				modifier = nep_energy_syphon_stage3
				days = 75
			}
			fleet_event = { id = nep_phantom.78 days = 25 }
		}
		else_if = {
			limit = { 
				any_owned_ship = { 
					has_modifier = nep_energy_syphon_stage3
					NOT = { has_modifier = nep_energy_syphon_stage4 }
				}
			}
			add_modifier = {
				modifier = nep_energy_syphon_stage4
				days = 50
			}
			fleet_event = { id = nep_phantom.78 days = 25 }
		}
		else = {
			IF = {
				limit = { 
					any_owned_ship = { 
						has_modifier = nep_energy_syphon_stage5
					} 
				}
			}
			else = {
				limit = {
					any_owned_ship = { 
						has_modifier = nep_energy_syphon_stage4
					} 
				}
				add_modifier = {
					modifier = nep_energy_syphon_stage5
					days = 25
				}
			}
		}
	}
}

country_event = {
	id = nep_phantom.79
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		from = { is_country_type = nep_phantom_active }
	}
	
	immediate = {
		delete_ship = fromfrom
	}
}

country_event = {
	id = nep_phantom.8
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		country_event = { id = nep_phantom.3008 } #Noti
		country_event = { id = nep_phantom.81 days = 30 random = 15 } #Noti
	}
}

country_event = {
	id = nep_phantom.81
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = nep_phantom_active_end
		set_country_flag = nep_phantom_orb_get
		every_country = {
			limit = { 
				OR = {
					is_country_type = nep_phantom_active
					is_country_type = nep_phantom_passive
					is_country_type = nep_Scrus_cluster_territorys
				}
			}
			every_owned_fleet = {
				destroy_fleet = this
			}
			destroy_country = yes
		}
		remove_global_flag = nep_phantom_passive_stage1
		remove_global_flag = nep_phantom_passive_stage2
		remove_global_flag = nep_phantom_passive_stage3
		remove_global_flag = nep_phantom_passive_stage4
		remove_global_flag = nep_phantom_passive_stage5
		remove_global_flag = nep_phantom_has_found
		remove_global_flag = nep_code_phantom
		remove_global_flag = nep_code_ghost
		remove_global_flag = nep_code_illusion
		remove_global_flag = nep_code_blurs
		every_country = {
			limit = {
				OR = {
					has_country_flag = nep_phantom_passive_defeated_1
					has_country_flag = nep_phantom_passive_defeated_2
					has_country_flag = nep_phantom_passive_defeated_3
					has_country_flag = nep_phantom_repeller_function_1
					has_country_flag = nep_phantom_repeller_function_2
					has_country_flag = nep_phantom_repeller_function_3
					has_country_flag = nep_phantom_3006_not_first
					has_country_flag = nep_phantom_has_death
					has_country_flag = nep_can_build_repeller
					has_country_flag = nep_phantom_active_stage_1
					has_country_flag = nep_phantom_active_stage_2
					has_country_flag = nep_phantom_active_stage_3
				}
			}
			remove_country_flag = nep_phantom_passive_defeated_1
			remove_country_flag = nep_phantom_passive_defeated_2
			remove_country_flag = nep_phantom_passive_defeated_3
			remove_country_flag = nep_phantom_repeller_function_1
			remove_country_flag = nep_phantom_repeller_function_2
			remove_country_flag = nep_phantom_repeller_function_3
			remove_country_flag = nep_phantom_3006_not_first
			remove_country_flag = nep_phantom_has_death
			remove_country_flag = nep_can_build_repeller
			remove_country_flag = nep_phantom_active_stage_1
			remove_country_flag = nep_phantom_active_stage_2
			remove_country_flag = nep_phantom_active_stage_3
			every_owned_fleet = {
				limit = {
					has_fleet_flag = nep_in_phantom_war
				}
				remove_fleet_flag = nep_in_phantom_war
			}
		}
		every_system = {
			limit = {
				has_star_flag = nep_in_phantom_war
			}
			remove_star_flag = nep_in_phantom_war
		}
		country_event = { id = nep_phantom.30081 } #Noti
	}
}

####################################
# fleet_actions
####################################
#on_crossing_border
fleet_event = {
	id = nep_phantom.1000
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_begin
		has_fleet_flag = nep_phantom_fleet_passive
		fromfrom = {
			exists = space_owner
			space_owner = { is_country_type = default }
		}
		from = {
			OR = {
				NOT = { exists = space_owner }
				AND = {
					exists = space_owner
					space_owner = { NOT = { is_same_value = root.fromfrom.space_owner } }
					# technically redundant
				}
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				NOT = { has_global_flag = nep_phantom_has_found }
				fromfrom.space_owner = { 
					is_ai = no 
					has_country_flag = nep_Krahen_orb_get 
				}				
			}
			set_global_flag = nep_phantom_has_found
			fromfrom.space_owner = { 
				set_country_flag = nep_phantom_first_contact
				country_event = { id = nep_phantom.3001 } 
			}
		}
		else_if = {
			limit = {
				has_global_flag = nep_phantom_has_found
				fromfrom.space_owner = { NOT = { has_country_flag = nep_phantom_first_contact } }
			}
			fromfrom.space_owner = { 
				set_country_flag = nep_phantom_first_contact
				country_event = { id = nep_phantom.3002 } 
			}
		}
	}
}

#on_fleet_auto_move_arrival
country_event = {
	id = nep_phantom.1001
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_begin
		is_country_type = nep_phantom_passive
	}
	
	immediate = {
		log = "1001fired"
		if = {
			limit = { 
				exists = fromfrom
			}
			from = {
				clear_fleet_actions = this
				queue_actions = {
					orbit_planet = root.fromfrom
				}
			}
			fromfrom = {
				planet_event = { id = nep_phantom.2001 } #begin energy syphen
			}
		}
		else = {
			from = { fleet_event = { id = nep_phantom.1002 } } #comes to other planet
		}
	}
}

fleet_event = {
	id = nep_phantom.1002
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_begin
	}
	
	immediate = {
		log = "1002fired"
		solar_system = { save_event_target_as = nep_1002_temp_solar_system }
		random_system = {
			limit = {
				distance = {
					source = root
					min_distance >= 100
					max_distance <= 200
				}
			}
			random_system_planet = {
				root = {
					set_location = {
						target = PREV
						distance = 50
						angle = random
					}
				}
			}
		}
		random_list = {
			90 = {
				closest_system = {					
					use_bypasses = yes
					limit = {
						NOT = { is_same_value = event_target:nep_1002_temp_solar_system }
						NOT = { any_ship_in_system = { owner =  { is_country_type = nep_phantom_passive } } }
						any_system_planet = {
							is_colony = yes
							exists = owner
							owner = {
								is_country_type = default
								is_primitive = no
							}
							if = {
								limit = {
									exists = owner
									owner = { num_owned_planets > 1 }
								}
								is_capital = no
							}
						}
					}
					random_system_planet = {
						limit = {
							is_colony = yes
							exists = owner
							owner = {
								is_country_type = default
								is_primitive = no
							}
							if = {
								limit = {
									exists = owner
									owner = { num_owned_planets > 1	}
								}								
								is_capital = no
							}
						}
						PREVPREV = {
							auto_move_to_planet = {
								target = PREV
								clear_auto_move_on_arrival = yes
							}
						}
					}
				}
			}
			10 = {
				closest_system = {					
					use_bypasses = yes
					limit = {
						any_system_planet = {
							is_colony = yes
							exists = owner
							owner = {
								is_country_type = default
								is_primitive = no
							}
							if = {
								limit = {
									exists = owner
									owner = { num_owned_planets > 1	}
								}
								is_capital = no
							}
							owner = { has_country_flag = nep_Krahen_orb_get }
						}
					}
					random_system_planet = {
						limit = {
							is_colony = yes
							exists = owner
							owner = {
								is_country_type = default
								is_primitive = no
							}
							if = {
								limit = {
									owner = { num_owned_planets > 1	}
								}
								is_capital = no
							}
							owner = { has_country_flag = nep_Krahen_orb_get }
						}
						PREVPREV = {
							auto_move_to_planet = {
								target = PREV
								clear_auto_move_on_arrival = yes
							}
						}
					}
				}
			}
		}
	}
}

###################################
# planet_actions
###################################
#stage1
planet_event = {
	id = nep_phantom.2001
	hide_window = yes
	
	is_triggered_only = yes
	
	pre_triggers = {
		has_owner = yes
	}
	
	trigger = { NOT = { has_planet_flag = nep_phantom_orbit } } #To prevent bugs
	
	immediate = {
		log = "2001fired"
		set_planet_flag = nep_phantom_orbit
		owner = { country_event = { id = nep_phantom.3201 } } #notification
		add_modifier = {
			modifier = nep_phantom_orbit_stage1
			days = 180
		}
		planet_event = { id = nep_phantom.2002 days = 180 } #stage2
	}
}

#stage2
planet_event = {
	id = nep_phantom.2002
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = { has_planet_flag = nep_phantom_orbit }
	
	immediate = {
		owner = { country_event = { id = nep_phantom.3202 } } #notification
		add_modifier = {
			modifier = nep_phantom_orbit_stage2
			days = 180
		}
		planet_event = { id = nep_phantom.2100 days = 90 } #death
		planet_event = { id = nep_phantom.2100 days = 180 }	#death
		planet_event = { id = nep_phantom.2003 days = 180 } #stage3
	}
}

#stage3
planet_event = {
	id = nep_phantom.2003
	hide_window = yes
	
	is_triggered_only = yes
	
	pre_triggers = {
		has_owner = yes
	}
	
	trigger = { has_planet_flag = nep_phantom_orbit }
	
	immediate = {
		owner = { country_event = { id = nep_phantom.3203 } } #notification
		add_modifier = {
			modifier = nep_phantom_orbit_stage3
			days = 360
		}
		planet_event = { id = nep_phantom.2100 days = 45 }  #death
		planet_event = { id = nep_phantom.2100 days = 90 }	#death
		planet_event = { id = nep_phantom.2100 days = 135 }	#death
		planet_event = { id = nep_phantom.2100 days = 180 }	#death
		planet_event = { id = nep_phantom.2100 days = 215 }	#death
		planet_event = { id = nep_phantom.2100 days = 240 }	#death
		planet_event = { id = nep_phantom.2100 days = 275 }	#death
		planet_event = { id = nep_phantom.2100 days = 310 }	#death
		planet_event = { id = nep_phantom.2100 days = 335 }	#death
		planet_event = { id = nep_phantom.2100 days = 360 }	#death
		planet_event = { id = nep_phantom.2004 days = 360 } #stage4
	}
}

#stage4
planet_event = {
	id = nep_phantom.2004
	hide_window = yes
	
	is_triggered_only = yes
	
	pre_triggers = {
		has_owner = yes
	}
	
	trigger = { has_planet_flag = nep_phantom_orbit }
	
	immediate = {
		owner = { country_event = { id = nep_phantom.3204 } } #notification
		add_modifier = {
			modifier = nep_phantom_orbit_stage4
			days = -1
		}
		planet_event = { id = nep_phantom.2101 days = 23 }  #death loop
	}
}

#death
planet_event = {
	id = nep_phantom.2100
	hide_window = yes
	
	is_triggered_only = yes
	
	pre_triggers = {
		has_owner = yes
	}
	
	trigger = { has_planet_flag = nep_phantom_orbit }	
	
	immediate = {
		owner = { save_event_target_as = nep_phantom_2100_temp }
		random_owned_pop = {
			kill_pop = yes
		}
		if = {
			limit = {
				has_modifier = nep_phantom_planet_debuff_death
			}
			remove_modifier = nep_phantom_planet_debuff_death
		}
		add_modifier = {
			modifier = nep_phantom_planet_debuff_death
			days = 180
		}
	}
	
	after = {
		if = {
			limit = { has_owner = yes }
			owner = { country_event = { id = nep_phantom.3210 } } #notification
		}
		else_if = {
			limit = { is_colony = no }
			solar_system = {
				every_fleet_in_system = {
					limit = {
						owner = { is_country_type = nep_phantom_passive }
					}
					clear_fleet_actions = this
					fleet_event = { id = nep_phantom.1002 }
				}
			}
			event_target:nep_phantom_2100_temp = { country_event = { id = nep_phantom.32100 } } #notification
		}
	}
}

#death loop
planet_event = {
	id = nep_phantom.2101
	hide_window = yes
	
	is_triggered_only = yes
	
	pre_triggers = {
		has_owner = yes
	}
	
	trigger = { has_planet_flag = nep_phantom_orbit }
	
	immediate = {
		owner = { save_event_target_as = nep_phantom_2101_temp }
		random_owned_pop = {
			kill_pop = yes
		}
		if = {
			limit = {
				has_modifier = nep_phantom_planet_debuff_death
			}
			remove_modifier = nep_phantom_planet_debuff_death
		}
		add_modifier = {
			modifier = nep_phantom_planet_debuff_death
			days = 180
		}
		planet_event = { id = nep_phantom.2101 days = 22 }  #death loop
	}
	
	after = {
		if = {
			limit = { has_owner = yes }
			owner = { country_event = { id = nep_phantom.3210 } } #notification
		}
		else_if = {
			limit = { is_colony = no }
			solar_system = {
				every_fleet_in_system = {
					limit = {
						owner = { is_country_type = nep_phantom_passive }
					}
					clear_fleet_actions = this
					fleet_event = { id = nep_phantom.1002 }
				}
			}
			event_target:nep_phantom_2101_temp = { country_event = { id = nep_phantom.32100 } } #notification
		}
	}
}

#build repeller
planet_event = {
	id = nep_phantom.2200
	hide_window = yes
	
	is_triggered_only = yes
	
	pre_triggers = {
		has_owner = yes
	}
	
	trigger = { has_planet_flag = nep_phantom_orbit }
	
	immediate = {
		owner = { country_event = { id = nep_phantom.3220 } } #notification
		set_planet_flag = nep_phantom_repeller_build
		if = {
			limit = { owner = { is_ai = yes } }
			planet_event = { id = nep_phantom.4001 }
		}			
	}
}

planet_event = {
	id = nep_phantom.2201
	hide_window = yes
	
	is_triggered_only = yes
	
	pre_triggers = {
		has_owner = yes
	}
	
	trigger = { has_planet_flag = nep_phantom_orbit }
		
	immediate = {
		if = {
			limit = {
				has_planet_flag = nep_phantom_planet_no_more_noti
			}
			remove_planet_flag = nep_phantom_planet_no_more_noti
		}
		if = {
			limit = {
				has_modifier = nep_phantom_orbit_stage1
			}
			remove_modifier = nep_phantom_orbit_stage1
		}
		if = {
			limit = {
				has_modifier = nep_phantom_orbit_stage2
			}
			remove_modifier = nep_phantom_orbit_stage2
		}
		if = {
			limit = {
				has_modifier = nep_phantom_orbit_stage3
			}
			remove_modifier = nep_phantom_orbit_stage3
		}
		if = {
			limit = {
				has_modifier = nep_phantom_orbit_stage4
			}
			remove_modifier = nep_phantom_orbit_stage4
		}
		if = {
			limit = {
				has_modifier = nep_phantom_planet_debuff_death
			}
			remove_modifier = nep_phantom_planet_debuff_death
		}
		solar_system = {
			every_fleet_in_system = {
				limit = {
					owner = { is_country_type = nep_phantom_passive }
				}
				clear_fleet_actions = this
				fleet_event = { id = nep_phantom.1002 }
			}
		}
		remove_planet_flag = nep_phantom_orbit
		remove_planet_flag = nep_phantom_repeller_functioning
		owner = {
			if = {
				limit = {
					NOR = {
						has_country_flag = nep_phantom_repeller_function_1
						has_country_flag = nep_phantom_repeller_function_2
						has_country_flag = nep_phantom_repeller_function_3
					}
				}
				set_country_flag = nep_phantom_repeller_function_1
			}
			else_if = {
				limit = {
					has_country_flag = nep_phantom_repeller_function_1
				}
				remove_country_flag = nep_phantom_repeller_function_1
				set_country_flag = nep_phantom_repeller_function_2
			}
			else_if = {
				limit = {
					has_country_flag = nep_phantom_repeller_function_2
				}
				remove_country_flag = nep_phantom_repeller_function_2
				set_country_flag = nep_phantom_repeller_function_3
			}
			owner = { country_event = { id = nep_phantom.3221 } } #notification
		}
	}
}
###################################
# notification
###################################
#Orb activity
country_event = {
	id = nep_phantom.3000
	title = "nep_phantom.3000.name"
	desc = "nep_phantom.3000.desc"
	picture = GFX_evt_analyzing_artifacts
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3000.a
	}
}

#first encount,on_crossing_border
country_event = {
	id = nep_phantom.3001
	title = "nep_phantom.3001.name"
	desc = "nep_phantom.3001.desc"
	picture = GFX_evt_news_room
	location = FromFromFrom
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_begin
	}
	
	immediate = {
	}
	
	option = {
		name = nep_phantom.3001.a
	}
}

country_event = {
	id = nep_phantom.3002
	title = "nep_phantom.3002.name"
	desc = "nep_phantom.3002.desc"
	picture = GFX_evt_news_room
	location = FromFromFrom
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_begin
	}
	
	immediate = {
	}
	
	option = {
		name = nep_phantom.3002.a
	}
}

country_event = {
	id = nep_phantom.3003
	title = "nep_phantom.3003.name"
	desc = "nep_phantom.3003.desc"
	picture = GFX_evt_unidentified_monster
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3003.a
	}
}

country_event = {
	id = nep_phantom.3004
	title = "nep_phantom.3004.name"
	desc = "nep_phantom.3004.desc"
	picture = GFX_evt_unidentified_monster
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3004.a
		enable_special_project = {
			name = nep_phantom_research_2
			owner = this
			location = capital_scope
		}
	}
}

			
country_event = {
	id = nep_phantom.3005
	title = "nep_phantom.3005.name"
	desc = "nep_phantom.3005.desc"
	picture = GFX_evt_engineering_research
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3005.a
	}
}


country_event = {
	id = nep_phantom.3006
	title = "nep_phantom.3006.name"
	desc = {
		trigger = {
			NOT = { has_country_flag = nep_phantom_3006_not_first }
		}
		text = "nep_phantom.3006.desc.a"
	}
	desc = {
		trigger = {
			has_country_flag = nep_phantom_3006_not_first
		}
		text = "nep_phantom.3006.desc.b"
	}
	picture = GFX_evt_black_hole
	location = from
	
	is_triggered_only = yes
	
	immediate = {
	}
	
	after = {
		set_country_flag = nep_phantom_3006_not_first
	}
	
	option = {
		name = nep_phantom.3006.a
		trigger = { NOT = { has_country_flag = nep_phantom_3006_not_first } }
	}
	
	option = {
		name = OK
		trigger = { has_country_flag = nep_phantom_3006_not_first }
	}
}

country_event = {
	id = nep_phantom.30061
	title = "nep_phantom.30061.name"
	desc = "nep_phantom.30061.desc"
	picture = GFX_evt_black_hole
	location = event_target:nep_Ginan_system
	
	is_triggered_only = yes
	
	immediate = {
	}
		
	option = {
		name = OK
	}
}

country_event = {
	id = nep_phantom.30062
	title = "nep_phantom.30062.name"
	desc = "nep_phantom.30062.desc"
	picture = GFX_evt_black_hole
	location = event_target:nep_sub_seal_3
	
	is_triggered_only = yes
	
	immediate = {
	}
		
	option = {
		name = CURSES
	}
}

country_event = {
	id = nep_phantom.30071
	title = "nep_phantom.30071.name"
	desc = "nep_phantom.30071.desc"
	picture = GFX_evt_ruined_system
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.30071.a
	}
}

country_event = {
	id = nep_phantom.30072
	title = "nep_phantom.30072.name"
	desc = "nep_phantom.30072.desc"
	picture = GFX_evt_ruined_system
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.30072.a
	}
}

country_event = {
	id = nep_phantom.30073
	title = "nep_phantom.30073.name"
	desc = "nep_phantom.30073.desc"
	picture = GFX_evt_ruined_system
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.30073.a
	}
}

country_event = {
	id = nep_phantom.30074
	title = "nep_phantom.30074.name"
	desc = "nep_phantom.30074.desc"
	picture = GFX_evt_ruined_system
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.30074.a
	}
}

country_event = {
	id = nep_phantom.30075
	title = "nep_phantom.30075.name"
	desc = "nep_phantom.30075.desc"
	picture = GFX_evt_pirates_attacking_cargo
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.30075.a
	}
}

country_event = {
	id = nep_phantom.30077
	title = "nep_phantom.30077.name"
	desc = "nep_phantom.30077.desc"
	picture = GFX_evt_exploding_ship
	
	is_triggered_only = yes
		
	immediate = {
		print_scope_effect = yes
	}
	
	option = {
		name = nep_phantom.30077.a
	}
}

country_event = {
	id = nep_phantom.30078
	title = "nep_phantom.30078.name"
	desc = "nep_phantom.30078.desc"
	picture = GFX_evt_pirates_attacking_cargo
	
	is_triggered_only = yes
	fire_only_once = yes
	
	immediate = {
	
	}
	
	option = { name = OK }
}

country_event = {
	id = nep_phantom.3008
	title = "nep_phantom.3008.name"
	desc = "nep_phantom.3008.desc"
	picture = GFX_evt_towel
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3008.a
	}
}

country_event = {
	id = nep_phantom.30081
	title = "nep_phantom.30081.name"
	desc = "nep_phantom.30081.desc"
	picture = GFX_evt_space_walk
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.30081.a
		add_research_option = tech_nep_phantom_aux
		remove_relic = r_nep_orb_x2
		add_relic = r_nep_orb_x3
	}
}

country_event = {
	id = nep_phantom.3201
	title = "nep_phantom.3201.name"
	desc = {
		trigger = {
			NOT = { exists = event_target:nep_phantom_global }
		}
		text = "nep_phantom.3201.desc.a"
	}
	desc = {
		trigger = {
			exists = event_target:nep_phantom_global
		}
		text = "nep_phantom.3201.desc.b"
	}
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3201.aa
		trigger = { NOT = { exists = event_target:nep_phantom_global } }
		hidden_effect = {
			set_global_flag = nep_code_phantom
			create_country = {
				name = "NAME_nep_phantom"
				type = nep_phantom_global_event
				effect = {
					save_global_event_target_as = nep_phantom_global
				}
			}
			last_created_country = {
				establish_communications_no_message = root
			}
		}
	}
	
	option = {
		name = nep_phantom.3201.ab
		trigger = { NOT = { exists = event_target:nep_phantom_global } }
		hidden_effect = {
			set_global_flag = nep_code_ghost
			create_country = {
				name = "NAME_nep_ghost"
				type = nep_phantom_global_event
				effect = {
					save_global_event_target_as = nep_phantom_global
				}
			}
			last_created_country = {
				establish_communications_no_message = root
			}
			every_country = {
				limit = { is_country_type = nep_phantom_passive }
				set_name = "NAME_nep_ghost_country"
				every_owned_fleet = {
					set_name = "NAME_nep_ghost_fleet_passive"
				}
				every_owned_ship = {
					set_name = "NAME_nep_ghost_fleet"
				}
			}
		}
	}
	
	option = {
		name = nep_phantom.3201.ac
		trigger = { NOT = { exists = event_target:nep_phantom_global } }
		hidden_effect = {
			set_global_flag = nep_code_illusion
			create_country = {
				name = "NAME_nep_illusion"
				type = nep_phantom_global_event
				effect = {
					save_global_event_target_as = nep_phantom_global
				}
			}
			last_created_country = {
				establish_communications_no_message = root
			}
			every_country = {
				limit = { is_country_type = nep_phantom_passive }
				set_name = "NAME_nep_illusion_country"
				every_owned_fleet = {
					set_name = "NAME_nep_illusion_fleet_passive"
				}
				every_owned_ship = {
					set_name = "NAME_nep_illusion_fleet"
				}
			}
		}
	}
	
	option = {
		name = nep_phantom.3201.ad
		trigger = { NOT = { exists = event_target:nep_phantom_global } }
		hidden_effect = {
			set_global_flag = nep_code_blurs
			create_country = {
				name = "NAME_nep_blurs"
				type = nep_phantom_global_event
				effect = {
					save_global_event_target_as = nep_phantom_global
				}
			}
			last_created_country = {
				establish_communications_no_message = root
			}
			every_country = {
				limit = { is_country_type = nep_phantom_passive }
				set_name = "NAME_nep_blurs_country"
				every_owned_fleet = {
					set_name = "NAME_nep_blurs_fleet_passive"
				}
				every_owned_ship = {
					set_name = "NAME_nep_blurs_fleet"
				}
			}
		}
	}
	
	option = {
		name = nep_phantom.3201.b
		trigger = { exists = event_target:nep_phantom_global }
	}
}

country_event = {
	id = nep_phantom.3202
	title = "nep_phantom.3202.name"
	desc = {
		trigger = {
			NOT = { has_country_flag = nep_can_build_repeller }
		}
		text = "nep_phantom.3202.desc.a"
	}
	desc = {
		trigger = {
			has_country_flag = nep_can_build_repeller
		}
		text = "nep_phantom.3202.desc.b"
	}
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3202.a
	}
}

country_event = {
	id = nep_phantom.3203
	title = "nep_phantom.3203.name"
	desc = "nep_phantom.3203.desc"
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3203.a
	}
}

country_event = {
	id = nep_phantom.3204
	title = "nep_phantom.3204.name"
	desc = "nep_phantom.3204.desc"
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3204.a
	}
}

country_event = {
	id = nep_phantom.32100
	title = "nep_phantom.32100.name"
	desc = "nep_phantom.32100.desc"
	picture = GFX_evt_collapsing_roof
	location = from
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.32100.a
	}
}

country_event = {
	id = nep_phantom.3210
	title = "nep_phantom.3210.name"
	desc = {
		trigger = {
			NOT = { has_country_flag = nep_can_build_repeller }
		}
		text = "nep_phantom.3210.desc.a"
	}
	desc = {
		trigger = {
			has_country_flag = nep_can_build_repeller
		}
		text = "nep_phantom.3210.desc.b"
	}
	picture = GFX_evt_disease_outbreak
	location = from
	
	is_triggered_only = yes
	
	trigger = {
		from = { NOT = { has_planet_flag = nep_phantom_planet_no_more_noti } }
	}
		
	immediate = {
	}
	
	after = {
		if = {
			limit = {
				NOT = { has_country_flag = nep_phantom_has_death }
			}
			set_country_flag = nep_phantom_has_death
		}
	}
	
	option = {
		name = nep_phantom.3210.aa
		trigger = {
			NOR = { 
				has_country_flag = nep_can_build_repeller
				has_special_project = nep_phantom_research_repeller
			}
		}
		enable_special_project = {
			name = nep_phantom_research_repeller
			owner = this
			location = capital_scope
		}
	}
	
	option = {
		name = nep_phantom.3210.a
		trigger = {
			is_ai = no
		}
	}
	
	option = {
		name = nep_phantom.3210.b
		trigger = {
			OR = {
				has_country_flag = nep_can_build_repeller
				has_special_project = nep_phantom_research_repeller
			}			
		}
		hidden_effect = { from = { set_planet_flag = nep_phantom_planet_no_more_noti } }
	}
}

country_event = {
	id = nep_phantom.3211
	title = "nep_phantom.3211.name"
	desc = "nep_phantom.3211.desc"
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
		
	immediate = {
		set_country_flag = nep_can_build_repeller
		every_country = {
			limit = { is_country_type = nep_phantom_passive }
			establish_communications_no_message = root
		}
	}
	
	option = {
		name = nep_phantom.3211.a
		custom_tooltip = nep_phantom.3211.a.tooltip
	}
}

country_event = {
	id = nep_phantom.3220
	title = "nep_phantom.3220.name"
	desc = "nep_phantom.3220.desc"
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3220.a
	}
}

country_event = {
	id = nep_phantom.3221
	title = "nep_phantom.3221.name"
	desc = "nep_phantom.3221.desc"
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
			
	immediate = { }
	
	option = {
		name = nep_phantom.3221.a
	}
	
	option = {
		name = nep_phantom.3221.b
		trigger = { 
			has_country_flag = nep_phantom_repeller_function_3 
			NOR = {				
				has_country_flag = nep_phantom_3_fired
				has_special_project = nep_phantom_research 
			}			
		}
		enable_special_project = {
			name = nep_phantom_research
			owner = this
			location = capital_scope
		}
	}
}

# country_event = {
	# id = nep_phantom.31111
	# title = "nep_phantom.31111.name"
	# desc = "nep_phantom.31111.desc"
	# picture = GFX_evt_in_the_dark
	
	# is_triggered_only = yes
	
	# immediate = {
	
	# }
	
	# option = { name = OK }
# }

####################################
# For AI Empire
####################################
planet_event = {
	id = nep_phantom.4000
	hide_window = yes
	
	pre_triggers = {
		has_owner = yes
		is_ai = yes
		original_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}
	
	trigger = {
		has_global_flag = nep_phantom_begin
		has_planet_flag = nep_phantom_orbit
		owner = { has_country_flag = nep_can_build_repeller }
		NOT = { has_planet_flag = nep_phantom_repeller_build }
	}
	
	mean_time_to_happen = {
		days = 90
	}
	
	immediate = {
		planet_event = { id = nep_phantom.2200 days = 180 }
	}
}

planet_event = {
	id = nep_phantom.4001
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		set_planet_flag = nep_phantom_repeller_functioning
		planet_event = { id = nep_phantom.2201 days = 45 }
		add_modifier = {
			modifier = nep_phantom_repeller_function
			days = 90
		}
	}	
}