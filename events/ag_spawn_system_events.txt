namespace = ag_spawn

# Remove planet modifiers
country_event = {
    id = ag_spawn.1
    hide_window = yes
	is_triggered_only = yes
	
    immediate = {
		last_created_system = {
			every_system_planet = {
				if = { limit = { has_modifier = hazardous_weather } remove_modifier = hazardous_weather }
				if = { limit = { has_modifier = dangerous_wildlife } remove_modifier = dangerous_wildlife }
				if = { limit = { has_modifier = weak_magnetic_field } remove_modifier = weak_magnetic_field }
				if = { limit = { has_modifier = strong_magnetic_field } remove_modifier = strong_magnetic_field }
				if = { limit = { has_modifier = unstable_tectonics } remove_modifier = unstable_tectonics }
				if = { limit = { has_modifier = tidal_locked } remove_modifier = tidal_locked }
				if = { limit = { has_modifier = chthonian_planet } remove_modifier = chthonian_planet }
				if = { limit = { has_modifier = asteroid_impacts } remove_modifier = asteroid_impacts }
				if = { limit = { has_modifier = extensive_moon_system } remove_modifier = extensive_moon_system }
				if = { limit = { has_modifier = carbon_world } remove_modifier = carbon_world }
				if = { limit = { has_modifier = wild_storms } remove_modifier = wild_storms }
				if = { limit = { has_modifier = low_gravity } remove_modifier = low_gravity }
				if = { limit = { has_modifier = high_gravity } remove_modifier = high_gravity }
				if = { limit = { has_modifier = mineral_rich } remove_modifier = mineral_rich }
				if = { limit = { has_modifier = ultra_rich } remove_modifier = ultra_rich }
				if = { limit = { has_modifier = mineral_poor } remove_modifier = mineral_poor }
				if = { limit = { has_modifier = titanic_life } remove_modifier = titanic_life }
				if = { limit = { has_modifier = asteroid_belt } remove_modifier = asteroid_belt }
				if = { limit = { has_modifier = natural_beauty } remove_modifier = natural_beauty }
				if = { limit = { has_modifier = atmospheric_aphrodisiac } remove_modifier = atmospheric_aphrodisiac }
				if = { limit = { has_modifier = atmospheric_hallucinogen } remove_modifier = atmospheric_hallucinogen }
				if = { limit = { has_modifier = bleak_planet } remove_modifier = bleak_planet }
				if = { limit = { has_modifier = irradiated_planet } remove_modifier = irradiated_planet }
			}
		}
    }
}

# First event: select archaeology siteâ€˜s discoverer
event = {
	id = ag_spawn.11
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		ag_spawnsystem_gatekeeper_trigger = yes
		NOT = { has_global_flag = ag_system_spawn_1 }
	}

	immediate = {
		random_list = {
			75 = { }
			25 = {
				if = {
					limit = {
						any_country = {
							is_ai = no
							has_technology = tech_sensors_3
							any_planet_within_border = {
								is_planet_class = pc_frozen
							}
						}
					}
					set_global_flag = ag_system_spawn_1
					random_country = {
						limit = {
							is_ai = no
							has_technology = tech_sensors_3
							any_planet_within_border = {
								is_planet_class = pc_frozen
							}
						}
						save_event_target_as = ag_target_country
						country_event = { id = ag_spawn.12 days = 60 random = 30 }
					}
				}
			}
		}
	}
}
country_event = {
	id = ag_spawn.12
	title = "ag_spawn.12.name"
	desc = "ag_spawn.12.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_archaeological_dig_room }
	show_sound = event_sensor_ping
	location = event_target:ag_archaeological_site_spawning_loc
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = ag_ancient_empire_event_begins
		set_country_flag = ag_ancient_building_site_discovered
		random_planet_within_border = {
			limit = {
				is_planet_class = pc_frozen
			}
			save_event_target_as = ag_archaeological_site_spawning_loc
		}
	}
	
	option = {
		name = "ag_spawn.12.a"
		trigger = {
			NOR = {
				has_ethic = ethic_fanatic_xenophobe
				has_ethic = ethic_xenophobe
			}
		}
		event_target:ag_archaeological_site_spawning_loc = {
			create_archaeological_site = ag_ancient_building_site
		}
	}
	option = {
		name = "ag_spawn.12.b"
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_xenophobe
				has_ethic = ethic_xenophobe
			}
		}
		event_target:ag_archaeological_site_spawning_loc = {
			create_archaeological_site = ag_ancient_building_site
		}
	}
}

# Check megastructures flag
event = {
	id = ag_spawn.21
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			limit = {
				any_owned_megastructure = {
					is_megastructure_type = ag_ancient_astronomy_station
				}
				NOT = {
					has_country_flag = ag_has_ancient_astronomy_station
				}
			}
			set_country_flag = ag_has_ancient_astronomy_station
			country_event = { id = ag_spawn.22 }
		}
		every_country = {
			limit = {
				has_country_flag = ag_has_ancient_astronomy_station
				NOT = {
					any_owned_megastructure = {
						is_megastructure_type = ag_ancient_astronomy_station
					}
				}
			}
			remove_country_flag = ag_has_ancient_astronomy_station
			if = {
				limit = { has_special_project = ag_locate_ancient_system_project }
				abort_special_project = { type = ag_locate_ancient_system_project }
				end_event_chain = ag_locate_ancient_system_project_chain
				country_event = { id = ag_spawn.23 }
			}
		}
	}
}
country_event = {
	id = ag_spawn.22
	title = "ag_spawn.22.name"
	desc = "ag_spawn.22.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	location = capital_scope
	
	is_triggered_only = yes

	option = {
		name = "ag_spawn.22.a"
		custom_tooltip = "ag_spawn.22.a.tooltip"
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = ag_locate_ancient_system_project_flag } }
				set_country_flag = ag_locate_ancient_system_project_flag
				random_list = {
					25 = { ag_give_research_project = { ag_project_id = @ag_locate_ancient_system_project_id ag_progress = 10 } }
					25 = { ag_give_research_project = { ag_project_id = @ag_locate_ancient_system_project_id ag_progress = 7.5 } }
					25 = { ag_give_research_project = { ag_project_id = @ag_locate_ancient_system_project_id ag_progress = 5 } }
					25 = { ag_give_research_project = { ag_project_id = @ag_locate_ancient_system_project_id ag_progress = 2.5 } }
				}
			}
		}
	}
}
country_event = {
	id = ag_spawn.23
	title = "ag_spawn.23.name"
	desc = "ag_spawn.23.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_default
	location = capital_scope
	
	is_triggered_only = yes

	option = { name = "ag_spawn.23.a" }
}

# Give special project to spawn systems
country_event = {
	id = ag_spawn.31
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			20 = { ag_reset_locate_ancient_system_project = { ag_progress = 5.0 } }
			20 = { ag_reset_locate_ancient_system_project = { ag_progress = 7.5 } }
			20 = { ag_reset_locate_ancient_system_project = { ag_progress = 10.0 } }
			20 = { ag_reset_locate_ancient_system_project = { ag_progress = 12.5 } }
			20 = { ag_reset_locate_ancient_system_project = { ag_progress = 15.0 } }
		}
		random_list = {
			20 = {
				modifier = { factor = 0.95 check_variable = { which = ag_num_failed_system_spawn_attempts value > 0 } }
				modifier = { factor = 0.9 check_variable = { which = ag_num_failed_system_spawn_attempts value > 1 } }
				modifier = { factor = 0.85 check_variable = { which = ag_num_failed_system_spawn_attempts value > 2 } }
				modifier = { factor = 0.8 check_variable = { which = ag_num_failed_system_spawn_attempts value > 3 } }
				modifier = { factor = 0.75 check_variable = { which = ag_num_failed_system_spawn_attempts value > 4 } }
				country_event = { id = ag_spawn.310 }
			}
			80 = {
				random_list = {
					10 = {
						modifier = { factor = 0.95 has_global_flag = ag_beta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 0 } }
						modifier = { factor = 0.9 has_global_flag = ag_beta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 1 } }
						modifier = { factor = 0.9 has_global_flag = ag_beta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 2 } }
						modifier = { factor = 0.8 has_global_flag = ag_beta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 3 } }
						modifier = { factor = 0.8 has_global_flag = ag_beta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 4 } }
						if = {
							limit = {
								NOR = {
									has_country_flag = ag_beta_system_locked
									has_global_flag = ag_beta_area_spawned
								}
							}
							set_variable = { which = ag_num_failed_system_spawn_attempts value = 0 }
							set_country_flag = ag_beta_system_locked
							country_event = { id = ag_spawn.312 }
						}
						else = { country_event = { id = ag_spawn.310 } }
					}
					10 = {
						modifier = { factor = 0.25 NOR = {
							has_global_flag = ag_beta_area_spawned
							has_global_flag = ag_delta_area_spawned
							has_global_flag = ag_iota_area_spawned
						} }
						modifier = { factor = 0.95 has_global_flag = ag_gamma_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 0 } }
						modifier = { factor = 0.9 has_global_flag = ag_gamma_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 1 } }
						modifier = { factor = 0.9 has_global_flag = ag_gamma_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 2 } }
						modifier = { factor = 0.8 has_global_flag = ag_gamma_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 3 } }
						modifier = { factor = 0.8 has_global_flag = ag_gamma_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 4 } }
						if = {
							limit = {
								NOR = {
									has_country_flag = ag_gamma_system_locked
									has_global_flag = ag_gamma_area_spawned
								}
							}
							set_variable = { which = ag_num_failed_system_spawn_attempts value = 0 }
							set_country_flag = ag_gamma_system_locked
							country_event = { id = ag_spawn.313 }
						}
						else = { country_event = { id = ag_spawn.310 } }
					}
					10 = {
						modifier = { factor = 0.95 has_global_flag = ag_epsilon_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 0 } }
						modifier = { factor = 0.9 has_global_flag = ag_epsilon_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 1 } }
						modifier = { factor = 0.9 has_global_flag = ag_epsilon_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 2 } }
						modifier = { factor = 0.8 has_global_flag = ag_epsilon_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 3 } }
						modifier = { factor = 0.8 has_global_flag = ag_epsilon_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 4 } }
						if = {
							limit = {
								NOR = {
									has_country_flag = ag_epsilon_system_locked
									has_global_flag = ag_epsilon_area_spawned
								}
							}
							set_variable = { which = ag_num_failed_system_spawn_attempts value = 0 }
							set_country_flag = ag_epsilon_system_locked
							country_event = { id = ag_spawn.315 }
						}
						else = { country_event = { id = ag_spawn.310 } }
					}
					10 = {
						modifier = { factor = 0.95 has_global_flag = ag_delta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 0 } }
						modifier = { factor = 0.9 has_global_flag = ag_delta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 1 } }
						modifier = { factor = 0.9 has_global_flag = ag_delta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 2 } }
						modifier = { factor = 0.8 has_global_flag = ag_delta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 3 } }
						modifier = { factor = 0.8 has_global_flag = ag_delta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 4 } }
						if = {
							limit = {
								NOR = {
									has_country_flag = ag_delta_system_locked
									has_global_flag = ag_delta_area_spawned
								}
							}
							set_variable = { which = ag_num_failed_system_spawn_attempts value = 0 }
							set_country_flag = ag_delta_system_locked
							country_event = { id = ag_spawn.314 }
						}
						else = { country_event = { id = ag_spawn.310 } }
					}
					10 = {
						modifier = { factor = 0.25 NOR = {
							has_global_flag = ag_beta_area_spawned
							has_global_flag = ag_delta_area_spawned
							has_global_flag = ag_iota_area_spawned
						} }
						modifier = { factor = 0.95 has_global_flag = ag_zeta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 0 } }
						modifier = { factor = 0.9 has_global_flag = ag_zeta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 1 } }
						modifier = { factor = 0.9 has_global_flag = ag_zeta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 2 } }
						modifier = { factor = 0.8 has_global_flag = ag_zeta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 3 } }
						modifier = { factor = 0.8 has_global_flag = ag_zeta_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 4 } }
						if = {
							limit = {
								NOR = {
									has_country_flag = ag_zeta_system_locked
									has_global_flag = ag_zeta_area_spawned
								}
							}
							set_variable = { which = ag_num_failed_system_spawn_attempts value = 0 }
							set_country_flag = ag_zeta_system_locked
							country_event = { id = ag_spawn.316 }
						}
						else = { country_event = { id = ag_spawn.310 } }
					}
					10 = {
						modifier = { factor = 0.95 has_global_flag = ag_iota_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 0 } }
						modifier = { factor = 0.9 has_global_flag = ag_iota_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 1 } }
						modifier = { factor = 0.9 has_global_flag = ag_iota_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 2 } }
						modifier = { factor = 0.8 has_global_flag = ag_iota_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 3 } }
						modifier = { factor = 0.8 has_global_flag = ag_iota_area_spawned check_variable = { which = ag_num_failed_system_spawn_attempts value > 4 } }
						if = {
							limit = {
								NOR = {
									has_country_flag = ag_iota_system_locked
									has_global_flag = ag_iota_area_spawned
								}
							}
							set_variable = { which = ag_num_failed_system_spawn_attempts value = 0 }
							set_country_flag = ag_iota_system_locked
							country_event = { id = ag_spawn.317 }
						}
						else = { country_event = { id = ag_spawn.310 } }
					}
				}
			}
		}
	}
}
# Nothing
country_event = {
	id = ag_spawn.310
	title = "ag_spawn.310.name"
	desc = "ag_spawn.310.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes

	immediate = { change_variable = { which = ag_num_failed_system_spawn_attempts value = 1 } }
	
	option = { name = "ag_spawn.310.a" }
}
# Beta Area
country_event = {
	id = ag_spawn.312
	title = "ag_spawn.31.name"
	desc = "ag_spawn.312.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	
	option = {
		name = "ag_spawn.31.a"
		if = {
			limit = {
				NOT = {
					has_event_chain = "ag_hidden_system_chain"
				}
			}
			begin_event_chain = {
				event_chain = "ag_hidden_system_chain"
				target = root.owner
			}
		}
		enable_special_project = {
			name = "ag_located_beta_area"
			location = capital_scope
			owner = root
		}
	}
}
# Gamma Area
country_event = {
	id = ag_spawn.313
	title = "ag_spawn.31.name"
	desc = "ag_spawn.313.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	
	option = {
		name = "ag_spawn.31.a"
		if = {
			limit = {
				NOT = {
					has_event_chain = "ag_hidden_system_chain"
				}
			}
			begin_event_chain = {
				event_chain = "ag_hidden_system_chain"
				target = root.owner
			}
		}
		enable_special_project = {
			name = "ag_located_gamma_area"
			location = capital_scope
			owner = root
		}
	}
}
# Delta Area
country_event = {
	id = ag_spawn.314
	title = "ag_spawn.31.name"
	desc = "ag_spawn.314.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	
	option = {
		name = "ag_spawn.31.a"
		if = {
			limit = {
				NOT = {
					has_event_chain = "ag_hidden_system_chain"
				}
			}
			begin_event_chain = {
				event_chain = "ag_hidden_system_chain"
				target = root.owner
			}
		}
		enable_special_project = {
			name = "ag_located_delta_area"
			location = capital_scope
			owner = root
		}
	}
}
# Epsilon Area
country_event = {
	id = ag_spawn.315
	title = "ag_spawn.31.name"
	desc = "ag_spawn.315.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	
	option = {
		name = "ag_spawn.31.a"
		if = {
			limit = {
				NOT = {
					has_event_chain = "ag_hidden_system_chain"
				}
			}
			begin_event_chain = {
				event_chain = "ag_hidden_system_chain"
				target = root.owner
			}
		}
		enable_special_project = {
			name = "ag_located_epsilon_area"
			location = capital_scope
			owner = root
		}
	}
}
# Zeta Area
country_event = {
	id = ag_spawn.316
	title = "ag_spawn.31.name"
	desc = "ag_spawn.316.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	
	option = {
		name = "ag_spawn.31.a"
		if = {
			limit = {
				NOT = {
					has_event_chain = "ag_hidden_system_chain"
				}
			}
			begin_event_chain = {
				event_chain = "ag_hidden_system_chain"
				target = root.owner
			}
		}
		enable_special_project = {
			name = "ag_located_zeta_area"
			location = capital_scope
			owner = root
		}
	}
}
# Iota Area
country_event = {
	id = ag_spawn.317
	title = "ag_spawn.31.name"
	desc = "ag_spawn.317.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	
	option = {
		name = "ag_spawn.31.a"
		if = {
			limit = {
				NOT = {
					has_event_chain = "ag_hidden_system_chain"
				}
			}
			begin_event_chain = {
				event_chain = "ag_hidden_system_chain"
				target = root.owner
			}
		}
		enable_special_project = {
			name = "ag_located_iota_area"
			location = capital_scope
			owner = root
		}
	}
}

# Notification for discoverer
country_event = {
	id = ag_spawn.32
	title = "ag_spawn.32.name"
	desc = "ag_spawn.32.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	
	option = {
		name = "ag_spawn.32.a"
	}
}
# Notification for others
country_event = {
	id = ag_spawn.33
	title = "ag_spawn.33.name"
	desc = "ag_spawn.33.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	
	option = {
		name = "ag_spawn.33.a"
	}
}
