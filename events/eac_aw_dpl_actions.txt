namespace = eac_aw_dpl_actions

# ship created
ship_event = {
    id = eac_aw_dpl_actions.1
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        is_ship_class = shipclass_military_station
        if = { limit = { has_global_flag = eac_aw_dpl_fallen_awakened_allowed }
            owner = { 
                OR = {
                    is_country_type = default 
                    is_country_type = fallen_empire
                    is_country_type = awakened_fallen_empire
                }
            }
        }
        else = {
            owner = { is_country_type = default }
        }
    }

    immediate = {
        set_disable_at_health = 0
    }
}

#ship disabled - starbase
ship_event = {
    id = eac_aw_dpl_actions.2
    hide_window = yes
    is_triggered_only = yes

    trigger = {
			is_ship_class = shipclass_starbase
				owner = { 
					OR = {
						is_country_type = default 
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
						is_country_type = mem_vazurans
					}
				}
			solar_system = {
				any_ship_in_system = {
					is_ship_class = shipclass_military_station
					is_disabled = yes
				}
			}
    }

    immediate = {
			solar_system = {
				every_ship = {
					limit = {
						is_ship_class = shipclass_military_station
						is_disabled = yes
					}
					eac_set_defense_platform_wake_up_timer = yes
				}
			}
    }
}

# wake up part 1
ship_event = {
    id = eac_aw_dpl_actions.3
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        is_ship_class = shipclass_military_station
				owner = { 
					OR = {
						is_country_type = default 
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
						is_country_type = mem_vazurans
					}
				}
        is_disabled = yes
    }

    immediate = {
        eac_set_defense_platform_restart_penalty = yes
        ship_event = { id = eac_aw_dpl_actions.4 days = 1 random = 5 }
    }
}

# wake up part 2
ship_event = {
    id = eac_aw_dpl_actions.4
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        is_ship_class = shipclass_military_station
				owner = { 
					OR = {
						is_country_type = default 
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
						is_country_type = mem_vazurans
					}
				}
        is_disabled = yes
    }

    immediate = {
        eac_restart_defense_platform = yes
    }
}


#ship disabled - military station
ship_event = {
    id = eac_aw_dpl_actions.10
    hide_window = yes
    is_triggered_only = yes

    trigger = {
				owner = { 
					OR = {
						is_country_type = default 
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
						is_country_type = mem_vazurans
					}
				}
        is_ship_class = shipclass_military_station
        is_disabled = yes
        NOT = { has_ship_flag = eac_military_station_wake_30 }
    }

    immediate = {
        fleet = {
            if = { limit = { is_in_combat = no }
                root = { 
                    eac_set_defense_platform_wake_up_timer = yes
                }
            }
            else = {
                root = { ship_event = { id = eac_aw_dpl_actions.10 days = 5 } }
            }
        }
    }
}

# fix in progress games
event = {
    id = eac_aw_dpl_actions.1000
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        every_country = {
            limit = { 
                if = { limit = { has_global_flag = eac_aw_dpl_fallen_awakened_allowed }
                    OR = {
                        is_country_type = default 
                        is_country_type = fallen_empire
                        is_country_type = awakened_fallen_empire
                    }
                }
                else = {
                    is_country_type = default
                }
            }
            every_owned_ship = {
                limit = {
                    is_ship_class = shipclass_military_station
                }
                set_disable_at_health = 0
            }
        }
    }
}

planet_event = {
    id = eac_aw_dpl_actions.9999
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        solar_system = {
            every_ship = {
                limit = { is_ship_class = shipclass_military_station }
                add_modifier = { modifier = eac_defense_platform_restart_penalty_50 days = 100 }
                log = "[This.GetName]"
            }
         }
    }
}