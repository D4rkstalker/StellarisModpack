namespace = projcrim_game_start

event = { 
	id = projcrim_game_start.1
	is_triggered_only = yes
	hide_window = yes

	trigger = {}

	immediate = {
		# Spreading Values
		every_playable_country = {
		# 	set_variable = {
		# 		which = projcrim_pop_spread_@root		# Spread from pop to pop on the same world
		# 		value = 1
		# 	}
		# 	set_variable = {
		# 		which = projcrim_planet_spread_@root		# Spread to a pop on a new world
		# 		value = 1
		# 	}
		# 	set_variable = {
		# 		which = projcrim_border_spread_@root		# Spread to a pop in a neighbouring nation
		# 		value = 1
		# 	}
			set_variable = {
				which = projcrim_infected_pops		# Afflicted Pops (nation)
				value = 0
			}
		}
		random_country = {
			limit = {
				is_country_type = global_event
			}
			set_variable = {
				which = projcrim_throng_worlds		# Afflicted Worlds
				value = 0
			}
			set_variable = {
				which = projcrim_infected_pops_galaxy		# Afflicted Pops (galaxy)
				value = 0
			}
			set_variable = {
				which = projcrim_cured_nations		# Immunised Nations
				value = 0
			}
		}
		set_global_flag = projcrim_installed							# required for the Mod Jam mod to detect your submission
		set_global_flag = projcrim_allowed							# required for spawning 
	}
}

# MESSAGES #
# Infection spread
planet_event = { 
	id = projcrim_game_start.5
	is_triggered_only = yes
	hide_window = yes

	trigger = {}

	immediate = {
		root.owner = {
			create_message = {
				type = MESSAGE_THRONG_SPREAD
				localization = MESSAGE_THRONG_SPREAD
				days = 20
				target = root
				variable = {
					type = name
					localization = PLANET
					scope = root
				}
			}
		}
	}
}

# World Afflicted
planet_event = { 
	id = projcrim_game_start.6
	is_triggered_only = yes
	hide_window = yes

	trigger = {}

	immediate = {
		root.owner = {
			create_message = {
				type = MESSAGE_WORLD_AFFLICTED
				localization = MESSAGE_WORLD_AFFLICTED
				days = 30
				target = root
				variable = {
					type = name
					localization = PLANET
					scope = root
				}
			}
		}
	}
}

# DEBUG #
# Spawn Crimson Throng
country_event = { 
	id = projcrim_game_start.2
	is_triggered_only = yes
	hide_window = yes

	trigger = {}

	immediate = {
		create_crimson_throng_species = yes
		create_crimson_throng_country = yes
	}
}

# Set translated flag
country_event = { 
	id = projcrim_game_start.3
	is_triggered_only = yes
	hide_window = yes

	trigger = {}

	immediate = {
		set_country_flag = throng_translated
	}
}

# Set debug flag
country_event = { 
	id = projcrim_game_start.4
	is_triggered_only = yes
	hide_window = yes

	trigger = {}

	immediate = {
		set_global_flag = project_crimson_debug
		set_country_flag = debug
	}
}

# Test Ships
country_event = { 
	id = projcrim_game_start.7
	is_triggered_only = yes
	hide_window = yes

	trigger = {}

	immediate = {
			create_fleet = {
				name = "NAME_Throng_Fleet"
				effect = {
					set_owner = event_target:crimson_throng_country
					create_ship = {
						name = random
						design = "NAME_Nanite_Mothership"
						graphical_culture = "pirate_01"
					}
					while = {
						count = 4
						create_ship = {
							name = random
							design = "NAME_Nanite_Interdictor"
							graphical_culture = "pirate_01"
						}
					}
					# set_formation_scale = 2
					# set_fleet_stance = aggressive
					# set_aggro_range_measure_from = return_point
					# set_aggro_range = 150
					set_location = {
						target = event_target:throng_world2
						distance = 20
						angle = 20
					}
				}
			}
	} 
}

# Create Ambient Object(s)
country_event = { 
	id = projcrim_game_start.8
	is_triggered_only = yes
	hide_window = yes

	trigger = {}

	immediate = {
		random_owned_planet = {
			limit = {
				any_owned_pop = {
					pop_has_trait = trait_crimson_infected
				}
			}
			create_ambient_object = {
				type = "projcrim_mist"
				location = this
				entity_offset_height = {
				 	min = -10
					max = -14
				}
			}
			last_created_ambient_object = {
				save_event_target_as = crimsonMist
				set_location = {
					target = prev
					distance = 0
					angle = random
				}
			}
		}
	}
}

# Create Ambient Object(s)
country_event = { 
	id = projcrim_game_start.9
	is_triggered_only = yes
	hide_window = yes

	trigger = {}

	immediate = {
		random_owned_planet = {
			limit = {
				any_owned_pop = {
					pop_has_trait = trait_crimson_infected
				}
			}
			while = {
				count = 2
				create_ambient_object = {
					type = "projcrim_infection_large"
					location = this
					entity_offset_height = {
						min = -10
						max = -14
					}
				}
				last_created_ambient_object = {
					save_event_target_as = InfectionEffect
					set_location = {
						target = prev
						distance = 0
						angle = random
					}
				}
			}
		}
	}
}

# Create Afflicted World
country_event = { 
	id = projcrim_game_start.10
	is_triggered_only = yes
	hide_window = yes

	trigger = {}

	immediate = {
		random_owned_planet = {
			limit = {
				any_owned_pop = {
					pop_has_trait = trait_crimson_infected
				}
			}
			solar_system = {
				spawn_planet = {
					class = pc_projcrim_afflicted
					location = root.home_planet
					orbit_distance_offset = 2
					orbit_angle_offset = 180
					size = 30
					init_effect = {
						set_name = {
							key = NAME_B_Planet
							variable_string = "[Root.GetHomeWorldName]"
						}
						save_event_target_as = throng_homeworld
						set_owner = event_target:crimson_throng_country
						set_controller = event_target:crimson_throng_country
						prevent_anomaly = yes
						clear_blockers = yes
						generate_start_deposits_and_blockers = yes
						remove_all_buildings = yes
						set_planet_flag = throng_homeworld
					}
				}
			#change_pc = pc_projcrim_afflicted
			}
		}
	}

}