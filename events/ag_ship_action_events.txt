namespace = ag_ship_action

fleet_event = {
	id = ag_ship_action.1
	title = "ag_ship_action.1.name"
	desc = "ag_ship_action.1.name"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "ag_ship_action_window"
	picture_event_data = { room = ag_ancient_empire_mod_settings_room }
	abort_trigger = { has_fleet_flag = ag_close_action_window }
	immediate = {
		owner = { set_country_flag = ag_ship_action_menu_opened }
		set_fleet_flag = ag_ship_action_target_@owner
		set_variable = { which = ag_num_alpha_titans value = 0 }
		set_variable = { which = ag_num_alpha_titan_event value = 0 }
		set_variable = { which = ag_num_gamma_stations value = 0 }
		set_variable = { which = ag_num_delta_platforms value = 0 }
		set_variable = { which = ag_num_epsilon_titans value = 0 }
		set_variable = { which = ag_num_zeta_titans value = 0 }
		set_variable = { which = ag_num_zeta_titans_gra value = 0 }
		set_variable = { which = ag_num_zeta_titans_psi value = 0 }
		set_variable = { which = ag_num_zeta_battleships value = 0 }
		set_variable = { which = ag_num_zeta_battleships_gra value = 0 }
		set_variable = { which = ag_num_zeta_battleships_psi value = 0 }
		set_variable = { which = ag_num_zeta_destroyers value = 0 }
		set_variable = { which = ag_num_zeta_destroyers_gra value = 0 }
		set_variable = { which = ag_num_zeta_destroyers_psi value = 0 }
		set_variable = { which = ag_num_eta_gateway value = 0 }
		set_variable = { which = ag_num_eta_titans value = 0 }
		set_variable = { which = ag_num_psi_containers value = 0 }
		owner = {
			if = { limit = { NOT = { is_variable_set = ag_alpha_psi_shield_auto_delay } } set_variable = { which = ag_alpha_psi_shield_auto_delay value = 0 } }
			if = { limit = { NOT = { is_variable_set = ag_alpha_psi_shield_auto_days } } set_variable = { which = ag_alpha_psi_shield_auto_days value = @ag_alpha_psi_shield_charge_days_max } }
		}
		every_controlled_ship = {
			switch = {
				trigger = is_ship_size
				ag_alpha_titan_0 = {
					if = {
						limit = { NOT = { has_ship_flag = ag_event_alpha_titan } }
						root = {
							change_variable = { which = ag_num_alpha_titans value = 1 }
							if = { limit = { prev = { is_variable_set = ag_alpha_psi_shield_charge } } set_variable = { which = ag_alpha_psi_shield_charge value = prev.ag_alpha_psi_shield_charge } }
						}
					}
					else = { root = { change_variable = { which = ag_num_alpha_titan_event value = 1 } } }
				}
				ag_alpha_titan_1 = { root = {
					change_variable = { which = ag_num_alpha_titans value = 1 }
					if = { limit = { prev = { is_variable_set = ag_alpha_psi_shield_charge } } set_variable = { which = ag_alpha_psi_shield_charge value = prev.ag_alpha_psi_shield_charge } }
				} }
				ag_alpha_psionic_container = { root = { change_variable = { which = ag_num_psi_containers value = 1 } } }
				ag_alpha_psionic_container_alt = { root = { change_variable = { which = ag_num_psi_containers value = 1 } } }
				ag_gamma_station_0 = { root = { change_variable = { which = ag_num_gamma_stations value = 1 } } }
				ag_gamma_station_1 = { root = { change_variable = { which = ag_num_gamma_stations value = 1 } } }
				ag_delta_platform_00 = { root = { change_variable = { which = ag_num_delta_platforms value = 1 } } }
				ag_delta_platform_10 = { root = { change_variable = { which = ag_num_delta_platforms value = 1 } } }
				ag_epsilon_titan_1 = { root = { change_variable = { which = ag_num_epsilon_titans value = 1 } } }
				ag_zeta_titan = {
					root = { change_variable = { which = ag_num_zeta_titans value = 1 } }
					if = {
						limit = { NOT = { has_ship_flag = ag_zeta_ship_gravity_weapon } }
						root = { change_variable = { which = ag_num_zeta_titans_psi value = 1 } }
					}
					else = { root = { change_variable = { which = ag_num_zeta_titans_gra value = 1 } } }
				}
				ag_zeta_battleship = {
					root = { change_variable = { which = ag_num_zeta_battleships value = 1 } }
					if = {
						limit = { NOT = { has_ship_flag = ag_zeta_ship_gravity_weapon } }
						root = { change_variable = { which = ag_num_zeta_battleships_psi value = 1 } }
					}
					else = { root = { change_variable = { which = ag_num_zeta_battleships_gra value = 1 } } }
				}
				ag_zeta_destroyer = {
					root = { change_variable = { which = ag_num_zeta_destroyers value = 1 } }
					if = {
						limit = { NOT = { has_ship_flag = ag_zeta_ship_gravity_weapon } }
						root = { change_variable = { which = ag_num_zeta_destroyers_psi value = 1 } }
					}
					else = { root = { change_variable = { which = ag_num_zeta_destroyers_gra value = 1 } } }
				}
				ag_eta_gateway_0 = { root = { change_variable = { which = ag_num_eta_gateway value = 1 } } }
				ag_eta_gateway_1 = { root = { change_variable = { which = ag_num_eta_gateway value = 1 } } }
				ag_eta_titan_0 = { root = { change_variable = { which = ag_num_eta_titans value = 1 } } }
				ag_eta_titan_1 = { root = { change_variable = { which = ag_num_eta_titans value = 1 } } }
			}
		}
	}
	after = { hidden_effect = {
		owner = { remove_country_flag = ag_ship_action_menu_opened }
		remove_fleet_flag = ag_ship_action_target_@owner
		remove_fleet_flag = ag_close_action_window
		clear_variable = ag_num_alpha_titans
		clear_variable = ag_num_alpha_titan_event
		clear_variable = ag_alpha_psi_shield_charge
		clear_variable = ag_num_gamma_stations
		clear_variable = ag_num_delta_platforms
		clear_variable = ag_num_epsilon_titans
		clear_variable = ag_num_zeta_titans
		clear_variable = ag_num_zeta_titans_gra
		clear_variable = ag_num_zeta_titans_psi
		clear_variable = ag_num_zeta_battleships
		clear_variable = ag_num_zeta_battleships_gra
		clear_variable = ag_num_zeta_battleships_psi
		clear_variable = ag_num_zeta_destroyers
		clear_variable = ag_num_zeta_destroyers_gra
		clear_variable = ag_num_zeta_destroyers_psi
		clear_variable = ag_num_eta_gateway
		clear_variable = ag_num_eta_titans
		clear_variable = ag_num_psi_containers
	} }
	abort_effect = { hidden_effect = {
		owner = { remove_country_flag = ag_ship_action_menu_opened }
		remove_fleet_flag = ag_ship_action_target_@owner
		remove_fleet_flag = ag_close_action_window
		clear_variable = ag_num_alpha_titans
		clear_variable = ag_num_alpha_titan_event
		clear_variable = ag_alpha_psi_shield_charge
		clear_variable = ag_num_gamma_stations
		clear_variable = ag_num_delta_platforms
		clear_variable = ag_num_epsilon_titans
		clear_variable = ag_num_zeta_titans
		clear_variable = ag_num_zeta_titans_gra
		clear_variable = ag_num_zeta_titans_psi
		clear_variable = ag_num_zeta_battleships
		clear_variable = ag_num_zeta_battleships_gra
		clear_variable = ag_num_zeta_battleships_psi
		clear_variable = ag_num_zeta_destroyers
		clear_variable = ag_num_zeta_destroyers_gra
		clear_variable = ag_num_zeta_destroyers_psi
		clear_variable = ag_num_eta_gateway
		clear_variable = ag_num_eta_titans
		clear_variable = ag_num_psi_containers
	} }
	option = {
		name = "ag_ship_action.1.default" custom_gui = "ag_action_default"
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.13" custom_gui = "ag_action_alpha_titan"
		trigger = { check_variable = { which = ag_num_alpha_titans value > 0 } }
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.13_alt" custom_gui = "ag_action_alpha_titan_evnet"
		trigger = { check_variable = { which = ag_num_alpha_titan_event value > 0 } }
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.14" custom_gui = "ag_action_alpha_psionic_container"
		trigger = { check_variable = { which = ag_num_psi_containers value > 0 } }
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.1" custom_gui = "ag_action_gamma_station"
		trigger = { check_variable = { which = ag_num_gamma_stations value > 0 } }
		default_hide_option = yes
	}
	option = { name = "ag_ship_action.1.2" custom_gui = "ag_action_delta_platforms"
		trigger = { check_variable = { which = ag_num_delta_platforms value > 0 } }
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.3" custom_gui = "ag_action_epsilon_titan"
		trigger = { check_variable = { which = ag_num_epsilon_titans value > 0 } }
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.4" custom_gui = "ag_action_zeta_titans"
		trigger = { check_variable = { which = ag_num_zeta_titans value > 0 } owner = { has_country_flag = ag_ship_subsystem_enabled_701_30 } }
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.5" custom_gui = "ag_action_zeta_battleships"
		trigger = { check_variable = { which = ag_num_zeta_battleships value > 0 } owner = { has_country_flag = ag_ship_subsystem_enabled_702_30 } }
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.6" custom_gui = "ag_action_zeta_destroyers"
		trigger = { check_variable = { which = ag_num_zeta_destroyers value > 0 } owner = { has_country_flag = ag_ship_subsystem_enabled_703_30 } }
		default_hide_option = yes
	}
	option = { name = "ag_ship_action.1.7" custom_gui = "ag_action_eta_gateway"
		trigger = { check_variable = { which = ag_num_eta_gateway value > 0 } }
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.8" custom_gui = "ag_action_eta_titan"
		trigger = { check_variable = { which = ag_num_eta_titans value > 0 } }
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.9" custom_gui = "ag_action_mine_field"
		trigger = { has_fleet_flag = ag_space_mine_field_fleet }
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.10" custom_gui = "ag_action_science_constructor"
		trigger = { has_fleet_flag = ag_science_constructor_fleet }
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.11" custom_gui = "ag_action_lost_ancient_ship"
		trigger = { any_controlled_ship = { has_ship_flag = ag_lost_ancient_ship } }
		default_hide_option = yes
	}
	option = {
		name = "ag_ship_action.1.12" custom_gui = "ag_action_observation_station"
		trigger = { any_controlled_ship = { is_ship_size = observation_station } }
		default_hide_option = yes
	}
}
