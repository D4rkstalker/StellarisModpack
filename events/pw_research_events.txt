namespace = pw_research

#General Events (0 - 999)

##Particle Supercollider Events (1000 - 1999)

#Pre-event setup
country_event = {
	id = pw_research.999
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_at_war = no
		is_ai = no
		NOR = {
			has_valid_civic = civic_machine_terminator
			has_valid_civic = civic_hive_devouring_swarm
			has_valid_civic = civic_fanatic_purifiers
		}
		any_owned_planet = {
			pw_planet_has_particle_supercollider = yes
		}
		any_country = {
			is_country_type = fallen_empire
			is_fallen_empire_spiritualist = yes
			is_at_war = no
			has_communications = root
			opinion = {
				who = THIS
				value > -70
			}
		}
	}

	immediate = {
		random_country = {
			limit = {
				is_country_type = fallen_empire
				is_fallen_empire_spiritualist = yes
				is_at_war = no
				has_communications = root
				opinion = {
					who = THIS
					value > -70
				}
			}
			save_event_target_as = PWFallenEmpirePC
		}
		random_owned_planet = {
			limit = {
				pw_planet_has_particle_supercollider = yes
			}
			save_event_target_as = PWFallenEmpirePCPlanet
		}
		country_event = {
			id = pw_research.1000
		}
	}

}

#Spiritualist Empire requests Collider
country_event = {
	id = pw_research.1000
	title = pw_research.1000.name
	desc = pw_research.1000.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpirePCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpirePC
		planet_background = event_target:PWFallenEmpirePC
		graphical_culture = event_target:PWFallenEmpirePC
		city_level = event_target:PWFallenEmpirePC
		room = event_target:PWFallenEmpirePC.ruler
	}

	#Let them
	option = {
		name = pw_research.1000.a
		event_target:PWFallenEmpirePCPlanet = {
			add_modifier = {
				modifier = pw_mod_particle_supercollider_research_in_use
				days = @pw_halfYear
				clear_on_owner_change = yes
			}
		}
		hidden_effect = {
			event_target:PWFallenEmpirePC = { add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }}
			country_event = { id = pw_research.1002 } #OK
			country_event = { id = pw_research.1004 days = 90 } #At war
			country_event = { id = pw_research.1005 days = 90 }	#Not at war
		}
	}

	#Ask what they want with it
	option = {
		name = pw_research.1000.b
		hidden_effect = {
			country_event = { id = pw_research.1001 }
		}
	}

	#Deny
	option = {
		name = pw_research.1000.c
		hidden_effect = {
			country_event = { id = pw_research.1003 }
			event_target:PWFallenEmpirePC = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }}
		}
	}
}

#More information
country_event = {
	id = pw_research.1001
	title = pw_research.1001.name
	desc = pw_research.1001.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpirePCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpirePC
		planet_background = event_target:PWFallenEmpirePC
		graphical_culture = event_target:PWFallenEmpirePC
		city_level = event_target:PWFallenEmpirePC
		room = event_target:PWFallenEmpirePC.ruler
	}

	#OK
	option = {
		name = pw_research.1001.a
		event_target:PWFallenEmpirePCPlanet = {
			add_modifier = {
				modifier = pw_mod_particle_supercollider_research_in_use
				days = @pw_halfYear
				clear_on_owner_change = yes
			}
		}
		hidden_effect = {
			event_target:PWFallenEmpirePC = { add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }}
			country_event = { id = pw_research.1002 } #OK
			country_event = { id = pw_research.1004 days = 90 } #At war
			country_event = { id = pw_research.1005 days = 90 }	#Not at war
		}
	}

	#Deny
	option = {
		name = pw_research.1000.c
		hidden_effect = {
			country_event = { id = pw_research.1003 }
			event_target:PWFallenEmpirePC = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }}
		}
	}
}

#Accept
country_event = {
	id = pw_research.1002
	title = pw_research.1002.name
	desc = pw_research.1002.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpirePCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpirePC
		planet_background = event_target:PWFallenEmpirePC
		graphical_culture = event_target:PWFallenEmpirePC
		city_level = event_target:PWFallenEmpirePC
		room = event_target:PWFallenEmpirePC.ruler
	}

	#OK
	option = {
		name = pw_research.1002.a
	}
}

#Deny
country_event = {
	id = pw_research.1003
	title = pw_research.1003.name
	desc = pw_research.1003.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpirePCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpirePC
		planet_background = event_target:PWFallenEmpirePC
		graphical_culture = event_target:PWFallenEmpirePC
		city_level = event_target:PWFallenEmpirePC
		room = event_target:PWFallenEmpirePC.ruler
	}

	#OK
	option = {
		name = pw_research.1003.a
	}
}

#Fallen Empire at war
country_event = {
	id = pw_research.1004
	title = pw_research.1004.name
	desc = pw_research.1004.desc
	picture = GFX_evt_physics_research
	is_triggered_only = yes
	location = event_target:PWFallenEmpirePCPlanet

	trigger = {
		OR = {
			NOT = { exists = event_target:PWFallenEmpirePC }
			event_target:PWFallenEmpirePC = {
				is_at_war = yes
			}
		}
	}

	#OK
	option = {
		name = pw_research.1004.a
		event_target:PWFallenEmpirePCPlanet = {
			if = {
				limit = { has_modifier = pw_mod_particle_supercollider_research_in_use }
				remove_modifier = pw_mod_particle_supercollider_research_in_use
			}
		}
	}
}

#Sudden Energy Drain
country_event = {
	id = pw_research.1005
	title = pw_research.1005.name
	desc = pw_research.1005.desc
	picture = GFX_evt_physics_research
	is_triggered_only = yes
	location = event_target:PWFallenEmpirePCPlanet
	show_sound = event_energy_field

	trigger = {
		exists = event_target:PWFallenEmpirePC
		event_target:PWFallenEmpirePC = {
			is_at_war = no
		}
	}

	#Contact them
	option = {
		name = pw_research.1005.a
		add_resource = {
			energy = -500
		}
		hidden_effect = {
			country_event = { id = pw_research.1006 }
		}
	}

	#Let them
	option = {
		name = pw_research.1005.b
		add_resource = {
			energy = -500
			influence = 25
		}
		hidden_effect = {
			country_event = { id = pw_research.1004 days = 90 }	#At war
			country_event = { id = pw_research.1009 days = 90 }
		}
	}
}

#Sudden Energy Drain - Contact
country_event = {
	id = pw_research.1006
	title = pw_research.1006.name
	desc = pw_research.1006.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpirePCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpirePC
		planet_background = event_target:PWFallenEmpirePC
		graphical_culture = event_target:PWFallenEmpirePC
		city_level = event_target:PWFallenEmpirePC
		room = event_target:PWFallenEmpirePC.ruler
	}

	#Continue
	option = {
		name = pw_research.1006.a

		hidden_effect = {
			event_target:PWFallenEmpirePC = { add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }}
			country_event = { id = pw_research.1004 days = 90 }	#At war
			country_event = { id = pw_research.1009 days = 90 }
			country_event = { id = pw_research.1007 }
		}
	}

	#Leave
	option = {
		name = pw_research.1006.b
		event_target:PWFallenEmpirePCPlanet = {
			if = {
				limit = { has_modifier = pw_mod_particle_supercollider_research_in_use }
				remove_modifier = pw_mod_particle_supercollider_research_in_use
			}
		}
		hidden_effect = {
			country_event = { id = pw_research.1008 }
			event_target:PWFallenEmpirePC = { remove_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request } }
			event_target:PWFallenEmpirePC = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }}
		}
	}
}

#Sudden Energy Drain - Continue
country_event = {
	id = pw_research.1007
	title = pw_research.1007.name
	desc = pw_research.1007.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpirePCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpirePC
		planet_background = event_target:PWFallenEmpirePC
		graphical_culture = event_target:PWFallenEmpirePC
		city_level = event_target:PWFallenEmpirePC
		room = event_target:PWFallenEmpirePC.ruler
	}

	#OK
	option = {
		name = pw_research.1007.a
	}
}

#Sudden Energy Drain - Stop
country_event = {
	id = pw_research.1008
	title = pw_research.1008.name
	desc = pw_research.1008.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpirePCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpirePC
		planet_background = event_target:PWFallenEmpirePC
		graphical_culture = event_target:PWFallenEmpirePC
		city_level = event_target:PWFallenEmpirePC
		room = event_target:PWFallenEmpirePC.ruler
	}

	#OK
	option = {
		name = pw_research.1008.a
	}
}

#Finish event
country_event = {
	id = pw_research.1009
	title = pw_research.1009.name
	desc = pw_research.1009.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpirePCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	trigger = {
		exists = event_target:PWFallenEmpirePC
		event_target:PWFallenEmpirePC = {
			is_at_war = no
		}
	}

	picture_event_data = {
		portrait = event_target:PWFallenEmpirePC
		planet_background = event_target:PWFallenEmpirePC
		graphical_culture = event_target:PWFallenEmpirePC
		city_level = event_target:PWFallenEmpirePC
		room = event_target:PWFallenEmpirePC.ruler
	}

	#GOOD
	option = {
		name = pw_research.1009.a
		add_monthly_resource_mult = {
			resource = physics_research
			value = @tier2researchreward
			min = @tier2researchmin
			max = @tier2researchmax
		}
		event_target:PWFallenEmpirePCPlanet = {
			add_modifier = {
				modifier = pw_mod_particle_supercollider_energy_surges
				days = 90
				clear_on_owner_change = yes
			}
			if = {
				limit = {
					has_modifier = pw_mod_particle_supercollider_research_in_use
				}
				remove_modifier = pw_mod_particle_supercollider_research_in_use
			}
		}
		add_research_option = pw_tech_fallen_empire_experiments_physics
	}
}


#Start the Experiments Event Chain
# Begin Particle Experiments
country_event = {
	id = pw_research.1100
	title = pw_research.1100.name
	desc = pw_research.1100.desc
	picture = GFX_evt_ancient_databank
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_laboratory_sound

	trigger = {
		NOT = { has_country_flag = pw_particle_supercollider_experiments_started }
		any_owned_planet = {
			pw_planet_has_particle_supercollider = yes
		}
	}

	immediate = {
		set_country_flag = pw_particle_supercollider_experiments_started
		random_owned_planet = {
			limit = {
				pw_planet_has_particle_supercollider = yes
			}
			save_event_target_as = PWPCPlanet
		}
	}

	#Commence the experiments
	option = {
		name = pw_research.1100.a
		begin_event_chain = {
			event_chain = pw_particle_supercollider_experiment_chain
			target = ROOT
		}
		enable_special_project = {
			name = PW_PHYSICS_PARTICLE_EXPERIMENTS
			owner = ROOT
			location = event_target:PWPCPlanet
		}
	}
}
#25% Progress - Nuclear Core Collision
country_event = {
	id = pw_research.1101
	title = pw_research.1101.name
	desc = pw_research.1101.desc
	picture = GFX_evt_ancient_databank
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_physics_experiment_done_1 }}
	immediate = { set_country_flag = pw_physics_experiment_done_1 }

	#Get the tech
	option = {
		name = pw_research.1101.a
		add_research_option = pw_tech_nuclear_core_collision
	}
}
#50% Progress - Weaponized Acceleration
country_event = {
	id = pw_research.1102
	title = pw_research.1102.name
	desc = pw_research.1102.desc
	picture = GFX_evt_ancient_databank
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_physics_experiment_done_2 }}
	immediate = { set_country_flag = pw_physics_experiment_done_2 }

	#Get the tech
	option = {
		name = pw_research.1102.a
		add_research_option = pw_tech_small_particle_weaponizing
	}
}
#75% Progress - Dark Matter secrets
country_event = {
	id = pw_research.1103
	title = pw_research.1103.name
	desc = pw_research.1103.desc
	picture = GFX_evt_ancient_databank
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_physics_experiment_done_3 }}
	immediate = { set_country_flag = pw_physics_experiment_done_3 }

	#Get the tech
	option = {
		name = pw_research.1103.a
		if = {
			limit = { NOT = { has_technology = tech_mine_dark_matter }}
			add_resource = {
				sr_dark_matter = 10
			}
			add_research_option = tech_mine_dark_matter
			add_tech_progress = {
				tech = tech_mine_dark_matter
				progress = 0.05
			}
		}
		else = {
			add_resource = {
				sr_dark_matter = 50
			}
		}
		hidden_effect = {
			set_country_flag = dark_matter_found
		}
	}
}
#Complete the experiment
country_event = {
	id = pw_research.1104
	title = pw_research.1104.name
	desc = pw_research.1104.desc
	picture = GFX_evt_ancient_databank
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_laboratory_sound

	immediate = {
		random_owned_planet = {
			limit = {
				pw_planet_has_particle_supercollider = yes
			}
			save_event_target_as = PWPCPlanet
		}
	}

	#Get the next tier
	option = {
		name = pw_research.1104.a
		custom_tooltip = pw_research_add_more_physics_jobs
		hidden_effect = {
			set_country_flag = pw_particle_supercollider_experiment_completed_1
		}
		add_research_option = pw_tech_particle_supercollider_organization
		enable_special_project = {
			name = PW_PHYSICS_COMPUTING_EXPERIMENTS
			owner = ROOT
			location = event_target:PWPCPlanet
		}
	}
}


# Begin Computing Experiments
#25% Progress - Dimensional Randomizing
country_event = {
	id = pw_research.1111
	title = pw_research.1111.name
	desc = pw_research.1111.desc
	picture = GFX_evt_glitchy_matrix
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_encrypted_comms

	trigger = { NOT = { has_country_flag = pw_physics_experiment_done_4 }}
	immediate = { set_country_flag = pw_physics_experiment_done_4 }

	#Get the tech
	option = {
		name = pw_research.1111.a
		add_research_option = pw_tech_dimensional_randomizing
	}
}
#50% Progress - Quantum Race Condition
country_event = {
	id = pw_research.1112
	title = pw_research.1112.name
	desc = pw_research.1112.desc
	picture = GFX_evt_glitchy_matrix
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_encrypted_comms

	trigger = { NOT = { has_country_flag = pw_physics_experiment_done_5 }}
	immediate = { set_country_flag = pw_physics_experiment_done_5 }

	#Get the tech
	option = {
		name = pw_research.1112.a
		add_modifier = {
			modifier = pw_mod_particle_supercollider_quantum_race_condition
			clear_on_owner_change = yes
			days = 180
		}
	}
}
#75% Progress - Develop Reality Map
country_event = {
	id = pw_research.1113
	title = pw_research.1113.name
	desc = pw_research.1113.desc
	picture = GFX_evt_glitchy_matrix
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_encrypted_comms

	trigger = { NOT = { has_country_flag = pw_physics_experiment_done_6 }}
	immediate = { set_country_flag = pw_physics_experiment_done_6 }

	#Get the tech
	option = {
		name = pw_research.1113.a
		add_research_option = pw_tech_reality_map
	}
}
#Complete the experiment (and map)
country_event = {
	id = pw_research.1114
	title = pw_research.1114.name
	desc = pw_research.1114.desc
	picture = GFX_evt_glitchy_matrix
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_encrypted_comms

	immediate = {
		random_owned_planet = {
			limit = {
				pw_planet_has_particle_supercollider = yes
			}
			save_event_target_as = PWPCPlanet
		}
	}

	#Get the next tier
	option = {
		name = pw_research.1114.a
		custom_tooltip = pw_research_add_more_physics_jobs
		hidden_effect = {
			set_country_flag = pw_particle_supercollider_experiment_completed_2
		}
		add_modifier = {
			modifier = pw_mod_particle_supercollider_reality_mapped
		}
		enable_special_project = {
			name = PW_PHYSICS_FIELD_THEORY_EXPERIMENTS
			owner = ROOT
			location = event_target:PWPCPlanet
		}
	}
}


# Begin Field Manipulation Experiments
#25% Progress - Exploring Hazardous Dimension
country_event = {
	id = pw_research.1121
	title = pw_research.1121.name
	desc = pw_research.1121.desc
	picture = GFX_evt_physics_research
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_physics_experiment_done_7 }}
	immediate = { set_country_flag = pw_physics_experiment_done_7 }

	#Get the tech
	option = {
		name = pw_research.1121.a
		add_research_option = pw_tech_crystal_personal_armor
	}
}
#50% Progress - Food Dimension
country_event = {
	id = pw_research.1122
	title = pw_research.1122.name
	desc = pw_research.1122.desc
	picture = GFX_evt_physics_research
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_physics_experiment_done_8 }}
	immediate = { set_country_flag = pw_physics_experiment_done_8 }

	#Get the tech (Uses Food)
	option = {
		name = pw_research.1122.a
		trigger = {
			country_uses_food = yes
		}
		add_monthly_resource_mult = {
			resource = food
			value = @tier3materialreward
			min = @tier3materialmin
			max = @tier3materialmax
		}
		add_research_option = pw_tech_food_dimension_draining
	}

	#Mockery (Not Uses Food)
	option = {
		name = pw_research.1122.b
		trigger = {
			country_uses_food = no
		}
		add_monthly_resource_mult = {
			resource = influence
			value = @tier1influencereward
			min = @tier1influencemin
			max = @tier1influencemax
		}
	}
}
#75% Progress - Center of a Star
country_event = {
	id = pw_research.1123
	title = pw_research.1123.name
	desc = pw_research.1123.desc
	picture = GFX_evt_physics_research
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_physics_experiment_done_9 }}
	immediate = {
		set_country_flag = pw_physics_experiment_done_9
		set_country_flag = pw_particle_supercollider_experiments_started
		random_owned_planet = {
			limit = {
				pw_planet_has_particle_supercollider = yes
			}
			save_event_target_as = PWPCPlanet
		}
	}

	#Get the tech
	option = {
		name = pw_research.1123.a
		add_monthly_resource_mult = {
			resource = energy
			value = @tier5materialreward
			min = @tier5materialmin
			max = @tier5materialmax
		}
		event_target:PWPCPlanet = {
			add_planet_devastation = 25
		}
	}
}
#Complete the experiment (and chain)
country_event = {
	id = pw_research.1124
	title = pw_research.1124.name
	desc = pw_research.1124.desc
	picture = GFX_evt_physics_research
	is_triggered_only = yes
	location = event_target:PWPCPlanet
	show_sound = event_laboratory_sound

	#Get the final reward
	option = {
		name = pw_research.1124.a
		custom_tooltip = pw_research_add_more_physics_jobs
		hidden_effect = {
			set_country_flag = pw_particle_supercollider_experiment_completed_3
		}
		add_resource = {
			sr_dark_matter = 50
		}
		add_research_option = pw_tech_interdimensional_collider
		end_event_chain = pw_particle_supercollider_experiment_chain
	}
}


##Domed City Events (2000 - 2999)

#Pre-event setup
country_event = {
	id = pw_research.1999
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_at_war = no
		is_ai = no
		NOR = {
			has_valid_civic = civic_machine_terminator
			has_valid_civic = civic_hive_devouring_swarm
			has_valid_civic = civic_fanatic_purifiers
		}
		any_owned_planet = {
			pw_planet_has_domed_city = yes
		}
		any_country = {
			is_country_type = fallen_empire
			is_fallen_empire_xenophile = yes
			is_at_war = no
			has_communications = root
			opinion = {
				who = THIS
				value > -70
			}
		}
	}

	immediate = {
		random_country = {
			limit = {
				is_country_type = fallen_empire
				is_fallen_empire_xenophile = yes
				is_at_war = no
				has_communications = root
				opinion = {
					who = THIS
					value > -70
				}
			}
			save_event_target_as = PWFallenEmpireDC
		}
		random_owned_planet = {
			limit = {
				pw_planet_has_domed_city = yes
			}
			save_event_target_as = PWFallenEmpireDCPlanet
		}
		country_event = {
			id = pw_research.2000
		}
	}

}

#Xenophile Empire requests Collider
country_event = {
	id = pw_research.2000
	title = pw_research.2000.name
	desc = pw_research.2000.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireDCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireDC
		planet_background = event_target:PWFallenEmpireDC
		graphical_culture = event_target:PWFallenEmpireDC
		city_level = event_target:PWFallenEmpireDC
		room = event_target:PWFallenEmpireDC.ruler
	}

	#Let them
	option = {
		name = pw_research.2000.a
		event_target:PWFallenEmpireDCPlanet = {
			add_modifier = {
				modifier = pw_mod_domed_city_research_in_use
				days = @pw_halfYear
				clear_on_owner_change = yes
			}
		}
		hidden_effect = {
			event_target:PWFallenEmpireDC = { add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }}
			country_event = { id = pw_research.2002 } #OK
			country_event = { id = pw_research.2004 days = 90 } #At war
			country_event = { id = pw_research.2005 days = 90 }	#Not at war
		}
	}

	#Ask what they want with it
	option = {
		name = pw_research.2000.b
		hidden_effect = {
			country_event = { id = pw_research.2001 }
		}
	}

	#Deny
	option = {
		name = pw_research.2000.c
		hidden_effect = {
			country_event = { id = pw_research.2003 }
			event_target:PWFallenEmpireDC = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }}
		}
	}
}

#More information
country_event = {
	id = pw_research.2001
	title = pw_research.2001.name
	desc = pw_research.2001.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireDCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireDC
		planet_background = event_target:PWFallenEmpireDC
		graphical_culture = event_target:PWFallenEmpireDC
		city_level = event_target:PWFallenEmpireDC
		room = event_target:PWFallenEmpireDC.ruler
	}

	#OK
	option = {
		name = pw_research.2001.a
		event_target:PWFallenEmpireDCPlanet = {
			add_modifier = {
				modifier = pw_mod_domed_city_research_in_use
				days = @pw_halfYear
				clear_on_owner_change = yes
			}
		}
		hidden_effect = {
			event_target:PWFallenEmpireDC = { add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }}
			country_event = { id = pw_research.2002 } #OK
			country_event = { id = pw_research.2004 days = 90 } #At war
			country_event = { id = pw_research.2005 days = 90 }	#Not at war
		}
	}

	#Deny
	option = {
		name = pw_research.2000.c
		hidden_effect = {
			country_event = { id = pw_research.2003 }
			event_target:PWFallenEmpireDC = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }}
		}
	}
}

#Accept
country_event = {
	id = pw_research.2002
	title = pw_research.2002.name
	desc = pw_research.2002.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireDCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireDC
		planet_background = event_target:PWFallenEmpireDC
		graphical_culture = event_target:PWFallenEmpireDC
		city_level = event_target:PWFallenEmpireDC
		room = event_target:PWFallenEmpireDC.ruler
	}

	#OK
	option = {
		name = pw_research.2002.a
	}
}

#Deny
country_event = {
	id = pw_research.2003
	title = pw_research.2003.name
	desc = pw_research.2003.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireDCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireDC
		planet_background = event_target:PWFallenEmpireDC
		graphical_culture = event_target:PWFallenEmpireDC
		city_level = event_target:PWFallenEmpireDC
		room = event_target:PWFallenEmpireDC.ruler
	}

	#OK
	option = {
		name = pw_research.2003.a
	}
}

#Fallen Empire at war
country_event = {
	id = pw_research.2004
	title = pw_research.2004.name
	desc = pw_research.2004.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWFallenEmpireDCPlanet

	trigger = {
		OR = {
			NOT = { exists = event_target:PWFallenEmpireDC }
			event_target:PWFallenEmpireDC = {
				is_at_war = yes
			}
		}
	}

	#OK
	option = {
		name = pw_research.2004.a
		event_target:PWFallenEmpireDCPlanet = {
			if = {
				limit = { has_modifier = pw_mod_domed_city_research_in_use }
				remove_modifier = pw_mod_domed_city_research_in_use
			}
		}
	}
}

#Intergalactic Transmission
country_event = {
	id = pw_research.2005
	title = pw_research.2005.name
	desc = pw_research.2005.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWFallenEmpireDCPlanet
	show_sound = event_energy_field

	trigger = {
		exists = event_target:PWFallenEmpireDC
		event_target:PWFallenEmpireDC = {
			is_at_war = no
		}
	}

	#Contact them
	option = {
		name = pw_research.2005.a
		add_resource = {
			influence = -50
		}
		hidden_effect = {
			country_event = { id = pw_research.2006 }
		}
	}

	#Let them
	option = {
		name = pw_research.2005.b
		add_resource = {
			influence = -30
			unity = 500
		}
		hidden_effect = {
			country_event = { id = pw_research.2004 days = 90 }	#At war
			country_event = { id = pw_research.2009 days = 90 }
		}
	}
}

#Intergalactic Transmission - Contact
country_event = {
	id = pw_research.2006
	title = pw_research.2006.name
	desc = pw_research.2006.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireDCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireDC
		planet_background = event_target:PWFallenEmpireDC
		graphical_culture = event_target:PWFallenEmpireDC
		city_level = event_target:PWFallenEmpireDC
		room = event_target:PWFallenEmpireDC.ruler
	}

	#Continue
	option = {
		name = pw_research.2006.a

		hidden_effect = {
			event_target:PWFallenEmpireDC = { add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }}
			country_event = { id = pw_research.2004 days = 90 }	#At war
			country_event = { id = pw_research.2009 days = 90 }
			country_event = { id = pw_research.2007 }
		}
	}

	#Leave
	option = {
		name = pw_research.2006.b
		event_target:PWFallenEmpireDCPlanet = {
			if = {
				limit = { has_modifier = pw_mod_domed_city_research_in_use }
				remove_modifier = pw_mod_domed_city_research_in_use
			}
		}
		hidden_effect = {
			country_event = { id = pw_research.2008 }
			event_target:PWFallenEmpireDC = { remove_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request } }
			event_target:PWFallenEmpireDC = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }}
		}
	}
}

#Intergalactic Transmission - Continue
country_event = {
	id = pw_research.2007
	title = pw_research.2007.name
	desc = pw_research.2007.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireDCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireDC
		planet_background = event_target:PWFallenEmpireDC
		graphical_culture = event_target:PWFallenEmpireDC
		city_level = event_target:PWFallenEmpireDC
		room = event_target:PWFallenEmpireDC.ruler
	}

	#OK
	option = {
		name = pw_research.2007.a
	}
}

#Intergalactic Transmission - Stop
country_event = {
	id = pw_research.2008
	title = pw_research.2008.name
	desc = pw_research.2008.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireDCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireDC
		planet_background = event_target:PWFallenEmpireDC
		graphical_culture = event_target:PWFallenEmpireDC
		city_level = event_target:PWFallenEmpireDC
		room = event_target:PWFallenEmpireDC.ruler
	}

	#OK
	option = {
		name = pw_research.2008.a
	}
}

#Finish event
country_event = {
	id = pw_research.2009
	title = pw_research.2009.name
	desc = pw_research.2009.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireDCPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	trigger = {
		exists = event_target:PWFallenEmpireDC
		event_target:PWFallenEmpireDC = {
			is_at_war = no
		}
	}

	picture_event_data = {
		portrait = event_target:PWFallenEmpireDC
		planet_background = event_target:PWFallenEmpireDC
		graphical_culture = event_target:PWFallenEmpireDC
		city_level = event_target:PWFallenEmpireDC
		room = event_target:PWFallenEmpireDC.ruler
	}

	#GOOD
	option = {
		name = pw_research.2009.a
		add_monthly_resource_mult = {
			resource = society_research
			value = @tier2researchreward
			min = @tier2researchmin
			max = @tier2researchmax
		}
		add_monthly_resource_mult = {
			resource = unity
			value = @tier2unityreward
			min = @tier2unitymin
			max = @tier2unitymax
		}
		event_target:PWFallenEmpireDCPlanet = {
			if = {
				limit = {
					has_modifier = pw_mod_domed_city_research_in_use
				}
				remove_modifier = pw_mod_domed_city_research_in_use
			}
		}
		add_research_option = pw_tech_fallen_empire_experiments_society
	}
}

#Prompt Domed City transmission program
country_event = {
	id = pw_research.2010
	title = pw_research.2010.name
	desc = pw_research.2010.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	trigger = {
		is_gestalt = no
		NOT = { has_valid_civic = civic_fanatic_purifiers }
		any_owned_planet = {
			pw_planet_has_domed_city = yes
		}
	}

	immediate = {
		random_owned_planet = {
			limit = {
				pw_planet_has_domed_city = yes
			}
			save_event_target_as = PWDCPlanet
		}
	}

	#Regular Reality show
	option = {
		name = pw_research.2010.a
		add_modifier = {
			modifier = pw_mod_domed_city_transmitted_experiments_unity
		}
	}

	#Megacorp Reality show
	option = {
		name = pw_research.2010.b
		trigger = {
			is_megacorp = yes
		}
		add_modifier = {
			modifier = pw_mod_domed_city_transmitted_experiments_megacorp
		}
	}

	#Media Conglomerate Reality show
	option = {
		name = pw_research.2010.c
		trigger = {
			has_valid_civic = civic_media_conglomerate
		}
		add_monthly_resource_mult = {
			resource = unity
			value = @tier3unityreward
			min = @tier3unitymin
			max = @tier3unitymax
		}
		add_modifier = {
			modifier = pw_mod_domed_city_transmitted_experiments_megacorp
		}
	}

	#Materialist - archive
	option = {
		name = pw_research.2010.d
		trigger = {
			is_materialist = yes
		}
		add_modifier = {
			modifier = pw_mod_domed_city_transmitted_experiments_research
		}
	}

	#No
	option = {
		name = pw_research.2010.e
		add_monthly_resource_mult = {
			resource = influence
			value = @tier3influencereward
			min = @tier3influencemin
			max = @tier3influencemax
		}
	}
}

#Start the Experiments Event Chain
# Begin Hazard Environment Experiments
country_event = {
	id = pw_research.2100
	title = pw_research.2100.name
	desc = pw_research.2100.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	trigger = {
		NOT = { has_country_flag = pw_domed_city_experiments_started }
		any_owned_planet = {
			pw_planet_has_domed_city = yes
		}
	}

	immediate = {
		set_country_flag = pw_domed_city_experiments_started
		random_owned_planet = {
			limit = {
				pw_planet_has_domed_city = yes
			}
			save_event_target_as = PWDCPlanet
		}
	}

	#Commence the experiments
	option = {
		name = pw_research.2100.a
		begin_event_chain = {
			event_chain = pw_domed_city_experiment_chain
			target = ROOT
		}
		enable_special_project = {
			name = PW_SOCIETY_HAZARD_ENVIRONMENTS_EXPERIMENTS
			owner = ROOT
			location = event_target:PWDCPlanet
		}
	}
}
#25% Progress - Too hazardous
country_event = {
	id = pw_research.2101
	title = pw_research.2101.name
	desc = pw_research.2101.desc
	picture = GFX_evt_molten
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_society_experiment_done_1 }}
	immediate = {
		set_country_flag = pw_society_experiment_done_1
		random_owned_planet = {
			limit = {
				pw_planet_has_domed_city = yes
			}
			save_event_target_as = PWDCPlanet
		}
	}

	#Pop dies
	option = {
		name = pw_research.2101.a
		event_target:PWDCPlanet = {
			if = {
				limit = {
					any_owned_pop = {
						OR = {
							has_job = pw_domed_city_subject_drone
							has_job = pw_domed_city_test_subject
						}
					}
				}
				random_owned_pop = {
					limit = {
						OR = {
							has_job = pw_domed_city_subject_drone
							has_job = pw_domed_city_test_subject
						}
					}
					kill_pop = yes
				}
			}
			else = {
				random_owned_pop = {
					kill_pop = yes
				}
			}
		}
	}
}
#50% Progress - Better habitation
country_event = {
	id = pw_research.2102
	title = pw_research.2102.name
	desc = pw_research.2102.desc
	picture = GFX_evt_big_landing_ship
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_society_experiment_done_2 }}
	immediate = { set_country_flag = pw_society_experiment_done_2 }

	#Get the tech
	option = {
		name = pw_research.2102.a
		add_research_option = pw_tech_extreme_habitation_studies
	}
}
#75% Progress - Crisis management
country_event = {
	id = pw_research.2103
	title = pw_research.2103.name
	desc = pw_research.2103.desc
	picture = GFX_evt_alien_propaganda
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_society_experiment_done_3 }}
	immediate = { set_country_flag = pw_society_experiment_done_3 }

	#Get the tech
	option = {
		name = pw_research.2103.a
		add_research_option = pw_tech_crisis_management
	}
}
#Complete the experiment
country_event = {
	id = pw_research.2104
	title = pw_research.2104.name
	desc = pw_research.2104.desc
	picture = GFX_evt_ancient_alien_temple
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	immediate = {
		random_owned_planet = {
			limit = {
				pw_planet_has_domed_city = yes
			}
			save_event_target_as = PWDCPlanet
		}
	}

	#Get the next tier
	option = {
		name = pw_research.2104.a
		custom_tooltip = pw_research_add_more_society_jobs
		hidden_effect = {
			set_country_flag = pw_domed_city_experiment_completed_1
		}
		add_research_option = pw_tech_domed_city_organization
		enable_special_project = {
			name = PW_SOCIETY_GOVERNMENTAL_EXPERIMENTS
			owner = ROOT
			location = event_target:PWDCPlanet
		}
	}
}

#Begin Governmental Experiments
#25% Progress - Social Construction
country_event = {
	id = pw_research.2111
	title = pw_research.2111.name
	desc = pw_research.2111.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_society_experiment_done_4 }}
	immediate = { set_country_flag = pw_society_experiment_done_4 }

	#Get tech
	option = {
		name = pw_research.2111.a
		add_research_option = pw_tech_social_construction_fabrication
	}
}
#50% Progress - Manufacturing Consent
country_event = {
	id = pw_research.2112
	title = pw_research.2112.name
	desc = pw_research.2112.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_society_experiment_done_5 }}
	immediate = { set_country_flag = pw_society_experiment_done_5 }

	#Manufacture Consent
	option = {
		name = pw_research.2112.a
		trigger = {
			exists = owner
			owner = { is_gestalt = no }
		}
		add_modifier = {
			modifier = pw_mod_domed_city_rule_manufactured_consent
			days = @pw_10years
		}
	}

	#Consent
	option = {
		name = pw_research.2112.b
		trigger = {
			exists = owner
			owner = { is_gestalt = no }
		}
		allow = {
			is_authoritarian = no
		}
		add_modifier = {
			modifier = pw_mod_domed_city_rule_from_consent
			days = @pw_10years
		}
	}

	#Coercion
	option = {
		name = pw_research.2112.c
		trigger = {
			exists = owner
			owner = { is_gestalt = no }
		}
		allow = {
			is_egalitarian = no
		}
		add_modifier = {
			modifier = pw_mod_domed_city_rule_from_coercion
			days = @pw_10years
		}
	}

	#Gestalt
	option = {
		name = pw_research.2112.d
		trigger = {
			exists = owner
			owner = { is_gestalt = yes }
		}
		add_modifier = {
			modifier = pw_mod_domed_city_rule_gestalt
			days = @pw_10years
		}
	}

	after = {
		hidden_effect = {
			country_event = {
				id = pw_research.2115
				days = 15
			}
		}
	}
}
#75% Progress - Army Organization
country_event = {
	id = pw_research.2113
	title = pw_research.2113.name
	desc = pw_research.2113.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_society_experiment_done_6 }}
	immediate = { set_country_flag = pw_society_experiment_done_6 }

	#Get the tech
	option = {
		name = pw_research.2113.a
		add_research_option = pw_tech_military_social_values
	}
}
#Complete the experiment
country_event = {
	id = pw_research.2114
	title = pw_research.2114.name
	desc = pw_research.2114.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	immediate = {
		random_owned_planet = {
			limit = {
				pw_planet_has_domed_city = yes
			}
			save_event_target_as = PWDCPlanet
		}
	}

	#Get the next tier
	option = {
		name = pw_research.2114.a
		trigger = {
			is_machine_empire = no
		}
		custom_tooltip = pw_research_add_more_society_jobs
		hidden_effect = {
			set_country_flag = pw_domed_city_experiment_completed_2
		}
		add_research_option = pw_tech_targeted_chemical_bliss
		enable_special_project = {
			name = PW_SOCIETY_EXOTIC_SUBSTANCES_EXPERIMENTS
			owner = ROOT
			location = event_target:PWDCPlanet
		}
	}

	#Get the next tier
	option = {
		name = pw_research.2114.b
		trigger = {
			is_machine_empire = yes
		}
		custom_tooltip = pw_research_add_more_society_jobs
		hidden_effect = {
			set_country_flag = pw_domed_city_experiment_completed_2
		}
		enable_special_project = {
			name = PW_SOCIETY_EXOTIC_SUBSTANCES_EXPERIMENTS
			owner = ROOT
			location = event_target:PWDCPlanet
		}
	}
}
#Additional Event - Scarcity vs Abundance
country_event = {
	id = pw_research.2115
	title = pw_research.2115.name
	desc = pw_research.2115.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	#Abundance
	option = {
		name = pw_research.2115.a
		add_monthly_resource_mult = {
			resource = unity
			value = @tier3unityreward
			min = @tier3unitymin
			max = @tier3unitymax
		}
	}

	#Scarcity
	option = {
		name = pw_research.2115.b
		add_monthly_resource_mult = {
			resource = influence
			value = @tier3influencereward
			min = @tier3influencemin
			max = @tier3influencemax
		}
	}
}

#Begin Exotic Substance Experiments
#25% Progress - Fear and Delusion
country_event = {
	id = pw_research.2121
	title = pw_research.2121.name
	desc = pw_research.2121.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_society_experiment_done_7 }}
	immediate = {
		set_country_flag = pw_society_experiment_done_7
		random_owned_planet = {
			limit = {
				pw_planet_has_domed_city = yes
			}
			save_event_target_as = PWDCPlanet
		}
	}

	#Get science
	option = {
		name = pw_research.2121.a
		add_monthly_resource_mult = {
			resource = society_research
			value = @tier2researchreward
			min = @tier2researchmin
			max = @tier2researchmax
		}
		event_target:PWDCPlanet = {
			add_modifier = {
				modifier = pw_mod_domed_city_repairing_domed_city
				days = 90
				clear_on_owner_change = yes
			}
		}
	}
}
#50% Progress - Nerve Gas
country_event = {
	id = pw_research.2122
	title = pw_research.2122.name
	desc = pw_research.2122.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_society_experiment_done_8 }}
	immediate = { set_country_flag = pw_society_experiment_done_8 }

	#Get tech
	option = {
		name = pw_research.2122.a
		add_research_option = pw_tech_exotic_nerve_gas
	}
}
#75% Progress - Zro
country_event = {
	id = pw_research.2123
	title = pw_research.2123.name
	desc = pw_research.2123.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_society_experiment_done_9 }}
	immediate = { set_country_flag = pw_society_experiment_done_9 }

	#Get the tech
	option = {
		name = pw_research.2123.a
		if = {
			limit = { NOT = { has_technology = tech_mine_zro }}
			add_resource = {
				sr_zro = 10
			}
			add_research_option = tech_mine_zro
			add_tech_progress = {
				tech = tech_mine_zro
				progress = 0.05
			}
		}
		else = {
			add_resource = {
				sr_zro = 50
			}
		}
		hidden_effect = {
			set_country_flag = zro_found
		}
	}
}
#Complete the experiment
country_event = {
	id = pw_research.2124
	title = pw_research.2124.name
	desc = pw_research.2124.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	#Get the final reward
	option = {
		name = pw_research.2124.a
		custom_tooltip = pw_research_add_more_society_jobs
		hidden_effect = {
			set_country_flag = pw_domed_city_experiment_completed_3
		}
		add_resource = {
			sr_zro = 25
		}
		add_research_option = pw_tech_psionic_observatory
		end_event_chain = pw_domed_city_experiment_chain
		country_event = {
			id = pw_research.2125
		}
	}
}
#Additional choice
country_event = {
	id = pw_research.2125
	title = pw_research.2125.name
	desc = pw_research.2125.desc
	picture = GFX_evt_pw_domed_city
	is_triggered_only = yes
	location = event_target:PWDCPlanet
	show_sound = event_laboratory_sound

	#Zro Fertility
	option = {
		name = pw_research.2125.a
		trigger = {
			is_machine_empire = no
		}
		add_modifier = {
			modifier = pw_mod_domed_city_zro_fertility
		}
	}

	#Zro Cloning
	option = {
		name = pw_research.2125.b
		trigger = {
			has_ascension_perk = ap_engineered_evolution
		}
		add_modifier = {
			modifier = pw_mod_domed_city_zro_cloning
		}
	}

	#Zro Psionic Boost
	option = {
		name = pw_research.2125.c
		trigger = {
			has_ascension_perk = ap_mind_over_matter
		}
		add_modifier = {
			modifier = pw_mod_domed_city_zro_psionic_development
		}
	}

	#Zro Circuitry
	option = {
		name = pw_research.2125.d
		trigger = {
			OR = {
				is_machine_empire = yes
				has_ascension_perk = ap_the_flesh_is_weak
			}
		}
		add_modifier = {
			modifier = pw_mod_domed_city_zro_circuitry
		}
	}
}

##Abyssal Crater Test Site Events (3000 - 3999)

#Pre-event setup
country_event = {
	id = pw_research.2999
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_at_war = no
		is_ai = no
		NOR = {
			has_valid_civic = civic_machine_terminator
			has_valid_civic = civic_hive_devouring_swarm
			has_valid_civic = civic_fanatic_purifiers
		}
		any_owned_planet = {
			pw_planet_has_abyssal_test_crater = yes
		}
		any_country = {
			is_country_type = fallen_empire
			is_fallen_empire_materialist = yes
			is_at_war = no
			has_communications = root
			opinion = {
				who = THIS
				value > -70
			}
		}
	}

	immediate = {
		random_country = {
			limit = {
				is_country_type = fallen_empire
				is_fallen_empire_materialist = yes
				is_at_war = no
				has_communications = root
				opinion = {
					who = THIS
					value > -70
				}
			}
			save_event_target_as = PWFallenEmpireACTS
		}
		random_owned_planet = {
			limit = {
				pw_planet_has_abyssal_test_crater = yes
			}
			save_event_target_as = PWFallenEmpireACTSPlanet
		}
		country_event = {
			id = pw_research.3000
		}
	}

}

#Materialist Empire requests Test Site
country_event = {
	id = pw_research.3000
	title = pw_research.3000.name
	desc = pw_research.3000.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireACTSPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireACTS
		planet_background = event_target:PWFallenEmpireACTS
		graphical_culture = event_target:PWFallenEmpireACTS
		city_level = event_target:PWFallenEmpireACTS
		room = event_target:PWFallenEmpireACTS.ruler
	}

	#Let them
	option = {
		name = pw_research.3000.a
		event_target:PWFallenEmpireACTSPlanet = {
			add_modifier = {
				modifier = pw_mod_abyssal_test_crater_research_in_use
				days = @pw_halfYear
				clear_on_owner_change = yes
			}
		}
		hidden_effect = {
			event_target:PWFallenEmpireACTS = { add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }}
			country_event = { id = pw_research.3002 } #OK
			country_event = { id = pw_research.3004 days = 90 } #At war
			country_event = { id = pw_research.3005 days = 90 }	#Not at war
		}
	}

	#Ask what they want with it
	option = {
		name = pw_research.3000.b
		hidden_effect = {
			country_event = { id = pw_research.3001 }
		}
	}

	#Deny
	option = {
		name = pw_research.3000.c
		hidden_effect = {
			country_event = { id = pw_research.3003 }
			event_target:PWFallenEmpireACTS = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }}
		}
	}
}

#More information
country_event = {
	id = pw_research.3001
	title = pw_research.3001.name
	desc = pw_research.3001.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireACTSPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireACTS
		planet_background = event_target:PWFallenEmpireACTS
		graphical_culture = event_target:PWFallenEmpireACTS
		city_level = event_target:PWFallenEmpireACTS
		room = event_target:PWFallenEmpireACTS.ruler
	}

	#OK
	option = {
		name = pw_research.3001.a
		event_target:PWFallenEmpireACTSPlanet = {
			add_modifier = {
				modifier = pw_mod_abyssal_test_crater_research_in_use
				days = @pw_halfYear
				clear_on_owner_change = yes
			}
		}
		hidden_effect = {
			event_target:PWFallenEmpireACTS = { add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }}
			country_event = { id = pw_research.3002 } #OK
			country_event = { id = pw_research.3004 days = 90 } #At war
			country_event = { id = pw_research.3005 days = 90 }	#Not at war
		}
	}

	#Deny
	option = {
		name = pw_research.3000.c
		hidden_effect = {
			country_event = { id = pw_research.3003 }
			event_target:PWFallenEmpireACTS = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }}
		}
	}
}

#Accept
country_event = {
	id = pw_research.3002
	title = pw_research.3002.name
	desc = pw_research.3002.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireACTSPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireACTS
		planet_background = event_target:PWFallenEmpireACTS
		graphical_culture = event_target:PWFallenEmpireACTS
		city_level = event_target:PWFallenEmpireACTS
		room = event_target:PWFallenEmpireACTS.ruler
	}

	#OK
	option = {
		name = pw_research.3002.a
	}
}

#Deny
country_event = {
	id = pw_research.3003
	title = pw_research.3003.name
	desc = pw_research.3003.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireACTSPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireACTS
		planet_background = event_target:PWFallenEmpireACTS
		graphical_culture = event_target:PWFallenEmpireACTS
		city_level = event_target:PWFallenEmpireACTS
		room = event_target:PWFallenEmpireACTS.ruler
	}

	#OK
	option = {
		name = pw_research.3003.a
	}
}

#Fallen Empire at war
country_event = {
	id = pw_research.3004
	title = pw_research.3004.name
	desc = pw_research.3004.desc
	picture = GFX_evt_pw_abyssal_crater_test_site
	is_triggered_only = yes
	location = event_target:PWFallenEmpireACTSPlanet

	trigger = {
		OR = {
			NOT = { exists = event_target:PWFallenEmpireACTS }
			event_target:PWFallenEmpireACTS = {
				is_at_war = yes
			}
		}
	}

	#OK
	option = {
		name = pw_research.3004.a
		event_target:PWFallenEmpireACTSPlanet = {
			if = {
				limit = { has_modifier = pw_mod_abyssal_test_crater_research_in_use }
				remove_modifier = pw_mod_abyssal_test_crater_research_in_use
			}
		}
	}
}

#Devastation from bombardment
country_event = {
	id = pw_research.3005
	title = pw_research.3005.name
	desc = pw_research.3005.desc
	picture = GFX_evt_pw_abyssal_crater_test_site
	is_triggered_only = yes
	location = event_target:PWFallenEmpireACTSPlanet
	show_sound = event_energy_field

	trigger = {
		exists = event_target:PWFallenEmpireACTS
		event_target:PWFallenEmpireACTS = {
			is_at_war = no
		}
	}

	#Contact them
	option = {
		name = pw_research.3005.a
		event_target:PWFallenEmpireACTSPlanet = {
			add_planet_devastation = 25
		}
		hidden_effect = {
			country_event = { id = pw_research.3006 }
		}
	}

	#Par for the Course
	option = {
		name = pw_research.3005.b
		event_target:PWFallenEmpireACTSPlanet = {
			add_planet_devastation = 25
		}
		hidden_effect = {
			country_event = { id = pw_research.3004 days = 90 }	#At war
			country_event = { id = pw_research.3009 days = 90 }
		}
	}
}

#Sudden Energy Drain - Contact
country_event = {
	id = pw_research.3006
	title = pw_research.3006.name
	desc = pw_research.3006.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireACTSPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireACTS
		planet_background = event_target:PWFallenEmpireACTS
		graphical_culture = event_target:PWFallenEmpireACTS
		city_level = event_target:PWFallenEmpireACTS
		room = event_target:PWFallenEmpireACTS.ruler
	}

	#Continue
	option = {
		name = pw_research.3006.a

		hidden_effect = {
			event_target:PWFallenEmpireACTS = { add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }}
			country_event = { id = pw_research.3004 days = 90 }	#At war
			country_event = { id = pw_research.3009 days = 90 }
			country_event = { id = pw_research.3007 }
		}
	}

	#Leave
	option = {
		name = pw_research.3006.b
		event_target:PWFallenEmpireACTSPlanet = {
			if = {
				limit = { has_modifier = pw_mod_abyssal_test_crater_research_in_use }
				remove_modifier = pw_mod_abyssal_test_crater_research_in_use
			}
		}
		hidden_effect = {
			country_event = { id = pw_research.3008 }
			event_target:PWFallenEmpireACTS = { remove_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request } }
			event_target:PWFallenEmpireACTS = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }}
		}
	}
}

#Sudden Energy Drain - Continue
country_event = {
	id = pw_research.3007
	title = pw_research.3007.name
	desc = pw_research.3007.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireACTSPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireACTS
		planet_background = event_target:PWFallenEmpireACTS
		graphical_culture = event_target:PWFallenEmpireACTS
		city_level = event_target:PWFallenEmpireACTS
		room = event_target:PWFallenEmpireACTS.ruler
	}

	#OK
	option = {
		name = pw_research.3007.a
	}
}

#Sudden Energy Drain - Stop
country_event = {
	id = pw_research.3008
	title = pw_research.3008.name
	desc = pw_research.3008.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireACTSPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireACTS
		planet_background = event_target:PWFallenEmpireACTS
		graphical_culture = event_target:PWFallenEmpireACTS
		city_level = event_target:PWFallenEmpireACTS
		room = event_target:PWFallenEmpireACTS.ruler
	}

	#OK
	option = {
		name = pw_research.3008.a
	}
}

#Finish event
country_event = {
	id = pw_research.3009
	title = pw_research.3009.name
	desc = pw_research.3009.desc
	is_triggered_only = yes
	location = event_target:PWFallenEmpireACTSPlanet
	show_sound = diplomatic_notification
	diplomatic = yes

	trigger = {
		exists = event_target:PWFallenEmpireACTS
		event_target:PWFallenEmpireACTS = {
			is_at_war = no
		}
	}

	picture_event_data = {
		portrait = event_target:PWFallenEmpireACTS
		planet_background = event_target:PWFallenEmpireACTS
		graphical_culture = event_target:PWFallenEmpireACTS
		city_level = event_target:PWFallenEmpireACTS
		room = event_target:PWFallenEmpireACTS.ruler
	}

	#GOOD
	option = {
		name = pw_research.3009.a
		add_monthly_resource_mult = {
			resource = engineering_research
			value = @tier2researchreward
			min = @tier2researchmin
			max = @tier2researchmax
		}
		add_resource = {
			rare_crystals = 200
			minerals = 500
		}
		event_target:PWFallenEmpireACTSPlanet = {
			if = {
				limit = {
					has_modifier = pw_mod_abyssal_test_crater_research_in_use
				}
				remove_modifier = pw_mod_abyssal_test_crater_research_in_use
			}
		}
		add_research_option = pw_tech_fallen_empire_experiments_engineering
	}
}

#Start the Experiments Event Chain
# Begin Weapon Testing Experiments
country_event = {
	id = pw_research.3100
	title = pw_research.3100.name
	desc = pw_research.3100.desc
	picture = GFX_evt_pw_abyssal_crater_test_site
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	trigger = {
		NOT = { has_country_flag = pw_abyssal_crater_test_site_experiments_started }
		any_owned_planet = {
			pw_planet_has_abyssal_test_crater = yes
		}
	}

	immediate = {
		set_country_flag = pw_abyssal_crater_test_site_experiments_started
		random_owned_planet = {
			limit = {
				pw_planet_has_abyssal_test_crater = yes
			}
			save_event_target_as = PWACTSPlanet
		}
	}

	#Commence the experiments
	option = {
		name = pw_research.3100.a
		begin_event_chain = {
			event_chain = pw_abyssal_crater_test_Site_experiment_chain
			target = ROOT
		}
		enable_special_project = {
			name = PW_ENGINEERING_WEAPONS_EXPERIMENTS
			owner = ROOT
			location = event_target:PWACTSPlanet
		}
	}
}
#25% Progress - Portable Weapons
country_event = {
	id = pw_research.3101
	title = pw_research.3101.name
	desc = pw_research.3101.desc
	picture = GFX_evt_engineering_research
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_engineering_experiment_done_1 }}
	immediate = { set_country_flag = pw_engineering_experiment_done_1 }

	#Get the tech
	option = {
		name = pw_research.3101.a
		add_research_option = pw_tech_motes_portable_weapons
	}
}
#50% Progress - Mounted Weapons
country_event = {
	id = pw_research.3102
	title = pw_research.3102.name
	desc = pw_research.3102.desc
	picture = GFX_evt_ship_under_attack
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_engineering_experiment_done_2 }}
	immediate = { set_country_flag = pw_engineering_experiment_done_2 }

	#Get the tech
	option = {
		name = pw_research.3102.a
		add_research_option = pw_tech_massive_mounted_weapons
	}
}
#75% Progress - Misfiring Devastation + living Metal
country_event = {
	id = pw_research.3103
	title = pw_research.3103.name
	desc = pw_research.3103.desc
	picture = GFX_evt_burning_settlement
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_engineering_experiment_done_3 }}
	immediate = {
		set_country_flag = pw_engineering_experiment_done_3
		random_owned_planet = {
			limit = {
				pw_planet_has_abyssal_test_crater = yes
			}
			save_event_target_as = PWACTSPlanet
		}
	}

	#Devastation
	option = {
		name = pw_research.3101.a
		if = {
			limit = { NOT = { has_technology = tech_mine_living_metal }}
			add_resource = {
				sr_living_metal = 10
			}
			add_research_option = tech_mine_living_metal
			add_tech_progress = {
				tech = tech_mine_living_metal
				progress = 0.05
			}
		}
		else = {
			add_resource = {
				sr_living_metal = 50
			}
		}
		hidden_effect = {
			set_country_flag = living_metal_found
		}
		event_target:PWACTSPlanet = {
			add_planet_devastation = 20
		}
		hidden_effect = {
			country_event = {
				id = pw_research.3105
				days = 5
			}
		}
	}
}
#Complete the experiment
country_event = {
	id = pw_research.3104
	title = pw_research.3104.name
	desc = pw_research.3104.desc
	picture = GFX_evt_pw_abyssal_crater_test_site
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	immediate = {
		random_owned_planet = {
			limit = {
				pw_planet_has_abyssal_test_crater = yes
			}
			save_event_target_as = PWACTSPlanet
		}
	}

	#Get the next tier
	option = {
		name = pw_research.3104.a
		custom_tooltip = pw_research_add_more_engineering_jobs
		hidden_effect = {
			set_country_flag = pw_abyssal_crater_test_site_experiment_completed_1
		}
		add_research_option = pw_tech_abyssal_crater_test_site_organization
		enable_special_project = {
			name = PW_ENGINEERING_STRUCTURAL_EXPERIMENTS
			owner = ROOT
			location = event_target:PWACTSPlanet
		}
	}
}
#Additional - Get Bombardment
country_event = {
	id = pw_research.3105
	title = pw_research.3105.name
	desc = pw_research.3105.desc
	picture = GFX_evt_death_from_above
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	#Get the tech
	option = {
		name = pw_research.3105.a
		add_research_option = pw_tech_weaponized_disaster
	}
}

#Begin Structural Integrity Experiments
#25% Progress - Variable Reactive Armor
country_event = {
	id = pw_research.3111
	title = pw_research.3111.name
	desc = pw_research.3111.desc
	picture = GFX_evt_megastructure_construction
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_engineering_experiment_done_4 }}
	immediate = { set_country_flag = pw_engineering_experiment_done_4 }

	#Get tech
	option = {
		name = pw_research.3111.a
		add_research_option = pw_tech_variable_pressure_armor
	}
}
#50% Progress - Efficient Urbanism
country_event = {
	id = pw_research.3112
	title = pw_research.3112.name
	desc = pw_research.3112.desc
	picture = GFX_evt_metropolis
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_engineering_experiment_done_5 }}
	immediate = { set_country_flag = pw_engineering_experiment_done_5 }

	#Get tech
	option = {
		name = pw_research.3112.a
		add_research_option = pw_tech_efficient_urbanism
	}
}
#75% Progress - Critical Military Production
country_event = {
	id = pw_research.3113
	title = pw_research.3113.name
	desc = pw_research.3113.desc
	picture = GFX_evt_decryption
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_engineering_experiment_done_6 }}
	immediate = { set_country_flag = pw_engineering_experiment_done_6 }

	#Get the tech
	option = {
		name = pw_research.3113.a
		add_research_option = pw_tech_reinforced_military_production
	}
}
#Complete the experiment + Living Metal Districts
country_event = {
	id = pw_research.3114
	title = pw_research.3114.name
	desc = pw_research.3114.desc
	picture = GFX_evt_pw_abyssal_crater_test_site
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	immediate = {
		random_owned_planet = {
			limit = {
				pw_planet_has_abyssal_test_crater = yes
			}
			save_event_target_as = PWACTSPlanet
		}
	}

	#Get the next tier
	option = {
		name = pw_research.3114.a
		custom_tooltip = pw_research_add_more_engineering_jobs
		hidden_effect = {
			set_country_flag = pw_abyssal_crater_test_site_experiment_completed_2
		}
		add_research_option = pw_tech_living_metal_districts
		enable_special_project = {
			name = PW_ENGINEERING_PRODUCTION_EXPERIMENTS
			owner = ROOT
			location = event_target:PWACTSPlanet
		}
	}
}

#Begin Living Production Experiments
#25% Progress - Adaptable Decouples
country_event = {
	id = pw_research.3121
	title = pw_research.3121.name
	desc = pw_research.3121.desc
	picture = GFX_evt_robot_assembly_plant
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_engineering_experiment_done_7 }}
	immediate = { set_country_flag = pw_engineering_experiment_done_7 }

	#Get tech
	option = {
		name = pw_research.3121.a
		add_research_option = pw_tech_living_metal_decouples
	}
}
#50% Progress - Metal Plague
country_event = {
	id = pw_research.3122
	title = pw_research.3122.name
	desc = pw_research.3122.desc
	picture = GFX_evt_strategic_resources
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_engineering_experiment_done_8 }}
	immediate = {
		set_country_flag = pw_engineering_experiment_done_8
		random_owned_planet = {
			limit = {
				pw_planet_has_abyssal_test_crater = yes
			}
			save_event_target_as = PWACTSPlanet
		}
	}

	#Apply modifier
	option = {
		name = pw_research.3122.a
		event_target:PWACTSPlanet = {
			add_modifier = {
				modifier = pw_mod_abyssal_test_crater_living_metal_plague
				days = @pw_halfYear
				clear_on_owner_change = yes
			}
		}
	}

	#Apply lesser modifier
	option = {
		name = pw_research.3122.b
		allow = {
			resource_stockpile_compare = {
				resource = sr_living_metal
				value >= 100
			}
		}
		add_resource = {
			sr_living_metal = -100
		}
		event_target:PWACTSPlanet = {
			add_modifier = {
				modifier = pw_mod_abyssal_test_crater_living_metal_plague
				days = 90
				clear_on_owner_change = yes
			}
		}
	}
}
#75% Progress - Living Metal Warforms
country_event = {
	id = pw_research.3123
	title = pw_research.3123.name
	desc = pw_research.3123.desc
	picture = GFX_evt_organic_oppression
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	trigger = { NOT = { has_country_flag = pw_engineering_experiment_done_9 }}
	immediate = { set_country_flag = pw_engineering_experiment_done_9 }

	#Get the tech
	option = {
		name = pw_research.3123.a
		add_research_option = pw_tech_living_metal_warforms
	}
}
#Complete the experiment
country_event = {
	id = pw_research.3124
	title = pw_research.3124.name
	desc = pw_research.3124.desc
	picture = GFX_evt_pw_abyssal_crater_test_site
	is_triggered_only = yes
	location = event_target:PWACTSPlanet
	show_sound = event_laboratory_sound

	#Get the next tier
	option = {
		name = pw_research.3124.a
		custom_tooltip = pw_research_add_more_engineering_jobs
		hidden_effect = {
			set_country_flag = pw_abyssal_crater_test_site_experiment_completed_3
		}
		add_resource = {
			sr_living_metal = 25
		}
		add_research_option = pw_tech_metal_vivarium
		end_event_chain = pw_abyssal_crater_test_Site_experiment_chain
	}
}
