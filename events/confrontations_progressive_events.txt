namespace = confrontations_progressive

# Progressive Confrontations

# Calculating which confrontation to use
country_event = {
    id = confrontations_progressive.1
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        NOT = { has_modifier = recent_political_event }
        has_modifier = politics

        check_variable = {
            which = current_progressive_support
            value > current_ideological_purity
        }
    }

    immediate = {
        country_event = { id = confrontations_progressive.3 }
    }
}

# Dock progressive_support
country_event = {
    id = confrontations_progressive.2
    hide_window = yes

    is_triggered_only = yes

    immediate = {
        add_modifier = {
            modifier = recent_political_event
            months = 3
        }

        add_monthly_resource_mult = {
            resource = progressive_support
            value = -36
            min = 0
            max = -100
        }
    }
}

# Continue to trigger events, split out so you can call it from console
country_event = {
    id = confrontations_progressive.3
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        export_resource_stockpile_to_variable = {
            resource = progressive_militancy_current_value
            variable = current_progressive_militancy
        }
        while = {
            count = 100
            limit = {
                NOT = { has_modifier = recent_political_event }
            }
            every_pop_faction = {
                limit = {
                    OR = {
                        is_pop_faction_type = gov_progressive
                        is_pop_faction_type = progressive_radicals
                        is_pop_faction_type = progressive
                    }
                }
                pop_faction_event = { id = confrontations_progressive.4 }
            }
        }
    }
}

# Pick events based on militancy
pop_faction_event = {
    id = confrontations_progressive.4
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        if = {
            limit = {
                owner = {
                    check_variable = {
                        which = current_progressive_militancy
                        value > 75
                    }
                }
            }
            pop_faction_event = { id = confrontations_progressive_militancy_desperate.1 }
        }
        else_if = {
            limit = {
                owner = {
                    check_variable = {
                        which = current_progressive_militancy
                        value > 50
                    }
                }
            }
            pop_faction_event = { id = confrontations_progressive_militancy_furious.1 }            
        }
        else_if = {
            limit = {
                owner = {
                    check_variable = {
                        which = current_progressive_militancy
                        value > 25
                    }
                }
            }
            pop_faction_event = { id = confrontations_progressive_militancy_upset.1 }
        }
        else = {
            pop_faction_event = { id = confrontations_progressive_militancy_peaceful.1 }
        }
    }
}