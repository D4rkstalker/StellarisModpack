namespace = femegasspirit

event = {
	id = femegasspirit.1
	hide_window = yes
	
	fire_only_once = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = femegasinit_happened_spirit }
	}
	
	immediate = {
		random_country = {
			limit = { is_country_type = fallen_empire }
			country_event = { id = femegasspirit.2 days = 1 }
		}
	}
}

country_event = {
	id = femegasspirit.2
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = femegasinit_happened_spirit }
	}
	
	immediate = {
		every_country = {
			limit = {
				is_country_type = fallen_empire
				has_ethic = ethic_fanatic_spiritualist
			}
			random_list = {
				50 = {
					country_event = { id = femegasspirit.10 }
				}
				50 = {
					modifier = {
						factor = 0
						NOT = { has_global_flag = gigastructures_enabled }
					}
					country_event = { id = femegasspirit.20 }
				}
			}
		}
		set_global_flag = femegasinit_happened_spirit
	}
}

country_event = {
	id = femegasspirit.10
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = fallen_empire
		has_ethic = ethic_fanatic_spiritualist
	}
	
	immediate = {
		leader = {
			add_ruler_trait = leader_trait_ruler_chosen
			remove_ruler_trait = leader_trait_ruler_psionic
		}
	}
}

country_event = { #dimensional portal
	id = femegasspirit.20
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = fallen_empire
		has_ethic = ethic_fanatic_spiritualist
		has_global_flag = gigastructures_enabled
	}
	
	immediate = {
		random_system_within_border = {
			limit = {
				NOT = { any_system_planet = { habitable_planet = yes } }
				NOT = { is_star_class = sc_black_hole }
			}
			random_system_planet = {
				limit = { is_star = yes }
				solar_system = {
					spawn_megastructure = {
						type = psychic_beacon_4
						coords_from = PREV
						owner = ROOT
					}
				}
			}
		}
	}
}