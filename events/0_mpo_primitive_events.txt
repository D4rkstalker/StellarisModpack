namespace = primitive

### Nuclear War Scenarios

# Nuclear War Breaks Out (HIDDEN)
planet_event = {
	id = primitive.130
	hide_window = yes

	pre_triggers = {
		has_owner = yes
	}

	trigger = {
		NOT = { is_planet_class = pc_habitat }
		NOT = { is_planet_class = pc_ringworld_habitable }
		owner = {
			is_country_type = primitive
			is_pacifist = no
			OR = {
				has_country_flag = atomic_age
				has_country_flag = early_space_age
			}
		}
		OR = {
			has_observation_outpost = no
			AND = {
				has_observation_outpost = yes
				observation_outpost = { has_mission = passive_observation }
			}
			AND = {
				has_observation_outpost = yes
				observation_outpost = { has_mission = native_indoctrination }
			}			
			AND = {
				has_observation_outpost = yes
				observation_outpost = { has_mission = specimen_collection }
			}
		}
	}

	mean_time_to_happen = {
		years  = 10
	}

	immediate = {
		owner = {
			random_owned_ship = {
				limit = { is_ship_size = primitive_space_station }
				fleet = { destroy_fleet = THIS }
			}
		}
		random_list = {
			5 = {
				if = {
					limit = {
						has_observation_outpost = yes
					}
					observation_outpost_owner = {
						random_list = {
							25 = {
								country_event = { id = primitive.131 }
							}
							70 = { country_event = { id = primitive.133 } }
							5 = {
								country_event = { id = prim_orig.30 }
								modifier = {
									factor = 0
									root = {
										OR = {
											is_planet_class = pc_ringworld_habitable
											is_planet_class = pc_habitat
										}
									}
								}
							}
						}
					}	
				}	
				else = {
					owner = {
						random_list = {
							25 = {
								country_event = { id = primitive.131 }
								modifier = {
									factor = 0 # won't turn planet uninhabitable if it's not a planet
									root = {
										OR = {
											is_planet_class = pc_ringworld_habitable
											is_planet_class = pc_habitat
										}
									}
								}
							}
							70 = { country_event = { id = primitive.133 } }
							5 = {
								country_event = { id = prim_orig.30 }
								modifier = {
									factor = 0
									NAND = {
										root = {
											OR = {
												is_planet_class = pc_ringworld_habitable
												is_planet_class = pc_habitat
											}
										}
										host_has_dlc = Apocalypse
									}
								}
							}
						}
					}
				}
				modifier = {
					factor = 2
					has_observation_outpost = yes
					observation_outpost = {
						has_mission = native_indoctrination
					}
				}
				modifier = {
					factor = 1.5
					has_observation_outpost = yes
					observation_outpost = {
						has_mission = specimen_collection
					}
				}
			}
			5 = {
				modifier = {
					factor = 0
					has_observation_outpost = yes
					observation_outpost = {
						has_mission = native_indoctrination
					}
				}
				modifier = {
					factor = 0.5
					has_observation_outpost = yes
					observation_outpost = {
						has_mission = specimen_collection
					}
				}
			}
			10 = {
				modifier = {
					factor = 0
					owner = {
						is_militarist = yes
					}
				}
			}
		}
	}
}

### Entering Space Age

# Entering Space Age (HIDDEN)
country_event = {
	id = primitive.16
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		remove_country_flag = early_space_age
		set_country_flag = primitives_can_into_space
		set_country_type = default
		change_country_flag = random
		if = {
			limit = { is_species_class = MAM }
			set_graphical_culture = mammalian_01
		}
		if = {
			limit = { is_species_class = REP }
			set_graphical_culture = reptilian_01
		}
		if = {
			limit = { is_species_class = AVI }
			set_graphical_culture = avian_01
		}
		if = {
			limit = { is_species_class = ART }
			set_graphical_culture = arthropoid_01
		}
		if = {
			limit = { is_species_class = MOL }
			set_graphical_culture = molluscoid_01
		}
		if = {
			limit = { is_species_class = FUN }
			set_graphical_culture = fungoid_01
		}
		if = {
			limit = { is_species_class = PLANT }
			set_graphical_culture = plantoid_01
		}		
		if = {
			limit = { is_species_class = NECROID }
			set_graphical_culture = necroid_01
		}		
		if = {
			limit = { is_species_class = LITHOID }
			set_graphical_culture = lithoid_01
		}

		change_government = {
			authority = random
			civics = random
		}
		set_name = random
		home_planet = {
			if = {
				limit = {
					exists = observation_outpost_owner
				}
				observation_outpost_owner = {
					country_event = { id = primitive.17 }
				}
			}
		}
		add_resource = {
			energy = 500
			minerals = 1000 # enough for a spaceport and then some
		}

		if = {
			limit = {
				capital_scope = { is_planet_class = pc_ringworld_habitable } 
			}
			# hope you find some mineral deposits out in the void. Here's an extra subsidy to tide you over until the resource shortages cripple you.
			add_resource = {
				energy = 1000
				food = 1000
				minerals = 1000
				alloys = 1000
				volatile_motes = 500
				exotic_gases = 500
				rare_crystals = 500
			}
		}

		add_resource = { influence = 300 }
		capital_scope = {
			clear_blockers = yes
			while = {
				limit = { 
					num_pops < 8
					#free_housing > 0
				}
				create_pop = {
					species = owner
				}
			}
			remove_building = building_primitive_farm
			remove_building = building_primitive_mine
			remove_building = building_primitive_factory
			remove_building = building_primitive_capital
			remove_building = building_urban_dwellings
			remove_building = building_urban_dwellings
			
			add_building = building_capital
			
			if = {
				limit = { NOT = { is_planet_class = pc_ringworld_habitable } }
				add_district = district_city
				add_district = district_city
				add_district = district_city
				add_district = district_city
				add_district = district_farming
				add_district = district_farming
				add_district = district_farming
				add_district = district_mining
				add_district = district_mining
				add_district = district_generator
				add_district = district_generator
				IF = {
					limit = {
						any_owned_species = { is_lithoid = yes }
					}
					add_district = district_mining
				}
				ELSE = {
					add_district = district_farming
				}
				IF = {
					limit = {
						any_owned_species = {
							is_lithoid = no
							is_robotic = no
						}
					}
					add_district = district_farming
					add_district = district_farming	
				}
				ELSE = {
					add_district = district_mining
					add_district = district_mining
				}

				add_building = building_research_lab_1
				add_building = building_foundry_1
				add_building = building_factory_1
			}
			if = {
				limit = { is_planet_class = pc_ringworld_habitable }
				add_district = district_rw_city
				
				add_district = district_rw_farming
				
				add_building = building_chemical_plant
				add_building = building_foundry_1
			}

			remove_all_armies = yes
			solar_system = {
				if = {
					limit = {
						NOT = { exists = starbase }
					}
					create_starbase = {
						size = starbase_outpost
						owner = root
					}
				}
				else_if = {
					limit = {
						starbase = {
							NOT = { owner = { is_same_value = root } }
						}
					}	
					starbase = {
						owner = { country_event = { id = primitive.180 days  = 2 } }
					}
				}
			}				
		}

		IF = {
			limit = {
				has_origin = origin_necrophage
				is_xenophobe = no
			}
			capital_scope = {
				add_building = building_necrophage_elevation_chamber
			}
		}

		IF = {
			limit = { has_country_flag = mpo_primitive_contact_sender }
			remove_country_flag = mpo_primitive_contact_sender
			random_list = {
				# common ground
				1 = {
					every_country = {
						limit = {
							has_country_flag = mpo_primitive_contact@prev
						}
						remove_country_flag = mpo_primitive_contact@prev
						add_opinion_modifier = {
							who = prev
							modifier = opinion_common_ground
						}
						IF = {
							limit = {
								OR = {
									is_country_type = primitive
									is_country_type = vbp_hive
									is_country_type = vbp_machine
								}	
							}
							set_timed_country_flag = { flag = mpo_common_ground_advance days  = 0 }
							country_event = { id = prim_orig.5 }
						}
						ELSE = {
							join_alliance = { who = root override_requirements = yes }
							IF = {
								limit = {
									NOT = { has_country_flag = mpo_common_ground_advance }
								}
								set_federation_leader = this
								add_tradition = tr_diplomacy_adopt
								add_tradition = tr_diplomacy_the_federation
							}
						}
					}
					modifier = {
						factor = 0
						has_country_flag = mpo_hegemon_advance
					}
				}
				# hegemon
				1 = {
					IF = {
						limit = { has_origin = origin_common_ground }
						set_origin = origin_hegemon
					}
					every_country = {
						limit = {
							has_country_flag = mpo_primitive_contact@prev
						}
						remove_country_flag = mpo_primitive_contact@prev
						IF = {
							limit = {
								OR = {
									is_country_type = primitive
									is_country_type = vbp_hive
									is_country_type = vbp_machine
								}	
							}
							set_timed_country_flag = { flag = mpo_hegemon_advance days  = 0 }
							country_event = { id = prim_orig.5 }
						}
						ELSE = {
							join_alliance = { who = root override_requirements = yes }
							IF = {
								limit = {
									NOT = { has_country_flag = mpo_hegemon_advance }
								}
								set_federation_leader = this
								add_tradition = tr_diplomacy_adopt
								add_tradition = tr_diplomacy_the_federation
								federation = {
									set_federation_type = hegemony_federation
									set_name = random
									set_federation_law = succession_term_years_20
								}
							}
						}
					}
					modifier = {
						factor = 0
						OR = {
							has_country_flag = mpo_common_ground_advance
							AND = {
								is_egalitarian = yes
								NOT = { has_country_flag = mpo_hegemon_advance 	}
							}
						}
					}
				}
			}
		}

		random_owned_ship = {
			limit = { is_ship_size = primitive_space_station }
			fleet = { destroy_fleet = THIS }
		}		
	}
}

country_event = {
	id = primitive.180
	title = primitive.180.name
	location = from.capital_scope.solar_system
	desc = primitive.180.desc

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = primitive.180.a # Cede
		trigger = {
			NOR = {
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_fanatic_purifiers
			}
		}

		if = {
			limit = {
				OR = {
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe
				}
			}
			add_resource = { influence = -200 }
		}

		custom_tooltip = primitive.180.a.tooltip
		hidden_effect = {
			from = {
				capital_scope.solar_system.starbase = {
					set_owner = root.from
				}

				add_opinion_modifier = {
					modifier = opinion_ceded_starbase
					who = root
				}
			}
		}
	}

	option = {
		name = primitive.180.b # Don't cede
		trigger = {
			NOR = {
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_fanatic_purifiers
			}
		}

		if = {
			limit = {
				OR = {
					has_ethic = ethic_fanatic_xenophile
					has_ethic = ethic_xenophile
				}
			}
			add_resource = { influence = -200 }
		}

		custom_tooltip = primitive.180.b.tooltip
		hidden_effect = {
			from = {
				add_opinion_modifier = {
					modifier = opinion_not_ceded_starbase
					who = root
				}
			}
		}
	}

	option = {
		name = EXTERMINATE
		trigger = {
			has_valid_civic = civic_machine_terminator
		}
	}

	option = {
		name = TASTY
		trigger = {
			has_valid_civic = civic_hive_devouring_swarm
		}
	}

	option = {
		name = SCUM # Xeno Scum
		trigger = {
			has_valid_civic = civic_fanatic_purifiers
		}
	}
}
