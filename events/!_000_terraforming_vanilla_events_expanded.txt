############################
#
# Terraforming Events
# By Victor Haeggman
#
############################

namespace = terra

#Saving the original planet flag
planet_event = {
	id = terra.5
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		NOT = { has_planet_flag = has_terraformflag }
	}

	immediate = {
		set_planet_flag = has_terraformflag
		if = {
			limit = { is_desert_world = yes }
			set_planet_flag = desert_terraform
		}
		else_if = {
			limit = { is_arid_world = yes }
			set_planet_flag = arid_terraform
		}
		else_if = {
			limit = { is_savannah_world = yes }
			set_planet_flag = savannah_terraform
		}
		else_if = {
			limit = { is_tropical_world = yes }
			set_planet_flag = tropical_terraform
		}
		else_if = {
			limit = { is_ocean_world = yes }
			set_planet_flag = ocean_terraform
		}
		else_if = {
			limit = { is_continental_world = yes }
			set_planet_flag = continental_terraform
		}
		else_if = {
			limit = { is_tundra_world = yes }
			set_planet_flag = tundra_terraform
		}
		else_if = {
			limit = { is_arctic_world = yes }
			set_planet_flag = arctic_terraform
		}
		else_if = {
			limit = { is_alpine_world = yes }
			set_planet_flag = alpine_terraform
		}
		else_if = {
			limit = { is_nuked_world = yes }
			set_planet_flag = nuked_terraform
		}
		else_if = {
			limit = {
				OR = {
					is_barren_world = yes
					is_toxic_world = yes
				}
			}
			set_planet_flag = barren_terraform
		}
		else_if = {
			limit = {
				OR = {
					is_barren_cold_world = yes
					is_frozen_world = yes
				}
			}
			set_planet_flag = barren_cold_terraform
		}
		else = {
			set_planet_flag = no_terraform_event
		}
	}
}

#Firing
planet_event = {
	id = terra.10
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = space_owner
		NOR = {
			has_planet_flag = terraformed_once
			has_planet_flag = no_terraform_event
			is_planet_class = pc_relic
			is_planet_class = pc_city
		}
		can_have_habitable_deposits = yes
	}
	# All the NAND modifiers in here set up like a trigger, if anything in the NAND is not true then the event will have 0 chance of firing
	immediate = {
		set_planet_flag = terraformed_once
		random_list = {
			3 = {
				modifier = {
					factor = 0
					free_district_slots = 0
				}
				modifier = {
					factor = 0
					is_colony = no
				}
				space_owner = { country_event = { id = terra.15 } } # Superfluous Terraforming Equipment
			}
			3 = {
				modifier = {
					factor = 0
					is_planet_class = pc_nuked
				}
				space_owner = { country_event = { id = terra.20 } } # Engineered Beauty
			}
			3 = {
				modifier = {
					factor = 0
					free_district_slots >= 4
				}
				space_owner = { country_event = { id = terra.25 } } # Terraforming Complications
			}
			2 = {
				modifier = {
					factor = 0
					OR = {
						is_ideal_planet_class = {
							who = space_owner
							status = no
						}
						space_owner = { has_country_flag = terraformed_homeworld_2 }
					}
				}
				space_owner = { country_event = { id = terra.35 } } # Homeworld 2
			}
			2 = {
				modifier = {
					factor = 0
					OR = {
						has_planet_flag = nuked_terraform
						has_planet_flag = barren_terraform
						has_planet_flag = barren_cold_terraform
						is_planet_class = pc_gaia
						is_planet_class = pc_nuked
						is_colony = yes
					}
				}
				space_owner = { country_event = { id = terra.40 } } # Intentionally Tidally Locked
			}
			3 = {
				modifier = {
					factor = 0
					OR = {
						has_planet_flag = barren_terraform
						has_planet_flag = barren_cold_terraform
						is_planet_class = pc_gaia
					}
				}
				space_owner = { country_event = { id = terra.45 } } # Add relevant deposit
			}
			1 = {
				modifier = { #Cannot use decimal places in the base for random_list
					factor = 0.5
					always = yes
				}
				modifier = {
					factor = 0
					OR = {
						space_owner = { is_gestalt = no }
						has_planet_flag = barren_terraform
						has_planet_flag = barren_cold_terraform
						has_planet_flag = nuked_terraform
						is_planet_class = pc_nuked
					}
				}
				space_owner = { country_event = { id = terra.50 } } # Free Hiveworld
			}
			2 = {
				modifier = {
					factor = 0
					OR = {
						space_owner = { is_gestalt = no }
						space_owner = { is_civic_machine_servitor = yes }
						has_planet_flag = barren_terraform
						has_planet_flag = barren_cold_terraform
						is_planet_class = pc_nuked
					}
				}
				space_owner = { country_event = { id = terra.55 } } # Perfect Organization
			}
			2 = {
				modifier = {
					factor = 0
					NAND = {
						OR = {
							has_planet_flag = barren_terraform
							has_planet_flag = barren_cold_terraform
						}
						has_overlord_dlc = yes
					}
				}
				space_owner = { country_event = { id = terra.60 } } # Primitives
			}
			3 = {
				modifier = {
					factor = 0
					NAND = {
						has_planet_flag = barren_terraform
						has_planet_flag = barren_cold_terraform
					}
				}
				space_owner = { country_event = { id = terra.65 } } # Refund and Gas
			}
			2 = {
				modifier = {
					factor = 0
					NAND = {
						is_planet_class = pc_gaia
						is_colony = yes
						space_owner = {
							country_uses_consumer_goods = yes
							NOT = { has_origin = origin_life_seeded }
						}
					}
				}
				space_owner = { country_event = { id = terra.70 } } # Gain Gaia Preference
			}
			2 = {
				modifier = {
					factor = 0
					NAND = {
						is_planet_class = pc_gaia
						space_owner = {
							is_gestalt = no
							NOT  = { has_country_flag = made_paradise }
						}
						is_homeworld = no
					}
				}
				space_owner = { country_event = { id = terra.75 } } # Make Paradise
			}
			2 = {
				modifier = {
					factor = 0
					NAND = {
						has_planet_flag = nuked_terraform
						has_plantoids = yes
						space_owner = {
							NOT  = { has_country_flag = harvested_radiotrophic_dna }
							species = { NOT = { has_trait = trait_plantoid_radiotrophic } }
						}
						is_homeworld = no
					}
				}
				space_owner = { country_event = { id = terra.80 } } # Radiotrophic presapients
			}
			2 = {
				modifier = {
					factor = 0
					NAND = {
						has_planet_flag = nuked_terraform
						has_ancrel = yes
						space_owner = {
							NOT  = { has_country_flag = tombworld_weapon_cache_spawned }
						}
						is_homeworld = no
					}
				}
				modifier = {
					factor = 50
					OR = {
						has_planet_flag = planet_earth
						has_planet_flag = nuked_earth
					}
				}
				space_owner = { country_event = { id = terra.90 } } # Weapon Cache
			}
			10 = {} # Do nothing
		}
	}
}

planet_event = {
	id = terra.30
	title = terra.30.name
	desc = terra.30.desc
	picture = {
		trigger = {
			is_desert_world = yes
		}
		picture = GFX_evt_desert
	}
	picture = {
		trigger = {
			is_tropical_world = yes
		}
		picture = GFX_evt_tropical
	}
	picture = {
		trigger = {
			is_arid_world = yes
		}
		picture = GFX_evt_arid
	}
	picture = {
		trigger = {
			OR = {
				is_continental_world = yes
				is_alpine_world = yes
				is_savannah_world = yes
			}
		}
		picture = GFX_evt_continental
	}
	picture = {
		trigger = {
			is_ocean_world = yes
		}
		picture = GFX_evt_ocean
	}
	picture = {
		trigger = {
			is_tundra_world = yes
		}
		picture = GFX_evt_tundra
	}
	picture = {
		trigger = {
			is_arctic_world = yes
		}
		picture = GFX_evt_arctic
	}
	picture = {
		trigger = {
			is_gaia_world = yes
		}
		picture = GFX_evt_gaia
	}
	picture = {
		trigger = {
			is_nuked_world = yes
		}
		picture = GFX_evt_tomb_world
	}
	show_sound = event_administrative_work
	is_triggered_only = yes
	location = this

	trigger = {
		has_planet_flag = terraform_blocker_flag
		NOT = {
			any_deposit = {
				NOT = { is_same_value = From }
				is_deposit_type = d_terraforming_blocker
			}
		}
	}

	immediate = {
		remove_planet_flag = terraform_blocker_flag
	}

	option = {
		name = terra.30.a
		owner = {
			switch = {
				trigger = has_technology
				tech_climate_restoration = {
					add_monthly_resource_mult = {
						resource = society_research
						value = @tier5researchreward
						min = @tier5researchmin
						max = @tier5researchmax
					}
				}
				tech_ecological_adaptation = {
					add_tech_option_or_research_effect = {
   						TECH = tech_climate_restoration
   						PROGRESS = 0.2
   						CATEGORY = society_research
					}
				}
				tech_terrestrial_sculpting = {
					add_tech_option_or_research_effect = {
   						TECH = tech_ecological_adaptation
   						PROGRESS = 0.4
   						CATEGORY = society_research
					}
				}
				default = {
					add_tech_option_or_research_effect = {
   						TECH = tech_terrestrial_sculpting
   						PROGRESS = 0.8
   						CATEGORY = society_research
					}
				}
			}
		}
	}
}

country_event = {
	id = terra.40
	title = terra.40.name
	desc = terra.40.desc
	picture = GFX_evt_satellite_in_orbit
	location = from

	is_triggered_only = yes

	option = {
		name = terra.40.a
	}
	option = {
		name = terra.40.b
		From = { add_modifier = { modifier = intentionally_tidally_locked } }
		From = {
			set_planet_flag = tidally_locked_world
			if = {
				limit = { has_global_flag = planetarydiversity }
				change_pc = pc_tidallylocked
				add_deposit = d_nightside_mining_operations
				remove_modifier = intentionally_tidally_locked
				add_modifier = { modifier = tidal_locked2 }
				add_modifier = { modifier = intentionally_tidally_locked_2 }
			}
			else_if = {
				limit = { has_global_flag = has_new_frontiers_mod }
				change_pc = pc_tidallylocked
				remove_modifier = intentionally_tidally_locked
				add_modifier = { modifier = intentionally_tidally_locked_2 }
				if = {
					limit = {
						has_planet_flag = tundra_terraform
						has_planet_flag = arctic_terraform
						has_planet_flag = alpine_terraform
					}
					add_modifier = {
						modifier = "eyeball_world"
						days = -1
					}
					set_planet_entity = {
						picture = pc_eyeball
						entity = eyeball_planet_01_entity
					}
				}
				else = {
					add_modifier = {
						modifier = "meridiem_world"
						days = -1
					}
					set_planet_entity = {
						picture = pc_meridiem
						entity = meridiem_planet_01_entity
					}
				}
			}
		}
		custom_tooltip = terra.40.b.tooltip
	}
}