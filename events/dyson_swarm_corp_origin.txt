namespace = dyson_starting

#origin for megacorp
#set up dyson swarm, triggered through on action:empire_init_create_ships
country_event = {
	id = dyson_starting.100
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		owner = {
			has_civic = civic_the_corperate_void
		}
	}
	
	immediate = {
		capital_scope = { save_event_target_as = original_capital }
		random_system = {
			limit = {
				starting_system = yes
				is_inside_border = ROOT
			}
			system_star = {
				save_event_target_as = dyson_swarm_civic_spawnpoint
			}
			spawn_planet = {
				class = "pc_dyson_swarm"
				location = event_target:dyson_swarm_civic_spawnpoint
				orbit_location = yes
				orbit_angle_offset = 45
				orbit_distance_offset = 9.899
				size = 10
				has_ring = no
				init_effect = {
					clear_blockers = yes
					set_name = "NAME_corperate_headquarters"
					save_event_target_as = dyson_civic_starting_planet
					set_planet_flag = dyson_civic_starting_planet
					set_planet_flag = eco_no_pollution
					set_planet_entity = {
						entity = "orbital_habitat_entity"
						graphical_culture = fromfrom
					}
					surveyed = {
						set_surveyed = yes
						surveyor = FROM
					}
					set_all_comms_surveyed = yes
					clear_blockers = yes
					clear_deposits = yes
					set_planet_flag = megastructure
					set_planet_flag = habitat
					set_planet_flag = colony_event
					set_planet_flag = dyson_corperate_hq
					prevent_anomaly = yes
					set_planet_flag = is_dyson_swarm
				#add deposits
					add_deposit = d_dyson_swarm_planetary_access
					add_deposit = d_dyson_food_reserves
				#add pops and ownership
					set_owner = FROM
					set_controller = FROM
				#set it as the capital immediatly to avoid the vanilla bug that breaks special projects
					set_capital = yes
					while = {
						count = 15
						create_pop = {
							species = last_created_species
							ethos = random
						}
						last_created_pop = {
							clear_ethos = yes
						}
					}
					every_owned_pop = {
						modify_species = {
							species = last_created_species
							add_trait = trait_low_gravity_adaptation
							add_traits_at_start_of_list = yes
							hidden_effect = {
								set_citizenship_type = {
									country = root.owner
									type = citizenship_full
									cooldown = no
								}
							}
						}
					}
				#spawning buildings and districts
					add_district = dyson_swarm_solar_stations
					add_district = dyson_swarm_solar_stations
					add_district = dyson_swarm_mining_bays
					add_district = dyson_swarm_mining_bays
					add_district = dyson_swarm_zero_g_labs
					add_building = building_capital
					add_building = building_dyson_zero_g_foundry_0
					add_building = building_dyson_zero_g_factory_0
					add_building = building_housing_stations_1
				#add tier modifier
					add_modifier = {
						modifier = "dyson_swarm_tier_one"
						days = -1
					}
				#ambient objects
					while = {
						count = 2
						create_ambient_object = {
							type = "dyson_station_01"
							entity_offset_height = { min = -0 max = -25 }
							location = this
						}
						last_created_ambient_object = {
							set_location = {
								target = event_target:dyson_swarm_civic_spawnpoint
								distance = 40
								angle = random
							}
						}
					}
					while = {
						count = 2
						create_ambient_object = {
							type = "dyson_station_01"
							entity_offset_height = { min = -0 max = -25 }
							location = this
						}
						last_created_ambient_object = {
							set_location = {
								target = event_target:dyson_swarm_civic_spawnpoint
								distance = 30
								angle = random
							}
						}
					}
					create_ambient_object = {
						type = "dyson_station_02"
						entity_offset_height = { min = -0 max = -25 }
						location = this
					}
					last_created_ambient_object = {
						set_location = {
							target = event_target:dyson_swarm_civic_spawnpoint
							distance = 38
							angle = random
						}
					}
					create_ambient_object = {
						type = "dyson_station_04"
						entity_offset_height = { min = -0 max = -25 }
						location = this
					}
					last_created_ambient_object = {
						set_location = {
							target = event_target:dyson_swarm_civic_spawnpoint
							distance = 36
							angle = random
						}
					}
					create_ambient_object = {
						type = "dyson_station_05"
						entity_offset_height = { min = -0 max = -25 }
						location = this
					}
					last_created_ambient_object = {
						set_location = {
							target = event_target:dyson_swarm_civic_spawnpoint
							distance = 42
							angle = random
						}
					}
				} 
			}
		}
		event_target:original_capital = { planet_event = { id = dyson_starting.101 } }
		country_event = { id = dyson_starting.102 }
		country_event = { id = dyson_starting.103 }
	}
}
#set up hostage planet
planet_event = {
	id = dyson_starting.101
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_planet_flag = dyson_hostage_planet
		prevent_anomaly = yes
		while = {
			count = 18
			random_pop = { kill_pop = yes }
		}
		remove_district = district_city
		remove_district = district_city
		remove_district = district_mining
		remove_district = district_farming
		remove_district = district_farming
		remove_district = district_generator
		remove_district = district_generator
		create_country = {
			name = random
			type = primitive
			name_list = random 
			ship_prefix = ISS 
			authority = random
			civics = {
				civic = civic_hostage_planet
				civic = civic_atmospheric_pollution
			}
			species = last_created
			flag = random
			ethos = random
			effect = {
				set_primitive_age = eternal_cold_war_age
				set_country_flag = eternal_cold_war_age
				save_event_target_as = hostage_planet_country
			} 
		}
		set_owner = event_target:hostage_planet_country
		set_controller = event_target:hostage_planet_country
	}
}
country_event = {
	id = dyson_starting.102
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		establish_communications_no_message = event_target:hostage_planet_country
		set_variable = { 
			which = dyson_power_c
			value = 10
		}
		set_variable = { 
			which = dyson_power_a
			value = 10
		}
	}
}
#Introduction
country_event = {
	id = dyson_starting.103
	title = dyson_starting.103.title
	desc = dyson_starting.103.desc
	
	is_triggered_only = yes 
	
	option = {
		name = dyson_starting.103.a
	}
}
#Hostage planet interaction menu
country_event = {
	id = dyson_starting.104
	title = dyson_starting.104.title
	desc = dyson_starting.104.desc
	
	is_triggered_only = yes 
	
	option = {
		name = dyson_starting.104.a
	}
}

























