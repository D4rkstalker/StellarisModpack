namespace = ehof_reality_code

##########################################################################
############################## Introduction ##############################
##########################################################################

# Initial find
ship_event = {
	id = ehof_reality_code.001
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		solar_system = { ehof_cohesive_system = yes }
		from = { has_anomaly = no }
		owner = { NOT = { has_country_flag = code_intro } }
	}

	immediate = {
		owner = {
			set_country_flag = code_intro
			country_event = { id = ehof_reality_code.0011 }
		}
		fleet = {
			if = {
				limit = { exists = event_target:ehof_code_fleet }
				clear_global_event_target = ehof_code_fleet
			}
			save_global_event_target_as = ehof_code_fleet
		}
	}
}

country_event = {
	id = ehof_reality_code.0011
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "enigmatic_code_room" }
	title = "ehof_reality_code.1.name"
	desc = "ehof_reality_code.1.desc"
	show_sound = event_scanner
	is_triggered_only = yes
	location = event_target:ehof_code_fleet

	option = {
		custom_gui = "ehof_eventui_option"
		default_hide_option = yes
		name = INTERESTING
		enable_special_project = {
			name = "INVESTIGATE_ENIGMATIC_PATTERN"
			location = root.capital_scope
			owner = root
		}
		hidden_effect = {            
			owner = {
				country_event = { id = story.5 days = 30 }
			}
		}
	}
}

# After special project
country_event = {
	id = ehof_reality_code.002
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "enigmatic_code_room" }
	title = "ehof_reality_code.002.name"
	desc = "ehof_reality_code.002.desc"
	show_sound = event_scanner
	is_triggered_only = yes

	option = {
		custom_gui = "ehof_eventui_option"
		default_hide_option = yes
		begin_event_chain = {
			event_chain = "ehof_p4_chain"
			target = root
		}
		name = INTERESTING
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
		hidden_effect = { set_country_flag = ehof_code_toxic_world ehof_next_reality_code = yes  }
	}
}

# On surveying system with digsite, auto_build starbase
ship_event = {
	id = ehof_reality_code.003
	title = "ehof_reality_code.003.name"
	desc = "ehof_reality_code.003.desc"
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "space_station_room" }
	show_sound = click_upgrade_starbase
	is_triggered_only = yes
	location = from

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					owner = { has_technology = tech_ehof_use_gateway }
					solar_system = {
						NOT = { has_star_flag = ehof_gateway_changed }
						any_system_megastructure = { is_megastructure_type = ehof_gateway_unknown }
					}
				}
				solar_system = {
					set_star_flag = ehof_gateway_changed
					every_system_megastructure = {
						limit = { is_megastructure_type = ehof_gateway_unknown }
						upgrade_megastructure_to = "ehof_gateway_disabled"
						finish_upgrade = yes
					}
				}
			}
		}
	}

	trigger = {
		exists = solar_system
		solar_system = {
			ehof_sa_system = no
			ehof_cohesive_system = yes
			OR = {
				any_system_planet = {
					OR = {
						has_planet_flag = code_world1@root.owner
						has_planet_flag = code_world2@root.owner
						has_planet_flag = code_world3@root.owner
						has_planet_flag = code_world4@root.owner
						has_planet_flag = code_world5@root.owner
						has_planet_flag = code_world6@root.owner
						has_planet_flag = ehof_has_special_project
						has_anomaly = yes
					}
				}
				ehof_creator_system = yes
			}
		}
	}

	option = {
		custom_gui = "ehof_eventui_option"
		default_hide_option = yes
		name = OK
		solar_system = { create_starbase = { size = starbase_outpost owner = root.owner } }
	}
}

# Gaining gateway activation tech
country_event = {
	id = ehof_reality_code.004
	title = "ehof_reality_code.004.name"
	desc = "ehof_reality_code.004.desc"
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "creator-gateway_room" }
	show_sound = event_finding_loot
	is_triggered_only = yes
	location = from

	option = {
		custom_gui = "ehof_eventui_option"
		default_hide_option = yes
		name = OK
	}
}

# Sentient Metal Insight
country_event = {
	id = ehof_reality_code.005
	title = "ehof_reality_code.005.name"
	desc = "ehof_reality_code.005.desc"
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "sentient_room" }
	show_sound = event_finding_loot
	is_triggered_only = yes
	location = from

	option = {
		custom_gui = "ehof_eventui_option"
		default_hide_option = yes
		name = OK
		random_system_within_border = {
			limit = { has_star_flag = ehof_code_system_01_@root }
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = fake_pylon }
				enable_special_project = {
					name = "SELF_REPLICATING_ALLOYS"
					owner = root
					location = this
				}
			}
		}
	}
}

# Repeatable SM extraction from pylon
country_event = {
	id = ehof_reality_code.006
	title = "ehof_reality_code.006.name"
	desc = "ehof_reality_code.006.desc"
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "sentient_room" }
	show_sound = event_finding_loot
	is_triggered_only = yes
	location = from

	option = {
		custom_gui = "ehof_eventui_option"
		default_hide_option = yes
		name = EXCELLENT
		add_resource = { ehof_sr_sentient_metal = 3000 }
		owner = {
			if = {
				limit = {
					NOR = {
						has_tech_option = tech_ehof_sentient_tier_1
						has_technology = tech_ehof_sentient_tier_1
					}
				}
				add_research_option = tech_ehof_sentient_tier_1
				add_tech_progress = { tech = tech_ehof_sentient_tier_1 progress = 0.1 }
			}
		}
		random_system_within_border = {
			limit = {
				any_system_megastructure = {
					OR = {
						is_megastructure_type = ehof_gateway_disabled
						is_megastructure_type = ehof_gateway_unknown
						is_megastructure_type = ehof_gateway_restored
						is_megastructure_type = ehof_gateway
					}
				}
			}
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = fake_pylon }
				enable_special_project = {
					name = "SELF_REPLICATING_ALLOYS"
					owner = root
					location = this
				}
			}
		}
	}
}

# Check they have the right sentient metal tech
country_event = {
	id = ehof_reality_code.007
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		OR = {
			AND = {
				has_country_flag = ehof_code_1_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_1
					has_technology = tech_ehof_sentient_tier_1
				}
			}
			AND = {
				has_country_flag = ehof_code_2_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_2
					has_technology = tech_ehof_sentient_tier_2
				}
			}
			AND = {
				has_country_flag = ehof_code_3_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_3
					has_technology = tech_ehof_sentient_tier_3
				}
			}
			AND = {
				has_country_flag = ehof_code_4_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_4
					has_technology = tech_ehof_sentient_tier_4
				}
			}
			AND = {
				has_country_flag = ehof_code_5_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_5
					has_technology = tech_ehof_sentient_tier_5
				}
			}
			AND = {
				has_country_flag = ehof_code_6_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_6
					has_technology = tech_ehof_sentient_tier_6
				}
			}
			AND = {
				has_country_flag = ehof_code_7_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_7
					has_technology = tech_ehof_sentient_tier_7
				}
			}
		}
	}

	immediate = {
		if = {
			limit = {
				has_country_flag = ehof_code_1_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_1
					has_technology = tech_ehof_sentient_tier_1
				}
			}
			add_research_option = tech_ehof_sentient_tier_1
			add_tech_progress = { tech = tech_ehof_sentient_tier_1 progress = 0.1 }
		}
		if = {
			limit = {
				has_country_flag = ehof_code_2_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_2
					has_technology = tech_ehof_sentient_tier_2
				}
			}
			add_research_option = tech_ehof_sentient_tier_2
			add_tech_progress = { tech = tech_ehof_sentient_tier_2 progress = 0.1 }
		}
		if = {
			limit = {
				has_country_flag = ehof_code_3_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_3
					has_technology = tech_ehof_sentient_tier_3
				}
			}
			add_research_option = tech_ehof_sentient_tier_3
			add_tech_progress = { tech = tech_ehof_sentient_tier_3 progress = 0.1 }
		}
		if = {
			limit = {
				has_country_flag = ehof_code_4_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_4
					has_technology = tech_ehof_sentient_tier_4
				}
			}
			add_research_option = tech_ehof_sentient_tier_4
			add_tech_progress = { tech = tech_ehof_sentient_tier_4 progress = 0.1 }
		}
		if = {
			limit = {
				has_country_flag = ehof_code_5_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_5
					has_technology = tech_ehof_sentient_tier_5
				}
			}
			add_research_option = tech_ehof_sentient_tier_5
			add_tech_progress = { tech = tech_ehof_sentient_tier_5 progress = 0.1 }
		}
		if = {
			limit = {
				has_country_flag = ehof_code_6_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_6
					has_technology = tech_ehof_sentient_tier_6
				}
			}
			add_research_option = tech_ehof_sentient_tier_6
			add_tech_progress = { tech = tech_ehof_sentient_tier_6 progress = 0.1 }
		}
		if = {
			limit = {
				has_country_flag = ehof_code_7_complete
				has_country_flag = extracted_sentient_metal
				NOR = {
					has_tech_option = tech_ehof_sentient_tier_7
					has_technology = tech_ehof_sentient_tier_7
				}
			}
			add_research_option = tech_ehof_sentient_tier_7
			add_tech_progress = { tech = tech_ehof_sentient_tier_7 progress = 0.1 }
		}
	}
}

#########################################################################
############################### Anomalies ###############################
#########################################################################

# Planet Class Toxic
ship_event = {
	id = ehof_reality_code.101
	title = "ehof_reality_code.101.name"
	desc = "ehof_reality_code.101.desc"
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "toxic_city_room" }
	location = from
	is_triggered_only = yes
	immediate = { hidden_effect = { from = { create_archaeological_site = code1_digsite } } }
	option = { custom_gui = "ehof_eventui_option" default_hide_option = yes name = ancrel.4000.a }
}

# Planet Class Broken
ship_event = {
	id = ehof_reality_code.201
	title = "ehof_reality_code.201.name"
	desc = "ehof_reality_code.201.desc"
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "shattered_planet_room" }
	location = from
	is_triggered_only = yes
	immediate = { hidden_effect = { from = { create_archaeological_site = code2_digsite } } }
	option = { custom_gui = "ehof_eventui_option" default_hide_option = yes name = ancrel.4000.a }
}

# Planet Class Frozen
ship_event = {
	id = ehof_reality_code.301
	title = "ehof_reality_code.301.name"
	desc = "ehof_reality_code.301.desc"
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "frozen_planet_room" }
	location = from
	is_triggered_only = yes
	immediate = { hidden_effect = { from = { create_archaeological_site = code3_digsite } } }
	option = { custom_gui = "ehof_eventui_option" default_hide_option = yes name = ancrel.4000.a }
}

# Planet Class Molten
ship_event = {
	id = ehof_reality_code.401
	title = "ehof_reality_code.401.name"
	desc = "ehof_reality_code.401.desc"
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "molten_planet_room" }
	location = from
	is_triggered_only = yes
	immediate = { hidden_effect = { from = { create_archaeological_site = code4_digsite } } }
	option = { custom_gui = "ehof_eventui_option" default_hide_option = yes name = ancrel.4000.a }
}

# Planet Class Gas Giant
ship_event = {
	id = ehof_reality_code.501
	title = "ehof_reality_code.501.name"
	desc = "ehof_reality_code.501.desc"
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "gas_giant_room" }
	location = from
	is_triggered_only = yes
	immediate = { hidden_effect = { from = { create_archaeological_site = code5_digsite } } }
	option = { custom_gui = "ehof_eventui_option" default_hide_option = yes name = ancrel.4000.a }
}

# Star Class
ship_event = {
	id = ehof_reality_code.601
	title = "ehof_reality_code.601.name"
	desc = "ehof_reality_code.601.desc"
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "star_neutron_room" }
	location = from
	is_triggered_only = yes
	immediate = { hidden_effect = { from = { create_archaeological_site = code6_digsite } } }
	option = { custom_gui = "ehof_eventui_option" default_hide_option = yes name = ancrel.4000.a }
}

##########################################################################
################################ Digsites ################################
##########################################################################

################################ Code 01 #################################

# Stage 1
fleet_event = {
	id = ehof_reality_code.111
	title = ehof_reality_code.111.name
	desc = ehof_reality_code.111.desc
	picture = GFX_evt_excavation_team
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world1@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 2
fleet_event = {
	id = ehof_reality_code.112
	title = ehof_reality_code.112.name
	desc = ehof_reality_code.112.desc
	picture = GFX_evt_habitable_dig_site
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world1@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 3
fleet_event = {
	id = ehof_reality_code.113
	title = ehof_reality_code.113.name
	desc = ehof_reality_code.113.desc
	picture = GFX_evt_discovered_hidden_door
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world1@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 4
fleet_event = {
	id = ehof_reality_code.114
	title = ehof_reality_code.114.name
	desc = ehof_reality_code.114.desc
	picture = GFX_evt_huge_monument
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world1@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 5
fleet_event = {
	id = ehof_reality_code.115
	title = ehof_reality_code.115.name
	desc = ehof_reality_code.115.desc
	picture = GFX_evt_towel
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world1@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
		owner = {
			remove_country_flag = ehof_code_toxic_world
			set_country_flag = ehof_code_1_complete
			set_country_flag = ehof_code_broken_world
			ehof_next_reality_code = yes
			add_event_chain_counter = {
				event_chain = ehof_p4_chain
				counter = reality_code
				amount = 1
			}
			country_event = { id = ehof_reality_code.005 }
		}
		event_target:code_world_planet = { if = { limit = { has_negative_mass = no } ehof_add_negative_mass_deposit = yes } }
		leader = { unassign_leader = this }
		delete_fleet = this
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } large_artifact_reward = yes }
	}
}

################################ Code 02 #################################

# Stage 1
fleet_event = {
	id = ehof_reality_code.211
	title = ehof_reality_code.211.name
	desc = ehof_reality_code.211.desc
	picture = GFX_evt_excavation_team
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world2@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 2
fleet_event = {
	id = ehof_reality_code.212
	title = ehof_reality_code.212.name
	desc = ehof_reality_code.212.desc
	picture = GFX_evt_habitable_dig_site
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world2@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 3
fleet_event = {
	id = ehof_reality_code.213
	title = ehof_reality_code.213.name
	desc = ehof_reality_code.213.desc
	picture = GFX_evt_discovered_hidden_door
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world2@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 4
fleet_event = {
	id = ehof_reality_code.214
	title = ehof_reality_code.214.name
	desc = ehof_reality_code.214.desc
	picture = GFX_evt_huge_monument
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world2@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 5
fleet_event = {
	id = ehof_reality_code.215
	title = ehof_reality_code.215.name
	desc = ehof_reality_code.215.desc
	picture = GFX_evt_towel
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world2@root.owner }
				save_event_target_as = code_world_planet
			}
			set_star_flag = ehof_code_system_01_@root.owner
		}
		from = { set_site_progress_locked = yes }
		owner = {
			remove_country_flag = ehof_code_broken_world
			set_country_flag = ehof_code_2_complete
			set_country_flag = ehof_code_frozen_world
			ehof_next_reality_code = yes
			add_event_chain_counter = {
				event_chain = ehof_p4_chain
				counter = reality_code
				amount = 1
			}
			if = {
				limit = {
					has_country_flag = extracted_sentient_metal
					NOR = {
						has_tech_option = tech_ehof_sentient_tier_2
						has_technology = tech_ehof_sentient_tier_2
					}
				}
				add_research_option = tech_ehof_sentient_tier_2
				add_tech_progress = { tech = tech_ehof_sentient_tier_2 progress = 0.1 }
			}
		}
		event_target:code_world_planet = { if = { limit = { has_negative_mass = no } ehof_add_negative_mass_deposit = yes } }
		leader = { unassign_leader = this }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } large_artifact_reward = yes }
		owner = {
			if = {
				limit = {
					has_country_flag = extracted_sentient_metal
					NOR = {
						has_tech_option = tech_ehof_sentient_tier_2
						has_technology = tech_ehof_sentient_tier_2
					}
				}
				add_research_option = tech_ehof_sentient_tier_2
				add_tech_progress = { tech = tech_ehof_sentient_tier_2 progress = 0.1 }
			}
		}
	}
}

################################ Code 03 #################################

# Stage 1
fleet_event = {
	id = ehof_reality_code.311
	title = ehof_reality_code.311.name
	desc = ehof_reality_code.311.desc
	picture = GFX_evt_excavation_team
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world3@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 2
fleet_event = {
	id = ehof_reality_code.312
	title = ehof_reality_code.312.name
	desc = ehof_reality_code.312.desc
	picture = GFX_evt_habitable_dig_site
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world3@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 3
fleet_event = {
	id = ehof_reality_code.313
	title = ehof_reality_code.313.name
	desc = ehof_reality_code.313.desc
	picture = GFX_evt_discovered_hidden_door
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world3@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 4
fleet_event = {
	id = ehof_reality_code.314
	title = ehof_reality_code.314.name
	desc = ehof_reality_code.314.desc
	picture = GFX_evt_huge_monument
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world3@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 5
fleet_event = {
	id = ehof_reality_code.315
	title = ehof_reality_code.315.name
	desc = ehof_reality_code.315.desc
	picture = GFX_evt_towel
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world3@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
		owner = {
			remove_country_flag = ehof_code_frozen_world
			set_country_flag = ehof_code_3_complete
			set_country_flag = ehof_code_molten_world
			ehof_next_reality_code = yes
			add_event_chain_counter = {
				event_chain = ehof_p4_chain
				counter = reality_code
				amount = 1
			}
			if = {
				limit = {
					NOR = {
						has_tech_option = tech_ehof_use_gateway
						has_technology = tech_ehof_use_gateway
					}
				}
				country_event = { id = ehof_reality_code.004 }
				add_research_option = tech_ehof_use_gateway
				add_tech_progress = { tech = tech_ehof_use_gateway progress = 0.25 }
			}
			if = {
				limit = {
					has_country_flag = extracted_sentient_metal
					NOR = {
						has_tech_option = tech_ehof_sentient_tier_3
						has_technology = tech_ehof_sentient_tier_3
					}
				}
				add_research_option = tech_ehof_sentient_tier_3
				add_tech_progress = { tech = tech_ehof_sentient_tier_3 progress = 0.1 }
			}
		}
		event_target:code_world_planet = { if = { limit = { has_negative_mass = no } ehof_add_negative_mass_deposit = yes } }
		leader = { unassign_leader = this }
		delete_fleet = this
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } large_artifact_reward = yes }
		owner = {
			if = {
				limit = {
					NOR = {
						has_tech_option = tech_ehof_use_gateway
						has_technology = tech_ehof_use_gateway
					}
				}
				add_research_option = tech_ehof_use_gateway
				add_tech_progress = { tech = tech_ehof_use_gateway progress = 0.25 }
			}
			if = {
				limit = {
					has_country_flag = extracted_sentient_metal
					NOR = {
						has_tech_option = tech_ehof_sentient_tier_3
						has_technology = tech_ehof_sentient_tier_3
					}
				}
				add_research_option = tech_ehof_sentient_tier_3
				add_tech_progress = { tech = tech_ehof_sentient_tier_3 progress = 0.1 }
			}
		}
	}
}

################################ Code 04 #################################

# Stage 1
fleet_event = {
	id = ehof_reality_code.411
	title = ehof_reality_code.411.name
	desc = ehof_reality_code.411.desc
	picture = GFX_evt_excavation_team
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world4@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 2
fleet_event = {
	id = ehof_reality_code.412
	title = ehof_reality_code.412.name
	desc = ehof_reality_code.412.desc
	picture = GFX_evt_habitable_dig_site
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world4@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 3
fleet_event = {
	id = ehof_reality_code.413
	title = ehof_reality_code.413.name
	desc = ehof_reality_code.413.desc
	picture = GFX_evt_hidden_door
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world4@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 4
fleet_event = {
	id = ehof_reality_code.414
	title = ehof_reality_code.414.name
	desc = ehof_reality_code.414.desc
	picture = GFX_evt_discovered_hidden_door
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world4@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 5
fleet_event = {
	id = ehof_reality_code.415
	title = ehof_reality_code.415.name
	desc = ehof_reality_code.415.desc
	picture = GFX_evt_huge_monument
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world4@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } large_artifact_reward = yes }
	}
}

# Stage 6
fleet_event = {
	id = ehof_reality_code.416
	title = ehof_reality_code.416.name
	desc = ehof_reality_code.416.desc
	picture = GFX_evt_towel
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world4@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
		owner = {
			remove_country_flag = ehof_code_molten_world
			set_country_flag = ehof_code_4_complete
			set_country_flag = ehof_code_gas_giant_world
			ehof_next_reality_code = yes
			add_event_chain_counter = {
				event_chain = ehof_p4_chain
				counter = reality_code
				amount = 1
			}
			if = {
				limit = {
					has_country_flag = extracted_sentient_metal
					NOR = {
						has_tech_option = tech_ehof_sentient_tier_4
						has_technology = tech_ehof_sentient_tier_4
					}
				}
				add_research_option = tech_ehof_sentient_tier_4
				add_tech_progress = { tech = tech_ehof_sentient_tier_4 progress = 0.1 }
			}
		}
		event_target:code_world_planet = { if = { limit = { has_negative_mass = no } ehof_add_negative_mass_deposit = yes } }
		leader = { unassign_leader = this }
		delete_fleet = this
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } large_artifact_reward = yes }
		owner = {
			if = {
				limit = {
					has_country_flag = extracted_sentient_metal
					NOR = {
						has_tech_option = tech_ehof_sentient_tier_4
						has_technology = tech_ehof_sentient_tier_4
					}
				}
				add_research_option = tech_ehof_sentient_tier_4
				add_tech_progress = { tech = tech_ehof_sentient_tier_4 progress = 0.1 }
			}
		}
	}
}

################################ Code 05 #################################

# Stage 1
fleet_event = {
	id = ehof_reality_code.511
	title = ehof_reality_code.511.name
	desc = ehof_reality_code.511.desc
	picture = GFX_evt_excavation_team
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world5@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 2
fleet_event = {
	id = ehof_reality_code.512
	title = ehof_reality_code.512.name
	desc = ehof_reality_code.512.desc
	picture = GFX_evt_habitable_dig_site
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world5@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 3
fleet_event = {
	id = ehof_reality_code.513
	title = ehof_reality_code.513.name
	desc = ehof_reality_code.513.desc
	picture = GFX_evt_hidden_door
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world5@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 4
fleet_event = {
	id = ehof_reality_code.514
	title = ehof_reality_code.514.name
	desc = ehof_reality_code.514.desc
	picture = GFX_evt_discovered_hidden_door
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world5@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 5
fleet_event = {
	id = ehof_reality_code.515
	title = ehof_reality_code.515.name
	desc = ehof_reality_code.515.desc
	picture = GFX_evt_huge_monument
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world5@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } large_artifact_reward = yes }
	}
}

# Stage 6
fleet_event = {
	id = ehof_reality_code.516
	title = ehof_reality_code.516.name
	desc = ehof_reality_code.516.desc
	picture = GFX_evt_towel
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world5@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
		owner = {
			remove_country_flag = ehof_code_gas_giant_world
			set_country_flag = ehof_code_5_complete
			set_country_flag = ehof_code_star_world
			ehof_next_reality_code = yes
			add_event_chain_counter = {
				event_chain = ehof_p4_chain
				counter = reality_code
				amount = 1
			}
			if = {
				limit = {
					has_country_flag = extracted_sentient_metal
					NOR = {
						has_tech_option = tech_ehof_sentient_tier_5
						has_technology = tech_ehof_sentient_tier_5
					}
				}
				add_research_option = tech_ehof_sentient_tier_5
				add_tech_progress = { tech = tech_ehof_sentient_tier_5 progress = 0.1 }
			}
		}
		event_target:code_world_planet = { if = { limit = { has_negative_mass = no } ehof_add_negative_mass_deposit = yes } }
		leader = { unassign_leader = this }
		delete_fleet = this
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } large_artifact_reward = yes }
		owner = {
			if = {
				limit = {
					has_country_flag = extracted_sentient_metal
					NOR = {
						has_tech_option = tech_ehof_sentient_tier_5
						has_technology = tech_ehof_sentient_tier_5
					}
				}
				add_research_option = tech_ehof_sentient_tier_5
				add_tech_progress = { tech = tech_ehof_sentient_tier_5 progress = 0.1 }
			}
		}
	}
}

################################ Code 06 #################################

# Stage 1
fleet_event = {
	id = ehof_reality_code.611
	title = ehof_reality_code.611.name
	desc = ehof_reality_code.611.desc
	picture = GFX_evt_excavation_team
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world6@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 2
fleet_event = {
	id = ehof_reality_code.612
	title = ehof_reality_code.612.name
	desc = ehof_reality_code.612.desc
	picture = GFX_evt_habitable_dig_site
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world6@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } small_artifact_reward = yes }
	}
}

# Stage 3
fleet_event = {
	id = ehof_reality_code.613
	title = ehof_reality_code.613.name
	desc = ehof_reality_code.613.desc
	picture = GFX_evt_hidden_door
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world6@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 4
fleet_event = {
	id = ehof_reality_code.614
	title = ehof_reality_code.614.name
	desc = ehof_reality_code.614.desc
	picture = GFX_evt_discovered_hidden_door
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world6@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 5
fleet_event = {
	id = ehof_reality_code.615
	title = ehof_reality_code.615.name
	desc = ehof_reality_code.615.desc
	picture = GFX_evt_huge_monument
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world6@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } large_artifact_reward = yes }
	}
}

# Stage 6
fleet_event = {
	id = ehof_reality_code.616
	title = ehof_reality_code.616.name
	desc = ehof_reality_code.616.desc
	picture = GFX_evt_towel
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = code_world6@root.owner }
				save_event_target_as = code_world_planet
			}
		}
		from = { set_site_progress_locked = yes }
		owner = {
			remove_country_flag = ehof_code_star_world
			set_country_flag = ehof_code_6_complete
			add_event_chain_counter = {
				event_chain = ehof_p4_chain
				counter = reality_code
				amount = 1
			}
			if = {
				limit = {
					has_country_flag = extracted_sentient_metal
					NOR = {
						has_tech_option = tech_ehof_sentient_tier_6
						has_technology = tech_ehof_sentient_tier_6
					}
				}
				add_research_option = tech_ehof_sentient_tier_6
				add_tech_progress = { tech = tech_ehof_sentient_tier_6 progress = 0.1 }
			}
			if = {
				limit = {
					NOR = {
						has_tech_option = tech_ehof_build_gateway
						has_technology = tech_ehof_build_gateway
					}
				}
				add_research_option = tech_ehof_build_gateway
				add_tech_progress = { tech = tech_ehof_build_gateway progress = 0.25 }
			}
			country_event = { id = ehof_reality_code.1000 }
		}
		event_target:code_world_planet = { if = { limit = { has_negative_mass = no } ehof_add_negative_mass_deposit = yes } }
		leader = { unassign_leader = this }
		delete_fleet = this
	}
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } great_artifact_reward = yes }
		owner = {
			if = {
				limit = {
					NOR = {
						has_tech_option = tech_ehof_build_gateway
						has_technology = tech_ehof_build_gateway
					}
				}
				add_research_option = tech_ehof_build_gateway
				add_tech_progress = { tech = tech_ehof_build_gateway progress = 0.25 }
			}
			if = {
				limit = {
					has_country_flag = extracted_sentient_metal
					NOR = {
						has_tech_option = tech_ehof_sentient_tier_6
						has_technology = tech_ehof_sentient_tier_6
					}
				}
				add_research_option = tech_ehof_sentient_tier_6
				add_tech_progress = { tech = tech_ehof_sentient_tier_6 progress = 0.1 }
			}
		}
	}
}

################################ Final Digsite #################################

# Investigate Final digsite
country_event = {
	id = ehof_reality_code.1000
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "enigmatic_code_room" }
	title = "ehof_reality_code.1000.name"
	desc = "ehof_reality_code.1000.desc"
	is_triggered_only = yes
	location = event_target:ehof_creator_system

	trigger = { NOT = { has_country_flag = ehof_final_digsite } }

	immediate = {
		hidden_effect = {
			owner = { set_country_flag = ehof_final_digsite }
			no_scope = {
				random_system = {
					spawn_system = {
						min_distance >= 50
						max_distance >= 225
						hyperlane = no
						initializer = "ehof_unique_cplanet"
					}
				}
			}
			random_system = {
				limit = {
					ehof_creator_system = yes
					NOT = { has_star_flag = ehof_creator_taken }
				}
				set_star_flag = ehof_creator_taken
				set_star_flag = ehof_creator_takenby@root
				save_event_target_as = ehof_creator_system
			}
		}
	}

	option = {
		custom_gui = "ehof_eventui_option"
		default_hide_option = yes
		name = INTERESTING
		hidden_effect = { owner = { country_event = { id = story.5 days = 30 } } }
		owner = {
			create_point_of_interest = {
				id = ehof_mega_chain.1
				name = "ehof_mega_chain_1_poi"
				desc = "ehof_mega_chain_1_poi_desc"
				event_chain = ehof_p4_chain
				location = event_target:ehof_creator_system
			}
		}
	}
}

# Triggers when a fleet enters a system / Reality Code
fleet_event = {
	id = ehof_reality_code.10001
	title = "ehof_reality_code.10001.name"
	desc = "ehof_reality_code.10001.desc"
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "creator-eradicator_room" }
	show_sound = event_red_alert
	location = event_target:creator_system

	is_triggered_only = yes

	trigger = {
		from = { ehof_creator_system = yes }
		owner = {
			is_country_type = default
			NOT = { has_country_flag = encountered_cplanet }
		}
		exists = event_target:stellar_eradicator_fleet
		exists = event_target:stellar_eradicator_country
	}

	immediate = {
		random_system = {
			limit = { ehof_creator_system = yes }
			save_event_target_as = creator_system
		}
		owner = {
			set_country_flag = encountered_cplanet
			establish_communications_no_message = event_target:stellar_eradicator_country
			country_event = { id = story.8 days = 15 }
		}
	}

	option = { custom_gui = "ehof_eventui_option" name = DISCONCERTING }
}

# Upon destroying the eradicator
country_event = {
	id = ehof_reality_code.10002
	title = "ehof_reality_code.10002.name"
	desc = "ehof_reality_code.10002.desc"
	diplomatic = yes
	custom_gui = "ehof_eventui_window"
	picture_event_data = { room = "large_explosion_room" }
	show_sound = event_space_battle
	location = FromFromFrom
	is_triggered_only = yes

	trigger = {
		exists = event_target:stellar_eradicator_fleet
		FromFromFrom.fleet = { is_same_value = event_target:stellar_eradicator_fleet }
		is_country_type = default
	}

	option = { custom_gui = "ehof_eventui_option" name = ehof_anomaly.10416.a }
}

# Stage 1
fleet_event = {
	id = ehof_reality_code.1001
	title = ehof_reality_code.1001.name
	desc = ehof_reality_code.1001.desc
	picture = GFX_evt_cplanet
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 2
fleet_event = {
	id = ehof_reality_code.1002
	title = ehof_reality_code.1002.name
	desc = ehof_reality_code.1002.desc
	picture = GFX_evt_derelict_interior
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } medium_artifact_reward = yes }
	}
}

# Stage 3
fleet_event = {
	id = ehof_reality_code.1003
	title = ehof_reality_code.1003.name
	desc = ehof_reality_code.1003.desc
	picture = GFX_evt_huge_monument
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } large_artifact_reward = yes }
	}
}

# Stage 4
fleet_event = {
	id = ehof_reality_code.1004
	title = ehof_reality_code.1004.name
	desc = ehof_reality_code.1004.desc
	picture = GFX_evt_discovered_hidden_door
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } large_artifact_reward = yes }
	}
}

# Stage 5
fleet_event = {
	id = ehof_reality_code.1005
	title = ehof_reality_code.1005.name
	desc = ehof_reality_code.1005.desc
	picture = GFX_evt_huge_monument
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } great_artifact_reward = yes }
	}
}

# Stage 6
fleet_event = {
	id = ehof_reality_code.1006
	title = ehof_reality_code.1006.name
	desc = ehof_reality_code.1006.desc
	picture = GFX_evt_treasure_pile
	show_sound = event_dig_site
	location = from
	archaeology = yes
	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
		hidden_effect = {
			random_system = {
				limit = { has_star_flag = ehof_creator_takenby@owner }
				random_system_planet = {
					limit = { has_planet_flag = ehof_creator_planet }
					save_event_target_as = creator_sp
					set_planet_flag = ehof_has_special_project
				}
			}
			owner = {
				set_country_flag = ehof_code_7_complete
				if = {
					limit = {
						NOR = {
							has_tech_option = tech_ehof_sentient_tier_7
							has_technology = tech_ehof_sentient_tier_7
						}
					}
					add_research_option = tech_ehof_sentient_tier_7
					add_tech_progress = { tech = tech_ehof_sentient_tier_7 progress = 0.1 }
				}
			}
		}
	}

	after = { from = { set_site_progress_locked = no } }

	option = {
		default_hide_option = yes
		name = CURIOUS
		if = { limit = { has_ancrel = yes } great_artifact_reward = yes }
		enable_special_project = {
			name = "EXPLORE_CREATOR_PLANET"
			location = event_target:creator_sp
			owner = owner
		}
		owner = {
			if = {
				limit = {
					has_country_flag = extracted_sentient_metal
					NOR = {
						has_tech_option = tech_ehof_sentient_tier_7
						has_technology = tech_ehof_sentient_tier_7
					}
				}
				add_research_option = tech_ehof_sentient_tier_7
				add_tech_progress = { tech = tech_ehof_sentient_tier_7 progress = 0.1 }
			}
		}
	}
}