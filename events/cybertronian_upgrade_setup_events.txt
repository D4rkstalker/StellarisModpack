namespace = great_upgrade

# Great Upgrade from Autobot & Decepticon to Maximal & Predacon
country_event = {
	id = great_upgrade.1
	title = "great_upgrade.1.name"
	desc = "great_upgrade.1.desc"
	picture = GFX_evt_the_great_upgrade
	show_sound = event_synthetic_evolution
	trackable = yes
	
	is_triggered_only = yes
	
	option = {
		name = "great_upgrade.1.a"
		hidden_effect = { save_event_target_as = beast_era_upgrade_owner }
		capital_scope = {
			enable_special_project = {
				name = "BW_GREAT_UPGRADE_PROJECT"
				location = this
				owner = root
			}
		}
	}
	
	option = {
		name = "great_upgrade.1.b"
		hidden_effect = { save_event_target_as = transtech_upgrade_owner }
		capital_scope = {
			enable_special_project = {
				name = "TRANSTECH_UPGRADE_PROJECT"
				location = this
				owner = root
			}
		}
	}
}

country_event = {
	id = great_upgrade.2
	title = "great_upgrade.2.name"
	desc = "great_upgrade.2.desc"
	picture = GFX_evt_the_great_upgrade
	show_sound = event_synthetic_evolution
	
	is_triggered_only = yes
	
	immediate = {
		give_technology = { tech = tech_cybertronian_onboard_computer message = no }
		give_technology = { tech = tech_bio_reactor message = no }
		
		if = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						has_trait = trait_energon_dependence
					}
				}
			}	
			create_species = {
				is_mod = yes
				name = this
				namelist = this
				plural = this
				class = "cybertronian"
				portrait = this
				traits = {
					trait = "trait_mechanical"
					trait = "trait_bw_cybertronian"
					trait = "trait_energon_dependence"
				}
				effect = {
					if = {
						limit = { host_has_dlc = "Synthetic Dawn Story Pack" }
						prev = {
							switch = {
								trigger = species_portrait
								autobot = { prev = { change_species_characteristics = { portrait = "maximal" } } }
								decepticon = { prev = { change_species_characteristics = { portrait = "predacon" } } }
								neutral_cybertronian = { prev = { change_species_characteristics = { portrait = this } } }
								vehicon = { prev = { change_species_characteristics = { portrait = this } } }
							}
						}
					}
					
					rename_species = {
						prompt_country = root
						name_list = ascension_list
					}
					
					save_event_target_as = upgraded_cybertronian_species
				}
			}
		}
		#DARK ENERGON DOWNSIZED
		if = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						has_trait = trait_dark_energon_dependence 
					}
				}
			}
			create_species = {
				is_mod = yes
				name = this
				namelist = this
				plural = this
				class = "cybertronian"
				portrait = this
				traits = {
					trait = "trait_mechanical"
					trait = "trait_bw_cybertronian"
					trait = "trait_dark_energon_dependence"
				}
				effect = {
					if = {
						limit = { host_has_dlc = "Synthetic Dawn Story Pack" }
						prev = {
							switch = {
								trigger = species_portrait
								autobot = { prev = { change_species_characteristics = { portrait = "maximal" } } }
								decepticon = { prev = { change_species_characteristics = { portrait = "predacon" } } }
								neutral_cybertronian = { prev = { change_species_characteristics = { portrait = this } } }
								vehicon = { prev = { change_species_characteristics = { portrait = this } } }
							}
						}
					}
					
					rename_species = {
						prompt_country = root
						name_list = ascension_list
					}
					
					save_event_target_as = upgraded_darkened_cybertronian_species
				}
			}
		}
		else = {
			limit = {
				species = {
					NOR = {
						has_trait = trait_energon_dependence
						has_trait = trait_dark_energon_dependence
					}
				}
			}			
			create_species = {
				is_mod = yes
				name = this
				namelist = this
				plural = this
				class = "cybertronian"
				portrait = this
				traits = {
					trait = "trait_mechanical"
					trait = "trait_bw_cybertronian"
				}
				effect = {
					if = {
						limit = { host_has_dlc = "Synthetic Dawn Story Pack" }
						prev = {
							switch = {
								trigger = species_portrait
								autobot = { prev = { change_species_characteristics = { portrait = "maximal" } } }
								decepticon = { prev = { change_species_characteristics = { portrait = "predacon" } } }
								neutral_cybertronian = { prev = { change_species_characteristics = { portrait = this } } }
								vehicon = { prev = { change_species_characteristics = { portrait = this } } }
							}
						}
					}
					
					rename_species = {
						prompt_country = root
						name_list = ascension_list
					}
					
					save_event_target_as = upgraded_cybertronian_species
				}
			}
		}
		every_owned_pop = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						NOT = { has_trait = trait_dark_energon_dependence }
					}
				}
			}
			change_species = event_target:upgraded_cybertronian_species
		}
		every_owned_pop = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						has_trait = trait_dark_energon_dependence
					}
				}
			}
			change_species = event_target:upgraded_darkened_cybertronian_species
		}
		every_owned_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					AND = {
						has_trait = trait_cybertronian
						NOT = { has_trait = trait_dark_energon_dependence }
					}
				}
			}
			change_species = event_target:upgraded_cybertronian_species
		}
		every_owned_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					AND = {
						has_trait = trait_cybertronian
						has_trait = trait_dark_energon_dependence 
					}
				}
			}
			change_species = event_target:upgraded_darkened_cybertronian_species
		}
		every_owned_leader = {
			limit = {
				AND = {
					has_trait = trait_cybertronian
					NOT = { has_trait = trait_dark_energon_dependence }
				}
				OR = {
					has_trait = leader_trait_cybertronian
				}
			}
			change_species = event_target:upgraded_cybertronian_species
			change_leader_portrait = species
		}
		every_owned_leader = {
			limit = {
				AND = {
					has_trait = trait_cybertronian
					has_trait = trait_dark_energon_dependence 
				}
				OR = {
					has_trait = leader_trait_cybertronian
				}
			}
			change_species = event_target:upgraded_darkened_cybertronian_species
			change_leader_portrait = species
		}
		every_pool_leader = {
			limit = {
				AND = {
					has_trait = trait_cybertronian
					NOT = { has_trait = trait_dark_energon_dependence }
				}
				OR = {
					has_trait = leader_trait_cybertronian
				}
			}
			change_species = event_target:upgraded_cybertronian_species
			change_leader_portrait = species
		}
		change_dominant_species = { species = event_target:upgraded_cybertronian_species change_all = yes }
		
		every_pool_leader = {
			limit = {
				AND = {
					has_trait = trait_cybertronian
					has_trait = trait_dark_energon_dependence 
				}
				OR = {
					has_trait = leader_trait_cybertronian
				}
			}
			change_species = event_target:upgraded_darkened_cybertronian_species
			change_leader_portrait = species
		}
		change_dominant_species = { species = event_target:upgraded_cybertronian_species change_all = yes }

		
		every_owned_leader = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						NOT = { has_trait = trait_dark_energon_dependence }
					}
				}
				NOR = {
					has_trait = leader_trait_cybertronian
				}
			}
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_cybertronian
			}
		}
		every_owned_leader = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						has_trait = trait_dark_energon_dependence
					}
				}
				NOR = {
					has_trait = leader_trait_cybertronian
				}
			}
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_cybertronian
			}
		}
		every_pool_leader = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						NOT = { has_trait = trait_dark_energon_dependence }
					}
				}
				NOR = {
					has_trait = leader_trait_cybertronian
				}
			}
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_cybertronian
			}
		}
		every_pool_leader = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						has_trait = trait_dark_energon_dependence 
					}
				}
				NOR = {
					has_trait = leader_trait_cybertronian
				}
			}
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_cybertronian
			}
		}
		ROOT = {
			set_country_flag = cybertronian_upgrade_age
		}
	}
	
	option = {
		name = EXCELLENT
	}
}

# New Beast Era Leaders Get Cybertronian Trait
country_event = {
	id = great_upgrade.12
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		from = {
			species = { has_trait = trait_bw_cybertronian }
		}
	}
	
	immediate = {
		from = {
			add_trait_no_notify = leader_trait_cybertronian
		}
	}
}

country_event = {
	id = great_upgrade.3
	title = "great_upgrade.3.name"
	desc = "great_upgrade.3.desc"
	picture = GFX_evt_the_great_upgrade
	show_sound = event_synthetic_evolution
	
	is_triggered_only = yes
	
	immediate = {
		give_technology = { tech = tech_cybertronian_onboard_computer message = no }
		give_technology = { tech = tech_bio_reactor message = no }
		
		if = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						has_trait = trait_energon_dependence
					}
				}
			}
			create_species = {
				is_mod = yes
				name = this
				namelist = this
				plural = this
				class = "cybertronian"
				portrait = this
				traits = {
					trait = "trait_mechanical"
					trait = "trait_transtech_cybertronian"
					trait = "trait_energon_dependence"
				}
				
				effect = {
					if = {
						limit = { host_has_dlc = "Synthetic Dawn Story Pack" }
						prev = {
							switch = {
								trigger = species_portrait
								autobot = { prev = { change_species_characteristics = { portrait = this } } }
								decepticon = { prev = { change_species_characteristics = { portrait = this } } }
								neutral_cybertronian = { prev = { change_species_characteristics = { portrait = this } } }
								vehicon = { prev = { change_species_characteristics = { portrait = this } } }
							}
						}
					}
					
					rename_species = {
						prompt_country = root
						name_list = ascension_list
					}
					
					save_event_target_as = upgraded_cybertronian_species
				}
			}
		}
		#DARK ENERGON TRANSTECH
		if = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						has_trait = trait_dark_energon_dependence 
					}
				}
			}
			create_species = {
				is_mod = yes
				name = this
				namelist = this
				plural = this
				class = "cybertronian"
				portrait = this
				traits = {
					trait = "trait_mechanical"
					trait = "trait_transtech_cybertronian"
					trait = "trait_dark_energon_dependence"
				}
				
				effect = {
					if = {
						limit = { host_has_dlc = "Synthetic Dawn Story Pack" }
						prev = {
							switch = {
								trigger = species_portrait
								autobot = { prev = { change_species_characteristics = { portrait = this } } }
								decepticon = { prev = { change_species_characteristics = { portrait = this } } }
								neutral_cybertronian = { prev = { change_species_characteristics = { portrait = this } } }
								vehicon = { prev = { change_species_characteristics = { portrait = this } } }
							}
						}
					}
					
					rename_species = {
						prompt_country = root
						name_list = ascension_list
					}
					
					save_event_target_as = upgraded_darkened_cybertronian_species
				}
			}
		}
		else = {
			limit = {
				species = {
					NOR = {
						has_trait = trait_energon_dependence
						has_trait = trait_dark_energon_dependence
					}
				}
			}
			create_species = {
				is_mod = yes
				name = this
				namelist = this
				plural = this
				class = "cybertronian"
				portrait = this
				traits = {
					trait = "trait_mechanical"
					trait = "trait_transtech_cybertronian"
				}
				
				effect = {
					if = {
						limit = { host_has_dlc = "Synthetic Dawn Story Pack" }
						prev = {
							switch = {
								trigger = species_portrait
								autobot = { prev = { change_species_characteristics = { portrait = this } } }
								decepticon = { prev = { change_species_characteristics = { portrait = this } } }
								neutral_cybertronian = { prev = { change_species_characteristics = { portrait = this } } }
								vehicon = { prev = { change_species_characteristics = { portrait = this } } }
							}
						}
					}
					
					rename_species = {
						prompt_country = root
						name_list = ascension_list
					}
					
					save_event_target_as = upgraded_cybertronian_species
				}
			}
		}
		every_owned_pop = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						NOT = { has_trait = trait_dark_energon_dependence }
					}
				}
			}
			change_species = event_target:upgraded_cybertronian_species
		}
		every_owned_pop = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						has_trait = trait_dark_energon_dependence
					}
				}
			}
			change_species = event_target:upgraded_darkened_cybertronian_species
		}
		every_owned_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					AND = {
						has_trait = trait_cybertronian
						NOT = { has_trait = trait_dark_energon_dependence }
					}
				}
			}
			change_species = event_target:upgraded_cybertronian_species
		}
		every_owned_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					AND = {
						has_trait = trait_cybertronian
						has_trait = trait_dark_energon_dependence 
					}
				}
			}
			change_species = event_target:upgraded_darkened_cybertronian_species
		}
		every_owned_leader = {
			limit = {
				AND = {
					has_trait = trait_cybertronian
					NOT = { has_trait = trait_dark_energon_dependence }
				}
				OR = {
					has_trait = leader_trait_cybertronian
				}
			}
			change_species = event_target:upgraded_cybertronian_species
			change_leader_portrait = species
		}
		every_owned_leader = {
			limit = {
				AND = {
					has_trait = trait_cybertronian
					has_trait = trait_dark_energon_dependence
				}
				OR = {
					has_trait = leader_trait_cybertronian
				}
			}
			change_species = event_target:upgraded_darkened_cybertronian_species
			change_leader_portrait = species
		}
		every_pool_leader = {
			limit = {
				AND = {
					has_trait = trait_cybertronian
					NOT = { has_trait = trait_dark_energon_dependence }
				}
				OR = {
					has_trait = leader_trait_cybertronian
				}
			}
			change_species = event_target:upgraded_cybertronian_species
			change_leader_portrait = species
		}
		change_dominant_species = { species = event_target:upgraded_cybertronian_species change_all = yes }
		
		every_pool_leader = {
			limit = {
				AND = {
					has_trait = trait_cybertronian
					has_trait = trait_dark_energon_dependence 
				}
				OR = {
					has_trait = leader_trait_cybertronian
				}
			}
			change_species = event_target:upgraded_darkened_cybertronian_species
			change_leader_portrait = species
		}
		change_dominant_species = { species = event_target:upgraded_darkened_cybertronian_species change_all = yes }


		every_owned_leader = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						NOT = { has_trait = trait_dark_energon_dependence }
					}
				}
				NOR = {
					has_trait = leader_trait_cybertronian
				}
			}
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_cybertronian
			}
		}
		every_owned_leader = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						has_trait = trait_dark_energon_dependence
					}
				}
				NOR = {
					has_trait = leader_trait_cybertronian
				}
			}
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_cybertronian
			}
		}
		every_pool_leader = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						NOT = { has_trait = trait_dark_energon_dependence }
					}
				}
				NOR = {
					has_trait = leader_trait_cybertronian
				}
			}
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_cybertronian
			}
		}
		every_pool_leader = {
			limit = {
				species = {
					AND = {
						has_trait = trait_cybertronian
						has_trait = trait_dark_energon_dependence 
					}
				}
				NOR = {
					has_trait = leader_trait_cybertronian
				}
			}
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_cybertronian
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_cybertronian
			}
		}
		ROOT = {
			set_country_flag = cybertronian_upgrade_age
		}
	}
	
	option = {
		name = EXCELLENT
	}
}

# New TransTech Leaders Get Cybertronian Trait
country_event = {
	id = great_upgrade.13
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		from = {
			species = { has_trait = trait_transtech_cybertronian }
		}
	}
	
	immediate = {
		from = {
			add_trait_no_notify = leader_trait_cybertronian
		}
	}
}