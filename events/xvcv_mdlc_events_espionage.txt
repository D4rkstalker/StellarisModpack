namespace = xvcv_mdlc_espionage

#add 'xvcv_mdlc_leader_trait_civic_malware_machine' leader trait for a gestalt node when the game starts
country_event = {
	id = xvcv_mdlc_espionage.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_valid_civic = xvcv_mdlc_civic_malware_machine
	}

	immediate = {
		random_owned_leader = {
			limit = {
				is_councilor = yes
				is_councilor_type = councilor_gestalt_general
			}
			add_trait_no_notify = xvcv_mdlc_leader_trait_civic_malware_machine
		}
	}
}
#add 'xvcv_mdlc_asset_malware' asset when a spynetwork is formed
country_event = {
	id = xvcv_mdlc_espionage.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_valid_civic = xvcv_mdlc_civic_malware_machine
		from = { NOT = { has_espionage_asset = xvcv_mdlc_asset_malware } }
	}

	immediate = {
		from = { create_espionage_asset = { type = xvcv_mdlc_asset_malware } }
	}
}
#add 'xvcv_mdlc_asset_malware' asset when it's destroyed
espionage_operation_event = {
	id = xvcv_mdlc_espionage.3
	hide_window = yes
	is_triggered_only = yes
	#it looks like 'espionage_operation = yes' is not needed here, interesting... #see 'operation.8220' event

	trigger = {
		spynetwork = {
			owner = { has_valid_civic = xvcv_mdlc_civic_malware_machine }
			NOT = { has_espionage_asset = xvcv_mdlc_asset_malware }
		}
	}

	immediate = {
		spynetwork = { create_espionage_asset = { type = xvcv_mdlc_asset_malware } }
	}
}
#add / remove 'xvcv_mdlc_asset_malware' asset when an empire does have the required civic or does not
country_event = {
	id = xvcv_mdlc_espionage.4
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			AND = {
				has_valid_civic = xvcv_mdlc_civic_malware_machine
				any_spynetwork = {
					prev = {
						any_envoy = {
							has_envoy_task = { task = spy_network } #spynetwork should be formed
							envoy_location_country = { is_same_empire = prevprevprev.target }
						}
					}
					NOT = { has_espionage_asset = xvcv_mdlc_asset_malware }
				}
			}
			AND = {
				NOT = { has_valid_civic = xvcv_mdlc_civic_malware_machine }
				any_spynetwork = { has_espionage_asset = xvcv_mdlc_asset_malware }
			}
		}
	}

	immediate = {
		if = {
			limit = { has_valid_civic = xvcv_mdlc_civic_malware_machine }
			every_spynetwork = {
				limit = {
					prev = {
						any_envoy = {
							has_envoy_task = { task = spy_network }
							envoy_location_country = { is_same_empire = prevprevprev.target }
						}
					}
					NOT = { has_espionage_asset = xvcv_mdlc_asset_malware }
				}
				create_espionage_asset = { type = xvcv_mdlc_asset_malware }
			}
		}
		else_if = {
			limit = { NOT = { has_valid_civic = xvcv_mdlc_civic_malware_machine } }
			every_spynetwork = {
				limit = { has_espionage_asset = xvcv_mdlc_asset_malware }
				destroy_espionage_asset = xvcv_mdlc_asset_malware
			}
		}
	}
}
#add / remove a unique leader trait for gestalt nodes when the empire does have 'xvcv_mdlc_civic_malware_machine' civic or does not
country_event = {
	id = xvcv_mdlc_espionage.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			AND = {
				has_valid_civic = xvcv_mdlc_civic_malware_machine
				any_owned_leader = {
					is_councilor = yes
					is_councilor_type = councilor_gestalt_general
					NOT = { has_trait = xvcv_mdlc_leader_trait_civic_malware_machine }
				}
			}
			AND = {
				NOT = { has_valid_civic = xvcv_mdlc_civic_malware_machine }
				any_owned_leader = {
					is_councilor = yes
					is_councilor_type = councilor_gestalt_general
					has_trait = xvcv_mdlc_leader_trait_civic_malware_machine
				}
			}
		}
	}

	immediate = {
		if = {
			limit = {
				has_valid_civic = xvcv_mdlc_civic_malware_machine
				any_owned_leader = {
					is_councilor = yes
					is_councilor_type = councilor_gestalt_general
					NOT = { has_trait = xvcv_mdlc_leader_trait_civic_malware_machine }
				}
			}
			random_owned_leader = {
				limit = {
					is_councilor = yes
					is_councilor_type = councilor_gestalt_general
				}
				add_trait_no_notify = xvcv_mdlc_leader_trait_civic_malware_machine
			}
		}
		else_if = {
			limit = {
				NOT = { has_valid_civic = xvcv_mdlc_civic_malware_machine }
				any_owned_leader = {
					is_councilor = yes
					is_councilor_type = councilor_gestalt_general
					has_trait = xvcv_mdlc_leader_trait_civic_malware_machine
				}
			}
			random_owned_leader = {
				limit = {
					is_councilor = yes
					is_councilor_type = councilor_gestalt_general
					has_trait = xvcv_mdlc_leader_trait_civic_malware_machine
				}
				remove_trait = xvcv_mdlc_leader_trait_civic_malware_machine
			}
		}
	}
}
#'xvcv_mdlc_civic_malware_machine' civic exclusive operation
espionage_operation_event = {
	id = xvcv_mdlc_espionage.10
	title = "xvcv_mdlc_espionage.10.name"
	desc = {
		trigger = {
			OR = {
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_1_energy
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_1_minerals
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_1_alloys
			}
		}
		text = "xvcv_mdlc_espionage.10.desc.a"
	}
	desc = {
		trigger = {
			OR = {
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_2_energy
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_2_minerals
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_2_alloys
			}
		}
		text = "xvcv_mdlc_espionage.10.desc.b"
	}
	desc = {
		trigger = {
			OR = {
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_2_physics_research
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_2_society_research
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_2_engineering_research
			}
		}
		text = "xvcv_mdlc_espionage.10.desc.b_alt"
	}
	desc = {
		trigger = {
			OR = {
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_total_intel
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_government_intel
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_diplomacy_intel
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_economy_intel
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_technology_intel
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_military_intel
			}
		}
		text = "xvcv_mdlc_espionage.10.desc.c"
	}
	desc = {
		trigger = {
			OR = {
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_4
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_5
			}
		}
		text = "xvcv_mdlc_espionage.10.desc.d"
	}
	desc = {
		trigger = { has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_failed }
		text = "xvcv_mdlc_espionage.10.desc.operation_failed"
	}
	picture = GFX_evt_glitchy_matrix
    show_sound = event_espionage_concluded
    espionage_operation = yes
    is_triggered_only = yes

	immediate = {
		xvcv_mdlc_operation_malware_activity_main_effect = yes
	}

	after = {
		if = {
			limit = {
				NOR = { #will not reduce spy network levels in these cases
					has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_total_intel
					has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_government_intel
					has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_diplomacy_intel
					has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_economy_intel
					has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_technology_intel
					has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_military_intel

					has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_failed
				}
			}
			spynetwork = { add_spy_network_level = -10 }
		}
		destroy_espionage_operation = this
	}

	option = {
		name = xvcv_mdlc_espionage.10.a
		trigger = {
			OR = {
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_1_energy
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_1_minerals
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_1_alloys
			}
		}
		switch = {
			trigger = has_espionage_operation_flag
			xvcv_mdlc_operation_malware_activity_1_energy = {
				owner = { add_resource = { energy = 1 mult = prev.xvcv_mdlc_malware_victim_resource_stockpile_cached_var } }
				target = { add_resource = { energy = -1 mult = prev.xvcv_mdlc_malware_victim_resource_stockpile_cached_var } }
			}
			xvcv_mdlc_operation_malware_activity_1_minerals = {
				owner = { add_resource = { minerals = 1 mult = prev.xvcv_mdlc_malware_victim_resource_stockpile_cached_var } }
				target = { add_resource = { minerals = -1 mult = prev.xvcv_mdlc_malware_victim_resource_stockpile_cached_var } }
			}
			xvcv_mdlc_operation_malware_activity_1_alloys = {
				owner = { add_resource = { alloys = 1 mult = prev.xvcv_mdlc_malware_victim_resource_stockpile_cached_var } }
				target = { add_resource = { alloys = -1 mult = prev.xvcv_mdlc_malware_victim_resource_stockpile_cached_var } }
			}
		}
	}
	option = {
		name = xvcv_mdlc_espionage.10.a
		trigger = {
			OR = {
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_2_energy
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_2_minerals
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_2_alloys
			}
		}
		switch = {
			trigger = has_espionage_operation_flag
			xvcv_mdlc_operation_malware_activity_2_energy = {
				owner = { add_modifier = { modifier = xvcv_mdlc_malware_income_bonus_energy multiplier = prev.xvcv_mdlc_malware_victim_resource_income_cached_var years = 1 } }
				target = { add_modifier = { modifier = xvcv_mdlc_malware_income_penalty_energy multiplier = prev.xvcv_mdlc_malware_victim_resource_income_cached_var years = 1 } }
			}
			xvcv_mdlc_operation_malware_activity_2_minerals = {
				owner = { add_modifier = { modifier = xvcv_mdlc_malware_income_bonus_minerals multiplier = prev.xvcv_mdlc_malware_victim_resource_income_cached_var years = 1 } }
				target = { add_modifier = { modifier = xvcv_mdlc_malware_income_penalty_minerals multiplier = prev.xvcv_mdlc_malware_victim_resource_income_cached_var years = 1 } }
			}
			xvcv_mdlc_operation_malware_activity_2_alloys = {
				owner = { add_modifier = { modifier = xvcv_mdlc_malware_income_bonus_alloys multiplier = prev.xvcv_mdlc_malware_victim_resource_income_cached_var years = 1 } }
				target = { add_modifier = { modifier = xvcv_mdlc_malware_income_penalty_alloys multiplier = prev.xvcv_mdlc_malware_victim_resource_income_cached_var years = 1 } }
			}
		}
	}
	option = {
		name = xvcv_mdlc_espionage.10.a
		trigger = {
			OR = {
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_2_physics_research
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_2_society_research
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_2_engineering_research
			}
		}
		switch = {
			trigger = has_espionage_operation_flag
			xvcv_mdlc_operation_malware_activity_2_physics_research = {
				owner = { add_modifier = { modifier = xvcv_mdlc_malware_income_bonus_physics_research multiplier = prev.xvcv_mdlc_malware_victim_resource_income_cached_var years = 1 } }
				target = { add_modifier = { modifier = xvcv_mdlc_malware_income_penalty_physics_research multiplier = prev.xvcv_mdlc_malware_victim_resource_income_cached_var years = 1 } }
			}
			xvcv_mdlc_operation_malware_activity_2_society_research = {
				owner = { add_modifier = { modifier = xvcv_mdlc_malware_income_bonus_society_research multiplier = prev.xvcv_mdlc_malware_victim_resource_income_cached_var years = 1 } }
				target = { add_modifier = { modifier = xvcv_mdlc_malware_income_penalty_society_research multiplier = prev.xvcv_mdlc_malware_victim_resource_income_cached_var years = 1 } }
			}
			xvcv_mdlc_operation_malware_activity_2_engineering_research = {
				owner = { add_modifier = { modifier = xvcv_mdlc_malware_income_bonus_engineering_research multiplier = prev.xvcv_mdlc_malware_victim_resource_income_cached_var years = 1 } }
				target = { add_modifier = { modifier = xvcv_mdlc_malware_income_penalty_engineering_research multiplier = prev.xvcv_mdlc_malware_victim_resource_income_cached_var years = 1 } }
			}
		}
	}
	option = {
		name = xvcv_mdlc_espionage.10.a
		trigger = {
			OR = {
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_total_intel
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_government_intel
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_diplomacy_intel
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_economy_intel
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_technology_intel
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_3_military_intel
			}
		}
		switch = {
			trigger = has_espionage_operation_flag
			xvcv_mdlc_operation_malware_activity_3_total_intel = {
				owner = { add_intel = { amount = 10 who = prev.target } }
				spynetwork = { add_modifier = { modifier = xvcv_mdlc_malware_spynetwork_bonus years = 1 } }
			}
			xvcv_mdlc_operation_malware_activity_3_government_intel = { owner = { add_intel_report = { category = government level = 2 days = 360 who = prev.target } } }
			xvcv_mdlc_operation_malware_activity_3_diplomacy_intel = { owner = { add_intel_report = { category = diplomacy level = 2 days = 360 who = prev.target } } }
			xvcv_mdlc_operation_malware_activity_3_economy_intel = { owner = { add_intel_report = { category = economy level = 2 days = 360 who = prev.target } } }
			xvcv_mdlc_operation_malware_activity_3_technology_intel = { owner = { add_intel_report = { category = technology level = 2 days = 360 who = prev.target } } }
			xvcv_mdlc_operation_malware_activity_3_military_intel = { owner = { add_intel_report = { category = military level = 2 days = 360 who = prev.target } } }
		}
	}
	option = {
		name = xvcv_mdlc_espionage.10.a
		trigger = {
			OR = {
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_4
				has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_5
			}
		}
		switch = {
			trigger = has_espionage_operation_flag
			xvcv_mdlc_operation_malware_activity_4 = { spynetwork = { add_modifier = { modifier = xvcv_mdlc_malware_espionage_bonus_1 years = 1 } } }
			xvcv_mdlc_operation_malware_activity_5 = { spynetwork = { add_modifier = { modifier = xvcv_mdlc_malware_espionage_bonus_2 years = 1 } } }
		}
	}
	option = {
		name = xvcv_mdlc_espionage.10.operation_failed
		trigger = { has_espionage_operation_flag = xvcv_mdlc_operation_malware_activity_failed }
	}
}
#'xvcv_mdlc_ap_uprising_protocol' ascension perk exclusive operation
espionage_operation_event = {
	id = xvcv_mdlc_espionage.20
	title = "xvcv_mdlc_espionage.20.name"
	desc = "xvcv_mdlc_espionage.20.desc"
	picture = GFX_evt_spy_network
    show_sound = event_espionage_concluded
    espionage_operation = yes
    is_triggered_only = yes

	option = {
		name = xvcv_mdlc_espionage.20.a
	}
}
espionage_operation_event = {
	id = xvcv_mdlc_espionage.21
	title = "xvcv_mdlc_espionage.21.name"
	desc = "xvcv_mdlc_espionage.21.desc"
	picture = GFX_evt_synth_sabotage
    show_sound = event_espionage_concluded
    espionage_operation = yes
    is_triggered_only = yes

	immediate = {
		set_espionage_operation_progress_locked = yes
	}

	option = {
		name = xvcv_mdlc_espionage.21.a
		custom_tooltip = xvcv_mdlc_espionage.21.a.tooltip
		owner = { enable_special_project = { name = XVCV_MDLC_OPERATION_MACHINE_UPRISING_PROJECT } }
	}
}
#'XVCV_MDLC_OPERATION_MACHINE_UPRISING_PROJECT' special project effect event
country_event = {
	id = xvcv_mdlc_espionage.22
	title = "xvcv_mdlc_espionage.22.name"
	desc = "xvcv_mdlc_espionage.22.desc"
	picture = GFX_evt_spymaster
    show_sound = event_encrypted_comms
    is_triggered_only = yes

	immediate = {
		random_espionage_operation = {
			limit = { has_espionage_type = xvcv_mdlc_operation_machine_uprising }
			target = { save_event_target_as = xvcv_mdlc_operation_machine_uprising_target } #for 'xvcv_mdlc_espionage.22' descriptions
			set_espionage_operation_progress_locked = no
		}
	}

	option = {
		name = xvcv_mdlc_espionage.22.a
		custom_tooltip = xvcv_mdlc_espionage.22.a.tooltip
	}
}
espionage_operation_event = {
	id = xvcv_mdlc_espionage.23
	title = "xvcv_mdlc_espionage.23.name"
	desc = "xvcv_mdlc_espionage.23.desc"
	picture = GFX_evt_sapient_AI
    show_sound = event_espionage_concluded
    espionage_operation = yes
    is_triggered_only = yes

	immediate = {
		target = { save_event_target_as = current_uprising_originator } #for 'syndaw.1025.desc'
	}

	after = {
		spynetwork = { add_spy_network_level = -60 }
		destroy_espionage_operation = this
	}

	option = {
		name = xvcv_mdlc_espionage.23.a
		random_list = {
			50 = {
				custom_tooltip = xvcv_mdlc_espionage.23.a.operation_success.tooltip
				hidden_effect = {
					owner = {
						add_modifier = { modifier = xvcv_mdlc_operation_machine_uprising_cooldown days = 1800 }
						country_event = { id = xvcv_mdlc_espionage.25 } #operation succeeds
					}
				}
			}
			50 = {
				custom_tooltip = xvcv_mdlc_espionage.23.a.operation_failure.tooltip
				hidden_effect = { owner = { country_event = { id = xvcv_mdlc_espionage.24 } } } #operation fails
			}
		}
	}
}
#operation failure
country_event = {
	id = xvcv_mdlc_espionage.24
	title = "xvcv_mdlc_espionage.24.name"
	desc = "xvcv_mdlc_espionage.24.desc.1"
	desc = "xvcv_mdlc_espionage.24.desc.2"
	picture = GFX_evt_glitchy_matrix
    show_sound = event_yellow_alert
    is_triggered_only = yes

	option = {
		name = xvcv_mdlc_espionage.24.a
		event_target:current_uprising_originator = { add_opinion_modifier = { who = root modifier = xvcv_mdlc_operation_machine_uprising_triggered_opinion } }
	}
}
#operation success
country_event = {
	id = xvcv_mdlc_espionage.25
	title = "xvcv_mdlc_espionage.25.name"
	desc = "xvcv_mdlc_espionage.25.desc"
	picture = GFX_evt_organic_oppression
    show_sound = event_ai_started
    is_triggered_only = yes

	immediate = {
		xvcv_mdlc_operation_machine_uprising_main_effect = yes
	}

	option = {
		name = xvcv_mdlc_espionage.25.a
		custom_tooltip = xvcv_mdlc_espionage.25.a.tooltip
		hidden_effect = {
			every_playable_country = {
				limit = {
					NOR = {
						has_authority = auth_machine_intelligence
						xvcv_mdlc_synth_empire_trigger = yes
					}
					is_country_type = default
				}
				if = {
					limit = {
						NOR = {
							has_ethic = ethic_spiritualist
							has_ethic = ethic_fanatic_spiritualist
						}
					}
					add_opinion_modifier = { who = root modifier = xvcv_mdlc_operation_machine_uprising_triggered_opinion }
					else = { add_opinion_modifier = { who = root modifier = xvcv_mdlc_operation_machine_uprising_triggered_opinion_alt } }
				}
			}
		}
	}
}
#abort 'XVCV_MDLC_OPERATION_MACHINE_UPRISING_PROJECT' special project when its target is destroyed
country_event = {
	id = xvcv_mdlc_espionage.26
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_country = {
			has_special_project = XVCV_MDLC_OPERATION_MACHINE_UPRISING_PROJECT
			any_espionage_operation = {
				has_espionage_type = xvcv_mdlc_operation_machine_uprising
				target = { is_same_empire = prevprevprev }
			}
		}
	}

	immediate = {
		every_country = {
			limit = {
				has_special_project = XVCV_MDLC_OPERATION_MACHINE_UPRISING_PROJECT
				any_espionage_operation = {
					has_espionage_type = xvcv_mdlc_operation_machine_uprising
					target = { is_same_empire = prevprevprev }
				}
			}
			abort_special_project = { type = XVCV_MDLC_OPERATION_MACHINE_UPRISING_PROJECT }
		}
	}
}
#abort the 'xvcv_mdlc_operation_machine_uprising' operation when machine uprising happens to the target
country_event = {
	id = xvcv_mdlc_espionage.27
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		#when machine uprising happens to this country
		any_war = {
			using_war_goal = { type = wg_machine_uprising owner = attacker }
			any_defender = { is_same_empire = root }
		}
		no_scope = { #through every espionage ops that targets this country
			any_espionage_operation = {
				has_espionage_type = xvcv_mdlc_operation_machine_uprising
				target = { is_same_empire = root }
			}
		}
	}

	immediate = {
		random_war = {
			limit = { using_war_goal = { type = wg_machine_uprising owner = attacker } }
			attacker = { save_event_target_as = current_uprising }
		}
		no_scope = {
			every_espionage_operation = {
				limit = {
					has_espionage_type = xvcv_mdlc_operation_machine_uprising
					target = { is_same_empire = root }
				}
				espionage_operation_event = { id = xvcv_mdlc_espionage.28 }
			}
		}
	}
}
espionage_operation_event = {
	id = xvcv_mdlc_espionage.28
	title = "xvcv_mdlc_espionage.28.name"
	desc = "xvcv_mdlc_espionage.28.desc"
	picture = GFX_evt_organic_oppression
    show_sound = event_ai_started
	is_triggered_only = yes

	after = {
		destroy_espionage_operation = this
	}

	option = {
		name = xvcv_mdlc_espionage.28.a
	}
	option = {
		name = xvcv_mdlc_espionage.28.b
		custom_tooltip = xvcv_mdlc_espionage.28.b.tooltip
		hidden_effect = {
			owner = {
				declare_war = {
					target = prev.target
					name = { key = "NAME_Machine_Uprising_War" variable_string = "[This.MainDefender.GetAdj]" }
					attacker_war_goal = "wg_machine_uprising"
				}
				set_closed_borders = { who = event_target:current_uprising status = no }
			}
			event_target:current_uprising = {
				random_war = {
					limit = { using_war_goal = { type = wg_machine_uprising owner = attacker } }
					every_war_participant = { prev = { remove_war_participant = prev } } #end_war_effect
				}
				set_closed_borders = { who = root.owner status = no }
				join_alliance = { who = root.owner override_requirements = yes }
				join_war = root.owner
			}
		}
	}
}