namespace = ascension_traits_upgrade
planet_event = {
	id = ascension_traits_upgrade.1
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		IF = {
			limit = {
				any_pop = {
					has_trait = trait_cybernetic
				}
			}
			
			owner_species = {
				save_event_target_as = template_species
			}
			IF = {
				limit = {
					any_tile = {
						AND = {
							has_building = building_cybermen_factory
							pop = { has_trait = trait_machine_unit }
						}
					}
				}
				random_tile = {
					limit = {
						AND = {
							has_building = building_cybermen_factory
							pop = { has_trait = trait_machine_unit }
						}
					}
					pop = {
						species = { save_event_target_as = template_species }
					}
				}
			}
			
			random_pop = {
				limit = {
					AND = {
						has_trait = trait_cybernetic
						tile = { has_grown_pop = yes }
					}
				}
				change_species = event_target:template_species
				IF = {
					limit = { has_trait = cyberman }
					owner = {
						add_unity = 4
					}
				}
			}
			
		}
	}
}

planet_event = {
	id = ascension_traits_upgrade.3
	hide_window = yes
	is_triggered_only = no
	
	mean_time_to_happen = {
		days = 90
		modifier = {
			factor = 0.3
			any_tile = {
				has_building = building_cybermen_factory
			}
		}
	}

	immediate = {
		IF = {
			limit = {
				any_pop = { owner = { has_policy_flag = cybermen_integration_full } }
			}
			planet_event = {
				id = ascension_traits_upgrade.1
				days = 0
				random = 0
			}
		}
		IF = {
			limit = {
				AND = {
					any_pop = { owner = { has_policy_flag = cybermen_integration_selective } }
					has_building = building_cybermen_factory
				}
			}
			planet_event = {
				id = ascension_traits_upgrade.1
				days = 0
				random = 0
			}
		}
		
	}
}

#Replaces organic traits with upgraded ones. Adds "trait_cyberman".
country_event = {
	id = ascension_traits_upgrade.4
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		IF = {
			limit = { has_technology = tech_cybermen }
			every_owned_pop = {
				limit = {
					has_trait = trait_cybernetic
				}
				
				IF = {
					limit = {
						NOT = { has_trait = trait_cyberman }
					}
					modify_species = {
						base = none

						species = this
						add_trait = trait_cyberman

					}
				}
				
				IF = {
					limit = { has_trait = trait_thrifty }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_thrifty
						add_trait = trait_cyborg_thrifty

					}
				}
				IF = {
					limit = { has_trait = trait_industrious }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_industrious
						add_trait = trait_cyborg_industrious

					}
				}
				IF = {
					limit = { has_trait = trait_intelligent }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_intelligent
						add_trait = trait_cyborg_intelligent

					}
				}
				IF = {
					limit = { has_trait = trait_natural_engineers }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_natural_engineers
						add_trait = trait_cyborg_natural_engineers

					}
				}
				IF = {
					limit = { has_trait = trait_natural_physicists }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_natural_physicists
						add_trait = trait_cyborg_natural_physicists

					}
				}
				IF = {
					limit = { has_trait = trait_natural_sociologists }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_natural_sociologists
						add_trait = trait_cyborg_natural_sociologists

					}
				}
				IF = {
					limit = { has_trait = trait_extremely_adaptive }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_extremely_adaptive
						add_trait = trait_cyborg_extremely_adaptive

					}
				}
				IF = {
					limit = { has_trait = trait_adaptive }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_adaptive
						add_trait = trait_cyborg_adaptive

					}
				}
				IF = {
					limit = { has_trait = trait_rapid_breeders }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_rapid_breeders
						add_trait = trait_cyborg_rapid_breeders

					}
				}
				IF = {
					limit = { has_trait = trait_talented }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_talented
						add_trait = trait_cyborg_talented

					}
				}
				IF = {
					limit = { has_trait = trait_quick_learners }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_quick_learners
						add_trait = trait_cyborg_quick_learners

					}
				}
				IF = {
					limit = { has_trait = trait_traditional }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_traditional
						add_trait = trait_cyborg_traditional

					}
				}
				IF = {
					limit = { has_trait = trait_very_strong }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_very_strong
						add_trait = trait_cyborg_very_strong

					}
				}
				IF = {
					limit = { has_trait = trait_strong }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_strong
						add_trait = trait_cyborg_strong

					}
				}
				IF = {
					limit = { has_trait = trait_venerable }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_venerable
						add_trait = trait_cyborg_venerable

					}
				}
				IF = {
					limit = { has_trait = trait_enduring }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_enduring
						add_trait = trait_cyborg_enduring

					}
				}
				IF = {
					limit = { has_trait = trait_conservational }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_conservational
						add_trait = trait_cyborg_conservational

					}
				}
				IF = {
					limit = { has_trait = trait_resilient }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_resilient
						add_trait = trait_cyborg_resilient

					}
				}
				
				set_citizenship_type = {
					country = owner
					type = citizenship_full_machine
					cooldown = no
				}
			}
		}
	}
}

#Removes cyborg traits from non-cybernetic pops
country_event = {
	id = ascension_traits_upgrade.5
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		IF = {
			limit = {
				any_owned_pop = {
					AND = {
						NOT = { has_trait = trait_cybernetic }
						has_trait = trait_cyberman
					}
				}
			}
			every_owned_pop = {
				limit = {
					AND = {
						NOT = { has_trait = trait_cybernetic }
						has_trait = trait_cyberman
					}
				}
				
				IF = {
					limit = {
						has_trait = trait_cyberman
					}
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyberman
					}
				}
				
				IF = {
					limit = { has_trait = trait_cyborg_thrifty }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_thrifty
						add_trait = trait_thrifty
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_industrious }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_industrious
						add_trait = trait_industrious
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_intelligent }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_intelligent
						add_trait = trait_intelligent
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_natural_engineers }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_natural_engineers
						add_trait = trait_natural_engineers
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_natural_physicists }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_natural_physicists
						add_trait = trait_natural_physicists
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_natural_sociologists }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_natural_sociologists
						add_trait = trait_natural_sociologists
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_extremely_adaptive }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_extremely_adaptive
						add_trait = trait_extremely_adaptive
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_adaptive }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_adaptive
						add_trait = trait_adaptive
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_rapid_breeders }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_rapid_breeders
						add_trait = trait_rapid_breeders
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_talented }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_talented
						add_trait = trait_talented
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_quick_learners }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_quick_learners
						add_trait = trait_quick_learners
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_traditional }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_traditional
						add_trait = trait_traditional
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_very_strong }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_very_strong
						add_trait = trait_very_strong
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_strong }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_strong
						add_trait = trait_strong
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_venerable }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_venerable
						add_trait = trait_venerable
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_enduring }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_enduring
						add_trait = trait_enduring
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_conservational }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_conservational
						add_trait = trait_conservational
					}
				}
				IF = {
					limit = { has_trait = trait_cyborg_resilient }
					modify_species = {
						base = none

						species = this
						remove_trait = trait_cyborg_resilient
						add_trait = trait_resilient
					}
				}
				
				set_citizenship_type = {
					country = owner
					type = citizenship_full_machine
					cooldown = no
				}
			}
		}
	}
}