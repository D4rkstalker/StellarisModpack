namespace = lootbox_crisis

###############################################################
#Interdimensional Crate Midgame Crisis                        #
#                                                By: jasonpepe#
###############################################################
##

#test only
event = {
	id = lootbox_crisis.10000
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		every_playable_country = {
			save_event_target_as = lootbox_selected_country
			random_owned_planet = {
				limit = {
					is_capital = yes
				}
				save_event_target_as = lootbox_location
			}
			if = { #If host has nemesis DLC, a box ship spawns in your capital (Just for deco as its not possible to destroy it)
				limit = {
					host_has_dlc = Nemesis
				}
				if = {
					limit = {
						NOT = {
							exists = event_target:lootbox_country
						}
					}
					create_country = {
						name = "NAME_lootbox_country"
						type = lootbox_from_other_space
						flag = {
							icon = {
								category="corporate"
								file="corporate_08.dds"
							}
							background= {
								category="backgrounds"
								file="flag_BG_19.dds"
							}
							colors={
								"light_orange"
								"black"
								"null"
								"null"
							}
						}
					}
					last_created_country = {
						save_global_event_target_as = lootbox_country
						set_faction_hostility = {
							set_hostile = no
							set_neutral = yes
							set_friendly = no
						}
					}
				}
				event_target:lootbox_country = {
					establish_communications_no_message = root
				}
				create_fleet = {
					effect = {
						set_owner = event_target:lootbox_country
						create_ship = {
							name = "NAME_lootbox_from_other_world"
							design = "NAME_lootbox_from_other_world"							
						}
						last_created_ship = {
							set_ship_flag = lootbox_crisis_ship
							set_ship_flag = lootbox_country_box_from_owner_id_@event_target:lootbox_selected_country
							set_disable_at_health = 0.9
						}
						set_fleet_stance = passive
						set_location = event_target:lootbox_location
					}		
					settings = {
						is_boss = yes
						can_disband = no
						can_upgrade = no
						can_change_composition = no	
						spawn_debris = no
						can_change_leader = no
						uses_naval_capacity = no
					}
				}
			}
			country_event = {
				id = lootbox_crisis.1
				days = 5
			}
		}
	}
}
#test only
country_event = { 
	id = lootbox_crisis.10001
	is_triggered_only = yes
	hide_window = yes

	trigger = {}

	immediate = { 
		create_fleet = {
			effect = {
				set_owner = prev
				while = {
					count = 100
					create_ship = {
						name = random
						design = "NAME_lootbox_300ish"
					}
					create_ship = {
						name = random
						design = "NAME_lootbox_300ish"
					}
					create_ship = {
						name = random
						design = "NAME_lootbox_300ish"
					}
				}
				set_fleet_stance = passive
				set_location = prev.capital_scope.star	
			}		
			settings = {
				can_disband = yes
				can_upgrade = yes
				can_change_composition = yes	
				spawn_debris = yes
				can_change_leader = yes
				uses_naval_capacity = no
			}
		}
		hidden_effect = {
			last_created_fleet = {
				add_modifier = {
					modifier = lootbox_colossus_modifier
					days = -1
				}
			}	
		}
	}
}



###Settings###
	#Self repair box
	ship_event = {
		id = lootbox_crisis.1000
		is_triggered_only = yes
		hide_window = yes
		trigger = {
			has_ship_flag = lootbox_crisis_ship
		}
		immediate = {
			repair_ship = yes
			set_disabled = no
		}
	}

	#monthly gain +4 experience
	country_event = {
		id = lootbox_crisis.1001
		is_triggered_only = yes
		hide_window = yes
		trigger = {
			has_modifier = lootbox_reward_midfife_solutions
		}
		immediate = {
			every_owned_leader = {
				add_experience = 4
			}
		}
	}

	#+1 pop per year
	country_event = {
		id = lootbox_crisis.1002
		is_triggered_only = yes
		hide_window = yes
		trigger = {
			has_modifier = lootbox_reward_copypaste
		}
		immediate = {
			random_owned_planet = {
				limit = {
					is_capital = yes
				}
				create_pop = {
					species = THIS
				}
			}
		}
	}
	#lootbox self dismentle if not clean properly
	fleet_event = {
		id = lootbox_crisis.1004
		is_triggered_only = yes
		hide_window = yes
		immediate = {
			dismantle = yes
		}
	}
#


#chat 1
country_event = { 
	id = lootbox_crisis.1
	title = lootbox_crisis.1.title
	desc = {
		trigger = {
			success_text = {
				text = lootbox_crisis.1.start
				NOT = {
					host_has_dlc = Nemesis
				}
			}
			success_text = {
				text = lootbox_crisis.1.start_with_DLC
				host_has_dlc = Nemesis
			}
		}
	} 
	picture = GFX_lootbox_event_picture
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	location = event_target:lootbox_location

	trigger = {}

	after = {
		begin_event_chain = {
			event_chain = "lootbox_chain"
			target = ROOT
		}
		hidden_effect = {
			country_event = {
				id = lootbox_crisis.50
				days = 60
			}
			country_event = {
				id = lootbox_crisis.2
				days = 90 #360
				random = 270
			}	
		}
		
	}

	immediate = { 
		random_owned_planet = {
			limit = {
				is_capital = yes
			}
			save_event_target_as = lootbox_location
		}

		random_list = { #pre-set the rewards here so no SL meta can save them
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = cardboard_box
				} 
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = ezcredits
				}
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						host_has_dlc = Apocalypse
					}
				}
				effect_set_lootbox_reward_flag = {
					NAME = colossus
				}
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_civic = civic_fanatic_purifiers
						has_civic = civic_hive_devouring_swarm
						has_civic = civic_machine_terminator
					}
				}
				effect_set_lootbox_reward_flag = {
					NAME = goodtradedeal
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = spaceraid_colossuslegends
				}
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						has_civic = civic_fanatic_purifiers
						has_civic = civic_hive_devouring_swarm
						has_civic = civic_machine_terminator
					}
				}
				effect_set_lootbox_reward_flag = {
					NAME = reading_101
				}
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						host_has_dlc = Federations
					}
				}
				effect_set_lootbox_reward_flag = {
					NAME = juggernaut
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = corvette
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = midfife_solutions
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = copypaste
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = alloy_dot_com
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = xenopedia
				}
			}
			1 = {
				modifier = {
					factor = 0
					country_uses_food = no
				}
				effect_set_lootbox_reward_flag = {
					NAME = raidfood
				}
			}
			1 = {
				modifier = {
					factor = 0
					is_gestalt = yes
				}
				effect_set_lootbox_reward_flag = {
					NAME = greatstock
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = piratepats
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = topgeneral
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = mistsale
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = wildhunt
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = xenocoasterzoo
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = enclosedinstructionbook
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = pillowblorg
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = diarydog
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = boxinthebox
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = spinbot
				}
			}
			1 = {
				modifier = {
					factor = 0
					is_gestalt = yes
				}
				effect_set_lootbox_reward_flag = {
					NAME = tickingtalk
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = arena2200
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = portraitpatch
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = comma
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = freeaid
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = speedhack
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = paradoxian
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = autoart
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = tutorialex
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = galaticcivil
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = 300ish
				}
			}
			1 = {
				modifier = {
					factor = 0
					is_gestalt = yes
				}
				effect_set_lootbox_reward_flag = {
					NAME = reskiner
				}
			}
			1 = {
				effect_set_lootbox_reward_flag = {
					NAME = zero
				}
			}
		}
	}
	option = {
		name = lootbox_crisis.1.a
		custom_tooltip = lootbox_crisis.1.tooltip
	}
}

#informs
country_event = {
	id = lootbox_crisis.50
	title = lootbox_crisis.50.title
	desc = lootbox_crisis.50.desc
	picture = GFX_lootbox_event_picture
	show_sound = event_default
	is_triggered_only = yes
	trigger = {
		any_playable_country = {
			NOT = {
				is_same_empire = root
			}
			has_communications = root
			has_country_flag = lootbox_occur_in_country
		}
	}
	option = {
		name = INTERESTING
	}
}
#inform non particpators
country_event = {
	id = lootbox_crisis.51
	title = lootbox_crisis.50.title
	desc = lootbox_crisis.51.desc
	picture = GFX_lootbox_event_picture
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_country_flag = lootbox_occur_in_country
		}
		any_playable_country = {
			NOT = {
				is_same_empire = root
			}
			has_communications = root
			has_country_flag = lootbox_occur_in_country
		}
	}
	option = {
		name = INTERESTING
	}
}

country_event = { 
	id = lootbox_crisis.2
	title = lootbox_crisis.2.title
	desc = {
		text = lootbox_crisis.2.desc
		trigger = {
			is_machine_empire = no
		}
	} 
	desc = {
		text = lootbox_crisis.2.desc_machine
		trigger = {
			is_machine_empire = yes
		}
	} 
	picture = GFX_lootbox_event_picture
	show_sound = evn_ove_quantum_catapult_construction
	is_triggered_only = yes
	location = event_target:lootbox_location

	trigger = {}

	immediate = {
		random_owned_planet = {
			limit = {
				is_capital = yes
			}
			save_event_target_as = lootbox_location
		}
	}

	option = {
		name = lootbox_crisis.2.a
		custom_tooltip = lootbox_crisis.2.tooltip
		hidden_effect = {
			country_event = {
				id = lootbox_crisis.3
				days = 30
				random = 30
			}
		}
	}
}
#Don't you wanna be a big shot?
country_event = { 
	id = lootbox_crisis.3
	title = lootbox_crisis.3.title
	desc = lootbox_crisis.3.desc
	picture = GFX_lootbox_event_picture
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	location = event_target:lootbox_location

	trigger = {}

	immediate = {
		random_owned_planet = {
			limit = {
				is_capital = yes
			}
			save_event_target_as = lootbox_location
		}
	}

	after = {
		hidden_effect = {
			country_event = {
				id = lootbox_crisis.4
			}
		}	
	}
	option = {
		name = lootbox_crisis.3.a
	}
}
#It begins.
country_event = { 
	id = lootbox_crisis.4
	title = lootbox_crisis.4.title
	desc = lootbox_crisis.4.desc
	picture = GFX_lootbox_event_picture
	show_sound = evn_ove_scholarium_anomaly
	is_triggered_only = yes

	trigger = {}

	immediate = {
		start_situation = {
			type = lootbox_situation
			target = home_planet
		}
		save_event_target_as = lootbox_owner
		if = {
			limit = {
				exists = event_target:lootbox_country
			}
			event_target:lootbox_country = {
				random_owned_ship = {
					limit = {
						has_ship_flag = lootbox_country_box_from_owner_id_@event_target:lootbox_owner
					}
					create_ambient_object = {
						type = consecrated_planet_stage_1_object
						location = this
						use_3d_location = yes
						entity_scale_to_size = yes
					}
					last_created_ambient_object = {
						set_ambient_object_flag = lootbox_country_box_light_fx_id_@event_target:lootbox_owner
					}
				}
			}
		}	
		set_timed_country_flag = {
			flag = lootbox_crisis_random_event_cooldown
			days = 180
		}
		effect_run_lootbox_drain_tier_one_resource = {
			RESOURCE = energy
			SCALE = 0.5
		}
		effect_run_lootbox_drain_tier_one_resource = {
			RESOURCE = minerals
			SCALE = 0.5
		}
		if = {
			limit = {
				country_uses_food = yes
			}
			effect_run_lootbox_drain_tier_one_resource = {
				RESOURCE = food
				SCALE = 0.5
			}
		}
	}

	after = {		
		custom_tooltip = lootbox_crisis.4.tooltip
		tooltip = {
			add_modifier = {
				modifier = lootbox_drain_energy
				days = -1
				multiplier = lootbox_country_total_energy
			}
			add_modifier = {
				modifier = lootbox_drain_minerals
				days = -1
				multiplier = lootbox_country_total_minerals
			}
			if = {
				limit = {
					country_uses_food = yes
				}
				add_modifier = {
					modifier = lootbox_drain_food
					days = -1
					multiplier = lootbox_country_total_food
				}
			}
		}
	}

	option = {
		name = lootbox_crisis.4.a
		trigger = {
			is_megacorp = no
		}
	}

	option = {
		name = lootbox_crisis.4.b
		trigger = {
			is_megacorp = yes
		}
	}
}

#force loot-box self-dismentle
#Really dunno why some countries won't have their lootbox disband, event flags are all set.
#Not a perfect solution but it works
ship_event = {
	id = lootbox_crisis.5
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = this
	}
	immediate = {
		fleet = {
			dismantle = yes
		}
	}
}




#Ending gateway
situation_event = {
	id = lootbox_crisis.100
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		#Basically one empire finishes it, is over
		remove_global_flag = lootbox_in_progress
		remove_global_flag = midgame_crisis_ongoing
		owner = {
			remove_modifier = lootbox_drain_energy
			remove_modifier = lootbox_drain_minerals
			remove_modifier = lootbox_drain_food
			remove_modifier = lootbox_drain_consumer_goods
			remove_modifier = lootbox_drain_alloys
			remove_modifier = lootbox_drain_exotic_gases
			remove_modifier = lootbox_drain_rare_crystals
			remove_modifier = lootbox_drain_volatile_motes
		}
		
	}
	after = {
		owner = {
			country_event = {
				id = lootbox_crisis.10
			}
		}
		destroy_situation = this
	}
}

#Phase two
situation_event = {
	id = lootbox_crisis.8
	title = lootbox_crisis.8.title
	desc = lootbox_crisis.8.desc
	picture = GFX_lootbox_event_picture
	show_sound = event_mysterious_signal
	is_triggered_only = yes
	situation = this
	trigger = {
		situation_progress >= 33
		owner = {
			NOT = {
				has_country_flag = lootbox_crisis_phase_2
			}
			NOT = {
				has_country_flag = lootbox_crisis_no_further_events
			}
		}
		
	}
	after = {
		set_situation_locked = no
		owner = {
			remove_country_flag = lootbox_crisis_tick_event_in_active
		}
	}
	immediate = {
		owner = {
			set_country_flag = lootbox_crisis_tick_event_in_active
			set_country_flag = lootbox_crisis_phase_2
			if = {
				limit = {
					country_uses_consumer_goods = yes
				}
				effect_run_lootbox_predrain_tier_one_resource = {
					RESOURCE = consumer_goods
					SCALE = 0.5
				}
			}
			effect_run_lootbox_predrain_tier_one_resource = {
				RESOURCE = alloys
				SCALE = 0.5
			}
		}
		
		set_situation_locked = yes
	}
	option = {
		name = lootbox_crisis.8.a
		custom_tooltip = lootbox_crisis.8.a.tooltip
		owner = {
			hidden_effect = {
				effect_run_lootbox_drain_tier_one_resource = {
					RESOURCE = energy
					SCALE = 0.75
				}
				effect_run_lootbox_drain_tier_one_resource = {
					RESOURCE = minerals
					SCALE = 0.75
				}
				if = {
					limit = {
						country_uses_food = yes
					}
					effect_run_lootbox_drain_tier_one_resource = {
						RESOURCE = food
						SCALE = 0.75
					}
				}
			}
			if = {
				limit = {
					country_uses_consumer_goods = yes
				}
				add_modifier = {
					modifier = lootbox_drain_consumer_goods
					days = -1
					multiplier = lootbox_country_total_consumer_goods
				}
			}
			add_modifier = {
				modifier = lootbox_drain_alloys
				days = -1
				multiplier = lootbox_country_total_alloys
			}
		}
		
	}
	option = { #we stop here
		name = lootbox_crisis.8.b
		custom_tooltip = lootbox_crisis.8.b.tooltip
		owner = {
			hidden_effect = {
				set_country_flag = lootbox_crisis_no_further_events
				effect_run_lootbox_drain_tier_one_resource = {
					RESOURCE = energy
					SCALE = 0.25
				}
				effect_run_lootbox_drain_tier_one_resource = {
					RESOURCE = minerals
					SCALE = 0.25
				}
				if = {
					limit = {
						country_uses_food = yes
					}
					effect_run_lootbox_drain_tier_one_resource = {
						RESOURCE = food
						SCALE = 0.25
					}
				}
			}
		}
		
	}
}

#Phase three
situation_event = {
	id = lootbox_crisis.9
	title = lootbox_crisis.9.title
	desc = lootbox_crisis.9.desc
	picture = GFX_lootbox_event_picture
	show_sound = event_mysterious_signal
	is_triggered_only = yes
	situation = this
	trigger = {
		situation_progress >= 66

		owner = {
			NOT = {
				has_country_flag = lootbox_crisis_phase_3
			}
			NOT = {
				has_country_flag = lootbox_crisis_no_further_events
			}
		}
		
	}
	after = {
		set_situation_locked = no
		owner = {
			remove_country_flag = lootbox_crisis_tick_event_in_active
		}
	}
	immediate = {
		owner = {
			set_country_flag = lootbox_crisis_tick_event_in_active
			set_country_flag = lootbox_crisis_phase_3
			effect_run_lootbox_predrain_tier_one_resource = {
				RESOURCE = exotic_gases
				SCALE = 1
			}
			effect_run_lootbox_predrain_tier_one_resource = {
				RESOURCE = rare_crystals
				SCALE = 1
			}
			effect_run_lootbox_predrain_tier_one_resource = {
				RESOURCE = volatile_motes
				SCALE = 1
			}
		}
		
		set_situation_locked = yes
	}
	option = {
		name = lootbox_crisis.9.a
		owner = {
			custom_tooltip = lootbox_crisis.8.a.tooltip
			hidden_effect = {
				set_country_flag = lootbox_crisis_country_full_donated
				effect_run_lootbox_drain_tier_one_resource = {
					RESOURCE = energy
					SCALE = 1.25
				}
				effect_run_lootbox_drain_tier_one_resource = {
					RESOURCE = minerals
					SCALE = 1.25
				}
				if = {
					limit = {
						country_uses_food = yes
					}
					effect_run_lootbox_drain_tier_one_resource = {
						RESOURCE = food
						SCALE = 1.25
					}
				}
				if = {
					limit = {
						country_uses_consumer_goods = yes
					}
					effect_run_lootbox_drain_tier_one_resource = {
						RESOURCE = consumer_goods
						SCALE = 1
					}
				}
				effect_run_lootbox_drain_tier_one_resource = {
					RESOURCE = alloys
					SCALE = 1
				}
				
			}
			add_modifier = {
				modifier = lootbox_drain_exotic_gases
				days = -1
				multiplier = lootbox_country_total_exotic_gases
			}
			add_modifier = {
				modifier = lootbox_drain_rare_crystals
				days = -1
				multiplier = lootbox_country_total_rare_crystals
			}
			add_modifier = {
				modifier = lootbox_drain_volatile_motes
				days = -1
				multiplier = lootbox_country_total_volatile_motes
			}
		}
		
	}
	option = { #we stop here
		name = lootbox_crisis.9.b
		owner = {
			custom_tooltip = lootbox_crisis.8.b.tooltip
			hidden_effect = {
				set_country_flag = lootbox_crisis_no_further_events
				effect_run_lootbox_drain_tier_one_resource = {
					RESOURCE = energy
					SCALE = 0.25
				}
				effect_run_lootbox_drain_tier_one_resource = {
					RESOURCE = minerals
					SCALE = 0.25
				}
				if = {
					limit = {
						country_uses_food = yes
					}
					effect_run_lootbox_drain_tier_one_resource = {
						RESOURCE = food
						SCALE = 0.25
					}
				}
				if = {
					limit = {
						country_uses_consumer_goods = yes
					}
					effect_run_lootbox_drain_tier_one_resource = {
						RESOURCE = consumer_goods
						SCALE = 0.25
					}
				}
				effect_run_lootbox_drain_tier_one_resource = {
					RESOURCE = alloys
					SCALE = 0.25
				}
			}
		}
		
	}
}

#Finish the opening box
country_event = {
	id = lootbox_crisis.10
	title = lootbox_crisis.10.title
	desc = lootbox_crisis.10.desc
	picture = GFX_lootbox_event_picture
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	immediate = {
		save_event_target_as = lootbox_owner
		if = { #If the crate exists
			limit = {
				exists = event_target:lootbox_country
			}
			event_target:lootbox_country = {
				random_owned_ship = {
					limit = {
						has_ship_flag = lootbox_country_box_from_owner_id_@event_target:lootbox_owner
					}
					ship_event = {
						id = lootbox_crisis.5
					}
					create_ambient_object = {
						type = "star_explosion"
						play_animation_once = yes
						location = this
						duration = 180
					}
					last_created_ambient_object = {
						set_location = {
							target = prev
							distance = 0
							angle = random
						}
					}
				}
				every_ambient_object = {
					limit = {
						has_ambient_object_flag = lootbox_country_box_light_fx_id_@event_target:lootbox_owner
					}
					destroy_ambient_object = this
				}
			}
		}
	}
	after = {
		hidden_effect = {
			country_event = {
				id = lootbox_crisis.11
			}
		}	
	}
	option = {
		name = lootbox_crisis.10.a
	}
}

country_event = {
	id = lootbox_crisis.11
	title = lootbox_crisis.11.title
	desc = {
		trigger = {
			success_text = {
				text = lootbox_crisis.11.desc
			}
			success_text = {
				text = lootbox_crisis.11.desc_rewards
				has_country_flag = lootbox_crisis_country_full_donated
			}
			success_text = {
				text = lootbox_crisis.11.desc2
			}
		}
	}
	picture = GFX_lootbox_event_picture
	show_sound = event_finding_loot
	is_triggered_only = yes
	immediate = {
		divide_variable = {
			which = lootbox_country_total_drained_resource_num
			value = 4
		}
		
		random_list = {
			1 = {
				set_country_flag = lootbox_crisis_refund_energy
			}
			1 = {
				set_country_flag = lootbox_crisis_refund_alloys
				divide_variable = {
					which = lootbox_country_total_drained_resource_num
					value = 3
				}
			}
			1 = {
				set_country_flag = lootbox_crisis_refund_exotic_gases
				divide_variable = {
					which = lootbox_country_total_drained_resource_num
					value = 10
				}
			}
			1 = {
				set_country_flag = lootbox_crisis_refund_rare_crystals
				divide_variable = {
					which = lootbox_country_total_drained_resource_num
					value = 10
				}
			}
			1 = {
				set_country_flag = lootbox_crisis_refund_volatile_motes
				divide_variable = {
					which = lootbox_country_total_drained_resource_num
					value = 10
				}
			}
		}
		round_variable = lootbox_country_total_drained_resource_num
	}
	after = {
		if = {
			limit = {
				has_country_flag = lootbox_crisis_country_full_donated
			}
			
			if = {
				limit = {
					has_country_flag = lootbox_crisis_reward_300ish
				}
				create_fleet = {
					effect = {
						set_owner = prev
						while = {
							count = 100
							create_ship = {
								name = random
								design = "NAME_lootbox_300ish"
							}
							create_ship = {
								name = random
								design = "NAME_lootbox_300ish"
							}
							create_ship = {
								name = random
								design = "NAME_lootbox_300ish"
							}
						}
						set_fleet_stance = passive
						set_location = prev.capital_scope.star	
					}		
					settings = {
						can_disband = yes
						can_upgrade = yes
						can_change_composition = yes	
						spawn_debris = yes
						can_change_leader = yes
						uses_naval_capacity = no
					}
				}
				hidden_effect = {
					last_created_fleet = {
						add_modifier = {
							modifier = lootbox_colossus_modifier
							days = -1
						}
					}	
				}
				custom_tooltip = lootbox_crisis_reward_300ish.tooltip
			}
			if = {
				limit = {
					has_country_flag = lootbox_crisis_reward_colossus
				}
				create_fleet = {
					effect = {
						set_owner = prev
						create_ship = {
							name = random
							design = "NAME_lootbox_colossus"
						}
						set_fleet_stance = passive
						set_location = prev.capital_scope.star	
					}		
					settings = {
						can_disband = yes
						can_upgrade = yes
						can_change_composition = yes	
						spawn_debris = no
						can_change_leader = yes
						uses_naval_capacity = yes
					}
				}
				hidden_effect = {
					last_created_fleet = {
						add_modifier = {
							modifier = lootbox_colossus_modifier
							days = -1
						}
					}	
				}
				custom_tooltip = lootbox_crisis_reward_colossus.tooltip
			}		
			if = {
				limit = {
					has_country_flag = lootbox_crisis_reward_corvette
				}
				create_fleet = {
					effect = {
						set_owner = prev
						while = {
							count = 3
							create_ship = {
								name = random
								design = "NAME_lootbox_corvette"
							}
						}
						set_fleet_stance = passive
						set_location = prev.capital_scope.star	
					}		
					settings = {
						can_disband = no
						can_upgrade = no
						can_change_composition = yes	
						spawn_debris = no
						can_change_leader = yes
						uses_naval_capacity = yes
					}
				}
				hidden_effect = {
					last_created_fleet = {
						add_modifier = {
							modifier = lootbox_corvette_modifier
							days = -1
						}
					}	
				}
				custom_tooltip = lootbox_crisis_reward_corvette.tooltip
			}
			if = {
				limit = {
					has_country_flag = lootbox_crisis_reward_juggernaut
				}
				create_fleet = {
					effect = {
						set_owner = prev
						create_ship = {
							name = random
							design = "NAME_lootbox_juggernaut"
						}
						set_fleet_stance = passive
						set_location = prev.capital_scope.star	
					}		
					settings = {
						can_disband = yes
						can_upgrade = yes
						can_change_composition = yes	
						spawn_debris = no
						can_change_leader = yes
						uses_naval_capacity = yes
					}
				}
				custom_tooltip = lootbox_crisis_reward_juggernaut.tooltip
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = cardboard_box
			} 
			effect_give_lootbox_reward_modifiers = {
				NAME = ezcredits
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = colossus
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = goodtradedeal
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = spaceraid_colossuslegends
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = reading_101
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = juggernaut
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = corvette
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = midfife_solutions
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = copypaste
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = alloy_dot_com
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = xenopedia
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = raidfood
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = greatstock
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = piratepats
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = topgeneral
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = mistsale
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = wildhunt
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = xenocoasterzoo
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = enclosedinstructionbook
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = pillowblorg
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = diarydog
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = boxinthebox
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = spinbot
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = tickingtalk
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = arena2200
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = portraitpatch
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = comma
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = freeaid
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = speedhack
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = paradoxian
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = autoart
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = tutorialex
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = galaticcivil
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = 300ish
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = reskiner
			}
			effect_give_lootbox_reward_modifiers = {
				NAME = zero
			}
		}
		effect_run_lootbox_refund_resource = {
			RESOURCE = energy
		}
		effect_run_lootbox_refund_resource = {
			RESOURCE = alloys
		}
		effect_run_lootbox_refund_resource = {
			RESOURCE = exotic_gases
		}
		effect_run_lootbox_refund_resource = {
			RESOURCE = rare_crystals
		}
		effect_run_lootbox_refund_resource = {
			RESOURCE = volatile_motes
		}
		
		end_event_chain = lootbox_chain
	}

	option = {
		trigger = {
			NOT = {
				has_country_flag = lootbox_crisis_country_full_donated
			}
		}
		name = lootbox_crisis.11.a
		custom_tooltip = lootbox_crisis.11.tooltip
		add_monthly_resource_mult = {
			resource = unity
			value = 24
			min = 300
		}
		add_resource = {
			influence = 200
		}
	}
	option = {
		trigger = {
			has_country_flag = lootbox_crisis_country_full_donated
		}
		name = lootbox_crisis.11.b
		custom_tooltip = lootbox_crisis.11.full_tooltip
		add_monthly_resource_mult = {
			resource = unity
			value = 12
			min = 300
		}
	}
}

#abort the opening box

country_event = {
	id = lootbox_crisis.15
	title = lootbox_crisis.15.title
	desc = lootbox_crisis.15.desc
	picture = GFX_lootbox_event_picture
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	immediate = {
		save_event_target_as = lootbox_owner
		remove_modifier = lootbox_drain_energy
		remove_modifier = lootbox_drain_minerals
		remove_modifier = lootbox_drain_food
		remove_modifier = lootbox_drain_consumer_goods
		remove_modifier = lootbox_drain_alloys
		remove_modifier = lootbox_drain_exotic_gases
		remove_modifier = lootbox_drain_rare_crystals
		remove_modifier = lootbox_drain_volatile_motes
		if = { #If the crate exists
			limit = {
				exists = event_target:lootbox_country
			}
			event_target:lootbox_country = {
				random_owned_ship = {
					limit = {
						has_ship_flag = lootbox_country_box_from_owner_id_@event_target:lootbox_owner
					}
					ship_event = {
						id = lootbox_crisis.5
					}
				}
				every_ambient_object = {
					limit = {
						has_ambient_object_flag = lootbox_country_box_light_fx_id_@event_target:lootbox_owner
					}
					destroy_ambient_object = this
				}
			}
		}
	}
	option = {
		name = UNFORTUNATE
	}
}

situation_event = {
	id = lootbox_crisis.1010
	title = lootbox_crisis.1010.title
	desc = lootbox_crisis.1010.desc
	picture = GFX_lootbox_event_picture
	show_sound = event_default
	is_triggered_only = yes
	fire_only_once = yes
	situation = this
	trigger = {
		owner = {
			has_country_flag = lootbox_crisis_no_further_events
		}
	}
	option = {
		name = lootbox_crisis.1010.a
	}
}

#RANDOM EVENTS
#unstable, take additional extra resource from country
situation_event = {
	id = lootbox_crisis.1015
	title = lootbox_crisis.1015.title
	desc = {
		trigger = {
			success_text = {
				text = lootbox_crisis.1015.desc
				owner = {
					NOT = {
						has_country_flag = lootbox_crisis.1015_happened
					}
				}
				
			}
			success_text = {
				text = lootbox_crisis.1015.desc_after
				owner = {
					has_country_flag = lootbox_crisis.1015_happened
					is_machine_empire = no
				}
			}
			success_text = {
				text = lootbox_crisis.1015.desc_after_machine
				owner = {
					has_country_flag = lootbox_crisis.1015_happened
					is_machine_empire = yes
				}
			}
		}
	} 
	picture = GFX_evt_deficit
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	situation = this
	trigger = {
		situation_progress <= 95
		owner = {
			NOT = {
				has_country_flag = lootbox_crisis_tick_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_no_further_events
			}
		}
	}
	immediate = {
		set_situation_locked = yes	
		owner = {
			save_event_target_as = lootbox_owner
			random = {
				chance = 10
				set_country_flag = lootbox_crisis.1015.meme
			}
			set_variable_to_random_value = { #random number 1 to 5
				which = lootbox_crisis_1015_resource_randomizer_num
				min = 1
				max = 3
				rounded = yes
			}
			set_variable_to_random_value = { #random number 1 to 10
				which = lootbox_crisis_1015_resource_mulitply_energy
				min = 1
				max = 20
				rounded = no
			}
			set_variable_to_random_value = { #random number 1 to 10
				which = lootbox_crisis_1015_resource_mulitply_minerals
				min = 1
				max = 20
				rounded = no
			}
			set_variable_to_random_value = { #random number 1 to 10
				which = lootbox_crisis_1015_resource_mulitply_food
				min = 1
				max = 20
				rounded = no
			}
			set_variable_to_random_value = { #random number 1 to 10
				which = lootbox_crisis_1015_resource_mulitply_consumer_goods
				min = 1
				max = 10
				rounded = no
			}
			set_variable_to_random_value = { #random number 1 to 10
				which = lootbox_crisis_1015_resource_mulitply_alloys
				min = 1
				max = 10
				rounded = no
			}
			if = {
				limit = {
					resource_stockpile_compare = {
						resource = energy
						value >= 10000
					}
				}
				set_variable_to_random_value = { #random number 1 to 10
					which = lootbox_crisis_1015_resource_mulitply_energy
					min = 10
					max = 30
					rounded = no
				}
			}
			if = {
				limit = {
					resource_stockpile_compare = {
						resource = minerals
						value >= 10000
					}
				}
				set_variable_to_random_value = { #random number 1 to 10
					which = lootbox_crisis_1015_resource_mulitply_minerals
					min = 10
					max = 30
					rounded = no
				}
			}
			if = {
				limit = {
					resource_stockpile_compare = {
						resource = food
						value >= 10000
					}
				}
				set_variable_to_random_value = { #random number 1 to 10
					which = lootbox_crisis_1015_resource_mulitply_food
					min = 10
					max = 30
					rounded = no
				}
			}
			if = {
				limit = {
					resource_stockpile_compare = {
						resource = consumer_goods
						value >= 2000
					}
					check_variable = {
						which = lootbox_crisis_1015_resource_mulitply_consumer_goods
						value <= 5
					}
				}
				set_variable_to_random_value = { #random number 1 to 10
					which = lootbox_crisis_1015_resource_mulitply_consumer_goods
					min = 5
					max = 20
					rounded = no
				}
			}
			if = {
				limit = {
					resource_stockpile_compare = {
						resource = alloys
						value >= 2000
					}
					check_variable = {
						which = lootbox_crisis_1015_resource_mulitply_alloys
						value <= 5
					}
				}
				set_variable_to_random_value = { #random number 1 to 10
					which = lootbox_crisis_1015_resource_mulitply_alloys
					min = 5
					max = 20
					rounded = no
				}
			}
			set_country_flag = lootbox_crisis_random_event_in_active
			while = {
				count = lootbox_crisis_1015_resource_randomizer_num
				random_list = {
					1 = {
						modifier = {
							factor = 0
							has_country_flag = lootbox_crisis.1015_energy
						}
						set_country_flag = lootbox_crisis.1015_energy
					}
					1 = {
						modifier = {
							factor = 0
							has_country_flag = lootbox_crisis.1015_minerals
						}
						set_country_flag = lootbox_crisis.1015_minerals
					}
					1 = {
						modifier = {
							factor = 0
							country_uses_food = no
						}
						modifier = {
							factor = 0
							has_country_flag = lootbox_crisis.1015_food
						}
						set_country_flag = lootbox_crisis.1015_food
					}
					1 = {
						modifier = {
							factor = 0
							country_uses_consumer_goods = no
						}
						modifier = {
							factor = 0
							has_country_flag = lootbox_crisis.1015_consumer_goods
						}
						set_country_flag = lootbox_crisis.1015_consumer_goods
					}
					1 = {
						modifier = {
							factor = 0
							has_country_flag = lootbox_crisis.1015_alloys
						}
						set_country_flag = lootbox_crisis.1015_alloys
					}
				}
			}
			
		}
		if = {
			limit = {
				exists = event_target:lootbox_country
			}
			event_target:lootbox_country = {
				random_owned_ship = {
					limit = {
						has_ship_flag = lootbox_country_box_from_owner_id_@event_target:lootbox_owner
					}
					create_ambient_object = {
						type = consecrated_planet_stage_2_object
						location = this
						use_3d_location = yes
						entity_scale_to_size = yes
					}
					last_created_ambient_object = {
						set_ambient_object_flag = lootbox_country_box_light_fx2_id_@event_target:lootbox_owner
					}
				}
			}
		}
	}
	after = {
		set_situation_locked = no
		if = {
			limit = {
				exists = event_target:lootbox_country
			}
			event_target:lootbox_country = {
				every_ambient_object = {
					limit = {
						has_ambient_object_flag = lootbox_country_box_light_fx2_id_@event_target:lootbox_owner
					}
					destroy_ambient_object = this
				}
			}
		}
		owner = {
			remove_country_flag = lootbox_crisis_random_event_in_active
			set_country_flag = lootbox_crisis.1015_happened
			set_timed_country_flag = {
				flag = lootbox_crisis_random_event_cooldown
				days = 200
			}
			hidden_effect = {
				remove_country_flag = lootbox_crisis.1015_energy
				remove_country_flag = lootbox_crisis.1015_minerals
				remove_country_flag = lootbox_crisis.1015_food
				remove_country_flag = lootbox_crisis.1015_consumer_goods
				remove_country_flag = lootbox_crisis.1015_alloys
				remove_country_flag = lootbox_crisis.1015.meme
			}
		}
		
	}
	option = {
		name = lootbox_crisis.1015.a
		allow = {
			hidden_trigger = {
				owner = {
					calc_true_if = {
						amount = lootbox_crisis_1015_resource_randomizer_num
						AND = {
							has_country_flag = lootbox_crisis.1015_energy
							resource_stockpile_compare = {
								resource = energy
								value >= 100
								mult = lootbox_crisis_1015_resource_mulitply_energy
							}
						}
						AND = {
							has_country_flag = lootbox_crisis.1015_minerals
							resource_stockpile_compare = {
								resource = minerals
								value >= 100
								mult = lootbox_crisis_1015_resource_mulitply_minerals
							}
						}
						AND = {
							has_country_flag = lootbox_crisis.1015_food
							resource_stockpile_compare = {
								resource = food
								value >= 100
								mult = lootbox_crisis_1015_resource_mulitply_food
							}
						}
						AND = {
							has_country_flag = lootbox_crisis.1015_consumer_goods
							resource_stockpile_compare = {
								resource = consumer_goods
								value >= 100
								mult = lootbox_crisis_1015_resource_mulitply_consumer_goods
							}
						}
						AND = {
							has_country_flag = lootbox_crisis.1015_alloys
							resource_stockpile_compare = {
								resource = alloys
								value >= 100
								mult = lootbox_crisis_1015_resource_mulitply_alloys
							}
						}
					}
				}
			}	
		}
		owner = {
			if = {
				limit = {
					has_country_flag = lootbox_crisis.1015_energy
				}
				add_resource = {
					energy = -100
					mult = lootbox_crisis_1015_resource_mulitply_energy
				}
			}
			if = {
				limit = {
					has_country_flag = lootbox_crisis.1015_minerals
				}
				add_resource = {
					minerals = -100
					mult = lootbox_crisis_1015_resource_mulitply_minerals
				}
			}
			if = {
				limit = {
					has_country_flag = lootbox_crisis.1015_food
				}
				add_resource = {
					food = -100
					mult = lootbox_crisis_1015_resource_mulitply_food
				}
			}
			if = {
				limit = {
					has_country_flag = lootbox_crisis.1015_consumer_goods
				}
				add_resource = {
					consumer_goods = -100
					mult = lootbox_crisis_1015_resource_mulitply_consumer_goods
				}
			}
			if = {
				limit = {
					has_country_flag = lootbox_crisis.1015_alloys
				}
				add_resource = {
					alloys = -100
					mult = lootbox_crisis_1015_resource_mulitply_alloys
				}
			}
		}	
	}
	option = { #Buy with unity
		name = lootbox_crisis.1015.b
		trigger = {
			owner = {
				is_spiritualist = yes
				resource_stockpile_compare = {
					resource = influence
					value >= 50
				}
			}
		}
		allow = {
			owner = {
				hidden_trigger = {
					NOT = {
						has_country_flag = lootbox_crisis.1015.b_used
					}
					resource_stockpile_compare = {
						resource = unity
						value >= 3000
					}
				}
			}	
		}
		custom_tooltip = lootbox_crisis.1015.b.tooltip
		owner = {
			set_country_flag = lootbox_crisis.1015.b_used
			add_resource = {
				unity = -3000
				influence = -50
			}
		}	
	}

	option = { #attack it
		name = lootbox_crisis.1015.c
		trigger = {
			owner = {
				OR = {
					is_militarist = yes
					is_gestalt = yes
				}
				resource_stockpile_compare = {
					resource = influence
					value >= 50
				}
			}
		}
		allow = {
			owner = {
				hidden_trigger = {
					NOT = {
						has_country_flag = lootbox_crisis.1015.c_used
					}
				}
			}	
		}
		custom_tooltip = lootbox_crisis.1015.c.tooltip
		owner = {
			set_country_flag = lootbox_crisis.1015.c_used
			add_resource = {
				energy = 1000
				minerals = 1000
				influence = -50
			}
		}	
	}

	option = { #use your pop
		name = lootbox_crisis.1015.d
		trigger = {
			owner = {
				OR = {
					is_authoritarian = yes
					is_gestalt = yes
				}
				resource_stockpile_compare = {
					resource = influence
					value >= 50
				}
			}
		}
		allow = {
			owner = {
				hidden_trigger = {
					num_pops >= 4
					NOT = {
						has_country_flag = lootbox_crisis.1015.d_used
					}
				}
			}	
		}
		custom_tooltip = lootbox_crisis.1015.d.tooltip
		owner = {
			set_country_flag = lootbox_crisis.1015.d_used
			while = {
				count = 4
				random_owned_pop = {
					kill_pop = yes
				}
			}
			add_resource = {
				influence = -50
			}
		}	
	}

	option = { #use your factory
		name = lootbox_crisis.1015.e
		trigger = {
			owner = {
				resource_stockpile_compare = {
					resource = influence
					value >= 50
				}
			}		
		}
		allow = {
			owner = {
				
				hidden_trigger = {
					NOT = {
						has_country_flag = lootbox_crisis.1015.e_used
					}
				}
			}	
		}
		custom_tooltip = lootbox_crisis.1015.e.tooltip
		owner = {
			set_country_flag = lootbox_crisis.1015.e_used
			add_modifier = {
				modifier = lootbox_factory_relocated_modifier
				days = 360
			}
			add_resource = {
				influence = -50
			}
		}	
	}

	option = { #do nothing
		name = {
			text = lootbox_crisis.1015.f
			trigger = {
				owner = {
					NOT = {
						has_country_flag = lootbox_crisis.1015.meme
					}
				}
			}
		} 
		name = {
			text = lootbox_crisis.1015.meme
			trigger = {
				owner = {
					has_country_flag = lootbox_crisis.1015.meme
				}
			}
		} 
		hidden_effect = {
			situation_event = {
				id = lootbox_crisis.1030
				days = 10
			}
		}
		if = {
			limit = {
				exists = event_target:lootbox_country
			}
			event_target:lootbox_country = {
				random_owned_ship = {
					limit = {
						has_ship_flag = lootbox_country_box_from_owner_id_@event_target:lootbox_owner
					}
					create_ambient_object = {
						type = consecrated_planet_stage_3_object
						location = this
						use_3d_location = yes
						entity_scale_to_size = yes
						duration = 10
						
					}
					last_created_ambient_object = {
						set_ambient_object_flag = lootbox_country_box_light_fx3_id_@event_target:lootbox_owner
					}
				}
			}
		}	
		if = {
			limit = {
				owner = {
					NOT = {
						has_country_flag = lootbox_crisis.1015.meme
					}
					
				}
			}
			custom_tooltip = lootbox_crisis.1015.f.tooltip
		}
		if = {
			limit = {
				owner = {
					has_country_flag = lootbox_crisis.1015.meme
				}
			}
			custom_tooltip = lootbox_crisis.1015.meme.tooltip
		}
		
	}
}

#Shifted
situation_event = {
	id = lootbox_crisis.1020
	title = lootbox_crisis.1020.title
	desc = lootbox_crisis.1020.desc
	picture = GFX_evt_deficit
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	situation = this
	trigger = {
		situation_progress <= 95
		owner = {
			NOT = {
				has_country_flag = lootbox_crisis_tick_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_1020_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_no_further_events
			}
		}
	}
	immediate = {
		set_situation_locked = yes
		owner = {
			set_country_flag = lootbox_crisis_random_event_in_active
			random_list = {
				1 = {
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = energy
					}
				}
				1 = {
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = minerals
					}
				}
				1 = {
					modifier = {
						factor = 0
						country_uses_food = no
					}
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = food
					}
				}
				1 = {
					modifier = {
						factor = 0
						country_uses_consumer_goods = no
					}
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = consumer_goods
					}
				}
				1 = {
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = alloys
					}
				}
				1 = {
					modifier = {
						factor = 0
						resource_stockpile_compare = {
							resource = exotic_gases
							value <= 10
						}
					}
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = exotic_gases
					}
				}
				1 = {
					modifier = {
						factor = 0
						resource_stockpile_compare = {
							resource = rare_crystals
							value <= 10
						}
					}
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = rare_crystals
					}
				}
				1 = {
					modifier = {
						factor = 0
						resource_stockpile_compare = {
							resource = volatile_motes
							value <= 10
						}
					}
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = volatile_motes
					}
				}
			}
		}
	}
	after = {
		set_situation_locked = no
		owner = {
			remove_country_flag = lootbox_crisis_random_event_in_active
			set_timed_country_flag = {
				flag = lootbox_crisis_random_event_cooldown
				days = 200
			}
			set_timed_country_flag = {
				flag = lootbox_crisis_random_event_1020_cooldown
				days = 360
			}
			effect_run_lootbox_shiftdrain_losses_modifiers = {
				RESOURCE = energy
			}
			effect_run_lootbox_shiftdrain_losses_modifiers = {
				RESOURCE = minerals
			}
			effect_run_lootbox_shiftdrain_losses_modifiers = {
				RESOURCE = food
			}
			effect_run_lootbox_shiftdrain_losses_modifiers = {
				RESOURCE = consumer_goods
			}
			effect_run_lootbox_shiftdrain_losses_modifiers = {
				RESOURCE = alloys
			}
			effect_run_lootbox_shiftdrain_losses_modifiers = {
				RESOURCE = exotic_gases
			}
			effect_run_lootbox_shiftdrain_losses_modifiers = {
				RESOURCE = rare_crystals
			}
			effect_run_lootbox_shiftdrain_losses_modifiers = {
				RESOURCE = volatile_motes
			}
		}	
	}
	option = {
		name = CURSES
	}
}

#oppounity
situation_event = {
	id = lootbox_crisis.1025
	title = lootbox_crisis.1025.title
	desc = lootbox_crisis.1025.desc
	picture = GFX_lootbox_event_picture
	show_sound = event_administrative_work
	is_triggered_only = yes
	situation = this
	trigger = {
		situation_progress >= 10
		situation_progress <= 95
		owner = {
			NOT = {
				has_country_flag = lootbox_crisis_tick_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_has_reverse_shift
			}
			NOT = {
				has_country_flag = lootbox_crisis_no_further_events
			}
		}
	}
	immediate = {
		set_situation_locked = yes
		owner = {
			set_country_flag = lootbox_crisis_random_event_in_active
			random_list = {
				1 = {
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = energy
					}
				}
				1 = {
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = minerals
					}
				}
				1 = {
					modifier = {
						factor = 0
						country_uses_food = no
					}
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = food
					}
				}
				1 = {
					modifier = {
						factor = 0
						country_uses_consumer_goods = no
					}
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = consumer_goods
					}
				}
				1 = {
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = alloys
					}
				}
				1 = {
					modifier = {
						factor = 0
						resource_stockpile_compare = {
							resource = exotic_gases
							value <= 10
						}
					}
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = exotic_gases
					}
				}
				1 = {
					modifier = {
						factor = 0
						resource_stockpile_compare = {
							resource = rare_crystals
							value <= 10
						}
					}
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = rare_crystals
					}
				}
				1 = {
					modifier = {
						factor = 0
						resource_stockpile_compare = {
							resource = volatile_motes
							value <= 10
						}
					}
					effect_run_lootbox_shiftdrain_tier_one_resource = {
						RESOURCE = volatile_motes
					}
				}
			}
		}
	}
	after = {
		set_situation_locked = no
		owner = {
			remove_country_flag = lootbox_crisis_random_event_in_active
			set_timed_country_flag = {
				flag = lootbox_crisis_random_event_cooldown
				days = 200
			}
			set_timed_country_flag = {
				flag = lootbox_crisis_has_reverse_shift
				days = 360
			}
			effect_run_lootbox_shiftdrain_gain_modifiers = {
				RESOURCE = energy
			}
			effect_run_lootbox_shiftdrain_gain_modifiers = {
				RESOURCE = minerals
			}
			effect_run_lootbox_shiftdrain_gain_modifiers = {
				RESOURCE = food
			}
			effect_run_lootbox_shiftdrain_gain_modifiers = {
				RESOURCE = consumer_goods
			}
			effect_run_lootbox_shiftdrain_gain_modifiers = {
				RESOURCE = alloys
			}
			effect_run_lootbox_shiftdrain_gain_modifiers = {
				RESOURCE = exotic_gases
			}
			effect_run_lootbox_shiftdrain_gain_modifiers = {
				RESOURCE = rare_crystals
			}
			effect_run_lootbox_shiftdrain_gain_modifiers = {
				RESOURCE = volatile_motes
			}
		}	
	}
	option = {
		name = GOOD
	}
}

#CRITICAL
situation_event = {
	id = lootbox_crisis.1030
	title = lootbox_crisis.1030.title
	desc = {
		trigger = {
			success_text = {
				text = lootbox_crisis.1030.desc
			}
			success_text = {
				text = newline
			}
			success_text = {
				text = lootbox_crisis.1030.desc1
				owner = {
					has_country_flag = lootbox_crisis.1030.1
				}
			}
			success_text = {
				text = lootbox_crisis.1030.desc2
				owner = {
					has_country_flag = lootbox_crisis.1030.2
				}
			}
			success_text = {
				text = lootbox_crisis.1030.desc3
				owner = {
					has_country_flag = lootbox_crisis.1030.3
				}
			}
			success_text = {
				text = lootbox_crisis.1030.desc4
				owner = {
					has_country_flag = lootbox_crisis.1030.4
				}
			}
			success_text = {
				text = lootbox_crisis.1030.desc5
				owner = {
					has_country_flag = lootbox_crisis.1030.5
				}
			}
			success_text = {
				text = lootbox_crisis.1030.desc6
				owner = {
					has_country_flag = lootbox_crisis.1030.6
				}
			}
			success_text = {
				text = lootbox_crisis.1030.desc7
				owner = {
					has_country_flag = lootbox_crisis.1030.7
				}
			}
			success_text = {
				text = lootbox_crisis.1030.desc8
				owner = {
					has_country_flag = lootbox_crisis.1030.8
				}
			}
			success_text = {
				text = lootbox_crisis.1030.desc9
				owner = {
					has_country_flag = lootbox_crisis.1030.9
				}
			}
		}
	} 
	picture = GFX_evt_supernova
	show_sound = event_ship_explosion
	is_triggered_only = yes
	location = event_target:lootbox_location
	situation = this
	trigger = {
	}
	immediate = {
		owner = {
			save_event_target_as = lootbox_owner
			set_timed_country_flag = {
				flag = lootbox_crisis_random_event_cooldown
				days = 200
			}
			random_owned_planet = { #default location
				limit = {
					is_capital = yes
				}
				save_event_target_as = lootbox_location
			}
			random_list = {
				1 = { #Say bye-bye to your districts!
					modifier = {
						factor = 0
						has_country_flag = lootbox_crisis.1030.1_recently
					}
					modifier = {
						factor = 0
						any_owned_planet = {
							is_under_colonization = yes
						}
					}
					set_country_flag = lootbox_crisis.1030.1
					set_timed_country_flag = {
						flag = lootbox_crisis.1030.1_recently
						days = 720
					} 
					random_owned_planet = {
						limit = {
							is_under_colonization = no
						}
						remove_all_districts = yes 
						save_event_target_as = lootbox_location
					}
				}
				
				1 = { #Arrr, pirates
					modifier = {
						factor = 0
						has_country_flag = lootbox_crisis.1030.2_recently
					}
					set_country_flag = lootbox_crisis.1030.2
					set_timed_country_flag = {
						flag = lootbox_crisis.1030.2_recently
						days = 720
					} 
					set_variable = {
						which = lootbox_country_owned_starbases
						value = trigger:num_starbases
					}
					divide_variable = {
						which = lootbox_country_owned_starbases
						value = 2
					}
					round_variable = lootbox_country_owned_starbases
					change_variable = {
						which = lootbox_country_owned_starbases
						value = 1
					}
					random_system_within_border = {
						save_event_target_as = pirate_system
						create_normal_pirate_country = yes
					}
					while = {
						count = lootbox_country_owned_starbases
						random_system_within_border = {
							save_event_target_as = pirate_system
							random_system_planet = {
								save_event_target_as = pirate_home
							}
							create_pirate_fleet = yes
						}
					}
				}

				1 = { #mining station goes kaboom
					modifier = {
						factor = 0
						has_country_flag = lootbox_crisis.1030.3_recently
					}
					set_country_flag = lootbox_crisis.1030.3
					set_timed_country_flag = {
						flag = lootbox_crisis.1030.3_recently
						days = 720
					} 
					set_variable = {
						which = lootbox_country_loss_ship_num
						value = 0
					}
					every_owned_ship = {
						limit = {
							is_ship_class = shipclass_mining_station
						}
						random_list = {
							1 = {}
							1 = {
								destroy_ship = this
								owner = {
									change_variable = {
										which = lootbox_country_loss_ship_num
										value = 1
									}
								}
							}
						}
						
					}	
				}

				1 = { #unemployeed rising
					modifier = {
						factor = 0
						has_country_flag = lootbox_crisis.1030.4_recently
					}
					set_country_flag = lootbox_crisis.1030.4
					add_modifier = {
						modifier = lootbox_unemployeed_modifier
						days = 1800
					}
					set_timed_country_flag = {
						flag = lootbox_crisis.1030.4_recently
						days = 1800
					} 
				}

				1 = { #missing ships
					modifier = {
						factor = 0
						has_country_flag = lootbox_crisis.1030.5_recently
					}
					set_country_flag = lootbox_crisis.1030.5
					set_timed_country_flag = {
						flag = lootbox_crisis.1030.5_recently
						days = 720
					} 
					set_variable = {
						which = lootbox_country_loss_ship_num
						value = 0
					}
					every_owned_ship = {
						limit = {
							is_ship_class = shipclass_military
							NOR = {
								is_ship_size = juggernaut
								is_ship_size = colossus
							}
						}
						random_list = {
							1 = {}
							1 = {
								destroy_ship = this
								owner = {
									change_variable = {
										which = lootbox_country_loss_ship_num
										value = 1
									}
								}
							}
						}
						
					}		
				}
				1 = { #literally one of your resources are gone
					modifier = {
						factor = 0
						has_country_flag = lootbox_crisis.1030.6_recently
					}
					set_country_flag = lootbox_crisis.1030.6
					set_timed_country_flag = {
						flag = lootbox_crisis.1030.6_recently
						days = 720
					} 
					random_list = {
						1 = {
							add_resource = {
								energy = -9999999999999
							}
						}
						1 = {
							add_resource = {
								minerals = -9999999999999
							}
						}
						1 = {
							add_resource = {
								food = -9999999999999
							}
						}
						1 = {
							add_resource = {
								consumer_goods = -9999999999999
							}
						}
						1 = {
							add_resource = {
								alloys = -9999999999999
							}
						}
						1 = {
							add_resource = {
								exotic_gases = -9999999999999
							}
						}
						1 = {
							add_resource = {
								rare_crystals = -9999999999999
							}
						}
						1 = {
							add_resource = {
								volatile_motes = -9999999999999
							}
						}
					}
					
				}
				1 = { #planet ruined
					modifier = {
						factor = 0
						has_country_flag = lootbox_crisis.1030.7_recently
					}
					set_country_flag = lootbox_crisis.1030.7
					set_timed_country_flag = {
						flag = lootbox_crisis.1030.7_recently
						days = 720
					} 
					set_variable = {
						which = lootbox_country_loss_pop_num
						value = 0
					}
					random_owned_planet = {
						limit = {
							is_under_colonization = no
						}
						save_event_target_as = lootbox_location
						add_planet_devastation = 50
						while = {
							count = 8
							ruin_building = random_no_capital
							if = {
								limit = {
									num_pops > 1
								}
								random_owned_pop = {
									kill_pop = yes
								}
								owner = {
									change_variable = {
										which = lootbox_country_loss_pop_num
										value = 1
									}
								}
							}
							
						}	
					}
				}
				1 = { #building is ruined
					modifier = {
						factor = 0
						has_country_flag = lootbox_crisis.1030.8_recently
					}
					set_country_flag = lootbox_crisis.1030.8
					set_timed_country_flag = {
						flag = lootbox_crisis.1030.8_recently
						days = 720
					} 
					random_owned_planet = {
						save_event_target_as = lootbox_location
						while = {
							count = 10
							ruin_building = random_no_capital 
						}			
					}
				}
				1 = { #pop is gone
					modifier = {
						factor = 0
						has_country_flag = lootbox_crisis.1030.9_recently
					}
					modifier = {
						factor = 0
						num_pops <= 2
					}
					set_country_flag = lootbox_crisis.1030.9
					set_timed_country_flag = {
						flag = lootbox_crisis.1030.9_recently
						days = 720
					} 
					random_owned_pop = {
						kill_pop = yes
					}
					set_variable = {
						which = lootbox_country_loss_pop_num
						value = 1
					}			
					while = {
						count = 20
						limit = {
							num_pops > 1 
						}
						random_list = {
							8 = {}
							2 = {
								random_owned_pop = {
									kill_pop = yes
								}
								owner = {
									change_variable = {
										which = lootbox_country_loss_pop_num
										value = 1
									}
								}
							}
						}
					}
					
				}
			}
			#make explosion cuz its pretty
			every_planet_within_border = {
				limit = { is_star = yes }
				create_ambient_object = {
					type = "star_explosion"
					play_animation_once = yes
					location = this
					duration = 180
				}
				last_created_ambient_object = {
					set_location = {
						target = prev
						distance = 0
						angle = random
					}
				}
			}
			#If ship also presents
			if = {
				limit = {
					exists = event_target:lootbox_country
				}
				event_target:lootbox_country = {
					random_owned_ship = {
						limit = {
							has_ship_flag = lootbox_country_box_from_owner_id_@event_target:lootbox_owner
						}
						create_ambient_object = {
							type = "star_explosion"
							play_animation_once = yes
							location = this
							duration = 180
						}
						last_created_ambient_object = {
							set_location = {
								target = prev
								distance = 0
								angle = random
							}
						}	
					}
					every_ambient_object = {
						limit = {
							has_ambient_object_flag = lootbox_country_box_light_fx3_id_@event_target:lootbox_owner
						}
						destroy_ambient_object = this
					}
				}
			}
		}
	}
	after = {
		owner = {		
			hidden_effect = {
				remove_country_flag = lootbox_crisis.1030.1
				remove_country_flag = lootbox_crisis.1030.2
				remove_country_flag = lootbox_crisis.1030.3
				remove_country_flag = lootbox_crisis.1030.4
				remove_country_flag = lootbox_crisis.1030.5
				remove_country_flag = lootbox_crisis.1030.6
				remove_country_flag = lootbox_crisis.1030.7
				remove_country_flag = lootbox_crisis.1030.8
				remove_country_flag = lootbox_crisis.1030.9
				clear_variable = lootbox_country_loss_pop_num
				clear_variable = lootbox_country_loss_ship_num
			}
		}	
	}
	option = {
		name = {
			text = CURSES
			trigger = {
				owner = {
					is_megacorp = no
				}
			}
		} 
		name = {
			text = lootbox_crisis.1030.b
			trigger = {
				owner = {
					is_megacorp = yes
				}
			}
		} 
		owner = {
			if = {
				limit = {
					has_country_flag = lootbox_crisis.1030.1
				}
				custom_tooltip = lootbox_crisis.1030.desc1.tooltip
			}
			if = {
				limit = {
					has_country_flag = lootbox_crisis.1030.4
				}
				tooltip = {
					add_modifier = {
						modifier = lootbox_unemployeed_modifier
						days = 1800
					}
				}
			}
			if = {
				limit = {
					has_country_flag = lootbox_crisis.1030.6
				}
				custom_tooltip = lootbox_crisis.1030.loss_resource.tooltip
			}
			if = {
				limit = {
					check_variable = {
						which = lootbox_country_loss_pop_num
						value >= 1
					}
				}
				custom_tooltip = lootbox_crisis.1030.losspop.tooltip
			}
			if = {
				limit = {
					check_variable = {
						which = lootbox_country_loss_ship_num
						value >= 1
					}
				}
				if = {
					limit = {
						has_country_flag = lootbox_crisis.1030.5
					}
					custom_tooltip = lootbox_crisis.1030.lossship.tooltip
				}
				if = {
					limit = {
						has_country_flag = lootbox_crisis.1030.3
					}
					custom_tooltip = lootbox_crisis.1030.miningstation.tooltip
				}	
			}
		}
	}
}

#Pirates
situation_event = {
	id = lootbox_crisis.1035
	title = lootbox_crisis.1035.title
	desc = lootbox_crisis.1035.desc
	picture = GFX_evt_pirates_attacking_cargo
	show_sound = event_space_battle
	is_triggered_only = yes
	situation = this
	trigger = {
		owner = {
			NOT = {
				has_country_flag = lootbox_crisis_tick_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_1035_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_no_further_events
			}
		}
	}
	immediate = {
		owner = {
			set_timed_country_flag = {
				flag = lootbox_crisis_random_event_1035_cooldown
				days = 720
			}
			set_variable = {
				which = lootbox_country_owned_starbases
				value = trigger:num_starbases
			}
			divide_variable = {
				which = lootbox_country_owned_starbases
				value = 8
			}
			round_variable = lootbox_country_owned_starbases
			change_variable = {
				which = lootbox_country_owned_starbases
				value = 1
			}
			random_system_within_border = {
				save_event_target_as = pirate_system
				create_normal_pirate_country = yes
			}
			while = {
				count = lootbox_country_owned_starbases
				random_system_within_border = {
					save_event_target_as = pirate_system
					random_system_planet = {
						save_event_target_as = pirate_home
					}
					create_pirate_fleet = yes
				}
			}
			set_country_flag = lootbox_crisis_random_event_in_active

		}
	}
	after = {
		owner = {
			remove_country_flag = lootbox_crisis_random_event_in_active
		}	
	}
	option = {
		name = lootbox_crisis.1035.a
	}
}

#Pirate party
situation_event = {
	id = lootbox_crisis.1040
	title = lootbox_crisis.1040.title
	desc = lootbox_crisis.1040.desc
	picture = GFX_evt_pirates_attacking_cargo
	show_sound = event_space_battle
	is_triggered_only = yes
	situation = this
	location = event_target:pirate_system
	trigger = {
		owner = {
			NOT = {
				has_country_flag = lootbox_crisis_tick_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_1035_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_no_further_events
			}
		}
	}
	immediate = {
		set_situation_locked = yes
		owner = {
			save_event_target_as = lootbox_owner
		}
		if = {
			limit = {
				exists = event_target:lootbox_country
			}
			event_target:lootbox_country = {
				random_owned_ship = {
					limit = {
						has_ship_flag = lootbox_country_box_from_owner_id_@event_target:lootbox_owner
					}
					solar_system = {
						save_event_target_as = pirate_system
					}	
				}
			}
		}
		else = {
			owner = {
				random_system_within_border = {
					save_event_target_as = pirate_system
				}
			}
		}
		owner = {
			set_timed_country_flag = {
				flag = lootbox_crisis_random_event_1035_cooldown
				days = 720
			}
			event_target:pirate_system = {
				create_normal_pirate_country = yes
				while = {
					count = 1
					create_pirate_fleet = yes
				}
				while = {
					count = root.owner.trigger:num_starbases
					create_pirate_fleet = yes
				}
				create_normal_pirate_country = yes
				while = {
					count = 1
					create_pirate_fleet = yes
				}
				while = {
					count = root.owner.trigger:num_starbases
					create_pirate_fleet = yes
				}
			}
			set_country_flag = lootbox_crisis_random_event_in_active
		}
	}
	after = {
		set_situation_locked = no
		owner = {
			remove_country_flag = lootbox_crisis_random_event_in_active
		}	
	}
	option = {
		name = lootbox_crisis.1035.a
	}
}

#Swapped resources gateway
situation_event = {
	id = lootbox_crisis.1045
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		situation_progress >= 10
		situation_progress <= 95
		owner = {
			NOT = {
				has_country_flag = lootbox_crisis_tick_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_1045_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_no_further_events
			}
			any_playable_country = {
				NOT = {
					is_same_empire = root.owner
				}
				country_has_situation = {
					SITUATION = lootbox_situation
				}
				NOR = {
					has_country_flag = lootbox_crisis_no_further_events
					has_country_flag = lootbox_crisis_random_event_1045_cooldown
				}
			}
		}
	}
	immediate = {
		owner = {
			country_event = {
				id = lootbox_crisis.1046
			}
		}
	}
}

#Let's swap
country_event = {
	id = lootbox_crisis.1046
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		set_timed_country_flag = {
			flag = lootbox_crisis_random_event_1045_cooldown
			days = 720
		}
		save_event_target_as = swapped_country_situation_owner
		set_variable = {
			which = lootbox_country_netgainloss_num
			value = 0
		}
		random_playable_country = {
			limit = {
				NOT = {
					is_same_empire = root
				}
				country_has_situation = {
					SITUATION = lootbox_situation
				}
				NOR = {
					has_country_flag = lootbox_crisis_no_further_events
					has_country_flag = lootbox_crisis_random_event_1045_cooldown
				}
			}
			set_timed_country_flag = {
				flag = lootbox_crisis_random_event_1045_cooldown
				days = 720
			}
			save_event_target_as = swapped_country_situation_victim
			set_variable = {
				which = lootbox_country_netgainloss_num
				value = 0
			}
		}
		random_list = {
			9 = { #single one
				random_list = {
					1 = {
						effect_run_lootbox_swap_country_resource = {
							RESOURCE = energy
						}
					}
					1 = {
						effect_run_lootbox_swap_country_resource = {
							RESOURCE = minerals
						}
					}
					1 = {
						modifier = {
							factor = 0
							resource_stockpile_compare = {
								resource = food
								value <= 1
							}
						}
						effect_run_lootbox_swap_country_resource = {
							RESOURCE = food
						}
					}
					1 = {
						modifier = {
							factor = 0
							resource_stockpile_compare = {
								resource = consumer_goods
								value <= 1
							}
						}
						effect_run_lootbox_swap_country_resource = {
							RESOURCE = consumer_goods
						}
					}
					1 = {
						effect_run_lootbox_swap_country_resource = {
							RESOURCE = alloys
						}
					}
					1 = {
						modifier = {
							factor = 0
							resource_stockpile_compare = {
								resource = exotic_gases
								value <= 1
							}
						}
						effect_run_lootbox_swap_country_resource = {
							RESOURCE = exotic_gases
						}
					}
					1 = {
						modifier = {
							factor = 0
							resource_stockpile_compare = {
								resource = rare_crystals
								value <= 1
							}
						}
						effect_run_lootbox_swap_country_resource = {
							RESOURCE = rare_crystals
						}
					}
					1 = {
						modifier = {
							factor = 0
							resource_stockpile_compare = {
								resource = volatile_motes
								value <= 1
							}
						}
						effect_run_lootbox_swap_country_resource = {
							RESOURCE = volatile_motes
						}
					}
				}
				country_event = {
					id = lootbox_crisis.1047
				}
				event_target:swapped_country_situation_victim = {
					country_event = {
						id = lootbox_crisis.1047
					}
				}
			}
			1 = { #Swap all of them
				effect_run_lootbox_swap_country_resource = {
					RESOURCE = energy
				}
				effect_run_lootbox_swap_country_resource = {
					RESOURCE = minerals
				}
				effect_run_lootbox_swap_country_resource = {
					RESOURCE = food
				}
				effect_run_lootbox_swap_country_resource = {
					RESOURCE = consumer_goods
				}
				effect_run_lootbox_swap_country_resource = {
					RESOURCE = alloys
				}
				effect_run_lootbox_swap_country_resource = {
					RESOURCE = exotic_gases
				}
				effect_run_lootbox_swap_country_resource = {
					RESOURCE = rare_crystals
				}
				effect_run_lootbox_swap_country_resource = {
					RESOURCE = volatile_motes
				}
				country_event = {
					id = lootbox_crisis.1050
				}
				event_target:swapped_country_situation_victim = {
					country_event = {
						id = lootbox_crisis.1050
					}
				}
			}
		}
		
		
	}
}

country_event = {
	id = lootbox_crisis.1047
	title = lootbox_crisis.1045.title
	desc = lootbox_crisis.1045.desc
	picture = GFX_lootbox_event_picture
	show_sound = event_spymaster
	is_triggered_only = yes
	after = {
		custom_tooltip = lootbox_crisis.1045.tooltip
		hidden_effect = {
			remove_country_flag = lootbox_crisis_swapped_energy
			remove_country_flag = lootbox_crisis_swapped_minerals
			remove_country_flag = lootbox_crisis_swapped_food
			remove_country_flag = lootbox_crisis_swapped_consumer_goods
			remove_country_flag = lootbox_crisis_swapped_alloys
			remove_country_flag = lootbox_crisis_swapped_exotic_gases
			remove_country_flag = lootbox_crisis_swapped_rare_crystals
			remove_country_flag = lootbox_crisis_swapped_volatile_motes
		}
		tooltip = {
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = energy
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = minerals
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = food
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = consumer_goods
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = alloys
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = exotic_gases
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = rare_crystals
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = volatile_motes
			}
		}
	}
	option = {
		trigger = {
			check_variable = {
				which = lootbox_country_netgainloss_num
				value < 1
			}
		}
		name = lootbox_crisis.1045.a
	}
	option = {
		trigger = {
			check_variable = {
				which = lootbox_country_netgainloss_num
				value >= 1
			}
		}
		name = CURSES
		
	}
}

#Full swapped
country_event = {
	id = lootbox_crisis.1050
	title = lootbox_crisis.1050.title
	desc = lootbox_crisis.1050.desc
	picture = GFX_lootbox_event_picture
	show_sound = event_spymaster
	is_triggered_only = yes
	after = {
		custom_tooltip = lootbox_crisis.1045.tooltip
		hidden_effect = {
			remove_country_flag = lootbox_crisis_swapped_energy
			remove_country_flag = lootbox_crisis_swapped_minerals
			remove_country_flag = lootbox_crisis_swapped_food
			remove_country_flag = lootbox_crisis_swapped_consumer_goods
			remove_country_flag = lootbox_crisis_swapped_alloys
			remove_country_flag = lootbox_crisis_swapped_exotic_gases
			remove_country_flag = lootbox_crisis_swapped_rare_crystals
			remove_country_flag = lootbox_crisis_swapped_volatile_motes
		}
		tooltip = {
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = energy
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = minerals
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = food
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = consumer_goods
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = alloys
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = exotic_gases
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = rare_crystals
			}
			effect_run_lootbox_show_swapped_resource_num = {
				RESOURCE = volatile_motes
			}
		}
	}
	option = {
		trigger = {
			check_variable = {
				which = lootbox_country_netgainloss_num
				value < 1
			}
		}
		name = lootbox_crisis.1045.a
	}
	option = {
		trigger = {
			check_variable = {
				which = lootbox_country_netgainloss_num
				value >= 1
			}
		}
		name = CURSES
	}
}

#Time Bomb appears! Nemesis DLC only and only once
#Only before phase III
situation_event = {
	id = lootbox_crisis.1055
	title = lootbox_crisis.1055.title
	desc = {
		trigger = {
			success_text = {
				text = lootbox_crisis.1055.desc
			}
			success_text = {
				text = newline
			}
			success_text = {
				text = lootbox_crisis.1055_owner
			}
		}
	}
	is_triggered_only = yes
	picture = GFX_evt_ship_in_orbit_3
	show_sound = event_red_alert
	location = event_target:lootbox_location
	situation = this
	trigger = {
		host_has_dlc = Nemesis
		situation_progress >= 10
		situation_progress <= 65
		owner = {
			NOT = {
				has_country_flag = lootbox_crisis_owned_a_time_bomb
			}
			NOT = {
				has_country_flag = lootbox_crisis_tick_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_no_further_events
			}
		}
	}
	immediate = {
		owner = {
			set_timed_country_flag = {
				flag = lootbox_crisis_random_event_cooldown
				days = 240
			}
			set_country_flag = lootbox_crisis_owned_a_time_bomb
			random_system_within_border = {
				save_event_target_as = lootbox_location
			}
			save_event_target_as = lootbox_owner
			create_fleet = {
				effect = {
					set_owner = event_target:lootbox_owner
					create_ship = {
						name = random
						design = "NAME_lootbox_the_time_bomb"							
					}
					last_created_ship = {
						set_ship_flag = lootbox_time_bomb
						add_modifier = {
							modifier = lootbox_colossus_modifier
							days = -1
						}
						
					}
					set_fleet_stance = passive
					set_location = event_target:lootbox_location
				}		
				settings = {
					is_boss = yes
					can_disband = no
					can_upgrade = no
					can_change_composition = no	
					spawn_debris = no
					can_change_leader = no
					uses_naval_capacity = no
				}
			}
			last_created_fleet = {
				save_event_target_as = lootbox_time_bomb
			}
			start_situation = {
				type = lootbox_bomb_situation
				target = event_target:lootbox_time_bomb
			}
		}
	}
	after = {
		custom_tooltip = lootbox_crisis.1055.tooltip
	}
	option = {
		name = lootbox_crisis.1055.a
	}
	option = {
		name = lootbox_crisis.1055.b
		trigger = {
			owner = {
				is_at_war = yes
			}	
		}
	}
}

#Inform any noticer who spotted the bomb
# This = Country
# From = Fleet
country_event = {
	id = lootbox_crisis.1056
	title = lootbox_crisis.1055.title
	desc = lootbox_crisis.1055_other
	is_triggered_only = yes
	picture = GFX_evt_ship_in_orbit_3
	show_sound = event_red_alert
	location = from
	trigger = {
		NOT = {
			has_country_flag = lootbox_crisis_saw_time_bomb_from_owner_id_@from
		}
		from = {
			NOT = {
				is_owned_by = root
			}
			is_ship_size = star_eater
			any_owned_ship = {
				has_ship_flag = lootbox_time_bomb
			}
		}
	}
	immediate = {
		from = {
			owner = {
				save_event_target_as = lootbox_owner
			}
		}
		set_country_flag = lootbox_crisis_saw_time_bomb_from_owner_id_@from
	}
	option = {
		name = WORRYING
	}
}


#It exploded
country_event = {
	id = lootbox_crisis.1060
	title = lootbox_crisis.1060.title
	desc = lootbox_crisis.1060.desc
	is_triggered_only = yes
	picture = GFX_evt_supernova
	show_sound = event_super_explosion
	location = event_target:lootbox_location

	immediate = {
		save_event_target_as = lootbox_owner
		random_owned_ship = {
			limit = {
				is_ship_size = star_eater
				has_ship_flag = lootbox_time_bomb
			}
			solar_system = {
				save_event_target_as = lootbox_location
			}
			save_event_target_as = lootbox_bomb_location
			fleet = {
				dismantle = yes
			}
		}
		event_target:lootbox_bomb_location = {
			create_ambient_object = {
				type = "star_explosion"
				play_animation_once = yes
				location = this
				duration = 180
			}
			last_created_ambient_object = {
				set_location = {
					target = prev
					distance = 0
					angle = random
				}
			}
		}
		event_target:lootbox_location = {
			every_fleet_in_system = {
				every_owned_ship = {
					limit = {
						NOR = {
							has_ship_flag = lootbox_crisis_ship
							has_ship_flag = lootbox_time_bomb
						}
					}
					if = {
						limit = {
							OR = {
								is_ship_size = mining_station
								is_ship_size = research_station
							}
						}
						fleet = {
							dismantle = yes
						}
					}
					reduce_hp_percent = 90
					owner = {
						if = {
							limit = {
								NOR = {
									is_at_war_with = event_target:lootbox_owner
									is_same_empire = event_target:lootbox_owner
								}
							}
							add_opinion_modifier = {
								who = event_target:lootbox_owner
								modifier = opinion_lootbox_exploded_our_fleet
							}
						}
					}
				}
			}
			every_system_planet = {
				limit = {
					num_pops > 0
					is_colony = yes
				}
				if = {
					limit = {
						is_owned_by = event_target:lootbox_owner
					}
					owner = {
						set_country_flag = lootbox_crisis.1060.itself
					}
				}
				if = {
					limit = {
						NOT = {
							is_owned_by = event_target:lootbox_owner
						}
					}
					owner = {
						add_opinion_modifier = {
							who = event_target:lootbox_owner
							modifier = opinion_lootbox_exploded_our_planet
						}
						save_event_target_as = lootbox_bomb_victim
						event_target:lootbox_owner = {
							set_timed_country_flag = {
								flag = lootbox_crisis_time_bomb_user_at_@event_target:lootbox_bomb_victim
								days = 10800
							}
						}
						country_event = {
							id = lootbox_crisis.1065
						}
					}
				}	
				add_planet_devastation = 50
				remove_all_districts = yes
				remove_all_armies = yes
			}
		}
	}
	after = {
		remove_country_flag = lootbox_crisis.1060.itself
	}
	option = {
		name = CURSES
		trigger = {
			has_country_flag = lootbox_crisis.1060.itself
		}
	}
	option = {
		name = OK
		trigger = {
			NOT = {
				has_country_flag = lootbox_crisis.1060.itself
			}
		}
	}
}

# This = owner of ship 1 (combatant)
# From = owner of ship 2 (destroyed)
# FromFrom = ship 1
# FromFromFrom = ship 2
#It exploded, but by foreign forces
country_event = {
	id = lootbox_crisis.1061
	title = lootbox_crisis.1060.title
	desc = lootbox_crisis.1060.desc
	is_triggered_only = yes
	picture = GFX_evt_supernova
	show_sound = event_super_explosion
	location = event_target:lootbox_location

	trigger = {
		fromfromfrom = {
			is_ship_size = star_eater
			has_ship_flag = lootbox_time_bomb
		}
	}

	immediate = {
		from = {
			save_event_target_as = lootbox_owner
		}
		fromfromfrom = {
			save_event_target_as = lootbox_bomb_location
			solar_system = {
				save_event_target_as = lootbox_location
			}
		}
		event_target:lootbox_bomb_location = {
			create_ambient_object = {
				type = "star_explosion"
				play_animation_once = yes
				location = this
				duration = 180
			}
			last_created_ambient_object = {
				set_location = {
					target = prev
					distance = 0
					angle = random
				}
			}
		}
		event_target:lootbox_location = {
			every_fleet_in_system = {
				every_owned_ship = {
					limit = {
						NOR = {
							has_ship_flag = lootbox_crisis_ship
							has_ship_flag = lootbox_time_bomb
						}
					}
					reduce_hp_percent = 90
					if = {
						limit = {
							OR = {
								is_ship_size = mining_station
								is_ship_size = research_station
							}
						}
						fleet = {
							dismantle = yes
						}
					}
					owner = {
						if = {
							limit = {
								NOR = {
									is_at_war_with = event_target:lootbox_owner
									is_same_empire = event_target:lootbox_owner
								}
							}
							add_opinion_modifier = {
								who = event_target:lootbox_owner
								modifier = opinion_lootbox_exploded_our_fleet
							}
						}
					}
				}
			}
			every_system_planet = {
				limit = {
					num_pops > 0
					is_colony = yes
				}
				if = {
					limit = {
						is_owned_by = event_target:lootbox_owner
					}
					owner = {
						set_country_flag = lootbox_crisis.1060.itself
					}
				}
				if = {
					limit = {
						NOT = {
							is_owned_by = event_target:lootbox_owner
						}
					}
					owner = {
						add_opinion_modifier = {
							who = event_target:lootbox_owner
							modifier = opinion_lootbox_exploded_our_planet
						}
						save_event_target_as = lootbox_bomb_victim
						country_event = {
							id = lootbox_crisis.1065
						}
					}
					event_target:lootbox_owner = {
						set_timed_country_flag = {
							flag = lootbox_crisis_time_bomb_user_at_@event_target:lootbox_bomb_victim
							days = 10800
						}
					}
				}
				add_planet_devastation = 50
				remove_all_districts = yes
				remove_all_armies = yes
				
			}
		}
	}
	after = {
		remove_country_flag = lootbox_crisis.1060.itself
	}
	option = {
		name = CURSES
		trigger = {
			has_country_flag = lootbox_crisis.1060.itself
		}
	}
	option = {
		name = OK
		trigger = {
			NOT = {
				has_country_flag = lootbox_crisis.1060.itself
			}
		}
	}
}

#Inform exploded star system owner
country_event = {
	id = lootbox_crisis.1065
	title = lootbox_crisis.1065.title
	desc = lootbox_crisis.1065.desc
	is_triggered_only = yes
	picture = GFX_evt_supernova
	show_sound = event_super_explosion
	location = event_target:lootbox_location

	after = {
		hidden_effect = {
			set_timed_country_flag = {
				flag = lootbox_crisis_time_bomb_victim
				days = 10800
			}
			add_casus_belli = { 
				type = cb_revenge_for_time_bomb
				who = event_target:lootbox_owner
				days = 10800
			}
		}
	}
	option = {
		name = lootbox_crisis.1065.a
		custom_tooltip = lootbox_crisis.1065.tooltip
	}
}

#AI tries to get rid of the bomb
country_event = {
	id = lootbox_crisis.1066

	is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_ai = yes
		any_owned_ship = {
			is_ship_size = star_eater
			has_ship_flag = lootbox_time_bomb
		}
		NOT = {
			has_country_flag = lootbox_crisis_time_bomb_ai_moved
		}
	}
	immediate = {
		set_timed_country_flag = {
			flag = lootbox_crisis_time_bomb_ai_moved
			days = 180
		}
		random_galaxy_planet = {
			limit = {
				has_owner = no
			}
			save_event_target_as = lootbox_crisis_time_bomb_ai_target
		}
		if = {
			limit = {
				is_at_war = yes
			}
			random_playable_country = {
				limit = {
					is_at_war_with = root
					NOT = {
						is_same_empire = root
					}	
				}
				capital_scope = {
					save_event_target_as = lootbox_crisis_time_bomb_ai_target
				}
			}
		}
		random_controlled_ship = {
			limit = {
				is_ship_size = star_eater
				has_ship_flag = lootbox_time_bomb
			}
			auto_move_to_planet = {
				target = event_target:lootbox_crisis_time_bomb_ai_target
				clear_auto_move_on_arrival = yes
			}
		}

	}
}

#Evil Twins
situation_event = {
	id = lootbox_crisis.1070
	title = lootbox_crisis.1070.title
	desc = lootbox_crisis.1070.desc
	picture = GFX_evt_small_space_battle
	show_sound = event_space_battle
	is_triggered_only = yes
	location = event_target:lootbox_location
	situation = this
	trigger = {
		situation_progress <= 95
		owner = {
			NOT = {
				has_country_flag = lootbox_crisis_tick_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_evil_twin_happened
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_no_further_events
			}
		}
	}
	immediate = {
		if = {
			limit = {
				NOT = {
					exists = event_target:lootbox_country_hostile
				}
			}
			create_country = {
				name = "NAME_lootbox_country_hostile"
				type = lootbox_from_other_space_hostile
				flag = {
					icon = {
						category="corporate"
						file="corporate_08.dds"
					}
					background= {
						category="backgrounds"
						file="flag_BG_19.dds"
					}
					colors={
						"intense_red"
						"black"
						"null"
						"null"
					}
				}
			}
			last_created_country = {
				save_global_event_target_as = lootbox_country_hostile
				set_faction_hostility = {
					set_hostile = yes
					set_neutral = no
					set_friendly = no
				}
			}
		}
		event_target:lootbox_country_hostile = {
			establish_communications_no_message = root
		}
		owner = {
			set_country_flag = lootbox_crisis_evil_twin_happened
			set_timed_country_flag = {
				flag = lootbox_crisis_random_event_cooldown
				days = 240
			}
			set_variable = {
				which = lootbox_country_ship_num
				value = 100
			}
			change_variable = {
				which = lootbox_country_ship_num
				value = trigger:empire_size
			}
			divide_variable = {
				which = lootbox_country_ship_num
				value = 50
			}
			round_variable = lootbox_country_ship_num
			random_system_within_border = {
				save_event_target_as = lootbox_location
			}
			while = {
				count = lootbox_country_ship_num
				random_galaxy_planet = {
					save_event_target_as = lootbox_selected_location
				}
				create_fleet_from_naval_cap = 0.125
				last_created_fleet = {
					set_owner = event_target:lootbox_country_hostile
					set_location = event_target:lootbox_location
					set_fleet_flag = lootbox_crisis_rogue_ship
					queue_actions = {
						repeat = {
							find_closest_system = {
								trigger = {
									id = "lootbox_rogue_ship.1"
									#is_owned_by = from
									NOT = {
										has_star_flag = lootbox_rogue_ship_visit_recently
									}
									NOT = {
										any_fleet_in_system = {
											has_fleet_flag = lootbox_crisis_rogue_ship
										}
									}
								}
								
								found_system = {
									effect = {
										id = "lootbox_rogue_ship.1a"
										set_timed_star_flag = {
											flag = lootbox_rogue_ship_visit_recently
											days = 5
										}
									}
									move_to = THIS
									wait = {
										duration = 1
									}
									find_closest_planet = {
										trigger = {
											id = "lootbox_rogue_ship.2"
											NOT = {
												has_planet_flag = lootbox_rogue_ship_visit_recently
											}
										}
										found_planet = {
											effect = {
												id = "lootbox_rogue_ship.2a"
												set_timed_planet_flag = {
													flag = lootbox_rogue_ship_visit_recently
													days = 60
												}
											}
											move_to = THIS
											orbit_planet = THIS
											wait = {
												duration = 10
												random = 20
											}
										}
									}
								}
								failed = {
									find_random_planet = {
										found_planet = {
											move_to = THIS
											orbit_planet = THIS
											wait = {
												duration = 10
												random = 20
											}
										}
									}
								}
							}	
						}
					}
				}
				
			}
			
		}
	}
	after = {
	}
	option = {
		name = lootbox_crisis.1070.a
	}
}

#Treasure Titan, Apocalypse DLC only
situation_event = {
	id = lootbox_crisis.1075
	title = lootbox_crisis.1075.title
	desc = lootbox_crisis.1075.desc
	picture = GFX_evt_small_space_battle
	show_sound = event_ship_bridge
	is_triggered_only = yes
	location = event_target:lootbox_location
	situation = this
	trigger = {
		host_has_dlc = Apocalypse
		situation_progress <= 95
		owner = {
			NOT = {
				has_country_flag = lootbox_crisis_tick_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_treasure_happened
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_cooldown
			}
			NOT = {
				has_country_flag = lootbox_crisis_random_event_in_active
			}
			NOT = {
				has_country_flag = lootbox_crisis_no_further_events
			}
		}
	}
	immediate = {
		if = {
			limit = {
				NOT = {
					exists = event_target:lootbox_country_treasure
				}
			}
			create_country = {
				name = "NAME_lootbox_country_treasure"
				type = lootbox_from_other_space_treasure
				flag = {
					icon = {
						category="corporate"
						file="corporate_08.dds"
					}
					background= {
						category="backgrounds"
						file="flag_BG_19.dds"
					}
					colors={
						"intense_blue"
						"black"
						"null"
						"null"
					}
				}
			}
			last_created_country = {
				save_global_event_target_as = lootbox_country_treasure
				set_faction_hostility = {
					set_hostile = yes
					set_neutral = no
					set_friendly = no
				}
			}
		}
		owner = {
			set_country_flag = lootbox_crisis_treasure_happened
			set_country_flag = lootbox_crisis_treasure_spotted
			set_timed_country_flag = {
				flag = lootbox_crisis_random_event_cooldown
				days = 240
			}
			random_system_within_border = {
				save_event_target_as = lootbox_location
			}
		}
		event_target:lootbox_country_treasure = {
			establish_communications_no_message = root
			create_fleet = {
				effect = {
					set_owner = event_target:lootbox_country_treasure
					create_ship = {
						name = "NAME_lootbox_treasure"
						design = "NAME_lootbox_treasure"							
					}
					last_created_ship = {
						set_ship_flag = lootbox_treasure_ship
					}
					set_fleet_stance = passive
					set_location = event_target:lootbox_location
				}		
				settings = {
					is_boss = yes
					can_disband = no
					can_upgrade = no
					can_change_composition = no	
					spawn_debris = no
					can_change_leader = no
					uses_naval_capacity = no
				}
			}
			last_created_fleet = {
				add_modifier = {
					modifier = lootbox_treasure_titan_modifier
					days = -1
				}
				queue_actions = {
					repeat = {
						find_random_system = {
							trigger = {
								id = "lootbox_treasure_ship.1"
								#is_owned_by = from
								NOT = {
									has_star_flag = lootbox_treasure_ship_visit_recently
								}
								any_ship_in_system = {
									NOT = {
										has_ship_flag = lootbox_treasure_ship
									}
								}
							}
							
							found_system = {
								effect = {
									id = "lootbox_treasure_ship.1a"
									set_timed_star_flag = {
										flag = lootbox_treasure_ship_visit_recently
										days = 30
									}
								}
								move_to = THIS
								wait = {
									duration = 1
								}
								find_closest_planet = {
									trigger = {
										id = "lootbox_treasure_ship.2"
										NOT = {
											has_planet_flag = lootbox_treasure_ship_visit_recently
										}
									}
									found_planet = {
										effect = {
											id = "lootbox_treasure_ship.2a"
											set_timed_planet_flag = {
												flag = lootbox_treasure_ship_visit_recently
												days = 30
											}
										}
										move_to = THIS
										orbit_planet = THIS
										wait = {
											duration = 5
										}
									}
								}
							}
						}	
					}
				}
			}
		}
	}

	option = {
		name = INTERESTING
	}
}

# This = owner of ship 1 (combatant)
# From = owner of ship 2 (destroyed)
# FromFrom = ship 1
# FromFromFrom = ship 2
#It exploded, but by foreign forces
country_event = {
	id = lootbox_crisis.1076
	title = lootbox_crisis.1076.title
	desc = lootbox_crisis.1076.desc
	is_triggered_only = yes
	picture = GFX_evt_exploding_ship
	show_sound = event_ship_explosion
	location = event_target:lootbox_location

	trigger = {
		fromfromfrom = {
			is_ship_size = titan
			has_ship_flag = lootbox_treasure_ship
		}
	}

	immediate = {
		set_variable_to_random_value = {
			which = lootbox_treasure_value
			min = 2000
			max = 10000
			rounded = yes
		}
		set_variable_to_random_value = {
			which = lootbox_treasure_value2
			min = 1000
			max = 5000
			rounded = yes
		}
		set_variable_to_random_value = {
			which = lootbox_treasure_value3
			min = 50
			max = 1000
			rounded = yes
		}
		set_variable_to_random_value = {
			which = lootbox_treasure_value4
			min = 50
			max = 1000
			rounded = yes
		}
		set_variable_to_random_value = {
			which = lootbox_treasure_value5
			min = 50
			max = 1000
			rounded = yes
		}
		from = {
			save_event_target_as = lootbox_owner
		}
		fromfromfrom = {
			save_event_target_as = lootbox_treasure_location
			solar_system = {
				save_event_target_as = lootbox_location
			}
		}
		event_target:lootbox_treasure_location = {
			create_ambient_object = {
				type = "star_explosion"
				play_animation_once = yes
				location = this
				duration = 180
			}
			last_created_ambient_object = {
				set_location = {
					target = prev
					distance = 0
					angle = random
				}
			}
		}
		event_target:lootbox_location = {
			random_system_planet = { #always one
				limit = {
					is_colony = no
				}
				random_list = {
					10 = {
						add_deposit = d_exotic_gases_1
					}
					10 = {
						add_deposit = d_rare_crystals_1
					}
					10 = {
						add_deposit = d_volatile_motes_1
					}
					1 = {
						add_deposit = d_zro_deposit_1
					}
					1 = {
						add_deposit = d_dark_matter_deposit_1
					}
					1 = {
						add_deposit = d_living_metal_deposit
					}
				}
			}
			every_system_planet = {
				limit = {
					is_colony = no
				}
				random_list = {
					50 = {}
					5 = {
						add_deposit = d_exotic_gases_1
					}
					5 = {
						add_deposit = d_rare_crystals_1
					}
					5 = {
						add_deposit = d_volatile_motes_1
					}
					1 = {
						add_deposit = d_zro_deposit_1
					}
					1 = {
						add_deposit = d_dark_matter_deposit_1
					}
					1 = {
						add_deposit = d_living_metal_deposit
					}
				}
			}
		}
	}
	after = {
		add_resource = {
			energy = 2.75
			minerals = 2.5
			mult = lootbox_treasure_value
		}
		add_resource = {
			alloys = 1.5
			mult = lootbox_treasure_value2
		}
		add_resource = {
			exotic_gases = 1
			mult = lootbox_treasure_value3
		}
		add_resource = {
			rare_crystals = 1
			mult = lootbox_treasure_value4
		}
		add_resource = {
			volatile_motes = 1
			mult = lootbox_treasure_value5
		}
		hidden_effect = {
			clear_variable = lootbox_treasure_value
			clear_variable = lootbox_treasure_value2
			clear_variable = lootbox_treasure_value3
			clear_variable = lootbox_treasure_value4
			clear_variable = lootbox_treasure_value5
		}
	}
	option = {
		name = GOOD
		custom_tooltip = lootbox_crisis.1076.tooltip
	}
}

#Inform any noticer who spotted the treasure
# This = Country
# From = Fleet
country_event = {
	id = lootbox_crisis.1077
	title = lootbox_crisis.1075.title
	desc = lootbox_crisis.1077.desc
	is_triggered_only = yes
	picture = GFX_evt_ship_in_orbit_3
	show_sound = event_ship_bridge
	location = from
	trigger = {
		NOT = {
			has_country_flag = lootbox_crisis_treasure_spotted
		}
		from = {
			NOT = {
				is_owned_by = root
			}
			is_ship_size = titan
			any_owned_ship = {
				has_ship_flag = lootbox_treasure_ship
			}
		}
	}
	immediate = {
		set_country_flag = lootbox_crisis_treasure_spotted
	}
	option = {
		name = INTERESTING
	}
}