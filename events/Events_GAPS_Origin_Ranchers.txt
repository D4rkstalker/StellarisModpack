namespace = Events_GAPS_Ranchers

country_event = {
	id = Events_GAPS_Ranchers.1
	is_triggered_only = yes
	hide_window = yes
	
	trigger = { has_origin = Origin_GAPS_Ranchers }
	
	immediate = {
		country_event = { id = Events_GAPS_Ranchers.11 days = 360 }
		set_country_flag = Flag_I_Am_GAPS_Ranchers
		every_system_within_border = {
			set_star_flag = tiyanki_home_system
			random_system_planet = {
				planet_event = { id = Events_GAPS_Ranchers.2 days = 1 }
			}
		}
		save_event_target_as = TIYANKI_FRIENDSHIP_START
		save_event_target_as = Event_Target_System_Owner
		#T3
		add_research_option = tech_regenerative_hull_tissue
		#T1
		add_research_option = tech_space_whale_weapon_1
		every_country = {
			limit = { is_country_type = tiyanki }
			set_faction_hostility = {
				set_hostile = no
			#	set_neutral = yes
				set_friendly = yes
				target = event_target:TIYANKI_FRIENDSHIP_START
			}
		}
		every_country = {
			limit = { is_country_type = tiyanki_garrison }
			set_faction_hostility = {
				set_hostile = no
			#	set_neutral = yes
				set_friendly = yes
				target = event_target:TIYANKI_FRIENDSHIP_START
			}
		}
	}
}

country_event = {
	id = Events_GAPS_Ranchers.11
	is_triggered_only = yes
	hide_window = yes
	
	trigger = { has_origin = Origin_GAPS_Ranchers }
	
	immediate = {
		country_event = { id = Events_GAPS_Ranchers.1 days = 1800 }
		set_variable = { which = "GAPS_Max_Number_Of_Rancher_Fleets" value = 0 }
		every_system_within_border = {
			limit = { 
				exists = starbase 
				OR = {
					starbase = { has_starbase_building = Starbase_Building_GAPS_Corralling_Station }
					starbase = { has_starbase_building = Starbase_Building_GAPS_Birthing_Facility }
					has_star_flag = tiyanki_home_system 
					has_star_flag = tiyanki_spawn_system 
					has_star_flag = elderly_tiyanki_system
				}
			}
			root = { change_variable = { which = "GAPS_Max_Number_Of_Rancher_Fleets" value = 1 } }
		}
		if = { 
			limit = { check_variable = { which = "GAPS_Number_Of_Rancher_Fleets" value < GAPS_Max_Number_Of_Rancher_Fleets } }
			every_system_within_border = {
				limit = { exists = starbase starbase = { has_starbase_building = Starbase_Building_GAPS_Corralling_Station } }
				random_list = {
					10 = {
						if = { 
							limit = { root = { check_variable = { which = "GAPS_Number_Of_Rancher_Fleets" value < GAPS_Max_Number_Of_Rancher_Fleets } } }
							random_system_planet = { planet_event = { id = Events_GAPS_Ranchers.2 days = 1 } }
							root = {						
								change_variable = { which = "GAPS_Number_Of_Rancher_Fleets" value = 1 }
							}
						}
					}
					90 = {
						#nothing happens
					}
				}
			}
			every_system_within_border = {
				limit = { exists = starbase starbase = { has_starbase_building = Starbase_Building_GAPS_Birthing_Facility } }
				random_list = {
					30 = {
						if = { 
							limit = { root = { check_variable = { which = "GAPS_Number_Of_Rancher_Fleets" value < GAPS_Max_Number_Of_Rancher_Fleets } } }
							random_system_planet = { planet_event = { id = Events_GAPS_Ranchers.2 days = 1 } }
							root = {						
								change_variable = { which = "GAPS_Number_Of_Rancher_Fleets" value = 1 }
							}
						}
					}
					70 = {
						#nothing happens
					}
				}
			}
			every_system_within_border = {
				limit = { OR = { has_star_flag = tiyanki_home_system has_star_flag = tiyanki_spawn_system has_star_flag = elderly_tiyanki_system } }
				random_list = {
					20 = {
						if = { 
							limit = { root = { check_variable = { which = "GAPS_Number_Of_Rancher_Fleets" value < GAPS_Max_Number_Of_Rancher_Fleets } } }
							random_system_planet = { planet_event = { id = Events_GAPS_Ranchers.2 days = 1 } }
							root = {						
								change_variable = { which = "GAPS_Number_Of_Rancher_Fleets" value = 1 }
							}
						}
					}
					80 = {
						#nothing happens
					}
				}
			}
		}
	}
}
country_event = {
	id = Events_GAPS_Ranchers.111
	is_triggered_only = yes
	hide_window = yes
	
	trigger = { has_origin = Origin_GAPS_Ranchers not = { has_country_flag = Flag_I_Am_GAPS_Ranchers }
	
	immediate = {
		country_event = { id = Events_GAPS_Ranchers.1 days = 1800 }
		set_country_flag = Flag_I_Am_GAPS_Ranchers
	}
}
# This = owner of fleet 1 (destroyed)
# From = owner of fleet 2 (combatant)
# FromFrom = fleet 1
# FromFromFrom = fleet 2
country_event = {
	id = Events_GAPS_Ranchers.1111
	is_triggered_only = yes
	hide_window = yes
	
	trigger = { FromFrom = { has_fleet_flag = Flag_Fleet_GAPS_Tiyanki_Rancher_Spawn } }
	
	immediate = {
		fromfrom = { solar_system = { owner = { subtract_variable = { which = "GAPS_Number_Of_Rancher_Fleets" value = 1 } } } }
	}
}
planet_event = {
	id = Events_GAPS_Ranchers.2
	is_triggered_only = yes
	hide_window = yes
	
	trigger = { solar_system.owner = { has_origin = Origin_GAPS_Ranchers } }
	
	immediate = {
		solar_system.owner = { save_event_target_as = Event_Target_System_Owner }
		save_event_target_as = giant
		random_list = {
			10 = { create_tiyanki_fleet_1 = yes }
			10 = { create_tiyanki_fleet_2 = yes }
			10 = { create_tiyanki_fleet_3 = yes }
			10 = { create_tiyanki_fleet_4 = yes }
			10 = { create_tiyanki_fleet_5 = yes }
		}
		if = {
			limit = { solar_system = { exists = starbase starbase = { has_starbase_building = Starbase_Building_GAPS_Birthing_Facility } } }
			last_created_fleet = {
				add_modifier = { modifier = ship_modifier_GAPS_Born_At_Birthing_Facility	days = -1 }
			}
			if = {
				limit = { solar_system = { OR = { has_star_flag = tiyanki_home_system has_star_flag = tiyanki_spawn_system has_star_flag = elderly_tiyanki_system } } }
				last_created_fleet = {
					add_modifier = { modifier = ship_modifier_GAPS_Born_At_Birthing_Facility	days = -1 }
				}
			}
		}
		if = {
			limit = { solar_system = { exists = starbase starbase = { has_starbase_building = Starbase_Building_GAPS_Medical_Crew } } }
			last_created_fleet = {
				add_modifier = { modifier = ship_modifier_GAPS_Healing_At_Medical_Crew	days = -1 }
			}
		}
		last_created_fleet = { 
			#clear_order = yes
			set_fleet_flag = Flag_Fleet_GAPS_Tiyanki_Rancher_Spawn
			queue_actions = {
				repeat = {
					find_random_system = {
						trigger = {
							id = gwen.whale.system.find.0
							owner = { is_same_value = event_target:Event_Target_System_Owner }
							starbase = { has_starbase_building = Starbase_Building_GAPS_Corralling_Station }
						}
						found_system = {
							move_to = this
						}
					}
					repeat = {
						max_iterations = 1
						find_random_planet = {
							trigger = {
								id = gwen.whale.planet.find.0
								OR = {
									is_colony = yes
									is_planet_class = pc_gas_giant
								}
							}
							found_planet = {
								orbit_planet = this
								wait = {
									#duration = 5
									#random = 0
									duration = 320
									random = 80
								}
							}
						}
					}
				}
			}
		}
	}
}

#

#
# A fleet has entered a system
# Scope = Fleet
# From = System
################
# MODIFIER
################
fleet_event = {
	id = Events_GAPS_Ranchers.3
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		owner = { OR = { is_country_type = tiyanki is_country_type = tiyanki_garrison is_country_type = guardian_elderly_tiyanki }  }
	}
	
	immediate = {
		remove_modifier = ship_modifier_GAPS_Healing_At_Medical_Crew
		if = {
			limit = { 
				owner = { OR = { is_country_type = tiyanki is_country_type = tiyanki_garrison is_country_type = guardian_elderly_tiyanki }  }
				from = { 
					exists = starbase
					starbase = { has_starbase_building = Starbase_Building_GAPS_Medical_Crew }
				} 
			}
			add_modifier = { modifier = ship_modifier_GAPS_Healing_At_Medical_Crew	days = -1 }
		}
	}
}
planet_event = {
	id = Events_GAPS_Ranchers.31
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		solar_system  {
			every_fleet_in_system = {
				limit = { owner = { OR = { is_country_type = tiyanki is_country_type = tiyanki_garrison is_country_type = guardian_elderly_tiyanki }  } }
				remove_modifier = ship_modifier_GAPS_Healing_At_Medical_Crew
				add_modifier = { modifier = ship_modifier_GAPS_Healing_At_Medical_Crew	days = -1 }
			}
		}
	}
}
#Tech_GAPS_Tiyanki_Caretaking_Methods
country_event = {
	id = Events_GAPS_Ranchers.4
	title = Events_GAPS_Ranchers.4.name
	desc = Events_GAPS_Ranchers.4.desc
	picture = GFX_evt_unidentified_ship
	show_sound = megastructure_upgraded_01
	hide_window = no
	is_triggered_only = yes

	trigger = {
		this = { has_origin = Origin_GAPS_Ranchers }
		OR = {
			last_increased_tech = Tech_GAPS_Tiyanki_Caretaking_Methods_1
			last_increased_tech = Tech_GAPS_Tiyanki_Caretaking_Methods_2
			last_increased_tech = Tech_GAPS_Tiyanki_Caretaking_Methods_3
			last_increased_tech = Tech_GAPS_Tiyanki_Caretaking_Methods_4
		}
	}

	option = {
		name = "Events_GAPS_Ranchers.Milking"
		custom_tooltip = "Events_GAPS_Ranchers.Milking.Tooltip"
		hidden_effect = {
			set_country_flag = CountryFlag_GAPS_Ranchers_Milking
		}
		trigger = {
			NOT = { has_country_flag = CountryFlag_GAPS_Ranchers_Milking }
		}
		ai_chance = {
			factor = 25
		}
	}

	option = {
		name = "Events_GAPS_Ranchers.Watching"
		custom_tooltip = "Events_GAPS_Ranchers.Watching.Tooltip"
		hidden_effect = {
			set_country_flag = CountryFlag_GAPS_Ranchers_Watching
		}
		trigger = {
			NOT = { has_country_flag = CountryFlag_GAPS_Ranchers_Watching }
		}
		ai_chance = {
			factor = 25
		}
	}

	option = {
		name = "Events_GAPS_Ranchers.Medical"
		custom_tooltip = "Events_GAPS_Ranchers.Medical.Tooltip"
		hidden_effect = {
			set_country_flag = CountryFlag_GAPS_Ranchers_Medical
		}
		trigger = {
			NOT = { has_country_flag = CountryFlag_GAPS_Ranchers_Medical }
		}
		ai_chance = {
			factor = 25
		}
	}

	option = {
		name = "Events_GAPS_Ranchers.Birthing"
		custom_tooltip = "Events_GAPS_Ranchers.Birthing.Tooltip"
		hidden_effect = {
			set_country_flag = CountryFlag_GAPS_Ranchers_Birthing
		}
		trigger = {
			NOT = { has_country_flag = CountryFlag_GAPS_Ranchers_Birthing }
		}
		ai_chance = {
			factor = 25
		}
	}
}
country_event = {
	id = Events_GAPS_Ranchers.71
	title = Events_GAPS_Ranchers.71.name
	desc = Events_GAPS_Ranchers.71.desc
	picture = GFX_evt_unidentified_ship
	show_sound = megastructure_upgraded_01
	hide_window = no
	is_triggered_only = yes

	immediate = {
		begin_event_chain = {
			event_chain = "Event_Chain_GAPS_Tiyanki_Systems"
			target = root
		}
		every_system = {		
			limit = { OR = { has_star_flag = tiyanki_home_system has_star_flag = tiyanki_spawn_system has_star_flag = elderly_tiyanki_system } }
			random_system_planet = { 
				limit = { is_primary_star = yes } 
				save_event_target_as = Target_Planet_GAPS_Home_Star 
				if = {
					limit = { not = { has_modifier = Planet_Modifier_GAPS_Is_A_Tiyanki_System } }
					add_modifier = { Planet_Modifier_GAPS_Is_A_Tiyanki_System days = -1 } 
				}
				if = {
					limit  { not = { has_modifier = Planet_Modifier_GAPS_Is_A_Special_Tiyanki_System } solar_system = { OR = { has_star_flag = tiyanki_home_system has_star_flag = elderly_tiyanki_system } } }
					add_modifier = { Planet_Modifier_GAPS_Is_A_Special_Tiyanki_System days = -1 } 
				}
			}
			enable_special_project = { name = Special_Project_GAPS_Tiyanki_Home_System owner = root location = event_target:Target_Planet_GAPS_Home_Star }
		}
	}
}

country_event = {
	id = Events_GAPS_Ranchers.72
	title = Events_GAPS_Ranchers.72.name
	desc = Events_GAPS_Ranchers.72.desc
	picture = GFX_evt_unidentified_ship
	show_sound = megastructure_upgraded_01
	hide_window = no
	is_triggered_only = yes

	immediate = {
		save_event_target_as = TIYANKI_FRIENDSHIP_START
		every_country = {
			limit = { is_country_type = guardian_elderly_tiyanki }
			set_faction_hostility = {
				set_hostile = no
			#	set_neutral = yes
				set_friendly = yes
				target = event_target:TIYANKI_FRIENDSHIP_START
			}
		}
	}
}

country_event = {
	id = Events_GAPS_Ranchers.73
	title = Events_GAPS_Ranchers.73.name
	desc = Events_GAPS_Ranchers.73.desc
	picture = GFX_evt_unidentified_ship
	show_sound = megastructure_upgraded_01
	hide_window = no
	is_triggered_only = yes

	immediate = {
		every_system_within_border = {		
			limit = { has_star_flag = elderly_tiyanki_system }
			random_system_planet = {
				limit = { is_star = no }
				save_event_target_as = new_location
			}
			random_system_planet = {
				limit = { is_star = yes }
				save_event_target_as = start_point
				event_target:tiyanki_garrison_country = {
					create_fleet = {
						name = "NAME_Elderly_Tiyanki"
						settings = {
							spawn_debris = no
							is_boss = yes
						}
						effect = {
							set_owner = event_target:tiyanki_garrison_country
							create_ship = {
								name = "NAME_Elder"
								design = "NAME_Progenitor"
							}
							set_location = event_target:start_point
							set_fleet_stance = aggressive
							set_aggro_range_measure_from = self
							set_aggro_range = 50
							save_global_event_target_as = elderly_tiyanki_fleet
							auto_move_to_planet = {
								target = event_target:new_location
								clear_auto_move_on_arrival = no		# distar.136 sets a new auto move target
							}
						}
					}
				}
			}
		}
	}
}
