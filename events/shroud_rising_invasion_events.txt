###############################################

# Shroud Rising Horrror Invasion Events

# Written by LastLeviathan

###############################################

namespace = shroud_rising_invasion

###############################################
# shroud_rising_invasion.0 | Incursions begin announce
# shroud_rising_invasion.1 | (Hidden) Spawn Timing Basic Rift
# shroud_rising_invasion.1000 | (Hidden) Check to ensure it doesn't spawn with an inhibitor
# shroud_rising_invasion.2 | (Hidden) Spawn selector Basic Rift
# shroud_rising_invasion.3 | (Hidden) Spawn Timing Greater Rift
# shroud_rising_invasion.2000 | (Hidden) Check to ensure it doesn't spawn with an inhibitor
# shroud_rising_invasion.4 | (Hidden) Spawn selector Greater Rift
# shroud_rising_invasion.50 | (Hidden) Selector for Greater Horror (Possibilities)
# shroud_rising_invasion.51 | (Hidden) Selector for Greater Horror Eye of Terror(Possibilities)
# shroud_rising_invasion.6 | (Hidden) Initial Spawn for Eye of Terror
# shroud_rising_invasion.7 | (Hidden) Spawn timing Eye of Terror
# shroud_rising_invasion.8 | (Hidden) Spawn selector Eye of Terror
# shroud_rising_invasion.9 | World Devoured by Horrors
# shroud_rising_invasion.10 | (Hidden) Chance of a Cultist Empire being neutral to spawned fleet
# shroud_rising_invasion.11 | (Hidden) Event for cultist planetfall if it reaches 100 devastation
# shroud_rising_invasion.12 | (Hidden) Add modifier for Cult Hub if they win
# shroud_rising_invasion.13 | Invasion Announce for owner
# shroud_rising_invasion.1301 | Invasion Message 1 from cult
# shroud_rising_invasion.1302 | Invasion Message 2 from cult
# shroud_rising_invasion.1303 | Invasion Message 3 from cult
# shroud_rising_invasion.1304 | (Hidden) Cleanup for if cultists are sitting around or done bombarding
# shroud_rising_invasion.1305 | (Hidden) Cleanup attempt 2 for if cultists are sitting around or done bombarding
# shroud_rising_invasion.2011 | Cultist Raid Incursion Announce Message
# shroud_rising_invasion.2012 | Small Crusade Incursion Announce Message 
# shroud_rising_invasion.2021 | Shroud Entity Alert 
# shroud_rising_invasion.2022 | Shroud Entity Powerful Alert
# shroud_rising_invasion.2031 | Greater Horror Alert Greater Rift
# shroud_rising_invasion.2032 | Greater Horror Alert EoT
# shroud_rising_invasion.2033 | Cosmic Horror Alert
# shroud_rising_invasion.100 | (Hidden) Shroud Ship Death Count
# shroud_rising_invasion.101 | (Hidden) Shroud Ship Victims
# shroud_rising_invasion.102 | (Hidden) Shroud Army Death Count
# shroud_rising_invasion.103 | (Hidden) Shroud Army Victims
# shroud_rising_invasion.105 | (Hidden) Trigger ancient god spawn
# shroud_rising_invasion.106 | Ancient God Announce
# shroud_rising_invasion.107 | (Hidden) Ancient God Defeated Effects 
# shroud_rising_invasion.108 | Ancient God Defeated Announce
###############################################

###############################################
######THE INCURSIONS ####################
###############################################

# shroud INVASION

# INCURSIONS BEGIN Announce
country_event = {
	id = shroud_rising_invasion.0
	title = "shroud_rising_invasion.0.name"
	desc = "shroud_rising_invasion.0.desc"
	picture = GFX_evt_space_monster
	show_sound = event_the_great_awakening
	is_triggered_only = yes
	
	
	immediate = {		
			set_global_flag = eot_incursions_start
	}
	
	option = {
		name = shroud_rising_invasion.0.a
		custom_tooltip = shroud_rising_invasion.0.a.tooltip				
		
	}
	
	option = {
		name = shroud_rising_invasion.0.b
		custom_tooltip = shroud_rising_invasion.0.b.tooltip			
		
	}
}

###############################################
###############################################
######BASIC RIFTS SPAWN ####################
###############################################
###############################################

# Spawn selector yearly for basic rift spawn
event = {
	id = shroud_rising_invasion.1
	hide_window = yes
	is_triggered_only = yes
	

	trigger = {
		has_global_flag = rifts_basic_active
		any_system = {
			has_star_flag = shroud_invasion_system_basic
		}
		NOT = { has_global_flag = eye_of_terror_sealed }
	}
	
	immediate = {		
		random_country = {
					limit = { 						
							is_country_type = global_event				
					}
			
			# Spawn up to 3 x enemies, triggers the spawn selector
			random_list = {
					# 2 months
					30 = {
						random_system = {			
							limit = { 
									has_star_flag = shroud_invasion_system_basic 
									NOT = { has_star_flag = rift_spawn_cooldown }									
								}
								# set_timed_star_flag = {
										# flag = rift_spawn_cooldown #prevents spawning in the same system
										# days = 90
								# }
							save_event_target_as = potential_shroud_incursion_system
						}
						IF = {
							limit = {
								any_system = {
									has_star_flag = shroud_invasion_system_basic 
									NOT = { has_star_flag = rift_spawn_cooldown }									
								}
							}
							country_event = { id = shroud_rising_invasion.1000 days = 60 random = 15 } #60
						}
						
						
					}
					# 6 months
					30 = {		
						random_system = {			
							limit = { 
									has_star_flag = shroud_invasion_system_basic 
									NOT = { has_star_flag = rift_spawn_cooldown }									
								}
								# set_timed_star_flag = {
										# flag = rift_spawn_cooldown #prevents spawning in the same system
										# days = 90
								# }
							save_event_target_as = potential_shroud_incursion_system
						}
						IF = {
							limit = {
								any_system = {
									has_star_flag = shroud_invasion_system_basic 
									NOT = { has_star_flag = rift_spawn_cooldown }
									
								}
							}
							country_event = { id = shroud_rising_invasion.1000 days = 120 random = 15 } #120
						}
					}
					# 2.3 years
					30 = {
						random_system = {			
							limit = { 
									has_star_flag = shroud_invasion_system_basic 
									NOT = { has_star_flag = rift_spawn_cooldown }
								}
								# set_timed_star_flag = {
										# flag = rift_spawn_cooldown #prevents spawning in the same system
										# days = 90
								# }
							save_event_target_as = potential_shroud_incursion_system
						}
						IF = {
							limit = {
								any_system = {
									has_star_flag = shroud_invasion_system_basic 
									NOT = { has_star_flag = rift_spawn_cooldown }
									
								}
							}
							country_event = { id = shroud_rising_invasion.1000 days = 180 random = 15 } #180
						}
					}
					 10 = {
						
					 }
			}			
			
			
			random_list = {
					# 6 months
					30 = {
						modifier = {
									 factor = 0
									 NOT = { 
										has_global_flag = rift_4_active
									} 						
						}
						random_system = {			
							limit = { 
									has_star_flag = shroud_invasion_system_basic 
									NOT = { has_star_flag = rift_spawn_cooldown }
								}
								# set_timed_star_flag = {
										# flag = rift_spawn_cooldown #prevents spawning in the same system
										# days = 90
								# }
							save_event_target_as = potential_shroud_incursion_system
						}
						IF = {
							limit = {
								any_system = {
									has_star_flag = shroud_invasion_system_basic 
									NOT = { has_star_flag = rift_spawn_cooldown }
									}
							}
							country_event = { id = shroud_rising_invasion.1000 days = 365 random = 15 } #365
						}
						
						
					}
					# 1.3 years
					30 = {
						modifier = {
									 factor = 0
									 NOT = { 
										has_global_flag = rift_2_active
									} 						
						}
						random_system = {			
							limit = { 
									has_star_flag = shroud_invasion_system_basic 
									NOT = { has_star_flag = rift_spawn_cooldown }
								}
								# set_timed_star_flag = {
										# flag = rift_spawn_cooldown #prevents spawning in the same system
										# days = 90
								# }
							save_event_target_as = potential_shroud_incursion_system
						}
						IF = {
							limit = {
								any_system = {
									has_star_flag = shroud_invasion_system_basic 
									NOT = { has_star_flag = rift_spawn_cooldown }
									
								}
							}
							country_event = { id = shroud_rising_invasion.1000 days = 420 random = 15 } #420
						}
					}
					# 2.3 years
					30 = {
						modifier = {
									 factor = 0
									 NOT = { 
										has_global_flag = rift_4_active
									} 						
						}
						random_system = {			
							limit = { 
									has_star_flag = shroud_invasion_system_basic 
									NOT = { has_star_flag = rift_spawn_cooldown }
								}
								# set_timed_star_flag = {
										# flag = rift_spawn_cooldown #prevents spawning in the same system
										# days = 90
								# }
							save_event_target_as = potential_shroud_incursion_system
						}
						IF = {
							limit = {
								any_system = {
									has_star_flag = shroud_invasion_system_basic 
									NOT = { has_star_flag = rift_spawn_cooldown }
									
								}
							}
							country_event = { id = shroud_rising_invasion.1000 days = 382 random = 15 } #382
						}
					}
					 10 = {
						
					 }
			}
		}
		
	}
	
	
}


# Check to see if the rift has been sealed before spawning
country_event = {
	id = shroud_rising_invasion.1000
	hide_window = yes
	is_triggered_only = yes
	

	trigger = {
		has_global_flag = rifts_basic_active
		any_system = {
			has_star_flag = shroud_invasion_system_basic
		}
		NOT = { has_global_flag = eye_of_terror_sealed }
	}
	
	immediate = {		
		
		
			event_target:potential_shroud_incursion_system = {							 									
					IF = {
						limit = {
							any_system_megastructure = { is_megastructure_type = rift_inhibitor_2 }
						}
					}
					ELSE = {
						save_event_target_as = shroud_incursion_system
							
						random_country = {
							limit = { 						
									is_country_type = global_event				
							}								
							country_event = { id = shroud_rising_invasion.2 }		
							}
						
									
					}																	
															
			
			}
			
					
		
	}
	
	
}

# Spawn selector event for basic  rifts
country_event = {
	id = shroud_rising_invasion.2
	hide_window = yes
	is_triggered_only = yes
	

	trigger = {		
		NOT = { has_global_flag = eye_of_terror_sealed }
		#check to see if rift has been sealed before spawning		
		
	}
	
	immediate = {				
			random_list = {
					###############################################
					######## 1 x Corrupt Avatar (~5-10k) ##########
					###############################################					 	 				
					30 = { #30
						create_country = {
							name = "NAME_shroud_horror_country"
							type = shroud_entities
							name_list = "SHROUD_HORRORS"
							flag = {
									icon = {
										category = "special"
										file = "the_shroud.dds"
									}
									background= {
										category = "backgrounds"
										file = "00_solid.dds"
									}
									colors={
										"dark_purple"
										"black"
										"null"
										"null"
									}
								}
							effect = {
									apply_shroud_rising_difficulty = yes
								}	
							}
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}
						last_created_country = {							
							save_global_event_target_as = shroud_entity_fleet
						}						
						random_system = {			
						limit = { 
								has_star_flag = shroud_invasion_system_basic 
								NOT = { has_star_flag = rift_spawn_cooldown }
							}
							set_timed_star_flag = {
									flag = rift_spawn_cooldown #prevents spawning in the same system
									days = 60
							}
						save_event_target_as = shroud_incursion_system
						}
						every_country = { establish_communications_no_message = event_target:shroud_entity_fleet }
						
						every_country = {
						limit = { 
								is_ai = no
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2021 } #Incursion Alert					
			
			
						}		
														
						create_fleet = {
								# name = random
								settings = {
									spawn_debris = no
									is_boss = yes
								}
								effect = {
									set_owner = event_target:shroud_entity_fleet				
									create_ship = {
										name = "NAME_shroud_horrors_single"
										design = "NAME_Corrupted_Avatar"								
										}				
										
									set_location = event_target:shroud_incursion_system
									set_fleet_stance = aggressive
									set_fleet_bombardment_stance = devour
									set_aggro_range_measure_from = self
									set_aggro_range = 500											
								
								}
								
							}						
						clear_global_event_target = shroud_entity_fleet
						
					}
					#################################################
					########  3 x Corrupt Avatar (10k ea) ###########
					################################################# 
					15 = { #15
						 modifier = {
								factor = 0
								mid_game_years_passed <= 30						
						 }
						create_country = {
							name = "NAME_shroud_horror_country"
							type = shroud_entities
							name_list = "SHROUD_HORRORS"
							flag = {
									icon = {
										category = "special"
										file = "the_shroud.dds"
									}
									background= {
										category = "backgrounds"
										file = "00_solid.dds"
									}
									colors={
										"dark_purple"
										"black"
										"null"
										"null"
									}
								}
							effect = {
									apply_shroud_rising_difficulty = yes
								}	
							}
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}
						last_created_country = {
							
							save_global_event_target_as = shroud_entity_fleet
						}
						random_system = {			
						limit = { 
								has_star_flag = shroud_invasion_system_basic 
								NOT = { has_star_flag = rift_spawn_cooldown }
							}
							set_timed_star_flag = {
									flag = rift_spawn_cooldown #prevents spawning in the same system
									days = 60
							}
						save_event_target_as = shroud_incursion_system
						}
						
						every_country = { establish_communications_no_message = event_target:shroud_entity_fleet }
						
						every_country = {
						limit = { 
								is_ai = no
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2021   } #Incursion Alert					
			
			
						}					
						event_target:shroud_entity_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
						}
					}
					
					##########################################################################
					########  3 x Corrupt Avatar (10k ea) + 1 x Entity (~20k ea)  ############
					##########################################################################
					5 = {
						 modifier = {
								 factor = 0
								 NOT = { has_global_flag = eye_of_terror_open }				
						 }
					
						create_country = {
								name = "NAME_shroud_horror_country"
								type = shroud_entities
								name_list = "SHROUD_HORRORS"
								flag = {
										icon = {
											category = "special"
											file = "the_shroud.dds"
										}
										background= {
											category = "backgrounds"
											file = "00_solid.dds"
										}
										colors={
											"dark_purple"
											"black"
											"null"
											"null"
										}
									}
								effect = {
										apply_shroud_rising_difficulty = yes
									}	
						}
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}
						last_created_country = {
							
							save_global_event_target_as = shroud_entity_fleet
						}
						random_system = {			
							limit = { 
								has_star_flag = shroud_invasion_system_basic 
								NOT = { has_star_flag = rift_spawn_cooldown }
							}
							set_timed_star_flag = {
									flag = rift_spawn_cooldown #prevents spawning in the same system
									days = 60
							}
							save_event_target_as = shroud_incursion_system
						}
						
						every_country = { establish_communications_no_message = event_target:shroud_entity_fleet }
						
						every_country = {
						limit = { 
								is_ai = no
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2021  } #Incursion Alert					
			
			
						}					
						event_target:shroud_entity_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_Corrupted_Avatar"								
										}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
							
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_shroud_entity"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
						}
					}
					###############################################
					########  Tiny Cultist Fleet (5k) #############
					############################################### 
					40 = { #40
						create_country = {
							name = "NAME_shroud_cultist_country"
							type = shroud_cult
							name_list = "CULTISTS"
								effect = {
									apply_shroud_rising_difficulty = yes
								}
							
						}
						# event to see if will be neutral to a shroud country
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}				
						last_created_country = {
							
							save_global_event_target_as = cultist_raid_fleet
							
						}
						random_system = {			
							limit = { 
								has_star_flag = shroud_invasion_system_basic 
								NOT = { has_star_flag = rift_spawn_cooldown }
							}
							set_timed_star_flag = {
									flag = rift_spawn_cooldown #prevents spawning in the same system
									days = 60
							}							
						save_event_target_as = shroud_incursion_system
						save_global_event_target_as = cultist_raid_fleet_location
						}
						
						every_country = { establish_communications_no_message = event_target:cultist_raid_fleet }
						every_country = {
							limit = { 								
									has_policy_flag = incursion_alert_all
									is_ai = no
							}
							country_event = { id = shroud_rising_invasion.2011  } #Incursion Alert				
						}
						event_target:cultist_raid_fleet ={
							create_species = {
							name = "NAME_shroud_cultists"
							class = random_non_machine
							portrait = random
							name_list = "CULTISTS"
							traits = random
							effect = { save_event_target_as = cultist_raid_fleet_species }
							}						
														
							create_fleet = {					
								effect = {
									set_fleet_flag = cultist_fleet
									set_owner = last_created_country									
									while = {
										count = 1
										create_ship = {
											name = random
											design = "NAME_Lancer"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 4
										create_ship = {
											name = random
											design = "NAME_Outrider" 
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 2
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "mammalian_01"							
										}
									
									}
									while = {
										count = 2
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "humanoid_01"							
										}
									
									}
									while = {
										count = 3
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "plantoid_01"							
										}
									
									}
									while = {
										count = 2
										create_ship = {							
											name = random
											design = "NAME_Ravager" #destroyer
											graphical_culture = "reptilian_01"						
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Derelict" #cruiser
											graphical_culture = "reptilian_01"						
										}
									
									}
									while = {
										count = 2
										create_ship = {
											name = random
											design = "NAME_Void_Champion"
											prefix = no
											graphical_culture = "pirate_01"
										}
									}									
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Reaver"
											graphical_culture = "pirate_01"						
										}
									
									}
									
									set_location = event_target:shroud_incursion_system									
									set_fleet_stance = aggressive
									set_aggro_range = 150
									set_aggro_range_measure_from = self
									set_fleet_bombardment_stance = indiscriminate									
									closest_system = {
											limit = {
												any_system_planet = {
													exists = owner
													NOR = { 
														has_planet_flag = cultist_raid_target 
														has_modifier = recent_cult_invasion
													}
													num_pops > 0
												}
											}											
										random_system_planet = {
												limit = {
													exists = owner													
													num_pops > 0
												}
												set_timed_planet_flag = {
													flag = cultist_raid_target
													days = 600
												}
												save_event_target_as = cultist_planet
										}
										PREV  = {
											auto_move_to_planet = {
												target = event_target:cultist_planet
												clear_auto_move_on_arrival = no
											}
										}
									}
								}
							}
							create_leader = {
								class = admiral
								species = event_target:cultist_raid_fleet_species
								name = random
								skill = 3
								leader_age_min = 25
								leader_age_max = 45
								traits = {
									trait = subclass_admiral_aggressor
									trait = leader_trait_psionic 
								}
							}
							random_owned_fleet = {
							limit = {
								has_fleet_flag = cultist_fleet
								NOT = { exists = leader }
							}
							set_leader = last_created_leader
								}
						}						
					}
					
					################################################
					########  Small Cultist Fleet (10k) ############
					################################################  
					15 = {
						 modifier = {
								 factor = 0
								 mid_game_years_passed <= 30						
						 }
						 modifier = {
								 factor = 2
								 mid_game_years_passed >= 45						
						 }
						create_country = {
							name = "NAME_shroud_cultist_country"
							type = shroud_cult
							name_list = "CULTISTS"
								effect = {
									apply_shroud_rising_difficulty = yes
								}
							
						}
						# event to see if will be neutral to a shroud country
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}				
						last_created_country = {
							
							save_global_event_target_as = cultist_raid_fleet
							
						}
						random_system = {			
							limit = { 
								has_star_flag = shroud_invasion_system_basic 
								NOT = { has_star_flag = rift_spawn_cooldown }
							}
							set_timed_star_flag = {
									flag = rift_spawn_cooldown #prevents spawning in the same system
									days = 60
							}
							
						save_event_target_as = shroud_incursion_system
						}
						
						every_country = { establish_communications_no_message = event_target:cultist_raid_fleet }
						every_country = {
							limit = { 								
									has_policy_flag = incursion_alert_all
									is_ai = no
							}
							country_event = { id = shroud_rising_invasion.2011  } #Incursion Alert				
						}
						event_target:cultist_raid_fleet ={
							create_species = {
							name = "NAME_shroud_cultists"
							class = random_non_machine
							portrait = random
							name_list = "CULTISTS"
							traits = random
							effect = { save_event_target_as = cultist_raid_fleet_species }
							}						
														
							create_fleet = {					
								settings = {
									spawn_debris = yes									
								}
								effect = {
									set_fleet_flag = cultist_fleet
									set_owner = last_created_country									
									while = {
										count = 1
										create_ship = {
											name = random
											design = "NAME_Void_Champion"
											prefix = no
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 2
										create_ship = {
											name = random
											design = "NAME_Lancer"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 4
										create_ship = {
											name = random
											design = "NAME_Outrider" 
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 3
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "mammalian_01"							
										}
									
									}
									while = {
										count = 5
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "humanoid_01"							
										}
									
									}
									while = {
										count = 6
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "plantoid_01"							
										}
									
									}
									while = {
										count = 2
										create_ship = {							
											name = random
											design = "NAME_Ravager" #destroyer
											graphical_culture = "reptilian_01"						
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Derelict" #cruiser
											graphical_culture = "reptilian_01"						
										}
									
									}								
																	
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Reaver"
											graphical_culture = "pirate_01"						
										}
									
									}
									while = {
									count = 1
										create_ship = {							
											name = random
											design = "NAME_Avatar"
											graphical_culture = "fallen_empire_04"					
										}
									}
									
									set_location = event_target:shroud_incursion_system
									set_fleet_stance = aggressive
									set_aggro_range = 150
									set_aggro_range_measure_from = self
									set_fleet_bombardment_stance = indiscriminate									
									closest_system = {
											limit = {
												any_system_planet = {
													exists = owner
													NOR = { 
														has_planet_flag = cultist_raid_target 
														has_modifier = recent_cult_invasion
													}
													num_pops > 0
												}
											}											
										random_system_planet = {
												limit = {
													exists = owner													
													num_pops > 0
												}
												set_timed_planet_flag = {
													flag = cultist_raid_target
													days = 600
												}
												save_event_target_as = cultist_planet
											}
										PREV  = {
											auto_move_to_planet = {
												target = event_target:cultist_planet
												clear_auto_move_on_arrival = no
											}
										}
									}
								}
							}
							create_leader = {
								class = admiral
								species = event_target:cultist_raid_fleet_species
								name = random
								skill = 3
								leader_age_min = 25
								leader_age_max = 45
								traits = {
									trait = subclass_admiral_aggressor
									trait = leader_trait_psionic 
								}
							}
							random_owned_fleet = {
							limit = {
								has_fleet_flag = cultist_fleet
								NOT = { exists = leader }
							}
							set_leader = last_created_leader
								}
						}
					}
					###############################################
					########  Big Cultist Fleet (25k) #############
					###############################################  
					5 = { #5
						 modifier = {
								 factor = 0
								 mid_game_years_passed <= 75						
						 }
						 modifier = {
								 factor = 2
								 mid_game_years_passed >= 75						
						 }
						create_country = {
							name = "NAME_shroud_cultist_country"
							type = shroud_cult
							name_list = "CULTISTS"
								effect = {
									apply_shroud_rising_difficulty = yes
								}
							
						}
						# event to see if will be neutral to a shroud country
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}				
						last_created_country = {
							
							save_global_event_target_as = cultist_raid_fleet
							
						}
						random_system = {			
							limit = { 
								has_star_flag = shroud_invasion_system_basic 
								NOT = { has_star_flag = rift_spawn_cooldown }
							}
							set_timed_star_flag = {
									flag = rift_spawn_cooldown #prevents spawning in the same system
									days = 60
							}
						save_event_target_as = shroud_incursion_system
						}
						
						every_country = { establish_communications_no_message = event_target:cultist_raid_fleet }
						every_country = {
							limit = { 								
									has_policy_flag = incursion_alert_all
									is_ai = no
							}
							country_event = { id = shroud_rising_invasion.2011 } #Incursion Alert				
						}
						event_target:cultist_raid_fleet ={
							create_species = {
							name = "NAME_shroud_cultists"
							class = random_non_machine
							portrait = random
							name_list = "CULTISTS"
							traits = random
							effect = { save_event_target_as = cultist_raid_fleet_species }
							}						
														
							create_fleet = {					
								settings = {
									spawn_debris = yes									
								}
								effect = {
									set_fleet_flag = cultist_fleet
									set_owner = last_created_country										
									while = {
										count = 1
										create_ship = {
											name = random
											design = "NAME_Ancestral_Glory"
											graphical_culture = "pirate_01"
										}
									}		
									while = {
										count = 4
										create_ship = {
											name = random
											design = "NAME_Lancer"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 4
										create_ship = {
											name = random
											design = "NAME_Outrider" 
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 3
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "mammalian_01"							
										}
									
									}
									while = {
										count = 5
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "humanoid_01"							
										}
									
									}
									while = {
										count = 6
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "plantoid_01"							
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Ravager" #destroyer
											graphical_culture = "reptilian_01"						
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Ravager" #destroyer
											graphical_culture = "avian_01"						
										}
									
									}
									while = {
										count = 3
										create_ship = {							
											name = random
											design = "NAME_Derelict" #cruiser
											graphical_culture = "reptilian_01"						
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Derelict" #cruiser
											graphical_culture = "humanoid_01"						
										}
									
									}
									while = {
										count = 2
										create_ship = {							
											name = random
											design = "NAME_Derelict" #cruiser
											graphical_culture = "mammalian_01"						
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Reaver"
											graphical_culture = "pirate_01"						
										}
									
									}
									while = {
									count = 1
									create_ship = {							
										name = random
										design = "NAME_Avatar"
										graphical_culture = "fallen_empire_04"					
									}
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Zealot"
											graphical_culture = "fallen_empire_02"						
										}
									}
									set_location = event_target:shroud_incursion_system
									set_fleet_stance = aggressive
									set_aggro_range = 150
									set_aggro_range_measure_from = self
									set_fleet_bombardment_stance = indiscriminate									
									closest_system = {
											limit = {
												any_system_planet = {
													exists = owner
													NOR = { 
														has_planet_flag = cultist_raid_target 
														has_modifier = recent_cult_invasion
													}
													num_pops > 0
												}
											}											
										random_system_planet = {
												limit = {
													exists = owner													
													num_pops > 0
												}
												set_timed_planet_flag = {
													flag = cultist_raid_target
													days = 600
												}
												save_event_target_as = cultist_planet
											}
										PREV  = {
											auto_move_to_planet = {
												target = event_target:cultist_planet
												clear_auto_move_on_arrival = no
											}
										}
									}
								}
							}
							create_leader = {
								class = admiral
								species = event_target:cultist_raid_fleet_species
								name = random
								skill = 3
								leader_age_min = 25
								leader_age_max = 45
								traits = {
									trait = subclass_admiral_aggressor
									trait = leader_trait_psionic 
								}
							}
							random_owned_fleet = {
							limit = {
								has_fleet_flag = cultist_fleet
								NOT = { exists = leader }
							}
							set_leader = last_created_leader
								}
						}
					}
					
					
			}	
		
		
	}
	
	
}

###############################################
###############################################
######Greater RIFTS SPAWN ####################
###############################################
###############################################
# Spawn timing yearly for greater rift spawn
event = {
	id = shroud_rising_invasion.3
	hide_window = yes
	is_triggered_only = yes
	

	trigger = {
		#has_global_flag = rifts_basic_active
		any_system = {
			has_star_flag = shroud_invasion_system_greater
		}
		NOT = { has_global_flag = greater_rift_timer }
		NOT = { has_global_flag = eye_of_terror_sealed }
	}
	
	immediate = {
		set_timed_global_flag = { flag = greater_rift_timer days = 1095 } #ensures it only triggers every 3 years
		random_country = {
					limit = { 						
							is_country_type = global_event				
					}
			
			# Spawn up to 3 x enemies, triggers the spawn selector
			random_list = {
					# 2 years
					33 = {
						random_system = {			
							limit = { 
									has_star_flag = shroud_invasion_system_greater 							
								}															
							save_event_target_as = potential_shroud_incursion_system
						}
						country_event = { id = shroud_rising_invasion.2000 days = 25 random = 30 } #720
					}
					# 3 years
					33 = {
						random_system = {			
							limit = { 
									has_star_flag = shroud_invasion_system_greater																	
								}								
							save_event_target_as = potential_shroud_incursion_system
						}
						country_event = { id = shroud_rising_invasion.2000 days = 45 random = 30  } #1095
					}
					# 4 years
					33 = {
						random_system = {			
							limit = { 
									has_star_flag = shroud_invasion_system_greater 								
								}								
							save_event_target_as = potential_shroud_incursion_system
						}
						country_event = { id = shroud_rising_invasion.2000 days = 90 random = 30 } #1460
					}					
			}
			
			
		}
		
	}
	
	
}

# Check to see if the rift has been sealed before spawning
country_event = {
	id = shroud_rising_invasion.2000
	hide_window = yes
	is_triggered_only = yes
	

	trigger = {
		#has_global_flag = rifts_basic_active
		any_system = {
			has_star_flag = shroud_invasion_system_greater
		}
		NOT = { has_global_flag = greater_rift_timer }
		NOT = { has_global_flag = eye_of_terror_sealed }
	}
	
	immediate = {			
			# event_target:potential_shroud_incursion_system = {							 									
							# random_system_megastructure = {
									# limit = {
										# NOT = {
											# is_megastructure_type = rift_inhibitor_2											
										# }
									# }
									# FROM = {
										# save_event_target_as = shroud_incursion_system
									# }
								# }
				# random_country = {
							# limit = { 						
									# is_country_type = global_event				
							# }								
					# country_event = { id = shroud_rising_invasion.4 } 									
			
					# }
			
				# }	
			event_target:potential_shroud_incursion_system = {							 									
					IF = {
						limit = {
							any_system_megastructure = { is_megastructure_type = rift_inhibitor_2 }
						}
					}
					ELSE = {						
						save_event_target_as = shroud_incursion_system							
						random_country = {
							limit = { 						
									is_country_type = global_event				
							}								
							country_event = { id = shroud_rising_invasion.4 }		
							}
						
									
					}																	
															
			
			}			
		
	}
	
	
}

# Spawn selector event for greater rifts
country_event = {
	id = shroud_rising_invasion.4
	hide_window = yes
	is_triggered_only = yes
	

	trigger = {
		NOT = { has_global_flag = eye_of_terror_sealed }
		
	}
	
	immediate = {				
			random_list = {
					###############################################
					######## 2 x Corrupt Avatar (~5-10k ea) ##########
					###############################################					 	 				
					30 = { #30
						modifier = {
								 factor = 0
								 mid_game_years_passed >= 45						
						 }
						 modifier = {
								 factor = 0
								 mid_game_years_passed >= 75						
						 }
						create_country = {
							name = "NAME_shroud_horror_country"
							type = shroud_entities
							name_list = "SHROUD_HORRORS"
							flag = {
									icon = {
										category = "special"
										file = "the_shroud.dds"
									}
									background= {
										category = "backgrounds"
										file = "00_solid.dds"
									}
									colors={
										"dark_purple"
										"black"
										"null"
										"null"
									}
								}
							effect = {
									apply_shroud_rising_difficulty = yes
								}	
							}
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}
						last_created_country = {
							
							save_global_event_target_as = shroud_entity_fleet
						}						
						
						every_country = { establish_communications_no_message = event_target:shroud_entity_fleet }
						
						every_country = {
						limit = { 
							
								has_policy_flag = incursion_alert_all
								is_ai = no
										
						}
						country_event = { id = shroud_rising_invasion.2021 } #Incursion Alert					
			
			
						}					
						event_target:shroud_entity_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
						}
					}
					#######################################################################
					########  3 x Corrupt Avatar (10k ea) + 1 x Entity (20k ea) ###########
					#######################################################################
					10 = { #15
						 modifier = {
								factor = 0
								mid_game_years_passed <= 45						
						 }
						 modifier = {
								 factor = 0
								 mid_game_years_passed >= 50						
						 }
						create_country = {
							name = "NAME_shroud_horror_country"
							type = shroud_entities
							name_list = "SHROUD_HORRORS"
							flag = {
									icon = {
										category = "special"
										file = "the_shroud.dds"
									}
									background= {
										category = "backgrounds"
										file = "00_solid.dds"
									}
									colors={
										"dark_purple"
										"black"
										"null"
										"null"
									}
								}
							effect = {
									apply_shroud_rising_difficulty = yes
								}	
							}
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}
						last_created_country = {
							
							save_global_event_target_as = shroud_entity_fleet
						}						
						
						every_country = { establish_communications_no_message = event_target:shroud_entity_fleet }
						
						every_country = {
						limit = { 
							
								has_policy_flag = incursion_alert_all
								is_ai = no
										
						}
						country_event = { id = shroud_rising_invasion.2021  } #Incursion Alert					
			
			
						}					
						event_target:shroud_entity_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_Corrupted_Avatar"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_shroud_entity"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
						}
					}
					
					#############################################
					########  4  x Entity (~20k ea)  ############
					#############################################
					5 = {
						 modifier = {
								 factor = 0
								 NOT = { has_global_flag = eye_of_terror_open }				
						 }
						modifier = {
								 factor = 0
								 mid_game_years_passed >= 75						
						 }
						create_country = {
								name = "NAME_shroud_horror_country"
								type = shroud_entities
								name_list = "SHROUD_HORRORS"
								flag = {
										icon = {
											category = "special"
											file = "the_shroud.dds"
										}
										background= {
											category = "backgrounds"
											file = "00_solid.dds"
										}
										colors={
											"dark_purple"
											"black"
											"null"
											"null"
										}
									}
								effect = {
										apply_shroud_rising_difficulty = yes
									}	
						}
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}
						last_created_country = {
							
							save_global_event_target_as = shroud_entity_fleet
						}
												
						every_country = { establish_communications_no_message = event_target:shroud_entity_fleet }
						
						every_country = {
						limit = { 
							
								has_policy_flag = incursion_alert_all
								is_ai = no
										
						}
						country_event = { id = shroud_rising_invasion.2021  } #Incursion Alert					
			
			
						}					
						event_target:shroud_entity_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_shroud_entity"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_shroud_entity"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_shroud_entity"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
							
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_entity_fleet				
										create_ship = {
											name = "NAME_shroud_horrors_single"
											design = "NAME_shroud_entity"								
											}				
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 500											
									
									}
									
							}
						}
					}
					###############################################
					########  Large Cultist Fleet (25k) #############
					############################################### 
					40 = { #40
						 modifier = {
								 factor = 0
								 mid_game_years_passed <= 45						
						 }
						 modifier = {
								 factor = 2
								 mid_game_years_passed >= 45						
						 }
						create_country = {
							name = "NAME_shroud_cultist_country"
							type = shroud_cult
							name_list = "CULTISTS"
								effect = {
									apply_shroud_rising_difficulty = yes
								}
							
						}
						# event to see if will be neutral to a shroud country
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}				
						last_created_country = {
							
							save_global_event_target_as = cultist_raid_fleet
							
						}
												
						every_country = { establish_communications_no_message = event_target:cultist_raid_fleet }
						every_country = {
							limit = { 								
									has_policy_flag = incursion_alert_all
									is_ai = no
							}
							country_event = { id = shroud_rising_invasion.2011  } #Incursion Alert				
						}
						event_target:cultist_raid_fleet ={
							create_species = {
							name = "NAME_shroud_cultists"
							class = random_non_machine
							portrait = random
							name_list = "CULTISTS"
							traits = random
							effect = { save_event_target_as = cultist_raid_fleet_species }
							}						
														
							create_fleet = {					
								settings = {
									spawn_debris = yes									
								}
								effect = {
									set_fleet_flag = cultist_fleet
									set_owner = last_created_country										
									while = {
										count = 1
										create_ship = {
											name = random
											design = "NAME_Ancestral_Glory"
											graphical_culture = "pirate_01"
										}
									}		
									while = {
										count = 4
										create_ship = {
											name = random
											design = "NAME_Lancer"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 4
										create_ship = {
											name = random
											design = "NAME_Outrider" 
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 3
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "mammalian_01"							
										}
									
									}
									while = {
										count = 5
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "humanoid_01"							
										}
									
									}
									while = {
										count = 6
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "plantoid_01"							
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Ravager" #destroyer
											graphical_culture = "reptilian_01"						
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Ravager" #destroyer
											graphical_culture = "avian_01"						
										}
									
									}
									while = {
										count = 3
										create_ship = {							
											name = random
											design = "NAME_Derelict" #cruiser
											graphical_culture = "reptilian_01"						
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Derelict" #cruiser
											graphical_culture = "humanoid_01"						
										}
									
									}
									while = {
										count = 2
										create_ship = {							
											name = random
											design = "NAME_Derelict" #cruiser
											graphical_culture = "mammalian_01"						
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Reaver"
											graphical_culture = "pirate_01"						
										}
									
									}
									while = {
									count = 1
									create_ship = {							
										name = random
										design = "NAME_Avatar"
										graphical_culture = "fallen_empire_04"					
									}
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Zealot"
											graphical_culture = "fallen_empire_02"						
										}
									}
									set_location = event_target:shroud_incursion_system									
									set_fleet_stance = aggressive
									set_aggro_range = 150
									set_aggro_range_measure_from = self
									set_fleet_bombardment_stance = indiscriminate									
									closest_system = {
											limit = {
												any_system_planet = {
													exists = owner
													NOR = { 
														has_planet_flag = cultist_raid_target 
														has_modifier = recent_cult_invasion
													}
													num_pops > 0
												}
											}											
										random_system_planet = {
												limit = {
													exists = owner													
													num_pops > 0
												}
												set_timed_planet_flag = {
													flag = cultist_raid_target
													days = 600
												}
												save_event_target_as = cultist_planet
											}
										PREV  = {
											auto_move_to_planet = {
												target = event_target:cultist_planet
												clear_auto_move_on_arrival = no
											}
										}
									}
								}
							}
							create_leader = {
								class = admiral
								species = event_target:cultist_raid_fleet_species
								name = random
								skill = 3
								leader_age_min = 25
								leader_age_max = 45
								traits = {
									trait = subclass_admiral_aggressor
									trait = leader_trait_psionic 
								}
							}
							random_owned_fleet = {
							limit = {
								has_fleet_flag = cultist_fleet
								NOT = { exists = leader }
							}
							set_leader = last_created_leader
								}
						}						
					}
					
					################################################
					########  Cultist Crusade (50k) ############
					################################################  
					15 = {
						 modifier = {
								 factor = 0
								 mid_game_years_passed <= 65						
						 }
						 modifier = {
								 factor = 2
								 mid_game_years_passed >= 65						
						 }
						create_country = {
							name = "NAME_shroud_cultist_country"
							type = shroud_cult
							name_list = "CULTISTS"
								effect = {
									apply_shroud_rising_difficulty = yes
								}
							
						}
						# event to see if will be neutral to a shroud country
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}				
						last_created_country = {
							
							save_global_event_target_as = cultist_raid_fleet
							
						}						
						
						every_country = { establish_communications_no_message = event_target:cultist_raid_fleet }
						every_country = {
						limit = { 
							
								has_policy_flag = incursion_alert_all
								is_ai = no
						}
						country_event = { id = shroud_rising_invasion.2011  } #Incursion Alert					
			
			
						}					event_target:cultist_raid_fleet ={
							create_species = {
							name = "NAME_shroud_cultists"
							class = random_non_machine
							portrait = random
							name_list = "CULTISTS"
							traits = random
							effect = { save_event_target_as = cultist_raid_fleet_species }
							}						
														
							create_fleet = {
								settings = {
									spawn_debris = yes									
								}
								effect = {
									set_fleet_flag = cultist_fleet
									set_owner = last_created_country										
									while = {
										count = 2
										create_ship = {
											name = random
											design = "NAME_Ancestral_Glory"
											graphical_culture = "pirate_01"
										}
									}		
									while = {
										count = 8
										create_ship = {
											name = random
											design = "NAME_Void_Champion"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 12
										create_ship = {
											name = random
											design = "NAME_Lancer"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 20
										create_ship = {
											name = random
											design = "NAME_Outrider"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 3
										create_ship = {							
											name = random
											design = "NAME_Spearhead"
											graphical_culture = "mammalian_01"							
										}
									
									}
									while = {
										count = 2
										create_ship = {							
											name = random
											design = "NAME_Spearhead"
											graphical_culture = "arthropoid_01"							
										}
									
									}
									while = {
										count = 3
										create_ship = {							
												name = random
												design = "NAME_Deaths_Head"
												graphical_culture = "molluscoid_01"					
											}
									}
									while = {
										count = 5
										create_ship = {							
												name = random
												design = "NAME_Deaths_Head"
												graphical_culture = "humanoid_01"					
											}
									}
									while = {
										count = 4
										create_ship = {							
												name = random
												design = "NAME_Bug_Crusher"
												graphical_culture = "molluscoid_01"				
											}
									}
									while = {
									count = 2
									create_ship = {							
										name = random
										design = "NAME_Avatar"
										graphical_culture = "fallen_empire_04"					
									}
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Zealot"
											graphical_culture = "fallen_empire_02"						
										}
									}
									set_location = event_target:shroud_incursion_system
									set_fleet_stance = aggressive
									set_aggro_range = 150
									set_aggro_range_measure_from = self
									set_fleet_bombardment_stance = indiscriminate									
									closest_system = {
											limit = {
												any_system_planet = {
													exists = owner
													NOR = { 
														has_planet_flag = cultist_raid_target 
														has_modifier = recent_cult_invasion
													}
													num_pops > 20
												}
											}											
										random_system_planet = {
												limit = {
													exists = owner													
													num_pops > 20
												}
												set_timed_planet_flag = {
													flag = cultist_raid_target
													days = 600
												}
												save_event_target_as = cultist_planet
											}
										PREV  = {
											auto_move_to_planet = {
												target = event_target:cultist_planet
												clear_auto_move_on_arrival = no
											}
										}
									}
								}
							}
							create_leader = {
								class = admiral
								species = event_target:cultist_raid_fleet_species
								name = random
								skill = 3
								leader_age_min = 25
								leader_age_max = 45
								traits = {
									trait = subclass_admiral_aggressor
									trait = leader_trait_psionic 
								}
							}
							random_owned_fleet = {
							limit = {
								has_fleet_flag = cultist_fleet
								NOT = { exists = leader }
							}
							set_leader = last_created_leader
								}
						}
					}
					###############################################
					########  Avatar (50k) #############
					###############################################  
					5 = { #5
						 modifier = {
								 factor = 0
								 mid_game_years_passed <= 25						
						 }
						 modifier = {
								 factor = 5
								 mid_game_years_passed >= 25						
						 }
						 modifier = {
								 factor = 15
								 mid_game_years_passed >= 50						
						 }						 
						 create_country = {
							name = "NAME_shroud_horror_country"
							type = shroud_horrors
							name_list = "SHROUD_HORRORS"
							flag = {
									icon = {
										category = "special"
										file = "the_shroud.dds"
									}
									background= {
										category = "backgrounds"
										file = "00_solid.dds"
									}
									colors={
										"dark_purple"
										"black"
										"null"
										"null"
									}
								}
							effect = {
									apply_shroud_rising_difficulty = yes
								}
							}			
							last_created_country = {
								
								save_global_event_target_as = shroud_horror_fleet
							}
							random_system = {			
								limit = { 
									has_star_flag = shroud_invasion_system_greater
									NOT = { has_star_flag = rift_spawn_cooldown }
								}
								set_timed_star_flag = {
										flag = rift_spawn_cooldown #prevents spawning in the same system
										days = 60
								}
								save_event_target_as = shroud_incursion_system
							}
							
								every_country = { establish_communications_no_message = event_target:shroud_horror_fleet }
						
						 country_event = { id = shroud_rising_invasion.50  } #180 choose a Greater Shroud Horror to spawn
						
					}
					
					
			}	
		
		
	}
	
	
}



# Selector to Spawn Shroud Horror
country_event = {
	id = shroud_rising_invasion.50
	hide_window = yes
	is_triggered_only = yes	
	# fire_only_once = yes
	immediate = {			
			
			random_list = {		
				
				# Chance of Different Avatars
				20 = {	
						every_country = {
						limit = { 
							
								has_policy_flag = incursion_alert_all
								is_ai = no
										
						}
						country_event = { id = shroud_rising_invasion.2032  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror"
											design = "NAME_greater_horror"								
											}						
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300

									}
								
								}
								last_created_fleet = {
									save_event_target_as = shroud_horror_fleet_name
								}								
						}
				}
				20 = {	
						every_country = {
						limit = { 
							
								has_policy_flag = incursion_alert_all
								is_ai = no
										
						}
						country_event = { id = shroud_rising_invasion.2032  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror_desire"
											design = "NAME_horror_desire"								
											}						
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300

									}
								
								}
								last_created_fleet = {
									save_event_target_as = shroud_horror_fleet_name
								}								
	
						}

				}
				20 = {	
						every_country = {
						limit = { 
							
								has_policy_flag = incursion_alert_all
								is_ai = no
										
						}
						country_event = { id = shroud_rising_invasion.2032  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror_hunger"
											design = "NAME_horror_hunger"								
										}						
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300

									}
									
								}
								last_created_fleet = {
									save_event_target_as = shroud_horror_fleet_name
								}
								
						}

				}
				# Chance of stronger entities
				20 = {
					every_country = {
						limit = { 
							is_ai = no
							OR = {
								has_policy_flag = incursion_alert_all
								has_policy_flag = incursion_alert_major		
							}
										
						}
						country_event = { id = shroud_rising_invasion.2032  } #Incursion Alert					

						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror_whisper"
											design = "NAME_horror_whisper"								
											}						
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300

									}
									
								}
								last_created_fleet = {
									save_event_target_as = shroud_horror_fleet_name
								}
								
						}
							
				}
				20 = {	
						every_country = {
						limit = { 
								is_ai = no
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2032  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror_corruption"
											design = "NAME_horror_corruption"								
											}						
											
										set_location = event_target:shroud_incursion_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300

									}
								
								}
							last_created_fleet = {
								save_event_target_as = shroud_horror_fleet_name
							}
								
								
						}
	
				}
				
			}
						
	
		}
	
}

# Selector to Spawn Shroud Horror for Eye of Terror
country_event = {
	id = shroud_rising_invasion.51
	hide_window = yes
	is_triggered_only = yes	
	# fire_only_once = yes
	immediate = {			
			
			random_list = {		
				
				# Chance of Different Avatars
				20 = {	
						every_country = {
						limit = { 
								is_ai = no
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2032  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror"
											design = "NAME_greater_horror"								
											}						
											
										set_location = event_target:eye_of_terror_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300

									}
								
								}
								last_created_fleet = {
									save_event_target_as = shroud_horror_fleet_name
								}								
						}
				}
				20 = {	
						every_country = {
						limit = { 
								is_ai = no
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2032  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror_desire"
											design = "NAME_horror_desire"								
											}						
											
										set_location = event_target:eye_of_terror_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300

									}
								
								}
								last_created_fleet = {
									save_event_target_as = shroud_horror_fleet_name
								}								
	
						}

				}
				20 = {	
						every_country = {
						limit = { 	
								is_ai = no
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2032  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror_hunger"
											design = "NAME_horror_hunger"								
											}						
											
										set_location = event_target:eye_of_terror_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300

									}
									
								}
								last_created_fleet = {
									save_event_target_as = shroud_horror_fleet_name
								}
								
						}

				}
				# Chance of stronger entities
				20 = {
					every_country = {
						limit = { 
								is_ai = no
							OR = {
								has_policy_flag = incursion_alert_all
								has_policy_flag = incursion_alert_major		
							}
										
						}
						country_event = { id = shroud_rising_invasion.2032  } #Incursion Alert					

						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror_whisper"
											design = "NAME_horror_whisper"								
											}						
											
										set_location = event_target:eye_of_terror_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300

									}
									
								}
								last_created_fleet = {
									save_event_target_as = shroud_horror_fleet_name
								}
								
						}
							
				}
				20 = {	
						every_country = {
						limit = { 
								is_ai = no
								has_policy_flag = incursion_alert_all
										
						}
						country_event = { id = shroud_rising_invasion.2032  } #Incursion Alert					
			
			
						}					
						event_target:shroud_horror_fleet = {					
														
							create_fleet = {
									# name = random
									settings = {
										spawn_debris = no
										is_boss = yes
									}
									effect = {
										set_owner = event_target:shroud_horror_fleet				
										create_ship = {
											name = "NAME_greater_horror_corruption"
											design = "NAME_horror_corruption"								
											}						
											
										set_location = event_target:eye_of_terror_system
										set_fleet_stance = aggressive
										set_fleet_bombardment_stance = devour
										set_aggro_range_measure_from = self
										set_aggro_range = 300

									}
								
								}
							last_created_fleet = {
								save_event_target_as = shroud_horror_fleet_name
							}
								
								
						}
	
				}
				
			}
						
	
		}
	
}

###############################################
###############################################
######Eye of Terror SPAWN ####################
###############################################
###############################################




##### INITIAL EYE OF TERROR SPAWN ############################

country_event = {
	id = shroud_rising_invasion.6		
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes

	immediate = {				
		create_country = {
			name = "NAME_shroud_horror_country"
			type = "shroud_horrors"
			name_list = "SHROUD_HORRORS"
			flag = {
				icon = {
					category = "special"
					file = "the_shroud.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"dark_purple"
					"black"
					"null"
					"null"
				}
			}
			effect = {
				apply_shroud_rising_difficulty = yes
			}
		}			
		
		last_created_country = {
			
			save_global_event_target_as = shroud_horror_country
		}
		create_fleet = {
			# name = random
			settings = {
				spawn_debris = no
				is_boss = yes
			}
			effect = {
				set_owner = event_target:shroud_horror_country				
				create_ship = {
					name = "NAME_greater_horror_hunger"
					design = "NAME_greater_horror"								
					}						
					
				set_location = event_target:eye_of_terror_system
				set_fleet_stance = aggressive
				set_fleet_bombardment_stance = devour
				set_aggro_range_measure_from = self
				set_aggro_range = 300
				
			
			
			
			}
			
		}
		create_fleet = {
			# name = random
			settings = {
				spawn_debris = no
				is_boss = yes
			}
			effect = {
				set_owner = event_target:shroud_horror_country				
				create_ship = {
					name = "NAME_greater_horror_desire"
					design = "NAME_greater_desire"								
					}						
					
				set_location = event_target:eye_of_terror_system
				set_fleet_stance = aggressive
				set_fleet_bombardment_stance = devour
				set_aggro_range_measure_from = self
				set_aggro_range = 300
				
			
			
			
			}
			
		}
		
		# last_created_fleet = { fleet_event = { id = shroud_rising_invasion } }
		every_country = { establish_communications_no_message = event_target:shroud_horror_country }
		
	}

	
}


# Spawn timing selector yearly for eye of terror
event = {
	id = shroud_rising_invasion.7
	hide_window = yes
	is_triggered_only = yes
	

	trigger = {
		has_global_flag = eye_of_terror_open
		NOT = { has_global_flag = eye_of_terror_sealed }
	}
	
	immediate = {		
		random_country = {
					limit = { 						
							is_country_type = global_event				
					}
			
			# Spawn 1 x enemies, triggers the spawn selector
			random_list = {
					# 
					33 = {
						random_system = {			
							limit = { 
									has_star_flag = eye_of_terror_system # shroud_invasion_system_greater
									#NOT = { has_star_flag = rift_spawn_cooldown }
								}								
							save_event_target_as = shroud_incursion_system
						}
						country_event = { id = shroud_rising_invasion.8 days = 30 random = 15 } #30
					}
					# 
					33 = {
						random_system = {			
							limit = { 
									has_star_flag = eye_of_terror_system # shroud_invasion_system_greater
									#NOT = { has_star_flag = rift_spawn_cooldown }
								}								
							save_event_target_as = shroud_incursion_system
						}
						country_event = { id = shroud_rising_invasion.8 days = 90 random = 15 } #90
					}
					#
					33 = {
						random_system = {			
							limit = { 
									has_star_flag = eye_of_terror_system # shroud_invasion_system_greater
									#NOT = { has_star_flag = rift_spawn_cooldown }
								}								
							save_event_target_as = shroud_incursion_system
						}
						country_event = { id = shroud_rising_invasion.8 days = 180 random = 15 } #180
					}
					 # 5 = {
						
					 # }
			}						
		}
		
	}
	
	
}


# Spawn selector event for Eye of Terror
country_event = {
	id = shroud_rising_invasion.8
	hide_window = yes
	is_triggered_only = yes
	

	trigger = {
		NOT = { has_global_flag = eye_of_terror_sealed }
	}
	immediate = {				
			random_list = {						
					
					###############################################
					########  Cultist Crusade (90k) #############
					############################################### 
					 25 = { #40							 
						create_country = {
							name = "NAME_shroud_cultist_country"
							type = shroud_cult
							name_list = "CULTISTS"
								effect = {
									apply_shroud_rising_difficulty = yes
								}
							
						}
						# event to see if will be neutral to a shroud country
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}				
						last_created_country = {
							
							save_global_event_target_as = cultist_raid_fleet
							
						}
						
						
						every_country = { establish_communications_no_message = event_target:cultist_raid_fleet }
						every_country = {
						limit = { 
							is_ai = no
							OR = {
								has_policy_flag = incursion_alert_all
								has_policy_flag = incursion_alert_major		
							}
						}
						country_event = { id = shroud_rising_invasion.2012  } #Incursion Alert					
						}
					
						event_target:cultist_raid_fleet = {
							create_species = {
							name = "NAME_shroud_cultists"
							class = random_non_machine
							portrait = random
							name_list = "CULTISTS"
							traits = random
							effect = { save_event_target_as = cultist_raid_fleet_species }
							}						
														
							create_fleet = {
								settings = {
									spawn_debris = yes									
								}
								effect = {
									set_fleet_flag = cultist_fleet
									set_owner = last_created_country
									assign_leader = last_created_leader	
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Eternal"
											graphical_culture = "fallen_empire_04"							
										}
									}
									while = {
										count = 2
										create_ship = {
											name = random
											design = "NAME_Ancestral_Glory"
											graphical_culture = "pirate_01"
										}
									}								
									while = {
										count = 4
										create_ship = {
											name = random
											design = "NAME_Void_Champion"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 12
										create_ship = {
											name = random
											design = "NAME_Lancer"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 24
										create_ship = {
											name = random
											design = "NAME_Outrider"
											graphical_culture = "pirate_01"
										}
									}
									while = {
										count = 2
										create_ship = {							
											name = random
											design = "NAME_Spearhead"
											graphical_culture = "mammalian_01"							
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Spearhead"
											graphical_culture = "arthropoid_01"							
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Spearhead"
											graphical_culture = "necroid_01"							
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Spearhead"
											graphical_culture = "arthropoid_01"							
										}
									
									}
									while = {
										count = 2
										create_ship = {							
												name = random
												design = "NAME_Deaths_Head"
												graphical_culture = "molluscoid_01"					
											}
									}
									while = {
										count = 4
										create_ship = {							
												name = random
												design = "NAME_Deaths_Head"
												graphical_culture = "humanoid_01"					
											}
									}
									while = {
										count = 2
										create_ship = {							
												name = random
												design = "NAME_Deaths_Head"
												graphical_culture = "plantoid_01"					
											}
									}
									while = {
										count = 1
										create_ship = {							
												name = random
												design = "NAME_Deaths_Head"
												graphical_culture = "avian_01"					
											}
									}
									while = {
										count = 4
										create_ship = {							
												name = random
												design = "NAME_Bug_Crusher"
												graphical_culture = "molluscoid_01"				
											}
									}
									while = {
									count = 2
									create_ship = {							
										name = random
										design = "NAME_Avatar"
										graphical_culture = "fallen_empire_04"					
									}
									}
									while = {
									count = 1
									create_ship = {							
										name = random
										design = "NAME_Avatar"
										graphical_culture = "fallen_empire_01"					
									}
									}
									while = {
										count = 3
										create_ship = {							
											name = random
											design = "NAME_Zealot"
											graphical_culture = "fallen_empire_02"						
										}
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Zealot"
											graphical_culture = "fallen_empire_03"						
										}
									}
									while = {
										count = 3
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "mammalian_01"							
										}
									
									}
									while = {
										count = 5
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "humanoid_01"							
										}
									
									}
									while = {
										count = 5
										create_ship = {							
											name = random
											design = "NAME_Dagger" #corvette
											graphical_culture = "plantoid_01"							
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Ravager" #destroyer
											graphical_culture = "reptilian_01"						
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Ravager" #destroyer
											graphical_culture = "avian_01"						
										}
									
									}
									while = {
										count = 2
										create_ship = {							
											name = random
											design = "NAME_Derelict" #cruiser
											graphical_culture = "reptilian_01"						
										}
									
									}
									while = {
										count = 1
										create_ship = {							
											name = random
											design = "NAME_Derelict" #cruiser
											graphical_culture = "humanoid_01"						
										}
									
									}
									set_location = event_target:eye_of_terror_system
									set_fleet_stance = aggressive
									set_aggro_range = 150
									set_aggro_range_measure_from = self
									set_fleet_bombardment_stance = indiscriminate
									closest_system = {
											limit = {
												any_system_planet = {
													exists = owner
													NOR = { 
														has_planet_flag = cultist_raid_target 
														has_modifier = recent_cult_invasion
													}
													num_pops > 25
												}
											}											
										random_system_planet = {
												limit = {
													exists = owner													
													num_pops > 25
												}
												set_timed_planet_flag = {
													flag = cultist_raid_target
													days = 600
												}
												save_event_target_as = cultist_planet
											}
										PREV  = {
											auto_move_to_planet = {
												target = event_target:cultist_planet
												clear_auto_move_on_arrival = no
											}
										}
									}
									
									
								}
							
							}
							
							create_leader = {
								class = admiral
								species = event_target:cultist_raid_fleet_species
								name = random
								skill = 5
								leader_age_min = 25
								leader_age_max = 45
								traits = {
									trait = subclass_admiral_aggressor
									trait = leader_trait_psionic 
								}
							}
							
							random_owned_fleet = {
							limit = {
								has_fleet_flag = cultist_fleet
								NOT = { exists = leader }
							}
							set_leader = last_created_leader
								}
						}
				
					}
					###############################################
					########  Avatar (50k) #############
					###############################################  
					65 = { #15						
						 create_country = {
							name = "NAME_shroud_horror_country"
							type = shroud_horrors
							name_list = "SHROUD_HORRORS"
							flag = {
									icon = {
										category = "special"
										file = "the_shroud.dds"
									}
									background= {
										category = "backgrounds"
										file = "00_solid.dds"
									}
									colors={
										"dark_purple"
										"black"
										"null"
										"null"
									}
								}
							effect = {
									apply_shroud_rising_difficulty = yes
								}
						}			
						last_created_country = {
							
							save_event_target_as = shroud_horror_fleet
						}
						# event to see if will be neutral to a shroud country
						every_country = {
							limit = {
								has_valid_civic = civic_shroud_worship
							}
							country_event = { id = shroud_rising_invasion.10 } #selector for individual cult countries neutrality
						}	
						
						every_country = { establish_communications_no_message = event_target:shroud_horror_fleet }
						country_event = { id = shroud_rising_invasion.51  } #180 choose a Greater Shroud Horror to spawn
						
					}
					
					###############################################
					########  Cosmic Horror (150-200k) #############
					############################################### 
					5 = { #5
						modifier = {
								 factor = 0
								 mid_game_years_passed <= 75						
						 }
						modifier = {
							factor = 3
							end_game_years_passed >= 5							
						}
						modifier = {
							factor = 10
							end_game_years_passed >= 25							
						}
						 create_country = {
							name = "NAME_cosmic_horror_name"
							type = shroud_horrors
							name_list = "SHROUD_HORRORS"
							flag = {
									icon = {
										category = "special"
										file = "the_shroud.dds"
									}
									background= {
										category = "backgrounds"
										file = "00_solid.dds"
									}
									colors={
										"dark_purple"
										"black"
										"null"
										"null"
									}
								}
							effect = {
									apply_shroud_rising_difficulty = yes
								}
							}			
							last_created_country = {
								
								save_global_event_target_as = shroud_horror_fleet
							}							
							
							every_country = { establish_communications_no_message = event_target:shroud_horror_fleet }						
							every_country = {
								limit = { 
									is_ai = no
									OR = {
										has_policy_flag = incursion_alert_all
										has_policy_flag = incursion_alert_major		
										has_policy_flag = incursion_alert_none
									}
												
								}
								country_event = { id = shroud_rising_invasion.2033  } #Incursion Alert	Cosmic horror				
					
					
								}					
								event_target:shroud_horror_fleet = {					
																
									create_fleet = {
											# name = random
											settings = {
												spawn_debris = no
												is_boss = yes 
											}
											effect = {
												set_owner = event_target:shroud_horror_fleet				
												create_ship = {
													name = "NAME_cosmic_horror"
													design = "NAME_cosmic_horror"								
													}						
													
												set_location = event_target:eye_of_terror_system
												set_fleet_stance = aggressive
												set_fleet_bombardment_stance = devour
												set_aggro_range_measure_from = self
												set_aggro_range = 300
												
											
											
											
											}
											
										}
										
										
								}
					}
					###############################################
					########  Ancient God (k) #############
					############################################### 
					1 = {
						modifier = {
							factor = 0
							end_game_years_passed <= 15								
							OR = { 
								has_global_flag = ancient_god_active 
								has_global_flag = ancient_god_defeated 
							}
						}
						modifier = {
							factor = 2
							end_game_years_passed >= 25							
						}
						modifier = {
							factor = 5
							end_game_years_passed >= 50							
						}										
						country_event = { id = shroud_rising_invasion.105 }
							
					}
					
					
					
			}	
		
		
	}
	
	
}

	
# Colony Bombarded by horrors
#20 pops on pre ftl earth = 8 
planet_event = {
	id = shroud_rising_invasion.9
	title = "shroud_rising_invasion.9.name"
	desc = "shroud_rising_invasion.9.desc"
	picture = GFX_evt_shroud_city_ruins
	show_sound = event_ghost_town
	location = ROOT
	is_triggered_only = yes

	trigger = {
		OR = { 
			planet_devastation >= 100
			num_pops <= 1
		}
		FROM = { 
			is_country_type = shroud_horrors 			
		}
	}

	
	immediate = {		
		if = {
			limit = { FROM = { is_country_type = shroud_horrors } }
			every_country = {
				limit = { has_event_chain = "eye_of_terror_incursion_chain" }
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_planets"
					amount = 1
				}
			}
		}		
		owner = {
			add_threat = { who = FROM amount = 1 }
		}
		owner = { 
			save_event_target_as = devour_victim 
			set_country_flag = had_world_devoured
		}
		event_target:devour_victim ={ 
			set_country_flag = world_devoured					
				}
		random_country = {
			limit = { is_country_type = global_event }
			change_variable = {
				which = "shroud_planets"
				value = 1
			}
		}
		if = {
			limit = {
				num_pops >=200
			}
			every_country = {
				limit = {
					has_event_chain = "eye_of_terror_incursion_chain"					
				}
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_victims"
					amount = 200000
				}			
			}
			
		}
		else_if = {
			limit = {
				AND = {
					num_pops >=100
					num_pops <200
				}
			}
			every_country = {
				limit = {
					has_event_chain = "eye_of_terror_incursion_chain"					
				}
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_victims"
					amount = 100000
				}			
			}
			
		}
		else_if = {
			limit = {
				AND = {
					num_pops >50
					num_pops <100
				}
			}
			every_country = {
				limit = {
					has_event_chain = "eye_of_terror_incursion_chain"					
				}
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_victims"
					amount = 50000
				}			
			}
			
		}
		else_if = {
			limit = {
				AND = {
					num_pops >50
					num_pops <25
				}
			}
			every_country = {
				limit = {
					has_event_chain = "eye_of_terror_incursion_chain"					
				}
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_victims"
					amount = 20000
				}			
			}
			
		}
		else_if = {
			limit = {
				AND = {					
					num_pops <=25
				}
			}
			every_country = {
				limit = {
					has_event_chain = "eye_of_terror_incursion_chain"					
				}
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_victims"
					amount = 10000
				}			
			}				
		}		
		destroy_colony = yes
		if = {
			limit = {
				is_artificial = no
			}
			reset_planet = yes
			change_pc = pc_shrouded			
			add_modifier = {
				modifier = "devoured_world"
				days = -1
			}
		}
		else_if = {
			limit = {
				is_ringworld = yes
			}
			reset_planet = yes
			change_pc = pc_ringworld_habitable_damaged			
			add_modifier = {
				modifier = "devoured_world"
				days = -1
			}
		}
		else_if = {
			limit = { is_planet_class = pc_habitat }
			remove_planet = yes
		}
			
	}
	option = {
		name = shroud_rising_invasion.9.a
		# custom_tooltip = shroud_rising_invasion.2.a.tooltip
	}
}	




###############################################
######Shroud Cult Empire events ####################
###############################################

#####event to see if will be neutral to a shroud country
country_event = {
	id = shroud_rising_invasion.10
	hide_window = yes
	is_triggered_only = yes
	

	trigger = {
	}
	
	immediate = {				
			# chance for cult empires to become neutral
			last_created_country = {				
				random_list = {	
					25 = {	
						set_faction_hostility = {
							set_hostile = no
							set_neutral = yes
							target = root
						}
					}
					75 = {
					}
				}
				
			}
			IF = {
				limit = {
					any_country = {
						has_country_flag = eye_of_terror_reopened_country
					}
				}			
				every_country = {
					limit = {
						has_country_flag = eye_of_terror_reopened_country
					}
					save_event_target_as = eye_of_terror_reopened_country
				}					
				#for terror re-opener
				last_created_country = {				
						random_list = {	
							50 = {								
								set_faction_hostility = {
									set_hostile = no
									set_neutral = yes
									target = event_target:eye_of_terror_reopened_country
								}
							}
							50 = {
							}
					}
				}
			}
	}
}	
		

###############################################
######Cultist Invasion Events ####################
###############################################

# ##Colony Bombarded by Cultists
planet_event = {
	id = shroud_rising_invasion.11
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = { 
			planet_devastation = 100
			num_pops <= 2
		}
		FROM = { is_country_type = shroud_cult }
		NOT = { has_modifier = recent_cult_invasion }
	}

	immediate = {  		
		FROM = { 
			random_owned_fleet = {
				save_event_target_as = cult_occupier
				# fleet_event = { id = shroud_rising_invasion.1305 } 
			 }
			 save_event_target_as = cult_occupier_country
			
		}
		planet_event = { id = shroud_rising_invasion.13 } 
		add_modifier = {
				modifier = "recent_cult_invasion"
				days = 730
			}
		set_planet_flag = shroud_cult_invasion
		set_timed_planet_flag = { 
			flag = recent_cult_influence days = 3600 #10 years 
		}
		create_species = {
				name = "NAME_shroud_cultists"
				class = random_non_machine
				name_list = "CULTISTS"
				portrait = random
				traits = random
		}				
		
		create_army = {
			name = "NAME_cultist_army"
			owner = from
			species = last_created_species
			type = "shroud_cultist_army"
		}
		create_army = {
			name = "NAME_cultist_army"
			owner = from
			species = last_created_species
			type = "shroud_cultist_army"
		}	
		create_army = {
			name = "NAME_cultist_army"
			owner = from
			species = last_created_species
			type = "shroud_cultist_army"
		}	
		create_army = {
			name = "NAME_cultist_army"
			owner = from
			species = last_created_species
			type = "shroud_cultist_army"
		}	
		create_army = {
			name = "NAME_cultist_army"
			owner = from
			species = last_created_species
			type = "cultist_slave_army"
		}
		create_army = {
			name = "NAME_cultist_army"
			owner = from
			species = last_created_species
			type = "cultist_slave_army"
		}
		create_army = {
			name = "NAME_cultist_army"
			owner = from
			species = last_created_species
			type = "cultist_slave_army"
		}
		create_army = {
			name = "NAME_cultist_army"
			owner = from
			species = last_created_species
			type = "cultist_psionic_army"
		}	
		create_army = {
			name = "NAME_cultist_army"
			owner = from
			species = last_created_species
			type = "cultist_slave_army"
		}
		create_army = {
			name = "NAME_cultist_army"
			owner = from
			species = last_created_species
			type = "cultist_psionic_army"
		}
		create_army = {
			name = "NAME_cultist_army"
			owner = from
			species = last_created_species
			type = "cultist_psionic_army"
		}
		
		from = {
			create_leader = {
							class = general
							species = last_created_species
							name = random
							skill = 5
							leader_age_min = 25
							leader_age_max = 45
							traits = {
								trait = leader_trait_butcher
								trait = leader_trait_psionic 
							}
						}
			random_owned_army  = {
				limit = {NOT = { exists = leader } }						
				set_leader = last_created_leader
			}
			
		}
	}
	
	
}

# If Cultists win, place cult hub modifier
country_event = {
	id = shroud_rising_invasion.12
	hide_window = yes	
	is_triggered_only = yes	
	
	trigger = {
		this = {
			is_country_type = shroud_cult
		}
		NOT = { 
			fromfrom = {
				has_modifier = cult_stronghold
			}
		}
	}
	
	immediate = {
		this = { save_event_target_as = cultist_victors }
		fromfrom = {
			add_modifier = {
				modifier = "cult_stronghold"				
			}
			set_planet_flag = shroud_cult_occupation #For planetary decision popup
			save_event_target_as = cultist_nest_location
			create_fleet = {			
				name = "cultist_nest"
					effect = {
						set_owner = event_target:cultist_victors
						create_ship = {
							name = "cultist_nest"
							design = "NAME_Pirate_Nest"
							graphical_culture = "pirate_01"
						}
						set_location = event_target:cultist_nest_location
					}
			}
		}
		
	}	
	
}
	
	
# Inform owner, if there is one that his planet is now fucked
planet_event = {
	id = shroud_rising_invasion.13
	title = "shroud_rising_invasion.13.name"
	desc = "shroud_rising_invasion.13.desc"
	picture = GFX_evt_ground_combat
	show_sound = event_ground_battle	
	is_triggered_only = yes
	location = root
	
	trigger = {
		exists = owner
	} 
	
	immediate = {		
		owner = { save_event_target_as = cult_raid_victim }
		event_target:cult_raid_victim ={ 
			set_country_flag = had_world_invaded_by_cult					
				}
	}
	
	option = {
		name = shroud_rising_invasion.13.a
		custom_tooltip = shroud_rising_invasion.13.a.tooltip		
		random_owned_pop = { kill_pop = yes }
		owner = {
			hidden_effect = {
				random_list = {
						# answer 1
						33 = {
							country_event = { id = shroud_rising_invasion.1301  }
						}
						# answer 2
						33 = {
							country_event = { id = shroud_rising_invasion.1303  }
						}
						# answer 3
						33 = {						
							country_event = { id = shroud_rising_invasion.1303  }
						}					
				}	
			}
		}
	}
}

# Cultists Make themselves known v1
country_event = {
	id = shroud_rising_invasion.1301
	title = TRANSMISSION
	desc = "shroud_rising_invasion.1301.desc"

	diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:cult_occupier_country
		planet_background = root
		graphical_culture = root
		room = personality_slaving_despots_room
		city_level = root
	}

	option = {
		name = shroud_rising_invasion.1301.a
		response_text = shroud_rising_invasion.1301.a.response
		is_dialog_only = yes
	}
	option = {
		name = shroud_rising_invasion.1301.b
		response_text = shroud_rising_invasion.1301.b.response
		is_dialog_only = yes
	}
	option = {
		name = shroud_rising_invasion.1301.c
		response_text = shroud_rising_invasion.1301.c.response
	}
}

country_event = {
	id = shroud_rising_invasion.1302
	title = TRANSMISSION
	desc = "shroud_rising_invasion.1302.desc"

	diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:cult_occupier_country
		planet_background = root
		graphical_culture = root
		room = personality_slaving_despots_room
		city_level = root
	}

	option = {
		name = shroud_rising_invasion.1302.a
		response_text = shroud_rising_invasion.1302.a.response
		is_dialog_only = yes
	}
	option = {
		name = shroud_rising_invasion.1302.b
		response_text = shroud_rising_invasion.1302.b.response
		is_dialog_only = yes
	}
	option = {
		name = shroud_rising_invasion.1302.c
		response_text = shroud_rising_invasion.1302.c.response
	}
}

country_event = {
	id = shroud_rising_invasion.1303
	title = TRANSMISSION
	desc = "shroud_rising_invasion.1303.desc"

	diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:cult_occupier_country
		planet_background = root
		graphical_culture = root
		room = personality_slaving_despots_room
		city_level = root
	}

	option = {
		name = shroud_rising_invasion.1303.a
		response_text = shroud_rising_invasion.1303.a.response
		is_dialog_only = yes
	}
	option = {
		name = shroud_rising_invasion.1303.b
		response_text = shroud_rising_invasion.1303.b.response
		is_dialog_only = yes
	}
	option = {
		name = shroud_rising_invasion.1303.c
		response_text = shroud_rising_invasion.1303.c.response
	}
}



#Cleanup if cultist are stuck or have finished bombarding a planet
# country_event = {
	# id = shroud_rising_invasion.1304
	# hide_window = yes	
	# is_triggered_only = yes	
	
	# trigger = {		
		# owner = {
			# is_country_type = shroud_cult	
		# }
		
	# }
	
	# immediate = 
			# {	
			# random_owned_fleet = {
				# limit = {
					# is_fleet_idle = yes	
				# }
				# fleet_event = { id = shroud_rising_invasion.1305 }
			# }
		
		# random_owned_fleet = {
			# limit = {
				# is_fleet_idle = yes
			# }
				# closest_system = {
					# limit = {
						# any_system_planet = {
							# exists = owner
							# NOR = { 
							# has_planet_flag = cultist_raid_target 
							# has_modifier = recent_cult_invasion
							# }
							# num_pops > 0
						# }
					# }											
					# random_system_planet = {
							# limit = {
								# exists = owner													
								# num_pops > 0
							# }
							# set_timed_planet_flag = {
								# flag = cultist_raid_target
								# days = 600
							# }
							# save_event_target_as = new_cultist_raid_target
						# }
					
				# }
				# auto_move_to_planet = {
					# target = event_target:new_cultist_raid_target
					# clear_auto_move_on_arrival = no
				# }	
			
		
		# }
	# }	
	
# }

# fleet_event = {
	# id = shroud_rising_invasion.1305
	# hide_window = yes	
	
	# trigger = {		
		# owner = {
			# is_country_type = shroud_cult
		# }
		# is_fleet_idle = yes		
	# }
	
	# mean_time_to_happen = {
		# months = 1
	# }

	# immediate = {		
		# closest_system = {
			# limit = {
				# any_system_planet = {
					# OR = {					
						# is_colonizable = yes
						# has_owner = yes
					# }	
					# NOR = { 
						# has_planet_flag = cultist_raid_target 
						# has_modifier = recent_cult_invasion
						# has_modifier = cult_stronghold
					# }
				# }
			# }
			# random_system_planet = {
				# limit = {
					# OR = {
						# is_colonizable = yes
						# has_owner = yes
					# }
					# NOR = { 
						# has_planet_flag = cultist_raid_target 
						# has_modifier = recent_cult_invasion
						# has_modifier = cult_stronghold
					# }
				# }
				# save_event_target_as = move_to_planet
			# }
		# }
		# queue_actions = {
			# find_closest_system = {
				# trigger = {
					# id =  shroud_rising_invasion.1305.t1
					# any_system_planet = {
						# is_same_value = event_target:move_to_planet
					# }
				# }
				# found_system = {
					# move_to = this
					# find_closest_planet = {
						# trigger = {
							# id = shroud_rising_invasion.1305.t2
							# is_same_value = event_target:move_to_planet
						# }
						# found_planet = {
							# move_to = this
							# orbit_planet = this							
						# }
					# }
				# }
			# }
			
		# }
	# }
# }

###############################################
######Incursion Announce Events ####################
###############################################


#Small Cult Fleet	
country_event = {
	id = shroud_rising_invasion.2011
	hide_window = no 
	title = "shroud_rising_invasion.2011.name"
	desc = "shroud_rising_invasion.2011.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes
	location = event_target:shroud_incursion_system

	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2011.a
		
		
	}
	
}

#Small Cultist Crusade
country_event = {
	id = shroud_rising_invasion.2012
	hide_window = no 
	title = "shroud_rising_invasion.2012.name"
	desc = "shroud_rising_invasion.2012.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes
	location = event_target:shroud_incursion_system

	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2012.a
		
		
	}
	
}

#Shroud Lesser Horror Entity
country_event = {
	id = shroud_rising_invasion.2021
	hide_window = no 
	title = "shroud_rising_invasion.2021.name"
	desc = "shroud_rising_invasion.2021.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes
	location = event_target:shroud_incursion_system

	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2021.a
		
		
	}
	
}

#Large Lesser Horror Entity Group
country_event = {
	id = shroud_rising_invasion.2022
	hide_window = no 
	title = "shroud_rising_invasion.2022.name"
	desc = "shroud_rising_invasion.2022.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes
	location = event_target:shroud_incursion_system

	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2022.a
		
		
	}
	
}

# announce avatar greater rift
country_event = {
	id = shroud_rising_invasion.2031
	hide_window = no 
	title = "shroud_rising_invasion.2032.name"
	desc = "shroud_rising_invasion.2032.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes
	location = event_target:shroud_incursion_system

	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2032.a
		
		
	}
	
}

# announce avatar EoT
country_event = {
	id = shroud_rising_invasion.2032
	hide_window = no 
	title = "shroud_rising_invasion.2032.name"
	desc = "shroud_rising_invasion.2032.desc"
	picture = GFX_evt_command_center
	show_sound = event_yellow_alert
	is_triggered_only = yes
	location = event_target:shroud_incursion_system

	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2032.a
		
		
	}
	
}

# announce cosmic horror
country_event = {
	id = shroud_rising_invasion.2033
	hide_window = no 
	title = "shroud_rising_invasion.2033.name"
	desc = "shroud_rising_invasion.2033.desc"
	picture = GFX_evt_eye_of_terror_god_2  #GFX_evt_space_monster_shroud
	show_sound = event_yellow_alert
	is_triggered_only = yes
	location = event_target:shroud_incursion_system

	immediate = {		
		
	}

	option = {
		name = shroud_rising_invasion.2033.a
		
		
	}
	
}


###############################################
######Death Counter Events (Hidden) ####################
###############################################

# Shroud Entities Death Count (HIDDEN)
country_event = {
	id = shroud_rising_invasion.100
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		OR = {
			is_country_type = shroud_entities 
			is_country_type = shroud_horrors 
			is_country_type = shroud_cult
		} 
	}

	immediate = {
		if = {
			limit = {
				OR = {
											
						is_country_type = shroud_entities 
						is_country_type = shroud_horrors 
						is_country_type = shroud_cult
				} 
				FROM = { has_event_chain = "eye_of_terror_incursion_chain" }
			}
			FROM = {
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_kills_us"
					amount = 1
				}
			}
		}	
		
	}
}


# Shroud Entities Victims (HIDDEN)
country_event = {
	id = shroud_rising_invasion.101
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		OR = {
					
			is_country_type = shroud_entities 
			is_country_type = shroud_horrors 
			is_country_type = shroud_cult
			} 		
	}

	immediate = {
		if = {
			limit = {
				OR = {
						
						is_country_type = shroud_entities 
						is_country_type = shroud_horrors 
						is_country_type = shroud_cult
				} 
				FROM = { has_event_chain = "eye_of_terror_incursion_chain" }
			}
			FROM = {
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_victims_us"
					amount = 1
				}
			}
		}
		
		if = {
			limit = { 
				OR = {
						
						is_country_type = shroud_entities 
						is_country_type = shroud_horrors 
						is_country_type = shroud_cult
				} 
			}
			every_country = {
				limit = {
					has_event_chain = "eye_of_terror_incursion_chain"
					#NOT = { is_same_value = FROM }
				}
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_victims"
					amount = 1
				}
			}
		}
		
	}
}

# Shroud Entities Armies killed (HIDDEN)
country_event = {
	id = shroud_rising_invasion.102
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		
			from = { 
				OR = {
					army_type = shroud_cultist_army  
					army_type = shroud_horror_army_1 
					army_type = shroud_horror_army_2 
					army_type = shroud_greater_horror_army 
					army_type = cultist_slave_army 
					army_type = cultist_psionic_army 					
				} 
			}
	}

	immediate = {
		if = {
			limit = {				
				FromFrom = { has_event_chain = "eye_of_terror_incursion_chain" }
			}
			FromFrom = {
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_kills_us"
					amount = 1
				}
			}
		}
	
	}
}

# Shroud Entities Army Victims (HIDDEN)
country_event = {
	id = shroud_rising_invasion.103
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		fromfrom = {		
			OR = {						
				is_country_type = shroud_entities 
				is_country_type = shroud_horrors 
				is_country_type = shroud_cult
				} 
		}
	}

	immediate = {
		if = {			
			limit = {				
				this = { has_event_chain = "eye_of_terror_incursion_chain" }
			}
			this  = {
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_army_victims"
					amount = 1
				}
			}
		}
		
		if = {
			
			every_country = {
				limit = {
					has_event_chain = "eye_of_terror_incursion_chain" 	
					#NOT = { is_same_value = prev }
				}	
				add_event_chain_counter = {
					event_chain = "eye_of_terror_incursion_chain"
					counter = "shroud_entities_victims"
					amount = 1
				}
			}
		}
	
	
	}
}

###############################################
###### Ancient God Events ####################
###############################################


# Spawn Ancient God 
country_event = {
	id = shroud_rising_invasion.105
	hide_window = yes
	#fire_only_once = yes
	is_triggered_only = yes
	
	
	trigger = {
		#mid_game_years_passed >= 50
		has_global_flag = eye_of_terror_open
		NOT = { has_global_flag = eye_of_terror_sealed }
		NOT = { has_global_flag = ancient_god_active }
		NOT = { has_global_flag = ancient_god_defeated }
	}

	immediate = {	
		set_global_flag = ancient_god_active 
		every_country = {
			limit = { 
				OR = {
					is_country_type = default 
					is_gestalt  = yes
					is_regular_empire = yes
					
					}
			}			
			country_event = { id = shroud_rising_invasion.106 } #announce to galaxy			
		}	
		
		# limit = { NOT = { exists = event_target:shroud_god_country } }
		create_country = {
			name = "NAME_ancient_god_name"
			type = "shroud_horrors"
			name_list = "SHROUD_HORRORS"
			flag = {
				icon = {
					category = "special"
					file = "the_shroud.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"dark_purple"
					"black"
					"null"
					"null"
				}
			}
			effect = {
				apply_shroud_rising_difficulty = yes
			}
		}			
		
		last_created_country = {			
			save_global_event_target_as = shroud_god_country
			#country_event = { id = shroud_rising_invasion.1055 } #add threat
		}
		
		every_country = { establish_communications_no_message = event_target:shroud_god_country }		
		
		create_fleet = {
			# name = random
			settings = {
				spawn_debris = no
				is_boss = yes
			}
			effect = {
				set_owner = event_target:shroud_god_country				
				create_ship = {
					name = "NAME_ancient_god_ship_name"
					design = "NAME_ancient_god"								
					}						
					
				set_location = event_target:eye_of_terror_system
				set_fleet_stance = aggressive
				set_fleet_bombardment_stance = devour
				set_aggro_range_measure_from = self
				set_aggro_range = 500
				set_fleet_flag = ancient_god		
			
			}
			
		}
				
		
	}
}

#Announce Ancient God Spawn
# country_event = {
	# id = shroud_rising_invasion.1055
	# hide_window = yes 	
	# is_triggered_only = yes
	

	# trigger = {		
	
	# }

	# immediate = {	
		# add_threat = { who = ROOT amount = 500 }
	# }

	
	
# }

	
# Announce Ancient God Spawn
country_event = {
	id = shroud_rising_invasion.106
	hide_window = no 
	title = "shroud_rising_invasion.106.name"
	desc = "shroud_rising_invasion.106.desc"
	picture = GFX_evt_eye_of_terror_god
	show_sound = event_red_alert
	is_triggered_only = yes
	location = event_target:eye_of_terror_system

	trigger = {		
	
	}

	immediate = {				
	}

	option = {
		name = shroud_rising_invasion.106.a
		custom_tooltip = shroud_rising_invasion.106.a.tooltip
		add_modifier = { modifier = god_voices }
	}
	
}


# Ancient God Defeated (HIDDEN)
country_event = {
	id = shroud_rising_invasion.107
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		is_country_type = shroud_horrors
		fromfrom = {			
			fleet = { 
				num_ships = 0 
				has_fleet_flag = ancient_god
				}
			
		}		
	}

	immediate = {		
		set_timed_global_flag = { flag = ancient_god_defeated days = 9000 } #25 years 
		remove_global_flag = ancient_god_active
		from = { save_event_target_as = ancient_god_destroyer }
		fromfrom = { fleet = { save_event_target_as = ancient_god } }
		fromfrom = {
			solar_system = { save_event_target_as = ancient_god_death_system }			
		}
		event_target:ancient_god_destroyer = {
			set_timed_country_flag = {
				flag = ancient_god_destroyer #for special reward
				days = 200
			}
		}
		every_country = {
			limit = { 
				OR = {	
						is_regular_empire = yes
						is_gestalt  = yes
					}
				NOT = { has_civic = civic_shroud_worship }
			}
			remove_modifier = god_voices 			
			country_event = { id = shroud_rising_invasion.108 }
		}
		every_country = {
			limit = { 				
				has_civic = civic_shroud_worship 
			}
			remove_modifier = god_voices 			
			country_event = { id = shroud_rising_invasion.108 }
		}		
		every_playable_country = {
				limit = {
					NOR = { 
						is_same_value = from
						has_civic = civic_shroud_worship
						}
					OR = {	
						is_regular_empire = yes
						is_gestalt  = yes
					}
				}
				
				add_opinion_modifier = {
					who = event_target:ancient_god_destroyer
					modifier = opinion_defeated_ancient_god
				}
		}
	}
}

# God defeated killer message
country_event = {
	id = shroud_rising_invasion.108
	title = "shroud_rising_invasion.108.name"
	desc = "shroud_rising_invasion.108.desc"
	picture = GFX_evt_crisis_defeated
	show_sound = event_celebration
	location = event_target:ancient_god_death_system
	is_triggered_only = yes

	option = {
		name = shroud_rising_invasion.108.a		
		IF = {
			limit = {
				NOT = { has_civic = civic_shroud_worship }
			}
			add_modifier = { modifier = ancient_god_defeated days = 3600 }
		}
	}
	option = {
		name = shroud_rising_invasion.108.b	
		 exclusive_trigger = {
				has_civic = civic_shroud_worship
		 }		
	}
	option = {
		name = shroud_rising_invasion.108.c
		 exclusive_trigger = {
				has_country_flag = ancient_god_destroyer
				NOT = {	has_civic = civic_shroud_worship }
		 }		
		add_modifier = { modifier = ancient_god_destroyer days = 9000 }
		add_monthly_resource_mult = {
				resource = unity
				value = 120
				min = 240
				max = 9999
		}
		add_resource = { influence = 300 }
		add_relic = r_god_heart 
	}
	
	
}

# Spawns an ancient god after 15 planets devoured (if not already currently spawned)
event = {
	id = shroud_rising_invasion.109
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {		
		has_global_flag = eye_of_terror_open
		NOT = { has_global_flag = eye_of_terror_sealed }
		NOT = { has_global_flag = ancient_god_defeated }
		NOT = { has_global_flag = ancient_god_active }		
		any_country = {
			AND = {
				is_country_type = global_event
				check_variable = { 
					which = shroud_planets 
					value >= 15
				}	
			}
		}
	}

	immediate = {				
		every_country = {
			limit = { is_country_type = global_event }
			country_event = { id = shroud_rising_invasion.105 days = 5 }		
		}	
		
	}
}