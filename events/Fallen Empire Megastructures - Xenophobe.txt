namespace = femegasphobe

event = {
	id = femegasphobe.1
	hide_window = yes
	
	fire_only_once = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = femegasinit_happened_phobe }
	}
	
	immediate = {
		random_country = {
			limit = { is_country_type = fallen_empire }
			country_event = { id = femegasphobe.2 days = 1 }
		}
	}
}

country_event = {
	id = femegasphobe.2
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = femegasinit_happened_phobe }
	}
	
	immediate = {
		every_country = {
			limit = {
				is_country_type = fallen_empire
				has_ethic = ethic_fanatic_xenophobe
			}
			random_list = {
				50 = {
					country_event = { id = femegasphobe.10 }
				}
				50 = {
					modifier = {
						factor = 0
						NOT = { has_global_flag = gigastructures_enabled }
					}
					country_event = { id = femegasphobe.20 }
				}
			}
		}
		set_global_flag = femegasinit_happened_phobe
	}
}

country_event = { #economic powerhouse
	id = femegasphobe.10
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = fallen_empire
		has_ethic = ethic_fanatic_xenophobe
	}
	
	immediate = {
		random_system_within_border = {
			limit = { NOT = { any_system_planet = { habitable_planet = yes } } }
			random_system_planet = {
				limit = { is_star = yes }
				solar_system = {
					random_list = {
						9 = {
							spawn_megastructure = {
								type = dyson_sphere_ruined
								coords_from = PREV
								owner = ROOT
							}
						}
						1 = {
							spawn_megastructure = {
								type = dyson_sphere_5
								coords_from = PREV
								owner = ROOT
							}
						}
					}
				}
			}
		}
		country_event = { id = femegasphobe.11 }
	}
}

country_event = {
	id = femegasphobe.11
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = fallen_empire
		has_ethic = ethic_fanatic_xenophobe
		has_global_flag = gigastructures_enabled
	}
	
	immediate = {
		save_event_target_as = xenophobic_fe
		capital_scope = {
			spawn_system = {
				min_distance = 10
				max_distance = 30
				initializer = xenophobe_neutron_star
				hyperlane = yes
				is_discovered = yes
			}
		}
	}
}

country_event = { #genocidal
	id = femegasphobe.20
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = fallen_empire
		has_ethic = ethic_fanatic_xenophobe
		has_global_flag = gigastructures_enabled
	}
	
	immediate = {
		random_system_within_border = {
			limit = { NOT = { any_system_planet = { habitable_planet = yes } } }
			random_system_planet = {
				limit = { is_star = yes }
				solar_system = {
					spawn_megastructure = {
						type = FEM_ndb
						coords_from = PREV
						owner = ROOT
					}
				}
				set_planet_flag = nicoll_soon
			}
			set_star_flag = nicoll_beam_built
			set_star_flag = has_giga
			every_system_planet = {
				limit = { is_star = no }
				remove_planet = yes
			}
			set_asteroid_belt = {
				radius = 0
			}
		}
		add_modifier = { modifier = fe_has_mega days = -1 }
		
		change_government = { #change government to change personality
			authority = auth_imperial
			civics = {
				civic = civic_lethargic_leadership
				civic = civic_empire_in_decline
				civic = civic_genocidal_fe
			}
		}
		
		create_fleet = { #give colossus
			name = "Destroyer"
			effect = {
				create_ship = {
					name = random
					design = NAME_Reaper
					prefix = yes
					graphical_culture = fallen_empire_04
				}
				set_owner = ROOT
				set_location = ROOT.capital_scope
			}
		}
	}
}

country_event = { #updates on awakening
	id = femegasphobe.100
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_civic = civic_genocidal_fe
			has_civic = civic_genocidal_ae
		}
	}
	
	immediate = {
		every_owned_megastructure = {
			if = {
				limit = { is_megastructure_type = FEM_ndb }
				upgrade_megastructure_to = nicoll_beam_4
			}
		}
		if = {
			limit = { NOT = { any_owned_ship = { is_ship_size = colossus } } }
			create_fleet = {
				name = "Destroyer"
				effect = {
					create_ship = {
						name = random
						design = NAME_Reaper
						prefix = yes
					}
					set_owner = ROOT
					set_location = ROOT.capital_scope
				}
			}
		}
	}
}

country_event = {
	id = femegasphobe.101
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOR = {
			has_civic = civic_genocidal_fe
			has_civic = civic_genocidal_ae
		}
	}
	
	immediate = {
		every_owned_megastructure = {
			if = {
				limit = { is_megastructure_type = neutronium_gigaforge_ruined }
				upgrade_megastructure_to = neutronium_gigaforge_restored
			}
			else_if = {
				limit = { is_megastructure_type = dyson_sphere_ruined }
				upgrade_megastructure_to = dyson_sphere_restored
			}
			else_if = {
				limit = { is_megastructure_type = particle_accelerator_ruined }
				upgrade_megastructure_to = particle_accelerator_restored
			}
			else_if = {
				limit = { is_megastructure_type = engineering_megabase_ruined }
				upgrade_megastructure_to = engineering_megabase_restored
			}
		}
	}
}