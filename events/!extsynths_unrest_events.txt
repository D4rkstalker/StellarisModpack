namespace = unrest

# Initial rebels manage to take control of the planet, happens before the new owner is set, after the war is created.
# This = Rebel Country
# From = Planet
country_event = {
	id = unrest.4210
	hide_window = yes

	is_triggered_only = yes

	trigger = { has_country_flag = standard_unrest_rebels }

	immediate = {
		From = { 
			remove_planet_flag = revolt_in_progress 
			save_event_target_as = nationalist_revolt_planet
			solar_system = {
				starbase = {
					set_owner = root
				}
			}
		}
		create_leader = {
			class = ruler
			species = owner_main_species
			name = random
			skill = 2
			traits = {}
		}
		assign_leader = last_created_leader
		ruler = {
			add_random_leader_trait = yes
		}
		from.owner = {
			save_event_target_as = rebelled_against
			country_event = { id = unrest.4211 }
		}
		from = {
			add_modifier = { 
				modifier = insurgents_free
				days = 7200
			}
			solar_system = {
				add_claims = {
					who = event_target:rebelled_against
					num_of_claims = 1
					show_notification = no
				}
			}
		}
		if = {
			limit = {
				any_country = {
					is_same_species = root
					is_mechanical_empire = yes
				}
			}
			random_country = {
				limit = {
					is_same_species = root
					is_mechanical_empire = yes
				}
				save_event_target_as = fatherland
			}
			event_target:fatherland = {
				country_event = { id = unrest.4220 days = 5 } # request incorporation
			}
		}
		else_if = {
			limit = {
				from = {
					has_planet_flag = nationalist_revolt
				}
			}
			random_country = {
				limit = {
					from = {
						is_original_owner = prev
					}
				}
				save_event_target_as = fatherland
			}
			event_target:fatherland = {
				country_event = { id = unrest.4220 days = 5 } # request incorporation
			}
			from = { remove_planet_flag = nationalist_revolt }
		}
		else = {
			from = { remove_planet_flag = secessionist_revolt }
		}
	}
}