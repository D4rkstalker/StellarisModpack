namespace = ag_interaction

country_event = {
	id = ag_interaction.12
	title = "ag_interaction.12.name"
	desc = "ag_interaction.12.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_yellow_alert
	location = event_target:fallen_empire_kuat.capital_scope
	
	mean_time_to_happen = { years = 3 }
	fire_only_once = yes

	trigger = {
		has_global_flag = install_kuat_mod
		event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty_temp value > 2 } }
		has_global_flag = ag_aneient_beta_psionic_effect_ended
		exists = event_target:ag_ancient_beta_shielded_world
		event_target:ag_ancient_beta_shielded_world = {
			exists = owner
			owner = { is_same_value = root }
			has_building = ag_ancient_beta_archive
			has_ground_combat = no
			ag_has_researcher = yes
		}
	}

	immediate = {
		event_target:global_event_country = {
			change_variable = { which = ag_kae_event_counter value = 1 }
			if = {
				limit = { check_variable = { which = ag_kae_event_counter value = 4 } }
				set_variable = { which = ag_kae_event_counter value = 0 }
				root = { set_country_flag = ag_kae_interaction_flag }
			}
		}
		every_system = {
			limit = {
				OR = {
					has_star_flag = Kuat_system
					has_star_flag = Kuat_system_1
					has_star_flag = Kuat_system_2
					has_star_flag = Kuat_system_3
				}
			}
			ag_set_kae_interaction_ringworlds = yes
		}
	}

	option = { name = "ag_interaction.12.a" }
}
country_event = {
	id = ag_interaction.13
	title = "ag_interaction.13.name"
	desc = "ag_interaction.13.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_yellow_alert
	location = event_target:fallen_empire_kuat.capital_scope
	
	mean_time_to_happen = { years = 3 }
	fire_only_once = yes

	trigger = {
		has_global_flag = install_kuat_mod
		event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty_temp value > 2 } }
		has_global_flag = ag_gamma_crisis_ended
		exists = event_target:ag_ancient_gamma_shielded_world
		event_target:ag_ancient_gamma_shielded_world = {
			exists = owner
			owner = { is_same_value = root }
			has_planet_flag = ag_gamma_shielded_world_colonized
			OR = {
				has_building = ag_ancient_gamma_nexus_0
				has_building = ag_ancient_gamma_nexus_1
			}
			has_ground_combat = no
			ag_has_researcher = yes
		}
	}

	immediate = {
		event_target:global_event_country = {
			change_variable = { which = ag_kae_event_counter value = 1 }
			if = {
				limit = { check_variable = { which = ag_kae_event_counter value = 4 } }
				set_variable = { which = ag_kae_event_counter value = 0 }
				root = { set_country_flag = ag_kae_interaction_flag }
			}
		}
		every_system = {
			limit = {
				OR = {
					has_star_flag = Kuat_system
					has_star_flag = Kuat_system_1
					has_star_flag = Kuat_system_2
					has_star_flag = Kuat_system_3
				}
			}
			ag_set_kae_interaction_ringworlds = yes
		}
	}

	option = { name = "ag_interaction.13.a" }
}
country_event = {
	id = ag_interaction.14
	title = "ag_interaction.14.name"
	desc = "ag_interaction.14.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_yellow_alert
	location = event_target:fallen_empire_kuat.capital_scope
	
	mean_time_to_happen = { years = 3 }
	fire_only_once = yes

	trigger = {
		has_global_flag = install_kuat_mod
		event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty_temp value > 2 } }
		exists = event_target:ag_ancient_delta_shielded_world
		event_target:ag_ancient_delta_shielded_world = {
			exists = owner
			owner = { is_same_value = root has_country_flag = ag_delta_41_fired }
			has_planet_flag = ag_delta_40_fired
			has_building = ag_ancient_delta_archive
			has_ground_combat = no
			ag_has_researcher = yes
		}
	}

	immediate = {
		event_target:global_event_country = {
			change_variable = { which = ag_kae_event_counter value = 1 }
			if = {
				limit = { check_variable = { which = ag_kae_event_counter value = 4 } }
				set_variable = { which = ag_kae_event_counter value = 0 }
				root = { set_country_flag = ag_kae_interaction_flag }
			}
		}
		every_system = {
			limit = {
				OR = {
					has_star_flag = Kuat_system
					has_star_flag = Kuat_system_1
					has_star_flag = Kuat_system_2
					has_star_flag = Kuat_system_3
				}
			}
			ag_set_kae_interaction_ringworlds = yes
		}
	}

	option = { name = "ag_interaction.14.a" }
}
country_event = {
	id = ag_interaction.17
	title = "ag_interaction.17.name"
	desc = "ag_interaction.17.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_yellow_alert
	location = event_target:fallen_empire_kuat.capital_scope
	
	mean_time_to_happen = { years = 3 }
	fire_only_once = yes

	trigger = {
		has_global_flag = install_kuat_mod
		event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty_temp value > 2 } }
		has_global_flag = ag_zeta_crisis_ended
		exists = event_target:ag_zeta_shrouded_planet
		event_target:ag_zeta_shrouded_planet = {
			exists = owner
			owner = { is_same_value = root }
		}
	}

	immediate = {
		event_target:global_event_country = {
			change_variable = { which = ag_kae_event_counter value = 1 }
			if = {
				limit = { check_variable = { which = ag_kae_event_counter value = 4 } }
				set_variable = { which = ag_kae_event_counter value = 0 }
				root = { set_country_flag = ag_kae_interaction_flag }
			}
		}
		every_system = {
			limit = {
				OR = {
					has_star_flag = Kuat_system
					has_star_flag = Kuat_system_1
					has_star_flag = Kuat_system_2
					has_star_flag = Kuat_system_3
				}
			}
			ag_set_kae_interaction_ringworlds = yes
		}
	}

	option = { name = "ag_interaction.17.a" }
}

country_event = {
	id = ag_interaction.101
	title = "ag_interaction.101.name"
	desc = "ag_interaction.101.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	location = event_target:fallen_empire_kuat.capital_scope
	mean_time_to_happen = { years = 1 }
	fire_only_once = yes
	trigger = {
		has_global_flag = install_kuat_mod
		event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty_temp value > 2 } }
		has_country_flag = ag_kae_interaction_flag
		end_game_years_passed >= 20
	}

	option = {
		name = "ag_interaction.101.a"
		custom_tooltip = "ag_interaction.101.a.tooltip"
		hidden_effect = {
			if = {
				limit = {
					exists = event_target:fallen_empire_kuat
					NOT = { is_at_war_with = event_target:fallen_empire_kuat }
				}
				country_event = { id = ag_interaction.102 days = 5 random = 5 }
			}
			else = { country_event = { id = ag_interaction.103 days = 8 random = 5 } }
		}
	}
	option = {
		name = "ag_interaction.101.b"
		custom_tooltip = "ag_interaction.101.b.tooltip"
	}
}
country_event = {
	id = ag_interaction.102
	title = "ag_interaction.102.name"
	desc = "ag_interaction.102.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	picture_event_data = {
		portrait = event_target:fallen_empire_kuat.ruler
		planet_background = pc_ringworld_habitable
		graphical_culture = fallen_empire_01
		city_level = event_target:fallen_empire_kuat
		room = personality_fallen_empire_cyan_room
	}
	is_triggered_only = yes
	
	option = {
		name = "ag_interaction.102.a"
		response_text = "ag_interaction.102.a.response"
		hidden_effect = {
			event_target:fallen_empire_kuat = {
				if = {
					limit = { NOT = { is_at_war_with = root } }
					declare_war = {
						target = root
						name = "War of Ancient Rings"
						attacker_war_goal = Kuat_total_war 
					}
				}
			}
			country_event = { id = ag_interaction.103 days = 3 }
		}
	}
}
country_event = {
	id = ag_interaction.103
	title = "ag_interaction.103.name"
	desc = "ag_interaction.103.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_red_alert
	location = event_target:ag_target_planet
	is_triggered_only = yes

	immediate = {
		set_global_flag = ag_interaction_103_fired
		country_event = { id = ag_interaction.111 days = 5 random = 5 }
		every_country = {
			limit = { NOT = { is_same_value = root } }
			country_event = { id = ag_interaction.104 }
		}
		random_system = {
			limit = { has_star_flag = Kuat_system }
			random_system_planet = {
				limit = { has_planet_flag = kuat_system_ring_1 }
				save_event_target_as = ag_target_planet
			}
		}
		every_system = {
			limit = {
				OR = {
					has_star_flag = Kuat_system
					has_star_flag = Kuat_system_1
					has_star_flag = Kuat_system_2
					has_star_flag = Kuat_system_3
				}
			}
			every_system_planet = {
				limit = {
					OR = {
						has_planet_flag = kuat_system_ring_1
						has_planet_flag = kuat_system_ring_4
						has_planet_flag = kuat_system_ring_7
						has_planet_flag = kuat_system_ring_10
						AND = { is_star = no ag_is_ringworld = no }
					}
				}
				ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
				random_list = {
					10 = { add_planet_devastation = 5 }
					10 = { add_planet_devastation = 10 }
					10 = { add_planet_devastation = 15 }
					10 = { add_planet_devastation = 20 }
					10 = { add_planet_devastation = 25 }
				}
				every_owned_pop = { kill_pop = yes }
				destroy_colony = yes
			}
			every_fleet_in_system = { limit = { exists = this } ag_spawn_explosion_effect = { ag_scale = xl ag_color = red } destroy_fleet = this }
		}
		if = {
			limit = { exists = event_target:fallen_empire_kuat }
			event_target:fallen_empire_kuat = {
				event_target:kuat_shipyard_country = { destroy_country = yes }
				every_owned_fleet = { limit = { exists = this } ag_spawn_explosion_effect = { ag_scale = xl ag_color = red } destroy_fleet = this }
				destroy_country = yes
			}
		}
		country_event = { id = executor_build.6 days = 2 }
	}

	option = { name = "ag_interaction.103.a" }
}
country_event = {
	id = ag_interaction.104
	title = "ag_interaction.104.name"
	desc = "ag_interaction.104.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_red_alert
	location = event_target:ag_target_planet
	is_triggered_only = yes
	immediate = { country_event = { id = ag_interaction.111 days = 5 random = 5 } }
	option = { name = "ag_interaction.104.a" }
}

country_event = {
	id = ag_interaction.111
	title = "ag_interaction.111.name"
	desc = "ag_interaction.111.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_ringworld_room }
	show_sound = event_sensor_ping
	is_triggered_only = yes
	option = { name = "ag_interaction.111.a" }
}
country_event = {
	id = ag_interaction.112
	title = "ag_interaction.112.name"
	desc = "ag_interaction.112.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ringworld_room }
	show_sound = event_mystic_reveal
	mean_time_to_happen = { years = 1 }
	trigger = {
		has_global_flag = install_kuat_mod
		event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty_temp value > 2 } }
		has_global_flag = ag_interaction_103_fired
		NOT = { has_country_flag = ag_interaction_112_fired }
	}
	immediate = { set_country_flag = ag_interaction_112_fired }

	option = {
		name = "ag_interaction.112.a"
		custom_tooltip = "ag_interaction.112.a.tooltip"
		hidden_effect = {
			random_list = {
				10 = { ag_give_research_project = { ag_project_id = @ag_kag_annihilator_project_id ag_progress = 5 } }
				10 = { ag_give_research_project = { ag_project_id = @ag_kag_annihilator_project_id ag_progress = 7.5 } }
				10 = { ag_give_research_project = { ag_project_id = @ag_kag_annihilator_project_id ag_progress = 10 } }
				10 = { ag_give_research_project = { ag_project_id = @ag_kag_annihilator_project_id ag_progress = 12.5 } }
				10 = { ag_give_research_project = { ag_project_id = @ag_kag_annihilator_project_id ag_progress = 15 } }
			}
		}
	}
	option = {
		name = "ag_interaction.112.b"
		add_resource = { influence = 120 }
	}
}
country_event = {
	id = ag_interaction.113
	title = "ag_interaction.113.name"
	desc = "ag_interaction.113.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_sensor_ping
	is_triggered_only = yes
	option = {
		name = "ag_interaction.113.a"
		add_research_option = tech_ag_kag_annihilator
		add_tech_progress = { tech = tech_ag_kag_annihilator progress = 0.15 }
	}
}
country_event = {
	id = ag_interaction.114
	hide_window = yes
	is_triggered_only = yes
	trigger = { last_increased_tech = tech_ag_kag_annihilator }
	immediate = {
		create_ship_design = { design = "NAME_KUAT_Annihilator" }
		add_ship_design = last_created_design
	}
}