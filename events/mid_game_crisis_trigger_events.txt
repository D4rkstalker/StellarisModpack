######################################
#
# Mid-Game Crisis Triggering Events
#
######################################

namespace = lode_runner_midgame_crisis_trigger

event = {							# Mid Game
	id = lode_runner_midgame_crisis_trigger.1
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		mid_game_years_passed >= 0
		OR = {
			NOT = { has_global_flag = mid_game_crisis_happened }			# one allowed mid game crisis fires
			AND = {															# allowed crises fire one after another
				has_global_flag = all_midgame_consecutive 
				NOR = {
					has_global_flag = mid_game_crisis_happened_recently 
					has_global_flag = midgame_crisis_ongoing
				}
			}
			AND = {															# allows one crisis to start every 15 years
				has_global_flag = all_midgame_allowed 
				NOT = {
					has_global_flag = mid_game_crisis_happened_recently 
				}
			}
		}
	}

	immediate = {
		log = "mid game crisis triggered"
		random_country = {
			limit = { is_country_type = global_event } # global_event country is always around
			change_variable = {
				which = firings
				value = 1
			}
			log = "mid game crisis firings [this.firings]"
			reroll_random = yes
			random_list = {
				### The Harvest Engine - 2908936086 ###
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = harvester_allowed
						}
					}
					modifier = {
						factor = 0
						has_global_flag = harvester_in_progress
					}
					modifier = {
						factor = 0
						has_global_flag = harvester_fired
					}
					log = "begin crisis The Harvest Engine"
					begin_crisis_harvester = yes
				}
				### The Prime Flesh - 2909515514 ###
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = PF22_allowed
						}
					}
					modifier = {
						factor = 0
						has_global_flag = PF22_in_progress
					}
					modifier = {
						factor = 0
						has_global_flag = PF22_fired
					}
					log = "begin crisis The Prime Flesh"
					begin_crisis_PF22 = yes
				}
				### Loud but Deadly - 2910377370 ###
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = lbd_dathnak_allowed
						}
					}
					modifier = {
						factor = 0
						has_global_flag = lbd_dathnak_in_progress
					}
					modifier = {
						factor = 0
						has_global_flag = lbd_dathnak_fired
					}
					log = "begin crisis Loud But Deadly"
					begin_crisis_lbd_dathnak = yes
				}
				### The Interdimensional Crate - 2911807722 ###
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = lootbox_allowed
						}
					}
					modifier = {
						factor = 0
						has_global_flag = lootbox_in_progress
					}
					modifier = {
						factor = 0
						has_global_flag = lootbox_fired
					}
					log = "begin crisis Interdimensional Crate"
					begin_crisis_lootbox = yes
				}
				### The Replicators - https://steamcommunity.com/sharedfiles/filedetails/?id=2913480499 ###
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = replicators_allowed
						}
					}
					modifier = {
						factor = 0
						has_global_flag = replicators_in_progress
					}
					modifier = {
						factor = 0
						has_global_flag = replicators_fired
					}
					log = "begin crisis Replicators"
					begin_crisis_replicators = yes
				}
				### The Great Famine - https://steamcommunity.com/sharedfiles/filedetails/?id=2912105123
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = TGF_allowed
						}
					}
					modifier = {
						factor = 0
						has_global_flag = TGF_Main_in_progress
					}
					modifier = {
						factor = 0
						has_global_flag = TGF_fired
					}
					log = "begin crisis The Great Famine"
					begin_crisis_TGF = yes
				}
				### The Chrimson Throng - https://steamcommunity.com/sharedfiles/filedetails/?id=2911573696
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = projcrim_allowed
						}
					}
					modifier = {
						factor = 0
						has_global_flag = projcrim_in_progress
					}
					modifier = {
						factor = 0
						has_global_flag = projcrim_fired
					}
					log = "begin crisis The Crimson Throng"
					begin_crisis_projcrim = yes
				}
				### Sleeper Worms - https://steamcommunity.com/sharedfiles/filedetails/?id=2914378748
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = sw22_allowed
						}
					}
					modifier = {
						factor = 0
						has_global_flag = sw22_in_progress
					}
					modifier = {
						factor = 0
						has_global_flag = sw22_fired
					}
					log = "begin crisis The Crimson Throng"
					begin_crisis_sw22 = yes
				}
				### The Song of Flesh - https://steamcommunity.com/sharedfiles/filedetails/?id=2915050509
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = fleshsong_allowed							
						}
					}
					modifier = {
						factor = 0
						has_global_flag = fleshsong_in_progress 
					}
					modifier = {
						factor = 0
						has_global_flag = fleshsong_fired 
					}
					log = "begin crisis The Song of Flesh"
					begin_crisis_fleshsong = yes
				}
				### Cybrex Resurgence - https://steamcommunity.com/sharedfiles/filedetails/?id=2914709328
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = cycris_allowed							
						}
					}
					modifier = {
						factor = 0
						has_global_flag = cycris_in_progress 
					}
					modifier = {
						factor = 0
						has_global_flag = cycris_fired 
					}
					log = "begin crisis Cybrex Resurgence"
					begin_crisis_cycris = yes
				}
				### Galactic Bio Hazard - https://steamcommunity.com/sharedfiles/filedetails/?id=2914960436
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = cgb_allowed							
						}
					}
					modifier = {
						factor = 0
						has_global_flag = cgb_in_progress 
					}
					modifier = {
						factor = 0
						has_global_flag = cgb_fired 
					}
					log = "begin crisis Galactic Bio Hazard"
					begin_crisis_cgb = yes
				}
				### The Storm Cluster - https://steamcommunity.com/sharedfiles/filedetails/?id=2915166985
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = scluster_allowed		
						}
					}
					modifier = {
						factor = 0
						has_global_flag = scluster_in_progress	
					}
					modifier = {
						factor = 0
						has_global_flag = scluster_fired	
					}
					log = "begin crisis The Storm Cluster"
					begin_crisis_scluster = yes
				}
				### Tiyanki Resurgence - https://steamcommunity.com/sharedfiles/filedetails/?id=2915146237
				100 = {
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = tiyres_allowed							
						}
					}
					modifier = {
						factor = 0
						has_global_flag = tiyres_in_progress 
					}
					modifier = {
						factor = 0
						has_global_flag = tiyres_fired 
					}
					log = "begin crisis Tiyanki Resurgence"
					begin_crisis_tiyres = yes
				}
				### Hyperlane Collapse - https://steamcommunity.com/sharedfiles/filedetails/?id=2915024151
				0 = {					# TODO fix this if it gets done in time
					modifier = {
						factor = 0
						NOT = {
							has_global_flag = cahlcollaps_allowed							
						}
					}
					modifier = {
						factor = 0
						has_global_flag = cahlcollaps_in_progress 
					}
					modifier = {
						factor = 0
						has_global_flag = cahlcollaps_fired 
					}
					log = "begin crisis Hyperlane Collapse"
					begin_crisis_cahlcollaps = yes
				}
	
				1 = {
					log = "No Outcome"
				}
			}
		}
	}
}

namespace = midgame_crisis_trigger

event = {
	id = midgame_crisis_trigger.1
	is_triggered_only = yes
	hide_window = yes
	fire_only_once = yes

	trigger = { 
		always = no
	}
	immediate = { }
}