namespace = ag_country_selector

country_event = {
	id = ag_country_selector.1
	title = "ag_country_selector.1.title"
	desc = {
		trigger = { NOT = {
			has_country_flag = ag_eta_gateway_country_selector
		} }
		text = "ag_country_selector.1.desc"
	}
	desc = {
		trigger = { has_country_flag = ag_eta_gateway_country_selector has_country_flag = ag_ancient_eta_gateway_policy_white }
		text = "ag_country_selector.1.eta_gateway_policy_white.desc"
	}
	desc = {
		trigger = { has_country_flag = ag_eta_gateway_country_selector has_country_flag = ag_ancient_eta_gateway_policy_black }
		text = "ag_country_selector.1.eta_gateway_policy_blcak.desc"
	}
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes

	diplomatic = yes
	custom_gui = "ag_country_selector_window"

	picture_event_data = { room = ag_event_throne_room }

	trigger = { NOT = { has_global_flag = ag_country_selector_opened } }
	immediate = {
		set_global_flag = ag_country_selector_opened
		if = {
			limit = { NOT = { has_global_flag = ag_country_selector_initialized } }
			ag_country_selector_init_effect = yes
			ag_set_country_event_targets = yes
		}
	}

	option = {
		name = "ag_country_selector.1.1"
		custom_gui = "ag_country_selector_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		allow = {
		}
		trigger = { exists = event_target:ag_country_selector_marked_country_1 }
		hidden_effect = { ag_selected_country_effect = { ag_country_seq = 1 } }
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_option_dummy"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		trigger = { NOT = { exists = event_target:ag_country_selector_marked_country_1 } }
		allow = { always = no }
	}

	option = {
		name = "ag_country_selector.1.2"
		custom_gui = "ag_country_selector_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		allow = {
		}
		trigger = { exists = event_target:ag_country_selector_marked_country_2 }
		hidden_effect = { ag_selected_country_effect = { ag_country_seq = 2 } }
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_option_dummy"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		trigger = { NOT = { exists = event_target:ag_country_selector_marked_country_2 } }
		allow = { always = no }
	}

	option = {
		name = "ag_country_selector.1.3"
		custom_gui = "ag_country_selector_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		allow = {
		}
		trigger = { exists = event_target:ag_country_selector_marked_country_3 }
		hidden_effect = { ag_selected_country_effect = { ag_country_seq = 3 } }
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_option_dummy"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		trigger = { NOT = { exists = event_target:ag_country_selector_marked_country_3 } }
		allow = { always = no }
	}

	option = {
		name = "ag_country_selector.1.4"
		custom_gui = "ag_country_selector_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		allow = {
		}
		trigger = { exists = event_target:ag_country_selector_marked_country_4 }
		hidden_effect = { ag_selected_country_effect = { ag_country_seq = 4 } }
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_option_dummy"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		trigger = { NOT = { exists = event_target:ag_country_selector_marked_country_4 } }
		allow = { always = no }
	}

	option = {
		name = "ag_country_selector.1.5"
		custom_gui = "ag_country_selector_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		allow = {
		}
		trigger = { exists = event_target:ag_country_selector_marked_country_5 }
		hidden_effect = { ag_selected_country_effect = { ag_country_seq = 5 } }
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_option_dummy"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		trigger = { NOT = { exists = event_target:ag_country_selector_marked_country_5 } }
		allow = { always = no }
	}

	option = {
		name = "ag_country_selector.1.6"
		custom_gui = "ag_country_selector_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		allow = {
		}
		trigger = { exists = event_target:ag_country_selector_marked_country_6 }
		hidden_effect = { ag_selected_country_effect = { ag_country_seq = 6 } }
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_option_dummy"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		trigger = { NOT = { exists = event_target:ag_country_selector_marked_country_6 } }
		allow = { always = no }
	}

	option = {
		name = "ag_country_selector.1.7"
		custom_gui = "ag_country_selector_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		allow = {
		}
		trigger = { exists = event_target:ag_country_selector_marked_country_7 }
		hidden_effect = { ag_selected_country_effect = { ag_country_seq = 7 } }
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_option_dummy"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		trigger = { NOT = { exists = event_target:ag_country_selector_marked_country_7 } }
		allow = { always = no }
	}

	option = {
		name = "ag_country_selector.1.8"
		custom_gui = "ag_country_selector_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		allow = {
		}
		trigger = { exists = event_target:ag_country_selector_marked_country_8 }
		hidden_effect = { ag_selected_country_effect = { ag_country_seq = 8 } }
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_option_dummy"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		trigger = { NOT = { exists = event_target:ag_country_selector_marked_country_8 } }
		allow = { always = no }
	}

	option = {
		name = "ag_country_selector.1.9"
		custom_gui = "ag_country_selector_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		allow = {
		}
		trigger = { exists = event_target:ag_country_selector_marked_country_9 }
		hidden_effect = { ag_selected_country_effect = { ag_country_seq = 9 } }
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_option_dummy"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		trigger = { NOT = { exists = event_target:ag_country_selector_marked_country_9 } }
		allow = { always = no }
	}

	option = {
		name = "ag_country_selector.1.10"
		custom_gui = "ag_country_selector_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		allow = {
		}
		trigger = { exists = event_target:ag_country_selector_marked_country_10 }
		hidden_effect = { ag_selected_country_effect = { ag_country_seq = 10 } }
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_option_dummy"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		trigger = { NOT = { exists = event_target:ag_country_selector_marked_country_10 } }
		allow = { always = no }
	}

	option = {
		name = "ag_country_selector.1.11"
		custom_gui = "ag_country_selector_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		allow = {
		}
		trigger = { exists = event_target:ag_country_selector_marked_country_11 }
		hidden_effect = { ag_selected_country_effect = { ag_country_seq = 11 } }
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_option_dummy"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		trigger = { NOT = { exists = event_target:ag_country_selector_marked_country_11 } }
		allow = { always = no }
	}

	option = {
		name = "ag_country_selector.1.12"
		custom_gui = "ag_country_selector_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		allow = {
		}
		trigger = { exists = event_target:ag_country_selector_marked_country_12 }
		hidden_effect = { ag_selected_country_effect = { ag_country_seq = 12 } }
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_option_dummy"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.response"
		trigger = { NOT = { exists = event_target:ag_country_selector_marked_country_12 } }
		allow = { always = no }
	}

	option = {
		name = ""
		custom_gui = "ag_country_selector_countries_page_first_option"
		custom_tooltip = "ag_country_selector_to_first_page"
		custom_tooltip = "ag_country_selector_current_page_desc"
		allow = { custom_tooltip = {
			fail_text = "ag_country_selector_first_page"
			check_variable = { which = ag_country_selector_marked_page value > 1 }
		} }
		hidden_effect = {
			set_variable = { which = ag_country_selector_marked_page value = 1 }
			remove_global_flag = ag_country_selector_opened
			country_event = { id = ag_country_selector.1 }
		}
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_countries_page_prev_option"
		custom_tooltip = "ag_country_selector_to_prev_page"
		custom_tooltip = "ag_country_selector_current_page_desc"
		allow = { custom_tooltip = {
			fail_text = "ag_country_selector_first_page"
			check_variable = { which = ag_country_selector_marked_page value > 1 }
		} }
		hidden_effect = {
			subtract_variable = { which = ag_country_selector_marked_page value = 1 }
			remove_global_flag = ag_country_selector_opened
			country_event = { id = ag_country_selector.1 }
		}
	}
	option = {
		name = "ag_confirm"
		custom_gui = "ag_country_selector_confirm_option"
		allow = {
		}
		hidden_effect = {
			remove_global_flag = ag_country_selector_opened
			fire_on_action = { on_action = ag_on_country_selector_confirm }
			# Need to clear flags in other events!
			# country_event = { id = ag_country_selector.2 days = 1 }
		}
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_countries_page_next_option"
		custom_tooltip = "ag_country_selector_to_next_page"
		custom_tooltip = "ag_country_selector_current_page_desc"
		allow = { custom_tooltip = {
			fail_text = "ag_country_selector_last_page"
			check_variable = {
				which = ag_country_selector_marked_page
				value < ag_country_selector_marked_pages_total
			}
		} }
		hidden_effect = {
			change_variable = { which = ag_country_selector_marked_page value = 1 }
			remove_global_flag = ag_country_selector_opened
			country_event = { id = ag_country_selector.1 }
		}
	}
	option = {
		name = ""
		custom_gui = "ag_country_selector_countries_page_last_option"
		custom_tooltip = "ag_country_selector_to_last_page"
		custom_tooltip = "ag_country_selector_current_page_desc"
		allow = { custom_tooltip = {
			fail_text = "ag_country_selector_last_page"
			check_variable = {
				which = ag_country_selector_marked_page
				value < ag_country_selector_marked_pages_total
			}
		} }
		hidden_effect = {
			set_variable = { which = ag_country_selector_marked_page value = ag_country_selector_marked_pages_total }
			remove_global_flag = ag_country_selector_opened
			country_event = { id = ag_country_selector.1 }
		}
	}
	option = {
		name = "ag_country_selector_show_description"
		custom_gui = "ag_country_selector_show_description_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.desc"
		trigger = { NOR = {
			has_country_flag = ag_ancient_eta_gateway_policy_white
			has_country_flag = ag_ancient_eta_gateway_policy_black
		} }
	}
	option = {
		name = "ag_country_selector_show_description"
		custom_gui = "ag_country_selector_show_description_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.eta_gateway_policy_white.desc"
		trigger = { has_country_flag = ag_ancient_eta_gateway_policy_white }
	}
	option = {
		name = "ag_country_selector_show_description"
		custom_gui = "ag_country_selector_show_description_option"
		is_dialog_only = yes
		response_text = "ag_country_selector.1.eta_gateway_policy_black.desc"
		trigger = { has_country_flag = ag_ancient_eta_gateway_policy_black }
	}
	option = {
		name = "ag_cancel"
		custom_gui = "ag_country_selector_option"
		default_hide_option = yes
		hidden_effect = {
			remove_global_flag = ag_country_selector_opened
			ag_country_selector_cleans_up_effect = yes
			ag_clear_country_selection = yes
		}
	}
}

country_event = {
	id = ag_country_selector.2
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		ag_country_selector_cleans_up_effect = yes
		ag_clear_country_selection = yes
	}
}
