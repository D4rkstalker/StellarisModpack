namespace = parasitic

#Purity government: purging pops yields unity
planet_event = {
	id = parasitic.1
	hide_window = yes
	is_triggered_only = yes
	
	title = OK
	desc = OK

	trigger = {
		FROM = {
			has_valid_civic = civic_hive_parasitic
		}
		FROMFROM = {
			is_robot_pop = no
			NOT = {
				is_same_species = owner_species
			}
		}
		is_controlled_by = FROM
	}
	
	immediate = {
		create_message = {
			type = MESSAGE_TYPE_PARASITE_COMPLETE
			localization = MESSAGE_PARASITE_COMPLETE
			days = 30
			target = this
				variable = {
					type = name
					localization = PLANET
					scope = this
				}	
		}	

			while = {
		count = 1
		create_pop = {
			species = owner_main_species
			}
		}
	}
}

# Enclave Yearly Border Opinion
event = {
	id = parasitic.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
	any_country = {
		has_valid_civic = civic_hive_parasitic
		is_overlord = yes
		any_subject = {
			is_subject_type = pop_tributary
			NOT = { is_at_war_with = overlord }
		}
		}
	}
	
	immediate = {
		every_country = {
			limit = { 
				has_valid_civic = civic_hive_parasitic
				is_overlord = yes
				any_subject = {
						is_subject_type = pop_tributary
						NOT = { is_at_war_with = overlord }
					}
				}
				every_subject = {
					limit = {
						is_subject_type = pop_tributary
						NOT = { is_at_war_with = overlord }					
					}
					every_owned_planet = {
					limit = {
						any_owned_pop = {
								is_organic_species = yes
							}
						}
							random_owned_pop = {
								limit = {is_organic_species = yes}
								save_event_target_as = abduct_pop
										
									prevprevprev = {
										if = {
											limit = { any_owned_planet = { free_housing > 0 } }
											random_owned_planet = {
												limit = { 
												free_housing >= 1 
												is_under_colonization = no
												is_controlled_by = owner
												}								
																		owner = {
																			create_message = {
																				type = MESSAGE_TYPE_POP_ABDUCTED
																				localization = MESSAGE_POP_SACRIFICED
																				days = 30
																				target = this
																				variable = {
																					type = name
																					localization = SPECIES
																					scope = event_target:abduct_pop.species
																				}
																				variable = {
																					type = name
																					localization = TARGET_PLANET
																					scope = prev
																				}			
																				variable = {
																					type = name
																					localization = PLANET
																					scope = event_target:abduct_pop.planet
																				}
																			}
																		}
																			event_target:abduct_pop.owner = {
																					create_message = {
																						type = MESSAGE_TYPE_POP_ABDUCTED_FROM_US
																						localization = MESSAGE_POP_SACRIFICED_FROM_US
																						days = 30
																						target = event_target:abduct_pop.owner
																						variable = {
																							type = name
																							localization = SPECIES
																							scope = event_target:abduct_pop.species
																						}
																						variable = {
																							type = name
																							localization = ABDUCTER
																							scope = prev.owner
																						}					
																						variable = {
																							type = name
																							localization = PLANET
																							scope = event_target:abduct_pop.planet
																						}
																					}			
																				}
												resettle_pop = {
													pop = event_target:abduct_pop
													planet = this
												}
																			
											}
										}
										else = {
											random_owned_planet = {
												limit = {  
												is_under_colonization = no
												is_controlled_by = owner
												}
																	owner = {
																		create_message = {
																				type = MESSAGE_TYPE_POP_ABDUCTED
																				localization = MESSAGE_POP_SACRIFICED
																				days = 30
																				target = this
																				variable = {
																					type = name
																					localization = SPECIES
																					scope = event_target:abduct_pop.species
																				}
																				variable = {
																					type = name
																					localization = TARGET_PLANET
																					scope = prev
																				}			
																				variable = {
																					type = name
																					localization = PLANET
																					scope = event_target:abduct_pop.planet
																				}
																			}
																			}
																			event_target:abduct_pop.owner = {
																					create_message = {
																						type = MESSAGE_TYPE_POP_ABDUCTED_FROM_US
																						localization = MESSAGE_POP_SACRIFICED_FROM_US
																						days = 30
																						target = event_target:abduct_pop.owner
																						variable = {
																							type = name
																							localization = SPECIES
																							scope = event_target:abduct_pop.species
																						}
																						variable = {
																							type = name
																							localization = ABDUCTER
																							scope = prev.owner
																						}					
																						variable = {
																							type = name
																							localization = PLANET
																							scope = event_target:abduct_pop.planet
																						}
																					}			
																				}
																				
												resettle_pop = {
													pop = event_target:abduct_pop
													planet = this
												}
											}
										}
									  }
										
												
							}
					
				}
					
		}
	}
}