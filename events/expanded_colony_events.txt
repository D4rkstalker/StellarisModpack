############################
#
# Expanded Colony Events
#
############################

namespace = colonyexpanded

##################################
# Subterranean Civilization Events
# Reserved 1 - 49
##################################

### Co-existance Events ###

# Hostile Subterranean Creatures
# Reserved 1 - 9
planet_event = {
	id = colonyexpanded.1
	title = "colonyexpanded.1.name"
	desc = "colonyexpanded.1.desc"
	picture = GFX_evt_alien_cavemen
	show_sound = event_primitive_civilization
	location = ROOT
	
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
	}
	
	trigger = {
		has_planet_flag = seismic_disturbance_friendly
		NOT = { has_planet_flag = seismic_disturbance_creature }
		num_pops > 0
		check_variable = { 
			which = "angry_subterraneans" 
			value < 2
		}
	}
	
	mean_time_to_happen = {
		months = 720
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = seismic_disturbance_creature
			days = 27000
		}
	}
	
	option = {
		name = colony.69.a
		enable_special_project = {
			name = "SUBTERRANEAN_CREATURES_PROJECT"
			location = this
			owner = root.owner
		}
		hidden_effect = {
			change_variable = { 
				which = "angry_subterraneans" 
				value = -1 
			}
		}
		custom_tooltip = subterraneans_pleased
	}
	option = {
		name = colonyexpanded.1.b
		hidden_effect = {
			change_variable = { 
				which = "angry_subterraneans" 
				value = 1 
			}
			random_list = {
				50 = {
					# nothing happens
				}
				50 = {
					planet_event = { id = colonyexpanded.3 days = 360 random = 360 } # hostile creatures come to the surface, creates tile blocker
				}
			}
		}
		custom_tooltip = subterraneans_displeased
	}
}
ship_event = {
	id = colonyexpanded.2
	title = "PROJECT_COMPLETE"
	desc = "colonyexpanded.2.desc"
	picture = GFX_evt_animal_wildlife
	show_sound = event_primitive_civilization
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = colonyexpanded.2.a
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			add_monthly_resource_mult = {
				resource = influence
				value = @tier2influencereward
				min = @tier2influencemin
				max = @tier2influencemax
			}
		}
	}
}
planet_event = {
	id = colonyexpanded.3
	title = "colonyexpanded.1.name"
	desc = "colonyexpanded.3.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_ground_battle
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = TERRIBLE
		add_deposit = d_dangerous_wildlife_blocker
		every_owned_pop = {
			add_modifier = {
				modifier = "pop_angry_subterranean"
				days = 3600
			}
		}
	}
}
country_event = {
	id = colonyexpanded.4
	title = "colonyexpanded.1.name"
	desc = "colonyexpanded.3.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_ground_battle
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = TERRIBLE
		random_owned_planet  = {
			limit = { has_planet_flag = seismic_disturbance_creature }
			add_deposit = d_dangerous_wildlife_blocker
			hidden_effect = {
				change_variable = { 
					which = "angry_subterraneans" 
					value = 1 
				}
			}
			custom_tooltip = subterraneans_displeased
			every_owned_pop = {
				add_modifier = {
					modifier = "pop_angry_subterranean"
					days = 3600
				}
			}
		}
	}
}

# Request for Robots
planet_event = {
	id = colonyexpanded.10
	title = "colonyexpanded.10.name"
	desc = "colonyexpanded.10.desc"
	picture = GFX_evt_robot_assembly_plant
	show_sound = event_primitive_civilization
	location = ROOT
	
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
	}
	
	trigger = {
		has_planet_flag = seismic_disturbance_friendly
		NOT = { has_planet_flag = seismic_disturbance_robots }
		num_pops > 0
		any_pop = { is_robot_pop = yes }
	}
	
	mean_time_to_happen = {
		months = 600
	}
	
	immediate = {
		set_planet_flag = seismic_disturbance_robots
	}
	
	option = {
		name = colonyexpanded.10.a
		hidden_effect = {
			change_variable = {
				which = "angry_subterraneans" 
				value = 1
			}
		}
		custom_tooltip = subterraneans_displeased
	}
	option = {
		name = colonyexpanded.10.b
		trigger = {
			owner = { NOT = { has_technology = tech_synthetic_workers } }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = minerals
				value = @tier2materialreward
				min = @tier2materialmin
				max = @tier2materialmax
			}
		}
		hidden_effect = {
			random_pop = {
				limit = { is_robot_pop = yes }
				kill_pop = yes
			}
		}
		custom_tooltip = subterraneans_get_robot_pop
		hidden_effect = {
			change_variable = { 
				which = "angry_subterraneans" 
				value = -1
			}
			random_country = {
				limit = {
					is_country_type = adversary
					has_country_flag = subterranean_nation
				}
				set_country_flag = robot_request_approved
			}
		}
		custom_tooltip = subterraneans_pleased
	}
	option = {
		name = colonyexpanded.10.c
		trigger = {
			owner = { has_technology = tech_synthetic_workers }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = minerals
				value = @tier2materialreward
				min = @tier2materialmin
				max = @tier2materialmax
			}
		}
		hidden_effect = {
			owner = {
				add_resource = { minerals = -50 }
			}
		}
		custom_tooltip = subterraneans_must_build_droids
		hidden_effect = {
			change_variable = { 
				which = "angry_subterraneans" 
				value = -1
			}
			random_country = {
				limit = {
					is_country_type = adversary
					has_country_flag = subterranean_nation
				}
				set_country_flag = robot_request_approved
			}
		}
		custom_tooltip = subterraneans_pleased
	}
}

# Subterranean Engineers
planet_event = {
	id = colonyexpanded.11
	title = "colonyexpanded.11.name"
	desc = "colonyexpanded.11.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_primitive_civilization
	location = ROOT
	
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
	}
	
	trigger = {
		has_planet_flag = seismic_disturbance_friendly
		NOT = { has_planet_flag = seismic_disturbance_engineers }
		num_pops > 0
	}
	
	mean_time_to_happen = {
		months = 600
	}
	
	immediate = {
		set_planet_flag = seismic_disturbance_engineers
	}
	
	option = {
		name = colonyexpanded.11.a
		hidden_effect = {
			change_variable = {
				which = "angry_subterraneans" 
				value = 1
			}
		}
		custom_tooltip = subterraneans_displeased
	}
	option = {
		name = colonyexpanded.11.b
		add_modifier = {
			modifier = "subterranean_engineers"
			days = 180
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
		hidden_effect = {
			change_variable = {
				which = "angry_subterraneans" 
				value = -1
			}
			random_country = {
				limit = {
					is_country_type = adversary
					has_country_flag = subterranean_nation
				}
				set_country_flag = engineering_study_request_approved
			}
		}
		custom_tooltip = subterraneans_pleased
	}
}

# Engineering Project
# Reserved 12 - 20
planet_event = {
	id = colonyexpanded.12
	title = "colonyexpanded.12.name"
	desc = "colonyexpanded.12.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_primitive_civilization
	location = ROOT
	
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
	}
	
	trigger = {
		has_planet_flag = seismic_disturbance_friendly
		NOT = { has_planet_flag = seismic_disturbance_engineering_project }
		num_pops > 0
		check_variable = { 
			which = "angry_subterraneans" 
			value < 2
		}
	}
	
	mean_time_to_happen = {
		months = 720
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = seismic_disturbance_engineering_project
			days = 18000
		}
	}
	
	option = {
		name = colonyexpanded.12.a
		enable_special_project = {
			name = "SUBTERRANEAN_EXVACATION_PROJECT"
			location = this
			owner = root.owner
		}
		hidden_effect = {
			change_variable = { 
				which = "angry_subterraneans" 
				value = -1 
			}
		}
		custom_tooltip = subterraneans_pleased
	}
	option = {
		name = colonyexpanded.12.b
		hidden_effect = {
			change_variable = {
				which = "angry_subterraneans" 
				value = 1 
			}
			random_list = {
				75 = {
					# nothing happens
				}
				25 = {
					planet_event = { id = colonyexpanded.13 days = 180 random = 180 } # project continues, causes earthquakes
				}
			}
		}
		custom_tooltip = subterraneans_displeased
	}
}

planet_event = {
	id = colonyexpanded.13
	title = colony.68.name
	desc = "colonyexpanded.13.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_air_raid_siren
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = TERRIBLE
		add_deposit = d_sinkhole_subterraneans
		every_owned_pop = {
			add_modifier = {
				modifier = "pop_angry_subterranean"
				days = 3600
			}
		}
	}
}

# Special Project Outcomes
planet_event = {
	id = colonyexpanded.14
	title = "PROJECT_COMPLETE"
	desc = "colonyexpanded.14.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_primitive_civilization
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		owner = {
			add_monthly_resource_mult = {
				resource = minerals
				value = @tier1materialreward
				min = @tier1materialmin
				max = @tier1materialmax
			}
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}
planet_event = {
	id = colonyexpanded.15
	title = "PROJECT_COMPLETE"
	desc = "colonyexpanded.15.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_primitive_civilization
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}
planet_event = {
	id = colonyexpanded.16
	title = "PROJECT_COMPLETE"
	desc = "colonyexpanded.16.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_primitive_civilization
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		owner = {
			add_resource = {
				energy = 500
			}
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}
planet_event = {
	id = colonyexpanded.17
	title = "PROJECT_COMPLETE"
	desc = "colonyexpanded.17.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_primitive_civilization
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = colonyexpanded.17.a
		enable_special_project = {
			name = "SUBTERRANEAN_CREATURES_PROJECT"
			location = this
			owner = root.owner
		}
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}
planet_event = {
	id = colonyexpanded.18
	title = "colonyexpanded.18.name"
	desc = "colonyexpanded.18.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_air_raid_siren
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = TERRIBLE
		add_deposit = d_sinkhole_subterraneans
		every_owned_pop = {
			add_modifier = {
				modifier = "pop_angry_subterranean"
				days = 3600
			}
		}
	}
}

# Study Subterranean Engineering
planet_event = {
	id = colonyexpanded.21
	title = "colonyexpanded.21.name"
	desc = "colonyexpanded.21.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_primitive_civilization
	location = ROOT
	
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
	}
	
	trigger = {
		has_planet_flag = seismic_disturbance_friendly
		NOT = { has_planet_flag = seismic_disturbance_engineering }
		num_pops > 0
		check_variable = {
			which = "angry_subterraneans"
			value < 1
		}
	}
	
	mean_time_to_happen = {
		months = 720
	}
	
	immediate = {
		set_planet_flag = seismic_disturbance_engineering
	}
	
	option = {
		name = EXCELLENT
		owner = {
			if = {
				limit = {
					has_technology = tech_mining_2
					has_technology = tech_mineral_purification_1
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier5researchreward
					min = @tier5researchmin
					max = @tier5researchmax
				}
			}
			if = {
				limit = {
					has_technology = tech_mining_2
					NOT = { has_technology = tech_mineral_purification_1 }
				}
				give_technology = { tech = tech_mineral_purification_1 }
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
			if = {
				limit = { NOT = { has_technology = tech_mining_2 } }
				give_technology = { tech = tech_mining_2 }
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
		}
	}
}

# Study Subterranean Engineering - Sinkhole Removal
planet_event = {
	id = colonyexpanded.22
	title = "colonyexpanded.22.name"
	desc = "colonyexpanded.22.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_primitive_civilization
	location = ROOT
	
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
	}
	
	trigger = {
		has_planet_flag = seismic_disturbance_friendly
		NOT = { has_planet_flag = seismic_disturbance_sinkhole_tb }
		num_pops > 0
		check_variable = {
			which = "angry_subterraneans"
			value < 1
		}
		owner = {
			NOT = { has_technology = tech_deep_sinkhole }
		}
	}
	
	mean_time_to_happen = {
		months = 720
	}
	
	immediate = {
		set_planet_flag = seismic_disturbance_sinkhole_tb
	}
	
	option = {
		name = EXCELLENT
		owner = {
			give_technology = { tech = tech_deep_sinkhole }
		}
	}
}

# Subterranean Merchants
planet_event = {
	id = colonyexpanded.23
	title = "colonyexpanded.23.name"
	desc = "colonyexpanded.23.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_primitive_civilization
	location = ROOT
	
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
	}
	
	trigger = {
		has_planet_flag = seismic_disturbance_friendly
		NOT = { has_planet_flag = seismic_disturbance_merchant_timer }
		num_pops > 0
		owner = { resource_stockpile_compare = { resource = energy value >= 500 } }
		check_variable = {
			which = "angry_subterraneans"
			value < 2
		}
	}
	
	mean_time_to_happen = {
		months = 360
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = seismic_disturbance_merchant_timer
			days = 1080
		}
	}
	
	option = {
		name = colonyexpanded.23.a
		trigger = {
			owner = { resource_stockpile_compare = { resource = energy value >= 1000 } }
		}
		owner = {
			add_resource = { energy = -1000 minerals = 800 alloys = 100 }
		}
	}
	
	option = {
		name = colonyexpanded.23.b
		owner = {
			add_resource = { energy = -500 minerals = 400 alloys = 50 }
		}
	}
	option = {
		name = colonyexpanded.23.c
	}
}

##################################
# Tomb World Events
# Reserved 50 - 99
##################################

# Tomb World Surveyed (sets flag so can still get some events if terraformed)
ship_event = {
	id = colonyexpanded.50
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		FROM = { is_nuked = yes }
	}

	immediate = {
		FROM = { set_planet_flag = colonized_tomb_world }
	}
}

# angry mutant creatures disturbed
# This = Planet
planet_event = {
	id = colonyexpanded.51
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_planet_flag = tomb_world_angry_mutant_animals }
		OR = {
			is_nuked = yes
			has_planet_flag = colonized_tomb_world
			has_modifier = recovered_tomb_world
		}
	}
	
	immediate = {
		random_list = {
			199 = {
				# nothing happens
			}
			1 = {
				set_planet_flag = tomb_world_angry_mutant_animals
				planet_event = { id = colonyexpanded.52 }
			}
		}
	}
}
planet_event = {
	id = colonyexpanded.52
	title = "colonyexpanded.52.name"
	desc = "colonyexpanded.52.desc"
	picture = GFX_evt_alien_wildlife
	show_sound = event_air_raid_siren
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = TERRIBLE
		add_deposit = d_dangerous_wildlife_blocker
		if = {
			limit = { num_pops > 3 }
			random_pop = {
				kill_pop = yes
			}
		}
	}
}

##################################
# Special System Events
# Reserved 100 - 198
##################################

### Citadel ###
# Discover the Citadel
ship_event = {
	id = colonyexpanded.100
	title = "colonyexpanded.100.name"
	desc = "colonyexpanded.100.desc"
	picture = GFX_evt_space_station
	show_sound = event_alien_signal
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			NOT = { has_country_flag = encountered_citadel }
		}
		FROM = {
			has_star_flag = mass_effect_citadel_system
			any_system_planet = {
				has_planet_flag = mass_effect_citadel
			}
		}
	}
	
	immediate = {
		FROM = { save_event_target_as = citadel_system }
		owner = { set_country_flag = encountered_citadel }
	}
	
	option = {
		name = FASCINATING
	}
}

# Discover the Keepers
ship_event = {
	id = colonyexpanded.101
	title = "colonyexpanded.101.name"
	desc = "colonyexpanded.101.desc"
	picture = GFX_evt_space_station
	show_sound = event_alien_signal
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_planet_flag = mass_effect_citadel
		}
	}
	
	immediate = {
		FROM = {
			solar_system =  { save_event_target_as = citadel_system }
		}
	}
	
	option = {
		name = FASCINATING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
	}
}

# Keeper mush is pops!
event = {
	id = colonyexpanded.102
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		any_country = {
			NOT = { has_authority = auth_machine_intelligence }
			any_owned_planet = {
				has_planet_flag = mass_effect_citadel
				is_colony = yes
				is_under_colonization = no
				any_pop = {
					is_organic_species = yes
					has_job = unemployed
				}
			}
		}
	}
	
	immediate = {
		random_country = {
			limit = {
				NOT = { has_authority = auth_machine_intelligence }
				any_owned_planet = {
					has_planet_flag = mass_effect_citadel
					any_pop = {
						is_organic_species = yes
						has_job = unemployed
					}
				}
			}
			random_list = {
				1 = { }
				1 = {
					add_resource = { food = 500 }
					random_owned_planet = {
						limit = { has_planet_flag = mass_effect_citadel }
						random_pop = {
							limit = {
								is_organic_species = yes
								is_unemployed = yes
							}
							kill_pop = yes
						}
					}
				}
			}
		}
	}
}

# Keepers start off Contingency
planet_event = {
	id = colonyexpanded.103
	title = "colonyexpanded.103.name"
	desc = "colonyexpanded.103.desc"
	picture = GFX_evt_space_station
	show_sound = event_alien_signal
	location = ROOT
	
	fire_only_once = yes
	
	is_triggered_only = yes
	
	option = {
		name = WORRYING
		hidden_effect = {
			planet_event = { id = colonyexpanded.104 days = 3 random = 5 }
		}
	}
}
planet_event = {
	id = colonyexpanded.104
	title = "colonyexpanded.104.name"
	desc = "colonyexpanded.104.desc"
	picture = GFX_evt_space_station
	show_sound = event_sensor_ping
	location = ROOT
	
	fire_only_once = yes
	
	is_triggered_only = yes
	
	option = {
		name = colonyexpanded.104.a
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
	}
}

### Dune ###
# Discover Arrakis
ship_event = {
	id = colonyexpanded.120
	title = "anomalymod.11.name"
	desc = "colonyexpanded.120.desc"
	picture = GFX_evt_arid
	show_sound = event_alien_nature
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_planet_flag = arrakis_planet
		}
	}
	
	option = {
		name = FASCINATING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
	}
}

### Gem Homeworld ###
# Discover Gem Homeworld
ship_event = {
	id = colonyexpanded.130
	title = "colonyexpanded.130.name"
	desc = "colonyexpanded.130.desc"
	picture = GFX_evt_alien_city
	show_sound = event_activating_unknown_technology
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_planet_flag = gem_homeworld
		}
	}
	
	immediate = {
		FROM = {
			if = {
				limit = { NOT = { is_planet_class = pc_broken } }
				change_pc = pc_broken
				clear_planet_modifiers = yes
				reset_planet = yes
				clear_planet_modifiers = yes
				set_deposit = d_rare_crystals_3
			}
		}
	}
	
	option = {
		name = colonyexpanded.130.a
		FROM = {
			enable_special_project = {
				name  = GEM_HOMEWORLD_PROJECT
				location = this
				owner = root
			}
		}
	}
}
ship_event = {
	id = colonyexpanded.131
	title = "colonyexpanded.131.name"
	desc = "colonyexpanded.131.desc"
	picture = GFX_evt_alien_city
	show_sound = event_mystic_reveal
	location = FROMFROM
	
	is_triggered_only = yes
	
	option = {
		name = colonyexpanded.131.a
		FROMFROM = {
			hidden_effect = { clear_deposits = yes }
			add_deposit = d_society_10
			add_deposit = d_society_5
			add_deposit = d_engineering_10
			add_deposit = d_engineering_5
		}
	}
	option = {
		name = colonyexpanded.131.b
		FROMFROM = {
			tooltip = {
				add_deposit = d_rare_crystals_3
			}
		}
	}
}

##################################
# Deposit and Blocker Events
# Reserved 199 - 298
##################################

# Deposit Tabola, five year intervals
event = {
	id = colonyexpanded.199
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_planet = {
			limit = {
				is_colony = yes
				is_under_colonization = no
				is_homeworld = no
				is_capital = no
				exists = owner
				owner = { OR = {
					is_country_type = default
					is_country_type = ascended_empire
					is_country_type = lost_empire
				} }
			}
			planet_event = { id = colonyexpanded.200 days = 60 random = 1620 }
		}
	}
}
planet_event = {
	id = colonyexpanded.200
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		is_colony = yes
		is_under_colonization = no
		is_homeworld = no
		is_capital = no
		exists = owner
		owner = { OR = {
			is_country_type = default
			is_country_type = ascended_empire
			is_country_type = lost_empire
		} }
	}
	
	immediate = {
		random_list = {
			# total out of 500
			314 = { }
			# Curious Wildlife (dangerous wildlife)
			17 = { planet_event = { id = colonyexpanded.201 } }
			# Volcanic earthquake reveals minerals (volcano)
			13 = { planet_event = { id = colonyexpanded.202 } }
			# Volcanic Eruption (volcano)
			16 = { planet_event = { id = colonyexpanded.203 } }
			# Hungry Wildlife (dangerous wildlife)
			14 = { planet_event = { id = colonyexpanded.204 } }
			# Sinkhole Deposit (sinkhole)
			17 = { planet_event = { id = colonyexpanded.205 } }
			# Sinkhole Collapses (sinkhole)
			16 = { planet_event = { id = colonyexpanded.206 } }
			# Biological Research (various)
			20 = { planet_event = { id = colonyexpanded.207 } }
			# Fertile Volcanic Lands (volcano)
			20 = { planet_event = { id = colonyexpanded.208 } }
			# Mineral Rich Mountain (mountain)
			16 = { planet_event = { id = colonyexpanded.209 } }
			# Exotic Gas Swamp (swamp)
			5 = { planet_event = { id = colonyexpanded.210 } }
			# Isolated Vally (mountain)
			12 = { planet_event = { id = colonyexpanded.211 } }
			# Betharian Fields (jungle)
			8 = { planet_event = { id = colonyexpanded.212 } }
			# Motes Explode
			2 = { planet_event = { id = colonyexpanded.215 } }
			# Sand Worm Attack
			3 = { planet_event = { id = colonyexpanded.216 } }
			# Lithoid Monoliths (mountain range)
			7 = {
				if = {
					limit = {
						has_lithoids = yes
						has_deposit = d_mountain_range
						has_district = district_mining
						NOT = { has_planet_flag = lith_monoliths_planet }
						exists = owner
						owner = { NOT = { has_country_flag = lith_monoliths_country } }
					}
					planet_event = { id = colonyexpanded.221 }
				}
			}
		}
	}
}

# Curious Wildlife
planet_event = {
	id = colonyexpanded.201
	title = "colonyexpanded.201.name"
	desc = "colonyexpanded.201.desc"
	show_sound = event_alien_nature
	picture = GFX_evt_animal_wildlife
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		num_pops > 3
		NOT = { has_planet_flag = wildlife_damages }
		OR = {
			has_deposit = d_dangerous_wildlife_blocker
			has_modifier = dangerous_wildlife
		}
	}
	
	immediate = {
		set_planet_flag = wildlife_damages
	}
	
	option = {
		name = UNFORTUNATE
		owner = {
			 add_resource = { energy = -250 minerals = -250 }
		}
	}
}

# volcanic earthquake reveals minerals
planet_event = {
	id = colonyexpanded.202
	title = "colonyexpanded.202.name"
	desc = "colonyexpanded.202.desc"
	show_sound = event_structural_collapse
	picture = {
		trigger = { 
			NOT = { has_global_flag = "has_new_frontiers_mod" }
		}
		picture = GFX_evt_warm_barren
	}
	picture = {
		trigger = { 
			has_global_flag = "has_new_frontiers_mod"
		}
		picture = GFX_evt_volcano
	}
	location = ROOT
	
	is_triggered_only = yes

	trigger = {
		num_pops > 3
		NOT = { has_planet_flag = volcanic_earthquake }
		has_deposit = d_active_volcano
	}
	
	immediate = {
		set_planet_flag = volcanic_earthquake
	}
	
	option = {
		name = OK
		owner = {
			add_monthly_resource_mult = {
				resource = minerals
				value = @tier1materialreward
				min = @tier1materialmin
				max = @tier1materialmax
			}
		}
		add_planet_devastation = 20
	}
}

# Volcanic Eruption
planet_event = {
	id = colonyexpanded.203
	title = "colonyexpanded.203.name"
	desc = "colonyexpanded.203.desc"
	show_sound = event_air_raid_siren
	picture = {
		trigger = { 
			NOT = { has_global_flag = "has_new_frontiers_mod" }
		}
		picture = GFX_evt_warm_barren
	}
	picture = {
		trigger = { 
			has_global_flag = "has_new_frontiers_mod"
		}
		picture = GFX_evt_volcano
	}
	location = ROOT
	
	is_triggered_only = yes
		
	trigger = {
		num_pops > 3
		NOT = { has_planet_flag = volcanic_eruption }
		has_deposit = d_active_volcano
	}
	
	immediate = {
		set_planet_flag = volcanic_eruption
	}
	
	option = {
		name = TERRIBLE
		add_modifier = {
			modifier = "recent_eruption"
			days = 3600
		}
		add_planet_devastation = 50
		if = {
			limit = { free_district_slots > 0 }
			add_deposit = d_city_ruins
		}
		random_pop = {
			limit = {
				OR = {
					is_pop_category = worker
					is_pop_category = simple_drone
					is_enslaved = yes
				}
			}
			kill_pop = yes
		}
		random_pop = {
			limit = {
				OR = {
					is_pop_category = worker
					is_pop_category = simple_drone
					is_enslaved = yes
				}
			}
			kill_pop = yes
		}
	}
}

# Hungry Wildlife
planet_event = {
	id = colonyexpanded.204
	title = "colonyexpanded.204.name"
	desc = "colonyexpanded.204.desc"
	show_sound = event_alien_nature
	picture = GFX_evt_animal_wildlife
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		num_pops > 3
		NOT = { has_planet_flag = wildlife_hungry }
		OR = {
			has_deposit = d_dangerous_wildlife_blocker
			has_modifier = dangerous_wildlife
		}
		free_district_slots > 1
	}
	
	immediate = {
		set_planet_flag = wildlife_hungry
	}
	
	option = {
		name = UNFORTUNATE
		add_deposit = d_dangerous_wildlife_blocker
		random_pop = {
			limit = {
				OR = {
					is_pop_category = worker
					is_pop_category = simple_drone
					is_enslaved = yes
				}
			}
			kill_pop = yes
		}
	}
}

# Sinkhole Deposit
planet_event = {
	id = colonyexpanded.205
	title = "colonyexpanded.205.name"
	desc = "colonyexpanded.205.desc"
	show_sound = event_structural_collapse
	picture = GFX_evt_arid
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		num_pops > 3
		NOT = { has_planet_flag = sinkhole_minerals }
		has_deposit = d_deep_sinkhole
	}

	immediate = {
		set_planet_flag = sinkhole_minerals
	}
	
	option = {
		name = FASCINATING
		hidden_effect = {
			remove_deposit = d_deep_sinkhole
			add_deposit = d_deep_sinkhole_mesa
		}
		tooltip = { add_deposit = d_prosperous_mesa }
	}
}

# Sinkhole Collapses 
planet_event = {
	id = colonyexpanded.206
	title = "colonyexpanded.206.name"
	desc = "colonyexpanded.206.desc"
	show_sound = event_structural_collapse
	picture = GFX_evt_arid
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		num_pops > 3
		NOT = { has_planet_flag = sinkhole_collapse }
		has_deposit = d_deep_sinkhole
	}
	
	immediate = {
		set_planet_flag = sinkhole_collapse
	}
	
	option = {
		name = OK
		remove_deposit = d_deep_sinkhole
		add_deposit = d_collapsed_sinkhole
	}
}

# Biological Research
planet_event = {
	id = colonyexpanded.207
	title = "colonyexpanded.207.name"
	desc = "colonyexpanded.207.desc"
	show_sound = event_alien_nature
	picture = GFX_evt_alien_nature
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		num_pops > 3
		NOT = { has_planet_flag = biological_studies_tileblocker }
		OR = {
			AND = {
				has_deposit = d_dangerous_wildlife_blocker
				owner = { NOT = { has_technology = tech_dangerous_wildlife } }
			}
			AND = {
				has_deposit = d_dense_jungle
				owner = { NOT = { has_technology = tech_dense_jungle } }
			}
			AND = {
				OR = {
					has_deposit = d_noxious_swamp
					has_deposit = d_noxious_swamp_bubbling
				}
				owner = { NOT = { has_technology = tech_noxious_swamp } }
			}
			AND = {
				has_deposit = d_toxic_kelp
				owner = { NOT = { has_technology = tech_toxic_kelp } }
			}
		}
	}
	
	immediate = {
		set_planet_flag = biological_studies_tileblocker
	}
	
	option = {
		name = FASCINATING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
		random_list = {
			25 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_deposit = d_dangerous_wildlife_blocker }
						owner = { has_technology = tech_dangerous_wildlife }
					}
				}
				owner = {
					add_research_option = tech_dangerous_wildlife
					add_tech_progress = {
						tech = tech_dangerous_wildlife
						progress = 0.20
					}
				}
			}
			25 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_deposit = d_dense_jungle }
						owner = { has_technology = tech_dense_jungle }
					}
				}
				owner = {
					add_research_option = tech_dense_jungle
					add_tech_progress = {
						tech = tech_dense_jungle
						progress = 0.20
					}
				}
			}
			25 = {
				modifier = {
					factor = 0
					OR = {
						NOR = {
							has_deposit = d_noxious_swamp
							has_deposit = d_noxious_swamp_bubbling
						}
						owner = { has_technology = tech_noxious_swamp }
					}
				}
				owner = {
					add_research_option = tech_noxious_swamp
					add_tech_progress = {
						tech = tech_noxious_swamp
						progress = 0.20
					}
				}
			}
			25 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { has_deposit = d_toxic_kelp }
						owner = { has_technology = tech_toxic_kelp }
					}
				}
				owner = {
					add_research_option = tech_toxic_kelp
					add_tech_progress = {
						tech = tech_toxic_kelp
						progress = 0.20
					}
				}
			}
		}
	}
}

# Fertile Volcanic Lands
planet_event = {
	id = colonyexpanded.208
	title = "colonyexpanded.208.name"
	desc = "colonyexpanded.208.desc"
	show_sound = event_alien_nature
	picture = {
		trigger = { 
			NOT = { has_global_flag = "has_new_frontiers_mod" }
		}
		picture = GFX_evt_warm_barren
	}
	picture = {
		trigger = { 
			has_global_flag = "has_new_frontiers_mod"
		}
		picture = GFX_evt_volcano
	}
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		num_pops > 3
		NOT = { has_planet_flag = volcanic_fertile }
		has_deposit = d_active_volcano
	}
	
	immediate = {
		set_planet_flag = volcanic_fertile
	}
	
	option = {
		name = FASCINATING
		add_deposit = d_black_soil
		add_modifier = { modifier = volcano_fertile_soil days = -1 }
	}
}

# Mineral Rich Mountain
planet_event = {
	id = colonyexpanded.209
	title = "colonyexpanded.209.name"
	desc = "colonyexpanded.209.desc"
	show_sound = event_default
	picture = {
		trigger = {
			OR = {
				is_wet =  yes
				is_gaia = yes
				is_hive = yes
			}
		}
		picture = GFX_evt_continental
	}
	picture = {
		trigger = { 
			is_dry = yes
		}
		picture = GFX_evt_arid
	}
	picture = {
		trigger = { 
			is_cold = yes
		}
		picture = GFX_evt_arctic
	}
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		num_pops > 3
		NOT = { has_planet_flag = mineral_mountains }
		has_deposit = d_mountain_range
		NOT = { has_modifier = mineral_poor }
		OR = {
			is_wet = yes
			is_dry = yes
			is_cold = yes
			is_gaia = yes
			is_hive = yes
		}
	}
	
	immediate = {
		set_planet_flag = mineral_mountains
	}
	
	option = {
		name = EXCELLENT
		add_deposit = d_rich_mountain
	}
}

# Exotic Gas Swamp 
planet_event = {
	id = colonyexpanded.210
	title = "colonyexpanded.210.name"
	desc = "colonyexpanded.210.desc"
	show_sound = event_alien_nature
	picture = GFX_evt_tundra
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		num_pops > 3
		has_deposit = d_noxious_swamp
		exists = owner
		owner = {
			NOT = { has_country_flag = exotic_gas_swamp }
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = exotic_gas_swamp
		}
	}
	
	option = {
		name = EXCELLENT
		hidden_effect = {
			remove_deposit = d_noxious_swamp
			add_deposit = d_noxious_swamp_bubbling
		}
		tooltip = { add_deposit = d_bubbling_swamp }
	}
}

# Isolated Vally
planet_event = {
	id = colonyexpanded.211
	title = "colonyexpanded.211.name"
	desc = "colonyexpanded.211.desc"
	show_sound = event_alien_nature
	picture = GFX_evt_continental
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		num_pops > 3
		has_deposit = d_mountain_range
		NOT = { has_deposit = d_alien_pets_deposit }
		exists = owner
		owner = {
			NOT = { has_country_flag = mountain_pets }
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = mountain_pets
		}
	}
	
	option = {
		name = FASCINATING
		add_deposit = d_alien_pets_deposit
	}
}

# Betharian Fields
planet_event = {
	id = colonyexpanded.212
	title = "colonyexpanded.212.name"
	desc = "colonyexpanded.212.desc"
	show_sound = event_mystic_reveal
	picture = GFX_evt_tropical
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		num_pops > 3
		has_deposit = d_dense_jungle
		NOT = { has_deposit = d_betharian_deposit }
		exists = owner
		owner = {
			NOT = { has_country_flag = betharian_jungles }
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = betharian_jungles
		}
	}
	
	option = {
		name = FASCINATING
		add_deposit = d_betharian_deposit
	}
}

# Tomb World Artifacts
planet_event = {
	id = colonyexpanded.213
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_ancrel = yes
		is_nuked = yes
		From = {
   			OR = {
   				is_deposit_type = d_radioactive_wasteland
				is_deposit_type = d_city_ruins
   				is_deposit_type = d_bomb_crater
   			}
   		}
	}
	
	immediate = {
		random_list = {
			10 = {
				planet_event = { id = colonyexpanded.214 days = 3 }
			}
			90 = {
			}
		}
	}
}
planet_event = {
	id = colonyexpanded.214
	title = "colonyexpanded.214.name"
	desc = "colonyexpanded.214.desc"
	show_sound = event_cityscape
	picture = GFX_evt_archaeological_dig
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = INTERESTING
		medium_artifact_reward = yes
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
	}
}

planet_event = {
	id = colonyexpanded.215
	title = "colonyexpanded.215.name"
	desc = "colonyexpanded.215.desc"
	show_sound = event_ship_explosion
	picture = GFX_evt_archaeologists_escaping
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		any_pop = {
			OR = {
				has_job = mote_harvester
				has_job = mote_harvesting_drone
			}
		}
		NOT = { has_planet_flag = mote_explotion }
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = mote_explotion
			days = 9000 # 25 years
		}
	}
	
	option = {
		name = TERRIBLE
		add_planet_devastation = 5
		random_pop = {
			limit = {
				OR = {
					has_job = mote_harvester
					has_job = mote_harvesting_drone
				}
			}
			kill_pop = yes
		}
		owner = {
			add_resource = { volatile_motes = 250 }
		}
	}
}

planet_event = {
	id = colonyexpanded.216
	title = "colonyexpanded.216.name"
	desc = "colonyexpanded.216.desc"
	show_sound = event_structural_collapse
	picture = GFX_evt_burning_settlement
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		any_pop = {
			OR = {
				has_job = zro_harvester
				has_job = zro_harvesting_drone
			}
		}
		NOT = { has_planet_flag = worm_attack }
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = worm_attack
			days = 3600 # 10 years
		}
	}
	
	option = {
		name = TERRIBLE
		add_planet_devastation = 20
		random_pop = {
			limit = {
				OR = {
					has_job = zro_harvester
					has_job = zro_harvesting_drone
				}
			}
			kill_pop = yes
		}
	}
}

# Hidden Reefs
planet_event = {
	id = colonyexpanded.217
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_planet_flag = hidden_reef }
		From = {
   			is_deposit_type = d_toxic_kelp
   		}
	}
	
	immediate = {
		random_list = {
			1 = {
				set_planet_flag = hidden_reef
				planet_event = { id = colonyexpanded.218 days = 3 }
			}
			1 = {
				set_planet_flag = hidden_reef
				planet_event = { id = colonyexpanded.219 days = 3 }
			}
			98 = {
			}
		}
	}
}
planet_event = {
	id = colonyexpanded.218
	title = "colonyexpanded.218.name"
	desc = "colonyexpanded.218.desc"
	show_sound = event_cityscape
	picture = GFX_evt_ocean
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		add_deposit = d_crystal_reef
	}
}
planet_event = {
	id = colonyexpanded.219
	title = "colonyexpanded.218.name"
	desc = "colonyexpanded.219.desc"
	show_sound = event_cityscape
	picture = GFX_evt_ocean
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = FASCINATING
		add_deposit = d_teeming_reef
	}
}

# Lithoid Monolith
planet_event = {
	id = colonyexpanded.220
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_lithoids = yes
		NOT = { has_planet_flag = lith_monoliths_planet }
		exists = owner
		owner = { NOT = { has_country_flag = lith_monoliths_country } }
		From = {
   			is_deposit_type = d_mountain_range
   		}
	}
	
	immediate = {
		random_list = {
			2 = {
				modifier = {
					factor = 2
					is_lithoid_empire = yes
				}
				set_planet_flag = lith_monoliths_planet
				set_planet_flag = lith_monoliths_planet_cleared
				owner = { set_country_flag = lith_monoliths_country }
				planet_event = { id = colonyexpanded.221 days = 3 }
			}
			98 = {
			}
		}
	}
}
planet_event = {
	id = colonyexpanded.221
	title = "colonyexpanded.221.name"
	desc = {
		trigger = { has_planet_flag = lith_monoliths_planet_cleared }
		text = "colonyexpanded.221.desc"
	}
	desc = {
		trigger = { NOT = { has_planet_flag = lith_monoliths_planet_cleared } }
		text = "colonyexpanded.221.desc.a"
	}
	picture = GFX_evt_underground_city
	show_sound = event_whispering
	location = ROOT
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { NOT = { exists = event_target:petrified_lithoid_species } }
			create_species = {
				name = random
				class = "LITHOID"
				portrait = random
				traits = random
				homeworld = ROOT
				effect = {
					save_global_event_target_as = petrified_lithoid_species
				}
			}
		}
		if = {
			limit = { NOT = { exists = event_target:petrified_lithoid_species_hive } }
			create_species = {
				name = random
				class = "LITHOID"
				portrait = random
				traits = {
					trait = "trait_hive_mind"
					trait = random
				}
				homeworld = ROOT
				effect = {
					save_global_event_target_as = petrified_lithoid_species_hive
				}
			}
		}
	}
	
	option = {
		name = FASCINATING
		add_deposit = d_hibernating_lithoids_event
		add_deposit = d_hibernating_lithoids_event
		add_deposit = d_hibernating_lithoids_event
	}
	option = {
		name = colonyexpanded.221.a
		trigger = {
			owner = { is_xenophile = no }
		}
		owner = { add_resource = { minerals = 900 } }
	}
}

##################################
# Various Colony Events
# Reserved 299 - 399
##################################

### Randomly spawn planet modifier events ###
event = {
	id = colonyexpanded.299
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			random_list = {
				40 = {
					random_owned_planet = {
						limit = {
							OR = {
								AND = {
									has_modifier = "strong_magnetic_field"
									NOT = { has_modifier = "magnetic_research_boost" }
									NOT = { has_modifier = "magnetic_disruption" }
								}
								AND = {	
									has_modifier = asteroid_impacts
									NOT = { has_planet_flag = asteroid_defences_colony_flag }
								}
								AND = {
									has_modifier = unstable_tectonics
									NOT = { has_modifier = recent_quake }
								}
								AND = {
									has_modifier = "asteroid_belt"
									NOR = { 
										has_modifier = "recent_comet" 
										owner = { has_ethic = ethic_gestalt_consciousness }
									}
								}
							}
							is_under_colonization = no
							colony_age > 10
						}
						planet_event = { id = colony_mod.161 days = 180 random = 720 }
					}
				}
				60 = {
					# nothing happens
				}
			}
		}
	}
}

### Find fossilized titanic life ###
planet_event = {
	id = colonyexpanded.300
	title = "colonyexpanded.300.name"
	desc = "colonyexpanded.300.desc"
	show_sound = event_alien_nature
	picture = GFX_evt_alien_nature
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_modifier = titanic_life }
		is_nuked = no
		is_city = no
		habitable_structure = no
	}
	
	option = {
		name = FASCINATING
		add_deposit = d_titanic_fossils
	}
}

### Terraforming Candidate ###
ship_event = {
	id = colonyexpanded.310
	title = "anomaly.2575.name"
	desc = {
		text = anomaly.2575.desc.1
		trigger = { 
			NOT = { 
				owner = { has_technology = "tech_climate_restoration" } 
			}
		}
	}
	desc = {
		text = anomaly.2575.desc.2
		trigger = { 
			owner = { has_technology = "tech_climate_restoration" }
		}
	}
	picture = GFX_evt_drilling_for_gas
	location = FROM
	
	is_triggered_only = yes
	
	trigger = { FROM = { has_modifier = "terraforming_candidate" } }
	
	option = {
		name = FASCINATING
		custom_tooltip = TERRAFORMING_CANDIDATE_EFFECT
	}
}

### colony discovered to have presapients ###
planet_event = {
	id = colonyexpanded.312
	title = "uplift.6080.name"
	desc = "colonyexpanded.312.desc"
	picture = GFX_evt_microscopic_life
	location = ROOT
	show_sound = event_default
	
	is_triggered_only = yes
	
	trigger = {
		years_passed > 20
		owner = {
			NOR = {
				has_country_flag = found_presapients_312
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_machine_terminator
			}
		}
		habitable_planet = yes
		NOT = { is_gaia = yes }
	}
	
	immediate = {
		owner = {
			set_country_flag = found_presapients_312
		}
		random_list = {
			15 = {
				create_species = {
					name = random
					class = "PRE_MAM"
					portrait = random
					traits = {
						trait = random_presapient_trait
					}
					homeworld = ROOT
					sapient = no
				}
			}
			15 = {
				create_species = {
					name = random
					class = "PRE_REP"
					portrait = random
					traits = {
						trait = random_presapient_trait
					}
					homeworld = ROOT
					sapient = no
				}
			}
			15 = {
				create_species = {
					name = random
					class = "PRE_AVI"
					portrait = random
					traits = {
						trait = random_presapient_trait
					}
					homeworld = ROOT
					sapient = no
				}
			}
			15 = {
				create_species = {
					name = random
					class = "PRE_ART"
					portrait = random
					traits = {
						trait = random_presapient_trait
					}
					homeworld = ROOT
					sapient = no
				}
			}
			15 = {
				create_species = {
					name = random
					class = "PRE_MOL"
					portrait = random
					traits = {
						trait = random_presapient_trait
					}
					homeworld = ROOT
					sapient = no
				}
			}
			15 = {
				create_species = {
					name = random
					class = "PRE_FUN"
					portrait = random
					traits = {
						trait = random_presapient_trait
					}
					homeworld = ROOT
					sapient = no
				}
			}
		}
		while = {
			limit = {
				count_pops = {
					limit = { is_sapient = no }
					count < 3
				}
			}
			create_pop = { species = last_created }
		}
	}
	
	option = {
		name = uplift.6000.a
		trigger = {
			owner = { has_technology = "tech_epigenetic_triggers" }
		}
	}

	option = {
		name = uplift.6000.b
		trigger = {
			owner = { NOT = { has_technology = "tech_epigenetic_triggers" } }
		}
	}
}

# 6 year event gatekeeper
planet_event = {
	id = colonyexpanded.313
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_owner = yes
		original_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
		num_pops > 0
		is_capital = no
		OR = {
			has_deposit = d_giant_pearls
			has_deposit = d_toy_factory_complex
		}
	}
	
	immediate = {
		if = {
			limit = {
				has_deposit = d_giant_pearls
				owner = {
					NOT = { has_ethic = ethic_gestalt_consciousness }
					NOT = { has_ethic = ethic_fanatic_materialist }
					NOT = { has_technology = tech_psionic_theory }
				}
			}
			random_list = {
				1 = {
					planet_event = { id = colonyexpanded.314 days = 1 random = 15 }
				}
				1 = { }
			}
		}
		else_if = {
			limit = {
				has_deposit = d_toy_factory_complex
				owner = {
					OR = {
						is_gestalt = no
						has_valid_civic = civic_machine_servitor
					}
				}
			}
			planet_event = { id = colonyexpanded.330 days = 15 random = 45 }
		}
	}
}

# psionic pearls
planet_event = {
	id = colonyexpanded.314
	title = "colonyexpanded.314.name"
	desc = "colonyexpanded.314.desc"
	picture = GFX_evt_ocean
	show_sound = event_mystic_reveal
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = REMARKABLE
		owner = {
			add_research_option = tech_psionic_theory
	 		add_tech_progress = {
				tech = tech_psionic_theory
	  			progress = 0.25
	 		}
		}
	}
}

##########################
# Cunning Flora Follow-up
# 320 - 329
##########################

# Warn that plants are angry
planet_event = {
	id = colonyexpanded.320
	title = "anomaly.91.name"
	desc = {
		trigger = {
			OR = {
				has_planet_flag = cunning_flora_flag
				has_modifier = cunning_flora
			}
		}
		text = "colonyexpanded.320.desc"
	}
	desc = {
		trigger = {
			NOR = {
				has_planet_flag = cunning_flora_flag
				has_modifier = cunning_flora
			}
		}
		text = "colonyexpanded.320.desc_alt"
	}
	picture = GFX_evt_aggressive_flora
	show_sound = event_alien_nature
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_planet_flag = cunning_flora_flag
			has_modifier = cunning_flora
			has_deposit = d_savage_wildlands
		}
	}
	
	option = {
		name = colonyexpanded.320.a
		add_deposit = d_cunning_flora_perimeter_1
	}
}

# Expand defensive perimeter
planet_event = {
	id = colonyexpanded.321
	title = "colonyexpanded.321.name"
	desc = "colonyexpanded.321.desc"
	picture = GFX_evt_victorious_army
	show_sound = event_ground_battle
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = OK
		hidden_effect = {
			remove_deposit = d_cunning_flora_perimeter_1
		}
		add_deposit = d_cunning_flora_perimeter_2
	}
}

# Complete the defensive perimeter
planet_event = {
	id = colonyexpanded.322
	title = "colonyexpanded.322.name"
	desc = "colonyexpanded.322.desc"
	picture = GFX_evt_victorious_army
	show_sound = event_ground_battle
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		hidden_effect = {
			remove_deposit = d_cunning_flora_perimeter_2
		}
		add_deposit = d_cunning_flora_perimeter_3
	}
}
# Cunning Plants tabola
event = {
	id = colonyexpanded.323
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = {
				any_owned_planet = {
					is_colony = yes
					is_under_colonization = yes
					OR = {
						has_planet_flag = cunning_flora_flag
						has_modifier = cunning_flora
						has_deposit = d_savage_wildlands
					}
				}
			}
			random_owned_planet = {
				limit = {
					is_colony = yes
					is_under_colonization = yes
					OR = {
						has_planet_flag = cunning_flora_flag
						has_modifier = cunning_flora
						has_deposit = d_savage_wildlands
					}
				}
				planet_event = { id = colonyexpanded.324 days = 60 random = 1440 }
			}
		}
	}
}
planet_event = {
	id = colonyexpanded.324
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			80 = { }
			20 = {
				random_list = {
					7 = {
						# attack, pop killed
						planet_event = { id = colonyexpanded.325 }
					}
					3 = {
						# attack, driven back
						planet_event = { id = colonyexpanded.326 }
						modifier = {
							factor = 2
							has_deposit = d_cunning_flora_perimeter_2
						}
						modifier = {
							factor = 4
							has_deposit = d_cunning_flora_perimeter_3
						}
					}
				}
			}
		}
	}
}

# plants attack settlement - pop killed
planet_event = {
	id = colonyexpanded.325
	title = "colonyexpanded.325.name"
	desc = "colonyexpanded.325.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_space_battle
	location = root
	
	is_triggered_only = yes
	
	option = {
		name = TERRIBLE
		add_planet_devastation = 25
		random_pop = {
			kill_pop = yes
		}
	}
}

# plants attack settlement - driven back
planet_event = {
	id = colonyexpanded.326
	title = "colonyexpanded.325.name"
	desc = "colonyexpanded.326.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_space_battle
	location = root
	
	is_triggered_only = yes
	
	option = {
		name = OK
		add_planet_devastation = 20
	}
}

##########################
# Toy Factory Follow-up
# 330 - 339
##########################

# Find Documentation
planet_event = {
	id = colonyexpanded.330
	title = "colonyexpanded.330.name"
	desc = "colonyexpanded.330.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	option = {
		name = colonyexpanded.330.a
		enable_special_project = {
			name = "TOY_FACTORY_REPROGRAM_PROJECT"
			location = this
			owner = root
		}
	}
	option = {
		name = colonyexpanded.330.b
	}
}

# Project Success
planet_event = {
	id = colonyexpanded.331
	title = "colonyexpanded.331.name"
	desc = "colonyexpanded.331.desc"
	picture = GFX_evt_ancient_alien_temple
	show_sound = event_activating_unknown_technology
	location = root
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		hidden_effect = {
			set_planet_flag = toy_factory_artisans
		}
		custom_tooltip = colonyexpanded.331.tooltip
	}
}

# Project Failure
planet_event = {
	id = colonyexpanded.332
	title = "colonyexpanded.332.name"
	desc = "colonyexpanded.332.desc"
	picture = GFX_evt_ancient_alien_temple
	show_sound = event_radio_chatter
	location = root
	
	is_triggered_only = yes
	
	option = {
		name = UNFORTUNATE
		owner = {
			random_owned_leader = {
				limit = { is_researching_area = physics }
				if = {
					limit = { NOT = { has_trait = "leader_trait_expertise_computing" } }
					add_trait = leader_trait_expertise_computing
				}
			}
		}
	}
}

# Project Security
planet_event = {
	id = colonyexpanded.333
	title = "colonyexpanded.333.name"
	desc = "colonyexpanded.333.desc"
	picture = GFX_evt_interior_battle
	show_sound = event_ground_battle
	location = root
	
	is_triggered_only = yes
	
	option = {
		name = colonyexpanded.333.a
		random_pop = {
			limit = {
				OR = {
					has_job = researcher
					has_job = brain_drone
					has_job = calculator
				}
			}
			kill_pop = yes
		}
		enable_special_project = {
			name = "TOY_FACTORY_SECURITY_PROJECT"
			location = this
			owner = root.owner
		}
	}
}

# Project Explotion
planet_event = {
	id = colonyexpanded.334
	title = "colonyexpanded.334.name"
	desc = "colonyexpanded.334.desc"
	picture = GFX_evt_nuclear_explosion
	show_sound = event_ship_explosion
	location = root
	
	is_triggered_only = yes
	
	option = {
		name = TERRIBLE
		remove_deposit = d_toy_factory_complex
		add_planet_devastation = 25
		random_pop = {
			limit = {
				OR = {
					has_job = researcher
					has_job = brain_drone
					has_job = calculator
				}
			}
			kill_pop = yes
		}
		random_pop = {
			limit = {
				OR = {
					has_job = researcher
					has_job = brain_drone
					has_job = calculator
				}
			}
			kill_pop = yes
		}
	}
}

# Defeat security
ship_event = {
	id = colonyexpanded.335
	title = "colonyexpanded.331.name"
	desc = "colonyexpanded.335.desc"
	picture = GFX_evt_interior_battle
	show_sound = event_ground_battle
	location = FROMFROM
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		hidden_effect = {
			FROMFROM = { set_planet_flag = toy_factory_artisans }
		}
		custom_tooltip = colonyexpanded.331.tooltip
	}
}

##########################
# Pre-Sapient Events
# 340 - 359
##########################

# Pre-Sapient hitchhikers
planet_event = {
	id = colonyexpanded.340
	title = "colonyexpanded.340.name"
	desc = "colonyexpanded.340.desc"
	picture = GFX_evt_alien_cavemen
	location = root

	pre_triggers = {
		has_owner = yes
	}

	trigger = {
		has_owner = yes
		NOT = {
			any_pop = {
				is_sapient = no
				is_robot_pop = no
			}
		}
		owner = {
			is_ai = no
			any_owned_planet = {
				any_pop = {
					is_sapient = no
					is_robot_pop = no
					ROOT = {
						habitability = {
							who = PREV
							value > 0.6
						}
					}
				}
			}
		}
		NOT = { has_planet_flag = presapient_hitchhikers }
	}

	mean_time_to_happen = { months = 1500 }

	immediate = {
		set_planet_flag = presapient_hitchhikers
		owner = {
			random_owned_planet = {
				limit = {
					any_pop = {
						is_sapient = no
						is_robot_pop = no
						ROOT = {
							habitability = { 
								who = PREV
								value > 0.6
							}
						}
					}
				}
				save_event_target_as = presapient_planet
				random_pop = {
					limit = {
						is_sapient = no
						is_robot_pop = no
					}
					save_event_target_as = presapient_pop
				}
			}
		}
		create_pop = {
			species = event_target:presapient_pop
		}
		create_pop = {
			species = event_target:presapient_pop
		}
	}

	option = {
		name = UNFORTUNATE
		trigger = {
			owner = {
				is_xenophobe = yes
			}
		}
		tooltip = {
			create_pop = {
				species = event_target:presapient_pop
			}
			create_pop = {
				species = event_target:presapient_pop
			}
		}
	}

	option = {
		name = INTERESTING
		trigger = {
			owner = {
				is_xenophobe = no
			}
		}
		tooltip = {
			create_pop = {
				species = event_target:presapient_pop
			}
			create_pop = {
				species = event_target:presapient_pop
			}
		}
	}
}

# Bigfoot
planet_event = {
	id = colonyexpanded.341
	title = "colonyexpanded.341.name"
	desc = "colonyexpanded.341.desc"
	picture = GFX_evt_animal_wildlife
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		has_owner = yes
		NOT = {
			any_pop = {
				is_sapient = no
				is_robot_pop = no
			}
		}
		owner = {
			NOT = { has_country_flag = bigfoot_planet_event }
		}
		OR = {
			is_continental = yes
			is_tropical = yes
			is_alpine = yes
		}
	}
	
	immediate = {
		owner = { set_country_flag = bigfoot_planet_event }
	}
	
	option = {
		name = colonyexpanded.341.a
		owner = {
			add_resource = { influence = 50 }
		}
		hidden_effect = {
			if = {
				limit = { owner = { is_gestalt = no } }
				planet_event = { id = colonyexpanded.344 days = 1080 random = 1080 }
			}
		}
	}
	option = {
		name = colonyexpanded.341.b
		enable_special_project = {
			name  = BIGFOOT_PROJECT
			location = this
			owner = root.owner
		}
	}
}
# Bigfoot Found
ship_event = {
	id = colonyexpanded.342
	title = PROJECT_COMPLETE
	desc = "colonyexpanded.342.desc"
	picture = GFX_evt_alien_cavemen
	location = FROMFROM
	
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = {
			create_species = {
				name = random
				class = "PRE_MAM"
				portrait = pre_mam13
				traits = {
					trait = trait_presapient_earthbound
					trait = trait_very_strong
					trait = trait_quick_learners
					trait = trait_slow_breeders
				}
				homeworld = FROMFROM
				sapient = no
			}
			while = {
				limit = {
					count_pops = {
						limit = { is_sapient = no }
						count < 3
					}
				}
				create_pop = { species = last_created }
			}
		}
	}
	
	option = {
		name = uplift.6000.a
		trigger = {
			owner = { has_technology = "tech_epigenetic_triggers" }
		}
	}

	option = {
		name = uplift.6000.b
		trigger = {
			owner = { NOT = { has_technology = "tech_epigenetic_triggers" } }
		}
	}
}
# Bigfoot Elusive
ship_event = {
	id = colonyexpanded.343
	title = PROJECT_COMPLETE
	desc = "colonyexpanded.343.desc"
	picture = GFX_evt_animal_wildlife
	location = FROMFROM
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { owner = { is_gestalt = no } }
			FROMFROM = { planet_event = { id = colonyexpanded.344 days = 1080 random = 1080 } }
		}
	}
	
	option = {
		name = colonyexpanded.343.a
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
	}
}
# Cryptozoologists
planet_event = {
	id = colonyexpanded.344
	title = "colonyexpanded.344.name"
	desc = "colonyexpanded.344.desc"
	picture = GFX_evt_animal_wildlife
	location = root
	
	is_triggered_only = yes
	
	immediate = {
		planet_event = { id = colonyexpanded.345 days = 2160 random = 2160 }
	}
	
	option = {
		name = CURIOUS
	}
}
# Bigfoot Found
planet_event = {
	id = colonyexpanded.345
	title = "colonyexpanded.345.name"
	desc = "colonyexpanded.345.desc"
	picture = GFX_evt_alien_cavemen
	location = root
	
	is_triggered_only = yes
	
	immediate = {
		create_species = {
			name = random
			class = "PRE_MAM"
			portrait = pre_mam13
			traits = {
				trait = trait_presapient_earthbound
				trait = trait_very_strong
				trait = trait_quick_learners
				trait = trait_slow_breeders
			}
			homeworld = ROOT
			sapient = no
		}
		while = {
			limit = {
				count_pops = {
					limit = { is_sapient = no }
					count < 3
				}
			}
			create_pop = { species = last_created }
		}
	}
	
	option = {
		name = uplift.6000.a
		trigger = {
			owner = { has_technology = "tech_epigenetic_triggers" }
		}
	}

	option = {
		name = uplift.6000.b
		trigger = {
			owner = { NOT = { has_technology = "tech_epigenetic_triggers" } }
		}
	}
}

##########################
# Helpful Drone Events
# 360 - 369
##########################

# Third event, drones awaken and remove a random Blocker from the planet's surface
planet_event = {
	id = colonyexpanded.360
	title = "colonyexpanded.360.name"
	desc = "colonyexpanded.360.desc"
	picture = GFX_evt_mining_operations
	location = ROOT
	
	is_triggered_only = yes

	trigger = { owner = { has_country_flag = FLDrone_country } }

	option = {
		name = colonyexpanded.360.a
		custom_tooltip = colonyexpanded.360.a.tooltip
		hidden_effect = {
			add_random_non_blocker_deposit = yes
			create_message = {
				type = MESSAGE_TYPE_PLANET_PROSPECTED
				localization = MESSAGE_PLANET_PROSPECTED
				days = 30
				target = this
				variable = {
					type = name
					localization = PLANET
					scope = this
				}
				variable = {
					type = name
					localization = DEPOSIT
					scope = last_added_deposit
				}
			}
			planet_event = { id = colony.1503 days = 360 }
		}
	}
}

##################################
# Crime Colony Events
# Reserved 400 - 499
##################################

# Criminal Underworld Appears (Low Stability)
planet_event = {
	id = colonyexpanded.400
	title = crime.40.name
	desc = colonyexpanded.400.desc
	picture = GFX_evt_dark_alley
	show_sound = event_criminal_activity
	location = root
	
	pre_triggers = {
		has_owner = yes
	}

	trigger = {
		owner = {
			OR = {
				is_country_type = default
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
			is_gestalt = no
		}
		NOR = {
			has_planet_flag = criminal_underworld_event_up
			has_modifier = unemployment_benefits
			has_modifier = activity_program
			has_modifier = standby_mode
			has_modifier = criminal_underworld
			has_modifier = drone_deviancy
			has_modifier = drone_corruption
			has_modifier = gang_wars
			has_modifier = center_of_drug_trade
			has_modifier = mob_rule
			# Slavery and Unrest
			has_planet_flag = slave_stirring
			has_planet_flag = recent_unrest_event
			has_modifier = slave_hunger_strike 
			has_modifier = slave_riots
			has_modifier = adding_unrest_slaves
			has_modifier = revolt_suppressed
		}
		NOT = { has_planet_flag = criminal_underworld_disappeared } # Cooldown
		num_pops > 0
		planet_crime >= 15
		planet_stability < 35
	}

	mean_time_to_happen = {
		months = 500

		modifier = {
			factor = 0.5
			planet_stability < 25
		}
		modifier = {
			factor = 0.5
			planet_stability < 15
		}
		modifier = {
			factor = 0.5
			planet_stability < 5
		}	
	}

	immediate = {
		set_planet_flag = criminal_underworld_event_up
		set_timed_planet_flag = { flag = criminal_underworld_appeared days = 3600 }
		add_modifier = { modifier = "criminal_underworld" days = -1 }
	}

	after = {
		hidden_effect = {
			remove_planet_flag = criminal_underworld_event_up
		}
	}
	
	option = {
		name = crime.40.a
		tooltip = {
			add_modifier = { modifier = "criminal_underworld" days = -1 }
		}
	}
}

# Minor Crime Modifiers Removed (Low Crime)
planet_event = {
	id = colonyexpanded.401
	title = colonyexpanded.401.name
	desc = {
		trigger = {
			owner = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
			}
		}
		text = colonyexpanded.401.desc
	}
	desc = {
		trigger = { 
			owner = { has_authority = auth_hive_mind }
		}
		text = colonyexpanded.401.b.desc
	}
	desc = {
		trigger = { 
			owner = { has_authority = auth_machine_intelligence }
		}
		text = colonyexpanded.401.c.desc
	}
	picture = {
		trigger = { 
			owner = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
			}
		}
		picture = GFX_evt_dark_alley
	}
	picture = {
		trigger = { 
			owner = { has_authority = auth_hive_mind }
		}
		picture = GFX_evt_hive_mind
	}
	picture = {
		trigger = { 
			owner = { has_authority = auth_machine_intelligence }
		}
		picture = GFX_evt_glitchy_matrix
	}
	show_sound = event_cityscape
	location = root
	
	pre_triggers = {
		has_owner = yes
	}

	trigger = {
		owner = {
			OR = {
				is_country_type = default
				is_country_type = ascended_empire
				is_country_type = lost_empire
			}
		}
		OR = {
			has_modifier = black_market
			has_modifier = white_collar_crime
			has_modifier = corrupt_cops
			has_modifier = art_theft
			has_modifier = mirror_criminals
			has_modifier = software_error
			has_modifier = malfunctioning_nexus
			has_modifier = diseased_synapses
		}
		NOR = {
			has_modifier = criminal_underworld
			has_modifier = drone_deviancy
			has_modifier = drone_corruption
			has_modifier = gang_wars
			has_modifier = center_of_drug_trade
			has_modifier = mob_rule
		}
		NOT = { has_planet_flag = minor_crime_disappeared } # Cooldown
		num_pops > 0
		planet_crime <= 1
	}

	mean_time_to_happen = {
		months = 180

		modifier = {
			factor = 0.5
			count_pops = {
				limit = { 
					OR = {
						has_job = enforcer
						has_job = coordinator
						has_job = synapse_drone
						has_job = patrol_drone
					}
				}
				count > 2
			}
		}
		modifier = {
			factor = 0.5
			count_pops = {
				limit = { 
					OR = {
						has_job = enforcer
						has_job = coordinator
						has_job = synapse_drone
						has_job = patrol_drone
					}
				}
				count > 3
			}
		}
		modifier = {
			factor = 0.5
			count_pops = {
				limit = { 
					OR = {
						has_job = enforcer
						has_job = coordinator
						has_job = synapse_drone
						has_job = patrol_drone
					}
				}
				count > 4
			}
		}	
	}
	
	option = {
		name = GOOD
		trigger = {
			owner = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
			}
		}
		if = {
			limit = { has_modifier = black_market }
			remove_modifier = black_market
		}
		if = {
			limit = { has_modifier = white_collar_crime }
			remove_modifier = white_collar_crime
		}
		if = {
			limit = { has_modifier = corrupt_cops }
			remove_modifier = corrupt_cops
			add_modifier = { modifier = "corrupt_cops_lingering" days = 3600 }
		}
		if = {
			limit = { has_modifier = art_theft }
			remove_modifier = art_theft
		}
		if = {
			limit = { has_modifier = mirror_criminals }
			remove_modifier = mirror_criminals
		}
		hidden_effect = {
			set_timed_planet_flag = { flag = minor_crime_disappeared days = 3600 }
		}
	}
	option = {
		name = GOOD
		trigger = { 
			owner = { has_authority = auth_hive_mind }
		}
		if = {
			limit = { has_modifier = diseased_synapses }
			remove_modifier = diseased_synapses
		}
		if = {
			limit = { has_modifier = malfunctioning_nexus }
			remove_modifier = scavenging_drones
		}
		hidden_effect = {
			set_timed_planet_flag = { flag = minor_crime_disappeared days = 3600 }
		}
	}
	option = {
		name = GOOD
		trigger = { 
			owner = { has_authority = auth_machine_intelligence }
		}
		if = {
			limit = { has_modifier = software_error }
			remove_modifier = software_error
		}
		if = {
			limit = { has_modifier = malfunctioning_nexus }
			remove_modifier = malfunctioning_nexus
		}
		if = {
			limit = { has_modifier = malfunctioning_nexus }
			remove_modifier = scavenging_drones
		}
		hidden_effect = {
			set_timed_planet_flag = { flag = minor_crime_disappeared days = 3600 }
		}
	}
}

# Minor Crime Gate Keeper (yearly pulse)
event = {
	id = colonyexpanded.402
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_playable_country = {
			limit = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
				any_owned_planet = {
					NOR = {
						has_planet_flag = planet_crime_flag
						has_planet_flag = minor_crime_disappeared
						has_modifier = crime_lord_deal
					}
					is_under_colonization = no
				}
			}
			country_event = { id = colonyexpanded.403 days = 1 random = 358 }
		}
		every_playable_country = {
			limit = { 
				has_authority = auth_hive_mind
				any_owned_planet = {
					NOR = { 
						has_planet_flag = planet_crime_flag
						has_planet_flag = minor_crime_disappeared
					}
					is_under_colonization = no
				}
			}
			country_event = { id = colonyexpanded.404 days = 1 random = 358 }
		}
		every_playable_country = {
			limit = { 
				has_authority = auth_machine_intelligence
				any_owned_planet = {
					NOR = { 
						has_planet_flag = planet_crime_flag
						has_planet_flag = minor_crime_disappeared
					}
					is_under_colonization = no
				}
			}
			country_event = { id = colonyexpanded.405 days = 1 random = 358 }
		}
	}
}
# Gate Keeper (non gestalt)
country_event = {
	id = colonyexpanded.403
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		random_owned_planet = {
			limit = {
				NOR = { 
					has_planet_flag = planet_crime_flag
					has_planet_flag = minor_crime_disappeared
					has_modifier = crime_lord_deal
				}
				is_under_colonization = no
			}
			random_list = {
				400 = { }
				# Black Market
				10 = {
					planet_event = { id = colonyexpanded.406 }
					modifier = {
						factor = 1.5
						NOT = { has_modifier = black_market }
						OR = {
							free_amenities < 0
							owner = {
								resource_stockpile_compare = {
									resource = consumer_goods
									value < 1
								}
							}
						}
						OR = {
							has_modifier = criminal_underworld
							has_modifier = center_of_drug_trade
							has_modifier = mob_rule
						}
					}
					modifier = {
						factor = 1.5
						NOT = { has_modifier = black_market }
						OR = {
							free_amenities < -5
							ROOT = {
								has_monthly_income = {
									resource = consumer_goods
									value < -15
								}
							}
						}
					}
					modifier = {
						factor = 1.5
						NOT = { has_modifier = black_market }
						OR = {
							free_amenities < -10
							ROOT = {
								has_monthly_income = {
									resource = consumer_goods
									value < -30
								}
							}
						}
					}
					modifier = {
						factor = 2.0
						NOT = { has_modifier = black_market }
						OR = {
							free_amenities < -15
							ROOT = {
								has_monthly_income = {
									resource = consumer_goods
									value < -45
								}
							}
						}
					}
					modifier = {
						factor = 2.5
						NOT = { has_modifier = black_market }
						OR = {
							free_amenities < -20
							ROOT = {
								has_monthly_income = { 
									resource = consumer_goods
									value < -60
								}
							}
						}
					}
				}
				# White-Collar Crime
				10 = { planet_event = { id = colonyexpanded.408 } }
				# Police Corruption
				5 = {
					planet_event = { id = colonyexpanded.409 }
					modifier = {
						factor = 2
						NOT = { has_modifier = corrupt_cops }
						NOT = { has_modifier = corrupt_cops_lingering }
						OR = {
							has_modifier = criminal_underworld
							has_modifier = center_of_drug_trade
							has_modifier = mob_rule
						}
					}
					modifier = {
						factor = 1.5
						NOT = { has_modifier = corrupt_cops }
						NOT = { has_modifier = corrupt_cops_lingering }
						OR = {
							planet_crime > 14
							planet_stability < 36
						}
					}
					modifier = {
						factor = 1.5
						NOT = { has_modifier = corrupt_cops }
						NOT = { has_modifier = corrupt_cops_lingering }
						OR = {
							planet_crime > 19
							planet_stability < 31
						}
					}
				}
				# Art Theft
				10 = { planet_event = { id = colonyexpanded.410 } }
			}
		}
	}
}
# Gate Keeper (hive)
country_event = {
	id = colonyexpanded.404
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		random_owned_planet = {
			limit = {
				NOR = {
					has_planet_flag = planet_crime_flag
					has_planet_flag = minor_crime_disappeared
				}
				is_under_colonization = no
			}
			random_list = {
				300 = { }
				# Diseased Synapses
				10 = { planet_event = { id = colonyexpanded.412 } }
				# Scavenging Drones
				10 = { planet_event = { id = colonyexpanded.413 } }
			}
		}
	}
}
# Gate Keeper (machine)
country_event = {
	id = colonyexpanded.405
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		random_owned_planet = {
			limit = {
				NOR = {
					has_planet_flag = planet_crime_flag
					has_planet_flag = minor_crime_disappeared
				}
				is_under_colonization = no
			}
			random_list = {
				300 = { }
				# data corruption
				10 = { planet_event = { id = colonyexpanded.407 } }
				# malfunctioing nexus
				10 = { planet_event = { id = colonyexpanded.411 } }
				# Scavenging Drones
				10 = { planet_event = { id = colonyexpanded.413 } }
			}
		}
	}
}

# Black Market (Low Amenities)
planet_event = {
	id = colonyexpanded.406
	title = colonyexpanded.406.name
	desc = colonyexpanded.406.desc
	picture = GFX_evt_dark_alley
	show_sound = event_criminal_activity
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		exists = owner
		NOT = { has_modifier = black_market }
		OR = {
			free_amenities < 0
			owner = {
				resource_stockpile_compare = {
					resource = consumer_goods
					value < 1
				}
			}
		}
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = planet_crime_flag
			days = 3600
		}
		add_modifier = { modifier = "black_market" days = -1 }
	}
	
	option = {
		name = UNFORTUNATE
		tooltip = {
			add_modifier = { modifier = "black_market" days = -1 }
		}
	}
}

# Software Error
planet_event = {
	id = colonyexpanded.407
	title = colonyexpanded.407.name
	desc = colonyexpanded.407.desc
	picture = GFX_evt_glitchy_matrix
	show_sound = event_criminal_activity
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_modifier = software_error }
		OR = {
			planet_crime > 0
			planet_stability < 46
		}
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = planet_crime_flag
			days = 3600
		}
		add_modifier = { modifier = "software_error" days = -1 }
	}
	
	option = {
		name = UNFORTUNATE
		tooltip = {
			add_modifier = { modifier = "software_error" days = -1 }
		}
		
	}
}

# White-Collar Crime (trading hub)
planet_event = {
	id = colonyexpanded.408
	title = colonyexpanded.408.name
	desc = colonyexpanded.408.desc
	picture = GFX_evt_dark_alley
	show_sound = event_criminal_activity
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		exists = owner
		NOT = { has_modifier = white_collar_crime }
		OR = {
			has_building = building_commercial_zone
			has_building = building_commercial_megaplex
			has_building = building_galactic_stock_exchange
			has_district = district_hab_commercial
		}
		OR = {
			planet_crime > 0
			planet_stability < 46
		}
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = planet_crime_flag
			days = 3600
		}
		add_modifier = { modifier = "white_collar_crime" days = -1 }
	}
	
	option = {
		name = colonyexpanded.408.a
		tooltip = {
			add_modifier = { modifier = "white_collar_crime" days = -1 }
		}
	}
}

# Corrupt Cops
planet_event = {
	id = colonyexpanded.409
	title = colonyexpanded.409.name
	desc = colonyexpanded.409.desc
	picture = GFX_evt_dark_alley
	show_sound = event_criminal_activity
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		exists = owner
		NOT = { has_modifier = corrupt_cops }
		NOT = { has_modifier = corrupt_cops_lingering }
		OR = {
			planet_crime > 9
			planet_stability < 46
		}
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = planet_crime_flag
			days = 3600
		}
		add_modifier = { modifier = "corrupt_cops" days = -1 }
	}
	
	option = {
		name = colonyexpanded.408.a
		tooltip = {
			add_modifier = { modifier = "corrupt_cops" days = -1 }
		}
		if = {
			limit = { has_global_flag = expanded_pops_active }
			custom_tooltip = colonyexpanded.409.a.tooltip
		}
	}
}

# Art Theft
planet_event = {
	id = colonyexpanded.410
	title = colonyexpanded.410.name
	desc = colonyexpanded.410.desc
	picture = GFX_evt_dark_alley
	show_sound = event_criminal_activity
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		exists = owner
		NOT = { has_modifier = art_theft }
		OR = {
			planet_crime > 0
			planet_stability < 46
		}
		OR = {
			has_building = building_autochthon_monument
			has_building = building_heritage_site
			has_building = building_hypercomms_forum
			has_building = building_autocurating_vault
			has_building = building_temple
			has_building = building_holotemple
			has_building = building_sacred_nexus
			has_building = building_citadel_of_faith
			has_building = building_corporate_monument
			has_building = building_corporate_site
			has_building = building_corporate_forum
			has_building = building_corporate_vault
			has_district = district_hab_cultural
			has_district = district_arcology_leisure
			has_modifier = artist_monument_erected
		}
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = planet_crime_flag
			days = 3600
		}
		add_modifier = { modifier = "art_theft" days = -1 }
	}
	
	option = {
		name = colonyexpanded.410.a
		tooltip = {
			add_modifier = { modifier = "art_theft" days = -1 }
		}
	}
}

# Malfunctioning Nexus
planet_event = {
	id = colonyexpanded.411
	title = colonyexpanded.411.name
	desc = colonyexpanded.411.desc
	picture = GFX_evt_glitchy_matrix
	show_sound = event_criminal_activity
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_modifier = malfunctioning_nexus }
		OR = {
			planet_crime > 0
			planet_stability < 46
		}
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = planet_crime_flag
			days = 3600
		}
		add_modifier = { modifier = "malfunctioning_nexus" days = -1 }
	}
	
	option = {
		name = UNFORTUNATE
		tooltip = {
			add_modifier = { modifier = "malfunctioning_nexus" days = -1 }
		}
		
	}
}

# Diseased Synapses
planet_event = {
	id = colonyexpanded.412
	title = colonyexpanded.412.name
	desc = colonyexpanded.412.desc
	picture = GFX_evt_hive_mind
	show_sound = event_criminal_activity
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_modifier = diseased_synapses }
		OR = {
			planet_crime > 0
			planet_stability < 46
		}
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = planet_crime_flag
			days = 3600
		}
		add_modifier = { modifier = "diseased_synapses" days = -1 }
	}
	
	option = {
		name = UNFORTUNATE
		tooltip = {
			add_modifier = { modifier = "diseased_synapses" days = -1 }
		}
		
	}
}

# Scavenging Drones
planet_event = {
	id = colonyexpanded.413
	title = colonyexpanded.413.name
	desc = colonyexpanded.413.desc
	picture = {
		trigger = { 
			owner = { has_authority = auth_hive_mind }
		}
		picture = GFX_evt_hive_mind
	}
	picture = {
		trigger = { 
			owner = { has_authority = auth_machine_intelligence }
		}
		picture = GFX_evt_glitchy_matrix
	}
	show_sound = event_criminal_activity
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_modifier = scavenging_drones }
		free_amenities < 0
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = planet_crime_flag
			days = 3600
		}
		add_modifier = { modifier = "scavenging_drones" days = -1 }
	}
	
	option = {
		name = UNFORTUNATE
		tooltip = {
			add_modifier = { modifier = "scavenging_drones" days = -1 }
		}
		
	}
}

# Deviants Assassinate Governor
planet_event = {
	id = colonyexpanded.414
	title = colonyexpanded.414.name
	desc = colonyexpanded.414.desc
	picture = {
		trigger = {
			owner = { has_authority = auth_hive_mind }
		}
		picture = GFX_evt_hive_mind
	}
	picture = {
		trigger = { 
			owner = { has_authority = auth_machine_intelligence }
		}
		picture = GFX_evt_glitchy_matrix
	}
	show_sound = event_criminal_activity
	location = root

	trigger = {
		has_owner = yes
		planet_crime >= 50
		sector = { exists = leader }
	}

	is_triggered_only = yes

	immediate = {
		sector = {
			leader = { save_event_target_as = governor_target }
		}
		owner = { set_country_flag = gangsters_killed_governor }
	}
	
	option = {
		name = UNFORTUNATE
		add_planet_devastation = 20
		sector = {
			leader = { kill_leader = { show_notification = no } }
		}
	}
}

# Deviants Spreads into Space
planet_event = {
	id = colonyexpanded.415
	title = colonyexpanded.415.name
	desc = colonyexpanded.415.desc
	picture = GFX_evt_pirates_attacking_cargo
	show_sound = event_space_battle
	location = root

	trigger = {
		has_owner = yes
		owner = { NOT = { has_country_flag = crime_pirates_spawned } }
		planet_crime >= 60
	}

	is_triggered_only = yes

	immediate = {
		owner = {
			set_timed_country_flag = { flag = crime_pirates_spawned days = 3600 }
			owner_species = { save_event_target_as = owner_species }
			if = {
				limit = { NOT = { has_country_flag = birth_of_piracy } }
				set_country_flag = birth_of_piracy
			}
		}
		solar_system = {
			save_event_target_as = pirate_system
			create_normal_pirate_country = yes
			create_pirate_fleet = yes
		}
	}
	
	option = {
		name = crime.200.a
		custom_tooltip = crime.102.tooltip
	}
}

# Contraband Seized
planet_event = {
	id = colonyexpanded.416
	title = crime.7.name
	desc = colonyexpanded.416.desc
	picture = GFX_evt_ship_offloading_cargo
	show_sound = event_criminal_activity
	location = root

	trigger = {
		has_owner = yes
		OR = {
			has_modifier = drone_deviancy
			has_modifier = drone_corruption
		}
	}

	is_triggered_only = yes

	immediate = {
		set_timed_planet_flag = {
			flag = planet_crime_flag
			days = 3600
		}
	}
	
	option = {
		name = EXCELLENT
		owner = {
			locked_random_list = {
				10 = {
					add_resource = { alloys = 100 }
				}
				5 = {
					add_resource = { minerals = 500 }
				}
				5 = {
					modifier = {
						factor = 0
						is_machine_empire = yes
					}
					add_resource = { food = 500 }
				}
				5 = {
					modifier = {
						factor = 0
						is_machine_empire = no
					}
					add_resource = { energy = 500 }
				}
				10 = { 
					modifier = {
						factor = 0
						NOT = { has_technology = "tech_mine_volatile_motes" }
					}
					add_resource = { volatile_motes = 20 }
				}
				10 = { 
					modifier = {
						factor = 0
						NOT = { has_technology = "tech_mine_exotic_gases" }
					}
					add_resource = { exotic_gases = 20 }
				}
				10 = { 
					modifier = {
						factor = 0
						NOT = { has_technology = "tech_mine_rare_crystals" }
					}
					add_resource = { rare_crystals = 20 }
				}
				10 = { 
					modifier = {
						factor = 0
						NOT = { has_technology = "tech_mine_living_metal" }
					}
					add_resource = { sr_living_metal = 20 }
				}
				10 = { 
					modifier = {
						factor = 0
						NOT = { has_technology = "tech_mine_zro" }
					}
					add_resource = { sr_zro = 20 }
				}
				10 = { 
					modifier = {
						factor = 0
						NOT = { has_technology = "tech_mine_dark_matter" }
					}
					add_resource = { sr_dark_matter = 20 }
				}
			}
		}
	}
}

# Virus kills coordinator
planet_event = {
	id = colonyexpanded.417
	title = colonyexpanded.417.name
	desc = colonyexpanded.417.desc
	picture = GFX_evt_glitchy_matrix
	show_sound = event_criminal_activity
	location = root

	trigger = {
		has_owner = yes
		has_modifier = drone_corruption
		any_pop = { has_job = coordinator }
	}

	is_triggered_only = yes

	immediate = {
		random_owned_pop = {
			limit = { has_job = coordinator }
			kill_pop = yes
		}
		add_modifier = { modifier = "system_virus" days = 1800 }
	}
	
	option = {
		name = crime.200.a
		custom_tooltip = colonyexpanded.417.tooltip
		tooltip = {
			add_modifier = { modifier = "system_virus" days = 1800 }
		}
	}
}

# Corrupted synapse drones
planet_event = {
	id = colonyexpanded.418
	title = colonyexpanded.418.name
	desc = colonyexpanded.418.desc
	picture = GFX_evt_hive_mind
	show_sound = event_criminal_activity
	location = root

	trigger = {
		has_owner = yes
		has_modifier = drone_corruption
		any_pop = { has_job = synapse_drone }
	}

	is_triggered_only = yes

	immediate = {
		random_owned_pop = {
			limit = { has_job = synapse_drone }
			kill_pop = yes
		}
		add_modifier = { modifier = "damaged_synapses" days = 1800 }
	}
	
	option = {
		name = crime.200.a
		custom_tooltip = colonyexpanded.418.tooltip
		tooltip = {
			add_modifier = { modifier = "damaged_synapses" days = 1800 }
		}
	}
}

# Mob Rule (from gang_wars)
planet_event = {
	id = colonyexpanded.419
	title = crime.300.name
	desc = colonyexpanded.419.desc
	picture = GFX_evt_dark_alley
	show_sound = event_criminal_activity
	location = root

	trigger = {
		has_owner = yes
		has_modifier = gang_wars
		NOT = { has_modifier = mob_rule }
	}

	is_triggered_only = yes

	immediate = {
		remove_modifier = gang_wars
		add_modifier = { modifier = "mob_rule" days = -1 }
	}
	
	option = {
		name = crime.300.a
		tooltip = {
			remove_modifier = gang_wars
			add_modifier = { modifier = "mob_rule" days = -1 }
		}
	}
}

# Criminals and Slaves
planet_event = {
	id = colonyexpanded.420
	title = colonyexpanded.420.name
	desc = {
		text = colonyexpanded.420.desc
		trigger = {
			OR = {
				has_modifier = criminal_underworld
				has_modifier = center_of_drug_trad
			}
		}
	}
	desc = {
		text = colonyexpanded.420.desc.mob
		trigger = {
			has_modifier = mob_rule
		}
	}
	desc = {
		text = colonyexpanded.420.desc.war
		trigger = {
			has_modifier = gang_wars
		}
	}
	picture = GFX_evt_dark_alley
	show_sound = event_criminal_activity
	location = root

	trigger = {
		has_owner = yes
		OR = {
			has_modifier = criminal_underworld
			has_modifier = center_of_drug_trade
			has_modifier = mob_rule
			has_modifier = gang_wars
		}
		NOR = {
			has_modifier = crime_slaves_conscripted
			has_modifier = crime_slaves_recruited
		}
		any_pop = {
			is_sapient = yes
			is_enslaved = yes
		}
	}

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { has_modifier = gang_wars }
			add_modifier = { modifier = crime_slaves_conscripted days = 7200 }
			add_planet_devastation = 15
			random_owned_pop = { kill_pop = yes }
			random_owned_pop = { kill_pop = yes }
		}
		else = { add_modifier = { modifier = crime_slaves_recruited days = 7200 } }
	}
	
	option = {
		name = crime.100.a
		trigger = {
			NOT = { has_modifier = gang_wars }
		}
		tooltip = {
			add_modifier = { modifier = crime_slaves_conscripted days = 7200 }
			add_planet_devastation = 15
			random_owned_pop = { kill_pop = yes }
			random_owned_pop = { kill_pop = yes }
		}
	}
	
	option = {
		name = crime.200.a
		trigger = {
			NOT = { has_modifier = gang_wars }
		}
		tooltip = {
			add_modifier = { modifier = crime_slaves_recruited days = 7200 }
		}
	}
}

##################################
# Portal Events
# Reserved 500 - 599
##################################

# Portal Refugees
planet_event = {
	id = colonyexpanded.500
	title = colonyexpanded.500.name
	desc = colonyexpanded.500.desc
	picture = GFX_evt_burning_settlement
	show_sound = event_air_raid_siren
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		has_modifier = dportal_trade_crisis
	}
	
	option = {
		name = OK
		create_pop = { 
			species = owner_main_species
		}
		last_created_pop = {
			hidden_effect = {
				add_modifier = { modifier = recent_refugee days = 3600 }
			}
		}
	}
}

# Warp Beast Truce
planet_event = {
	id = colonyexpanded.501
	title = "colonyexpanded.501.name"
	desc = {
		text = colonyexpanded.501.desc
		trigger = {
			owner = { is_machine_empire = no }
			NOT = { has_planet_flag = warp_breach_researched }
		}
	}
	desc = {
		text = colonyexpanded.501.desc.closed
		trigger = {
			owner = { is_machine_empire = no }
			has_planet_flag = warp_breach_researched
		}
	}
	desc = {
		text = colonyexpanded.501.desc.robot
		trigger = {
			owner = { is_machine_empire = yes }
			NOT = { has_planet_flag = warp_breach_researched }
		}
	}
	desc = {
		text = colonyexpanded.501.desc.robot.closed
		trigger = {
			owner = { is_machine_empire = yes }
			has_planet_flag = warp_breach_researched
		}
	}

	is_triggered_only = yes
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	immediate = {
		planet_event = { id = colonyexpanded.502 days = 1800 random = 1800 }
		owner = {
			set_country_flag = dportal_empire_truce_flag
			change_variable = {
				which = dportal_empire_final_victory
				value = 1
			}
		}
		if = {
			limit = { has_planet_flag = warp_breach_researched }
			owner = {
				change_variable = {
					which = dportal_warps_closed
					value = 1
				}
				if = {
					limit = {
						check_variable = { which = dportal_warps_closed value > 7 }
						check_variable = { which = dportal_empire_final_victory value > 12 }
					}
					ROOT = { set_planet_flag = the_final_warp_breach }
				}
			}
		}
	}
	
	option = {
		name = colonyexpanded.501.a
		trigger = { owner = { is_machine_empire = no } }
		if = {
			limit = { has_global_flag = expanded_pops_active }
			custom_tooltip = portal_rare_tooltip
			hidden_effect = { set_planet_flag = dportal_trade_truce }
		}
	}
	option = {
		name = colonyexpanded.501.a.robot
		trigger = { owner = { is_machine_empire = yes } }
		if = {
			limit = { has_global_flag = expanded_pops_active }
			custom_tooltip = portal_rare_tooltip
			hidden_effect = { set_planet_flag = dportal_trade_truce }
		}
	}
}

# Warp Beast Truce Ends
planet_event = {
	id = colonyexpanded.502
	title = "colonyexpanded.501.name"
	desc = {
		text = colonyexpanded.502.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colonyexpanded.502.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	option = {
		name = colonyexpanded.502.a
		trigger = { owner = { is_machine_empire = no } }
		if = {
			limit = { has_global_flag = expanded_pops_active }
			custom_tooltip = portal_no_rare_tooltip
			hidden_effect = { remove_planet_flag = dportal_trade_truce }
		}
		hidden_effect = {
			owner = {
				remove_country_flag = dportal_empire_truce_flag
				set_variable = { which = dportal_empire_victory value = 0 }
			}
		}
	}
	option = {
		name = colonyexpanded.501.a.robot
		trigger = { owner = { is_machine_empire = yes } }
		if = {
			limit = { has_global_flag = expanded_pops_active }
			custom_tooltip = portal_no_rare_tooltip
			hidden_effect = { remove_planet_flag = dportal_trade_truce }
		}
		hidden_effect = {
			owner = {
				remove_country_flag = dportal_empire_truce_flag
				set_variable = { which = dportal_empire_victory value = 0 }
			}
		}
	}
}

# unemployed volunteers
planet_event = {
	id = colonyexpanded.503
	title = "colonyexpanded.501.name"
	desc = {
		text = colonyexpanded.503.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colonyexpanded.503.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes
	
	trigger = {
		exists = owner
		owner = {
			is_at_war = no
			has_crisis = no
			any_owned_pop = { is_unemployed = yes }
		}
	}
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	option = {
		name = colonyexpanded.503.a
		trigger = { owner = { is_machine_empire = no } }
		response_text = colonyexpanded.503.a.response
		dportal_empire_victory_increase = yes
		custom_tooltip = colonyexpanded.503.a.tooltip
		hidden_effect = {
			owner = {
				while = {
					count = 5
					random_owned_pop = {
						limit = { is_unemployed = yes }
						kill_pop = yes
					}
				}
			}
		}
	}
	option = {
		name = colonyexpanded.503.b
		trigger = { owner = { is_machine_empire = no } }
		response_text = colonyexpanded.503.b.response
		hidden_effect = {
			random_list = {
				1 = { dportal_empire_crisis_increase = yes }
				3 = { }
			}
		}
	}
	option = {
		name = colonyexpanded.503.a.robot
		trigger = { owner = { is_machine_empire = yes } }
		response_text = colonyexpanded.503.a.robot.response
		dportal_empire_victory_increase = yes
		custom_tooltip = colonyexpanded.503.a.tooltip
		hidden_effect = {
			owner = {
				while = {
					count = 5
					random_owned_pop = {
						limit = { is_unemployed = yes }
						kill_pop = yes
					}
				}
			}
		}
	}
	option = {
		name = colonyexpanded.503.b.robot
		trigger = { owner = { is_machine_empire = yes } }
		response_text = colonyexpanded.503.b.robot.response
		hidden_effect = {
			random_list = {
				1 = { dportal_empire_crisis_increase = yes }
				3 = { }
			}
		}
	}
}

# Asks for alloys
planet_event = {
	id = colonyexpanded.504
	title = "colonyexpanded.501.name"
	desc = {
		text = colonyexpanded.504.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colonyexpanded.504.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes
	
	trigger = {
		exists = owner
		owner = {
			is_at_war = no
			has_crisis = no
		}
	}
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	option = {
		name = colonyexpanded.504.a
		trigger = { owner = { is_machine_empire = no } }
		allow = {
			owner = {
				resource_stockpile_compare = { resource = alloys value >= 500 }
			}
		}
		response_text = colonyexpanded.504.a.response
		dportal_empire_victory_increase = yes
		owner = {
			add_resource = {
				alloys = -500
				energy = 500
			}
		}
	}
	option = {
		name = colonyexpanded.504.b
		trigger = { owner = { is_machine_empire = no } }
		response_text = colonyexpanded.504.b.response
		hidden_effect = {
			random_list = {
				1 = { dportal_empire_crisis_increase = yes }
				2 = { }
			}
		}
	}
	option = {
		name = colonyexpanded.503.a.robot
		trigger = { owner = { is_machine_empire = yes } }
		allow = {
			owner = {
				resource_stockpile_compare = { resource = alloys value >= 500 }
			}
		}
		response_text = colonyexpanded.504.a.robot.response
		dportal_empire_victory_increase = yes
		owner = {
			add_resource = {
				alloys = -500
				energy = 500
			}
		}
	}
	option = {
		name = colonyexpanded.503.b.robot
		trigger = { owner = { is_machine_empire = yes } }
		response_text = colonyexpanded.503.b.robot.response
		hidden_effect = {
			random_list = {
				1 = { dportal_empire_crisis_increase = yes }
				2 = { }
			}
		}
	}
}

# Asks for food
planet_event = {
	id = colonyexpanded.505
	title = "colonyexpanded.501.name"
	desc = colonyexpanded.505.desc

	is_triggered_only = yes
	
	trigger = {
		exists = owner
		owner = {
			is_at_war = no
			has_crisis = no
			is_synthetic_empire = no
		}
	}
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	option = {
		name = colonyexpanded.504.a
		allow = {
			owner = {
				resource_stockpile_compare = { resource = food value >= 1000 }
			}
		}
		response_text = colonyexpanded.505.a.response
		owner = {
			add_resource = {
				food = -1000
				energy = 500
			}
		}
		hidden_effect = {
			random_list = {
				1 = { dportal_empire_victory_increase = yes }
				3 = { }
			}
		}
		
	}
	option = {
		name = colonyexpanded.504.b
		response_text = colonyexpanded.505.b.response
		dportal_empire_crisis_increase = yes
	}
}

# Live Warp Beast
planet_event = {
	id = colonyexpanded.506
	title = "colonyexpanded.501.name"
	desc = {
		text = colonyexpanded.506.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colonyexpanded.506.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes
	
	trigger = {
		exists = owner
		owner = {
			NOT = { has_country_flag = captured_warp_beasts }
		}
	}
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	option = {
		name = colonyexpanded.506.a
		owner = { set_country_flag = captured_warp_beasts }
		enable_special_project = {
			name = "WARP_BEAST_RESEARCH_PROJECT"
			location = this
			owner = root.owner
		}
	}
}

# Live Warp Beast - Research Complete
planet_event = {
	id = colonyexpanded.507
	title = "colonyexpanded.507.name"
	desc = "colonyexpanded.507.desc"
	picture = GFX_evt_unspeakable_horror
	is_triggered_only = yes
	
	option = {
		name = "EXCELLENT"
		dportal_empire_victory_increase = yes 
		custom_tooltip = colonyexpanded.507.a.tooltip
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = 50
				min = @tier5researchmin
			}
			hidden_effect = {
				set_country_flag = dportal_empire_weapon_1
				change_variable = {
					which = dportal_empire_final_victory
					value = 1
				}
			}
		}
	}
}

# Gas for Plasma
planet_event = {
	id = colonyexpanded.508
	title = "colonyexpanded.501.name"
	desc = {
		text = colonyexpanded.508.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colonyexpanded.508.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes
	
	trigger = {
		exists = owner
		owner = {
			NOT = { has_country_flag = dportal_empire_plasma_gases }
			NOT = { has_technology = tech_plasma_3 }
			is_at_war = no
			has_crisis = no
		}
	}
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	option = {
		name = colonyexpanded.504.a
		trigger = { owner = { is_machine_empire = no } }
		allow = {
			owner = {
				resource_stockpile_compare = { resource = exotic_gases value >= 1000 }
			}
		}
		response_text = colonyexpanded.504.a.response
		dportal_empire_victory_increase = yes
		owner = {
			add_resource = { exotic_gases = -1000 }
			set_country_flag = dportal_empire_plasma_gases
			if = {
				limit = {
					NOT = { has_technology = tech_plasma_1 }
				}
				give_technology = { tech = tech_plasma_1 }
				add_research_option = tech_plasma_2
			}
			else_if = {
				limit = {
					has_technology = tech_plasma_1
					NOT = { has_technology = tech_plasma_2 }
				}
				give_technology = { tech = tech_plasma_2 }
			}
			else_if = {
				limit = {
					has_technology = tech_plasma_2
					NOT = { has_technology = tech_plasma_3 }
				}
				give_technology = { tech = tech_plasma_3 }
			}
		}
	}
	option = {
		name = colonyexpanded.504.b
		trigger = { owner = { is_machine_empire = no } }
		response_text = colonyexpanded.508.b.response
		hidden_effect = {
			random_list = {
				1 = { dportal_empire_crisis_increase = yes }
				3 = { }
			}
		}
	}
	option = {
		name = colonyexpanded.503.a.robot
		trigger = { owner = { is_machine_empire = yes } }
		allow = {
			owner = {
				resource_stockpile_compare = { resource = exotic_gases value >= 1000 }
			}
		}
		response_text = colonyexpanded.504.a.robot.response
		dportal_empire_victory_increase = yes
		owner = {
			add_resource = { exotic_gases = -1000 }
			set_country_flag = dportal_empire_plasma_gases
			if = {
				limit = {
					NOT = { has_technology = tech_plasma_1 }
				}
				give_technology = { tech = tech_plasma_1 }
				add_research_option = tech_plasma_2
			}
			else_if = {
				limit = {
					has_technology = tech_plasma_1
					NOT = { has_technology = tech_plasma_2 }
				}
				give_technology = { tech = tech_plasma_2 }
			}
			else_if = {
				limit = {
					has_technology = tech_plasma_2
					NOT = { has_technology = tech_plasma_3 }
				}
				give_technology = { tech = tech_plasma_3 }
			}
		}
	}
	option = {
		name = colonyexpanded.503.b.robot
		trigger = { owner = { is_machine_empire = yes } }
		response_text = colonyexpanded.503.b.robot.response
		hidden_effect = {
			random_list = {
				1 = { dportal_empire_crisis_increase = yes }
				3 = { }
			}
		}
	}
}

# Asks for consumer goods / minerals
planet_event = {
	id = colonyexpanded.509
	title = "colonyexpanded.501.name"
	desc = {
		text = colonyexpanded.509.desc
		trigger = {
			 owner = { is_gestalt = no }
		}
	}
	desc = {
		text = colonyexpanded.509.desc.hive
		trigger = {
			 owner = { is_hive_empire = yes }
		}
	}
	desc = {
		text = colonyexpanded.509.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes
	
	trigger = {
		exists = owner
		owner = {
			is_at_war = no
			has_crisis = no
		}
	}
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	option = {
		name = colonyexpanded.504.a
		trigger = { owner = { is_gestalt = no } }
		allow = {
			owner = {
				resource_stockpile_compare = { resource = consumer_goods value >= 500 }
			}
		}
		response_text = colonyexpanded.504.a.response
		dportal_empire_victory_increase = yes
		owner = {
			add_resource = {
				consumer_goods = -500
				energy = 500
			}
		}
	}
	option = {
		name = colonyexpanded.504.b
		trigger = { owner = { is_machine_empire = no } }
		response_text = colonyexpanded.508.b.response
		hidden_effect = {
			random_list = {
				1 = { dportal_empire_crisis_increase = yes }
				4 = { }
			}
		}
	}
	option = {
		name = colonyexpanded.504.a
		trigger = { owner = { is_hive_empire = yes } }
		allow = {
			owner = {
				resource_stockpile_compare = { resource = minerals value >= 1000 }
			}
		}
		response_text = colonyexpanded.504.a.response
		dportal_empire_victory_increase = yes
		owner = {
			add_resource = {
				minerals = -1000
				energy = 500
			}
		}
	}
	option = {
		name = colonyexpanded.503.a.robot
		trigger = { owner = { is_machine_empire = yes } }
		allow = {
			owner = {
				resource_stockpile_compare = { resource = minerals value >= 1000 }
			}
		}
		response_text = colonyexpanded.504.a.robot.response
		dportal_empire_victory_increase = yes
		owner = {
			add_resource = {
				minerals = -1000
				energy = 500
			}
		}
	}
	option = {
		name = colonyexpanded.503.b.robot
		trigger = { owner = { is_machine_empire = yes } }
		response_text = colonyexpanded.503.b.robot.response
		hidden_effect = {
			random_list = {
				1 = { dportal_empire_crisis_increase = yes }
				4 = { }
			}
		}
	}
}

# Weapons Research
planet_event = {
	id = colonyexpanded.510
	title = "colonyexpanded.501.name"
	desc = {
		text = colonyexpanded.510.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colonyexpanded.510.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes
	
	trigger = {
		exists = owner
		owner = {
			NOT = { has_country_flag = dportal_lasers_research }
			any_owned_leader = {
				leader_class = scientist
				is_researching_area = physics
			}
			OR = {
				has_technology = tech_plasma_2
				has_technology = tech_lasers_4
				research_leader = {
					area = physics
					has_trait = "leader_trait_maniacal"
				}
				research_leader = {
					area = physics
					has_trait = "leader_trait_curator"
				}
			}
		}
	}
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	immediate = {
		owner = {
			random_owned_leader = {
				limit = {
					leader_class = scientist
					is_researching_area = physics
				}
				save_event_target_as = dead_portal_leader
			}
		}
	}
	
	option = {
		name = colonyexpanded.506.a
		owner = { set_country_flag = dportal_lasers_research }
		enable_special_project = {
			name = "WARP_BEAST_LASER_PROJECT"
			location = this
			owner = root.owner
		}
	}
}

# Weapons Research - Research Complete
planet_event = {
	id = colonyexpanded.511
	title = "colonyexpanded.511.name"
	desc = "colonyexpanded.511.desc"
	picture = GFX_evt_physics_research

	is_triggered_only = yes
	
	option = {
		name = "EXCELLENT"
		dportal_empire_victory_increase = yes 
		custom_tooltip = colonyexpanded.507.a.tooltip
		owner = {
			if = {
				limit = { has_tech_option = tech_lasers_5 }
				add_research_option = tech_lasers_5
				add_tech_progress = {
					tech = tech_lasers_5
					progress = 0.25
				}
			}
			else_if = {
				limit = {
					has_technology = tech_lasers_4
					NOT = { has_technology = tech_lasers_5 }
				}
				add_research_option = tech_lasers_5
				add_tech_progress = {
					tech = tech_lasers_5
					progress = 0.10
				}
			}
			else_if = {
				limit = {
					has_technology = tech_lasers_3
					NOT = { has_technology = tech_lasers_4 }
				}
				add_research_option = tech_lasers_4
				add_tech_progress = {
					tech = tech_lasers_4
					progress = 0.25
				}
			}
			else_if = {
				limit = {
					has_technology = tech_lasers_2
					NOT = { has_technology = tech_lasers_3 }
				}
				add_research_option = tech_lasers_3
				add_tech_progress = {
					tech = tech_lasers_3
					progress = 0.25
				}
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_lasers_2 }
				}
				add_research_option = tech_lasers_2
				add_tech_progress = {
					tech = tech_lasers_2
					progress = 0.25
				}
			}
			add_modifier = { modifier = dportal_lasers days = -1 }
			set_country_flag = dportal_empire_weapon_2
			hidden_effect = {
				change_variable = {
					which = dportal_empire_final_victory
					value = 1
				}
			}
		}
	}
}

# Crystals for Lasers
planet_event = {
	id = colonyexpanded.512
	title = "colonyexpanded.501.name"
	desc = {
		text = colonyexpanded.512.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colonyexpanded.512.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes
	
	trigger = {
		exists = owner
		owner = {
			NOT = { has_country_flag = dportal_empire_laser_crystal }
			OR = {
				has_technology = tech_lasers_2
				has_technology = tech_lasers_3
				has_technology = tech_lasers_4
			}
			NOT = { has_technology = tech_lasers_5 }
			is_at_war = no
			has_crisis = no
		}
	}
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	option = {
		name = colonyexpanded.504.a
		trigger = { owner = { is_machine_empire = no } }
		allow = {
			owner = {
				resource_stockpile_compare = { resource = rare_crystals value >= 1000 }
			}
		}
		response_text = colonyexpanded.504.a.response
		dportal_empire_victory_increase = yes
		owner = {
			add_resource = { rare_crystals = -1000 }
			set_country_flag = dportal_empire_laser_crystal
			if = {
				limit = {
					NOT = { has_technology = tech_lasers_2 }
				}
				give_technology = { tech = tech_lasers_2 }
				add_research_option = tech_lasers_3
			}
			else_if = {
				limit = {
					has_technology = tech_lasers_2
					NOT = { has_technology = tech_lasers_3 }
				}
				give_technology = { tech = tech_lasers_3 }
			}
			else_if = {
				limit = {
					has_technology = tech_lasers_3
					NOT = { has_technology = tech_lasers_4 }
				}
				give_technology = { tech = tech_lasers_4 }
			}
			else_if = {
				limit = {
					has_technology = tech_lasers_4
					NOT = { has_technology = tech_lasers_5 }
				}
				give_technology = { tech = tech_lasers_5 }
			}
		}
	}
	option = {
		name = colonyexpanded.504.b
		trigger = { owner = { is_machine_empire = no } }
		response_text = colonyexpanded.512.b.response
		hidden_effect = {
			random_list = {
				1 = { dportal_empire_crisis_increase = yes }
				3 = { }
			}
		}
	}
	option = {
		name = colonyexpanded.503.a.robot
		trigger = { owner = { is_machine_empire = yes } }
		allow = {
			owner = {
				resource_stockpile_compare = { resource = rare_crystals value >= 1000 }
			}
		}
		response_text = colonyexpanded.504.a.robot.response
		dportal_empire_victory_increase = yes
		owner = {
			add_resource = { rare_crystals = -1000 }
			set_country_flag = dportal_empire_laser_crystal
			if = {
				limit = {
					NOT = { has_technology = tech_lasers_2 }
				}
				give_technology = { tech = tech_lasers_2 }
				add_research_option = tech_lasers_3
			}
			else_if = {
				limit = {
					has_technology = tech_lasers_2
					NOT = { has_technology = tech_lasers_3 }
				}
				give_technology = { tech = tech_lasers_3 }
			}
			else_if = {
				limit = {
					has_technology = tech_lasers_3
					NOT = { has_technology = tech_lasers_4 }
				}
				give_technology = { tech = tech_lasers_4 }
			}
			else_if = {
				limit = {
					has_technology = tech_lasers_4
					NOT = { has_technology = tech_lasers_5 }
				}
				give_technology = { tech = tech_lasers_5 }
			}
		}
	}
	option = {
		name = colonyexpanded.503.b.robot
		trigger = { owner = { is_machine_empire = yes } }
		response_text = colonyexpanded.503.b.robot.response
		hidden_effect = {
			random_list = {
				1 = { dportal_empire_crisis_increase = yes }
				3 = { }
			}
		}
	}
}

# Precursor Foundry
planet_event = {
	id = colonyexpanded.513
	title = "colonyexpanded.513.name"
	desc = "colonyexpanded.513.desc"
	picture = GFX_evt_alien_city
	show_sound = event_activating_unknown_technology
	location = ROOT

	is_triggered_only = yes
	
	trigger = {
		exists = owner
		NOT = {
			owner = { has_country_flag = dportal_empire_precursor_alloys }
		}
	}
	
	option = {
		name = "FASCINATING"
		dportal_empire_victory_increase = yes 
		custom_tooltip = colonyexpanded.507.a.tooltip
		hidden_effect = {
			owner = { set_country_flag = dportal_empire_precursor_alloys }
		}
	}
}

# Mirror Criminals
planet_event = {
	id = colonyexpanded.514
	title = "colonyexpanded.514.name"
	desc = "colonyexpanded.514.desc"
	picture = GFX_evt_dark_alley
	show_sound = event_criminal_activity
	location = ROOT

	is_triggered_only = yes
	
	trigger = {
		NOR = {
			has_modifier = mirror_criminals
			has_planet_flag = planet_crime_flag
			has_planet_flag = minor_crime_disappeared
		}
	}
	
	option = {
		name = "UNFORTUNATE"
		create_pop = {
			species = owner_main_species
		}
		add_modifier = { modifier = mirror_criminals days = -1 }
	}
}

# Warp Beast Counterattack
planet_event = {
	id = colonyexpanded.515
	title = "colonyexpanded.515.name"
	desc = "colonyexpanded.515.desc"
	picture = GFX_evt_wormhole
	location = ROOT

	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_modifier = dportal_trade_high
			has_modifier = dportal_trade_normal
		}
		NOT = { has_planet_flag = dportal_beast_counterattack }
		exists = owner
		owner = {
			check_variable = {
				which = dportal_empire_victory
				value > 2
			}
		}
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = dportal_beast_counterattack
			days = 10800
		}
		remove_modifier = dportal_trade_high
		remove_modifier = dportal_trade_normal
		add_modifier = {
			modifier = "dportal_trade_low"
			days = -1
		}
		owner = { 
			change_variable = {
				which = dportal_empire_victory
				value = -3
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = dportal_empire_victory
							value > 0
						}
					}
				}
				change_variable = {
					which = dportal_empire_crisis
					value = 1
				}
			}
		}
	}
	
	option = {
		name = "TERRIBLE"
		tooltip = {
			add_modifier = {
				modifier = "dportal_trade_low"
				days = -1
			}
		}
	}
}

# Mirror Universe Counterattack
planet_event = {
	id = colonyexpanded.516
	title = "colonyexpanded.516.name"
	desc = "colonyexpanded.516.desc"
	picture = GFX_evt_wormhole
	location = ROOT

	is_triggered_only = yes
	
	trigger = {
		has_modifier = dportal_trade_low
		NOT = { has_planet_flag = dportal_mirror_counterattack }
		exists = owner
		owner = {
			check_variable = {
				which = dportal_empire_crisis
				value > 0
			}
		}
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = dportal_mirror_counterattack
			days = 10800
		}
		remove_modifier = dportal_trade_low
		add_modifier = {
			modifier = "dportal_trade_normal"
			days = -1
		}
		owner = {
			change_variable = {
				which = dportal_empire_crisis
				value = -1
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = dportal_empire_crisis
							value > 0
						}
					}
				}
				change_variable = {
					which = dportal_empire_victory
					value = 1
				}
			}
		}
	}
	
	option = {
		name = "TERRIBLE"
		tooltip = {
			add_modifier = {
				modifier = "dportal_trade_normal"
				days = -1
			}
		}
	}
}

############################
###     Final Victory	 ###
###  Reserved 550 - 569  ###
############################

# How to close a warp breach
planet_event = {
	id = colonyexpanded.550
	title = "colonyexpanded.501.name"
	desc = {
		text = colonyexpanded.550.a.desc
		trigger = {
			 owner = {
				is_machine_empire = no
				NOT = { has_technology = tech_psi_jump_drive_1 }
			}
		}
	}
	desc = {
		text = colonyexpanded.550.b.desc
		trigger = {
			 owner = {
				is_machine_empire = no
				has_technology = tech_psi_jump_drive_1
			}
		}
	}
	desc = {
		text = colonyexpanded.550.c.desc
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes
	
	trigger = {
		NOT = { has_planet_flag = warp_breach_research_start }
		exists = owner
		owner = {
			check_variable = {
				which = dportal_empire_final_victory
				value > 4
			}
			is_at_war = no
			has_crisis = no
			OR = {
				has_technology = tech_jump_drive_1
				has_technology = tech_psi_jump_drive_1
			}
		}
	}
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	immediate = {
		set_planet_flag = warp_breach_research_start
	}
	
	option = {
		name = colonyexpanded.550.a
		trigger = { owner = { is_machine_empire = no } }
		response_text = colonyexpanded.550.a.response
		add_modifier = {
			modifier = "dportal_jump_drive_researchers"
			days = -1
		}
		hidden_effect = {
			planet_event = { id = colonyexpanded.551 days = 1080 random = 360 }
		}
	}
	option = {
		name = colonyexpanded.550.b
		trigger = { owner = { is_machine_empire = no } }
		response_text = colonyexpanded.550.b.response
		hidden_effect = {
			planet_event = { id = colonyexpanded.551 days = 10800 random = 3600 }
		}
	}
	option = {
		name = colonyexpanded.550.a.robot
		trigger = { owner = { is_machine_empire = yes } }
		response_text = colonyexpanded.550.a.robot.response
		add_modifier = {
			modifier = "dportal_jump_drive_researchers"
			days = -1
		}
		hidden_effect = {
			planet_event = { id = colonyexpanded.551 days = 1080 random = 360 }
		}
	}
	option = {
		name = colonyexpanded.550.b.robot
		trigger = { owner = { is_machine_empire = yes } }
		response_text = colonyexpanded.550.b.robot.response
		hidden_effect = {
			planet_event = { id = colonyexpanded.551 days = 10800 random = 3600 }
		}
	}
}

# How to close a warp breach: answered
planet_event = {
	id = colonyexpanded.551
	title = "colonyexpanded.551.name"
	desc = {
		text = colonyexpanded.551.desc
		trigger = {
			NOT = { has_global_flag = extradimensional_invasion_happened }
		}
	}
	desc = {
		text = colonyexpanded.551.extra.desc
		trigger = {
			has_global_flag = extradimensional_invasion_happened
		}
	}
	picture = GFX_evt_wormhole
	location = ROOT

	is_triggered_only = yes
	
	immediate = {
		set_planet_flag = warp_breach_researched
		owner = {
			set_variable = {
				which = dportal_warps_closed
				value = 0
			}
		}
	}
	
	option = {
		name = "colonyexpanded.551.a"
		custom_tooltip = colonyexpanded.551.tooltip
	}
}

# The final battle
planet_event = {
	id = colonyexpanded.552
	title = "colonyexpanded.501.name"
	desc = {
		text = colonyexpanded.552.a.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colonyexpanded.552.b.desc
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	immediate = {
		owner = {
			set_country_flag = dportal_empire_truce_flag
		}
		random_list = {
			10 = {
				planet_event = { id = colonyexpanded.553 days = 360 random = 180 }
				modifier = {
					factor = 1.1
					owner = {
						check_variable = { which = dportal_empire_victory value > 13 }
					}
				}
				modifier = {
					factor = 1.1
					owner = {
						check_variable = { which = dportal_empire_victory value > 14 }
					}
				}
				modifier = {
					factor = 1.15
					owner = {
						check_variable = { which = dportal_empire_victory value > 15 }
					}
				}
				modifier = {
					factor = 1.2
					owner = {
						check_variable = { which = dportal_empire_victory value > 16 }
					}
				}
				modifier = {
					factor = 1.25
					owner = {
						check_variable = { which = dportal_empire_victory value > 17 }
					}
				}
				modifier = {
					factor = 1.3
					owner = {
						check_variable = { which = dportal_empire_victory value > 18 }
					}
				}
				modifier = {
					factor = 1.4
					owner = {
						check_variable = { which = dportal_empire_victory value > 19 }
					}
				}
				modifier = {
					factor = 1.5
					owner = {
						check_variable = { which = dportal_empire_victory value > 20 }
					}
				}
			}
			1 = {
				planet_event = { id = colonyexpanded.554 days = 360 random = 180 }
			}
		}
	}
	
	option = {
		name = colonyexpanded.501.a
		trigger = { owner = { is_machine_empire = no } }
	}
	option = {
		name = colonyexpanded.501.a.robot
		trigger = { owner = { is_machine_empire = yes } }
	}
}

# The final battle: victory!
planet_event = {
	id = colonyexpanded.553
	title = "colonyexpanded.553.name"
	desc = colonyexpanded.553.desc
	picture = GFX_evt_victorious_army
	location = ROOT

	is_triggered_only = yes
	
	immediate = {
		owner = {
			set_country_flag = dportal_empire_victory_flag
		}
		remove_modifier = dportal_trade_low
		remove_modifier = dportal_trade_normal
		remove_modifier = dportal_trade_high
		add_modifier = {
			modifier = "dportal_trade_high"
			days = -1
		}
	}
	
	option = {
		name = "EXCELLENT"
		tooltip = {
			add_modifier = {
				modifier = "dportal_trade_high"
				days = -1
			}
		}
		if = {
			limit = { has_global_flag = expanded_pops_active }
			custom_tooltip = portal_rare_tooltip
			hidden_effect = { set_planet_flag = dportal_trade_truce }
		}
	}
}

# The final battle: defeat!
planet_event = {
	id = colonyexpanded.554
	title = "colonyexpanded.554.name"
	desc = colonyexpanded.554.desc
	picture = GFX_evt_debris
	location = ROOT

	is_triggered_only = yes
	
	immediate = {
		remove_modifier = dportal_trade_high
		remove_modifier = dportal_trade_normal
		remove_modifier = dportal_trade_low
		remove_modifier = dportal_trade_crisis
		add_modifier = {
			modifier = "dportal_trade_crisis"
			days = -1
		}
		owner = { set_country_flag = dportal_empire_crisis_flag }
		if = {
			limit = {
				owner = {
					has_country_flag = worm_events_available
				}
			}
			planet_event = { id = countryexpanded.210 days = 60 random = 360 }
			planet_event = { id = colonyexpanded.500 days = 180 random = 180 }
		}
		else = {
			planet_event = { id = colony.3033 days = 1825 random = 1825 }
			planet_event = { id = colonyexpanded.500 days = 360 random = 360 }
			planet_event = { id = colonyexpanded.500 days = 720 random = 720 }
			planet_event = { id = colonyexpanded.500 days = 1080 random = 720 }
			planet_event = { id = colonyexpanded.500 days = 1440 random = 720 }
			planet_event = { id = colonyexpanded.500 days = 1800 random = 720 }
			planet_event = { id = colonyexpanded.500 days = 2160 random = 720 }
			planet_event = { id = colonyexpanded.500 days = 2520 random = 720 }
		}
		owner = { set_country_flag = dportal_empire_crisis_flag }
	}
	
	option = {
		name = "TERRIBLE"
		tooltip = {
			add_modifier = {
				modifier = "dportal_trade_crisis"
				days = -1
			}
		}
	}
}

############################
###      Hell Portal	 ###
###  Reserved 570 - 599  ###
############################

# Hell Tabola
event = {
	id = colonyexpanded.570
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = {
				any_owned_planet = {
					has_planet_flag = dportal_hell
					NOT = { has_planet_flag = dportal_closed }
				}
			}
			random_owned_planet = {
				limit = {
					has_planet_flag = dportal_hell
					NOT = { has_planet_flag = dportal_closed }
				}
				random_list = {
					# Hell Suicides
					1 = {
						planet_event = { id = colonyexpanded.571 days = 180 random = 2000 }
					}
					# Detect devils
					1 = {
						planet_event = { id = colonyexpanded.572 days = 180 random = 2000 }
					}
					# Portal getting bigger
					1 = {
						planet_event = { id = colonyexpanded.573 days = 180 random = 2000 }
					}
					# Portal corrupts researchers
					# Portal cult (portal cultist job)
					# Devil tries to escape
					97 = { }
				}
			}
		}
	}
}

# Hell Suicides
planet_event = {
	id = colonyexpanded.571
	title = "colony.3006.name"
	desc = {
		text = colonyexpanded.571.desc.a
		trigger = {
			owner = {
				is_gestalt = no
			}
		}
	}
	desc = {
		text = colonyexpanded.571.desc.b
		trigger = {
			owner = {
				is_hive_empire = yes
			}
		}
	}
	desc = {
		text = colonyexpanded.571.desc.c
		trigger = {
			owner = {
				is_machine_empire = yes
			}
		}
	}
	picture = GFX_evt_space_funeral
	location = ROOT

	is_triggered_only = yes
	
	trigger = {
		NOT = { has_planet_flag = dportal_hell_suicide }
	}
	
	immediate = {
		set_planet_flag = dportal_hell_suicide
	}
	
	option = {
		name = colonyexpanded.571.a
		if = {
			limit = { owner = { is_hive_empire = no } }
			add_modifier = { modifier = dportal_more_researchers days = -1 }
		}
		else = {
			add_modifier = { modifier = dportal_more_researchers_hive days = -1 }
		}
	}
	option = {
		name = colonyexpanded.571.b
		if = {
			limit = { owner = { is_gestalt = no } }
			if = {
				limit = { has_global_flag = expanded_pops_active }
				custom_tooltip = portal_researcher_unhappiness
				hidden_effect = { set_planet_flag = dportal_hell_suicide_unhappiness }
			}
			else = {
				every_pop = {
					limit = { has_job = dimensional_portal_researcher }
					add_modifier = { modifier = dportal_unhappy_researchers days = -1 }
				}
			}
		}
		else_if = {
			limit = { owner = { is_machine_empire = yes } }
			add_modifier = { modifier = dportal_unhappy_researchers_hive days = -1 }
		}
		else = {
			add_modifier = { modifier = dportal_unhappy_researchers_machine days = -1 }
		}
	}
}

# Detects Devils
planet_event = {
	id = colonyexpanded.572
	title = colonyexpanded.572.name
	desc = colonyexpanded.572.desc
	picture = GFX_evt_glitchy_matrix
	location = ROOT

	is_triggered_only = yes
	
	trigger = {
		NOT = { has_planet_flag = dportal_hell_devils_detected }
	}
	
	immediate = {
		set_planet_flag = dportal_hell_devils_detected
	}
	
	option = {
		name = DISCONCERTING
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
	}
}

# Gateway gets bigger
planet_event = {
	id = colonyexpanded.573
	title = colonyexpanded.573.name
	desc = colonyexpanded.573.desc
	picture = GFX_evt_wormhole
	location = ROOT

	is_triggered_only = yes
	
	trigger = {
		NOT = { has_planet_flag = dportal_hell_growing_gateway }
	}
	
	immediate = {
		set_planet_flag = dportal_hell_growing_gateway
	}
	
	option = {
		trigger = {
		owner = {
				is_spiritualist = no
			}
		}
		name = colony.3006.science 
		enable_special_project = {
			name = "DPORTAL_PROJECT_SCIENCE"
			location = this
			owner = root
		}
	}
	
	option = {
		name = colony.3006.psi.prayer
		trigger = {
			owner = {
				is_spiritualist = yes
				has_technology = tech_psionic_theory
			}
		}
		enable_special_project = {
			name = "DPORTAL_PROJECT_PSI_PRAYER"
			location = this
			owner = root
		}
	}
	option = {
		name = colony.3006.prayer
		trigger = {
			owner = {
				is_spiritualist = yes
				NOT = {	has_technology = tech_psionic_theory }
			}
		}
		enable_special_project = {
			name = "DPORTAL_PROJECT_PRAYER"
			location = this
			owner = root
		}
	}
	
	option = {
		name = colony.3006.rocks
		trigger = {
			owner = {
				is_spiritualist = no
				has_civic = civic_feudal_realm
			}
		}
		enable_special_project = {
			name = "DPORTAL_PROJECT_ROCKS"
			location = this
			owner = root
		}
	}
	
	option = {
		name = colonyexpanded.573.a
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

##################################
# Unrest Colony Events
# Reserved 600 - 699
##################################

# Food Riots Gateway
event = {
	id = colonyexpanded.600
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				any_country = {
					OR = { is_country_type = default is_country_type = ascended_empire is_country_type = lost_empire }
					NOT = { has_ethic = ethic_gestalt_consciousness }
					OR = {
						NOT = { resource_stockpile_compare = { resource = food value > 1 } }
						has_policy_flag = food_policy_rationing
					}
					any_owned_planet = {
						exists = controller
						controller = { is_same_value = root.owner }
						has_orbital_bombardment = no
						NOT = { has_planet_flag = recent_unrest_event }
						NOT = { has_modifier = food_riot }
						any_pop = {
							is_pop_category = worker
							is_robot_pop = no
							is_sapient = yes
						}
						planet_stability < 65
					}
				}
			}
			random_country = {
				limit = {
					OR = { is_country_type = default is_country_type = ascended_empire is_country_type = lost_empire }
					NOT = { has_ethic = ethic_gestalt_consciousness }
					OR = {
						NOT = { resource_stockpile_compare = { resource = food value > 1 } }
						has_policy_flag = food_policy_rationing
					}
					any_owned_planet = {
						exists = controller
						controller = { is_same_value = root.owner }
						has_orbital_bombardment = no
						NOT = { has_planet_flag = recent_unrest_event }
						NOT = { has_modifier = food_riot }
						any_pop = {
							is_pop_category = worker
							is_robot_pop = no
							is_sapient = yes
						}
						planet_stability < 65
					}
				}
				save_event_target_as = food_riot_country
			}
		}
		if = {
			limit = {
				any_country = {
					OR = { is_country_type = default is_country_type = ascended_empire is_country_type = lost_empire }
					NOT = { is_same_value = event_target:food_riot_country }
					any_owned_planet = {
						num_districts = { type = district_farming value >= 4 }
						exists = controller
						controller = { is_same_value = root.owner }
						has_orbital_bombardment = no
						NOT = { has_planet_flag = recent_unrest_event }
						NOT = { has_modifier = bad_harvest }
					}
				}
			}
			random_country = {
				limit = {
					OR = { is_country_type = default is_country_type = ascended_empire is_country_type = lost_empire }
					NOT = { is_same_value = event_target:food_riot_country }
					any_owned_planet = {
						num_districts = { type = district_farming value >= 4 }
						exists = controller
						controller = { is_same_value = root.owner }
						has_orbital_bombardment = no
						NOT = { has_planet_flag = recent_unrest_event }
						NOT = { has_modifier = bad_harvest }
					}
				}
				save_event_target_as = bad_harvest_country
			}
		}
		if = {
			limit = { exists = event_target:food_riot_country }
			event_target:food_riot_country = {
				random_list = {
					1 = {
						random_owned_planet = {
							limit = {
								exists = controller
								controller = { is_same_value = root.owner }
								has_orbital_bombardment = no
								NOT = { has_planet_flag = recent_unrest_event }
								NOT = { has_modifier = food_riot }
								any_pop = {
									is_pop_category = worker
									is_robot_pop = no
									is_sapient = yes
								}
								planet_stability < 70
							}
							planet_event = { id = colonyexpanded.601 days = 50 random = 400 }
						}
					}
					2 = {
						modifier = {
							factor = 7
							resource_stockpile_compare = { resource = food value > 50 }
						}
					}
				}
			}
		}
		if = {
			limit = { exists = event_target:bad_harvest_country }
			event_target:bad_harvest_country = {
				random_list = {
					1 = {
						random_owned_planet = {
							limit = {
								num_districts = { type = district_farming value >= 4 }
								exists = controller
								controller = { is_same_value = root.owner }
								has_orbital_bombardment = no
								NOT = { has_planet_flag = recent_unrest_event }
								NOT = { has_modifier = bad_harvest }
							}
							planet_event = { id = colonyexpanded.602 days = 50 random = 400 }
						}
					}
					14 = {
						modifier = {
							factor = 1.2
							has_technology = tech_eco_simulation
						}
						modifier = {
							factor = 1.2
							has_technology = tech_gene_crops
						}
						modifier = {
							factor = 1.2
							has_technology = tech_nano_vitality_crops
						}
						modifier = {
							factor = 1.2
							has_technology = tech_nutrient_replication
						}
						modifier = {
							factor = 1.2
							has_technology = tech_hydroponics
						}
						modifier = {
							factor = 1.2
							has_technology = tech_food_processing_1
						}
						modifier = {
							factor = 1.2
							has_technology = tech_food_processing_2
						}
					}
				}
			}
		}
	}
}

# Food Riots
planet_event = {
	id = colonyexpanded.601
	title = colonyexpanded.601.name
	desc = {
		text = colonyexpanded.601.desc.shortfall
		trigger = {
			owner = { NOT = { resource_stockpile_compare = { resource = food value > 1 } } }
		}
	}
	desc = {
		text = colonyexpanded.601.desc.rationing
		trigger = {
			owner = { has_policy_flag = food_policy_rationing }
		}
	}
	picture = GFX_evt_burning_settlement
	show_sound = event_air_raid_siren
	location = root
	
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}
	trigger = {
		exists = owner
		owner = {
			OR = { is_country_type = default is_country_type = ascended_empire is_country_type = lost_empire }
			NOT = { has_ethic = ethic_gestalt_consciousness }
			OR = {
				NOT = { resource_stockpile_compare = { resource = food value > 1 } }
				has_policy_flag = food_policy_rationing
				# other reasons from other events:
			}
		}
		exists = controller
		controller = { is_same_value = root.owner }
		has_orbital_bombardment = no
		NOT = { has_planet_flag = recent_unrest_event }
		NOT = { has_modifier = food_riot }
		any_pop = {
			is_pop_category = worker
			is_robot_pop = no
			is_sapient = yes
		}
		planet_stability < 70
	}

	immediate = {
		add_planet_devastation = 10
		add_modifier = {
			modifier = food_riot
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = UNFORTUNATE
		tooltip = {
			add_planet_devastation = 10
			add_modifier = {
				modifier = food_riot
				days = 7200 # 20 years
			}
		}
	}
}

# Bad Harvests
planet_event = {
	id = colonyexpanded.602
	title = colonyexpanded.602.name
	desc = colonyexpanded.602.desc
	picture = GFX_evt_arid
	show_sound = event_structural_collapse
	location = root
	
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}
	trigger = {
		exists = owner
		owner = {
			OR = { is_country_type = default is_country_type = ascended_empire is_country_type = lost_empire }
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		num_districts = { type = district_farming value >= 4 }
		exists = controller
		controller = { is_same_value = root.owner }
		has_orbital_bombardment = no
		NOT = { has_planet_flag = recent_unrest_event }
		NOT = { has_modifier = bad_harvest }
	}

	immediate = {
		add_modifier = {
			modifier = bad_harvest
			days = 3600 # 10 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = UNFORTUNATE
		tooltip = {
			add_modifier = {
				modifier = bad_harvest
				days = 3600 # 10 years
			}
		}
	}
}

# Slaves outnumber free
event = {
	id = colonyexpanded.603
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			limit = {
				OR = {
					any_owned_pop = { is_enslaved = yes }
					any_owned_planet = { has_modifier = slaves_outnumber_free }
				}
			}
			country_event = { id = colonyexpanded.604 days = 1 random = 6 }
		}
	}
}

country_event = {
	id = colonyexpanded.604
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_owned_planet = {
			if = {
				limit = {
					ROOT = {
						NOR = {
							has_valid_civic = civic_slaver_guilds
							has_valid_civic = civic_indentured_assets
						}
					}
					NOT = { has_modifier = slaves_outnumber_free }
					NOT = { has_modifier = slave_colony }
					pop_percentage = {
						percentage > 0.50
						limit = {
							is_enslaved = yes
							is_robot_pop = no
							is_sapient = yes
						}
					}
				}
				add_modifier = { modifier = slaves_outnumber_free days = -1 }
			}
			else_if = {
				limit = {
					ROOT = {
						OR = {
							has_valid_civic = civic_slaver_guilds
							has_valid_civic = civic_indentured_assets
						}
					}
					NOT = { has_modifier = slaves_outnumber_free }
					NOT = { has_modifier = slave_colony }
					pop_percentage = {
						percentage > 0.60
						limit = {
							is_enslaved = yes
							is_robot_pop = no
							is_sapient = yes
						}
					}
				}
				add_modifier = { modifier = slaves_outnumber_free days = -1 }
			}
			else_if = {
				limit = {
					OR = {
						NOT = {
							pop_percentage = {
								percentage > 0.50
								limit = {
									is_enslaved = yes
									is_robot_pop = no
									is_sapient = yes
								}
							}
						}
						has_modifier = slave_colony
					}
					has_modifier = slaves_outnumber_free
				}
				remove_modifier = slaves_outnumber_free
			}
		}
	}
}