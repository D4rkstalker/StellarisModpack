namespace = MECR_EXPO
####################################################################################################
####################################################################################################
###################### 银河博览会 ####################### The Galactic EXPO ########################
####################################################################################################
####################################################################################################
#备注：
#【目录】仅被一个国家（一般是东道主）执行的事件，用于掌管时间轴
#(xxx.)触发事件	（xxx.）触发下一个目录事件
#[xxx.]被事件触发	[YYY:XXX]被common/YYYs触发		[on_xxx]被on_action触发
#时间表：situation系统是在本事件链完成后才实装的，因此后续添加的situation_galactic_expo时间表仅用于展示时间轴而非控制

@max_single_exhi_score = 106
@max_total_exhi_score = 120

# 开始EXPO
country_event = { #1.【目录】银博会准备开始：校准时间表（100.）(2.)[resolution:resolution_the_galactic_expo.460.]
	id = MECR_EXPO.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_active_resolution = resolution_the_galactic_expo
	}

	immediate = {
		remove_global_flag = expo_starting_checking #这是用来修复.450重复触发的bug的
		save_global_event_target_as = expo_organiser
		set_timed_global_flag = {
			flag = flag_expo_preparing
			days = @expo_prepare_total_timer
		}
		country_event = {
			id = MECR_EXPO.100
			days = @expo_prepare_total_timer
		}
		every_galcom_member = {
			if = {
				limit = { NOT = { any_situation = { is_situation_type = situation_galactic_expo } } }
				start_situation = { type = situation_galactic_expo target = This }
			}
			random_situation = {
				limit = { is_situation_type = situation_galactic_expo }
				export_trigger_value_to_variable = { trigger = situation_progress variable = situation_progress_var }
				multiply_variable = { which = situation_progress_var value = -1 }
				add_situation_progress = situation_progress_var
				add_situation_progress = 66
				set_situation_approach = expo_preparing_approach_normal
			}
			country_event = {
				id = MECR_EXPO.2
			}
		}
	}
}
country_event = { #2.银博会各参与国准备开始：启用事件链，启用场馆建设计划(3.30.40.)
	id = MECR_EXPO.2
	title = "MECR_EXPO.2.title"
	desc = {
		text = "MECR_EXPO.2.desc"
		trigger = { NOT = { has_global_flag = flag_first_expo_complete } }
	}
	desc = {
		text = "MECR_EXPO.2.desc.on_1st"
		trigger = {
			has_global_flag = flag_first_expo_complete
			has_global_flag = flag_expo_on_1st
		}
	}
	desc = {
		text = "MECR_EXPO.2.desc.on_queue"
		trigger = {
			has_global_flag = flag_first_expo_complete
			has_global_flag = flag_expo_on_queue
		}
	}
	desc = {
		text = "MECR_EXPO.2.desc.on_random"
		trigger = {
			has_global_flag = flag_first_expo_complete
			has_global_flag = flag_expo_on_random
		}
	}
	picture = "GFX_evt_galactic_community"
	show_sound = event_conversation
	is_triggered_only = yes

	immediate = {
		set_variable = { which = expo_science_result value = 0 }
		set_variable = { which = expo_culture_result value = 0 }
		set_variable = { which = expo_technology_result value = 0 }
		set_variable = { which = expo_history_result value = 0 }
		set_variable = { which = expo_archaeology_result value = 0 }
		begin_event_chain = {
			event_chain = the_galactic_expo
			target = root
		}

		#科学进步的评分参数
		set_variable = { which = expo_science_estimate_a value = 1.8 }
		set_variable = { which = expo_science_estimate_b value = 1.3 }
		set_variable = { which = expo_science_estimate_c value = 0.8 }
		#工业技术的评分参数
		set_variable = { which = expo_industry_estimate_a value = 18 }
		set_variable = { which = expo_industry_estimate_b value = 13 }
		set_variable = { which = expo_industry_estimate_c value = 8 }
		#考古发现的评分参数
		set_variable = { which = expo_archaeology_estimate_a value = 10 }
		set_variable = { which = expo_archaeology_estimate_b value = 5 }
		set_variable = { which = expo_archaeology_estimate_c value = 2 }
		#历史传统的评分参数
		set_variable = { which = expo_history_estimate_a value = 9 }
		set_variable = { which = expo_history_estimate_b value = 6 }
		set_variable = { which = expo_history_estimate_c value = 3 }

		set_variable = { which = expo_science_lag value = 1 }
		set_variable = { which = expo_culture_lag value = 1 }
		set_variable = { which = expo_industry_lag value = 1 }
	}

	option = {
		name = "MECR_EXPO.2.option"
		trigger = { is_same_value = event_target:expo_organiser }
		# 加修正，开启事件链的描述
		tooltip = {
			begin_event_chain = {
				event_chain = the_galactic_expo
				target = root
			}
		}
		# 场馆建设
		if = {
			limit = { capital_scope = { NOT = { has_deposit = d_expo_former_exhibition_center } } }
			if = {
				limit = { is_ai = no }
				enable_special_project = { name = GLACTIC_EXPO_CENTER_CONSTRUCTION location = this.capital_scope }
			}
			else = {
				capital_scope = {
					planet_event = {
						id = MECR_EXPO.4
					}
				}
			}
		}
		else = {
			capital_scope = {
				remove_deposit = d_expo_former_exhibition_center
				add_deposit = d_expo_exhibition_center
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_science_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_culture_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_industry_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_archaeology_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_history_result"
				amount = 3
			}
			hidden_effect = {
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 15
				}
				change_variable = { which = expo_science_result value = 3 }
				change_variable = { which = expo_culture_result value = 3 }
				change_variable = { which = expo_industry_result value = 3 }
				change_variable = { which = expo_archaeology_result value = 3 }
				change_variable = { which = expo_history_result value = 3 }
				change_variable = { which = expo_total_result value = 15 }
			}
		}
		hidden_effect = {
			# 城邦访问
			country_event = {
				id = MECR_EXPO.30
				days = @expo_sponsor_wait_days
				random = @expo_sponsor_wait_random
			}
			country_event = {
				id = MECR_EXPO.40
				days = @expo_curators_wait_days
				random = @expo_curators_wait_random
			}
			# 清除举办前检查的flag
			remove_global_flag = flag_expo_on_1st
			remove_global_flag = flag_expo_on_queue
			remove_global_flag = flag_expo_on_random
			remove_global_flag = flag_expo_war_delay
		}
	}
	option = {
		name = "MECR_EXPO.2.option"
		trigger = { NOT = { is_same_value = event_target:expo_organiser } }
		tooltip = {
			begin_event_chain = {
				event_chain = the_galactic_expo
				target = root
			}
		}
	}
	after = {
		hidden_effect = {
			set_timed_country_flag = { flag = expo_prepare_stage_complete days = 1 }
			country_event = {
				id = MECR_EXPO.3
			}
		}
	}
}
country_event = { #3.开启新的准备计划，最快每半年一次[on_monthly_pulse_country.2.]
	id = MECR_EXPO.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = flag_expo_preparing
		has_country_flag = expo_prepare_stage_complete
		NOT = { has_country_flag = flag_expo_prepare_stage_timer }
	}
	
	immediate = {
		if = { limit = { is_ai = yes } multiply_variable = { which = ERROR_LOG_CHECKING__AI_PREP_EVENT_STARTED value = 1 } }
		remove_country_flag = expo_prepare_stage_complete
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }
		if = { #玩家
			limit = { is_ai = no }
			enable_special_project = { name = GLACTIC_EXPO_PREPARE_SCIENCE location = this.capital_scope }
			enable_special_project = { name = GLACTIC_EXPO_PREPARE_CULTURE location = this.capital_scope }
			enable_special_project = { name = GLACTIC_EXPO_PREPARE_INDUSTRY location = this.capital_scope }
			if = {
				limit = { NOT = { has_country_flag = flag_expo_archaeology_complete } }
				enable_special_project = { name = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY location = this.capital_scope }
			}
			if = {
				limit = { NOT = { has_country_flag = flag_expo_history_complete } }
				enable_special_project = { name = GLACTIC_EXPO_PREPARE_HISTORY location = this.capital_scope }
			}
		}
		else = { #AI，直接完成项目结果规避闪退bug
			random_list = {
				100 = {
					modifier = {
						divide = expo_science_lag
					}
					modifier = {
						OR = {
							#check_variable = { which = expo_science_result value < 3 }
							check_variable = { which = expo_culture_result value < 3 }
							check_variable = { which = expo_industry_result value < 3 }
							check_variable = { which = expo_archaeology_result value < 3 }
							check_variable = { which = expo_history_result value < 3 }
						}
						mult = 0.1
					}
					modifier = {
						has_country_flag = flag_expo_science_complete
						mult = 0.5
					}
					modifier = {
						check_variable = { which = expo_science_estimate_a value <= value:expo_science_advantage }
						mult = 0.9
					}
					modifier = {
						check_variable = { which = expo_science_estimate_a value > value:expo_science_advantage }
						check_variable = { which = expo_science_estimate_b value <= value:expo_science_advantage }
						mult = 0.6
					}
					modifier = {
						check_variable = { which = expo_science_estimate_b value > value:expo_science_advantage }
						check_variable = { which = expo_science_estimate_c value <= value:expo_science_advantage }
						mult = 0.3
					}
					modifier = {
						check_variable = { which = expo_science_estimate_c value > value:expo_science_advantage }
						mult = 0.1
					}

					set_timed_country_flag = { flag = expo_prepare_stage_complete days = @expo_prepare_stage_refresh_more }
					multiply_variable = { which = ERROR_LOG_CHECKING__AI_INSTANT_EVENT_IS_OK value = 1 } #error log checking
					country_event = {
						id = MECR_EXPO.110
						days = 1
					}
				}
				80 = {
					modifier = {
						divide = expo_culture_lag
					}
					modifier = {
						OR = {
							check_variable = { which = expo_science_result value < 3 }
							#check_variable = { which = expo_culture_result value < 3 }
							check_variable = { which = expo_industry_result value < 3 }
							check_variable = { which = expo_archaeology_result value < 3 }
							check_variable = { which = expo_history_result value < 3 }
						}
						mult = 0.1
					}
					modifier = {
						has_country_flag = flag_expo_culture_complete
						mult = 0.5
					}
					modifier = {
						resource_stockpile_compare = { resource = unity value < 6000 }
						mult = 0.9
					}
					modifier = {
						resource_stockpile_compare = { resource = unity value < 5000 }
						mult = 0.9
					}
					modifier = {
						resource_stockpile_compare = { resource = unity value < 4000 }
						mult = 0.8
					}
					modifier = {
						resource_stockpile_compare = { resource = unity value < 3000 }
						mult = 0.8
					}
					modifier = {
						resource_stockpile_compare = { resource = unity value < 2000 }
						mult = 0.8
					}

					# 1000凝聚力。不够的话1:10影响力补齐
					export_resource_stockpile_to_variable = {
						resource = unity
						variable = unity_stock
					}
					if = {
						limit = { check_variable = { which = unity_stock value > 1000 } }
						add_resource = { unity = -1000 }
					}
					else = {
						add_resource = {
							unity = -1
							mult = unity_stock
						}
						subtract_variable = { which = unity_stock value = 1000 }
						add_resource = {
							influence = 0.1
						}
					}
					clear_variable = unity_stock
					set_variable = { which = expo_culture_scoring_dices value = 0 }

					# 投资
					set_variable = {
						which = expo_culture_invest
						value = value:expo_culture_invest
					}
					while = {
						count = 3
						random_list = {
							100 = {
								modifier = {
									set = 0
									check_variable = {
										which = expo_culture_invest
										value >= value:unity_stockpile
									}
								}
								add_resource = {
									unity = -1
									mult = value:expo_culture_invest
								}
								change_variable = { which = expo_culture_scoring_dices value = 1 }
								set_variable = {
									which = expo_culture_invest
									value = value:expo_culture_invest
								}
							}
							500 = {
								modifier = {
									set = 0
									resource_stockpile_compare = {
										resource = unity
										value > 2000
									}
								}
							}
						}
					}

					set_timed_country_flag = { flag = expo_prepare_stage_complete days = @expo_prepare_stage_refresh_more }
					multiply_variable = { which = ERROR_LOG_CHECKING__AI_INSTANT_EVENT_IS_OK value = 1 } #error log checking
					country_event = {
						id = MECR_EXPO.120
						days = 1
					}
				}
				90 = {
					modifier = {
						divide = expo_industry_lag
					}
					modifier = {
						OR = {
							check_variable = { which = expo_science_result value < 3 }
							check_variable = { which = expo_culture_result value < 3 }
							#check_variable = { which = expo_industry_result value < 3 }
							check_variable = { which = expo_archaeology_result value < 3 }
							check_variable = { which = expo_history_result value < 3 }
						}
						mult = 0.1
					}
					modifier = {
						has_country_flag = flag_expo_industry_complete
						mult = 0.5
					}
					modifier = {
						check_variable = { which = expo_industry_estimate_a value <= value:expo_industry_advantage }
						mult = 0.9
					}
					modifier = {
						check_variable = { which = expo_industry_estimate_a value > value:expo_industry_advantage }
						check_variable = { which = expo_industry_estimate_b value <= value:expo_industry_advantage }
						mult = 0.6
					}
					modifier = {
						check_variable = { which = expo_industry_estimate_b value > value:expo_industry_advantage }
						check_variable = { which = expo_industry_estimate_c value <= value:expo_industry_advantage }
						mult = 0.3
					}
					modifier = {
						check_variable = { which = expo_industry_estimate_c value > value:expo_industry_advantage }
						mult = 0.1
					}
					modifier = {
						resource_stockpile_compare = { resource = alloys value < 2000 }
						mult = 0.8
					}
					modifier = {
						resource_stockpile_compare = { resource = alloys value < 1000 }
						mult = 0.8
					}

					# 500合金。不够的话1:5影响力补齐
					export_resource_stockpile_to_variable = {
						resource = alloys
						variable = alloys_stock
					}
					if = {
						limit = { check_variable = { which = alloys_stock value > 500 } }
						add_resource = { alloys = -500 }
					}
					else = {
						add_resource = {
							alloys = -1
							mult = alloys_stock
						}
						subtract_variable = { which = alloys_stock value = 500 }
						add_resource = {
							influence = 0.2
							mult = alloys_stock
						}
					}
					clear_variable = alloys_stock
					set_variable = { which = expo_industry_scoring_dices value = 0 }

					# 投资
					set_variable = {
						which = expo_industry_invest
						value = value:expo_industry_invest
					}
					random_list = {
						100 = {
							modifier = {
								set = 0
								check_variable = {
									which = expo_industry_invest
									value >= value:alloys_stockpile
								}
							}
							add_resource = {
								alloys = -1
								mult = value:expo_industry_invest
							}
							change_variable = { which = expo_industry_scoring_dices value = 1 }
						}
						500 = {
							modifier = {
								set = 0
								resource_stockpile_compare = {
									resource = alloys
									value > 1000
								}
							}
						}
					}

					set_timed_country_flag = { flag = expo_prepare_stage_complete days = @expo_prepare_stage_refresh_more }
					multiply_variable = { which = ERROR_LOG_CHECKING__AI_INSTANT_EVENT_IS_OK value = 1 } #error log checking
					country_event = {
						id = MECR_EXPO.130
						days = 1
					}
				}
				90 = {
					modifier = {
						has_country_flag = flag_expo_archaeology_complete
						set = 0
					}
					modifier = {
						OR = {
							check_variable = { which = expo_science_result value < 3 }
							check_variable = { which = expo_culture_result value < 3 }
							check_variable = { which = expo_industry_result value < 3 }
							#check_variable = { which = expo_archaeology_result value < 3 }
							check_variable = { which = expo_history_result value < 3 }
						}
						mult = 0.1
					}
					modifier = {
						check_variable = { which = expo_archaeology_estimate_a value <= value:expo_archaeology_advantage }
						mult = 0.9
					}
					modifier = {
						check_variable = { which = expo_archaeology_estimate_a value > value:expo_archaeology_advantage }
						check_variable = { which = expo_archaeology_estimate_b value <= value:expo_archaeology_advantage }
						mult = 0.6
					}
					modifier = {
						check_variable = { which = expo_archaeology_estimate_b value > value:expo_archaeology_advantage }
						check_variable = { which = expo_archaeology_estimate_c value <= value:expo_archaeology_advantage }
						mult = 0.3
					}
					modifier = {
						check_variable = { which = expo_archaeology_estimate_c value > value:expo_archaeology_advantage }
						mult = 0.1
					}
					modifier = {
						resource_stockpile_compare = { resource = minor_artifacts value < 150 }
						mult = 0.8
					}
					modifier = {
						resource_stockpile_compare = { resource = minor_artifacts value < 100 }
						mult = 0.6
					}
					modifier = {
						resource_stockpile_compare = { resource = minor_artifacts value < 50 }
						mult = 0.5
					}

					# 50小型文物。不够的话1:1影响力补齐
					export_resource_stockpile_to_variable = {
						resource = minor_artifacts
						variable = minor_artifacts_stock
					}
					if = {
						limit = { check_variable = { which = minor_artifacts_stock value >= 50 } }
						add_resource = { minor_artifacts = -50 }
					}
					else = {
						add_resource = {
							minor_artifacts = -50
							mult = minor_artifacts_stock
						}
						subtract_variable = { which = minor_artifacts_stock value = 50 }
						add_resource = {
							influence = 50
							mult = minor_artifacts_stock
						}
					}
					clear_variable = minor_artifacts_stock
					set_variable = { which = expo_archaeology_scoring_dices value = 0 }

					# 投资
					while = {
						count = 2
						random_list = {
							100 = {
								modifier = {
									set = 0
									resource_stockpile_compare = {
										resource = minor_artifacts
										value < 50
									}
								}
								add_resource = {
									minor_artifacts = -50
								}
								change_variable = { which = expo_archaeology_scoring_dices value = 1 }
								set_variable = {
									which = expo_culture_invest
									value = value:expo_culture_invest
								}
							}
							300 = {
								modifier = {
									set = 0
									resource_stockpile_compare = {
										resource = minor_artifacts
										value > 100
									}
								}
							}
						}
					}

					set_timed_country_flag = { flag = expo_prepare_stage_complete days = @expo_prepare_stage_refresh_more }
					multiply_variable = { which = ERROR_LOG_CHECKING__AI_INSTANT_EVENT_IS_OK value = 1 } #error log checking
					country_event = {
						id = MECR_EXPO.140
						days = 1
					}
				}
				90 = {
					modifier = {
						has_country_flag = flag_expo_history_complete
						set = 0
					}
					modifier = {
						OR = {
							check_variable = { which = expo_science_result value < 3 }
							check_variable = { which = expo_culture_result value < 3 }
							check_variable = { which = expo_industry_result value < 3 }
							check_variable = { which = expo_archaeology_result value < 3 }
							#check_variable = { which = expo_history_result value < 3 }
						}
						mult = 0.1
					}
					modifier = {
						check_variable = { which = expo_history_scoring_dices value = 1 }
						mult = 0.8
					}
					modifier = {
						check_variable = { which = expo_history_scoring_dices value = 2 }
						mult = 0.6
					}
					modifier = {
						check_variable = { which = expo_history_scoring_dices value = 3 }
						mult = 0.4
					}
					modifier = {
						check_variable = { which = expo_history_scoring_dices value >= 4 }
						mult = 0.2
					}

					modifier = {
						check_variable = { which = expo_history_estimate_a value <= value:expo_history_advantage }
						mult = 0.9
					}
					modifier = {
						check_variable = { which = expo_history_estimate_a value > value:expo_history_advantage }
						check_variable = { which = expo_history_estimate_b value <= value:expo_history_advantage }
						mult = 0.7
					}
					modifier = {
						check_variable = { which = expo_history_estimate_b value > value:expo_history_advantage }
						check_variable = { which = expo_history_estimate_c value <= value:expo_history_advantage }
						mult = 0.4
					}
					modifier = {
						check_variable = { which = expo_history_estimate_c value > value:expo_history_advantage }
						mult = 0.2
					}
					modifier = {
						resource_stockpile_compare = { resource = influence value < 200 }
						mult = 0.8
					}

					add_resource = {
						influence = -100
					}

					set_timed_country_flag = { flag = expo_prepare_stage_complete days = @expo_prepare_stage_refresh_more }
					multiply_variable = { which = ERROR_LOG_CHECKING__AI_INSTANT_EVENT_IS_OK value = 1 } #error log checking
					country_event = {
						id = MECR_EXPO.150
						days = 1
					}
				}
			}

		}
		random_situation = {
			limit = { is_situation_type = situation_galactic_expo }
			root = {
				create_message = {
					type = MESSAGE_TYPE_EXPO_PREPARE_REFRESH
					localization = "MESSAGE_TYPE_EXPO_PREPARE_REFRESH_DESC"
					days = 30
					target = prev
				}
			}
		}
		set_timed_country_flag = { flag = flag_expo_prepare_stage_timer days = @expo_prepare_stage_refresh }
	}
}

# 场馆建设
planet_event = { #4.场馆完工，提供展览分数[special_project:GLACTIC_EXPO_CENTER_CONSTRUCTION:on_success]
	id = MECR_EXPO.4
	title = "MECR_EXPO.4.title"
	desc = "MECR_EXPO.4.desc"
	picture = "GFX_evt_arena"
	show_sound = event_construction
	is_triggered_only = yes
	
	option = {
		name = "EXCELLENT"
		add_deposit = d_expo_exhibition_center
		owner = {
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_science_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_culture_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_industry_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_archaeology_result"
				amount = 3
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_history_result"
				amount = 3
			}
		}
		hidden_effect = {
			remove_deposit = d_expo_exhibition_center_constructing
			save_global_event_target_as = expo_exhibition_center
			owner = {
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 15
				}
				change_variable = { which = expo_science_result value = 3 }
				change_variable = { which = expo_culture_result value = 3 }
				change_variable = { which = expo_industry_result value = 3 }
				change_variable = { which = expo_archaeology_result value = 3 }
				change_variable = { which = expo_history_result value = 3 }
				change_variable = { which = expo_total_result value = 15 }
			}
		}
	}
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
	abort_effect = {
		hidden_effect = {
			remove_deposit = d_expo_exhibition_center_constructing
			add_deposit = d_expo_exhibition_center
			save_global_event_target_as = expo_exhibition_center
			owner = {
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_science_result"
					amount = 3
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_culture_result"
					amount = 3
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_industry_result"
					amount = 3
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_archaeology_result"
					amount = 3
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_history_result"
					amount = 3
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 15
				}
				change_variable = { which = expo_science_result value = 3 }
				change_variable = { which = expo_culture_result value = 3 }
				change_variable = { which = expo_industry_result value = 3 }
				change_variable = { which = expo_archaeology_result value = 3 }
				change_variable = { which = expo_history_result value = 3 }
				change_variable = { which = expo_total_result value = 15 }
			}
		}
	}
}
planet_event = { #5.开会时场馆未完成，赶工完成[100.]
	id = MECR_EXPO.5
	title = "MECR_EXPO.5.title"
	desc = "MECR_EXPO.5.desc"
	picture = "GFX_evt_mining_operations"
	show_sound = event_construction
	is_triggered_only = yes
	immediate = {
		remove_deposit = d_expo_exhibition_center_constructing
		add_deposit = d_expo_exhibition_center
		save_global_event_target_as = expo_exhibition_center
	}

	option = {
		name = "TERRIBLE"
		tooltip = { add_deposit = d_expo_exhibition_center }
		owner = {
			add_resource = {
				minerals = -1000
				unity = -1000
				influence = -200
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_science_result"
				amount = 2
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_culture_result"
				amount = 2
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_industry_result"
				amount = 2
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_archaeology_result"
				amount = 2
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_history_result"
				amount = 2
			}
			hidden_effect = {
				change_variable = { which = expo_science_result value = 2 }
				change_variable = { which = expo_culture_result value = 2 }
				change_variable = { which = expo_industry_result value = 2 }
				change_variable = { which = expo_archaeology_result value = 2 }
				change_variable = { which = expo_history_result value = 2 }
				change_variable = { which = expo_total_result value = 10 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 10
				}
			}
		}
	}
}
planet_event = { #6.场馆被夺取，立即替换为前场馆(7.)[on_planet_transfer]
	id = MECR_EXPO.6
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_deposit = d_expo_exhibition_center
		NOT = { has_global_flag = flag_expo_ongoing }
		owner = { NOT = { is_same_value = event_target:expo_organiser } }
	}
	immediate = {
		remove_deposit = d_expo_exhibition_center
		add_deposit = d_expo_former_exhibition_center
		event_target:expo_organiser = {
			country_event = {
				id = MECR_EXPO.7
			}
		}
	}
}
country_event = { #7.场馆建设发生变故，寻找新的首都重新开始建设计划[6.special_project:GLACTIC_EXPO_CENTER_CONSTRUCTION:on_cancel.]
	id = MECR_EXPO.7
	title = "MECR_EXPO.7.title"
	desc = "MECR_EXPO.7.desc"
	picture = "GFX_evt_burning_city"
	is_triggered_only = yes
	immediate = {
		clear_global_event_target = expo_exhibition_center
	}

	option = {
		name = "CURSES"
		if = {
			limit = { is_ai = no }
			enable_special_project = { name = GLACTIC_EXPO_CENTER_CONSTRUCTION location = this.capital_scope }
		}
		else = {
			capital_scope = {
				planet_event = {
					id = MECR_EXPO.4
				}
			}
		}
	}
}
planet_event = { #8.兜底定时移除场馆建设地块，防止遗留[special_project:GLACTIC_EXPO_CENTER_CONSTRUCTION:on_start]
	id = MECR_EXPO.8
	hide_window = yes
	is_triggered_only = yes

	trigger = { has_deposit = d_expo_exhibition_center_constructing }
	immediate = { remove_deposit = d_expo_exhibition_center_constructing }
}

country_event = { #30.选择请求成为赞助商的备选贸易城邦(31.)[2.]
	id = MECR_EXPO.30
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				any_country = {
					has_country_flag = trader_enclave_country_1
					has_communications = root
				}
				NOT = { has_country_flag = attacked_xuracorp }
			}
			random_country = {
				limit = { has_country_flag = trader_enclave_country_1 }
				set_country_flag = expo_sponsor_candidate
			}
		}
		if = {
			limit = {
				any_country = {
					has_country_flag = trader_enclave_country_2
					has_communications = root
				}
				NOT = { has_country_flag = attacked_riggans }
			}
			random_country = {
				limit = { has_country_flag = trader_enclave_country_2 }
				set_country_flag = expo_sponsor_candidate
			}
		}
		if = {
			limit = {
				any_country = {
					has_country_flag = trader_enclave_country_3
					has_communications = root
				}
				NOT = { has_country_flag = attacked_muutagans }
			}
			random_country = {
				limit = { has_country_flag = trader_enclave_country_3 }
				set_country_flag = expo_sponsor_candidate
			}
		}
		random_country = {
			limit = { has_country_flag = expo_sponsor_candidate }
			save_event_target_as = expo_sponsor_candidate_bidding
			random_owned_fleet = {
				solar_system = { save_event_target_as = expo_sponsor_candidate_bidding_home_system }
			}
		}
		if = {
			limit = { exists = event_target:expo_sponsor_candidate_bidding }
			country_event = {
				id = MECR_EXPO.31
				days = @expo_sponsor_wait_days
				random = @expo_sponsor_wait_random
			}
		}
	}
}
country_event = { #31.检查赞助商备选的贸易城邦是否还存在(32.)
	id = MECR_EXPO.31
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { exists = event_target:expo_sponsor_candidate_bidding }
			country_event = {
				id = MECR_EXPO.32
			}
		}
		else_if = {
			limit = { any_country = { has_country_flag = expo_sponsor_candidate } }
			random_country = {
				limit = { has_country_flag = expo_sponsor_candidate }
				save_event_target_as = expo_sponsor_candidate_bidding
				random_owned_fleet = {
					solar_system = { save_event_target_as = expo_sponsor_candidate_bidding_home_system }
				}
			}
			country_event = {
				id = MECR_EXPO.31
			}
		}
	}
}
country_event = { #32.贸易城邦请求成为赞助商
	id = MECR_EXPO.32
	title = "MECR_EXPO.32.title"
	desc = {
		text = "MECR_EXPO.32.desc.xura"
		trigger = {
			event_target:expo_sponsor_candidate_bidding = {
				has_country_flag = trader_enclave_country_1
			}
		}
	}
	desc = {
		text = "MECR_EXPO.32.desc.riggan"
		trigger = {
			event_target:expo_sponsor_candidate_bidding = {
				has_country_flag = trader_enclave_country_2
			}
		}
	}
	desc = {
		text = "MECR_EXPO.32.desc.muutagan"
		trigger = {
			event_target:expo_sponsor_candidate_bidding = {
				has_country_flag = trader_enclave_country_3
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	picture_event_data = {
		portrait = event_target:expo_sponsor_candidate_bidding
		room = enclave_trader_room
	}

	option = { # 同意
		name = "DEAL"
		custom_gui = "enclave_trader_option"
		allow = {
			OR = {
				is_ai = yes
				resource_stockpile_compare = { resource = influence value >= 75 }
			}
			NOT = { has_event_chain = the_galactic_expo_ongoing }
		}
		custom_tooltip = "MECR_EXPO.32.option.deal"
		event_target:expo_sponsor_candidate_bidding = {
			switch = {
				trigger = has_country_flag
				trader_enclave_country_1 = {
					root = {
						add_resource = {
							influence = -75
							exotic_gases = 500
						}
					}
				}
				trader_enclave_country_2 = {
					root = {
						add_resource = {
							influence = -75
							volatile_motes = 500
						}
					}
				}
				trader_enclave_country_3 = {
					root = {
						add_resource = {
							influence = -75
							rare_crystals = 500
						}
					}
				}
			}
			add_trust = {
				who = root
				amount = 30
			}
		}
		hidden_effect = {
			event_target:expo_sponsor_candidate_bidding = {
				save_global_event_target_as = expo_sponsor
				random_owned_fleet = {
					solar_system = { save_global_event_target_as = expo_sponsor_home_system }
				}
			}
			every_country = {
				limit = { has_country_flag = expo_sponsor_candidate }
				remove_country_flag = expo_sponsor_candidate
			}
		}
		ai_chance = {
			factor = 150
			modifier = {
				factor = 0.5
				event_target:expo_sponsor_candidate_bidding = {
					NOT = { has_country_flag = trader_enclave_country_1 }
				}
				root = {
					NOT = { has_country_flag = attacked_xuracorp }
				}
				any_country = {
					has_country_flag = trader_enclave_country_1
					has_communications = root
				}
			}
			modifier = {
				factor = 2
				event_target:expo_sponsor_candidate_bidding = {
					has_country_flag = trader_enclave_country_1
				}
			}
		}
	}
	option = { # 拒绝
		name = "NODEAL"
		custom_gui = "enclave_trader_option"
		allow = {
		}
		hidden_effect = {
			event_target:expo_sponsor_candidate_bidding = {
				remove_country_flag = expo_sponsor_candidate
			}
			if = {
				limit = { any_country = { has_country_flag = expo_sponsor_candidate } }
				random_country = {
					limit = { has_country_flag = expo_sponsor_candidate }
					save_event_target_as = expo_sponsor_candidate_bidding
					random_owned_fleet = {
						solar_system = { save_event_target_as = expo_sponsor_candidate_bidding_home_system }
					}
				}
				country_event = {
					id = MECR_EXPO.31
					days = @expo_sponsor_wait_days
					random = @expo_sponsor_wait_random
				}
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = {
					any_country = {
						has_country_flag = expo_sponsor_candidate
						NOT = { is_same_value = event_target:expo_sponsor_candidate_bidding }
					}
				}
			}
		}
		default_hide_option = yes
	}
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}

country_event = { #40.检查策展人是否申请参加博览会(41.)[2.]
	id = MECR_EXPO.40
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				any_country = {
					has_country_flag = curator_enclave_country
				}
			}
			random_country = {
				limit = { has_country_flag = curator_enclave_country }
				set_country_flag = expo_curators
				save_global_event_target_as = expo_curators
			}
			if = {
				limit = { NOT = { has_country_flag = attacked_curators } }
				event_target:expo_curators = {
					if = {
						limit = { NOT = { has_communications = root } }
						establish_communications = root
					}
				}
				country_event = {
					id = MECR_EXPO.41
					days = @expo_curators_wait_days
					random = @expo_curators_wait_random
				}
			}
			#else = {
			#	random_galcom_member = {
			#		limit = { has_communications = event_target:expo_curators }
			#		country_event = {
			#			id = MECR_EXPO.42
			#			days = 90
			#			random = 120
			#		}
			#	}
			#}
		}
	}
}
country_event = { #41.策展人申请参加博览会
	id = MECR_EXPO.41
	title = "MECR_EXPO.41.title"
	desc = "MECR_EXPO.41.desc"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_curator_window"
	picture_event_data = {
		portrait = event_target:expo_curators
		room = enclave_curator_room
	}

	trigger = {
		exists = event_target:expo_curators
		NOT = { has_country_flag = attacked_curators }
	}

	option = { # 同意
		name = "MECR_EXPO.41.option.ok"
		custom_gui = "enclave_curator_option"
		allow = {
			OR = {
				is_ai = yes
				resource_stockpile_compare = { resource = influence value >= 25 }
			}
			NOT = { has_event_chain = the_galactic_expo_ongoing }
		}
		custom_tooltip = "MECR_EXPO.41.option.ok.tooltip"
		add_resource = { influence = -25 }
		add_monthly_resource_mult = { resource = physics_research value = 1 }
		add_monthly_resource_mult = { resource = society_research value = 1 }
		add_monthly_resource_mult = { resource = engineering_research value = 1 }
		event_target:expo_curators = {
			add_trust = {
				who = root
				amount = 10
			}
		}
		hidden_effect = {
			set_global_flag = flag_curator_take_part_in_expo
		}
		ai_chance = {
			factor = 1000
		}
	}

	option = { # 拒绝
		name = "MECR_EXPO.41.option.no"
		custom_gui = "enclave_curator_option"
		trigger = {
			OR = {
				is_ai = no
				has_event_chain = the_galactic_expo_ongoing
			}
		}
		ai_chance = {
			factor = 0
		}
		default_hide_option = yes
	}

	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}

# 准备展览
country_event = { #100.【目录】准备阶段结束：校准并锁定时间表，截止未完成的准备与场馆建设计划（200.）(5.)[1.]
	id = MECR_EXPO.100
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_same_value = event_target:expo_organiser
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
		NOT = {
			has_global_flag = debug_expo_preparation_ends_event
		}
	}

	immediate = {
		set_global_flag = debug_expo_preparation_ends_event
		if = {
			limit = { NOT = { exists = event_target:expo_nobody } }
			create_country = {
				type = faction
				name = NAME_expo_nobody
				effect = { save_global_event_target_as = expo_nobody }
			}
		}
		every_country = {
			limit = { has_event_chain = the_galactic_expo }
			if = {
				limit = { NOT = { any_situation = { is_situation_type = situation_galactic_expo } } }
				start_situation = { type = situation_galactic_expo target = This }
			}
			random_situation = {
				limit = { is_situation_type = situation_galactic_expo }
				export_trigger_value_to_variable = { trigger = situation_progress variable = situation_progress_var }
				multiply_variable = { which = situation_progress_var value = -1 }
				add_situation_progress = situation_progress_var
				add_situation_progress = 92.4
			}
			#expo_situation_set_progress = { progress = 92.4 }
			random_situation = {
				limit = { is_situation_type = situation_galactic_expo }
				set_situation_approach = expo_recess_approach_do_nothing
				
				limit = { is_situation_type = situation_galactic_expo }
				set_situation_locked = yes
				set_situation_flag = flag_expo_situation_paused
			}
			#expo_situation_pause = yes
			if = {
				limit = { is_researching_special_project = GLACTIC_EXPO_PREPARE_SCIENCE }
				change_variable = { which = expo_science_result value = 1 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_science_result"
					amount = 1
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 1
				}
			}
			else_if = {
				limit = { is_researching_special_project = GLACTIC_EXPO_PREPARE_CULTURE }
				change_variable = { which = expo_culture_result value = 1 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_culture_result"
					amount = 1
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 1
				}
			}
			else_if = {
				limit = { is_researching_special_project = GLACTIC_EXPO_PREPARE_INDUSTRY }
				change_variable = { which = expo_industry_result value = 1 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_industry_result"
					amount = 1
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 1
				}
			}
			else_if = {
				limit = { is_researching_special_project = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
				change_variable = { which = expo_archaeology_result value = 1 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_archaeology_result"
					amount = 1
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 1
				}
			}
			else_if = {
				limit = { is_researching_special_project = GLACTIC_EXPO_PREPARE_HISTORY }
				change_variable = { which = expo_history_result value = 1 }
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_history_result"
					amount = 1
				}
				add_event_chain_counter = {
					event_chain = "the_galactic_expo"
					counter = "expo_total_result"
					amount = 1
				}
			}
			abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
			abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
			abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
			abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
			abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }
			if = {
				limit = {
					is_same_value = event_target:expo_organiser
					NOT = { any_owned_planet = { has_deposit = d_expo_exhibition_center } }
				}
				abort_special_project = { type = GLACTIC_EXPO_CENTER_CONSTRUCTION }
				every_owned_planet = {
					limit = { has_deposit = d_expo_exhibition_center_constructing }
					remove_deposit = d_expo_exhibition_center_constructing
				}
				capital_scope = {
					planet_event = { #场馆赶工
						id = MECR_EXPO.5
					}
				}
			}
			remove_country_flag = flag_expo_science_complete
			remove_country_flag = flag_expo_culture_complete
			remove_country_flag = flag_expo_industry_complete
			remove_country_flag = flag_expo_archaeology_complete
			remove_country_flag = flag_expo_history_complete
			remove_country_flag = expo_prepare_stage_complete
			remove_country_flag = flag_expo_prepare_stage_timer

			#科学进步的评分参数
			#set_variable = { which = expo_science_estimate_a value = 1.8 }
			#set_variable = { which = expo_science_estimate_b value = 1.3 }
			#set_variable = { which = expo_science_estimate_c value = 0.8 }
			#工业技术的评分参数
			#set_variable = { which = expo_industry_estimate_a value = 18 }
			#set_variable = { which = expo_industry_estimate_b value = 13 }
			#set_variable = { which = expo_industry_estimate_c value = 8 }
			#考古发现的评分参数
			#set_variable = { which = expo_archaeology_estimate_a value = 10 }
			#set_variable = { which = expo_archaeology_estimate_b value = 5 }
			#set_variable = { which = expo_archaeology_estimate_c value = 2 }
			#历史传统的评分参数
			#set_variable = { which = expo_history_estimate_a value = 9 }
			#set_variable = { which = expo_history_estimate_b value = 6 }
			#set_variable = { which = expo_history_estimate_c value = 3 }
			#清除准备阶段用到的参数
			clear_variable = expo_science_estimate_a
			clear_variable = expo_science_estimate_b
			clear_variable = expo_science_estimate_c
			clear_variable = expo_industry_estimate_a
			clear_variable = expo_industry_estimate_b
			clear_variable = expo_industry_estimate_c
			clear_variable = expo_archaeology_estimate_a
			clear_variable = expo_archaeology_estimate_b
			clear_variable = expo_archaeology_estimate_c
			clear_variable = expo_history_estimate_a
			clear_variable = expo_history_estimate_b
			clear_variable = expo_history_estimate_c
			clear_variable = expo_science_lag
			clear_variable = expo_culture_lag
			clear_variable = expo_industry_lag
		}
		country_event = {
			id = MECR_EXPO.200
			days = 1
		}
	}
}

country_event = { #110.科学进步：生成评分(111.)[special_project:GLACTIC_EXPO_PREPARE_SCIENCE:on_success]
	id = MECR_EXPO.110
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }

		# 掷骰
		reroll_random = yes
		random_list = {
			100 = {
				modifier = { is_ai = yes factor = 0.75 }
				modifier = { factor = value:expo_science_advantage }
				set_variable = { which = expo_science_gain value = 3 }
			}
			60 = {
				set_variable = { which = expo_science_gain value = 2 }
			}
			80 = {
				modifier = { factor = value:expo_science_disadvantage }
				set_variable = { which = expo_science_gain value = 1 }
			}
		}

		if = {
			limit = { NOT = { has_country_flag = flag_expo_science_complete } }
			set_country_flag = flag_expo_science_complete
		}
		multiply_variable = { which = expo_science_lag value = 4 }

		random_owned_leader = {
			limit = { is_researching_area = physics }
			save_event_target_as = physics_leader
		}

		multiply_variable = { which = ERROR_LOG_CHECKING__SCORING_EVENT_IS_OK value = 1 } #error log checking
		
		if = {
			limit = { is_ai = yes }
			set_variable = { which = expo_gain_amount value = expo_science_gain }
			change_variable = { which = expo_gain_amount value = 1 }
			multiply_variable = { which = expo_gain_amount value = 3 }
			if = {
				limit = {
					any_situation = {
						is_situation_type = situation_galactic_expo
						current_situation_approach = expo_preparing_approach_focus
					}
				}
				random_list = {
					45 = { change_variable = { which = expo_gain_amount value = 1 } }
					35 = { }
					20 = { change_variable = { which = expo_gain_amount value = -1 } }
				}
			}
			else = {
				random_list = {
					25 = { change_variable = { which = expo_gain_amount value = 1 } }
					50 = { }
					25 = { change_variable = { which = expo_gain_amount value = -1 } }
				}
			}
			change_variable = { which = expo_total_result value = expo_gain_amount }
			change_variable = { which = expo_science_result value = expo_gain_amount }
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_science_result"
				amount = expo_gain_amount
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_science_gain
			clear_variable = expo_gain_amount
			multiply_variable = { which = ERROR_LOG_CHECKING__SCORING_FOR_AI_IS_OK value = 1 } #error log checking
		}
		else = {
			country_event = {
				id = MECR_EXPO.111
				#days = 5 ###
			}
		}
	}
}
country_event = { #111.科学进步：评分结果
	id = MECR_EXPO.111
	title = "MECR_EXPO.111.title"
	desc = {
		text = "MECR_EXPO.111.desc.a.1"
		trigger = { check_variable = { which = expo_science_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.a.2"
		trigger = { check_variable = { which = expo_science_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.a.3"
		trigger = { check_variable = { which = expo_science_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.b.1"
		trigger = { check_variable = { which = expo_science_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.b.2"
		trigger = { check_variable = { which = expo_science_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.b.3"
		trigger = { check_variable = { which = expo_science_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.c.1"
		trigger = { check_variable = { which = expo_science_gain value = 1 } }
	}
	desc = {
		text = "MECR_EXPO.111.desc.c.2"
		trigger = { check_variable = { which = expo_science_gain value = 1 } }
	}
	picture = "GFX_evt_physics_research"
	is_triggered_only = yes
	immediate = {
		set_variable = { which = expo_gain_amount value = expo_science_gain }
		change_variable = { which = expo_gain_amount value = 1 }
		multiply_variable = { which = expo_gain_amount value = 3 }
		if = {
			limit = {
				any_situation = {
					is_situation_type = situation_galactic_expo
					current_situation_approach = expo_preparing_approach_focus
				}
			}
			random_list = {
				45 = { change_variable = { which = expo_gain_amount value = 1 } }
				35 = { }
				20 = { change_variable = { which = expo_gain_amount value = -1 } }
			}
		}
		else = {
			random_list = {
				25 = { change_variable = { which = expo_gain_amount value = 1 } }
				50 = { }
				25 = { change_variable = { which = expo_gain_amount value = -1 } }
			}
		}
		change_variable = { which = expo_total_result value = expo_gain_amount }
		change_variable = { which = expo_science_result value = expo_gain_amount }
		multiply_variable = { which = ERROR_LOG_CHECKING__NOTIFICATION_EVENT_IS_OK value = 1 } #error log checking
	}

	option = {
		name = {
			text = "EXCELLENT"
			trigger = { check_variable = { which = expo_science_gain value = 3 } }
		}
		name = {
			text = "GOOD"
			trigger = { check_variable = { which = expo_science_gain value = 2 } }
		}
		name = {
			text = "OOPS"
			trigger = { check_variable = { which = expo_science_gain value = 1 } }
		}
		add_event_chain_counter = {
			event_chain = "the_galactic_expo"
			counter = "expo_science_result"
			amount = expo_gain_amount
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_science_gain
			clear_variable = expo_gain_amount
		}
	}
	
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}

country_event = { #120.文化艺术：生成评分(121.)[special_project:GLACTIC_EXPO_PREPARE_CULTURE:on_success]
	id = MECR_EXPO.120
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }
		
		# 第一次给2次掷骰，此后只给1次掷骰
		if = {
			limit = { NOT = { has_country_flag = flag_expo_culture_complete } }
			change_variable = { which = expo_culture_scoring_dices value = 2 }
		}
		else = {
			change_variable = { which = expo_culture_scoring_dices value = 1 }
		}
		# 奖励骰
		if = {
			limit = { has_modifier = enclave_artist_patron }
			change_variable = { which = expo_culture_scoring_dices value = 1 }
		}
		# 掷骰
		set_variable = { which = expo_culture_gain value = 0 }
		set_variable = { which = expo_culture_scoring_inspiration value = 0 }
		while = {
			count = expo_culture_scoring_dices
			reroll_random = yes
			random_list = {
				2 = {
					modifier = { add = expo_culture_scoring_inspiration }
					modifier = { is_ai = yes factor = 0.75 }
					set_variable = { which = expo_culture_scoring value = 3 }
				}
				3 = {
					set_variable = { which = expo_culture_scoring value = 2 }
				}
				7 = {
					set_variable = { which = expo_culture_scoring value = 1 }
				}
			}
			change_variable = { which = expo_culture_scoring_inspiration value = 0.5 }
			if = {
				limit = { check_variable = { which = expo_culture_gain value < expo_culture_scoring } }
				set_variable = { which = expo_culture_gain value = expo_culture_scoring }
			}
		}

		clear_variable = expo_culture_scoring
		clear_variable = expo_culture_scoring_dices
		clear_variable = expo_culture_scoring_inspiration

		if = {
			limit = { NOT = { has_country_flag = flag_expo_culture_complete } }
			set_country_flag = flag_expo_culture_complete
		}
		multiply_variable = { which = expo_culture_lag value = 4 }

		multiply_variable = { which = ERROR_LOG_CHECKING__SCORING_EVENT_IS_OK value = 1 } #error log checking

		if = {
			limit = { is_ai = yes }
			set_variable = { which = expo_gain_amount value = expo_culture_gain }
			change_variable = { which = expo_gain_amount value = 1 }
			multiply_variable = { which = expo_gain_amount value = 3 }
			if = {
				limit = {
					any_situation = {
						is_situation_type = situation_galactic_expo
						current_situation_approach = expo_preparing_approach_focus
					}
				}
				random_list = {
					45 = { change_variable = { which = expo_gain_amount value = 1 } }
					35 = { }
					20 = { change_variable = { which = expo_gain_amount value = -1 } }
				}
			}
			else = {
				random_list = {
					25 = { change_variable = { which = expo_gain_amount value = 1 } }
					50 = { }
					25 = { change_variable = { which = expo_gain_amount value = -1 } }
				}
			}
			change_variable = { which = expo_total_result value = expo_gain_amount }
			change_variable = { which = expo_culture_result value = expo_gain_amount }
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_culture_result"
				amount = expo_gain_amount
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_culture_gain
			clear_variable = expo_gain_amount
			multiply_variable = { which = ERROR_LOG_CHECKING__SCORING_FOR_AI_IS_OK value = 1 } #error log checking
		}
		else = {
			country_event = {
				id = MECR_EXPO.121
				#days = 5 ###
			}
		}
	}
}
country_event = { #121.文化艺术：评分结果
	id = MECR_EXPO.121
	title = "MECR_EXPO.121.title"
	desc = {
		text = "MECR_EXPO.121.desc.a.1"
		trigger = { check_variable = { which = expo_culture_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.a.2"
		trigger = { check_variable = { which = expo_culture_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.a.3"
		trigger = { check_variable = { which = expo_culture_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.b.1"
		trigger = { check_variable = { which = expo_culture_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.b.2"
		trigger = { check_variable = { which = expo_culture_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.b.3"
		trigger = { check_variable = { which = expo_culture_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.c.1"
		trigger = { check_variable = { which = expo_culture_gain value = 1 } }
	}
	desc = {
		text = "MECR_EXPO.121.desc.c.2"
		trigger = { check_variable = { which = expo_culture_gain value = 1 } }
	}
	picture = "GFX_evt_analyzing_artifacts"
	is_triggered_only = yes
	immediate = {
		set_variable = { which = expo_gain_amount value = expo_culture_gain }
		change_variable = { which = expo_gain_amount value = 1 }
		multiply_variable = { which = expo_gain_amount value = 3 }
		if = {
			limit = {
				any_situation = {
					is_situation_type = situation_galactic_expo
					current_situation_approach = expo_preparing_approach_focus
				}
			}
			random_list = {
				45 = { change_variable = { which = expo_gain_amount value = 1 } }
				35 = { }
				20 = { change_variable = { which = expo_gain_amount value = -1 } }
			}
		}
		else = {
			random_list = {
				25 = { change_variable = { which = expo_gain_amount value = 1 } }
				50 = { }
				25 = { change_variable = { which = expo_gain_amount value = -1 } }
			}
		}
		change_variable = { which = expo_total_result value = expo_gain_amount }
		change_variable = { which = expo_culture_result value = expo_gain_amount }
		multiply_variable = { which = ERROR_LOG_CHECKING__NOTIFICATION_EVENT_IS_OK value = 1 } #error log checking
	}

	option = {
		name = {
			text = "SPLENDID"
			trigger = { check_variable = { which = expo_culture_gain value = 3 } }
		}
		name = {
			text = "INTRIGUING"
			trigger = { check_variable = { which = expo_culture_gain value = 2 } }
		}
		name = {
			text = "UNFORTUNATE"
			trigger = { check_variable = { which = expo_culture_gain value = 1 } }
		}
		add_event_chain_counter = {
			event_chain = "the_galactic_expo"
			counter = "expo_culture_result"
			amount = expo_gain_amount
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_culture_gain
			clear_variable = expo_gain_amount
		}
	}
	
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}
country_event = { #122.文化艺术：追加投资[special_project:GLACTIC_EXPO_PREPARE_CULTURE:on_progress_25/50/75]
	id = MECR_EXPO.122
	title = "MECR_EXPO.122.title"
	desc = "MECR_EXPO.122.desc"
	picture = "GFX_evt_analyzing_artifacts"
	is_triggered_only = yes

	immediate = {
		set_variable = {
			which = expo_culture_invest
			value = value:expo_culture_invest
		}
	}

	option = {
		name = "MAKE_IT_SO"
		custom_tooltip = "MECR_EXPO.122.option.tooltip.a"
		allow = {
			custom_tooltip = {
				fail_text = expo_not_enough_unity
				check_variable = {
					which = expo_culture_invest
					value < value:unity_stockpile
				}
			}
		}
		add_resource = {
			unity = -1
			mult = value:expo_culture_invest
		}
		hidden_effect = {
			change_variable = { which = expo_culture_scoring_dices value = 1 }
		}
		ai_chance = {
			factor = 100
		}
	}
	option = {
		name = "TOOPOOR"
		ai_chance = {
			factor = 500
			modifier = {
				factor = 0
				resource_stockpile_compare = {
					resource = unity
					value > 2000
				}
			}
		}
	}
}

country_event = { #130.工业技术：生成评分(131.)[special_project:GLACTIC_EXPO_PREPARE_INDUSTRY:on_success]
	id = MECR_EXPO.130
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }
		
		set_variable = { which = expo_industry_gain value = 0 }
		#掷骰
		change_variable = { which = expo_industry_scoring_dices value = 2 }
		while = {
			count = expo_industry_scoring_dices
			reroll_random = yes
			random_list = {
				10 = {
					modifier = { is_ai = yes factor = 0.75 }
					modifier = { add = value:expo_industry_advantage }
					set_variable = { which = expo_industry_scoring value = 3 }
				}
				15 = {
					set_variable = { which = expo_industry_scoring value = 2 }
				}
				10 = {
					set_variable = { which = expo_industry_scoring value = 1 }
				}
			}
			if = {
				limit = { check_variable = { which = expo_industry_gain value < expo_industry_scoring } }
				set_variable = { which = expo_industry_gain value = expo_industry_scoring }
			}
		}

		clear_variable = expo_industry_scoring
		clear_variable = expo_industry_scoring_dices

		if = {
			limit = { NOT = { has_country_flag = flag_expo_industry_complete } }
			set_country_flag = flag_expo_industry_complete
		}
		multiply_variable = { which = expo_industry_lag value = 4 }

		multiply_variable = { which = ERROR_LOG_CHECKING__SCORING_EVENT_IS_OK value = 1 } #error log checking
		
		if = {
			limit = { is_ai = yes }
			set_variable = { which = expo_gain_amount value = expo_industry_gain }
			change_variable = { which = expo_gain_amount value = 1 }
			multiply_variable = { which = expo_gain_amount value = 3 }
			if = {
				limit = {
					any_situation = {
						is_situation_type = situation_galactic_expo
						current_situation_approach = expo_preparing_approach_focus
					}
				}
				random_list = {
					45 = { change_variable = { which = expo_gain_amount value = 1 } }
					35 = { }
					20 = { change_variable = { which = expo_gain_amount value = -1 } }
				}
			}
			else = {
				random_list = {
					25 = { change_variable = { which = expo_gain_amount value = 1 } }
					50 = { }
					25 = { change_variable = { which = expo_gain_amount value = -1 } }
				}
			}
			change_variable = { which = expo_total_result value = expo_gain_amount }
			change_variable = { which = expo_industry_result value = expo_gain_amount }
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_industry_result"
				amount = expo_gain_amount
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_industry_gain
			clear_variable = expo_gain_amount
			multiply_variable = { which = ERROR_LOG_CHECKING__SCORING_FOR_AI_IS_OK value = 1 } #error log checking
		}
		else = {
			country_event = {
				id = MECR_EXPO.131
				#days = 5 ###
			}
		}
	}
}
country_event = { #131.工业技术：评分结果
	id = MECR_EXPO.131
	title = "MECR_EXPO.131.title"
	desc = {
		text = "MECR_EXPO.131.desc.a.1"
		trigger = { check_variable = { which = expo_industry_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.a.2"
		trigger = { check_variable = { which = expo_industry_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.a.3"
		trigger = { check_variable = { which = expo_industry_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.b.1"
		trigger = { check_variable = { which = expo_industry_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.b.2"
		trigger = { check_variable = { which = expo_industry_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.b.3"
		trigger = { check_variable = { which = expo_industry_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.c.1"
		trigger = { check_variable = { which = expo_industry_gain value = 1 } }
	}
	desc = {
		text = "MECR_EXPO.131.desc.c.2"
		trigger = { check_variable = { which = expo_industry_gain value = 1 } }
	}
	picture = "GFX_evt_cybernetics"
	is_triggered_only = yes
	immediate = {
		set_variable = { which = expo_gain_amount value = expo_industry_gain }
		change_variable = { which = expo_gain_amount value = 1 }
		multiply_variable = { which = expo_gain_amount value = 3 }
		if = {
			limit = {
				any_situation = {
					is_situation_type = situation_galactic_expo
					current_situation_approach = expo_preparing_approach_focus
				}
			}
			random_list = {
				45 = { change_variable = { which = expo_gain_amount value = 1 } }
				35 = { }
				20 = { change_variable = { which = expo_gain_amount value = -1 } }
			}
		}
		else = {
			random_list = {
				25 = { change_variable = { which = expo_gain_amount value = 1 } }
				50 = { }
				25 = { change_variable = { which = expo_gain_amount value = -1 } }
			}
		}
		change_variable = { which = expo_total_result value = expo_gain_amount }
		change_variable = { which = expo_industry_result value = expo_gain_amount }
		multiply_variable = { which = ERROR_LOG_CHECKING__NOTIFICATION_EVENT_IS_OK value = 1 } #error log checking
	}

	option = {
		name = {
			text = "MARVELOUS"
			trigger = { check_variable = { which = expo_industry_gain value = 3 } }
		}
		name = {
			text = "GOOD"
			trigger = { check_variable = { which = expo_industry_gain value = 2 } }
		}
		name = {
			text = "WORRYING"
			trigger = { check_variable = { which = expo_industry_gain value = 1 } }
		}
		add_event_chain_counter = {
			event_chain = "the_galactic_expo"
			counter = "expo_industry_result"
			amount = expo_gain_amount
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_industry_gain
			clear_variable = expo_gain_amount
		}
	}
	
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}
country_event = { #132.工业技术：追加投资[special_project:GLACTIC_EXPO_PREPARE_INDUSTRY:on_progress_50]
	id = MECR_EXPO.132
	title = "MECR_EXPO.132.title"
	desc = "MECR_EXPO.132.desc"
	picture = "GFX_evt_cybernetics"
	is_triggered_only = yes

	immediate = {
		set_variable = {
			which = expo_industry_invest
			value = value:expo_industry_invest
		}
	}

	option = {
		name = "MAKE_IT_SO"
		custom_tooltip = "MECR_EXPO.132.option.tooltip.a"
		allow = {
			custom_tooltip = {
				fail_text = expo_not_enough_alloys
				check_variable = {
					which = expo_industry_invest
					value < value:alloys_stockpile
				}
			}
		}
		add_resource = {
			alloys = -1
			mult = value:expo_industry_invest
		}
		hidden_effect = {
			change_variable = { which = expo_industry_scoring_dices value = 1 }
		}
		ai_chance = {
			factor = 100
		}
	}
	option = {
		name = "TOOPOOR"
		ai_chance = {
			factor = 500
			modifier = {
				factor = 0
				resource_stockpile_compare = {
					resource = alloys
					value > 1000
				}
			}
		}
	}
}

country_event = { #140.考古发现：生成评分(141.)[special_project:GLACTIC_EXPO_PREPARE_ARCHAEOLOGY:on_success]
	id = MECR_EXPO.140
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }
		
		change_variable = { which = expo_archaeology_scoring_dices value = 1 }
		if = { #纪念主义额外+1
			limit = {
				OR = {
					has_valid_civic = civic_memorialist
					has_valid_civic = civic_hive_memorialist
					has_valid_civic = civic_machine_memorialist
				}
			}
			change_variable = { which = expo_archaeology_scoring_dices value = 1 }
		}
		#掷骰
		set_variable = { which = expo_archaeology_gain value = 0 }
		while = {
			count = expo_archaeology_scoring_dices
			reroll_random = yes
			random_list = {
				5 = {
					modifier = { is_ai = yes factor = 0.75 }
					modifier = { add = value:expo_archaeology_advantage }
					set_variable = { which = expo_archaeology_scoring value = 3 }
				}
				5 = {
					set_variable = { which = expo_archaeology_scoring value = 2 }
				}
				7 = {
					modifier = {
						add = 2
						resource_stockpile_compare = { resource = minor_artifacts value = 0 }
					}
					set_variable = { which = expo_archaeology_scoring value = 1 }
				}
			}
			if = {
				limit = { check_variable = { which = expo_archaeology_gain value < expo_archaeology_scoring } }
				set_variable = { which = expo_archaeology_gain value = expo_archaeology_scoring }
			}
		}

		change_variable = { which = expo_archaeology_scoring_boring value = 5 }
		clear_variable = expo_archaeology_scoring
		clear_variable = expo_archaeology_scoring_dices

		if = {
			limit = { NOT = { has_country_flag = flag_expo_archaeology_complete } }
			set_country_flag = flag_expo_archaeology_complete
		}

		multiply_variable = { which = ERROR_LOG_CHECKING__SCORING_EVENT_IS_OK value = 1 } #error log checking
		
		if = {
			limit = { is_ai = yes }
			set_variable = { which = expo_gain_amount value = expo_archaeology_gain }
			change_variable = { which = expo_gain_amount value = 1 }
			multiply_variable = { which = expo_gain_amount value = 3 }
			if = {
				limit = {
					any_situation = {
						is_situation_type = situation_galactic_expo
						current_situation_approach = expo_preparing_approach_focus
					}
				}
				random_list = {
					45 = { change_variable = { which = expo_gain_amount value = 1 } }
					35 = { }
					20 = { change_variable = { which = expo_gain_amount value = -1 } }
				}
			}
			else = {
				random_list = {
					25 = { change_variable = { which = expo_gain_amount value = 1 } }
					50 = { }
					25 = { change_variable = { which = expo_gain_amount value = -1 } }
				}
			}
			change_variable = { which = expo_total_result value = expo_gain_amount }
			change_variable = { which = expo_archaeology_result value = expo_gain_amount }
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_archaeology_result"
				amount = expo_gain_amount
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_archaeology_gain
			clear_variable = expo_gain_amount
			multiply_variable = { which = ERROR_LOG_CHECKING__SCORING_FOR_AI_IS_OK value = 1 } #error log checking
		}
		else = {
			country_event = {
				id = MECR_EXPO.141
				#days = 5 ###
			}
		}
	}
}
country_event = { #141.考古发现：评分结果
	id = MECR_EXPO.141
	title = "MECR_EXPO.141.title"
	desc = {
		text = "MECR_EXPO.141.desc.a.1"
		trigger = { check_variable = { which = expo_archaeology_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.141.desc.a.2"
		trigger = { check_variable = { which = expo_archaeology_gain value = 3 } }
	}
	desc = {
		text = "MECR_EXPO.141.desc.b.1"
		trigger = { check_variable = { which = expo_archaeology_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.141.desc.b.2"
		trigger = { check_variable = { which = expo_archaeology_gain value = 2 } }
	}
	desc = {
		text = "MECR_EXPO.141.desc.c.1"
		trigger = { check_variable = { which = expo_archaeology_gain value = 1 } }
	}
	picture = "GFX_evt_habitable_dig_site"
	is_triggered_only = yes
	immediate = {
		set_variable = { which = expo_gain_amount value = expo_archaeology_gain }
		change_variable = { which = expo_gain_amount value = 1 }
		multiply_variable = { which = expo_gain_amount value = 3 }
		if = {
			limit = {
				any_situation = {
					is_situation_type = situation_galactic_expo
					current_situation_approach = expo_preparing_approach_focus
				}
			}
			random_list = {
				45 = { change_variable = { which = expo_gain_amount value = 1 } }
				35 = { }
				20 = { change_variable = { which = expo_gain_amount value = -1 } }
			}
		}
		else = {
			random_list = {
				25 = { change_variable = { which = expo_gain_amount value = 1 } }
				50 = { }
				25 = { change_variable = { which = expo_gain_amount value = -1 } }
			}
		}
		change_variable = { which = expo_total_result value = expo_gain_amount }
		change_variable = { which = expo_archaeology_result value = expo_gain_amount }
		multiply_variable = { which = ERROR_LOG_CHECKING__NOTIFICATION_EVENT_IS_OK value = 1 } #error log checking
	}

	option = {
		name = {
			text = "FASCINATING"
			trigger = { check_variable = { which = expo_archaeology_gain value = 3 } }
		}
		name = {
			text = "AMAZING"
			trigger = { check_variable = { which = expo_archaeology_gain value = 2 } }
		}
		name = {
			text = "OOPS"
			trigger = { check_variable = { which = expo_archaeology_gain value = 1 } }
		}
		add_event_chain_counter = {
			event_chain = "the_galactic_expo"
			counter = "expo_archaeology_result"
			amount = expo_gain_amount
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_archaeology_gain
			clear_variable = expo_gain_amount
		}
	}
	
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}
country_event = { #142.考古发现：追加投资[special_project:GLACTIC_EXPO_PREPARE_ARCHAEOLOGY:on_progress_25/75]
	id = MECR_EXPO.142
	title = "MECR_EXPO.142.title"
	desc = "MECR_EXPO.142.desc"
	picture = "GFX_evt_habitable_dig_site"
	is_triggered_only = yes

	option = {
		name = "MAKE_IT_SO"
		custom_tooltip = "MECR_EXPO.142.option.tooltip.a"
		trigger = { 
			resource_stockpile_compare = {
				resource = minor_artifacts
				value >= 50
			}
		}
		add_resource = {
			minor_artifacts = -50
		}
		hidden_effect = {
			change_variable = { which = expo_archaeology_scoring_dices value = 1 }
		}
		ai_chance = {
			factor = 100
		}
	}
	option = {
		name = "TOOPOOR"
		ai_chance = {
			factor = 300
			modifier = {
				factor = 0
				resource_stockpile_compare = {
					resource = minor_artifacts
					value > 100
				}
			}
		}
	}
}

country_event = { #150.历史传统：生成评分(151.)[special_project:GLACTIC_EXPO_PREPARE_HISTORY:on_success]
	id = MECR_EXPO.150
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_SCIENCE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_CULTURE }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_INDUSTRY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_ARCHAEOLOGY }
		abort_special_project = { type = GLACTIC_EXPO_PREPARE_HISTORY }

		# 每次展示传统，都会增加一个惩罚骰：展示得越多，人们越会觉得厌倦
		change_variable = { which = expo_history_scoring_dices value = 1 }
		# 掷骰
		set_variable = { which = expo_history_gain value = 3 }
		while = {
			count = expo_history_scoring_dices
			reroll_random = yes
			random_list = {
				6 = {
					modifier = { is_ai = yes factor = 0.75 }
					modifier ={ add = value:expo_history_advantage }
					set_variable = { which = expo_history_scoring value = 3 }
				}
				5 = {
					set_variable = { which = expo_history_scoring value = 2 }
				}
				2 = {
					set_variable = { which = expo_history_scoring value = 1 }
				}
			}
			if = {
				limit = { check_variable = { which = expo_history_gain value > expo_history_scoring } }
				set_variable = { which = expo_history_gain value = expo_history_scoring }
			}
		}
		# 如果得分太差，下次得到额外分数（教训）
		if = {
			limit = { check_variable = { which = expo_history_gain value = 1 } }
			set_variable = { which = expo_history_next_time_bonus value = 8 }
		}
		else_if = {
			limit = { check_variable = { which = expo_history_gain value = 2 } }
			set_variable = { which = expo_history_next_time_bonus value = 4 }
		}
		else = {
			set_variable = { which = expo_history_next_time_bonus value = 0 }
		}

		#不清除 expo_history_scoring_dices 和 expo_history_next_time_bonus
		clear_variable = expo_history_scoring

		if = {
			limit = { NOT = { has_country_flag = flag_expo_history_complete } }
			set_country_flag = flag_expo_history_complete
		}

		multiply_variable = { which = ERROR_LOG_CHECKING__SCORING_EVENT_IS_OK value = 1 } #error log checking
		
		if = {
			limit = { is_ai = yes }
			set_variable = { which = expo_gain_amount value = expo_history_gain }
			change_variable = { which = expo_gain_amount value = 1 }
			multiply_variable = { which = expo_gain_amount value = 3 }
			if = {
				limit = {
					any_situation = {
						is_situation_type = situation_galactic_expo
						current_situation_approach = expo_preparing_approach_focus
					}
				}
				random_list = {
					45 = { change_variable = { which = expo_gain_amount value = 1 } }
					35 = { }
					20 = { change_variable = { which = expo_gain_amount value = -1 } }
				}
			}
			else = {
				random_list = {
					25 = { change_variable = { which = expo_gain_amount value = 1 } }
					50 = { }
					25 = { change_variable = { which = expo_gain_amount value = -1 } }
				}
			}
			change_variable = { which = expo_total_result value = expo_gain_amount }
			change_variable = { which = expo_history_result value = expo_gain_amount }
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_history_result"
				amount = expo_gain_amount
			}
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_history_gain
			clear_variable = expo_gain_amount
			multiply_variable = { which = ERROR_LOG_CHECKING__SCORING_FOR_AI_IS_OK value = 1 } #error log checking
		}
		else = {
			country_event = {
				id = MECR_EXPO.151
				#days = 5 ###
			}
		}
	}
}
country_event = { #151.历史传统：评分结果
	id = MECR_EXPO.151
	title = "MECR_EXPO.151.title"
	desc = {
		text = "MECR_EXPO.151.desc.a.1"
		trigger = {
			check_variable = { which = expo_history_gain value = 3 }
			OR = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
				has_civic = civic_machine_servitor
			}
		}
	}
	desc = {
		text = "MECR_EXPO.151.desc.a.2"
		trigger = {
			check_variable = { which = expo_history_gain value = 3 }
			OR = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
				has_civic = civic_machine_servitor
			}
		}
	}
	desc = {
		text = "MECR_EXPO.151.desc.a.gestalt"
		trigger = {
			check_variable = { which = expo_history_gain value = 3 }
			has_ethic = ethic_gestalt_consciousness
			NOT = { has_civic = civic_machine_servitor }
		}
	}
	desc = {
		text = "MECR_EXPO.151.desc.b.1"
		trigger = {
			check_variable = { which = expo_history_gain value = 2 }
			OR = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
				has_civic = civic_machine_servitor
			}
		}
	}
	desc = {
		text = "MECR_EXPO.151.desc.b.2"
		trigger = {
			check_variable = { which = expo_history_gain value = 2 }
			OR = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
				has_civic = civic_machine_servitor
			}
		}
	}
	desc = {
		text = "MECR_EXPO.151.desc.b.gestalt"
		trigger = {
			check_variable = { which = expo_history_gain value = 2 }
			has_ethic = ethic_gestalt_consciousness
			NOT = { has_civic = civic_machine_servitor }
		}
	}
	desc = {
		text = "MECR_EXPO.151.desc.c.1"
		trigger = { check_variable = { which = expo_history_gain value = 1 } }
	}
	picture = "GFX_evt_tradestation_interior"
	is_triggered_only = yes
	immediate = {
		set_variable = { which = expo_gain_amount value = expo_history_gain }
		change_variable = { which = expo_gain_amount value = 1 }
		multiply_variable = { which = expo_gain_amount value = 3 }
		if = {
			limit = {
				any_situation = {
					is_situation_type = situation_galactic_expo
					current_situation_approach = expo_preparing_approach_focus
				}
			}
			random_list = {
				45 = { change_variable = { which = expo_gain_amount value = 1 } }
				35 = { }
				20 = { change_variable = { which = expo_gain_amount value = -1 } }
			}
		}
		else = {
			random_list = {
				25 = { change_variable = { which = expo_gain_amount value = 1 } }
				50 = { }
				25 = { change_variable = { which = expo_gain_amount value = -1 } }
			}
		}
		change_variable = { which = expo_total_result value = expo_gain_amount }
		change_variable = { which = expo_history_result value = expo_gain_amount }
		multiply_variable = { which = ERROR_LOG_CHECKING__NOTIFICATION_EVENT_IS_OK value = 1 } #error log checking
	}

	option = {
		name = {
			text = "REMARKABLE"
			trigger = { check_variable = { which = expo_history_gain value = 3 } }
		}
		name = {
			text = "GOOD"
			trigger = { check_variable = { which = expo_history_gain value = 2 } }
		}
		name = {
			text = "WORRYING"
			trigger = { check_variable = { which = expo_history_gain value = 1 } }
		}
		add_event_chain_counter = {
			event_chain = "the_galactic_expo"
			counter = "expo_history_result"
			amount = expo_gain_amount
		}
		hidden_effect = {
			add_event_chain_counter = {
				event_chain = "the_galactic_expo"
				counter = "expo_total_result"
				amount = expo_gain_amount
			}
			clear_variable = expo_history_gain
			clear_variable = expo_gain_amount
		}
	}
	
	abort_trigger = {
		has_global_flag = flag_expo_ongoing
	}
}

# 展览阶段开始前，排名
country_event = { #200.【目录】开始排名（300.）(201.202.203.204.205.206.)[100.]
	id = MECR_EXPO.200
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = {
			has_global_flag = debug_expo_ranking_event
		}
	}

	immediate = {
		remove_global_flag = debug_expo_preparation_ends_event
		set_global_flag = debug_expo_ranking_event
		export_trigger_value_to_variable = {
			trigger = count_country
			parameters = { limit = { is_galactic_community_member = yes } }
			variable = expo_ranking_base
		}
		set_variable = { which = expo_ranking_base_good value = expo_ranking_base } #前1/3是好
		divide_variable = { which = expo_ranking_base_good value = 3 }
		set_variable = { which = expo_ranking_base_normal value = expo_ranking_base_good } #前2/3是中，剩下的是差
		multiply_variable = { which = expo_ranking_base_normal value = 2 }
		# 分项目延时排名减少卡顿
		country_event = {
			id = MECR_EXPO.201
		}
		country_event = {
			id = MECR_EXPO.202
		}
		country_event = {
			id = MECR_EXPO.203
			days = 1
		}
		country_event = {
			id = MECR_EXPO.204
			days = 1
		}
		country_event = {
			id = MECR_EXPO.205
			days = 1
		}
		country_event = {
			id = MECR_EXPO.206
			days = 2
		}

		country_event = {
			id = MECR_EXPO.300
			days = 3
		}
	}
}
country_event = { #201.【目录】科学进步展览排名
	id = MECR_EXPO.201
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# 允许并列地对所有参与者的分数进行评级排行
		set_variable = { which = Rexpo_science_counter value = @max_single_exhi_score }
		set_variable = { which = Rexpo_science_ranker value = 1 }
		while = {
			limit = {
				check_variable = { which = Rexpo_science_counter value > 0 }
			}
			if = {
				limit = { any_galcom_member = { check_variable = { which = expo_science_result value = root.Rexpo_science_counter } } }
				every_galcom_member = {
					limit = { check_variable = { which = expo_science_result value = root.Rexpo_science_counter } }
					set_variable = { which = expo_science_ranking value = root.Rexpo_science_ranker }
				}
				change_variable = { which = Rexpo_science_ranker value = 1 }
			}
			subtract_variable = { which = Rexpo_science_counter value = 1 }
		}
		every_galcom_member = {
			limit = { check_variable = { which = expo_science_result value = 0 } }
			set_variable = { which = expo_science_ranking value = 0 }
		}
		# 设置初始排行等级
		set_variable = { which = Rexpo_science_ranker value = 1 }
		set_variable = { which = Rexpo_science_stack value = 0 }
		# 好：在1/3的名额满足之前，整评级地标记为好（即使因为并列导致名额超标）
		while = {
			limit = {
				root = { check_variable = { which = Rexpo_science_stack value < expo_ranking_base_good } }
			}
			every_galcom_member = {
				limit = { check_variable = { which = expo_science_ranking value = root.Rexpo_science_ranker } }
				root = { change_variable = { which = Rexpo_science_stack value = 1 } }
				set_country_flag = flag_expo_science_grade_good
			}
			change_variable = { which = Rexpo_science_ranker value = 1 }
		}
		# 中：在2/3的名额满足之前，整评级地标记为中（即使因为并列导致名额超标）
		while = {
			limit = { root = { check_variable = { which = Rexpo_science_stack value < expo_ranking_base_normal } } }
			every_galcom_member = {
				limit = { check_variable = { which = expo_science_ranking value = root.Rexpo_science_ranker } }
				root = { change_variable = { which = Rexpo_science_stack value = 1 } }
				set_country_flag = flag_expo_science_grade_normal
			}
			change_variable = { which = Rexpo_science_ranker value = 1 }
		}
		# 差：剩下的只要参与了都是差
		every_galcom_member = {
			limit = {
				check_variable = { which = expo_science_result value > 0 }
				NOR = {
					has_country_flag = flag_expo_science_grade_good
					has_country_flag = flag_expo_science_grade_normal
				}
			}
			set_country_flag = flag_expo_science_grade_bad
		}
		# 未参加：分数为0的
		every_galcom_member = {
			limit = { check_variable = { which = expo_science_result value = 0 } }
			set_country_flag = flag_expo_science_grade_no_parti
		}
		# 分配前三名：并列的按物理点产出排行
		find_expo_champion = {
			category = science
			standard = physics_research
		}
		#clear_variable = Rexpo_science_counter
		#clear_variable = Rexpo_science_ranker
		#clear_variable = Rexpo_science_stack
	}
}
country_event = { #202.【目录】文化艺术展览排名
	id = MECR_EXPO.202
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# 允许并列地对所有参与者的分数进行评级排行
		set_variable = { which = Rexpo_culture_counter value = @max_single_exhi_score }
		set_variable = { which = Rexpo_culture_ranker value = 1 }
		while = {
			limit = {
				check_variable = { which = Rexpo_culture_counter value > 0 }
			}
			if = {
				limit = { any_galcom_member = { check_variable = { which = expo_culture_result value = root.Rexpo_culture_counter } } }
				every_galcom_member = {
					limit = { check_variable = { which = expo_culture_result value = root.Rexpo_culture_counter } }
					set_variable = { which = expo_culture_ranking value = root.Rexpo_culture_ranker }
				}
				change_variable = { which = Rexpo_culture_ranker value = 1 }
			}
			subtract_variable = { which = Rexpo_culture_counter value = 1 }
		}
		every_galcom_member = {
			limit = { check_variable = { which = expo_culture_result value = 0 } }
			set_variable = { which = expo_culture_ranking value = 0 }
		}
		# 设置初始排行等级
		set_variable = { which = Rexpo_culture_ranker value = 1 }
		set_variable = { which = Rexpo_culture_stack value = 0 }
		# 好：在1/3的名额满足之前，整评级地标记为好（即使因为并列导致名额超标）
		while = {
			limit = {
				root = { check_variable = { which = Rexpo_culture_stack value < expo_ranking_base_good } }
			}
			every_galcom_member = {
				limit = { check_variable = { which = expo_culture_ranking value = root.Rexpo_culture_ranker } }
				root = { change_variable = { which = Rexpo_culture_stack value = 1 } }
				set_country_flag = flag_expo_culture_grade_good
			}
			change_variable = { which = Rexpo_culture_ranker value = 1 }
		}
		# 中：在2/3的名额满足之前，整评级地标记为中（即使因为并列导致名额超标）
		while = {
			limit = { root = { check_variable = { which = Rexpo_culture_stack value < expo_ranking_base_normal } } }
			every_galcom_member = {
				limit = { check_variable = { which = expo_culture_ranking value = root.Rexpo_culture_ranker } }
				root = { change_variable = { which = Rexpo_culture_stack value = 1 } }
				set_country_flag = flag_expo_culture_grade_normal
			}
			change_variable = { which = Rexpo_culture_ranker value = 1 }
		}
		# 差：剩下的只要参与了都是差
		every_galcom_member = {
			limit = {
				check_variable = { which = expo_culture_result value > 0 }
				NOR = {
					has_country_flag = flag_expo_culture_grade_good
					has_country_flag = flag_expo_culture_grade_normal
				}
			}
			set_country_flag = flag_expo_culture_grade_bad
		}
		# 未参加：分数为0的
		every_galcom_member = {
			limit = { check_variable = { which = expo_culture_result value = 0 } }
			set_country_flag = flag_expo_culture_grade_no_parti
		}
		# 分配前三名：并列的按凝聚力产出排行
		find_expo_champion = {
			category = culture
			standard = unity
		}
		#clear_variable = Rexpo_culture_counter
		#clear_variable = Rexpo_culture_ranker
		#clear_variable = Rexpo_culture_stack
	}
}
country_event = { #203.【目录】工业技术展览排名
	id = MECR_EXPO.203
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# 允许并列地对所有参与者的分数进行评级排行
		set_variable = { which = Rexpo_industry_counter value = @max_single_exhi_score }
		set_variable = { which = Rexpo_industry_ranker value = 1 }
		while = {
			limit = {
				check_variable = { which = Rexpo_industry_counter value > 0 }
			}
			if = {
				limit = { any_galcom_member = { check_variable = { which = expo_industry_result value = root.Rexpo_industry_counter } } }
				every_galcom_member = {
					limit = { check_variable = { which = expo_industry_result value = root.Rexpo_industry_counter } }
					set_variable = { which = expo_industry_ranking value = root.Rexpo_industry_ranker }
				}
				change_variable = { which = Rexpo_industry_ranker value = 1 }
			}
			subtract_variable = { which = Rexpo_industry_counter value = 1 }
		}
		every_galcom_member = {
			limit = { check_variable = { which = expo_industry_result value = 0 } }
			set_variable = { which = expo_industry_ranking value = 0 }
		}
		# 设置初始排行等级
		set_variable = { which = Rexpo_industry_ranker value = 1 }
		set_variable = { which = Rexpo_industry_stack value = 0 }
		# 好：在1/3的名额满足之前，整评级地标记为好（即使因为并列导致名额超标）
		while = {
			limit = {
				root = { check_variable = { which = Rexpo_industry_stack value < expo_ranking_base_good } }
			}
			every_galcom_member = {
				limit = { check_variable = { which = expo_industry_ranking value = root.Rexpo_industry_ranker } }
				root = { change_variable = { which = Rexpo_industry_stack value = 1 } }
				set_country_flag = flag_expo_industry_grade_good
			}
			change_variable = { which = Rexpo_industry_ranker value = 1 }
		}
		# 中：在2/3的名额满足之前，整评级地标记为中（即使因为并列导致名额超标）
		while = {
			limit = { root = { check_variable = { which = Rexpo_industry_stack value < expo_ranking_base_normal } } }
			every_galcom_member = {
				limit = { check_variable = { which = expo_industry_ranking value = root.Rexpo_industry_ranker } }
				root = { change_variable = { which = Rexpo_industry_stack value = 1 } }
				set_country_flag = flag_expo_industry_grade_normal
			}
			change_variable = { which = Rexpo_industry_ranker value = 1 }
		}
		# 差：剩下的只要参与了都是差
		every_galcom_member = {
			limit = {
				check_variable = { which = expo_industry_result value > 0 }
				NOR = {
					has_country_flag = flag_expo_industry_grade_good
					has_country_flag = flag_expo_industry_grade_normal
				}
			}
			set_country_flag = flag_expo_industry_grade_bad
		}
		# 未参加：分数为0的
		every_galcom_member = {
			limit = { check_variable = { which = expo_industry_result value = 0 } }
			set_country_flag = flag_expo_industry_grade_no_parti
		}
		# 分配前三名：并列的按合金产出排行
		find_expo_champion = {
			category = industry
			standard = alloys
		}
		#clear_variable = Rexpo_industry_counter
		#clear_variable = Rexpo_industry_ranker
		#clear_variable = Rexpo_industry_stack
	}
}
country_event = { #204.【目录】考古发现展览排名
	id = MECR_EXPO.204
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# 允许并列地对所有参与者的分数进行评级排行
		set_variable = { which = Rexpo_archaeology_counter value = @max_single_exhi_score }
		set_variable = { which = Rexpo_archaeology_ranker value = 1 }
		while = {
			limit = {
				check_variable = { which = Rexpo_archaeology_counter value > 0 }
			}
			if = {
				limit = { any_galcom_member = { check_variable = { which = expo_archaeology_result value = root.Rexpo_archaeology_counter } } }
				every_galcom_member = {
					limit = { check_variable = { which = expo_archaeology_result value = root.Rexpo_archaeology_counter } }
					set_variable = { which = expo_archaeology_ranking value = root.Rexpo_archaeology_ranker }
				}
				change_variable = { which = Rexpo_archaeology_ranker value = 1 }
			}
			subtract_variable = { which = Rexpo_archaeology_counter value = 1 }
		}
		every_galcom_member = {
			limit = { check_variable = { which = expo_archaeology_result value = 0 } }
			set_variable = { which = expo_archaeology_ranking value = 0 }
		}
		# 设置初始排行等级
		set_variable = { which = Rexpo_archaeology_ranker value = 1 }
		set_variable = { which = Rexpo_archaeology_stack value = 0 }
		# 好：在1/3的名额满足之前，整评级地标记为好（即使因为并列导致名额超标）
		while = {
			limit = {
				root = { check_variable = { which = Rexpo_archaeology_stack value < expo_ranking_base_good } }
			}
			every_galcom_member = {
				limit = { check_variable = { which = expo_archaeology_ranking value = root.Rexpo_archaeology_ranker } }
				root = { change_variable = { which = Rexpo_archaeology_stack value = 1 } }
				set_country_flag = flag_expo_archaeology_grade_good
			}
			change_variable = { which = Rexpo_archaeology_ranker value = 1 }
		}
		# 中：在2/3的名额满足之前，整评级地标记为中（即使因为并列导致名额超标）
		while = {
			limit = { root = { check_variable = { which = Rexpo_archaeology_stack value < expo_ranking_base_normal } } }
			every_galcom_member = {
				limit = { check_variable = { which = expo_archaeology_ranking value = root.Rexpo_archaeology_ranker } }
				root = { change_variable = { which = Rexpo_archaeology_stack value = 1 } }
				set_country_flag = flag_expo_archaeology_grade_normal
			}
			change_variable = { which = Rexpo_archaeology_ranker value = 1 }
		}
		# 差：剩下的只要参与了都是差
		every_galcom_member = {
			limit = {
				check_variable = { which = expo_archaeology_result value > 0 }
				NOR = {
					has_country_flag = flag_expo_archaeology_grade_good
					has_country_flag = flag_expo_archaeology_grade_normal
				}
			}
			set_country_flag = flag_expo_archaeology_grade_bad
		}
		# 未参加：分数为0的
		every_galcom_member = {
			limit = { check_variable = { which = expo_archaeology_result value = 0 } }
			set_country_flag = flag_expo_archaeology_grade_no_parti
		}
		# 分配前三名：并列的按凝聚力产出排行
		find_expo_champion = {
			category = archaeology
			standard = unity
		}
		#clear_variable = Rexpo_archaeology_counter
		#clear_variable = Rexpo_archaeology_ranker
		#clear_variable = Rexpo_archaeology_stack
	}
}
country_event = { #205.【目录】历史传统展览排名
	id = MECR_EXPO.205
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# 允许并列地对所有参与者的分数进行评级排行
		set_variable = { which = Rexpo_history_counter value = @max_single_exhi_score }
		set_variable = { which = Rexpo_history_ranker value = 1 }
		while = {
			limit = {
				check_variable = { which = Rexpo_history_counter value > 0 }
			}
			if = {
				limit = { any_galcom_member = { check_variable = { which = expo_history_result value = root.Rexpo_history_counter } } }
				every_galcom_member = {
					limit = { check_variable = { which = expo_history_result value = root.Rexpo_history_counter } }
					set_variable = { which = expo_history_ranking value = root.Rexpo_history_ranker }
				}
				change_variable = { which = Rexpo_history_ranker value = 1 }
			}
			subtract_variable = { which = Rexpo_history_counter value = 1 }
		}
		every_galcom_member = {
			limit = { check_variable = { which = expo_history_result value = 0 } }
			set_variable = { which = expo_history_ranking value = 0 }
		}
		# 设置初始排行等级
		set_variable = { which = Rexpo_history_ranker value = 1 }
		set_variable = { which = Rexpo_history_stack value = 0 }
		# 好：在1/3的名额满足之前，整评级地标记为好（即使因为并列导致名额超标）
		while = {
			limit = {
				root = { check_variable = { which = Rexpo_history_stack value < expo_ranking_base_good } }
			}
			every_galcom_member = {
				limit = { check_variable = { which = expo_history_ranking value = root.Rexpo_history_ranker } }
				root = { change_variable = { which = Rexpo_history_stack value = 1 } }
				set_country_flag = flag_expo_history_grade_good
			}
			change_variable = { which = Rexpo_history_ranker value = 1 }
		}
		# 中：在2/3的名额满足之前，整评级地标记为中（即使因为并列导致名额超标）
		while = {
			limit = { root = { check_variable = { which = Rexpo_history_stack value < expo_ranking_base_normal } } }
			every_galcom_member = {
				limit = { check_variable = { which = expo_history_ranking value = root.Rexpo_history_ranker } }
				root = { change_variable = { which = Rexpo_history_stack value = 1 } }
				set_country_flag = flag_expo_history_grade_normal
			}
			change_variable = { which = Rexpo_history_ranker value = 1 }
		}
		# 差：剩下的只要参与了都是差
		every_galcom_member = {
			limit = {
				check_variable = { which = expo_history_result value > 0 }
				NOR = {
					has_country_flag = flag_expo_history_grade_good
					has_country_flag = flag_expo_history_grade_normal
				}
			}
			set_country_flag = flag_expo_history_grade_bad
		}
		# 未参加：分数为0的
		every_galcom_member = {
			limit = { check_variable = { which = expo_history_result value = 0 } }
			set_country_flag = flag_expo_history_grade_no_parti
		}
		# 分配前三名：并列的按影响力产出排行
		find_expo_champion = {
			category = history
			standard = influence
		}
		#clear_variable = Rexpo_history_counter
		#clear_variable = Rexpo_history_ranker
		#clear_variable = Rexpo_history_stack
	}
}
country_event = { #206.【目录】总分排名
	id = MECR_EXPO.206
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# 允许并列地对所有参与者的分数进行评级排行
		set_variable = { which = Rexpo_total_counter value = @max_total_exhi_score }
		set_variable = { which = Rexpo_total_ranker value = 1 }
		while = {
			limit = {
				check_variable = { which = Rexpo_total_counter value > 0 }
			}
			if = {
				limit = { any_galcom_member = { check_variable = { which = expo_total_result value = root.Rexpo_total_counter } } }
				every_galcom_member = {
					limit = { check_variable = { which = expo_total_result value = root.Rexpo_total_counter } }
					set_variable = { which = expo_total_ranking value = root.Rexpo_total_ranker }
				}
				change_variable = { which = Rexpo_total_ranker value = 1 }
			}
			subtract_variable = { which = Rexpo_total_counter value = 1 }
		}
		# 设置初始排行等级
		set_variable = { which = Rexpo_total_ranker value = 1 }
		set_variable = { which = Rexpo_total_stack value = 0 }
		# 好：在1/3的名额满足之前，整评级地标记为好（即使因为并列导致名额超标）
		while = {
			limit = {
				root = { check_variable = { which = Rexpo_total_stack value < expo_ranking_base_good } }
			}
			every_galcom_member = {
				limit = { check_variable = { which = expo_total_ranking value = root.Rexpo_total_ranker } }
				root = { change_variable = { which = Rexpo_total_stack value = 1 } }
				set_country_flag = flag_expo_total_grade_good
			}
			change_variable = { which = Rexpo_total_ranker value = 1 }
		}
		every_galcom_member = {
			limit = { check_variable = { which = expo_total_result value = 0 } }
			set_variable = { which = expo_total_ranking value = 0 }
		}
		# 中：在2/3的名额满足之前，整评级地标记为中（即使因为并列导致名额超标）
		while = {
			limit = { root = { check_variable = { which = Rexpo_total_stack value < expo_ranking_base_normal } } }
			every_galcom_member = {
				limit = { check_variable = { which = expo_total_ranking value = root.Rexpo_total_ranker } }
				root = { change_variable = { which = Rexpo_total_stack value = 1 } }
				set_country_flag = flag_expo_total_grade_normal
			}
			change_variable = { which = Rexpo_total_ranker value = 1 }
		}
		# 差：剩下的只要参与了都是差
		every_galcom_member = {
			limit = {
				check_variable = { which = expo_total_result value > 0 }
				NOR = {
					has_country_flag = flag_expo_total_grade_good
					has_country_flag = flag_expo_total_grade_normal
				}
			}
			set_country_flag = flag_expo_total_grade_bad
		}
		# 未参加：分数为0的
		every_galcom_member = {
			limit = { check_variable = { which = expo_total_result value = 0 } }
			set_country_flag = flag_expo_total_grade_no_parti
		}
		# 分配前三名：并列的按外交权重排行
		find_expo_champion_diplo_weight = {
			category = total
		}
		#clear_variable = Rexpo_total_counter
		#clear_variable = Rexpo_total_ranker
		#clear_variable = Rexpo_total_stack
	}
}

# 展览阶段
country_event = { #300.【目录】开幕：设置艺术团访问，解锁并校准时间表（390.400.）(301.)
	id = MECR_EXPO.300
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = {
			has_global_flag = debug_expo_openning_event
		}
	}

	immediate = {
		remove_global_flag = debug_expo_ranking_event
		set_global_flag = debug_expo_openning_event
		# 艺术团的设置
		if = {
			limit = {
				any_country = { has_country_flag = artist_enclave_country }
			}
			random_country = {
				limit = { has_country_flag = artist_enclave_country }
				save_global_event_target_as = expo_artists
			}
		}
		if = {
			limit = { exists = event_target:expo_artists }
			country_event = {
				id = MECR_EXPO.390
				days = @expo_artists_wait_days
				random = @expo_artists_wait_random
			}
		}

		set_timed_global_flag = {
			flag = flag_expo_ongoing
			days = @expo_ongoing_timer
		}
		every_galcom_member = {
			if = {
				limit = { NOT = { any_situation = { is_situation_type = situation_galactic_expo } } }
				start_situation = { type = situation_galactic_expo target = This }
			}
			random_situation = {
				limit = { is_situation_type = situation_galactic_expo }
				set_situation_locked = no
				remove_situation_flag = flag_expo_situation_paused
				
				export_trigger_value_to_variable = { trigger = situation_progress variable = situation_progress_var }
				multiply_variable = { which = situation_progress_var value = -1 }
				add_situation_progress = situation_progress_var
				add_situation_progress = 92.4
			}
			#expo_situation_set_progress = { progress = 92.4 }
			#expo_situation_continue = yes
			country_event = {
				id = MECR_EXPO.301
			}
		}
		country_event = {
			id = MECR_EXPO.400
			days = @expo_ongoing_timer
		}
	}
}
country_event = { #301.开幕式：结束准备事件链，启用展览事件链，启用改善展览计划，选择参展目的(370.380.)
	id = MECR_EXPO.301
	title = "MECR_EXPO.301.title"
	desc = "MECR_EXPO.301.desc"
	picture = GFX_evt_diplomatic_visit
	show_sound = event_celebration
	is_triggered_only = yes

	immediate = {
		end_event_chain = the_galactic_expo
		begin_event_chain = {
			event_chain = the_galactic_expo_ongoing
			target = root
		}
		if = {
			limit = { is_ai = no }
			enable_special_project = { name = GLACTIC_EXPO_SCIENCE_ON_EXHI location = capital_scope }
			enable_special_project = { name = GLACTIC_EXPO_CULTURE_ON_EXHI location = capital_scope }
			enable_special_project = { name = GLACTIC_EXPO_INDUSTRY_ON_EXHI location = capital_scope }
			enable_special_project = { name = GLACTIC_EXPO_ARCHAEOLOGY_ON_EXHI location = capital_scope }
			enable_special_project = { name = GLACTIC_EXPO_HISTORY_ON_EXHI location = capital_scope }
		}
		else = {
			random_list = {
				100 = {
					modifier = { mult = 0.5 has_country_flag = flag_expo_science_grade_bad }
					modifier = { mult = 0.2 has_country_flag = flag_expo_science_grade_normal }
					modifier = { mult = 0 has_country_flag = flag_expo_science_grade_good }
					country_event = { id = MECR_EXPO.311 }
				}
				100 = {
					modifier = { mult = 0.5 has_country_flag = flag_expo_culture_grade_bad }
					modifier = { mult = 0.2 has_country_flag = flag_expo_culture_grade_normal }
					modifier = { mult = 0 has_country_flag = flag_expo_culture_grade_good }
					country_event = { id = MECR_EXPO.312 }
				}
				100 = {
					modifier = { mult = 0.5 has_country_flag = flag_expo_industry_grade_bad }
					modifier = { mult = 0.2 has_country_flag = flag_expo_industry_grade_normal }
					modifier = { mult = 0 has_country_flag = flag_expo_industry_grade_good }
					country_event = { id = MECR_EXPO.313 }
				}
				100 = {
					modifier = { mult = 0.5 has_country_flag = flag_expo_archaeology_grade_bad }
					modifier = { mult = 0.2 has_country_flag = flag_expo_archaeology_grade_normal }
					modifier = { mult = 0 has_country_flag = flag_expo_archaeology_grade_good }
					country_event = { id = MECR_EXPO.314 }
				}
				100 = {
					modifier = { mult = 0.5 has_country_flag = flag_expo_history_grade_bad }
					modifier = { mult = 0.2 has_country_flag = flag_expo_history_grade_normal }
					modifier = { mult = 0 has_country_flag = flag_expo_history_grade_good }
					country_event = { id = MECR_EXPO.315 }
				}
			}
		}
		# 清除排行参数
		clear_variable = expo_ranking_base
		clear_variable = expo_ranking_base_good
		clear_variable = expo_ranking_base_normal
		# 触发城邦访问事件
		if = {
			limit = { exists = event_target:expo_sponsor }
			if = {
				limit = { NOT = { has_communications = event_target:expo_sponsor } }
				establish_communications = event_target:expo_sponsor
			}
			country_event = {
				id = MECR_EXPO.370
				days = @expo_sponsor_wait_days
				random = @expo_sponsor_wait_random
			}
		}
		if = {
			limit = { exists = event_target:expo_curators }
			if = {
				limit = { NOT = { has_communications = event_target:expo_curators } }
				establish_communications = event_target:expo_curators
			}
			country_event = {
				id = MECR_EXPO.380
				days = @expo_curators_wait_days
				random = @expo_curators_wait_random
			}
		}
	}

	option = {
		name = "MECR_EXPO.301.option.a"
		add_modifier = { modifier = expo_ongoing_happiness days = @expo_ongoing_timer }
		add_monthly_resource_mult = { resource = unity value = 1 }
		trigger = {
			OR = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
				has_civic = civic_machine_servitor
			}
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 1.5
				is_xenophile = yes
			}
			modifier = {
				factor = 1.5
				is_pacifist = yes
			}
			modifier = {
				factor = 0.5
				is_xenophobe = yes
			}
			modifier = {
				factor = 0.5
				is_militarist = yes
			}
			modifier = {
				factor = 2
				has_civic = civic_machine_servitor
			}
		}
	}
	option = {
		name = "MECR_EXPO.301.option.a.gestalt"
		add_modifier = { modifier = expo_ongoing_upkeep days = @expo_ongoing_timer }
		add_monthly_resource_mult = { resource = unity value = 1 }
		trigger = {
			has_ethic = ethic_gestalt_consciousness
			NOT = {
				has_civic = civic_machine_servitor
			}
		}
		ai_chance = {
			factor = 200
		}
	}
	option = {
		name = "MECR_EXPO.301.option.b"
		add_modifier = { modifier = expo_ongoing_diplomacy days = @expo_ongoing_timer }
		add_monthly_resource_mult = { resource = influence value = 1 }
		ai_chance = {
			factor = 100
			modifier = {
				factor = 1.5
				is_xenophobe = yes
			}
			modifier = {
				factor = 1.5
				is_militarist = yes
			}
			modifier = {
				factor = 0.5
				is_xenophile = yes
			}
			modifier = {
				factor = 0.5
				is_pacifist = yes
			}
		}
	}
	after = {
		tooltip = {
			end_event_chain = the_galactic_expo
			begin_event_chain = {
				event_chain = the_galactic_expo_ongoing
				target = root
			}
		}
	}
}

country_event = { #311.改善科学进步展览[special_project:GLACTIC_EXPO_SCIENCE_ON_EXHI:on_success]
	id = MECR_EXPO.311
	title = "MECR_EXPO.311.title"
	desc = {
		text = "MECR_EXPO.311.desc.a"
		trigger = { has_country_flag = flag_expo_science_grade_good }
	}
	desc = {
		text = "MECR_EXPO.311.desc.b"
		trigger = { has_country_flag = flag_expo_science_grade_normal }
	}
	desc = {
		text = "MECR_EXPO.311.desc.c"
		trigger = { has_country_flag = flag_expo_science_grade_bad }
	}
	desc = {
		text = "MECR_EXPO.311.desc.d"
		trigger = { has_country_flag = flag_expo_science_grade_no_parti }
	}
	picture = GFX_evt_galactic_market
	is_triggered_only = yes

	immediate = {
	}
	option = {
		name = "REMARKABLE"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_science_grade_normal }
		hidden_effect = {
			remove_country_flag = flag_expo_science_grade_normal
			set_country_flag = flag_expo_science_grade_good
		}
	}
	option = {
		name = "GOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_science_grade_bad }
		hidden_effect = {
			remove_country_flag = flag_expo_science_grade_bad
			set_country_flag = flag_expo_science_grade_normal
		}
	}
	option = {
		name = "UNDERSTOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_science_grade_no_parti }
		hidden_effect = {
			remove_country_flag = flag_expo_science_grade_no_parti
			set_country_flag = flag_expo_science_grade_bad
		}
	}
	option = {
		name = "OK"
		add_resource = { influence = 50 }
		default_hide_option = yes
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
}
country_event = { #312.改善文化艺术展览[special_project:GLACTIC_EXPO_CULTURE_ON_EXHI:on_success]
	id = MECR_EXPO.312
	title = "MECR_EXPO.312.title"
	desc = {
		text = "MECR_EXPO.312.desc.a"
		trigger = { has_country_flag = flag_expo_culture_grade_good }
	}
	desc = {
		text = "MECR_EXPO.312.desc.b"
		trigger = { has_country_flag = flag_expo_culture_grade_normal }
	}
	desc = {
		text = "MECR_EXPO.312.desc.c"
		trigger = { has_country_flag = flag_expo_culture_grade_bad }
	}
	desc = {
		text = "MECR_EXPO.312.desc.d"
		trigger = { has_country_flag = flag_expo_culture_grade_no_parti }
	}
	picture = GFX_evt_galactic_market
	is_triggered_only = yes

	immediate = {
	}
	option = {
		name = "REMARKABLE"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_culture_grade_normal }
		hidden_effect = {
			remove_country_flag = flag_expo_culture_grade_normal
			set_country_flag = flag_expo_culture_grade_good
		}
	}
	option = {
		name = "GOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_culture_grade_bad }
		hidden_effect = {
			remove_country_flag = flag_expo_culture_grade_bad
			set_country_flag = flag_expo_culture_grade_normal
		}
	}
	option = {
		name = "UNDERSTOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_culture_grade_no_parti }
		hidden_effect = {
			remove_country_flag = flag_expo_culture_grade_no_parti
			set_country_flag = flag_expo_culture_grade_bad
		}
	}
	option = {
		name = "OK"
		add_resource = { influence = 50 }
		default_hide_option = yes
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
}
country_event = { #313.改善工业技术展览[special_project:GLACTIC_EXPO_INDUSTRY_ON_EXHI:on_success]
	id = MECR_EXPO.313
	title = "MECR_EXPO.313.title"
	desc = {
		text = "MECR_EXPO.313.desc.a"
		trigger = { has_country_flag = flag_expo_industry_grade_good }
	}
	desc = {
		text = "MECR_EXPO.313.desc.b"
		trigger = { has_country_flag = flag_expo_industry_grade_normal }
	}
	desc = {
		text = "MECR_EXPO.313.desc.c"
		trigger = { has_country_flag = flag_expo_industry_grade_bad }
	}
	desc = {
		text = "MECR_EXPO.313.desc.d"
		trigger = { has_country_flag = flag_expo_industry_grade_no_parti }
	}
	picture = GFX_evt_galactic_market
	is_triggered_only = yes

	immediate = {
	}
	option = {
		name = "REMARKABLE"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_industry_grade_normal }
		hidden_effect = {
			remove_country_flag = flag_expo_industry_grade_normal
			set_country_flag = flag_expo_industry_grade_good
		}
	}
	option = {
		name = "GOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_industry_grade_bad }
		hidden_effect = {
			remove_country_flag = flag_expo_industry_grade_bad
			set_country_flag = flag_expo_industry_grade_normal
		}
	}
	option = {
		name = "UNDERSTOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_industry_grade_no_parti }
		hidden_effect = {
			remove_country_flag = flag_expo_industry_grade_no_parti
			set_country_flag = flag_expo_industry_grade_bad
		}
	}
	option = {
		name = "OK"
		add_resource = { influence = 50 }
		default_hide_option = yes
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
}
country_event = { #314.改善考古发现展览[special_project:GLACTIC_EXPO_ARCHAEOLOGY_ON_EXHI:on_success]
	id = MECR_EXPO.314
	title = "MECR_EXPO.314.title"
	desc = {
		text = "MECR_EXPO.314.desc.a"
		trigger = { has_country_flag = flag_expo_archaeology_grade_good }
	}
	desc = {
		text = "MECR_EXPO.314.desc.b"
		trigger = { has_country_flag = flag_expo_archaeology_grade_normal }
	}
	desc = {
		text = "MECR_EXPO.314.desc.c"
		trigger = { has_country_flag = flag_expo_archaeology_grade_bad }
	}
	desc = {
		text = "MECR_EXPO.314.desc.d"
		trigger = { has_country_flag = flag_expo_archaeology_grade_no_parti }
	}
	picture = GFX_evt_galactic_market
	is_triggered_only = yes

	immediate = {
	}
	option = {
		name = "REMARKABLE"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_archaeology_grade_normal }
		hidden_effect = {
			remove_country_flag = flag_expo_archaeology_grade_normal
			set_country_flag = flag_expo_archaeology_grade_good
		}
	}
	option = {
		name = "GOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_archaeology_grade_bad }
		hidden_effect = {
			remove_country_flag = flag_expo_archaeology_grade_bad
			set_country_flag = flag_expo_archaeology_grade_normal
		}
	}
	option = {
		name = "UNDERSTOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_archaeology_grade_no_parti }
		hidden_effect = {
			remove_country_flag = flag_expo_archaeology_grade_no_parti
			set_country_flag = flag_expo_archaeology_grade_bad
		}
	}
	option = {
		name = "OK"
		add_resource = { influence = 50 }
		default_hide_option = yes
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
}
country_event = { #315.改善历史传统展览[special_project:GLACTIC_EXPO_HISTORY_ON_EXHI:on_success]
	id = MECR_EXPO.315
	title = "MECR_EXPO.315.title"
	desc = {
		text = "MECR_EXPO.315.desc.a"
		trigger = { has_country_flag = flag_expo_history_grade_good }
	}
	desc = {
		text = "MECR_EXPO.315.desc.b"
		trigger = { has_country_flag = flag_expo_history_grade_normal }
	}
	desc = {
		text = "MECR_EXPO.315.desc.c"
		trigger = { has_country_flag = flag_expo_history_grade_bad }
	}
	desc = {
		text = "MECR_EXPO.315.desc.d"
		trigger = { has_country_flag = flag_expo_history_grade_no_parti }
	}
	picture = GFX_evt_galactic_market
	is_triggered_only = yes

	immediate = {
	}
	option = {
		name = "REMARKABLE"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_history_grade_normal }
		hidden_effect = {
			remove_country_flag = flag_expo_history_grade_normal
			set_country_flag = flag_expo_history_grade_good
		}
	}
	option = {
		name = "GOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_history_grade_bad }
		hidden_effect = {
			remove_country_flag = flag_expo_history_grade_bad
			set_country_flag = flag_expo_history_grade_normal
		}
	}
	option = {
		name = "UNDERSTOOD"
		custom_tooltip = "improve_appraisal_tooltip"
		exclusive_trigger = { has_country_flag = flag_expo_history_grade_no_parti }
		hidden_effect = {
			remove_country_flag = flag_expo_history_grade_no_parti
			set_country_flag = flag_expo_history_grade_bad
		}
	}
	option = {
		name = "OK"
		add_resource = { influence = 50 }
		default_hide_option = yes
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
}

situation_event = { #320.银博会进行中每月进行交流，根据参展策略与其他相同策略的参与者交流[situation:situation_galactic_expo:on_monthly]
	id = MECR_EXPO.320
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = flag_expo_ongoing
		OR = {
			current_situation_approach = expo_ongoing_approach_scientific_exchange
			current_situation_approach = expo_ongoing_approach_cultural_exchange
			current_situation_approach = expo_ongoing_approach_economic_exchange
			current_situation_approach = expo_ongoing_approach_economic_exchange_gestalt
		}
	}

	immediate = {
		hidden_effect = {
			switch = {
				trigger = current_situation_approach
				expo_ongoing_approach_scientific_exchange = {
					if = {
						limit = {
							any_galcom_member = {
								NOT = { is_same_value = root.owner }
								any_situation = {
									is_situation_type = situation_galactic_expo
									current_situation_approach = expo_ongoing_approach_scientific_exchange
								}
							}
						}
						random_galcom_member = {
							limit = {
								NOT = { is_same_value = root.owner }
								any_situation = {
									is_situation_type = situation_galactic_expo
									current_situation_approach = expo_ongoing_approach_scientific_exchange
								}
							}
							root.owner = {
								set_variable = { which = expo_exchange_physics_research_get value = prev.value:physics_income_0_45 }
								if = {
									limit = { resource_income_compare = { resource = physics_research value > expo_exchange_physics_research_get } }
									add_resource = { physics_research = 0.33 multiplier = expo_exchange_physics_research_get }
								}
								else = {
									add_monthly_resource_mult = { resource = physics_research value = 0.33 }
								}
								set_variable = { which = expo_exchange_society_research_get value = prev.value:society_income_0_45 }
								if = {
									limit = { resource_income_compare = { resource = society_research value > expo_exchange_society_research_get } }
									add_resource = { society_research = 0.33 multiplier = expo_exchange_society_research_get }
								}
								else = {
									add_monthly_resource_mult = { resource = society_research value = 0.33 }
								}
								set_variable = { which = expo_exchange_engineering_research_get value = prev.value:engineering_income_0_45 }
								if = {
									limit = { resource_income_compare = { resource = engineering_research value > expo_exchange_engineering_research_get } }
									add_resource = { engineering_research = 0.33 multiplier = expo_exchange_engineering_research_get }
								}
								else = {
									add_monthly_resource_mult = { resource = engineering_research value = 0.33 }
								}
							}
						}
					}
					else = {
						random_galcom_member = {
							limit = {
								NOT = { is_same_value = root.owner }
							}
							root.owner = {
								set_variable = { which = expo_exchange_physics_research_get value = prev.value:physics_income_0_45 }
								if = {
									limit = { resource_income_compare = { resource = physics_research value > expo_exchange_physics_research_get } }
									add_resource = { physics_research = 0.33 multiplier = expo_exchange_physics_research_get }
								}
								else = {
									add_monthly_resource_mult = { resource = physics_research value = 0.33 }
								}
								set_variable = { which = expo_exchange_society_research_get value = prev.value:society_income_0_45 }
								if = {
									limit = { resource_income_compare = { resource = society_research value > expo_exchange_society_research_get } }
									add_resource = { society_research = 0.33 multiplier = expo_exchange_society_research_get }
								}
								else = {
									add_monthly_resource_mult = { resource = society_research value = 0.33 }
								}
								set_variable = { which = expo_exchange_engineering_research_get value = prev.value:engineering_income_0_45 }
								if = {
									limit = { resource_income_compare = { resource = engineering_research value > expo_exchange_engineering_research_get } }
									add_resource = { engineering_research = 0.33 multiplier = expo_exchange_engineering_research_get }
								}
								else = {
									add_monthly_resource_mult = { resource = engineering_research value = 0.33 }
								}
							}
						}
					}
					every_galcom_member = {
						limit = {
							NOT = { is_same_value = root.owner }
							any_situation = {
								is_situation_type = situation_galactic_expo
								current_situation_approach = expo_ongoing_approach_scientific_exchange
							}
							NOT = { has_country_flag = flag_expo_exchange_intel_technology_to_@root.owner }
						}
						root.owner = {
							random_list = {
								30 = { add_intel_report = { category = technology level = 1 who = prev } }
								40 = { add_intel_report = { category = technology level = 2 who = prev } }
								20 = { add_intel_report = { category = technology level = 3 who = prev } }
								10 = { add_intel_report = { category = technology level = 4 who = prev } }
							}
						}
						set_timed_country_flag = {
							flag = flag_expo_exchange_intel_technology_to_@root.owner
							days = 720
						}
					}
				}
				expo_ongoing_approach_cultural_exchange = {
					if = {
						limit = {
							any_galcom_member = {
								NOT = { is_same_value = root.owner }
								any_situation = {
									is_situation_type = situation_galactic_expo
									current_situation_approach = expo_ongoing_approach_cultural_exchange
								}
							}
						}
						random_galcom_member = {
							limit = {
								NOT = { is_same_value = root.owner }
								any_situation = {
									is_situation_type = situation_galactic_expo
									current_situation_approach = expo_ongoing_approach_cultural_exchange
								}
							}
							root.owner = {
								set_variable = { which = expo_exchange_unity_get value = prev.value:unity_income }
								random_list = {
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.300 } }
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.375 } }
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.450 } }
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.525 } }
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.600 } }
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.675 } }
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.750 } }
								}
								if = {
									limit = { resource_income_compare = { resource = unity value > expo_exchange_unity_get } }
									add_resource = { unity = 0.33 multiplier = expo_exchange_unity_get }
								}
								else = {
									add_monthly_resource_mult = { resource = unity value = 0.33 }
								}
							}
						}
					}
					else = {
						random_galcom_member = {
							limit = {
								NOT = { is_same_value = root.owner }
							}
							root.owner = {
								set_variable = { which = expo_exchange_unity_get value = prev.value:unity_income }
								random_list = {
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.300 } }
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.375 } }
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.450 } }
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.525 } }
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.600 } }
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.675 } }
									10 = { multiply_variable = { which = expo_exchange_unity_get value = 0.750 } }
								}
								if = {
									limit = { resource_income_compare = { resource = unity value > expo_exchange_unity_get } }
									add_resource = { unity = 0.33 multiplier = expo_exchange_unity_get }
								}
								else = {
									add_monthly_resource_mult = { resource = unity value = 0.33 }
								}
							}
						}
					}
					every_galcom_member = {
						limit = {
							NOT = { is_same_value = root.owner }
							any_situation = {
								is_situation_type = situation_galactic_expo
								current_situation_approach = expo_ongoing_approach_cultural_exchange
							}
							NOT = { has_country_flag = flag_expo_exchange_intel_government_to_@root.owner }
						}
						root.owner = {
							random_list = {
								30 = { add_intel_report = { category = government level = 1 who = prev } }
								40 = { add_intel_report = { category = government level = 2 who = prev } }
								20 = { add_intel_report = { category = government level = 3 who = prev } }
								10 = { add_intel_report = { category = government level = 4 who = prev } }
							}
						}
						set_timed_country_flag = {
							flag = flag_expo_exchange_intel_government_to_@root.owner
							days = 720
						}
					}
				}
				expo_ongoing_approach_economic_exchange = {
					if = {
						limit = {
							any_galcom_member = {
								NOT = { is_same_value = root.owner }
								any_situation = {
									is_situation_type = situation_galactic_expo
									OR = {
										current_situation_approach = expo_ongoing_approach_economic_exchange
										current_situation_approach = expo_ongoing_approach_economic_exchange_gestalt
									}
								}
							}
						}
						random_galcom_member = {
							limit = {
								NOT = { is_same_value = root.owner }
								any_situation = {
									is_situation_type = situation_galactic_expo
									OR = {
										current_situation_approach = expo_ongoing_approach_economic_exchange
										current_situation_approach = expo_ongoing_approach_economic_exchange_gestalt
									}
								}
							}
							random_owned_planet = {
								limit = { NOT = { has_modifier = planet_modifier_expo_economic_exchange } }
								add_modifier = {
									modifier = planet_modifier_expo_economic_exchange
									days = 360
								}
							}
							root.owner = {
								random_owned_planet = {
									limit = { NOT = { has_modifier = planet_modifier_expo_economic_exchange } }
									add_modifier = {
										modifier = planet_modifier_expo_economic_exchange
										days = 360
									}
								}
							}
						}
					}
					else = {
						root.owner = {
							random_owned_planet = {
								limit = { NOT = { has_modifier = planet_modifier_expo_economic_exchange } }
								add_modifier = {
									modifier = planet_modifier_expo_economic_exchange
									days = 360
								}
							}
						}
					}
					every_galcom_member = {
						limit = {
							NOT = { is_same_value = root.owner }
							any_situation = {
								is_situation_type = situation_galactic_expo
								OR = {
									current_situation_approach = expo_ongoing_approach_economic_exchange
									current_situation_approach = expo_ongoing_approach_economic_exchange_gestalt
								}
							}
							NOT = { has_country_flag = flag_expo_exchange_intel_economy_to_@root.owner }
						}
						root.owner = {
							random_list = {
								30 = { add_intel_report = { category = economy level = 1 who = prev } }
								40 = { add_intel_report = { category = economy level = 2 who = prev } }
								20 = { add_intel_report = { category = economy level = 3 who = prev } }
								10 = { add_intel_report = { category = economy level = 4 who = prev } }
							}
						}
						set_timed_country_flag = {
							flag = flag_expo_exchange_intel_economy_to_@root.owner
							days = 720
						}
					}
				}
				expo_ongoing_approach_economic_exchange_gestalt = {
					if = {
						limit = {
							any_galcom_member = {
								NOT = { is_same_value = root.owner }
								any_situation = {
									is_situation_type = situation_galactic_expo
									OR = {
										current_situation_approach = expo_ongoing_approach_economic_exchange
										current_situation_approach = expo_ongoing_approach_economic_exchange_gestalt
									}
								}
							}
						}
						random_galcom_member = {
							limit = {
								NOT = { is_same_value = root.owner }
								any_situation = {
									is_situation_type = situation_galactic_expo
									OR = {
										current_situation_approach = expo_ongoing_approach_economic_exchange
										current_situation_approach = expo_ongoing_approach_economic_exchange_gestalt
									}
								}
							}
							random_owned_planet = {
								limit = { NOT = { has_modifier = planet_modifier_expo_economic_exchange } }
								add_modifier = {
									modifier = planet_modifier_expo_economic_exchange
									days = 360
								}
							}
							root.owner = {
								random_owned_planet = {
									limit = { NOT = { has_modifier = planet_modifier_expo_economic_exchange } }
									add_modifier = {
										modifier = planet_modifier_expo_economic_exchange
										days = 360
									}
								}
							}
						}
					}
					else = {
						root.owner = {
							random_owned_planet = {
								limit = { NOT = { has_modifier = planet_modifier_expo_economic_exchange } }
								add_modifier = {
									modifier = planet_modifier_expo_economic_exchange
									days = 360
								}
							}
						}
					}
					every_galcom_member = {
						limit = {
							NOT = { is_same_value = root.owner }
							any_situation = {
								is_situation_type = situation_galactic_expo
								OR = {
									current_situation_approach = expo_ongoing_approach_economic_exchange
									current_situation_approach = expo_ongoing_approach_economic_exchange_gestalt
								}
							}
							NOT = { has_country_flag = flag_expo_exchange_intel_economy_to_@root.owner }
						}
						root.owner = {
							random_list = {
								30 = { add_intel_report = { category = economy level = 1 who = prev } }
								40 = { add_intel_report = { category = economy level = 2 who = prev } }
								20 = { add_intel_report = { category = economy level = 3 who = prev } }
								10 = { add_intel_report = { category = economy level = 4 who = prev } }
							}
						}
						set_timed_country_flag = {
							flag = flag_expo_exchange_intel_economy_to_@root.owner
							days = 720
						}
					}
				}
			}
		}
	}
}

country_event = { #370.贸易城邦赞助商的推销(371.)[301.]
	id = MECR_EXPO.370
	title = "MECR_EXPO.370.title"
	desc = {
		text = "MECR_EXPO.370.desc.xura"
		trigger = {
			event_target:expo_sponsor = {
				has_country_flag = trader_enclave_country_1
			}
		}
	}
	desc = {
		text = "MECR_EXPO.370.desc.riggan"
		trigger = {
			event_target:expo_sponsor = {
				has_country_flag = trader_enclave_country_2
			}
		}
	}
	desc = {
		text = "MECR_EXPO.370.desc.muutagan"
		trigger = {
			event_target:expo_sponsor = {
				has_country_flag = trader_enclave_country_3
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	picture_event_data = {
		portrait = event_target:expo_sponsor
		room = enclave_trader_room
	}

	trigger = {
		NOR = {
			AND = {
				has_country_flag = attacked_xuracorp
				event_target:expo_sponsor = { has_country_flag = trader_enclave_country_1 }
			}
			AND = {
				has_country_flag = attacked_riggans
				event_target:expo_sponsor = { has_country_flag = trader_enclave_country_2 }
			}
			AND = {
				has_country_flag = attacked_muutagans
				event_target:expo_sponsor = { has_country_flag = trader_enclave_country_3 }
			}
		}
	}

	option = { # +1000
		name = "MECR_EXPO.370.buy_1000"
		custom_gui = "enclave_trader_option"
		allow = { resource_stockpile_compare = { resource = energy value >= 13000 } }
		event_target:expo_sponsor = {
			switch = {
				trigger = has_country_flag
				trader_enclave_country_1 = {
					root = {
						add_resource = {
							energy = -13000
							exotic_gases = 1000
						}
					}
				}
				trader_enclave_country_2 = {
					root = {
						add_resource = {
							energy = -13000
							volatile_motes = 1000
						}
					}
				}
				trader_enclave_country_3 = {
					root = {
						add_resource = {
							energy = -13000
							rare_crystals = 1000
						}
					}
				}
			}
			add_trust = {
				who = root
				amount = 20
			}
		}
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.371
			}
			event_target:expo_organiser = {
				add_resource = { energy = 1000 }
				create_message = {
					type = MESSAGE_TYPE_EXPO_SPONSOR_BONUS
					localization = "MESSAGE_TYPE_EXPO_SPONSOR_BONUS_DESC_1000"
					days = 30
					target = capital_scope
				}
			}
		}
	}
	option = { # +500
		name = "MECR_EXPO.370.buy_500"
		custom_gui = "enclave_trader_option"
		allow = { resource_stockpile_compare = { resource = energy value >= 6750 } }
		event_target:expo_sponsor = {
			switch = {
				trigger = has_country_flag
				trader_enclave_country_1 = {
					root = {
						add_resource = {
							energy = -6750
							exotic_gases = 500
						}
					}
				}
				trader_enclave_country_2 = {
					root = {
						add_resource = {
							energy = -6750
							volatile_motes = 500
						}
					}
				}
				trader_enclave_country_3 = {
					root = {
						add_resource = {
							energy = -6750
							rare_crystals = 500
						}
					}
				}
			}
			add_trust = {
				who = root
				amount = 10
			}
		}
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.371
			}
			event_target:expo_organiser = {
				add_resource = { energy = 500 }
				create_message = {
					type = MESSAGE_TYPE_EXPO_SPONSOR_BONUS
					localization = "MESSAGE_TYPE_EXPO_SPONSOR_BONUS_DESC_500"
					days = 30
					target = capital_scope
				}
			}
		}
	}
	option = { # +200
		name = "MECR_EXPO.370.buy_200"
		custom_gui = "enclave_trader_option"
		allow = { resource_stockpile_compare = { resource = energy value >= 2800 } }
		event_target:expo_sponsor = {
			switch = {
				trigger = has_country_flag
				trader_enclave_country_1 = {
					root = {
						add_resource = {
							energy = -2800
							exotic_gases = 200
						}
					}
				}
				trader_enclave_country_2 = {
					root = {
						add_resource = {
							energy = -2800
							volatile_motes = 200
						}
					}
				}
				trader_enclave_country_3 = {
					root = {
						add_resource = {
							energy = -2800
							rare_crystals = 200
						}
					}
				}
			}
			add_trust = {
				who = root
				amount = 5
			}
		}
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.371
			}
			event_target:expo_organiser = {
				add_resource = { energy = 200 }
				create_message = {
					type = MESSAGE_TYPE_EXPO_SPONSOR_BONUS
					localization = "MESSAGE_TYPE_EXPO_SPONSOR_BONUS_DESC_200"
					days = 30
					target = capital_scope
				}
			}
		}
	}
	option = { # 拒绝
		name = "NODEAL"
		default_hide_option = yes
		custom_gui = "enclave_trader_option"
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
}
country_event = { #371.贸易城邦赞助商回应
	id = MECR_EXPO.371
	title = "MECR_EXPO.370.title"
	desc = {
		text = "leviathans.130.a.reply"
		trigger = {
			event_target:expo_sponsor = {
				has_country_flag = trader_enclave_country_1
			}
		}
	}
	desc = {
		text = "leviathans.131.a.reply"
		trigger = {
			event_target:expo_sponsor = {
				has_country_flag = trader_enclave_country_2
			}
		}
	}
	desc = {
		text = "leviathans.132.a.reply"
		trigger = {
			event_target:expo_sponsor = {
				has_country_flag = trader_enclave_country_3
			}
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_trader_window"
	picture_event_data = {
		portrait = event_target:expo_sponsor
		room = enclave_trader_room
	}
	
	option = {
		name = "GOOD"
		custom_gui = "enclave_trader_option"
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
}
country_event = { #380.策展人的帮助(381.)[301.]
	id = MECR_EXPO.380
	title = "MECR_EXPO.380.title"
	desc = "MECR_EXPO.380.desc"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_curator_window"
	picture_event_data = {
		portrait = event_target:expo_curators
		room = enclave_curator_room
	}

	trigger = {
		NOT = {
			has_country_flag = attacked_curators
		}
	}

	option = { # 物理
		name = "MECR_EXPO.380.physics"
		custom_gui = "enclave_curator_option"
		allow = { resource_stockpile_compare = { resource = energy value >= 2000 } }
		add_random_research_option = {
			add_progress = 25
			area = physics
			fail_effects = {
				add_monthly_resource_mult = {
					resource = physics_research
					value = 3
				}
			}
		}
		add_resource = {
			energy = -2000
		}
		event_target:expo_curators = {
			add_trust = {
				who = root
				amount = 10
			}
		}
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.381
			}
		}
	}
	option = { # 社会
		name = "MECR_EXPO.380.society"
		custom_gui = "enclave_curator_option"
		allow = { resource_stockpile_compare = { resource = energy value >= 2000 } }
		add_random_research_option = {
			add_progress = 25
			area = society
			fail_effects = {
				add_monthly_resource_mult = {
					resource = society_research
					value = 3
				}
			}
		}
		add_resource = {
			energy = -2000
		}
		event_target:expo_curators = {
			add_trust = {
				who = root
				amount = 10
			}
		}
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.381
			}
		}
	}
	option = { # 工程
		name = "MECR_EXPO.380.engineering"
		custom_gui = "enclave_curator_option"
		allow = { resource_stockpile_compare = { resource = energy value >= 2000 } }
		add_random_research_option = {
			add_progress = 25
			area = engineering
			fail_effects = {
				add_monthly_resource_mult = {
					resource = engineering_research
					value = 3
				}
			}
		}
		add_resource = {
			energy = -2000
		}
		event_target:expo_curators = {
			add_trust = {
				who = root
				amount = 10
			}
		}
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.381
			}
		}
	}
	option = { # 拒绝
		name = "MECR_EXPO.380.no"
		default_hide_option = yes
		custom_gui = "enclave_curator_option"
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
}
country_event = { #381.策展人回应
	id = MECR_EXPO.381
	title = "MECR_EXPO.380.title"
	desc = "MECR_EXPO.381.desc"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_curator_window"
	picture_event_data = {
		portrait = event_target:expo_curators
		room = enclave_curator_room
	}

	trigger = {
		NOT = {
			has_country_flag = attacked_curators
		}
	}

	option = {
		name = "GOOD"
		custom_gui = "enclave_curator_option"
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
}
country_event = { #390.【目录】是否出现艺术团的判断：随机延迟(391.)[301.]
	id = MECR_EXPO.390
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_same_value = event_target:expo_organiser
	}

	immediate = {
		random_list = {
			10 = {
				modifier = {
					mult = 0.1
					has_global_flag = flag_MECR_391_actived
				}
				every_galcom_member = {
					if = {
						limit = {
							exists = event_target:expo_artists
							NOT = { has_country_flag = enclave_artist_ignores }
						}
						if = {
							limit = { NOT = { has_communications = event_target:expo_artists } }
							establish_communications = event_target:expo_artists
						}
					}
					country_event = {
						id = MECR_EXPO.391
						days = 0
						random = 30
					}
				}
			}
			10 = {
				modifier = {
					mult = 0.1
					has_global_flag = flag_MECR_393_actived
				}
				every_galcom_member = {
					if = {
						limit = {
							exists = event_target:expo_artists
							NOT = { has_country_flag = enclave_artist_ignores }
						}
						if = {
							limit = { NOT = { has_communications = event_target:expo_artists } }
							establish_communications = event_target:expo_artists
						}
					}
					country_event = {
						id = MECR_EXPO.393
						days = 0
						random = 30
					}
				}
			}
			1 = {
			}
		}
	}
}
country_event = { #391.艺术团的不请自来：三联艺术装置(392.)
	id = MECR_EXPO.391
	title = "MECR_EXPO.391.title"
	desc = "MECR_EXPO.391.desc"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_artist_window"
	custom_gui_option = "enclave_artist_option"
	picture_event_data = {
		portrait = event_target:expo_artists
		room = enclave_artist_room
	}

	trigger = {
	}

	option = { #凝聚力
		name = "MECR_EXPO.391.a"
		allow = { resource_stockpile_compare = { resource = influence value >= 50 } }
		add_resource = {
			influence = -50
		}
		add_monthly_resource_mult = {
			resource = unity
			value = 4
		}
		hidden_effect = {
			set_country_flag = flag_me391a
			country_event = {
				id = MECR_EXPO.392
			}
		}
	}
	option = { #纪念碑
		name = "MECR_EXPO.391.b"
		allow = { resource_stockpile_compare = { resource = influence value >= 50 } }
		add_resource = {
			influence = -50
		}
		custom_tooltip = "MECR_EXPO.391.b.tooltip"
		hidden_effect = { subtract_variable = { which = artist_monument_erected value = 1 } }
		hidden_effect = {
			set_country_flag = flag_me391b
			country_event = {
				id = MECR_EXPO.392
			}
		}
	}
	option = { #文物
		name = "MECR_EXPO.391.c"
		allow = { resource_stockpile_compare = { resource = influence value >= 50 } }
		add_resource = {
			influence = -50
		}
		add_resource = {
			minor_artifacts = 150
		}
		hidden_effect = {
			set_country_flag = flag_me391c
			country_event = {
				id = MECR_EXPO.392
			}
		}
	}
	option = { #拒绝
		name = "MECR_EXPO.391.no"
		default_hide_option = yes
		custom_tooltip = "MECR_EXPO.391.no.tooltip"
	}
	option = { #全都要
		name = "MECR_EXPO.391.all"
		allow = { resource_stockpile_compare = { resource = energy value >= 10000 } }
		add_resource = {
			energy = -10000
		}
		add_monthly_resource_mult = {
			resource = unity
			value = 4
		}
		custom_tooltip = "MECR_EXPO.391.b.tooltip"
		hidden_effect = { subtract_variable = { which = artist_monument_erected value = 1 } }
		add_resource = {
			minor_artifacts = 150
		}
		hidden_effect = {
			set_country_flag = flag_me391all
			country_event = {
				id = MECR_EXPO.392
			}
		}
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
}
country_event = { #392.艺术团回应
	id = MECR_EXPO.392
	title = "MECR_EXPO.391.title"
	desc = {
		text = "MECR_EXPO.392.desc.a"
		trigger = {
			OR = {
				has_country_flag = flag_me391a
				has_country_flag = flag_me391b
				has_country_flag = flag_me391c
			}
		}
	}
	desc = {
		text = "MECR_EXPO.392.desc.b"
		trigger = {
			has_country_flag = flag_me391all
			has_modifier = enclave_artist_patron
		}
	}
	desc = {
		text = "MECR_EXPO.392.desc.c"
		trigger = {
			has_country_flag = flag_me391all
			NOT = { has_modifier = enclave_artist_patron }
		}
	}
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_artist_window"
	custom_gui_option = "enclave_artist_option"
	picture_event_data = {
		portrait = event_target:expo_artists
		room = enclave_artist_room
	}

	trigger = {
	}

	option = { #三选一
		name = "MECR_EXPO.392.a"
		trigger = {
			OR = {
				has_country_flag = flag_me391a
				has_country_flag = flag_me391b
				has_country_flag = flag_me391c
			}
		}
		event_target:expo_artists = {
			add_trust = {
				who = root
				amount = -10
			}
		}
		hidden_effect = {
			remove_country_flag = flag_me391a
			remove_country_flag = flag_me391b
			remove_country_flag = flag_me391c
		}
	}
	option = { #全都要
		name = "MECR_EXPO.392.b"
		trigger = {
			has_country_flag = flag_me391all
		}
		event_target:expo_artists = {
			add_trust = {
				who = root
				amount = 10
			}
		}
		hidden_effect = {
			remove_country_flag = flag_me391all
		}
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
	abort_effect = {
		hidden_effect = {
			remove_country_flag = flag_me391a
			remove_country_flag = flag_me391b
			remove_country_flag = flag_me391c
			remove_country_flag = flag_me391all
		}
	}
}
country_event = { #393.艺术团的不请自来：摇滚乐队(394.)
	id = MECR_EXPO.393
	title = "MECR_EXPO.391.title"
	desc = "MECR_EXPO.393.desc"
	is_triggered_only = yes

	option = {
		name = MECR_EXPO.393.a
		custom_tooltip = MECR_EXPO.393.a.tooltip
		hidden_effect = {
			country_event = {
				id = MECR_EXPO.394
				days = 7
			}
		}
	}
	option = {
		name = MECR_EXPO.393.b
		custom_tooltip = MECR_EXPO.393.b.tooltip
	}
}
country_event = { #394.乐队评价(394.)
	id = MECR_EXPO.394
	title = "MECR_EXPO.394.title"
	desc = "MECR_EXPO.394.desc"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_artist_window"
	custom_gui_option = "enclave_artist_option"
	picture_event_data = {
		portrait = event_target:expo_artists
		room = enclave_artist_room
	}

	trigger = {
	}

	option = { #
		name = "MECR_EXPO.394.a"
		add_monthly_resource_mult = { resource = unity value = -3 }
		hidden_effect = {
			set_country_flag = flag_me394_a
			country_event = {
				id = MECR_EXPO.395
			}
		}
	}
	option = { #
		name = "MECR_EXPO.394.b"
		add_monthly_resource_mult = { resource = unity value = -3 }
		hidden_effect = {
			set_country_flag = flag_me394_b
			country_event = {
				id = MECR_EXPO.395
			}
		}
	}
	option = { #
		name = "MECR_EXPO.394.c"
		add_monthly_resource_mult = { resource = unity value = -3 }
		hidden_effect = {
			set_country_flag = flag_me394_c
			country_event = {
				id = MECR_EXPO.395
			}
		}
	}
	option = { #
		name = "MECR_EXPO.394.d"
		add_monthly_resource_mult = { resource = unity value = -3 }
		hidden_effect = {
			set_country_flag = flag_me394_d
			country_event = {
				id = MECR_EXPO.395
			}
		}
	}
	option = { #拒绝
		name = "MECR_EXPO.394.no"
		default_hide_option = yes
		custom_tooltip = "MECR_EXPO.394.no.tooltip"
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
}
country_event = { #395.艺术团回应
	id = MECR_EXPO.395
	title = "MECR_EXPO.394.title"
	desc = "MECR_EXPO.395.desc"
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "enclave_artist_window"
	custom_gui_option = "enclave_artist_option"
	picture_event_data = {
		portrait = event_target:expo_artists
		room = enclave_artist_room
	}

	trigger = {
	}

	option = { #
		name = "MECR_EXPO.395.a"
		switch = {
			trigger = has_country_flag
			flag_me394_a = { add_modifier = { modifier = rock_festival_a years = 5 } }
			flag_me394_b = { add_modifier = { modifier = rock_festival_b years = 5 } }
			flag_me394_c = { add_modifier = { modifier = rock_festival_c years = 5 } }
			flag_me394_d = { add_modifier = { modifier = rock_festival_d years = 5 } }
		}
		event_target:expo_artists = {
			add_trust = {
				who = root
				amount = 10
			}
		}
		hidden_effect = {
			remove_country_flag = flag_me394_a
			remove_country_flag = flag_me394_b
			remove_country_flag = flag_me394_c
			remove_country_flag = flag_me394_d
		}
	}
	abort_trigger = {
		NOT = {
			has_global_flag = flag_expo_ongoing
		}
	}
	abort_effect = {
		hidden_effect = {
			event_target:expo_artists = {
				add_trust = {
					who = root
					amount = 10
				}
			}
			remove_country_flag = flag_me394_a
			remove_country_flag = flag_me394_b
			remove_country_flag = flag_me394_c
			remove_country_flag = flag_me394_d
		}
	}
}

# 闭幕阶段
country_event = { #400.【目录】闭幕：校准并锁定时间表。闭幕式及投标过程各国独自完成，全部国完成前下一目录维持自身循环（421.）(401.)[300.]
	id = MECR_EXPO.400
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = {
			has_global_flag = debug_expo_ending_event
		}
	}

	immediate = {
		remove_global_flag = debug_expo_openning_event
		set_global_flag = debug_expo_ending_event
		every_galcom_member = {
			set_country_flag = expo_ending_ongoing
			if = {
				limit = { NOT = { any_situation = { is_situation_type = situation_galactic_expo } } }
				start_situation = { type = situation_galactic_expo target = This }
			}
			random_situation = {
				limit = { is_situation_type = situation_galactic_expo }
				export_trigger_value_to_variable = { trigger = situation_progress variable = situation_progress_var }
				multiply_variable = { which = situation_progress_var value = -1 }
				add_situation_progress = situation_progress_var
				add_situation_progress = 99
				
				set_situation_locked = yes
				set_situation_flag = flag_expo_situation_paused
			}
			#expo_situation_set_progress = { progress = 99 }
			#expo_situation_pause = yes
			country_event = {
				id = MECR_EXPO.401
			}
		}
		event_target:global_event_country = {
			set_timed_country_flag = {
				flag = flag_MECR_EXPO_421_timer
				days = 60
			}
			country_event = {
				id = MECR_EXPO.421
				days = 1
			}
		}
	}
}
country_event = { #401.颁奖典礼：截止未完成的改善计划，开始颁奖，没有分数的颁奖项目直接跳过(402.403.404.405.406.407.)
	id = MECR_EXPO.401
	title = "MECR_EXPO.401.title"
	desc = "MECR_EXPO.401.desc"
	picture = GFX_evt_galactic_community
	show_sound = event_coronation
	is_triggered_only = yes

	immediate = {
		abort_special_project = { type = GLACTIC_EXPO_SCIENCE_ON_EXHI }
		abort_special_project = { type = GLACTIC_EXPO_CULTURE_ON_EXHI }
		abort_special_project = { type = GLACTIC_EXPO_INDUSTRY_ON_EXHI }
		abort_special_project = { type = GLACTIC_EXPO_ARCHAEOLOGY_ON_EXHI }
		abort_special_project = { type = GLACTIC_EXPO_HISTORY_ON_EXHI }
		set_timed_country_flag = {
			flag = flag_wait_for_expo_bidding
			days = 45
		}
	}
	option = {
		name = "MECR_EXPO.401.option"
		custom_tooltip = "MECR_EXPO.401.option.tooltip"
		hidden_effect = {
			if = {
				limit = { check_variable = { which = expo_science_result value > 0 } }
				country_event = { id = MECR_EXPO.402 }
			}
			else_if = {
				limit = { check_variable = { which = expo_culture_result value > 0 } }
				country_event = { id = MECR_EXPO.403 }
			}
			else_if = {
				limit = { check_variable = { which = expo_industry_result value > 0 } }
				country_event = { id = MECR_EXPO.404 }
			}
			else_if = {
				limit = { check_variable = { which = expo_archaeology_result value > 0 } }
				country_event = { id = MECR_EXPO.405 }
			}
			else_if = {
				limit = { check_variable = { which = expo_tradition_result value > 0 } }
				country_event = { id = MECR_EXPO.406 }
			}
			else = {
				country_event = { id = MECR_EXPO.407 }
			}
		}
	}
	########################## 奖励列表 （buff类的持续时间为十年）
	########## 科研
	#后1/3：科研选项+1
	#中1/3：科研选项+1 领袖经验获得+25%
	#前1/3：科研选项+1 领袖经验获得+25% 研究员维护费-10%
	#季军+：4个月科研
	#亚军+：6个月科研
	#冠军+：6个月科研 科研舰无限边疆号
	########## 文化
	#后1/3：法令维护费-10%
	#中1/3：法令维护费-10% 来自人口的帝国规模-5%
	#前1/3：法令维护费-10% 来自人口的帝国规模-5% 每40人口+1文化工作者(评估者/突触工蜂)岗位
	#季军+：2个额外的纪念碑
	#亚军+：3个额外的纪念碑
	#冠军+：3个额外的纪念碑 1个免费的圣遗物（保证不空）
	########## 工业
	#后1/3：行星建设费用-10%
	#中1/3：行星建设费用-10% 技工与矿工产出+10%
	#前1/3：行星建设费用-10% 技工与矿工产出+10% 冶金师与工匠产出+5%
	#季军+：工业材料学研究速度+15%
	#亚军+：工业材料学研究速度+15% 巨构建造速度+25%
	#冠军+：工业材料学研究速度+15% 巨构建造速度+25% 一次行星工业整合计划决议
	########## 考古
	#后1/3：考古速度+35%
	#中1/3：考古速度+35% 文物行动花费-20%
	#前1/3：考古速度+35% 文物行动花费-20% 治国术研究速度+15%
	#季军+：小份文物奖励
	#亚军+：中份文物奖励
	#冠军+：2*中份文物奖励
	########## 传统
	#后1/3：凝聚力产出+5%
	#中1/3：凝聚力产出+5% 主流思潮吸引力+35%
	#前1/3：凝聚力产出+5% 主流思潮吸引力+35% 行星稳定度+5
	#季军+：4个月凝聚力
	#亚军+：6个月凝聚力
	#冠军+：6个月凝聚力 一次免费的政府改革
	########## 总展览
	#后1/3：外交维护费-25%
	#中1/3：外交维护费-25% 信赖增长+0.25
	#前1/3：外交维护费-25% 信赖增长+0.25 外交权重+25%
	#季军+：所有共同体成员好感度+40（不可叠加）
	#亚军+：所有共同体成员好感度+70（不可叠加）
	#冠军+：所有共同体成员好感度+100（不可叠加）
}
country_event = { #402.颁奖：科学进步	(403.404.405.406.407.)
	id = MECR_EXPO.402
	title = "MECR_EXPO.402.title"
	desc = "MECR_EXPO.402.desc"
	picture = GFX_evt_ancient_databank
	is_triggered_only = yes

	option = {
		name = "EXCELLENT"
		custom_tooltip = "MECR_EXPO.402.tooltip"
		switch = {
			trigger = has_country_flag
			flag_expo_science_grade_good = {
				add_modifier = { modifier = expo_science_award_good years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_science_grade_good }
			}
			flag_expo_science_grade_normal = {
				add_modifier = { modifier = expo_science_award_normal years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_science_grade_normal }
			}
			flag_expo_science_grade_bad = {
				add_modifier = { modifier = expo_science_award_bad years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_science_grade_bad }
			}
		}
		switch = {
			trigger = has_country_flag
			flag_expo_science_ranking_1st = {
				add_monthly_resource_mult = { resource = physics_research value = 6 }
				add_monthly_resource_mult = { resource = society_research value = 6 }
				add_monthly_resource_mult = { resource = engineering_research value = 6 }
				custom_tooltip = "expo_science_rank_1_award"
				hidden_effect = {
					create_fleet = {
						name = "NAME_expo_frontier"
						effect = {
							set_owner = root
							create_ship = {
								name = "NAME_expo_frontier"
								design = "NAME_expo_frontier"
								graphical_culture = "fallen_machine_empire_01"
								prefix = yes
								upgradable = no
							}
							set_location = root.capital_scope
						}
					}
				}
				hidden_effect = { remove_country_flag = flag_expo_science_ranking_1st clear_global_event_target = expo_science_ranking_1st }
			}
			flag_expo_science_ranking_2nd = {
				add_monthly_resource_mult = { resource = physics_research value = 6 }
				add_monthly_resource_mult = { resource = society_research value = 6 }
				add_monthly_resource_mult = { resource = engineering_research value = 6 }
				hidden_effect = { remove_country_flag = flag_expo_science_ranking_2nd clear_global_event_target = expo_science_ranking_2nd }
			}
			flag_expo_science_ranking_3rd = {
				add_monthly_resource_mult = { resource = physics_research value = 4 }
				add_monthly_resource_mult = { resource = society_research value = 4 }
				add_monthly_resource_mult = { resource = engineering_research value = 4 }
				hidden_effect = { remove_country_flag = flag_expo_science_ranking_3rd clear_global_event_target = expo_science_ranking_3rd }
			}
		}
		hidden_effect = {
			clear_variable = expo_science_result
			clear_variable = expo_science_ranking
		}
		hidden_effect = { #继续颁奖，没有分数的颁奖项目直接跳过
			if = {
				limit = { check_variable = { which = expo_culture_result value > 0 } }
				country_event = { id = MECR_EXPO.403 }
			}
			else_if = {
				limit = { check_variable = { which = expo_industry_result value > 0 } }
				country_event = { id = MECR_EXPO.404 }
			}
			else_if = {
				limit = { check_variable = { which = expo_archaeology_result value > 0 } }
				country_event = { id = MECR_EXPO.405 }
			}
			else_if = {
				limit = { check_variable = { which = expo_tradition_result value > 0 } }
				country_event = { id = MECR_EXPO.406 }
			}
			else = {
				country_event = { id = MECR_EXPO.407 }
			}
		}
	}
}
country_event = { #403.颁奖：文化艺术	(404.405.406.407.)
	id = MECR_EXPO.403
	title = "MECR_EXPO.403.title"
	desc = "MECR_EXPO.403.desc"
	picture = GFX_evt_baol_datacrystals
	is_triggered_only = yes

	option = {
		name = "FASCINATING"
		custom_tooltip = "MECR_EXPO.403.tooltip"
		switch = {
			trigger = has_country_flag
			flag_expo_culture_grade_good = {
				if = {
					limit = { NOT = { has_ethic = ethic_gestalt_consciousness } }
					add_modifier = { modifier = expo_culture_award_good years = 15 }
				}
				else_if = {
					limit = { is_machine_empire = yes }
					add_modifier = { modifier = expo_culture_award_good_machine years = 15 }
				}
				else_if = {
					limit = { is_hive_empire = yes }
					add_modifier = { modifier = expo_culture_award_good_hive years = 15 }
				}
				hidden_effect = { remove_country_flag = flag_expo_culture_grade_good }
			}
			flag_expo_culture_grade_normal = {
				add_modifier = { modifier = expo_culture_award_normal years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_culture_grade_normal }
			}
			flag_expo_culture_grade_bad = {
				add_modifier = { modifier = expo_culture_award_bad years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_culture_grade_bad }
			}
		}
		switch = {
			trigger = has_country_flag
			flag_expo_culture_ranking_1st = {
				if = {
					limit = { exists = event_target:caravaneer_home_system }
					custom_tooltip = "expo_culture_rank_1_award"
					hidden_effect = {
						subtract_variable = { which = artist_monument_erected value = 3 }
						country_event = { id = MECR_EXPO.1001 days = 1 }
					}
				}
				else = {
					custom_tooltip = "expo_culture_rank_1_award_no_cara"
					hidden_effect = { subtract_variable = { which = artist_monument_erected value = 4 } }
				}
				hidden_effect = { remove_country_flag = flag_expo_culture_ranking_1st clear_global_event_target = expo_culture_ranking_1st }
			}
			flag_expo_culture_ranking_2nd = {
				custom_tooltip = "expo_culture_rank_2_award"
				hidden_effect = { subtract_variable = { which = artist_monument_erected value = 3 } }
				hidden_effect = { remove_country_flag = flag_expo_culture_ranking_2nd clear_global_event_target = expo_culture_ranking_2nd }
			}
			flag_expo_culture_ranking_3rd = {
				custom_tooltip = "expo_culture_rank_3_award"
				hidden_effect = { subtract_variable = { which = artist_monument_erected value = 2 } }
				hidden_effect = { remove_country_flag = flag_expo_culture_ranking_3rd clear_global_event_target = expo_culture_ranking_3rd }
			}
		}
		hidden_effect = {
			clear_variable = expo_culture_result
			clear_variable = expo_culture_ranking
		}
		hidden_effect = { #继续颁奖，没有分数的颁奖项目直接跳过
			if = {
				limit = { check_variable = { which = expo_industry_result value > 0 } }
				country_event = { id = MECR_EXPO.404 }
			}
			else_if = {
				limit = { check_variable = { which = expo_archaeology_result value > 0 } }
				country_event = { id = MECR_EXPO.405 }
			}
			else_if = {
				limit = { check_variable = { which = expo_tradition_result value > 0 } }
				country_event = { id = MECR_EXPO.406 }
			}
			else = {
				country_event = { id = MECR_EXPO.407 }
			}
		}
	}
}
country_event = { #404.颁奖：工业技术	(405.406.407.)
	id = MECR_EXPO.404
	title = "MECR_EXPO.404.title"
	desc = "MECR_EXPO.404.desc"
	picture = GFX_evt_megastructure_construction
	is_triggered_only = yes

	option = {
		name = "MARVELOUS"
		custom_tooltip = "MECR_EXPO.404.tooltip"
		switch = {
			trigger = has_country_flag
			flag_expo_industry_grade_good = {
				add_modifier = { modifier = expo_industry_award_good years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_industry_grade_good }
			}
			flag_expo_industry_grade_normal = {
				add_modifier = { modifier = expo_industry_award_normal years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_industry_grade_normal }
			}
			flag_expo_industry_grade_bad = {
				add_modifier = { modifier = expo_industry_award_bad years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_industry_grade_bad }
			}
		}
		switch = {
			trigger = has_country_flag
			flag_expo_industry_ranking_1st = {
				custom_tooltip = "expo_industry_rank_1_award"
				hidden_effect = { change_variable = { which = EXPO_award_industry_1st value = 1 } }
				add_modifier = { modifier = expo_industry_award_2nd years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_industry_ranking_1st clear_global_event_target = expo_industry_ranking_1st }
			}
			flag_expo_industry_ranking_2nd = {
				add_modifier = { modifier = expo_industry_award_2nd years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_industry_ranking_2nd clear_global_event_target = expo_industry_ranking_2nd }
			}
			flag_expo_industry_ranking_3rd = {
				add_modifier = { modifier = expo_industry_award_3rd years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_industry_ranking_3rd clear_global_event_target = expo_industry_ranking_3rd }
			}
		}
		hidden_effect = {
			clear_variable = expo_industry_result
			clear_variable = expo_industry_ranking
		}
		hidden_effect = { #继续颁奖，没有分数的颁奖项目直接跳过
			if = {
				limit = { check_variable = { which = expo_archaeology_result value > 0 } }
				country_event = { id = MECR_EXPO.405 }
			}
			else_if = {
				limit = { check_variable = { which = expo_tradition_result value > 0 } }
				country_event = { id = MECR_EXPO.406 }
			}
			else = {
				country_event = { id = MECR_EXPO.407 }
			}
		}
	}
}
country_event = { #405.颁奖：考古发现	(406.407.)
	id = MECR_EXPO.405
	title = "MECR_EXPO.405.title"
	desc = "MECR_EXPO.405.desc"
	picture = GFX_evt_overgrown_city
	is_triggered_only = yes

	option = {
		name = "AMAZING"
		custom_tooltip = "MECR_EXPO.405.tooltip"
		switch = {
			trigger = has_country_flag
			flag_expo_archaeology_grade_good = {
				add_modifier = { modifier = expo_archaeology_award_good years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_archaeology_grade_good }
			}
			flag_expo_archaeology_grade_normal = {
				add_modifier = { modifier = expo_archaeology_award_normal years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_archaeology_grade_normal }
			}
			flag_expo_archaeology_grade_bad = {
				add_modifier = { modifier = expo_archaeology_award_bad years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_archaeology_grade_bad }
			}
		}
		switch = {
			trigger = has_country_flag
			flag_expo_archaeology_ranking_1st = {
				large_artifact_reward = yes
				hidden_effect = { remove_country_flag = flag_expo_archaeology_ranking_1st clear_global_event_target = expo_archaeology_ranking_1st }
			}
			flag_expo_archaeology_ranking_2nd = {
				medium_artifact_reward = yes
				medium_artifact_reward = yes
				hidden_effect = { remove_country_flag = flag_expo_archaeology_ranking_2nd clear_global_event_target = expo_archaeology_ranking_2nd }
			}
			flag_expo_archaeology_ranking_3rd = {
				medium_artifact_reward = yes
				hidden_effect = { remove_country_flag = flag_expo_archaeology_ranking_3rd clear_global_event_target = expo_archaeology_ranking_3rd }
			}
		}
		hidden_effect = {
			clear_variable = expo_archaeology_result
			clear_variable = expo_archaeology_ranking
		}
		hidden_effect = { #继续颁奖，没有分数的颁奖项目直接跳过
			if = {
				limit = { check_variable = { which = expo_tradition_result value > 0 } }
				country_event = { id = MECR_EXPO.406 }
			}
			else = {
				country_event = { id = MECR_EXPO.407 }
			}
		}
	}
}
country_event = { #406.颁奖：历史传统	(407.)
	id = MECR_EXPO.406
	title = "MECR_EXPO.406.title"
	desc = "MECR_EXPO.406.desc"
	picture = GFX_evt_medieval_alien_civilization
	is_triggered_only = yes

	option = {
		name = "REMARKABLE"
		custom_tooltip = "MECR_EXPO.405.tooltip"
		switch = {
			trigger = has_country_flag
			flag_expo_history_grade_good = {
				add_modifier = { modifier = expo_history_award_good years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_history_grade_good }
			}
			flag_expo_history_grade_normal = {
				add_modifier = { modifier = expo_history_award_normal years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_history_grade_normal }
			}
			flag_expo_history_grade_bad = {
				add_modifier = { modifier = expo_history_award_bad years = 15 }
				hidden_effect = { remove_country_flag = flag_expo_history_grade_bad }
			}
		}
		switch = {
			trigger = has_country_flag
			flag_expo_history_ranking_1st = {
				custom_tooltip = "expo_history_rank_1_award"
				hidden_effect = { change_variable = { which = EXPO_award_history_1st value = 1 } }
				add_monthly_resource_mult = { resource = unity value = 6 }
				hidden_effect = { remove_country_flag = flag_expo_history_ranking_1st clear_global_event_target = expo_history_ranking_1st }
			}
			flag_expo_history_ranking_2nd = {
				add_monthly_resource_mult = { resource = unity value = 6 }
				hidden_effect = { remove_country_flag = flag_expo_history_ranking_2nd clear_global_event_target = expo_history_ranking_2nd }
			}
			flag_expo_history_ranking_3rd = {
				add_monthly_resource_mult = { resource = unity value = 4 }
				hidden_effect = { remove_country_flag = flag_expo_history_ranking_3rd clear_global_event_target = expo_history_ranking_3rd }
			}
		}
		hidden_effect = {
			clear_variable = expo_history_result
			clear_variable = expo_history_ranking
		}
		hidden_effect = { #继续颁奖
			country_event = { id = MECR_EXPO.407 }
		}
	}
}
country_event = { #407.颁奖：总奖		如果已决定不再举办银博会，跳过下届东道主投标过程(410.420.)
	id = MECR_EXPO.407
	title = "MECR_EXPO.407.title"
	desc = "MECR_EXPO.407.desc"
	picture = GFX_evt_arena
	is_triggered_only = yes

	option = {
		name = "MECR_EXPO.407.option"
		custom_tooltip = "MECR_EXPO.407.tooltip"
		switch = {
			trigger = has_country_flag
			flag_expo_total_grade_good = {
				add_modifier = { modifier = expo_total_award_good years = 15 }
			}
			flag_expo_total_grade_normal = {
				add_modifier = { modifier = expo_total_award_normal years = 15 }
			}
			flag_expo_total_grade_bad = {
				add_modifier = { modifier = expo_total_award_bad years = 15 }
			}
		}
		switch = {
			trigger = has_country_flag
			flag_expo_total_ranking_1st = {
				add_resource = { influence = 300 }
				custom_tooltip = "expo_total_rank_1_award"
				hidden_effect = {
					every_galcom_member = {
						limit = { NOT = { is_same_value = root } }
						add_opinion_modifier = { who = root modifier = opinion_expo_total_award }
						add_opinion_modifier = { who = root modifier = opinion_expo_total_award }
						add_opinion_modifier = { who = root modifier = opinion_expo_total_award }
					}
				}
			}
			flag_expo_total_ranking_2nd = {
				add_resource = { influence = 200 }
				custom_tooltip = "expo_total_rank_2_award"
				hidden_effect = {
					every_galcom_member = {
						limit = { NOT = { is_same_value = root } }
						add_opinion_modifier = { who = root modifier = opinion_expo_total_award }
						add_opinion_modifier = { who = root modifier = opinion_expo_total_award }
					}
				}
			}
			flag_expo_total_ranking_3rd = {
				add_resource = { influence = 100 }
				custom_tooltip = "expo_total_rank_3_award"
				hidden_effect = {
					every_galcom_member = {
						limit = { NOT = { is_same_value = root } }
						add_opinion_modifier = { who = root modifier = opinion_expo_total_award }
					}
				}
			}
		}
		hidden_effect = {
			clear_variable = expo_total_result
			clear_variable = expo_total_ranking
		}
		hidden_effect = {
			if = {
				limit = {
					is_active_resolution = resolution_the_galactic_expo
					has_country_flag = flag_wait_for_expo_bidding
				}
				country_event = { id = MECR_EXPO.410 }
			}
			else = {
				country_event = { id = MECR_EXPO.420 }
			}
		}
	}
}

country_event = { #410.下次银博会东道主投标：选择竞标力度，可进入寻求外交援助菜单。选择完毕后尝试触发投标结束（412.）(411.)
	id = MECR_EXPO.410
	title = "MECR_EXPO.410.title"
	desc = {
		text = "MECR_EXPO.410.desc.organiser"
		trigger = { is_same_value = event_target:expo_organiser }
	}
	desc = {
		text = "MECR_EXPO.410.desc"
		trigger = { NOT = { is_same_value = event_target:expo_organiser } }
	}
	picture = GFX_evt_galactic_senate
	is_triggered_only = yes
	
	immediate = {
	}

	option = {
		name = "MECR_EXPO.410.option.a"
		trigger = { NOT = { is_same_value = event_target:expo_organiser } }
		allow = { resource_stockpile_compare = { resource = influence value >= 300 } }
		custom_tooltip = "MECR_EXPO.410.option.tooltip"
		add_resource = { influence = -300 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 1 }
			set_variable = { which = expo_bid_result value = 1 }
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				event_target:global_event_country = {
					country_event = { id = MECR_EXPO.412 }
				}
			}
		}
		ai_chance = {
			factor = 40
			modifier = {
				factor = 0.2
				NOR = {
					is_same_value = event_target:expo_total_ranking_1st
					is_same_value = event_target:expo_total_ranking_2nd
					is_same_value = event_target:expo_total_ranking_3rd
				}
			}
			modifier = {
				factor = 0
				NOT = { has_country_flag = expo_total_award_good }
			}
			modifier = {
				factor = 0.5
				resource_stockpile_compare = { resource = influence value < 600 }
			}
			modifier = {
				factor = 2
				resource_stockpile_compare = { resource = influence value > 900 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.410.option.help"
		trigger = {
			is_ai = no
			NOT = { is_same_value = event_target:expo_organiser }
		}
		allow = { resource_stockpile_compare = { resource = influence value >= 300 } }
		custom_tooltip = "MECR_EXPO.410.option.help.tooltip"
		hidden_effect = {
			country_event = { id = MECR_EXPO.411 }
		}
	}
	option = {
		name = "MECR_EXPO.410.option.b"
		trigger = { NOT = { is_same_value = event_target:expo_organiser } }
		allow = { resource_stockpile_compare = { resource = influence value >= 200 } }
		custom_tooltip = "MECR_EXPO.410.option.tooltip"
		add_resource = { influence = -200 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 2 }
			set_variable = { which = expo_bid_result value = 1 }
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				event_target:global_event_country = {
					country_event = { id = MECR_EXPO.412 }
				}
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 0.2
				OR = {
					is_same_value = event_target:expo_total_ranking_1st
					is_same_value = event_target:expo_total_ranking_2nd
					is_same_value = event_target:expo_total_ranking_3rd
				}
			}
			modifier = {
				factor = 0
				NOT = { has_country_flag = expo_total_award_good }
			}
			modifier = {
				factor = 0.5
				resource_stockpile_compare = { resource = influence value < 400 }
			}
			modifier = {
				factor = 2
				resource_stockpile_compare = { resource = influence value > 900 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.410.option.c"
		trigger = { NOT = { is_same_value = event_target:expo_organiser } }
		allow = { resource_stockpile_compare = { resource = influence value >= 100 } }
		custom_tooltip = "MECR_EXPO.410.option.tooltip"
		add_resource = { influence = -100 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 3 }
			set_variable = { which = expo_bid_result value = 1 }
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				event_target:global_event_country = {
					country_event = { id = MECR_EXPO.412 }
				}
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				OR = {
					is_same_value = event_target:expo_total_ranking_1st
					is_same_value = event_target:expo_total_ranking_2nd
					is_same_value = event_target:expo_total_ranking_3rd
				}
			}
			modifier = {
				factor = 0
				NOT = { has_country_flag = expo_total_award_good }
			}
			modifier = {
				factor = 0.5
				resource_stockpile_compare = { resource = influence value < 200 }
			}
			modifier = {
				factor = 2
				resource_stockpile_compare = { resource = influence value > 900 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.410.option.d"
		hidden_effect = {
			clear_variable = expo_bid_ranking
			clear_variable = expo_bid_result
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				event_target:global_event_country = {
					country_event = { id = MECR_EXPO.412 }
				}
			}
			else = {
				event_target:global_event_country = {
					country_event = { id = MECR_EXPO.412 days = 2 }
				}
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 0
				OR = {
					is_same_value = event_target:expo_total_ranking_1st
					is_same_value = event_target:expo_total_ranking_2nd
					is_same_value = event_target:expo_total_ranking_3rd
				}
			}
			modifier = {
				factor = 0.3
				has_country_flag = expo_total_award_good
			}
			modifier = {
				factor = 2
				has_country_flag = expo_total_award_normal
			}
			modifier = {
				factor = 5
				has_country_flag = expo_total_award_bad
			}
			modifier = {
				factor = 100
				has_country_flag = expo_total_award_no_parti
			}
			modifier = {
				factor = 0.5
				resource_stockpile_compare = { resource = influence value > 500 }
			}
			modifier = {
				factor = 2
				resource_stockpile_compare = { resource = influence value < 300 }
			}
		}
	}

	abort_trigger = {
		NOT = { has_country_flag = flag_wait_for_expo_bidding }
	}
	abort_effect = {
		hidden_effect = {
			clear_variable = expo_bid_ranking
			clear_variable = expo_bid_result
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				event_target:global_event_country = {
					country_event = { id = MECR_EXPO.412 }
				}
			}
			else = {
				event_target:global_event_country = {
					country_event = { id = MECR_EXPO.412 days = 2 }
				}
			}
		}
	}
}
country_event = { #411.下次银博会东道主投标：寻求外交援助，可返回选择竞标力度菜单。选择完毕后尝试触发投标结束（412.）(410.)
	id = MECR_EXPO.411
	title = "MECR_EXPO.410.title"
	desc = "MECR_EXPO.410.desc"
	picture = GFX_evt_galactic_senate
	is_triggered_only = yes
	
	immediate = {
		set_variable = { which = var_count_favor value = 0 }
		while = {
			limit = {
				any_country = {
					NOT = { has_country_flag = flag_expo_favor_counted_@root }
					root = {
						num_favors = {
							target = prev
							value > 0
						}
					}
				}
			}
			random_country = {
				limit = {
					NOT = { has_country_flag = flag_expo_favor_counted_@root }
					root = {
						num_favors = {
							target = prev
							value > 0
						}
					}
				}
				set_country_flag = flag_expo_favor_counted_@root
				root = {
					export_trigger_value_to_variable = {
						trigger = num_favors
						parameters = {
							target = prev
						}
						variable = var_add_favor
					}
					change_variable = {
						which = var_count_favor
						value = var_add_favor
					}
				}
			}
		}
		every_country = {
			limit = { has_country_flag = flag_expo_favor_counted_@root }
			remove_country_flag = flag_expo_favor_counted_@root
		}
		clear_variable = var_add_favor
	}

	option = {
		name = "MECR_EXPO.411.option.a"
		allow = {
			resource_stockpile_compare = { resource = influence value >= 300 }
			custom_tooltip = {
				fail_text = "favors_not_enough"
				check_variable = { which = var_count_favor value >= 10 }
			}
		}
		custom_tooltip = "MECR_EXPO.411.option.a.tooltip"
		add_resource = { influence = -300 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 1 }
			set_variable = { which = expo_bid_result value = 1 }
			while = {
				count = 10
				random_country = {
					limit = {
						root = {
							num_favors = {
								target = prev
								value > 0
							}
						}
					}
					root = {
						set_variable = {
							which = Rexpo_bid_champion_bonus_got
							value = prev.trigger:diplomacy_weight
						}
						multiply_variable = { which = Rexpo_bid_champion_bonus_got value = 0.2 }
						change_variable = {
							which = Rexpo_bid_champion_bonus
							value = Rexpo_bid_champion_bonus_got
						}
						add_favors = {
							target = prev
							value = -1
						}
					}
				}
			}
			clear_variable = Rexpo_bid_champion_bonus_got
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				country_event = { id = MECR_EXPO.412 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.411.option.b"
		allow = {
			resource_stockpile_compare = { resource = influence value >= 300 }
			custom_tooltip = {
				fail_text = "favors_not_enough"
				check_variable = { which = var_count_favor value >= 6 }
			}
		}
		custom_tooltip = "MECR_EXPO.411.option.b.tooltip"
		add_resource = { influence = -300 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 1 }
			set_variable = { which = expo_bid_result value = 1 }
			while = {
				count = 6
				random_country = {
					limit = {
						root = {
							num_favors = {
								target = prev
								value > 0
							}
						}
					}
					root = {
						set_variable = {
							which = Rexpo_bid_champion_bonus_got
							value = prev.trigger:diplomacy_weight
						}
						multiply_variable = { which = Rexpo_bid_champion_bonus_got value = 0.2 }
						change_variable = {
							which = Rexpo_bid_champion_bonus
							value = Rexpo_bid_champion_bonus_got
						}
						add_favors = {
							target = prev
							value = -1
						}
					}
				}
			}
			clear_variable = Rexpo_bid_champion_bonus_got
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				country_event = { id = MECR_EXPO.412 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.411.option.c"
		allow = {
			resource_stockpile_compare = { resource = influence value >= 300 }
			custom_tooltip = {
				fail_text = "favors_not_enough"
				check_variable = { which = var_count_favor value >= 3 }
			}
		}
		custom_tooltip = "MECR_EXPO.411.option.c.tooltip"
		add_resource = { influence = -300 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 1 }
			set_variable = { which = expo_bid_result value = 1 }
			while = {
				count = 3
				random_country = {
					limit = {
						root = {
							num_favors = {
								target = prev
								value > 0
							}
						}
					}
					root = {
						set_variable = {
							which = Rexpo_bid_champion_bonus_got
							value = prev.trigger:diplomacy_weight
						}
						multiply_variable = { which = Rexpo_bid_champion_bonus_got value = 0.2 }
						change_variable = {
							which = Rexpo_bid_champion_bonus
							value = Rexpo_bid_champion_bonus_got
						}
						add_favors = {
							target = prev
							value = -1
						}
					}
				}
			}
			clear_variable = Rexpo_bid_champion_bonus_got
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				country_event = { id = MECR_EXPO.412 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.411.option.d"
		trigger = { NOT = { is_same_value = event_target:expo_organiser } }
		allow = { resource_stockpile_compare = { resource = influence value >= 300 } }
		custom_tooltip = "MECR_EXPO.411.option.d.tooltip"
		add_resource = { influence = -300 }
		hidden_effect = {
			set_variable = { which = expo_bid_ranking value = 1 }
			set_variable = { which = expo_bid_result value = 1 }
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				country_event = { id = MECR_EXPO.412 }
			}
		}
	}
	option = {
		name = "MECR_EXPO.411.option.return"
		custom_tooltip = "MECR_EXPO.411.option.return.tooltip"
		hidden_effect = {
			country_event = { id = MECR_EXPO.410 }
		}
	}

	abort_trigger = {
		NOT = { has_country_flag = flag_wait_for_expo_bidding }
	}
	abort_effect = {
		hidden_effect = {
			clear_variable = expo_bid_ranking
			clear_variable = expo_bid_result
			remove_country_flag = flag_wait_for_expo_bidding
			if = {
				limit = { NOT = { any_country = { has_country_flag = flag_wait_for_expo_bidding } } }
				event_target:global_event_country = {
					country_event = { id = MECR_EXPO.412 }
				}
			}
			else = {
				event_target:global_event_country = {
					country_event = { id = MECR_EXPO.412 days = 2 }
				}
			}
		}
	}
}
country_event = { #412.【目录】决定东道主中标，只有在所有人都投标完毕后才能触发成功(420.)
	id = MECR_EXPO.412
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = global_event
		NOT = { has_global_flag = flag_expo_bidding_complete }
		NOT = {
			any_country = {
				has_country_flag = flag_wait_for_expo_bidding
			}
		}
	}

	immediate = {
		set_timed_global_flag = {
			flag = flag_expo_bidding_complete
			days = 360
		}
		# 寻找中标者
		find_expo_champion_diplo_weight = {
			category = bid
		}
		# 参与竞标失败者退回半数花费
		every_country = {
			limit = { check_variable = { which = expo_bid_result value = 1 } }
			if = {
				limit = { check_variable = { which = expo_bid_ranking value = 3 } }
				add_resource = { influence = 50 }
			}
			else_if = {
				limit = { check_variable = { which = expo_bid_ranking value = 2 } }
				add_resource = { influence = 100 }
			}
			else_if = {
				limit = { NOT = { is_same_value = event_target:expo_bid_ranking_1st } }
				add_resource = { influence = 150 }
			}
		}
		event_target:expo_bid_ranking_1st = {
			remove_country_flag = flag_expo_bid_ranking_1st
		}
		event_target:expo_bid_ranking_2nd = {
			remove_country_flag = flag_expo_bid_ranking_2nd
		}
		event_target:expo_bid_ranking_3rd = {
			remove_country_flag = flag_expo_bid_ranking_3rd
		}
		# 移除总排行标记
		every_country = {
			limit = { has_country_flag = flag_expo_total_grade_good }
			remove_country_flag = flag_expo_total_grade_good
		}
		every_country = {
			limit = { has_country_flag = flag_expo_total_grade_normal }
			remove_country_flag = flag_expo_total_grade_normal
		}
		every_country = {
			limit = { has_country_flag = flag_expo_total_grade_normal }
			remove_country_flag = flag_expo_total_grade_normal
		}
		event_target:expo_total_ranking_1st = {
			remove_country_flag = flag_expo_total_ranking_1st
			clear_global_event_target = expo_total_ranking_1st
		}
		event_target:expo_total_ranking_2nd = {
			remove_country_flag = flag_expo_total_ranking_2nd
			clear_global_event_target = expo_total_ranking_2nd
		}
		event_target:expo_total_ranking_3rd = {
			remove_country_flag = flag_expo_total_ranking_3rd
			clear_global_event_target = expo_total_ranking_3rd
		}

		every_country = {
			limit = { has_country_flag = expo_ending_ongoing }
			remove_country_flag = expo_ending_ongoing
			country_event = {
				id = MECR_EXPO.420
			}
		}
	}
}
country_event = { #420.闭幕式，完成参与国各自的收尾工作
	id = MECR_EXPO.420
	title = "MECR_EXPO.420.title"
	desc = {
		text = "MECR_EXPO.420.desc.winner"
		trigger = {
			is_active_resolution = resolution_the_galactic_expo
			is_same_value = event_target:expo_bid_ranking_1st
		}
	}
	desc = {
		text = "MECR_EXPO.420.desc"
		trigger = {
			is_active_resolution = resolution_the_galactic_expo
			exists = event_target:expo_bid_ranking_1st
			NOT = { is_same_value = event_target:expo_bid_ranking_1st }
		}
	}
	desc = {
		text = "MECR_EXPO.420.desc.no_winner"
		trigger = {
			is_active_resolution = resolution_the_galactic_expo
			NOT = { exists = event_target:expo_bid_ranking_1st } 
		}
	}
	desc = {
		text = "MECR_EXPO.420.desc.no_more_expo"
		trigger = {
			NOT = { is_active_resolution = resolution_the_galactic_expo }
			NOT = { has_country_flag = flag_expo_hater }
		}
	}
	desc = {
		text = "MECR_EXPO.420.desc.no_more_expo_hater"
		trigger = {
			NOT = { is_active_resolution = resolution_the_galactic_expo }
			has_country_flag = flag_expo_hater
		}
	}
	picture = GFX_evt_crisis_defeated
	is_triggered_only = yes
	
	immediate = {
		end_event_chain = the_galactic_expo_ongoing
		remove_modifier = expo_ongoing_happiness
		remove_modifier = expo_ongoing_upkeep
		remove_modifier = expo_ongoing_diplomacy
		every_owned_planet = {
			limit = { has_deposit = d_expo_exhibition_center }
			remove_deposit = d_expo_exhibition_center
			add_deposit = d_expo_former_exhibition_center
		}
		if = {
			limit = { NOT = { is_active_resolution = resolution_the_galactic_expo } }
			clear_variable = expo_bid_result
			clear_variable = expo_bid_ranking
		}
	}

	option = {
		name = "MECR_EXPO.420.option"
		trigger = {
			is_active_resolution = resolution_the_galactic_expo
			NOT = { has_ethic = ethic_fanatic_xenophobe }
		}
		add_resource = {
			unity = 1000
			influence = 100
		}
	}
	option = {
		name = "MECR_EXPO.420.option.fanatic_xenophobe"
		trigger = {
			is_active_resolution = resolution_the_galactic_expo
			has_ethic = ethic_fanatic_xenophobe
		}
	}
	option = {
		name = "MECR_EXPO.420.option.no_more_expo"
		trigger = {
			NOT = { is_active_resolution = resolution_the_galactic_expo }
			NOT = { has_ethic = ethic_fanatic_xenophobe }
		}
	}
	option = {
		name = "MECR_EXPO.420.option.no_more_expo.fanatic_xenophobe"
		trigger = {
			NOT = { is_active_resolution = resolution_the_galactic_expo }
			has_ethic = ethic_fanatic_xenophobe
		}
	}
	after = {
		tooltip = {
			end_event_chain = the_galactic_expo_ongoing
		}
		hidden_effect = {
			if = {
				limit = { is_same_value = event_target:expo_organiser }
				clear_global_event_target = expo_organiser
				clear_global_event_target = expo_exhibition_center
			}
		}
	}
}
country_event = { #421.【目录】闭幕式后处理任务，全部国完成前维持自身循环。完成全局的收尾工作，解锁并归零时间表（450.）(421.)[400.]
	id = MECR_EXPO.421
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_country_flag = flag_MECR_EXPO_421_timer
				any_country = { has_country_flag = expo_ending_ongoing }
			}
			country_event = {
				id = MECR_EXPO.421
				days = 1
			}
		}
		else = {
			remove_global_flag = debug_expo_ending_event
			set_global_flag = flag_first_expo_complete
			clear_global_event_target = expo_sponsor
			clear_global_event_target = expo_sponsor_home_system
			clear_global_event_target = expo_curators
			clear_global_event_target = expo_artists
			if = {
				limit = { is_active_resolution = resolution_the_galactic_expo }
				every_galcom_member = {
					if = {
						limit = { NOT = { any_situation = { is_situation_type = situation_galactic_expo } } }
						start_situation = { type = situation_galactic_expo target = This }
					}
					random_situation = {
						limit = { is_situation_type = situation_galactic_expo }
						set_situation_locked = no
						remove_situation_flag = flag_expo_situation_paused

						export_trigger_value_to_variable = { trigger = situation_progress variable = situation_progress_var }
						multiply_variable = { which = situation_progress_var value = -1 }
						add_situation_progress = situation_progress_var
						
						set_situation_approach = expo_recess_approach_do_nothing
					}
					#expo_situation_continue = yes
					#expo_situation_set_progress = { progress = 0 }
				}
				set_global_flag = flag_debug_1
				country_event = {
					id = MECR_EXPO.450
					days = 3600
				}
			}
			else_if = {
				limit = { NOT = { is_active_resolution = resolution_the_galactic_expo } }
				clear_global_event_target = expo_bid_ranking_1st
				clear_global_event_target = expo_bid_ranking_2nd
				clear_global_event_target = expo_bid_ranking_3rd
				every_galcom_member = {
					every_situation = {
						limit = { is_situation_type = situation_galactic_expo }
						destroy_situation = This
					}
					#expo_situation_end = yes
				}
			}
		}
	}
}

# 十年后，下一届银河博览会开始前的准备
country_event = { #450.【目录】判定能否开始，如果银河和平则开始，如果银河动荡则锁定时间表（460.451.）
	id = MECR_EXPO.450
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_active_resolution = resolution_the_galactic_expo
		NOT = { has_global_flag = expo_starting_checking } #这是用来修复.450重复触发的bug的
	}

	immediate = {
		set_global_flag = expo_starting_checking #这是用来修复.450重复触发的bug的
		if = {
			limit = { galaxy_is_peace = yes }
			country_event = {
				id = MECR_EXPO.460
			}
		}
		else = {
			set_global_flag = flag_expo_war_delay
			every_galcom_member = {
				random_situation = {
					limit = { is_situation_type = situation_galactic_expo }
					set_situation_locked = yes
					set_situation_flag = flag_expo_situation_paused
				}
				#expo_situation_pause = yes
				country_event = {
					id = MECR_EXPO.451
				}
			}
		}
	}

}
country_event = { #451.银河动荡，银博会延期通知
	id = MECR_EXPO.451
	title = "MECR_EXPO.451.title"
	desc = "MECR_EXPO.451.desc"
	picture = GFX_evt_crisis_defeated
	show_sound = event_space_battle
	is_triggered_only = yes

	option = {
		name = "UNFORTUNATE"
		tooltip = {
			random_situation = {
				limit = { is_situation_type = situation_galactic_expo }
				set_situation_locked = yes
			}
		}
	}
}
country_event = { #460.【目录】银河和平，开始为下一届银河博览会选定举办国[450.]
	id = MECR_EXPO.460
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		galaxy_is_peace = yes
	}
	
	immediate = {
		if = { #上次第一
			limit = { exists = event_target:expo_bid_ranking_1st }
			set_global_flag = flag_expo_on_1st
			event_target:expo_bid_ranking_1st = {
				country_event = {
					id = MECR_EXPO.1
				}
			}
		}
		else_if = { #第一没了，顺延到第二
			limit = { exists = event_target:expo_bid_ranking_2nd }
			set_global_flag = flag_expo_on_queue
			event_target:expo_bid_ranking_2nd = {
				country_event = {
					id = MECR_EXPO.1
				}
			}
		}
		else_if = { #第二没了，顺延到第三
			limit = { exists = event_target:expo_bid_ranking_3rd }
			set_global_flag = flag_expo_on_queue
			event_target:expo_bid_ranking_3rd = {
				country_event = {
					id = MECR_EXPO.1
				}
			}
		}
		else_if = { #第三没了，顺延到随机投标者
			limit = { any_galcom_member = { check_variable = { which = expo_bid_result value = 1 } } }
			set_global_flag = flag_expo_on_queue
			if = {
				limit = { any_galcom_member = { check_variable = { which = expo_bid_ranking value = 1 } } }
				random_galcom_member = {
					limit = { check_variable = { which = expo_bid_ranking value = 1 } }
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else_if = {
				limit = { any_galcom_member = { check_variable = { which = expo_bid_ranking value = 2 } } }
				random_galcom_member = {
					limit = { check_variable = { which = expo_bid_ranking value = 2 } }
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else = {
				random_galcom_member = {
					limit = { check_variable = { which = expo_bid_result value = 1 } }
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
		}
		else = { #没有投标者，皇帝/监管人/随机
			set_global_flag = flag_expo_on_random
			if = {
				limit = { has_galactic_emperor = yes }
				galactic_emperor = {
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else_if = {
				limit = { has_galactic_custodian = yes }
				galactic_custodian = {
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else = {
				random_galcom_member = {
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
		}
		every_country = { #清除上次银博会投标记录
			limit = { check_variable = { which = expo_bid_result value = 1 } }
			clear_variable = expo_bid_result
			clear_variable = expo_bid_ranking
		}
	}
}
event = { #461.【目录】银河动荡结束，解锁时间表，为下一届银河博览会选定举办国[on_yearly_pulse]
	id = MECR_EXPO.461
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = flag_expo_war_delay
		galaxy_is_peace = yes
		any_galcom_member = { exists = this }
	}
	
	immediate = {
		every_galcom_member = {
			random_situation = {
				limit = { is_situation_type = situation_galactic_expo }
				set_situation_locked = no
				remove_situation_flag = flag_expo_situation_paused
			}
			#expo_situation_continue = yes
		}
		if = { #上次第一
			limit = { exists = event_target:expo_bid_ranking_1st }
			set_global_flag = flag_expo_on_1st
			event_target:expo_bid_ranking_1st = {
				country_event = {
					id = MECR_EXPO.1
				}
			}
		}
		else_if = { #第一没了，顺延到第二
			limit = { exists = event_target:expo_bid_ranking_2nd }
			set_global_flag = flag_expo_on_queue
			event_target:expo_bid_ranking_2nd = {
				country_event = {
					id = MECR_EXPO.1
				}
			}
		}
		else_if = { #第二没了，顺延到第三
			limit = { exists = event_target:expo_bid_ranking_3rd }
			set_global_flag = flag_expo_on_queue
			event_target:expo_bid_ranking_3rd = {
				country_event = {
					id = MECR_EXPO.1
				}
			}
		}
		else_if = { #第三没了，顺延到随机投标者
			limit = { any_galcom_member = { check_variable = { which = expo_bid_result value = 1 } } }
			set_global_flag = flag_expo_on_queue
			if = {
				limit = { any_galcom_member = { check_variable = { which = expo_bid_ranking value = 1 } } }
				random_galcom_member = {
					limit = { check_variable = { which = expo_bid_ranking value = 1 } }
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else_if = {
				limit = { any_galcom_member = { check_variable = { which = expo_bid_ranking value = 2 } } }
				random_galcom_member = {
					limit = { check_variable = { which = expo_bid_ranking value = 2 } }
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else = {
				random_galcom_member = {
					limit = { check_variable = { which = expo_bid_result value = 1 } }
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
		}
		else = { #没有投标者，皇帝/监管人/随机
			set_global_flag = flag_expo_on_random
			if = {
				limit = { has_galactic_emperor = yes }
				galactic_emperor = {
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else_if = {
				limit = { has_galactic_custodian = yes }
				galactic_custodian = {
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
			else = {
				random_galcom_member = {
					country_event = {
						id = MECR_EXPO.1
					}
				}
			}
		}
		every_country = { #清除上次银博会投标记录
			limit = { check_variable = { which = expo_bid_result value = 1 } }
			clear_variable = expo_bid_result
			clear_variable = expo_bid_ranking
		}
	}
}
event = { #470.【目录】检查是否有成员国没有时间表状态，启用时间表并从其他国家的时间表拷贝进度[on_monthly_pulse]
	id = MECR_EXPO.470
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		always = no
		is_active_resolution = resolution_the_galactic_expo
		any_galcom_member = { NOT = { any_situation = { is_situation_type = situation_galactic_expo } } }
	}

	immediate = {
		random_galcom_member = {
			limit = { any_situation = { is_situation_type = situation_galactic_expo } }
			random_situation = {
				limit = { is_situation_type = situation_galactic_expo }
				save_event_target_as = target_expo_situation
				if = {
					limit = { has_situation_flag = flag_expo_situation_paused }
					set_global_flag = flag_expo_situation_paused_export
				}
			}
		}
		every_galcom_member = {
			limit = { NOT = { any_situation = { is_situation_type = situation_galactic_expo } } }
			start_situation = { type = situation_galactic_expo target = This }
			random_situation = {
				limit = { is_situation_type = situation_galactic_expo }
				add_situation_progress = -66
				add_situation_progress = event_target:target_expo_situation.trigger:situation_progress
				if = {
					limit = { has_global_flag = flag_expo_situation_paused_export }
					set_situation_locked = yes
					set_situation_flag = flag_expo_situation_paused
				}
			}
		}
		remove_global_flag = flag_expo_situation_paused_export
	}
}

# 独立的奖励事件
country_event = { #1001.文化艺术第一，赠送一个免费的圣遗物，保证不会是空的[403.]
	id = MECR_EXPO.1001
	title = cara_home_lootbox.title
	desc = {
		trigger = { has_country_flag = recent_empty_lootbox }
		text = openedlootboxdesc1
	}
	desc = {
		trigger = {
			has_country_flag = recent_galatron
			NOT = { has_modifier = galatron_modifier }
		}
		text = lootbox_contents_galatron
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_a }
								text = lootbox_contents_a
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_b }
								text = lootbox_contents_b
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_c }
								text = lootbox_contents_c
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_d }
								text = lootbox_contents_d
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_e }
								text = lootbox_contents_e
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_f }
								text = lootbox_contents_f
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_g }
								text = lootbox_contents_g
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_h }
								text = lootbox_contents_h
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_i }
								text = lootbox_contents_i
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_j }
								text = lootbox_contents_j
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_k }
								text = lootbox_contents_k
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_l }
								text = lootbox_contents_l
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_m }
								text = lootbox_contents_m
	}
	desc = {
		trigger = { has_country_flag = lootbox_contents_n }
								text = lootbox_contents_n
	}
	diplomatic = yes
	is_triggered_only = yes
	custom_gui = "enclave_caravaneer_window"
	show_sound = event_lootbox_good

	picture_event_data = {
		portrait = event_target:caravaneer_home_country.ruler
		room = caravaneer_lootbox_room
		planet_background = pc_barren_cold
	}

	immediate = {
		random_list = {
			# Galatron
			1 = {
				modifier = {
					factor = 0
					any_playable_country = {
						has_modifier = galatron_modifier
					}
				}
				set_country_flag = recent_galatron
				set_country_flag = galatron_owner
			}
			# Empty
			#59 = {
			#	modifier = {
			#		factor = 0
			#		has_country_flag = opened_empty_lootbox
			#	}
			#	custom_tooltip = lootbox_contents_empty
			#	set_country_flag = opened_empty_lootbox
			#	set_country_flag = recent_empty_lootbox
			#}
			# Regular contents
			140 = {
				random_list = {
					100 = {
						modifier = {
							factor = 0
							capital_scope = { has_modifier = ancient_trade_route }
						}
						set_country_flag = lootbox_contents_a
					}
					100 = { set_country_flag = lootbox_contents_b }
					#100 = { set_country_flag = lootbox_contents_c }
					100 = { set_country_flag = lootbox_contents_d }
					#100 = { set_country_flag = lootbox_contents_e }
					100 = { set_country_flag = lootbox_contents_f }
					#100 = { set_country_flag = lootbox_contents_g }
					100 = { set_country_flag = lootbox_contents_h }
					100 = { set_country_flag = lootbox_contents_i }
					100 = { set_country_flag = lootbox_contents_j }
					100 = { set_country_flag = lootbox_contents_k }
					1 = {
						modifier = {
							factor = 0
							exists = ruler
							ruler = { has_trait = leader_trait_ruler_psionic }
						}
						modifier = {
							factor = 0
							has_ethic = ethic_gestalt_consciousness
						}
						set_country_flag = lootbox_contents_l
					}
					100 = { set_country_flag = lootbox_contents_m }
					100 = { set_country_flag = lootbox_contents_n }
				}
			}
		}
	}

	after = {
		hidden_effect = {
			switch = {
				trigger = has_country_flag
				lootbox_contents_a = { remove_country_flag = lootbox_contents_a }
				lootbox_contents_b = { remove_country_flag = lootbox_contents_b }
				lootbox_contents_c = { remove_country_flag = lootbox_contents_c }
				lootbox_contents_d = { remove_country_flag = lootbox_contents_d }
				lootbox_contents_e = { remove_country_flag = lootbox_contents_e }
				lootbox_contents_f = { remove_country_flag = lootbox_contents_f }
				lootbox_contents_g = { remove_country_flag = lootbox_contents_g }
				lootbox_contents_h = { remove_country_flag = lootbox_contents_h }
				lootbox_contents_i = { remove_country_flag = lootbox_contents_i }
				lootbox_contents_j = { remove_country_flag = lootbox_contents_j }
				lootbox_contents_k = { remove_country_flag = lootbox_contents_k }
				lootbox_contents_l = { remove_country_flag = lootbox_contents_l }
				lootbox_contents_m = { remove_country_flag = lootbox_contents_m }
				lootbox_contents_n = { remove_country_flag = lootbox_contents_n }
				lootbox_contents_p = { remove_country_flag = recent_empty_lootbox }
			}
			if = {
				limit = {
					has_country_flag = recent_galatron
					NOT = { has_modifier = galatron_modifier }
				}
				remove_country_flag = recent_galatron
				country_event = { id = cara.320 }
			}
		}
	}

	option = {
		custom_gui = "enclave_caravaneer_option"
		name = OK

		hidden_effect = {
			if = {
				limit = {
					has_country_flag = recent_galatron
					NOT = { has_modifier = galatron_modifier }
				}
				custom_tooltip = lootbox_contents_galatron
			}
			else_if = {
				limit = { has_country_flag = recent_empty_lootbox }
				custom_tooltip = lootbox_contents_empty
				remove_country_flag = recent_empty_lootbox
			}
			else = {
				switch = {
					trigger = has_country_flag
					lootbox_contents_a = {
						capital_scope = { add_modifier = { modifier = ancient_trade_route days = -1 } }
						tooltip = {
							capital_scope = { add_modifier = { modifier = ancient_trade_route days = -1 } }
						}
					}
					lootbox_contents_b = {
						add_monthly_resource_mult = {
							resource = consumer_goods
							value = 6
							min = 100
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = consumer_goods
								value = 6
								min = 100
							}
						}
					}
					lootbox_contents_c = {
						custom_tooltip = lootbox_contents_c.tooltip
					}
					lootbox_contents_d = {
						add_monthly_resource_mult = {
							resource = society_research
							value = 24
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = society_research
								value = 24
								min = 2000
							}
						}
					}
					lootbox_contents_e = {
						custom_tooltip = lootbox_contents_e.tooltip
					}
					lootbox_contents_f = {
						add_monthly_resource_mult = {
							resource = food
							value = 24
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = food
								value = 24
								min = 2000
							}
						}
					}
					lootbox_contents_g = {
						custom_tooltip = lootbox_contents_g.tooltip
					}
					lootbox_contents_h = {
						add_monthly_resource_mult = {
							resource = consumer_goods
							value = 8
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = consumer_goods
								value = 8
								min = 2000
							}
						}
					}
					lootbox_contents_i = {
						add_resource = { energy = 4000 }
						add_resource = { minerals = 4000 }
						tooltip = {
							add_resource = { energy = 4000 }
							add_resource = { minerals = 4000 }
						}
					}
					lootbox_contents_j = {
						add_monthly_resource_mult = {
							resource = engineering_research
							value = 25
							min = 2000
							max = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = engineering_research
								value = 25
								min = 2000
								max = 2000
							}
						}
					}
					lootbox_contents_k = {
						add_monthly_resource_mult = {
							resource = society_research
							value = 25
							min = 1000
							max = 1000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = society_research
								value = 25
								min = 1000
								max = 1000
							}
						}
					}
					lootbox_contents_l = {
						ruler = { add_trait = leader_trait_ruler_psionic }
						tooltip = { ruler = { add_trait = leader_trait_ruler_psionic } }
					}
					lootbox_contents_m = {
						add_monthly_resource_mult = {
							resource = physics_research
							value = 24
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = physics_research
								value = 24
								min = 2000
							}
						}
					}
					lootbox_contents_n = {
						add_monthly_resource_mult = {
							resource = alloys
							value = 24
							min = 2000
						}
						tooltip = {
							add_monthly_resource_mult = {
								resource = alloys
								value = 24
								min = 2000
							}
						}
					}
				}
			}
		}
	}

	option = {
		custom_gui = "enclave_caravaneer_option"
		name = cara_home_exit
		trigger = { always = no } # just here to for the X button
		default_hide_option = yes
	}
}
country_event = { #1002.历史传统第一，赠送一次免费的政府改革，即改革完毕后退还花费[on_pre_government_changed]
	id = MECR_EXPO.1002
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		check_variable = { which = EXPO_award_history_1st value > 0 }
	}

	immediate = {
		subtract_variable = { which = EXPO_award_history_1st value = 1 }
		export_trigger_value_to_variable = {
			trigger = empire_size
			variable = EXPO_award_history_1st_unity
		}
		add_resource = {
			unity = 1
			mult = EXPO_award_history_1st_unity
		}
		clear_variable = EXPO_award_history_1st_unity
	}
}