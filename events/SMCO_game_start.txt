namespace = SMCO_game_start

event = {
	id = SMCO_game_start.1
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = { NOT = { has_global_flag = SMCO_enabled } }
	immediate = {
		set_global_flag = SMCO_enabled
		log = "Slightly More Celestial Objects (SMCO) enabled!"
	}
}

event = {
	id = SMCO_game_start.3
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes

	immediate = {
		every_country = {
			limit = { is_country_type = cloud_feeding }

			add_modifier = {
				modifier = SMCO_cloud_buff
				days = -1
			}
		}
	}
}

event = {
	id = SMCO_game_start.4
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_system = {
			# Void Cloud system
			if = {
				limit = {
					has_star_flag = hostile_system
					has_star_flag = void3_system
					star = { NOT = { has_modifier = SMCO_reissner_black_hole_modifier } }
				}

				every_system_planet = {
					limit = { is_planet_class = pc_black_hole }

					add_modifier = {
						modifier = SMCO_reissner_black_hole_modifier
						days = -1
					}
				}
			}

			# Other Void Cloud systems (should include Great Wound)
			if = {
				limit = {
					is_star_class = sc_black_hole
					any_ship_in_system = {
						is_ship_size = space_cloud
						owner = { NOT = { is_country_type = vluur } }
					}
					star = { NOT = { has_modifier = SMCO_reissner_black_hole_modifier } }
					NOT = { has_star_flag = void3_system }
				}

				every_system_planet = {
					if = {
						limit = { is_planet_class = pc_black_hole }
	
						add_modifier = {
							modifier = SMCO_reissner_black_hole_modifier
							days = -1
						}
					}
				}
			}
		}

		every_system = { SMCO_black_hole_entities = yes }
		random_country = {
			limit = { is_ai = no }
			country_event = {
				id = SMCO_game_start.5
				days = 5
			}
		}
	}
}

# Do a final black hole cleanup
country_event = {
	id = SMCO_game_start.5
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes

	immediate = {
		from = {
			every_system = {
				limit = {
					has_planet_class = pc_black_hole
					NOT = { has_modifier = SMCO_reissner_black_hole_modifier }
					NOT = { has_modifier = SMCO_kerr_black_hole_modifier }
					NOT = { has_modifier = SMCO_schwarzschild_black_hole_modifier }
				}
				if = {
					limit = { has_planet_class = pc_black_hole }
					every_system_planet = {
						limit = {
							is_planet_class = pc_black_hole
							NOT = { has_modifier = SMCO_reissner_black_hole_modifier }
							NOT = { has_modifier = SMCO_kerr_black_hole_modifier }
							NOT = { has_modifier = SMCO_schwarzschild_black_hole_modifier }
						}
	
						add_modifier = {
							modifier = SMCO_schwarzschild_black_hole_modifier
							days = -1
						}
						set_planet_entity = { entity = SMCO_schwarzschild_black_hole_01_entity }
					}
				}
			}
		}
	}
}

# Spawn rogue planet 'systems'
event = {
	id = SMCO_game_start.6
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_spawn_system_batch = begin
		no_scope = {
			# Tiny galaxy
			if = {
				limit = { galaxy_size = tiny }

				while = {
					count = @galaxysmall_rogue_system
					random_system = {

						SMCO_rogue_planet_system_spawn = yes
						if = {
							limit = { exists = event_target:SMCO_rogue_planet_system_1 }
							
							event_target:SMCO_rogue_planet_system_1 = {
								every_system_planet = {
									if = {
										limit = { is_planet_class = pc_SMCO_small_rogue_planet }
						
										SMCO_rogue_planet_modifiers = yes
									}
									if = {
										limit = { NOT = { is_planet_class = pc_SMCO_void_star } }
	
										SMCO_rogue_planet_deposits = yes
									}
								}
								isolate_system = yes
							}
							clear_global_event_target = SMCO_rogue_planet_system_1
						}
						else_if = {
							limit = { exists = event_target:SMCO_rogue_planet_system_2 }
							
							event_target:SMCO_rogue_planet_system_2 = {
								every_system_planet = {
									if = {
										limit = { is_planet_class = pc_SMCO_small_rogue_planet }
						
										SMCO_rogue_planet_modifiers = yes
									}
									if = {
										limit = { NOT = { is_planet_class = pc_SMCO_void_star } }
	
										SMCO_rogue_planet_deposits = yes
									}
								}
								isolate_system = yes
							}
							clear_global_event_target = SMCO_rogue_planet_system_2
						}
					}
				}
			}
			
			# Small galaxy
			if = {
				limit = { galaxy_size = small }

				while = {
					count = @galaxysmall_rogue_system
					random_system = {

						SMCO_rogue_planet_system_spawn = yes
						if = {
							limit = { exists = event_target:SMCO_rogue_planet_system_1 }
							
							event_target:SMCO_rogue_planet_system_1 = {
								every_system_planet = {
									if = {
										limit = { is_planet_class = pc_SMCO_small_rogue_planet }
						
										SMCO_rogue_planet_modifiers = yes
									}
									if = {
										limit = { NOT = { is_planet_class = pc_SMCO_void_star } }
	
										SMCO_rogue_planet_deposits = yes
									}
								}
								isolate_system = yes
							}
							clear_global_event_target = SMCO_rogue_planet_system_1
						}
						else_if = {
							limit = { exists = event_target:SMCO_rogue_planet_system_2 }
							
							event_target:SMCO_rogue_planet_system_2 = {
								every_system_planet = {
									if = {
										limit = { is_planet_class = pc_SMCO_small_rogue_planet }
						
										SMCO_rogue_planet_modifiers = yes
									}
									if = {
										limit = { NOT = { is_planet_class = pc_SMCO_void_star } }
	
										SMCO_rogue_planet_deposits = yes
									}
								}
								isolate_system = yes
							}
							clear_global_event_target = SMCO_rogue_planet_system_2
						}
					}
				}
			}

			# Medium galaxy
			if = {
				limit = { galaxy_size = medium }

				while = {
					count = @galaxysmall_rogue_system
					random_system = {

						SMCO_rogue_planet_system_spawn = yes
						if = {
							limit = { exists = event_target:SMCO_rogue_planet_system_1 }
							
							event_target:SMCO_rogue_planet_system_1 = {
								every_system_planet = {
									if = {
										limit = { is_planet_class = pc_SMCO_small_rogue_planet }
						
										SMCO_rogue_planet_modifiers = yes
									}
									if = {
										limit = { NOT = { is_planet_class = pc_SMCO_void_star } }
	
										SMCO_rogue_planet_deposits = yes
									}
								}
								isolate_system = yes
							}
							clear_global_event_target = SMCO_rogue_planet_system_1
						}
						else_if = {
							limit = { exists = event_target:SMCO_rogue_planet_system_2 }
							
							event_target:SMCO_rogue_planet_system_2 = {
								every_system_planet = {
									if = {
										limit = { is_planet_class = pc_SMCO_small_rogue_planet }
						
										SMCO_rogue_planet_modifiers = yes
									}
									if = {
										limit = { NOT = { is_planet_class = pc_SMCO_void_star } }
	
										SMCO_rogue_planet_deposits = yes
									}
								}
								isolate_system = yes
							}
							clear_global_event_target = SMCO_rogue_planet_system_2
						}
					}
				}
			}

			# Large galaxy
			if = {
				limit = { galaxy_size = large }

				while = {
					count = @galaxysmall_rogue_system
					random_system = {

						SMCO_rogue_planet_system_spawn = yes
						if = {
							limit = { exists = event_target:SMCO_rogue_planet_system_1 }
							
							event_target:SMCO_rogue_planet_system_1 = {
								every_system_planet = {
									if = {
										limit = { is_planet_class = pc_SMCO_small_rogue_planet }
						
										SMCO_rogue_planet_modifiers = yes
									}
									if = {
										limit = { NOT = { is_planet_class = pc_SMCO_void_star } }
	
										SMCO_rogue_planet_deposits = yes
									}
								}
								isolate_system = yes
							}
							clear_global_event_target = SMCO_rogue_planet_system_1
						}
						else_if = {
							limit = { exists = event_target:SMCO_rogue_planet_system_2 }
							
							event_target:SMCO_rogue_planet_system_2 = {
								every_system_planet = {
									if = {
										limit = { is_planet_class = pc_SMCO_small_rogue_planet }
						
										SMCO_rogue_planet_modifiers = yes
									}
									if = {
										limit = { NOT = { is_planet_class = pc_SMCO_void_star } }
	
										SMCO_rogue_planet_deposits = yes
									}
								}
								isolate_system = yes
							}
							clear_global_event_target = SMCO_rogue_planet_system_2
						}
					}
				}
			}

			# Huge galaxy
			if = {
				limit = { galaxy_size = huge }

				while = {
					count = @galaxysmall_rogue_system
					random_system = {

						SMCO_rogue_planet_system_spawn = yes
						if = {
							limit = { exists = event_target:SMCO_rogue_planet_system_1 }
							
							event_target:SMCO_rogue_planet_system_1 = {
								every_system_planet = {
									if = {
										limit = { is_planet_class = pc_SMCO_small_rogue_planet }
						
										SMCO_rogue_planet_modifiers = yes
									}
									if = {
										limit = { NOT = { is_planet_class = pc_SMCO_void_star } }
	
										SMCO_rogue_planet_deposits = yes
									}
								}
								isolate_system = yes
							}
							clear_global_event_target = SMCO_rogue_planet_system_1
						}
						else_if = {
							limit = { exists = event_target:SMCO_rogue_planet_system_2 }
							
							event_target:SMCO_rogue_planet_system_2 = {
								every_system_planet = {
									if = {
										limit = { is_planet_class = pc_SMCO_small_rogue_planet }
						
										SMCO_rogue_planet_modifiers = yes
									}
									if = {
										limit = { NOT = { is_planet_class = pc_SMCO_void_star } }
	
										SMCO_rogue_planet_deposits = yes
									}
								}
								isolate_system = yes
							}
							clear_global_event_target = SMCO_rogue_planet_system_2
						}
					}
				}
			}

			# In case people use larger galaxies than the default
			if = {
				limit = {
					NOR = {
						galaxy_size = tiny
						galaxy_size = small
						galaxy_size = medium
						galaxy_size = large
						galaxy_size = huge
					}
				}

				while = {
					count = @galaxymisc_rogue_system
					random_system = {

						SMCO_rogue_planet_system_spawn = yes
						if = {
							limit = { exists = event_target:SMCO_rogue_planet_system_1 }
							
							event_target:SMCO_rogue_planet_system_1 = {
								every_system_planet = {
									if = {
										limit = { is_planet_class = pc_SMCO_small_rogue_planet }
						
										SMCO_rogue_planet_modifiers = yes
									}
									if = {
										limit = { NOT = { is_planet_class = pc_SMCO_void_star } }
	
										SMCO_rogue_planet_deposits = yes
									}
								}
								isolate_system = yes
							}
							clear_global_event_target = SMCO_rogue_planet_system_1
						}
						else_if = {
							limit = { exists = event_target:SMCO_rogue_planet_system_2 }
							
							event_target:SMCO_rogue_planet_system_2 = {
								every_system_planet = {
									if = {
										limit = { is_planet_class = pc_SMCO_small_rogue_planet }
						
										SMCO_rogue_planet_modifiers = yes
									}
									if = {
										limit = { NOT = { is_planet_class = pc_SMCO_void_star } }
	
										SMCO_rogue_planet_deposits = yes
									}
								}
								isolate_system = yes
							}
							clear_global_event_target = SMCO_rogue_planet_system_2
						}
					}
				}
			}
		}
		set_spawn_system_batch = end
	}
}

# Spawn rogue planet event 'system'
event = {
	id = SMCO_game_start.7
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_spawn_system_batch = begin
		no_scope = {
			random_system = {
				limit = {
					NOR = {
						is_fe_cluster = yes
						has_star_flag = empire_cluster
					}
				}

				spawn_system = { initializer = "SMCO_rogue_planet_event_system" }
				if = {
					limit = { exists = event_target:SMCO_rogue_event_system }
	
					event_target:SMCO_rogue_event_system = {
						every_system_planet = {
							if = {
								limit = { is_planet_class = pc_SMCO_small_rogue_planet }
				
								SMCO_rogue_planet_modifiers = yes
							}
							if = {
								limit = {
									OR = {
										is_planet_class = pc_SMCO_small_rogue_planet
										is_planet_class = pc_SMCO_sub_brown_dwarf_planet
										is_planet_class = pc_SMCO_sub_brown_dwarf_star
									}
								}
	
								SMCO_rogue_planet_deposits = yes
							}
						}
						isolate_system = yes
					}
				}
			}
		}
		set_spawn_system_batch = end
	}
}

# Bok globule nebula art and 100 years til star formation
event = {
	id = SMCO_game_start.8
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_system = {
			limit = { has_star_flag = bok_globules }

			random_list = {
				25 = { SMCO_create_nebula_1 = yes }
				20 = { SMCO_create_nebula_2 = yes }
				20 = { SMCO_create_nebula_3 = yes }
				5 = { SMCO_create_rare_nebula_1 = yes }
			}
		}
		every_planet = {
			planet_event = {
				id = SMCO_bok_globule.1
				days = 36000
			}
		}
	}
}

event = {
	id = SMCO_game_start.9
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = { is_ai = yes }

			give_technology = { tech = tech_SMCO_faint_hyperlane_stabilization }
		}
	}
}