namespace = SMCO_rogue_planet

ship_event = {
	id = SMCO_rogue_planet.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		owner = { save_event_target_as = ship_owner }
		if = {
			limit = {
				from = {
					any_neighbor_system = {
						ignore_hyperlanes = yes
						OR = {
							is_star_class = sc_SMCO_void
							is_star_class = sc_SMCO_rogue_event
						}
					}
				}
			}

			event_target:ship_owner = {
				if = {
					limit = {
						NOT = { has_country_flag = SMCO_something_detected }
						root = { is_ship_class = shipclass_science_ship }
						NOT = { has_technology = tech_experimental_subspace_navigation }
					}
					
					log = "Running SMCO_rogue_planet.2 activation"
					country_event = { id = SMCO_rogue_planet.2 days = 1 }
				}
			}
		}
	}
}

country_event = {
	id = SMCO_rogue_planet.2
	title = "SMCO_rogue_planet.2.title"
	desc = "SMCO_rogue_planet.2.desc"
	picture = GFX_evt_SMCO_empty_space
	location = from.solar_system

	is_triggered_only = yes

	option = {
		name = "SMCO_rogue_planet.2.ok"
		hidden_effect = { set_country_flag = SMCO_something_detected }
	}
}

ship_event = {
	id = SMCO_rogue_planet.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_ship_class = shipclass_science_ship
		leader = { leader_class = scientist }
		owner = { has_technology = tech_experimental_subspace_navigation }
	}

	immediate = {
		owner = { save_event_target_as = ship_owner }
		from = {
			every_neighbor_system = {
				ignore_hyperlanes = yes
				if = {
					limit = {
						OR = {
							has_planet_class = pc_SMCO_void_star
							has_planet_class = pc_SMCO_sub_brown_dwarf_star
						}
						NOT = { has_star_flag = SMCO_connected }
					}
					
					add_hyperlane = {
						from = this
						to = prev
					}
					set_star_flag = SMCO_connected

					every_system_planet = {
						limit = { is_planet_class = pc_SMCO_void_star }
		
						surveyed = {
							set_surveyed = yes
							surveyor = event_target:ship_owner
						}
					}

					event_target:ship_owner = {
						if = {
							limit = { NOT = { has_country_flag = SMCO_rogue_planet_linked_first } }

							set_country_flag = SMCO_rogue_planet_linked_first
						}
						if = {
							limit = {
								NOT = { has_country_flag = SMCO_something_detected }
								is_ai = no
							}

							country_event = {
								id = SMCO_rogue_planet.4
								days = 1
							}
						}
						if = {
							limit = {
								has_country_flag = SMCO_something_detected
								is_ai = no
							}
			
							country_event = {
								id = SMCO_rogue_planet.5
								days = 1
							}
						}
					}
				}
			}
		}
	}
}

country_event = {
	id = SMCO_rogue_planet.4
	is_triggered_only = yes
	title = "SMCO_rogue_planet.4.title"
	desc = "SMCO_rogue_planet.4.desc"
	location = fromfrom
	picture = GFX_evt_SMCO_empty_space

	option = {
		trigger = {
			NOR = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_militarist
			}
		}
		name = "SMCO_rogue_planet.4.a"
		hidden_effect = { set_country_flag = SMCO_something_detected }
	}

	option = {
		trigger = {
			OR = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_militarist
			}
		}
		name = "SMCO_rogue_planet.4.b"
		hidden_effect = { set_country_flag = SMCO_something_detected }
	}
}

country_event = {
	id = SMCO_rogue_planet.5
	is_triggered_only = yes
	title = "SMCO_rogue_planet.4.title"
	desc = "SMCO_rogue_planet.5.desc"
	location = fromfrom
	picture = GFX_evt_SMCO_empty_space

	option = {
		trigger = {
			NOR = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_militarist
			}
		}
		name = "SMCO_rogue_planet.4.a"
	}

	option = {
		trigger = {
			OR = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_militarist
			}
		}
		name = "SMCO_rogue_planet.4.b"
	}
}

fleet_event = {
	id = SMCO_rogue_planet.6
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = {
				from = {
					OR = {
						is_star_class = sc_SMCO_void
						is_star_class = sc_SMCO_rogue_event
					}
				}
				root = { NOT = { is_ship_class = shipclass_science_ship } }
				owner = {
					OR = {
						is_regular_empire = yes
						is_gestalt = yes
					}
					NOT = { has_technology = tech_SMCO_faint_hyperlane_stabilization }
				}
			}

			hidden_effect = { delete_fleet = root }
		}
	}
}

ship_event = {
	id = SMCO_rogue_planet.7
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		from = {
			OR = {
				is_star_class = sc_SMCO_rogue_event
				is_star_class = sc_SMCO_void
			}
			NOT = { has_star_flag = SMCO_connected }
		}

		owner = { has_technology = tech_jump_drive_1 }
	}

	immediate = {
		from = {
			every_system_planet = {
				limit = { is_planet_class = pc_SMCO_void_star }

				surveyed = {
					set_surveyed = yes
					surveyor = event_target:ship_owner
				}
			}

			random_neighbor_system = {
				ignore_hyperlanes = yes

				add_hyperlane = {
					from = this
					to = prev
				}
				prev = { set_star_flag = SMCO_connected }
			}

			event_target:ship_owner = {
				if = {
					limit = { NOT = { has_country_flag = SMCO_rogue_planet_linked_first } }

					set_country_flag = SMCO_rogue_planet_linked_first
				}
			}
		}
	}
}

country_event = {
	id = SMCO_rogue_planet.8
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		last_increased_tech = tech_jump_drive_1
		NOR = {
			has_technology = tech_experimental_subspace_navigation
			has_technology = tech_SMCO_faint_hyperlane_stabilization
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_technology = tech_experimental_subspace_navigation } }

			give_technology = { tech = tech_experimental_subspace_navigation }
		}
		if = {
			limit = { NOT = { has_technology = tech_SMCO_faint_hyperlane_stabilization } }

			give_technology = { tech = tech_SMCO_faint_hyperlane_stabilization }
		}
	}
}