namespace = distar

#################################
#
# Anomaly Events
# by Dee Majek
# distar.1 - distar.999
#
#################################

# root = ship scope
# from = planet scope

### Supply Wreckage ###
ship_event = {
	id = distar.1
	title = "distar.1.name"
	desc = "distar.1.desc"
	picture = GFX_evt_space_debris
	show_sound = event_ship_bridge
	location = event_target:supply_wreckage_tar

	is_triggered_only = yes

	trigger = {
		owner = {
			any_neighbor_country = {
				is_ai = yes
				is_country_type = default
				is_homicidal = no
				has_communications = prev
				NOR = {
					is_at_war_with = prev
					is_same_value = prev
				}
			}
		}
	}

	immediate = {
		create_ambient_object = {
			type = "abandoned_ship_object"
			location = from
		}
		last_created_ambient_object = {
			save_event_target_as = supply_wreckage_tar
			set_location = {
				target = from
				distance = 5
				angle = 90
			}
		}
		owner = {
			random_neighbor_country = {
				limit = {
 					is_country_type = default
 					is_homicidal = no
					has_communications = prev
					NOR = {
						is_at_war_with = prev
						is_country = prev
					}
					any_system = { has_access_fleet = prev }
				}
				save_event_target_as = wreckage_owner
			}
		}
	}
	option = {
		name = "distar.1.a"
		owner = { add_resource = { minerals = 300 } }
		custom_tooltip = "distar.1.a.tooltip"
		hidden_effect = { owner = { country_event = { id = distar.2 days = 180 } } }
	}
	option = {
		name = "distar.1.a.alt"
		trigger = {
			owner = { NOT = { is_at_war_with = event_target:wreckage_owner } }
			leader = { has_trait = leader_trait_expertise_statecraft }
		}
		owner = { add_resource = { minerals = 150 } }
		hidden_effect = {
			event_target:wreckage_owner = { add_resource = { minerals = 150 } }
		}
		custom_tooltip = "distar.1.a.tooltip.alt"
		hidden_effect = { owner = { country_event = { id = distar.3 days = 180 } } }
	}
	option = {
		trigger = {
			owner = { NOT = { is_at_war_with = event_target:wreckage_owner } }
		}
		hidden_effect = {
			event_target:wreckage_owner = { add_resource = { minerals = 300 } }
		}
		name = "distar.1.b"
		custom_tooltip = "distar.1.b.tooltip"
		hidden_effect = { owner = { country_event = { id = distar.3 days = 60 } } }
	}
}

country_event = {
	id = distar.2
	title = "distar.2.name"
	desc = {
		trigger = {
			NOT = { has_authority = auth_machine_intelligence }
		}
		text = "distar.2.desc"
	}
	desc = {
		trigger = {
			has_authority = auth_machine_intelligence
		}
		text = "distar.2.desc.machi"
	}
	location = event_target:wreckage_owner

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:wreckage_owner
		planet_background = event_target:wreckage_owner
		graphical_culture = event_target:wreckage_owner
		city_level = event_target:wreckage_owner
		room = event_target:wreckage_owner.ruler
	}

	option = {
		trigger = { resource_stockpile_compare = { resource = minerals value >= 300 } }
		name = distar.2.a
		event_target:wreckage_owner = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_stole_supplies
			}
		}
		hidden_effect = {
			event_target:supply_wreckage_tar = {
				destroy_ambient_object = this
			}
		}
	}

	option = {
		trigger = {
			resource_stockpile_compare = { resource = minerals value >= 300 }
			NOT = { is_at_war_with = event_target:wreckage_owner }
		}
		name = distar.2.b
		add_resource = { minerals = -300 }
		hidden_effect = {
			event_target:wreckage_owner = { add_resource = { minerals = 300 } }
		}
		hidden_effect = {
			event_target:supply_wreckage_tar = {
				destroy_ambient_object = this
			}
		}
	}

	option = {
		trigger = { resource_stockpile_compare = { resource = minerals value < 300 } }
		name = TOOPOOR
		event_target:wreckage_owner = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_stole_supplies
			}
		}
		hidden_effect = {
			event_target:supply_wreckage_tar = {
				destroy_ambient_object = this
			}
		}
	}
}

## Superflare Ancient Civ
ship_event = {
	id = distar.6
	title = "distar.6.name"
	desc = "distar.6.desc"
  	picture = GFX_evt_dead_city
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	immediate = {
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = INTERESTING
		small_artifact_reward = yes
		from = {
			add_deposit = d_society_4
			hidden_effect = { add_modifier = { modifier = frozen_in_time days = -1 } }
		}
	}
}

## Rudimentary Robots
ship_event = {
	id = distar.25
	title = "distar.25.name"
	desc = "distar.25.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	immediate = {
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = INTERESTING
		small_artifact_reward = yes
		custom_tooltip = distar.25.b.tooltip
	}
}

 ## Rudimentary Robots -> Rage Virus Chain
planet_event = {
	id = distar.26
	title = "distar.26.name"
	desc = "distar.26.desc"
	picture = GFX_evt_organic_oppression
	show_sound = event_scanner
	location = root

	is_triggered_only = yes

	trigger = {
		has_planet_flag = primitive_robot_planet
		any_pop = {
			species = {
				has_species_flag = primitive_robots_flag
			}
		}
		owner = {
			is_country_type = default
			NOT = { has_country_flag = cured_rage_virus }
		}
	}

	immediate = {
		planet_event = { id = distar.31 days = 1825 random = 730 }
		set_planet_flag = colony_event
	}

	option = {
		trigger = {
			owner = {
				NOR = {
					has_policy_flag = ai_outlawed
					has_ethic = ethic_gestalt_consciousness
				}
			}
		}
		name = "distar.26.a"
		custom_tooltip = "distar.26.a.tooltip"
		hidden_effect =  { planet_event = { id = distar.27 days = 90 random = 10 } }
	}
	option = {
		trigger = {
			owner = { NOT = { has_policy_flag = ai_outlawed } }
		}
		name = "distar.26.b"
		owner = {
			add_resource = { minerals = 100 }
		}
		root = {
			every_owned_pop = {
				limit = { species = { has_species_flag = primitive_robots_flag } }
				kill_pop = yes
			}
		}
	}
	option = {
		trigger = {
			owner = { has_policy_flag = ai_outlawed }
		}
		name = "distar.26.c"
		owner = {
			add_resource = { minerals = 100 }
		}
		root = {
			every_owned_pop = {
				limit = { species = { has_species_flag = primitive_robots_flag } }
				kill_pop = yes
			}
		}
	}
	option = {
		trigger = {
			owner = { has_authority = auth_machine_intelligence }
		}
		name = "distar.26.mach"
		custom_tooltip = "distar.26.a.tooltip"
		hidden_effect =  { planet_event = { id = distar.27 days = 90 random = 10 } }
	}

	after = {
		hidden_effect = { remove_modifier = "primitive_robots" }
	}
}

planet_event = { #Recursive, spreads every other month as long as have biopops left to spread to on planet
	id = distar.32
	title = "distar.32.name"
	desc = "distar.32.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_planetary_riot
	location = from

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = { NOT = { has_country_flag = cured_rage_virus } }
		any_owned_pop = {
			NOR = {
				has_trait = trait_mechanical
				has_trait = trait_machine_unit
				has_modifier = erratic_behavior
			}
		}
	}

	immediate = {
		IF = {
			limit = {
				count_pops = {
					limit = {
						NOR = {
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
					count < 6
				}
			}
			random_pop = {
				limit = {
					NOR = {
						has_trait = trait_mechanical
						has_trait = trait_machine_unit
						has_modifier = erratic_behavior
					}
				}
				add_modifier = { modifier = erratic_behavior days = -1 }
			}
		}
		else = {
			while = {
				count = 2
				random_pop = {
					limit = {
						NOR = {
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_modifier = erratic_behavior
						}
					}
					add_modifier = { modifier = erratic_behavior days = -1 }
				}
			}
		}
		planet_event = { id = distar.32 days = 60 }
	}

	option = {
		name = WORRYING
	}
}

planet_event = {
	id = distar.35
	title = "distar.35.name"
	desc = "distar.35.desc"
	picture = GFX_evt_interior_battle
	show_sound = event_red_alert
	location = from

	is_triggered_only = yes
	
	immediate = {
		add_modifier = { modifier = researcher_rage days = 365 }
	}

	option = {
		name = "distar.35.a"
		tooltip = { add_modifier = { modifier = researcher_rage days = 365 } }
	}
}

## Dark Flow
ship_event = {
	id = distar.46
	title = "distar.46.name"
	desc = "distar.46.desc"
	picture = GFX_evt_surreal_visions
	show_sound = event_scanner
	location = event_target:dark_flow_gateway
	
	is_triggered_only = yes

	immediate = {
		random_system_megastructure = {
			limit = {
				OR = {
					is_megastructure_type = gateway_ruined
					is_megastructure_type = gateway_restored
				}
			}
			save_event_target_as = dark_flow_gateway
		}
		solar_system = { save_event_target_as = dark_flow_gateway_system }
	}

	option = {
		name = DISCONCERTING
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			hidden_effect = {
				set_country_flag = lcluster_clue_dark_flow
				pop_lcluster_event = yes
			}
		}
		leader = {
			add_trait = leader_trait_paranoid
			add_skill = 2
		}
	}
}

## Lost Amoeba
ship_event = {
	id = distar.50
	title = "distar.50.name"
	desc = {
		trigger = {
			owner = { has_country_flag = amoeba_encountered }
		}
		text = "distar.50.desc"
	}
	desc = {
		trigger = {
			owner = { NOT = { has_country_flag = amoeba_encountered } }
		}
		text = "distar.50.desc.first_enc"
	}
	picture = GFX_evt_friendly_amoeba
	show_sound = event_space_amoeba
	location = from
	
	is_triggered_only = yes

	immediate = {
		create_country = {
			name = "NAME_Lost_Amoeba"
			type = faction
			flag = {
    		    icon = {
    		        category = "pirate"
    		        file = "flag_pirate_3.dds"
    		    }
    		    background = {
    		        category = "backgrounds"
    		        file = "00_solid.dds"
    		    }
    		    colors = {
    		        "blue"
    		        "null"
    		        "null"
    		        "null"
    		    }
    		}
			effect = {
				set_faction_hostility = {
					target = root.owner
					set_hostile = no
					set_neutral = no
					set_friendly = yes
				}
				create_fleet = {
					name = "NAME_Lost_Amoeba"
					effect = {
						set_owner = prev
						create_ship = {
							name = "NAME_Lost_Amoeba"
							design = "NAME_Small_Space_Organism_Teal"
							prefix = no
							upgradable = no
						}
						set_location = {
							target = from
							distance = 5
							angle = random
						}
						set_fleet_stance = passive
						set_fleet_flag = lost_amoeba_fleet@root.owner
						save_event_target_as = lost_amoeba_fleet
					}
					settings = {
						can_upgrade = no
						can_disband = no
						can_change_composition = no
						can_change_leader = no
						uses_naval_capacity = no
						spawn_debris = yes
					}
				}
			}
		}
		root = {
			fleet = {
				save_event_target_as = science_ship_fleet
			}
		}
		event_target:lost_amoeba_fleet = {
			auto_follow_fleet = {
				target = event_target:science_ship_fleet
				attack_fleet = no
			}
		}	
	}

	option = {
		name = distar.50.a
		event_target:lost_amoeba_fleet = {
			set_owner = root.owner
		}
		hidden_effect = {
			leader = {
				save_global_event_target_as = amoeba_finding_scientist
			}
			owner = {
				set_country_flag = amoeba_befriended # Achievement flag
				set_variable = { which = amoebas_owned value = 1 }
				country_event = { id = distar.51 days = 365 random = 60 } # grows up
				random_list = {
					66 = {
						country_event = { id = anomalymod.22 days = 430 } # chance to pacify amoebas
					}
					33 = {
					}
				}
				country_event = { id = distar.304 days = 36500 } # 100 years old
				IF = {
					limit = {
						NOT = { has_country_flag = amoeba_encountered }
					}
					capital_scope = {
						enable_special_project = {
							name = "INVESTIGATE_SPACE_AMOEBA"
							location = this
							owner = root.owner
						}
					}
					set_country_flag = amoeba_encountered
				}
			}
		}
	}

	option = {
		name = distar.50.b
		custom_tooltip = distar.50.b.tooltip
		hidden_effect = {
			owner = {
				country_event = { id = distar.52 days = 90 }
				IF = {
					limit = {
						NOT = { has_country_flag = amoeba_encountered }
					}
					capital_scope = {
						enable_special_project = {
							name = "INVESTIGATE_SPACE_AMOEBA"
							location = this
							owner = root.owner
						}
					}
					set_country_flag = amoeba_encountered
				}
			}
		}
	}

	option = {
		name = "distar.50.c"
		event_target:lost_amoeba_fleet = {
			enable_special_project = {
				name = "DISSECTION_PROJECT"
				location = this
				owner = root.owner
			}
		}
		hidden_effect = {
			owner = {
				IF = {
					limit = {
						NOT = { has_country_flag = amoeba_encountered }
					}
					capital_scope = {
						enable_special_project = {
							name = "INVESTIGATE_SPACE_AMOEBA"
							location = this
							owner = root.owner
						}
					}
					set_country_flag = amoeba_encountered
				}
			}
		}
	}
}

country_event = { #Adopted Amoeba Evolves
	id = distar.51
	title = "distar.51.name"
	desc = "distar.51.desc"
	picture = GFX_evt_friendly_amoeba
	show_sound = event_space_amoeba
	location = event_target:lost_amoeba_adult_fleet
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:lost_amoeba_fleet
	}

	immediate = {
		create_fleet = {
			name = "NAME_Adopted_Amoeba"
			effect = {
				set_owner = root
				create_ship = {
					name = "NAME_Adopted_Amoeba"
					design = "NAME_Large_Space_Organism_Teal"
					prefix = no
					upgradable = no
					effect = {
						save_event_target_as = lost_amoeba_ship
					}
				}
				set_location = {
					target = event_target:lost_amoeba_fleet
				}
				set_fleet_stance = passive
				set_fleet_flag = lost_amoeba_adult_fleet@root
				save_event_target_as = lost_amoeba_adult_fleet
			}
			settings = {
				can_upgrade = no
				can_disband = no
				can_change_composition = no
				can_change_leader = no
				uses_naval_capacity = no
			}
		}
		event_target:lost_amoeba_fleet = {
			delete_fleet = {
				target = this
				destroy_template = yes
			}
		}
		if = {
			limit = {
				NOT = { has_modifier = adopted_amoeba }
			}
			add_modifier = {
				modifier = "adopted_amoeba"
				days = -1
			}
		}
		event_target:lost_amoeba_fleet = {
			set_timed_fleet_flag = { flag = lost_amoeba_mating_timer days = 3600 } 
		}
	}

	option = {
		name = "distar.51.a"
		allow = {
			NOT = { has_ethic = ethic_fanatic_xenophobe }
			is_homicidal = no
		}
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Bubbles"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Bubbles"
			}
		}
	}
	option = {
		name = "distar.51.b"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Nyx"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Nyx"
			}
		}
	}
	option = {
		name = "distar.51.c"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Renegade"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Renegade"
			}
		}
	}
	option = {
		name = "distar.51.d"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Euka"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Euka"
			}
		}
	}
	option = {
		name = "distar.51.e"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Cyto"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Cyto"
			}
		}
	}
	option = {
		name = "distar.51.f"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Boomer"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Boomer"
			}
		}
	}
	option = {
		name = "distar.51.g"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Blaze"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Blaze"
			}
		}
	}
	option = {
		name = "distar.51.h"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Nova"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Nova"
			}
		}
	}
	option = {
		name = "distar.51.more"
		hidden_effect = {
			country_event = { id = distar.55 }
		}
		event_target:lost_amoeba_adult_fleet = {
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
	}
}

#Ouroboros
country_event = {
	id = distar.65
	title = "distar.65.name"
	desc = "distar.65.desc"
	location = event_target:kohtalo_second_fleet

	diplomatic = yes
	
	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:kohtalo_captain
		room = ethic_spaceship_room
	}

	immediate = {
		event_target:ouroboros_system = {
			random_system_planet = {
				limit = { has_planet_flag = ouroboros_pulsar_flag }
				save_event_target_as = ouroboros_pulsar
			}
		}
	}

	option = {
		name = "distar.65.a"
		custom_tooltip = "distar.65.a.tooltip"
		hidden_effect = { country_event = { id = distar.66 } }
	}

	option = {
		name = "distar.65.b"
		custom_tooltip = "distar.65.b.tooltip"
		hidden_effect = {
			event_target:kohtalo_second_fleet = {
				delete_fleet = this
			}
			country_event = { id = distar.68 days = 360 }
		}
	}
	option = {
		name = "distar.65.akx.c"
		trigger = { has_country_flag = worm_events_available }
		custom_tooltip = "distar.65.b.tooltip"
		hidden_effect = {
			event_target:kohtalo_second_fleet = {
				delete_fleet = this
			}
			country_event = { id = distar.68 days = 360 }
		}
	}
}

country_event = {
	id = distar.67
	title = "distar.67.name"
	desc = "distar.67.desc"
	picture = GFX_evt_sabotaged_ship
	show_sound = event_ship_explosion
	location = event_target:kohtalo_second_ambient
	
	is_triggered_only = yes

	immediate = {
		event_target:ouroboros_pulsar = {
			create_ambient_object = {
				type = "kohtalo_object"
				location = this
			}
			last_created_ambient_object = {
				set_location = {
					target = event_target:ouroboros_pulsar
					distance = 20
					angle = random
				}
				save_event_target_as = kohtalo_second_ambient
			}
		}
	}

	option = {
		name = OOPS
		event_target:ouroboros_pulsar = {
			set_deposit = d_physics_7
		}
	}
	
	option = {
		name = akx.9465.a
		trigger = { has_country_flag = worm_events_available }
		event_target:ouroboros_pulsar = {
			set_deposit = d_physics_7
		}
	}

	after = {
		if = {
			limit = {
				exists = event_target:kohtalo_country
			}
			event_target:kohtalo_country = {
				destroy_country = yes
			}
		}
	}
}

country_event = {
	id = distar.68
	title = "distar.68.name"
	desc = "distar.68.desc"
	picture = GFX_evt_sabotaged_ship
	show_sound = event_ship_explosion
	location = event_target:kohtalo_second_ambient
	
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				exists = event_target:kohtalo_country
			}
			event_target:kohtalo_country = {
				destroy_country = yes
			}
		}
		create_ambient_object = {
			type = "kohtalo_object"
			location = event_target:ouroboros_pulsar
		}
		last_created_ambient_object = {
			set_location = {
				target = event_target:ouroboros_pulsar
				distance = 20
				angle = random
			}
			save_event_target_as = kohtalo_second_ambient
		}
	}

	option = {
		name = "distar.68.a"
		event_target:ouroboros_pulsar = {
			set_deposit = d_physics_7
		}
	}
	option = {
		name = "akx.9465.a"
		trigger = { has_country_flag = worm_events_available }
		event_target:ouroboros_pulsar = {
			set_deposit = d_physics_7
		}
	}
	
	after = {
		if = {
			limit = {
				exists = event_target:kohtalo_country
			}
			event_target:kohtalo_country = {
				destroy_country = yes
			}
		}
	}
}

# Ruined Ringworld Clones
ship_event = {
	id = distar.70
	title = "distar.70.name"
	desc = "distar.70.desc"
	picture = GFX_evt_clones
	show_sound = event_laboratory_sound
	location = from
	
	is_triggered_only = yes

	immediate = {
		from = { set_deposit = d_physics_3 }
	}

	option = {
		name = "distar.70.a"
		trigger = {
			owner = {
				#any_owned_planet = { free_housing > 1	}
				NOR = { #Disallow for non-DS Hiveminds and non-Civic'd MIs
					AND = {
						has_authority = auth_machine_intelligence
						NOR = {
							has_civic = civic_machine_terminator
							has_civic = civic_machine_assimilator
							has_civic = civic_machine_servitor
						}
					}
					AND = {
						has_authority = auth_hive_mind
						NOT = {
							has_civic = civic_hive_devouring_swarm
						}
					}
				}
			}
		}
		small_artifact_reward = yes
		from = {
			enable_special_project = {
				name = "CRYO_CLONES_PROJECT"
				location = this
				owner = root.owner
			}
		}
		hidden_effect = {
			owner = {
				set_country_flag = lcluster_clue_clones
				pop_lcluster_event = yes
			}
		}
	}

	option = {
		name = "distar.70.b"
		small_artifact_reward = yes
		from = {
			add_modifier = { modifier = clones_in_cryo days = -1 }
			add_deposit = d_society_4
		}
		hidden_effect = {
			owner = {
				set_country_flag = lcluster_clue_clones
				pop_lcluster_event = yes
			}
		}
	}

	option = {
		name = "distar.70.exter"
		custom_tooltip = "distar.70.exter.tooltip"
		exclusive_trigger = {
			owner = { has_civic = civic_machine_terminator }
		}
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = influence
				value = @tier3influencereward
				min = @tier3influencemin
				max = @tier3influencemax
			}
			add_monthly_resource_mult = {
				resource = unity
				value = @tier1unityreward
				min = @tier1unitymin
				max = @tier1unitymax
			}
			hidden_effect = {
				set_country_flag = lcluster_clue_clones
				pop_lcluster_event = yes
			}
		}
	}
	option = {
		name = "distar.70.fp"
		custom_tooltip = "distar.70.fp.tooltip"
		exclusive_trigger = {
			owner = { has_civic = civic_fanatic_purifiers }
		}
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = influence
				value = @tier3influencereward
				min = @tier3influencemin
				max = @tier3influencemax
			}
			add_monthly_resource_mult = {
				resource = unity
				value = @tier1unityreward
				min = @tier1unitymin
				max = @tier1unitymax
			}
			hidden_effect = {
				set_country_flag = lcluster_clue_clones
				pop_lcluster_event = yes
			}
		}
	}
	option = { #In the event of no free tiles (ignoring Terminators and Swarm)
		name = "distar.70.no_room"
		trigger = {
			owner = {
				NOR = {
					#any_owned_planet = { free_housing > 1	}
					has_civic = civic_hive_devouring_swarm
					has_civic = civic_machine_terminator
				}
			}
		}
		small_artifact_reward = yes
		from = {
			add_modifier = { modifier = clones_in_cryo days = -1 }
			add_deposit = d_society_4
		}
		hidden_effect = {
			owner = {
				set_country_flag = lcluster_clue_clones
				pop_lcluster_event = yes
			}
		}
	}
}

ship_event = { #Exofungus
	id = distar.105
	title = "distar.105.name"
	desc = "distar.105.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = from

	is_triggered_only = yes

	option = {
		name = WORRYING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
	option = {
		name = distar.105.b
		trigger = {
			leader = {
				OR = {
					has_trait = leader_trait_expertise_biology
					has_trait = leader_trait_spark_of_genius
					has_trait = leader_trait_maniacal
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
		custom_tooltip = distar.105.b.tooltip
		hidden_effect = {
			random_list = {
				1 = {
					ship_event = { id = anomalymod.87 } # fungicide fails
				}
				2 = { } # fungicide works
			}
			FROM = {
				remove_deposit = d_exofungus_blocker
				remove_deposit = d_exofungus_blocker
			}
		}
	}
}

ship_event = { #Heavy Metal Frost
	id = distar.115
	title = "distar.115.name"
	desc = "distar.115.desc"
	picture = GFX_evt_toxic
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	immediate = {
		from = {
			if = {
				limit = { has_deposit_for = shipclass_research_station }
				clear_deposits = yes
			}
		}
	}

	option = {
		name = INTERESTING
		trigger = {
			leader = {
				NOR = {
					has_trait = leader_trait_expertise_materials
					has_trait = leader_trait_expertise_industry
				}
			}
		}
		from = {
			add_deposit = d_minerals_2
			add_deposit = d_alloys_2
		}
	}
	option = {
		name = INTERESTING
		trigger = {
			leader = {
				OR = {
					has_trait = leader_trait_expertise_materials
					has_trait = leader_trait_expertise_industry
				}
			}
		}
		from = {
			add_deposit = d_minerals_2
			add_deposit = d_alloys_2
			add_deposit = d_volatile_motes_1
		}
	}
}

ship_event = { #Watery Grave
	id = distar.120
	title = "distar.120.name"
	desc = "distar.120.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_scanner
	location = from
	
	is_triggered_only = yes

	option = {
		name = INTERESTING
		trigger = { owner = { is_xenophile = no } }
		small_artifact_reward = yes
		from = {
			add_modifier = { modifier = watery_grave days = -1 }
			add_deposit = d_flooded_mounds
		}
	}
	option = {
		name = UNFORTUNATE
		trigger = { owner = { is_xenophile = yes } }
		small_artifact_reward = yes
		from = {
			add_modifier = { modifier = watery_grave days = -1 }
			add_deposit = d_flooded_mounds
		}
	}
}

ship_event = { #Vacuum Collapse
	id = distar.125
	title = "distar.125.name"
	desc = "distar.125.desc"
	picture = GFX_evt_ruined_system
	show_sound = event_scanner
	location = event_target:derelict_particle_accelerator
	
	is_triggered_only = yes

	option = {
		name = DISCONCERTING
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
		leader = {
			IF = {
				limit = { has_trait = leader_trait_expertise_particles	}
				add_experience = 200
			}
			else = {
				add_trait = leader_trait_expertise_particles
			}
		}
	}
}

ship_event = { #Old Foes
	id = distar.131
	title = "distar.131.name"
	desc = "distar.131.desc"
	picture = GFX_evt_alien_cavemen
	show_sound = event_alien_nature
	location = from
	
	is_triggered_only = yes

	immediate = {
		IF = {
			LIMIT = { from = { has_planet_flag = czyrni_planet } }
			solar_system = {
				random_system_planet = {
					limit = { has_planet_flag = pyorun_planet }
					save_event_target_as = other_planet
				}	
			}
		}
		ELSE = {
			solar_system = {
				random_system_planet = {
					limit = { has_planet_flag = czyrni_planet }
					save_event_target_as = other_planet
				}
			}
		}
	}

	option = {
		name = UNFORTUNATE
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

#Happy Little Brainslugs
ship_event = {
	id = distar.170
	title = "distar.170.name"
	desc = {
		trigger = {
			owner = {
				NOT = { has_authority = auth_machine_intelligence }
			}
		}
		text = "distar.170.desc"
	}
	desc = {
		trigger = {
			owner = {
				has_authority = auth_machine_intelligence
			}
		}
		text = "distar.170.desc.machi"
	}
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = from
	
	is_triggered_only = yes
	
	immediate = {
		owner = { set_country_flag = found_presapients }
		owner = { country_event = { id = tutorial.57 days = 5 } }
		owner = { country_event = { id = story.4 days = 30 } }
		from = {
			create_species = {
				name = random
				class = "PRE_REP"
				portrait = random
				traits = {
					trait = random_presapient_trait
				}
				homeworld = FROM
				sapient = no
			}
			while = {
				count = 3
				create_pop = { species = last_created }
			}
		}
	}

	option = {
		trigger = {
			owner = {
				NOT = { has_authority = auth_machine_intelligence }
				any_owned_pop = {
					species = {
						NOR = {
							has_trait = trait_cybernetic
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
				}
			}
		}
		name = "distar.170.a"
		small_artifact_reward = yes
		from = {
			enable_special_project = {
				name = "BRAINSLUG_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}

	option = {
		trigger = {
			owner = {
				NOT = { has_authority = auth_machine_intelligence }
			}
		}
		name = NOTIME
		small_artifact_reward = yes
	}

	option = {
		trigger = {
			owner = {
				has_authority = auth_machine_intelligence
			}
		}
		name = "distar.170.machi"
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
	}
	
	after = {
	}
}

ship_event = {
	id = distar.172
	title = "distar.172.name"
	desc = "distar.172.desc"
	picture = GFX_evt_hive_mind
	show_sound = event_alien_nature
	location = root
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:brainslug_scientist
	}

	immediate = {
		leader = {
			add_trait = leader_trait_scientist_brainslug
		}
		owner = {
			set_country_flag = finished_brainslug_chain
		}
	}

	option = {
		trigger = {
			owner = {
				is_xenophobe = no
			}
		}
		name = "distar.172.a"
		allow = {
			owner = { is_homicidal = no }
		}
		owner = {
			while = {
				count = 3
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							NOR = {
								has_trait = trait_cybernetic
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
								is_species_class = ROBOT
							}
						}
					}
					modify_species = {
						species = this
						add_trait = trait_brainslug
						add_traits_at_start_of_list = yes
						hidden_effect = {
							set_citizenship_type = {
								country = root.owner
								type = citizenship_full
								cooldown = no
							}
						}
					}
				}
			}
			hidden_effect = {
				while = {
					count = 2
					random_owned_leader = {
						LIMIT = {
							leader_class = scientist
							species = {
								NOR = {
									has_trait = trait_cybernetic
									has_trait = trait_mechanical
									has_trait = trait_machine_unit
									is_species_class = ROBOT
								}
							}
						}
						add_trait = leader_trait_scientist_brainslug
					}
				}
				random_owned_leader = {
					LIMIT = {
						leader_class = governor
						species = {
							NOR = {
								has_trait = trait_cybernetic
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
								is_species_class = ROBOT
							}
						}
					}
					add_trait = leader_trait_governor_brainslug
				}
				country_event = { id = distar.174 } #Pool leaders get trait
				country_event = { id = distar.175 } #Unrest is generated
			}
		}
	}

	option = {
		trigger = {
			hidden_trigger = {
				owner = {
					is_xenophobe = yes
					any_owned_pop = {
						NOR = {
							has_ethic = ethic_xenophobe
							has_ethic = ethic_fanatic_xenophobe
						}
					}
				}
			}
		}
		name = "distar.172.a"
		allow = {
			owner = { is_homicidal = no }
		}
		owner = {
			while = {
				count = 3
				random_owned_pop = {
					LIMIT = {
						NOR = {
							has_ethic = ethic_xenophobe
							has_ethic = ethic_fanatic_xenophobe
						}
						species = {
							NOR = {
								has_trait = trait_cybernetic
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
								is_species_class = ROBOT
							}
						}
						is_sapient = yes
					}
					modify_species = {
						species = this
						add_trait = trait_brainslug
						add_traits_at_start_of_list = yes
						hidden_effect = {
							set_citizenship_type = {
								country = root.owner
								type = citizenship_full
								cooldown = no
							}
						}
					}
				}
			}
			hidden_effect = {
				country_event = { id = distar.174 } #Pool leaders get trait
				country_event = { id = distar.175 } #Unrest is generated
			}
		}
	}

	option = {
		name = "distar.172.b"
		custom_tooltip = "distar.172.b.tooltip"
		owner = { set_country_flag = brainslug_offer_rejected }
	}
}

country_event = { #Cohabitants of Brainslugged pops generate initial Unrest
	id = distar.175
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		IF = {
			LIMIT = {
				NOR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
				}
			}
			every_owned_planet = {
				limit = {
					OR = {
						any_owned_pop = { has_trait = trait_brainslug }
						leader = {
							has_trait = leader_trait_governor_brainslug
						}
					}
				}
				add_modifier = { modifier = brainslug_woes days = 14600 }
			}
			every_owned_planet = {
				limit = {
					NOR = {
						any_owned_pop = { has_trait = trait_brainslug }
						leader = {
							has_trait = leader_trait_governor_brainslug
						}
					}
				}
				add_modifier = { modifier = brainslug_woes days = 7300 }
			}
		}
		ELSE_IF = { #Xenophobes result in higher unrest
			LIMIT = { has_ethic = ethic_xenophobe }
			every_owned_planet = {
				limit = {
					OR = {
						any_owned_pop = { has_trait = trait_brainslug }
						leader = {
							has_trait = leader_trait_governor_brainslug
						}
					}
				}
				add_modifier = { modifier = brainslug_woes_phobe days = 14600 }
			}
			every_owned_planet = {
				limit = {
					NOR = {
						any_owned_pop = { has_trait = trait_brainslug }
						leader = {
							has_trait = leader_trait_governor_brainslug
						}
					}
				}
				add_modifier = { modifier = brainslug_woes_phobe days = 7300 }
			}
		}
		ELSE = { # Fanatic xenophobes even more so.
			every_owned_planet = {
				add_modifier = { modifier = brainslug_woes_phobe days = 15000 }
			}
		}
	}
}


ship_event = { #Thirsty Rocks
	id = distar.180
	title = "distar.180.name"
	desc = "distar.180.desc"
	picture = GFX_evt_warm_barren
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	option = {
		name = INTERESTING
		from = {
			hidden_effect = {
				if = {
					limit = { has_deposit_for = shipclass_research_station }
					clear_deposits = yes
				}
				add_modifier = { modifier = mineral_rich days = -1 }
			}
			add_deposit = d_minerals_5
		}
	}
	option = {
		name = distar.180.name.b
		trigger = {
			FROM = { can_be_terraforming_candidate = yes }
			leader = {
				OR = {
					has_trait = leader_trait_expertise_new_worlds
					has_trait = leader_trait_spark_of_genius
					has_trait = leader_trait_maniacal
				}
			}
		}
		allow = {
			owner = {
				resource_stockpile_compare = { resource = energy value >= 1000 } 
			}
		}
		custom_tooltip = distar.180.name.b.tooltip
		owner = { add_resource = { energy = -1000 } }
		FROM = {
			enable_special_project = {
				name = "THIRSTY_ROCK_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
}

ship_event = { #Venus Flytrap Megaflora
	id = distar.185
	title = "distar.185.name"
	desc = {
		text = "distar.185.desc"
		trigger = {
			owner = { NOT = { has_authority = auth_machine_intelligence } }
		}
	}
	desc = {
		text = "distar.185.mi.desc"
		trigger = {
			owner = { has_authority = auth_machine_intelligence }
		}
	}
	picture = GFX_evt_aggressive_flora
	show_sound = event_alien_nature
	location = from
	
	is_triggered_only = yes

	option = {
		name = DISCONCERTING
		FROM = {
			add_deposit = d_predatory_plants
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

## Living Planet
planet_event = { #If you terraform the planet to a non-seabearing class before completing chain
	id = distar.197
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_planet_flag = living_planet
		from = {
			has_event_chain = "living_planet_chain"
			NOT = { has_country_flag = completed_living_sea }
		}
		OR = {
			is_dry = yes
			is_cold = yes
			is_tropical = yes
			is_machine = yes
			is_city = yes
		}
	}

	immediate = {
		remove_modifier = "living_sea"
		remove_modifier = "pm_study_the_sea"
		from = {
			end_event_chain = "living_planet_chain"
			remove_country_flag = strange_calling_fired
			country_event = { id = distar.198 }
		}
	}
}

#The Zone
ship_event = {
	id = distar.220
	title = "distar.220.name"
	desc = {
		trigger = {
			owner = {
				NOT = { has_authority = auth_machine_intelligence }
			}
		}
		text = "distar.220.desc"
	}
	desc = {
		trigger = {
			owner = {
				has_authority = auth_machine_intelligence
			}
		}
		text = "distar.220.desc.machi"
	}
	picture = GFX_evt_alien_ruins
	show_sound = event_ghost_town
	location = from
	
	is_triggered_only = yes

	immediate = {
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = FASCINATING
		custom_tooltip = "distar.220.a.tooltip"
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
			add_monthly_resource_mult = {
				resource = unity
				value = @tier1unityreward
				min = @tier1unitymin
				max = @tier1unitymax
			}
			hidden_effect = { pop_lcluster_event = yes }
		}
	}
}

#Junk Ball Asteroid
ship_event = {
	id = distar.225
	title = "distar.225.name"
	desc = "distar.225.desc"
	picture = GFX_evt_asteroid_field
	show_sound = event_scanner
	location = from
	
	is_triggered_only = yes

	immediate = {
		from = { clear_deposits = yes }
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = "distar.225.a"
		small_artifact_reward = yes
		from = {
			add_alloys = yes
			custom_tooltip = distar.225.rare.tooltip
			hidden_effect = {
				random_list = {
					5 = {
						add_deposit = d_volatile_motes_1
					}
					3 = {
						add_deposit = d_volatile_motes_2
					}
					1 = {
						add_deposit = d_volatile_motes_3
					}
				}
			}
		}
		if = {
			limit = { has_ancrel = yes }			
			custom_tooltip = minor_artifacts_found
			owner = { add_resource = { minor_artifacts = 1 } }
		}
		hidden_effect = {
			owner = {
				set_country_flag = lcluster_clue_junkball
				pop_lcluster_event = yes
			}
			ship_event = { id = distar.305 days = 1 }
		}
	}
}

fleet_event = { #Junkheap Ratlings 
	id = distar.230
	title = "distar.230.name"
	desc = "distar.230.desc"
	picture = GFX_evt_junkheap
	show_sound = event_scanner
	location = root
	
	is_triggered_only = yes

	trigger = {
		from = { has_star_flag = ratling_system }
		owner = {
			is_country_type = default
			NOT = { has_country_flag = discovered_ratlings }
		}
		NOR = {
			exists = event_target:ratling_pre_space_country
			exists = event_target:ratling_country
		}
	}

	immediate = {
		owner = {
			set_country_flag = discovered_ratlings #Every player that enters the system gets this flag
			country_event = { id = story.5 days = 30 }
			random_country = {
				limit = { is_country_type = global_event }
				country_event = { id = distar.232 days = 9000 random = 3600 } 
			}
		}
		from = {
			random_system_planet = {
				limit = { has_planet_flag = ratling_planet }
				save_event_target_as = ratling_planet_tar #Used for loc for this event only
			}
		}
		event_target:ratling_capital = {
			add_anomaly = { category = DISTAR_RAT_CAT }
		}
	}

	option = {
		name = CURIOUS
		small_artifact_reward = yes
	}

	option = {
		name = SCUM
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
				}
			}
		}
		small_artifact_reward = yes
	}

	option = {
		name = "distar.230.exter"
		exclusive_trigger = {
			owner = {
				has_civic = civic_machine_terminator
			}
		}
		small_artifact_reward = yes
	}
}

ship_event = { #Found the Capital
	id = distar.231
	title = "distar.231.name"
	desc = "distar.231.desc"
	picture = GFX_evt_junkheap
	show_sound = event_ghost_town
	location = from
	
	is_triggered_only = yes

	option = {
		name = UNFORTUNATE
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			hidden_effect = {
				set_country_flag = lcluster_clue_ratling
				pop_lcluster_event = yes
			}
		}
	}

	option = {
		name = "distar.231.phobe"
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
					has_civic = civic_machine_terminator
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			hidden_effect = {
				set_country_flag = lcluster_clue_ratling
				pop_lcluster_event = yes
			}
		}
	}
}

ship_event = { #Found the Capital
	id = distar.231
	title = "distar.231.name"
	desc = "distar.231.desc"
	picture = GFX_evt_junkheap
	show_sound = event_ghost_town
	location = from
	
	is_triggered_only = yes

	option = {
		name = UNFORTUNATE
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			hidden_effect = { pop_lcluster_event = yes }
		}
	}

	option = {
		name = "distar.231.phobe"
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
					has_civic = civic_machine_terminator
				}
			}
		}
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			hidden_effect = { pop_lcluster_event = yes }
		}
	}
}

#Sealed Entry System
ship_event = {
	id = distar.245
	title = "distar.245.name"
	desc = "distar.245.desc"
	picture = GFX_evt_space_debris
	show_sound = event_scanner
	location = event_target:droppod_tar
	
	is_triggered_only = yes

	immediate = {
		IF = {
			LIMIT = { host_has_dlc = "Synthetic Dawn Story Pack" }
			create_species = {
				name = "NAME_Caretaker"
				class = ROBOT
				portrait = "sd_mam_robot"
				namelist = "AI"
				traits = {
					trait = trait_machine_unit
					trait = trait_robot_enhanced_memory
					trait = trait_robot_emotion_emulators
				}
				effect = {
					save_event_target_as = caretaker_species
				}
			}
		}
		ELSE = {
			create_species = {
				name = "NAME_Caretaker"
				class = ROBOT
				portrait = "default_robot"
				namelist = "AI"
				traits = random
				effect = {
					save_event_target_as = caretaker_species
				}
			}
		}
		owner = {
			create_saved_leader = {
				creator = this
				key = caretaker_leader
				event_leader = no
				class = governor
				species = event_target:caretaker_species
				name = "NAME_Caretaker"
				skill = 4
				traits = {
					trait = leader_trait_analytical
					trait = leader_trait_ai_aided_design
				}
				gender = indeterminable
				set_age = 709
				effect = {
					save_event_target_as = caretaker_leader_tar
				}
			}
		}
	}

	option = {
		name = ONSCREEN
		small_artifact_reward = yes
		hidden_effect = {
			owner = { country_event = { id = distar.246 } }
		}
	}
	option = {
		name = NOTIME
		owner = {
			small_artifact_chance = yes
			add_monthly_resource_mult = {
				resource = influence
				value = @tier1influencereward
				min = @tier1influencemin
				max = @tier1influencemax
			}
		}
	}
}

#Phaseshifting Planet
ship_event = {
	id = distar.251
	title = "distar.251.name"
	desc = {
		trigger = {
			event_target:phaseshift_planet = {
				is_planet_class = pc_gaia #Inverted check bc pc_change in immediate actually runs after
			}
		}
		text = "distar.251.desc.shroud"
	}
	desc = {
		trigger = {
			event_target:phaseshift_planet = {
				is_planet_class = pc_shrouded #Inverted check bc pc_change in immediate actually runs after
			}
		}
		text = "distar.251.desc.gaia"
	}
	picture = GFX_evt_surreal_visions
	show_sound = event_mystic_reveal
	location = event_target:phaseshift_planet

	is_triggered_only = yes

	trigger = {
		exists = event_target:phaseshift_planet
	}

	immediate = {
		event_target:phaseshift_planet = {
			IF = {
				limit = { is_planet_class = pc_shrouded }
				change_pc = pc_gaia
				clear_deposits = yes
				add_deposit = d_active_volcano
				add_deposit = d_mountain_range
				add_deposit = d_tempestous_mountain
				add_deposit = d_underwater_vent
				add_deposit = d_buzzing_plains
				add_deposit = d_submerged_ore_veins
				add_deposit = d_submerged_ore_veins
				add_deposit = d_lush_jungle
				add_deposit = d_natural_farmland
				add_deposit = d_natural_farmland
				add_deposit = d_alien_pets_deposit
				add_deposit = d_teeming_reef
				add_deposit = d_zro_deposit_5
			}
			ELSE_IF = {
				limit = { is_planet_class = pc_gaia }
				change_pc = pc_shrouded
				clear_deposits = yes
				add_deposit = d_zro_deposit_5
				add_deposit = d_energy_10
			}
		}
	}

	option = {
		name = INCREDIBLE
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

#Ketling
ship_event = {
	id = distar.261
	title = "distar.261.name"
	desc = "distar.261.desc"
	picture = GFX_evt_animal_wildlife
	show_sound = event_alien_nature
	location = from
	
	is_triggered_only = yes
	
	option = {
		name = FASCINATING
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}

	option = {
		name = "distar.234.phobe"
		exclusive_trigger = {
			owner = {
				is_xenophobe = yes
			}
		}
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}

	option = {
		name = INTERESTING
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_authoritarian
					has_civic = civic_slaver_guilds
				}
			}
		}
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}

	option = {
		name = TASTY
		exclusive_trigger = {
			owner = {
				has_civic = civic_hive_devouring_swarm
			}
		}
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}

	option = {
		name = "distar.261.a.servi"
		exclusive_trigger = {
			owner = {
				has_civic = civic_machine_servitor
			}
		}
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}

	option = {
		name = "distar.261.a.assim"
		exclusive_trigger = {
			owner = {
				has_civic = civic_machine_assimilator
			}
		}
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}

	option = {
		name = "distar.261.a.exter"
		exclusive_trigger = {
			owner = {
				has_civic = civic_machine_terminator
			}
		}
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}

	option = {
		name = SCUM
		exclusive_trigger = {
			owner = {
				has_civic = civic_fanatic_purifiers
			}
		}
		owner = {
			small_artifact_reward = yes
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

#Nanosands
ship_event = {
	id = distar.280
	title = "distar.280.name"
	desc = "distar.280.desc"
	picture = {
		trigger = {
			from = {
				is_desert = yes
			}
		}
		picture = GFX_evt_desert_planet
	}
	picture = {
		trigger = {
			from = {
				is_gaia = yes
			}
		}
		picture = GFX_evt_gaia
	}
	picture = {
		trigger = {
			from = {
				is_planet_class = pc_barren
			}
		}
		picture = GFX_evt_warm_barren
	}
	show_sound = event_default
	location = from
	
	is_triggered_only = yes

	immediate = {
		from = {
			if = {
				limit = { is_planet_class = pc_barren }
				clear_deposits = yes
			}
		}
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = ASTOUNDING
		from = {
			if = {
				limit = { is_planet_class = pc_barren }
				set_deposit = d_minerals_4
				add_deposit = d_volatile_motes_1
			}
			else = { add_deposit = d_nanosands }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			add_resource = { nanites = 200 }
			generate_lcluster_clue = yes
		}
	}

	option = {
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe
				}
			}
		}
		name = DISCONCERTING
		from = {
			if = {
				limit = { is_planet_class = pc_barren }
				set_deposit = d_minerals_4
				add_deposit = d_volatile_motes_1
			}
			else = { add_deposit = d_nanosands }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			generate_lcluster_clue = yes
		}
	}
}


#################################
#
# Anomaly Events
# by Miranda van den Brink
# anomaly.1000 - 2999
#
#################################

# ROOT = ship scope
# FROM = planet scope

##### VECTHAR ZAVONIA CHAIN ######

# Project Followup
country_event = {
	id = distar.1001
	title = "distar.1001.name"
	desc = "distar.1001.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_ship_bridge
	location = event_target:utopian_planet
	
	is_triggered_only = yes

	immediate = {
		#random_planet = {
		#	limit = {
		#		#is_colonizable = no
		#		has_owner = no
		#		#is_colony = no
		#		#uninhabitable_regular_planet = yes
		#		is_planet_class = pc_nuked
		#		has_anomaly = no
		#	}
		#	save_global_event_target_as = utopian_planet
		#}
		save_global_event_target_as = country_that_discovered_mardak_vol
		event_target:vechtar_zavonia_leader_name = {
			add_trait = leader_trait_maniacal
		}
	}

	option = {
		tooltip = {
			event_target:vechtar_zavonia_leader_name = {
				add_trait = leader_trait_maniacal
			}
		}
		name = distar.1001.a
		hidden_effect = {
			closest_system = {
				spawn_system = {
					min_distance >= 29
					max_distance <= 31
					# 45
					min_orientation_angle = 24
					max_orientation_angle = 66
					initializer = vechtar_zavonia_system
				}
			}
			add_extra_hyperlane_to_spawned_system_effect = yes
		}
		begin_event_chain = {
			event_chain = "generation_ship_chain"
			target = this
		}
		hidden_effect = {
			random_system = {
				limit = {
					has_star_flag = vechtar_zavonia_system
				}
				save_event_target_as = utopian_planet_system
			}
			create_point_of_interest = {
				id = hidden_planet
				name = "hidden_planet_poi"
				desc = hidden_planet_desc
				event_chain = generation_ship_chain
				location = event_target:utopian_planet_system
			}
		}
	}

	option = {
		tooltip = {
			event_target:vechtar_zavonia_leader_name = {
				add_trait = leader_trait_maniacal
			}
		}
		add_resource = { influence = 50 }
		name = distar.1001.b
	}
}

##### ABANDONED OBSERVATION OUTPOST ######
ship_event = {
	id = distar.1030
	title = "distar.1030.name"
	desc = "distar.1030.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_alien_signal
	location = FROM
	
	is_triggered_only = yes

	immediate = {
		owner = {
			country_event = { id = story.5 days = 30 }
		}
	}

	option = {
		name = distar.1030.a
		From = {
			enable_special_project = {
				name ="BIG_RIP"
				location = from
				owner = root.owner
			}
		}
	}
	option = {
		name = distar.1030.b
		owner = {
			add_resource = { influence = 50 }
		}
	}
	
	after = {
		small_artifact_reward = yes
	}
}

##### Bunker-Bot ######
ship_event = {
	id = distar.1040
	title = "distar.1040.name"
	desc = "distar.1040.desc"
	picture = GFX_evt_sapient_AI
	show_sound = event_alien_signal
	location = FROM
	
	is_triggered_only = yes

	immediate = { 
		owner = {
			country_event = { id = story.5 days = 30 }
		}
	}

	option = {
		name = distar.1040.a
		custom_tooltip = distar.1040.a.tooltip
		hidden_effect = { 
			owner = {
				set_country_flag = lcluster_clue_bunker_bot
				pop_lcluster_event = yes
			}
		}
		owner = {
			add_resource = { alloys = 100 }
			add_resource = { rare_crystals = 50 }
			add_resource = { volatile_motes = 50 }
		}
	}
	option = {
		name = distar.1040.b
		trigger = {
			leader = {
				NOR = {
					has_trait = leader_trait_expertise_computing
					has_trait = leader_trait_custom_AI_assistant
					has_trait = leader_trait_sapient_AI_assistant
				}
			}
		}
		custom_tooltip = distar.1040.b.tooltip
		hidden_effect = {
			owner = {
				set_country_flag = lcluster_clue_bunker_bot
				pop_lcluster_event = yes
				if = {
					limit = {
						has_distar = yes
						NOT = { has_country_flag = encountered_first_lgate }
					}
					random_list = {
						1 = { country_event = { id = anomalymod.80 days = 10 } }
						2 = { }
					}
				}
			}
		}
		owner = {
			add_modifier = { modifier = mega_computer days = 3600 }
		}
	}
	option = {
		name = distar.1040.b
		trigger = {
			leader = {
				OR = {
					has_trait = leader_trait_expertise_computing
					has_trait = leader_trait_custom_AI_assistant
					has_trait = leader_trait_sapient_AI_assistant
				}
			}
		}
		custom_tooltip = distar.1040.b.tooltip.alt
		hidden_effect = {
			owner = {
				set_country_flag = lcluster_clue_bunker_bot
				pop_lcluster_event = yes
				if = {
					limit = {
						has_distar = yes
						NOT = { has_country_flag = encountered_first_lgate }
					}
					random_list = {
						1 = { country_event = { id = anomalymod.80 days = 10 } }
						2 = { }
					}
				}
			}
		}
		owner = {
			add_modifier = { modifier = mega_computer_alt days = -1 }
		}
	}
	option = {
		name = distar.1040.c
		hidden_effect = {
			owner = {
				set_country_flag = lcluster_clue_bunker_bot
				pop_lcluster_event = yes
				if = {
					limit = {
						has_distar = yes
						NOT = { has_country_flag = encountered_first_lgate }
					}
					random_list = {
						1 = { country_event = { id = anomalymod.80 days = 10 } }
						1 = { }
					}
					country_event = { id = anomalymod.81 days = 18000 random = 72000 }
				}
				else_if = {
					limit = {
						has_distar = yes
						has_country_flag = encountered_first_lgate
					}
					country_event = { id = anomalymod.81 days = 18000 random = 72000 }
				}
			}
		}
		owner = {
			add_resource = { influence = 200 }
		}
		custom_tooltip = distar.1040.c.tooltip
	}
	after = {
		small_artifact_reward = yes
	}
}

##### ATOMIC CLOCK ######
ship_event = {
	id = distar.1045
	title = "distar.1045.name"
	desc = "distar.1045.desc"
	picture = GFX_evt_clocks
	show_sound = event_mystic_reveal
	location = FROM
	
	is_triggered_only = yes

	immediate = { 
		FROM = {
			save_event_target_as = atomic_clock_planet
		}
		owner = {
			country_event = { id = story.5 days = 30 }
			set_country_flag = atomic_clock
		}
	}

	option = {
		name = distar.1045.a
		custom_tooltip = distar.1045.a.tooltip
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
		hidden_effect = {
			owner = {
				random_list = {
					100 = {
						country_event = { id = distar.310 days = 15123 }
					}
					200 = {
						modifier = {
							factor = 0
							FROM = {
								solar_system = {
									NOT = {
										any_system_planet = {
											OR = {
												is_planet_class = pc_pulsar
												is_planet_class = pc_neutron_star
												is_planet_class = pc_magnetar
											}
										}
									}
								}
							}
						}
						modifier = {
							factor = 0
							has_leviathans = no
						}
						country_event = { id = anomalymod.104 days = 7923 }
					}
				}
			}
		}
	}
	option = {
		name = distar.1045.b
		custom_tooltip = distar.1045.b.tooltip
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
		hidden_effect = {
			random_list = {
				6 = {
					ship_event = { id = anomalymod.116 days = 3 }
				}
				11 = {
					ship_event = { id = anomalymod.117 days = 3 }
				}
				2 = {
					ship_event = { id = anomalymod.118 days = 3 }
				}
				1 = {
					ship_event = { id = anomalymod.119 days = 3 }
				}
			}
		}
	}
}

country_event = { #Atomic Clock follow-up: Selection
	id = distar.310
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		random_list = {
			0 = {
				modifier = {
					add = 40
					FROMFROM.solar_system = {
						any_system_planet = {
							habitable_planet = no
							has_anomaly = no
							planet_size > 8
							planet_size < 25
							NOT = { is_planet_class = "pc_broken" }
							is_star = no
						}
					}
				}
				country_event = { id = distar.311 } #System planet is terraformed
			}
			0 = {
				modifier = {
					add = 40
					FROMFROM.solar_system = {
						has_access_fleet = root
					}
				}
				country_event = { id = distar.315 } #Useable Gray Goo ship is built
			}
			40 = { country_event = { id = distar.320 } } #Unmanned research facilities built (Phys + Eng)
			0 = {
				modifier = {
					add = 40
					FROMFROM.solar_system = {
						any_system_planet = {
							has_anomaly = no
							exists = owner
							owner = {
								is_primitive = yes
							}
							NOT = { is_planet_class = pc_ringworld_habitable }
						}
					}
				}
				country_event = { id = distar.330 } #Primitive planet is nuked
			}
			0 = {
				modifier = {
					add = 40
					FROMFROM.solar_system = {
						any_system_planet = {
							habitable_planet = yes
							is_under_colonization = no
							has_anomaly = no
						}
					}
				}
				country_event = { id = distar.335 } #Habitable planet is nuked
			}
			20 = {
				country_event = { id = anomalymod.100 }
			}
			20 = {
				country_event = { id = anomalymod.103 }
			}
			20 = {
				country_event = { id = anomalymod.107 }
			}
			5 = {
				country_event = { id = anomalymod.108 }
			}
			1 = {
				country_event = { id = anomalymod.109 }
			}
		}
	}
}

country_event = { #A habitable planet is nuked
	id = distar.335
	title = distar.335.name
	desc = distar.335.desc
	picture = GFX_evt_exploding_planet
	show_sound = event_mystic_reveal
	location = event_target:nuked_planet

	is_triggered_only = yes

	immediate = {
		FROMFROMFROM.solar_system = {
			random_system_planet = {
				limit = {
					has_anomaly = no
					habitable_planet = yes
					is_under_colonization = no
				}
				save_event_target_as = nuked_planet
				change_pc = pc_toxic
				reset_planet = yes
				if = {
					limit = { has_modifier = holy_planet }
					ROOT = { set_country_flag = the_gods_are_angry }
				}
			}
		}
	}

	option = {
		name = UNFORTUNATE
		trigger = {
			event_target:nuked_planet = {
				is_colony = no
				NOT = { has_modifier = holy_planet }
			}
		}
	}
	option = {
		name = TERRIBLE
		trigger = {
			event_target:nuked_planet = {
				is_colony = yes
				NOT = { has_modifier = holy_planet }
			}
		}
	}
	option = {
		name = distar.335.c
		trigger = {
			event_target:nuked_planet = {
				has_modifier = holy_planet
			}
		}
		custom_tooltip = distar.335.c.tooltip
	}
	
	after = {
		hidden_effect = {
			if = {
				limit = {
					has_country_flag = the_gods_are_angry
					any_country = {
						has_ai_personality_behaviour = holy_planets # not awakened
					}
				}
				remove_country_flag = the_gods_are_angry
				random_country = {
					limit = {
						has_ai_personality_behaviour = holy_planets # not awakened
					}
					save_event_target_as = outraged_FE
				}
				save_event_target_as = FE_outrager
				country_event = { id = anomalymod.110 days = 5 }
			}
		}
	}
}

###### EAT OR BE EATEN ######
ship_event = {
	id = distar.1050
	title = "distar.1050.name"
	picture = GFX_evt_space_debris
	show_sound = event_alien_nature
	location = FROM

	is_triggered_only = yes

	desc = {
		trigger = {
			owner = {
				is_lithoid_empire = no
				is_robot_empire = no
			}
		}
		text = distar.1050.desc
	}
	desc = {
		trigger = {
			owner = {
				is_lithoid_empire = yes
				is_robot_empire = no
			}
		}
		text = distar.1050.desc_lithoid
	}
	desc = {
		trigger = {
			owner = {
				has_country_flag = synthetic_empire
			}
		}
		text = distar.1050.desc_robot
	}
	desc = {
		trigger = {
			owner = {
				is_machine_empire = yes
			}
		}
		text = distar.1050.desc_machine
	}

	trigger = {
		any_country = {
			is_country_type = default
			NOT = {
				is_same_value = root.owner
			}
		}
	}
	immediate = {
		owner = {
			country_event = { id = story.5 days = 30 }
			set_country_flag = eat_or_be_eaten
		}
		random_playable_country = {
			limit = {
				NOR = {
					is_same_value = root.owner
					has_country_flag = lost_colony_parent
					has_authority = auth_machine_intelligence
					is_synthetic_empire = yes
					owner_species = {
						OR = {
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_trait = trait_lithoid
							AND = {
								species_portrait = human
								ROOT = { owner = { owner_species = { species_portrait = human } } }
							}
						}
					}
				}
			}
			weights = {
				base = 1
				modifier = {
					mult = 10
					has_communications = root.owner
				}
			}
			establish_communications = root.owner
			save_event_target_as = delicious_aliens
			root.owner = { set_country_flag = establishing_delicious_comms }
			save_event_target_as = delicious_aliens
			owner_species = { save_event_target_as = delicious_aliens_species }
			every_country = {
				every_owned_pop = {
					limit = { is_same_species = event_target:delicious_aliens_species }
					modify_species = {
						species = THIS
						add_trait = trait_delicious
					}
				}
			}
			root.owner = { set_country_flag = establishing_delicious_comms }
		}
	}

	option = {
		name = distar.1050.a
		hidden_effect = {
			if = {
				limit = {
					root.owner = { has_country_flag = establishing_delicious_comms }
				}
				custom_tooltip = distar.1050.a.tooltip
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

##### HOLOGRAM ######
ship_event = {
	id = distar.1065
	title = "distar.1065.name"
	desc = "distar.1065.desc"
	picture = {
		trigger = {
			from = {
				is_desert = yes
			}
		}
		picture = GFX_evt_desert_planet
	}
	picture = {
		trigger = {
			from = {
				is_tropical = yes
			}
		}
		picture = GFX_evt_tropical_planet
	}
	picture = {
		trigger = {
			from = {
				is_arid = yes
			}
		}
		picture = GFX_evt_arid_planet
	}
	picture = {
		trigger = {
			from = {
				OR = {
					is_continental = yes
					is_gaia = yes
					is_alpine = yes
					is_savannah = yes
				}
			}
		}
		picture = GFX_evt_continental_planet
	}
	picture = {
		trigger = {
			from = {
				is_ocean = yes
			}
		}
		picture = GFX_evt_ocean_planet
	}
	picture = {
		trigger = {
			from = {
				is_tundra = yes
			}
		}
		picture = GFX_evt_tundra_planet
	}
	picture = {
		trigger = {
			from = {
				is_arctic = yes
			}
		}
		picture = GFX_evt_arctic_planet
	}
	picture = {
		trigger = {
			from = {
				is_gas_giant = yes
			}
		}
		picture = GFX_evt_gas_giant
	}
	picture = {
		trigger = {
			from = {
				NOR = {
					is_arctic = yes
					is_desert = yes
					is_tropical = yes
					is_arid = yes
					is_continental = yes
					is_gaia = yes
					is_alpine = yes
					is_savannah = yes
					is_ocean = yes
					is_tundra = yes
				}
			}
		}
		picture = GFX_evt_ship_in_orbit_2
	}
	show_sound = event_mystic_reveal
	location = From
	
	is_triggered_only = yes

	trigger = {
		owner = {
			NOT = {
				has_country_flag = hologram
			}
		}
	}

	immediate = {
		owner = {
			country_event = { id = story.5 days = 30 }
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
		From = {
			remove_planet = yes
		}
	}

	option = {
		name = distar.1065.a
		tooltip = {
			owner = {
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier1researchreward
					min = @tier1researchmin
					max = @tier1researchmax
				}
			}
		}
	}
}

##### STAR CRAZY ######
country_event = {
	id = distar.1072
	title = "distar.1072.name"
	desc = "distar.1072.desc"
	picture = GFX_evt_ship_in_orbit_2

	show_sound = event_alien_nature
	location = From.From

	is_triggered_only = yes

	immediate = {
		event_target:anomalous_star = {
			surveyed = {
 				set_surveyed = yes
   				surveyor = root
 			}
		}
	}

	option = {
		name = distar.1072.a
		from.leader = {
			add_trait = leader_trait_meticulous
			add_experience = 200
		}
		event_target:anomalous_star = {
			if = {
				limit = { has_deposit_for = shipclass_research_station }
				clear_deposits = yes
			}
			add_deposit = d_energy_8
			surveyed = {
 				set_surveyed = yes
   				surveyor = root
 			}
		}
	}
}

##### Harvesters #####
ship_event = {
	id = distar.1090
	title = "distar.1090.name"
	desc = "distar.1090.desc"
	picture = {
		trigger = {
			from = {
				is_tropical = yes
			}
		}
		picture = GFX_evt_tropical
	}
	picture = {
		trigger = {
			from = {
				is_continental = yes
			}
		}
		picture = GFX_evt_continental
	}

	picture = {
		trigger = {
			from = {
				NOR = {
					is_continental = yes
					is_tropical = yes
				}
			}
		}
		picture = GFX_evt_animal_wildlife
	}

	show_sound = event_construction
	location = FROM
	
	is_triggered_only = yes

	immediate = {
		owner = { country_event = { id = story.5 days = 30 } } 
		From = {
			add_deposit = d_harvester_fields
			add_modifier = { modifier = ancient_harvesters days = -1 }
		}
	}

	option = {
		name = distar.1090.a
		trigger = {
			owner = {
				country_uses_food = yes
			}
		}
		small_artifact_reward = yes
		tooltip = {
			From = {
				add_deposit = d_harvester_fields
				add_modifier = { modifier = ancient_harvesters days = -1 }
			}
		}
	}

	option = {
		name = distar.1090.b
		trigger = {
			owner = {
				country_uses_food = no
			}
		}
		small_artifact_reward = yes
		tooltip = {
			From = {
				add_deposit = d_harvester_fields
				add_modifier = { modifier = ancient_harvesters days = -1 }
			}
		}
	}
}

##### LOCUSTS #####
ship_event = {
	id = distar.1095
	title = "distar.1095.name"
	desc = "distar.1095.desc"
	picture = GFX_evt_warm_barren
	show_sound = event_ghost_town
	location = FROM
	
	is_triggered_only = yes

	immediate = {
		set_global_flag = spaceborn_locusts_spawned
		owner = {
			country_event = { id = story.1 days = 30 }
			set_country_flag = seen_space_locusts
		}
		From = {
			change_pc = pc_barren
			add_modifier = {
				modifier = "terraforming_candidate"
				days = -1
			}
			solar_system = {
				set_star_flag = space_locusts_current_location
			}
		}
	}

	option = {
		name = distar.1095.a
		hidden_effect = {
			From = {
				random_system = {
					limit = {
						OR = {
							NOT = { exists = space_owner }
							AND = {
								exists = space_owner
								space_owner = {
									OR = {
										is_country_type = default
										is_country_type = ascended_empire
										is_country_type = lost_empire
									}
								}
							}
						}
						any_neighbor_system = { has_star_flag = space_locusts_current_location }
					}
					random_system_planet = {
						limit = { is_star = yes }
						planet_event = { id = anomalymod.120 days = 10800 random = 10800 }
					}
				}
			}
		}
	}
}

##### SHATTERED WORLD #####
ship_event = {
	id = distar.2000
	title = "distar.2000.name"
	desc = "distar.2000.desc"
	picture = GFX_evt_space_debris
	show_sound = event_ghost_town
	location = FROM

	is_triggered_only = yes

	immediate = {
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = FASCINATING
		trigger = {
			leader = {
				NOR = {
					has_trait = leader_trait_expertise_materials
					has_trait = leader_trait_expertise_industry
				}
			}
		}
		From = {
			add_deposit = d_minerals_3
			add_deposit = d_alloys_1
		}
	}
	option = {
		name = FASCINATING
		trigger = {
			leader = {
				OR = {
					has_trait = leader_trait_expertise_materials
					has_trait = leader_trait_expertise_industry
				}
			}
		}
		From = {
			add_deposit = d_minerals_3
			add_deposit = d_alloys_1
			add_deposit = d_volatile_motes_1
		}
	}
}

##### PRIMORDIAL SOUP #####
ship_event = {
	id = distar.2015
	title = "distar.2015.name"
	desc = "distar.2015.desc"
	picture = GFX_evt_microscopic_life
	show_sound = event_alien_nature
	location = from
	
	is_triggered_only = yes

	immediate = {
		from = {
			clear_deposits = yes
		}
	}

	option = {
		name = FASCINATING
		trigger = {
			owner = {
				NOT = { has_valid_civic = civic_machine_terminator }
			}
		}
		from = {
			add_deposit = d_society_3
 		}
		if = {
			limit = {
				from = {
					can_be_terraforming_candidate = yes
				}
			}
			custom_tooltip = TERRAFORMING_CANDIDATE_EFFECT
			hidden_effect = {
				from = {
					add_modifier = {
						modifier = "terraforming_candidate"
						days = -1
					}
				}		
			}
		}
	}
	option = {
		name = distar.2015.A.machine
		trigger = {
			owner = {
				has_authority = auth_machine_intelligence
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = @tier3unityreward
			}
		}
		if = {
			limit = {
				from = {
					can_be_terraforming_candidate = yes
				}
			}
			custom_tooltip = TERRAFORMING_CANDIDATE_EFFECT
			hidden_effect = {
				from = {
					add_modifier = {
						modifier = "terraforming_candidate"
						days = -1
					}
				}		
			}
		}
	}
}

##### Artificial Moon #####
ship_event = {
	id = distar.2025
	title = "distar.2025.name"
	desc = "distar.2025.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_administrative_work
	location = FROM

	is_triggered_only = yes

	immediate = {
		owner = { country_event = { id = story.5 days = 30 } }
		from = {
			clear_deposits = yes
			solar_system = {
				random_system_planet = {
					limit = {
						has_moon = yes
						any_moon = {
							is_same_value = from
						}
					}
					save_event_target_as = artificial_moon_planet
				}
			}
		}
	}
	option = {
		name = FASCINATING
		from = {
			add_deposit = d_minerals_3
			add_deposit = d_alloys_1
		}
	}
	option = {
		name = distar.2025.b
		trigger = {
			leader = {
				has_trait = leader_trait_expertise_voidcraft
			}
		}
		from = {
			add_deposit = d_engineering_6
			add_deposit = d_society_3
		}
	}
}


###### Time-Loop World ######

### Interrupted Time Loop

# They are freed
country_event = {
	id = distar.2033
	title = "distar.2033.name"
	desc = "distar.2033.desc"
	picture = GFX_evt_metropolis
	show_sound = event_mystic_reveal
	location = event_target:time_loop_world
	
	is_triggered_only = yes

	immediate = {
		event_target:time_loop_world = {
			change_pc = pc_desert
			set_name = "NAME_Gish"
			set_planet_size = 19
			clear_deposits = yes
			add_deposit = d_searing_desert
			add_deposit = d_searing_desert
			add_deposit = d_searing_desert
			add_deposit = d_rushing_waterfalls
			add_deposit = d_arid_highlands
			add_deposit = d_tempestous_mountain
			add_deposit = d_ore_rich_caverns
			add_deposit = d_ore_rich_caverns
			add_deposit = d_submerged_ore_veins
			add_deposit = d_great_river
			add_deposit = d_great_river
			add_deposit = d_black_soil
			add_deposit = d_dust_desert
			if = {
				limit = {
					root = { NOT = { species_portrait = rep16 } }
				}
				log = "limit passed"
				create_species = {
					name = "NAME_Prikki"
					plural = "NAME_Prikki"
					class = REP
					portrait = rep16
					namelist = REP4
					traits = {
						ideal_planet_class = pc_desert
						trait = trait_industrious
						trait = trait_solitary
						trait = trait_decadent
					}
					homeworld = this
					effect = {
						save_event_target_as = prikki_species
					}
				}
			}
			else_if = {
				limit = {
					root = { species_portrait = rep16 }
				}
				create_species = {
					name = "NAME_Prikki"
					plural = "NAME_Prikki"
					class = REP
					portrait = rep12
					namelist = REP4
					traits = {
						ideal_planet_class = pc_desert
						trait = trait_industrious
						trait = trait_solitary
						trait = trait_decadent
					}
					homeworld = this
					effect = {
						save_event_target_as = prikki_species
					}
				}
			}
			create_country = {
				name = "NAME_Prikkiki-Ti"
				authority = random
				civics = {
					civic = civic_fanatic_purifiers
					civic = civic_cutthroat_politics
				}
				species = last_created
				ethos = {
					ethic = ethic_fanatic_xenophobe
					ethic = ethic_militarist
				}
				flag = {
					icon = {
						category = "domination"
						file = "domination_1.dds"
					}
					background= {
						category = backgrounds
						file = "v.dds"
					}
					colors = {
						"teal"
						"orange"
						"null"
						"null"
					}
				}
				type = default
				effect = {
					save_global_event_target_as = time_loop_country
					species = {
						save_global_event_target_as = time_loop_species
					}
					establish_communications_no_message = root
					
					##Copy technology
					IF = {
						LIMIT = {
							any_neighbor_country = {
								exists = this
								is_country_type = default
							}
						}
						random_neighbor_country = {
							limit = { is_country_type = default }
							save_event_target_as = tech_country
						}
						copy_techs_from = {
							target = event_target:tech_country
							except = {
								# Horizon Signal
								tech_akx_worm_1
								tech_akx_worm_2
								tech_akx_worm_3
							}
						}
					}
					ELSE_IF = {
						LIMIT = {
							any_country = {
								is_ai = no
							}
						}
						random_country = {
							limit = { is_ai = no }
							save_event_target_as = tech_country
						}
						copy_techs_from = {
							target = event_target:tech_country
							except = {
								# Horizon Signal
								tech_akx_worm_1
								tech_akx_worm_2
								tech_akx_worm_3
							}
						}
					}
					ELSE = {
						random_country = {
							limit = { is_country_type = default	}
							save_event_target_as = tech_country
						}
						copy_techs_from = {
							target = event_target:tech_country
							except = {
								# Horizon Signal
								tech_akx_worm_1
								tech_akx_worm_2
								tech_akx_worm_3
							}
						}
					}
					##Add some new technologies
					inverted_switch = {
						trigger = has_technology
						tech_starbase_2 = { give_technology = { tech = tech_starbase_2 } }
						tech_starbase_3 = { give_technology = { tech = tech_starbase_3 } }
						tech_starbase_4 = { give_technology = { tech = tech_starbase_4 } }
						tech_starbase_5 = { give_technology = { tech = tech_starbase_5 } }
					}
					give_technology = { tech = tech_power_plant_1 }
					give_technology = { tech = tech_power_plant_2 }
					give_technology = { tech = tech_power_plant_3 }
					give_technology = { tech = tech_power_plant_4 }
					give_technology = { tech = tech_mining_1 }
					give_technology = { tech = tech_mining_2 }
					give_technology = { tech = tech_mining_3 }
					give_technology = { tech = tech_power_hub_1 }
					give_technology = { tech = tech_destroyers }
	
					##Add resources
					add_resource = { minerals = 10000 }
					add_resource = { energy = 10000 }
					add_resource = { food = 3000 }
					add_resource = { consumer_goods = 3000 }
					add_resource = { alloys = 7000 }
					add_resource = { influence = 1000 }
					add_resource = { unity = 27000 }

					##Create fleets
					if = {
						limit = {
							has_technology = tech_cruisers
						}
						create_fleet = {
							effect = {
								set_owner = event_target:time_loop_country
								while = {
									count = 12
									create_ship = {
										name = random
										random_existing_design = cruiser
										graphical_culture = "reptilian_01"
									}
								}
								set_location = {
									target = event_target:time_loop_world
									distance = 10
									angle = random
								}			
							}
						}
					}
					if = {
						limit = {
							has_technology = tech_battleships
						}
						create_fleet = {
							effect = {
								set_owner = event_target:time_loop_country
								while = {
									count = 4
									create_ship = {
										name = random
										random_existing_design = battleship
										graphical_culture = "reptilian_01"
									}
								}
								set_location = {
									target = event_target:time_loop_world
									distance = 10
									angle = random
								}			
							}
						}
					}
					create_fleet = {
						effect = {
							set_owner = event_target:time_loop_country
							while = {
								count = 20
								create_ship = {
									name = random
									random_existing_design = corvette
									graphical_culture = "reptilian_01"
								}
							}		
						}
					}
					create_fleet = {
						effect = {
							set_owner = event_target:time_loop_country
							while = {
								count = 16
								create_ship = {
									name = random
									random_existing_design = destroyer
									graphical_culture = "reptilian_01"
								}
							}
							set_location = {
								target = event_target:time_loop_world
								distance = 10
								angle = random
							}			
						}
					}
				}
			}
			set_owner = event_target:time_loop_country
			set_capital = yes
			while = {
				count = 52
				create_pop = {
					species = event_target:time_loop_species
				}					
			}
			add_district = district_city
			add_district = district_city
			add_district = district_city
			add_district = district_farming
			add_district = district_farming
			add_district = district_farming
			add_district = district_farming
			add_district = district_mining
			add_district = district_mining
			add_district = district_mining
			add_district = district_generator
			add_district = district_generator
			add_district = district_generator
			add_district = district_generator
			add_district = district_generator
			add_district = district_generator
			add_district = district_generator
			add_building = building_system_capital
			add_building = building_research_lab_1
			add_building = building_foundry_1
			add_building = building_foundry_1
			add_building = building_factory_1
			while = {
				count = 10
				create_army = {
					name = random
					owner = event_target:time_loop_country
					species = event_target:time_loop_species
					type = defense_army
				}
			}
			solar_system = {
				create_starbase = {
					size = starbase_citadel
					module = shipyard
					owner = event_target:time_loop_country
				}
			}
		}
		establish_communications_no_message = last_created_country
	}

	option = {
		name = distar.2033.a
		add_monthly_resource_mult = {
			resource = physics_research
			value = @tier2researchreward
			min = @tier2researchmin
			max = @tier2researchmax
		}
	}

	option = {
		name = distar.2033.b
		add_monthly_resource_mult = {
			resource = physics_research
			value = @tier2researchreward
			min = @tier2researchmin
			max = @tier2researchmax
		}
	}
}

#################################
#
# Anomaly Events
# by Linus Dilén
# anomaly.3000 - 3999
#
#################################

# ROOT = ship scope
# FROM = planet scope

### Trojan Asteroid ###
ship_event = {
	id = distar.3001
	title = "trojan_asteroid_title"
	desc = {
		text = "distar.3001.desc"
		trigger = {
			owner = { NOT = { has_ethic = ethic_gestalt_consciousness } }
		}
	}
	desc = {
		text = "distar.3001.gc.desc"
		trigger = {
			owner = { has_ethic = ethic_gestalt_consciousness }
		}
	}
	picture = GFX_evt_asteroid_field
	show_sound = event_scanner
	location = event_target:trojan_asteroid
	
	is_triggered_only = yes

	option = {
		name = EXCELLENT

		event_target:trojan_asteroid = {
			set_deposit = d_energy_4
		}
	}
}

country_event = {
	id = distar.3003
	title = "trojan_asteroid_title"
	desc = {
		text = "distar.3003.desc"
		trigger = {
			owner = { NOT = { has_ethic = ethic_gestalt_consciousness } }
		}
	}
	desc = {
		text = "distar.3003.gc.desc"
		trigger = {
			owner = { has_ethic = ethic_gestalt_consciousness }
		}
	}
	picture = GFX_evt_small_space_battle
	show_sound = event_scanner
	location = event_target:trojan_asteroid
	trackable = yes
	
	is_triggered_only = yes

	option = {
		name = OK
		event_target:trojan_asteroid = {
			enable_special_project = {
				name = "trojan_asteroid_project"
				location = event_target:trojan_asteroid
				owner = root.owner
			}
		}
	}
}

ship_event = {
	id = distar.3005
	title = "trojan_asteroid_title"
	desc = {
		text = "distar.3005.desc"
		trigger = {
			owner = { NOT = { has_ethic = ethic_gestalt_consciousness } }
		}
	}
	desc = {
		text = "distar.3005.gc.desc"
		trigger = {
			owner = { has_ethic = ethic_gestalt_consciousness }
		}
	}
	picture = GFX_evt_asteroid_field
	show_sound = event_scanner
	location = event_target:trojan_asteroid

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		event_target:trojan_asteroid = {
			set_deposit = d_minerals_4
			hidden_effect = {
				random_list = {
					1 = { add_deposit = d_volatile_motes_1 }
					1 = { add_deposit = d_rare_crystals_1 }
					3 = { }
				}
			}
		}
	}
}


### Impossible Organism ###
ship_event = {
	id = distar.3010
	title = "impossible_organism_title"
	desc = "distar.3010.desc"
	picture = GFX_evt_toxic
	show_sound = event_scanner
	location = from
	trackable = yes

	is_triggered_only = yes

	immediate = {
		fromfrom = {
			save_event_target_as = impossible_organism_planet
		}

		save_event_target_as = impossible_organism_science_ship
	}

	option = { # Yes, sample it.
		name = distar.3010.a
		enable_special_project = {
			name = "impossible_organism_project_1"
			location = root.owner.capital_scope
			owner = root.owner
		}
	}

	option = { # No. Study it from afar.
		name = distar.3010.b
		custom_tooltip = distar.3010.b.tooltip
		hidden_effect = {
			event_target:impossible_organism_planet = {
				add_modifier = { modifier = impossible_organism days = -1 }
				clear_deposits = yes
				add_deposit = d_society_6
			}
		}
	}
}

country_event = { # Organism growing fast
	id = distar.3011
	title = "impossible_organism_title"
	desc = "distar.3011.desc"
	picture = GFX_evt_microscopic_life
	show_sound = event_scanner
	location = from
	trackable = yes

	is_triggered_only = yes

	option = { # Amazing. Proceed.
		name = distar.3011.a
		trigger = {
			NOR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
				has_valid_civic = civic_machine_terminator
			}
		}
		enable_special_project = {
			name = "impossible_organism_project_2"
			location = root.owner.capital_scope
			owner = root.owner
		}
	}

	option = { # Phobe
		name = distar.3011.a.phobe
		trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
				has_valid_civic = civic_machine_terminator
			}
		}
		enable_special_project = {
			name = "impossible_organism_project_2"
			location = root.owner.capital_scope
			owner = root.owner
		}
	}

	option = { # This alien is too dangerous.
		name = distar.3011.b
		custom_tooltip = distar.3011.b.tooltip
		hidden_effect = {
			country_event = { id = distar.3014 days = 1700 random = 200 }
		}
	}
}

country_event = { # It's a fungoid
	id = distar.3012
	title = "distar.3012.name"
	desc = "distar.3012.desc"
	picture = GFX_evt_microscopic_life
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	option = { # Yes, proceed.
		name = distar.3012.a
		trigger = {
			NOR = {
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_machine_terminator
			}
		}
		custom_tooltip = distar.3012.a.tooltip

		hidden_effect = {
			country_event = { id = distar.3013 days = 250 random = 50 }
		}
	}

	option = { # No, we must end this.
		name = distar.3012.b
		custom_tooltip = distar.3012.b.tooltip
		if = {
			limit = { is_xenophile = yes }
			gain_negative_media_coverage = yes
		}
		hidden_effect = {
			country_event = { id = distar.3014 days = 1300 random = 200 }
		}
	}
}

country_event = { # First words
	id = distar.3013
	title = "distar.3013.name"
	desc = "distar.3013.desc"
	picture = GFX_evt_microscopic_life
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	immediate = {
		random_owned_planet = {
			weights = {
				base = 1
				modifier = {
					add = 2
					free_housing > 0
				}
				modifier = {
					add = 5
					free_housing > 1
				}
				modifier = {
					add = 10
					free_housing > 5
				}
				modifier = {
					add = 10
					free_housing > 10
				}
				modifier = {
					add = 5
					planet_size > 17
				}
				modifier = {
					add = 5
					planet_size > 21
				}
			}
			save_event_target_as = nivlac_joint_planet
		}
	}

	option = { # Astonishing. Every species-X should have one!
		trigger = {
			OR = {
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
			}
		}

		allow = {
			#any_owned_planet = {
			#	free_housing > 0
			#}
		}

		name = distar.3013.a.xenophile
		custom_tooltip = distar.3013.a.tooltip

		hidden_effect = {
			create_species = {
				name = "NAME_Nivlac"
				plural = "NAME_Nivlacs"
				class = FUN
				portrait = "fun15"
				namelist = "FUN4"
				traits = {
					trait = "trait_nivlac"
					trait = "trait_quick_learners"
				}
				homeworld = event_target:nivlac_joint_planet
				effect = {
					save_global_event_target_as = nivlac_species
				}
			}
			event_target:nivlac_joint_planet = {
				while = {
					count = 15
					# housing cache doesn't update frequently enough atm
					#limit = {
					#	free_housing > 0
					#}
					create_pop = {
						species = event_target:nivlac_species
					}
				}
			}
			country_event = { id = distar.3017 days = 10 }
		}
	}

	option = { # Excellent. Species-X society could use them.
		trigger = {
			NOR = {
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
				has_civic = civic_hive_devouring_swarm
				has_civic = civic_machine_assimilator
				has_civic = civic_machine_servitor
			}
		}

		allow = {
			#any_owned_planet = {
			#	free_housing > 0
			#}
		}

		name = distar.3013.a
		custom_tooltip = distar.3013.a.tooltip

		hidden_effect = {
			create_species = {
				name = "NAME_Nivlac"
				plural = "NAME_Nivlacs"
				class = FUN
				portrait = "fun15"
				namelist = "FUN4"
				traits = {
					trait = "trait_nivlac"
					trait = "trait_quick_learners"
				}
				homeworld = event_target:nivlac_joint_planet
				effect = {
					save_global_event_target_as = nivlac_species
				}
			}
			event_target:nivlac_joint_planet = {
				while = {
					count = 15
					# housing cache doesn't update frequently enough atm
					#limit = {
					#	free_housing > 0
					#}
					create_pop = {
						species = event_target:nivlac_species
					}
				}
			}
			country_event = { id = distar.3017 days = 10 }
		}
	}
	
	option = { # Assimilator
		trigger = {
			has_civic = civic_hive_devouring_swarm
		}

		allow = {
			#any_owned_planet = {
			#	free_housing > 0
			#}
		}

		name = "distar.3013.a.swarm"
		custom_tooltip = "distar.3013.a.assi.tooltip"

		hidden_effect = {
			create_species = {
				name = "NAME_Nivlac"
				plural = "NAME_Nivlacs"
				class = FUN
				portrait = "fun15"
				namelist = "FUN4"
				traits = {
					trait = "trait_nivlac"
					trait = "trait_quick_learners"
				}
				homeworld = event_target:nivlac_joint_planet
				pops_can_reproduce = no
				effect = {
					save_global_event_target_as = nivlac_species
				}
			}
			event_target:nivlac_joint_planet = {
				while = {
					count = 15
					# housing cache doesn't update frequently enough atm
					#limit = {
					#	free_housing > 0
					#}
					create_pop = {
						species = event_target:nivlac_species
					}
				}
			}
			country_event = { id = distar.3017 days = 10 }
		}
	}

	option = { # Servitor
		trigger = {
			has_civic = civic_machine_servitor
		}

		allow = {
			#any_owned_planet = {
			#	free_housing > 0
			#}
		}

		name = "distar.3013.a.serv"
		custom_tooltip = "distar.3013.a.tooltip"

		hidden_effect = {
			create_species = {
				name = "NAME_Nivlac"
				plural = "NAME_Nivlacs"
				class = FUN
				portrait = "fun15"
				namelist = "FUN4"
				traits = {
					trait = "trait_nivlac"
					trait = "trait_quick_learners"
				}
				homeworld = event_target:nivlac_joint_planet
				pops_can_reproduce = yes
				effect = {
					save_global_event_target_as = nivlac_species
				}
			}
			event_target:nivlac_joint_planet = {
				while = {
					count = 15
					# housing cache doesn't update frequently enough atm
					#limit = {
					#	free_housing > 0
					#}
					create_pop = {
						species = event_target:nivlac_species
					}
				}
			}
			country_event = { id = distar.3017 days = 10 }
		}
	}

	option = { # Assimilator
		trigger = {
			has_civic = civic_machine_assimilator
		}

		allow = {
			#any_owned_planet = {
			#	free_housing > 0
			#}
		}

		name = "distar.3013.a.assi"
		custom_tooltip = "distar.3013.a.assi.tooltip"

		hidden_effect = {
			create_species = {
				name = "NAME_Nivlac"
				plural = "NAME_Nivlacs"
				class = FUN
				portrait = "fun15"
				namelist = "FUN4"
				traits = {
					trait = "trait_nivlac"
					trait = "trait_quick_learners"
				}
				homeworld = event_target:nivlac_joint_planet
				pops_can_reproduce = yes
				effect = {
					save_global_event_target_as = nivlac_species
				}
			}
			event_target:nivlac_joint_planet = {
				while = {
					count = 15
					# housing cache doesn't update frequently enough atm
					#limit = {
					#	free_housing > 0
					#}
					create_pop = {
						species = event_target:nivlac_species
					}
				}
			}
			country_event = { id = distar.3017 days = 10 }
		}
	}

	option = { # No room, Assimilator
		name = "distar.3013.b.no_room.kill"
		custom_tooltip = "distar.3013.b.no_room.kill.tooltip"

		trigger = {
			OR = {
				has_civic = civic_machine_assimilator
				is_xenophobe = yes
			}
		}
		add_monthly_resource_mult = {
			resource = influence
			value = @tier3influencereward
			min = @tier3influencemin
			max = @tier3influencemax
		}
	}

	option = { # Let's find them a home.
		name = "distar.3013.b"
		custom_tooltip = distar.3013.b.tooltip
		trigger = {
			NOT = { has_civic = civic_machine_assimilator }
			NOT = { has_civic = civic_hive_devouring_swarm }
		}
		hidden_effect = {
			country_event = { id = distar.3016 days = 730 random = 100 }
		}
	}
}

country_event = { # Planetfall on planet X after being shoot into deep space. Recalls our earlier disregard for their survival
	id = distar.3014
	title = "distar.3015.name"
	desc = "distar.3015.desc"
	picture = GFX_evt_alien_city
	show_sound = event_scanner
	location = event_target:nivlac_planet

	is_triggered_only = yes

	trigger = {
		any_system = {
			any_system_planet = {
				is_colonizable = yes
				has_owner = no
				is_colony = no
				habitable_planet = yes
				has_anomaly = no
				NOR = {
					has_modifier = "holy_planet"
					solar_system = {
						has_star_flag = hostile_system
					}
				}
				distance = {
					source = root.owner.capital_scope
					max_distance <= 300
					min_distance >= 50
				}
				solar_system = {
					NOT = { exists = starbase }
				}
			}
		}
	}

	immediate = {
		random_planet = {
			limit = {
				is_colonizable = yes
				has_owner = no
				is_colony = no
				habitable_planet = yes
				has_anomaly = no
				NOR = {
					has_modifier = "holy_planet"
					solar_system = {
						has_star_flag = hostile_system
					}
				}
				distance = {
					source = root.owner.capital_scope
					max_distance <= 300
					min_distance >= 50
				}
				solar_system = {
					NOT = { exists = starbase }
				}
			}
			save_global_event_target_as = nivlac_planet
		}
		create_species = {
			name = "NAME_Nivlac"
			plural = "NAME_Nivlacs"
			class = FUN
			portrait = "fun15"
			namelist = "FUN4"
			traits = {
				trait = "trait_nivlac"
				trait = "trait_quick_learners"
			}
			homeworld = event_target:nivlac_planet
			effect = {
				save_global_event_target_as = nivlac_species
			}
		}
		create_country = {
			name = NAME_Nivlac_Circle
			authority = random
			civics = random
			species = event_target:nivlac_species
			ignore_initial_colony_error = yes
			type = default
			ethos = random
			origin = origin_enlightened
			flag = random
			effect = {
				save_global_event_target_as = nivlac_country
				add_resource = { minerals = 2000 }
				add_resource = { energy = 2000 }
				add_resource = { alloys = 2000 }
				add_resource = { food = 200 }
				add_resource = { influence = 400 }
			}
		}
		event_target:nivlac_planet = {
			solar_system = {
				create_starbase = {
					size = starbase_starport
					owner = event_target:nivlac_country
					module = shipyard
					building = crew_quarters
					effect = {
						set_starbase_module = {
							slot = 1
							module = trading_hub
						}
					}
				}
			}
			set_owner = event_target:nivlac_country
			set_capital = yes
			clear_blockers = yes
			solar_system = {
				every_system_planet = {
					surveyed = {
						set_surveyed = yes
						surveyor = root.owner
					}
				}
			}
			while = {
				count = 22
				create_pop = {
					species = event_target:nivlac_species
				}					
			}
			add_district = district_city
			add_district = district_city
			add_district = district_city
			add_district = district_city
			add_district = district_farming
			add_district = district_farming
			add_district = district_farming
			add_district = district_mining
			add_district = district_mining
			add_district = district_generator
			add_district = district_generator
			add_building = building_capital
			add_building = building_research_lab_1
			add_building = building_foundry_1
			add_building = building_factory_1
			while = {
				count = 2
				create_army = {
					name = random
					owner = event_target:nivlac_country
					species = event_target:nivlac_species
					type = defense_army
				}
			}
		}

		event_target:nivlac_country = {
			if = {
				limit = {
					is_militarist = no
					is_pacifist = no
				}
				random_list = {
					1 = { }
					1 = {
						shift_ethic = ethic_militarist
						random_owned_pop = { pop_change_ethic = ethic_militarist }
						random_owned_pop = { pop_change_ethic = ethic_militarist }
						random_owned_pop = { pop_change_ethic = ethic_militarist }
						random_owned_pop = { pop_change_ethic = ethic_militarist }
						random_owned_pop = { pop_change_ethic = ethic_militarist }
						random_owned_pop = { pop_change_ethic = ethic_militarist }
					}
				}
			}
			if = {
				limit = {
					is_xenophobe = no
				}
				shift_ethic = ethic_xenophobe
				random_owned_pop = { pop_change_ethic = ethic_xenophobe }
				random_owned_pop = { pop_change_ethic = ethic_xenophobe }
				random_owned_pop = { pop_change_ethic = ethic_xenophobe }
				random_owned_pop = { pop_change_ethic = ethic_xenophobe }
				random_owned_pop = { pop_change_ethic = ethic_xenophobe }
				random_owned_pop = { pop_change_ethic = ethic_xenophobe }
				random_owned_pop = { pop_change_ethic = ethic_xenophobe }
				random_owned_pop = { pop_change_ethic = ethic_xenophobe }
			}
			change_government = {
				authority = random
				civics = random
			}
			create_fleet = {
				effect = {
					set_owner = prev

					create_ship = {
						name = random
						random_existing_design = science
					}

					set_fleet_stance = evasive				
					#set_location = prev.capital_star
					set_location = prev.capital_scope.star
					
					owner = {
						create_leader = {
							class = scientist
							species = owner_main_species
							name = random
							skill = 2
						}
					}
					set_leader = last_created_leader
				}			
			}
				
			#constructor
			create_fleet = {
				effect = {
					set_owner = prev
					
					create_ship = {
						name = random
						random_existing_design = constructor
					}
					
					set_fleet_stance = evasive
					set_location = prev.capital_star
				}
			}
			
			#military
			create_fleet = {
				set_take_point = yes
				effect = {
					set_owner = prev
					
					while = {
						count = 2
						create_ship = {
							name = random
							random_existing_design = corvette
						}
					}
					
					set_location = prev.capital_star
				}
			}
			create_leader = {
				class = scientist
				species = owner_main_species
				name = random
				skill = 2
			}
			create_leader = {
				class = scientist
				species = owner_main_species
				name = random
				skill = 2
			}
			create_leader = {
				class = scientist
				species = owner_main_species
				name = random
				skill = 2
			}
			create_leader = {
				class = governor
				species = owner_main_species
				name = random
				skill = 2
			}
			establish_communications_no_message = root
			add_opinion_modifier = {
				who = root
				modifier = opinion_discarded
			}
		}
	}

	option = {
		name = OOPS
	}
}

### Stranded Scientist ###
ship_event = {
	id = distar.3020
	title = "distar.3020.name"
	desc = "distar.3020.desc"
	picture = GFX_evt_exploding_ship
	show_sound = event_scanner
	location = from
	
	is_triggered_only = yes

	immediate = {
		save_event_target_as = stranded_scientist_science_ship

		if = {
			limit = { owner_species = { species_portrait = human } }
			create_species = {
				name = random
				class = HUM
				portrait = "humanoid_05"
				namelist = "HUM2"
				traits = random
				effect = {
					save_event_target_as = stranded_scientist_species
				}
			}
		}
		else = {
			create_species = {
				name = PRESCRIPTED_species_name_humans1
				class = HUM
				portrait = "human"
				namelist = "HUMAN1"
				traits = {
					trait = "trait_adaptive"
					trait = "trait_nomadic"
					trait = "trait_wasteful"
				}
				effect = {
					save_event_target_as = stranded_scientist_species
				}
			}
		}
		create_country = {
			name = random
			type = faction
			flag = {
    		    icon = {
    		        category = "special"
    		        file = "unknown.dds"
    		    }
    		    background = {
    		        category = "backgrounds"
    		        file = "00_solid.dds"
    		    }
    		    colors = {
    		        "blue"
    		        "blue"
    		        "null"
    		        "null"
    		    }
    		}
    		effect = {
    			save_event_target_as = stranded_scientist_country
    		}
    	}
		event_target:stranded_scientist_country = {
			create_leader = {
				class = scientist
				species = event_target:stranded_scientist_species
				name = random
				skill = 6
				event_leader = yes
				leader_age_min = 30
				leader_age_max = 50
				traits = {
					trait = "leader_trait_expertise_computing"
					trait = "leader_trait_spark_of_genius"
				}
			}
		}
		last_created_leader = {
			set_is_female = yes
			save_event_target_as = stranded_scientist_leader
		}
	}

	option = { # Granted
		name = distar.3020.a
		custom_tooltip = distar.3020.a.tooltip

		hidden_effect = {
			owner = {
				country_event = { id = distar.3021 days = 60 }

				clone_leader = {
					target = event_target:stranded_scientist_leader
					class = scientist
					effect = {
						save_event_target_as = stranded_scientist_leader_clone
					}
				}
			}
			event_target:stranded_scientist_leader = {
				kill_leader = { type = scientist show_notification = no }
			}
		}
	}

	option = { # No. Leave her.
		name = distar.3020.b
		custom_tooltip = distar.3020.b.tooltip

		random_list = {
			1 = {
				leader = { add_trait = leader_trait_adaptable }
			}
			1 = {
				leader = { add_trait = leader_trait_paranoid }
			}
		}

		hidden_effect = {
			event_target:stranded_scientist_leader = {
				kill_leader = { type = scientist show_notification = no }
			}
		}
	}
}

### Molluscoid Miners ###
ship_event = {
	id = distar.3030
	title = "distar.3030.name"
	desc = "distar.3030.desc"
	picture = GFX_evt_alien_cavemen
	show_sound = event_scanner
	location = from
	trackable = yes
	
	is_triggered_only = yes

	immediate = {
		fromfrom = {
			save_event_target_as = molluscoid_miners_planet
		}
	}

	option = { # Intriguing. Study them further.
		name = distar.3030.a

		enable_special_project = {
			name = "molluscoid_miners_project_1"
			location = event_target:molluscoid_miners_planet
			owner = root.owner
		}
	}

	option = { # Mine their minerals.
		name = distar.3030.b
		owner = {
			add_monthly_resource_mult = {
				resource = minerals
				value = @tier1materialreward
				min = @tier1materialmin
				max = @tier1materialmax
			}
			IF = {
				limit = {
					OR = {
						has_ethic = ethic_fanatic_xenophile
						has_ethic = ethic_xenophile
					}
				}
				add_modifier = {
					modifier = disregard_for_alien_life
					days = 360
				}
				gain_negative_media_coverage = yes
			}
		}
	}
}

country_event = { # More info about the molluscs
	id = distar.3031
	title = "distar.3030.name"
	desc = "distar.3031.desc"
	picture = GFX_evt_alien_cavemen
	show_sound = event_scanner
	location = from
	trackable = yes

	is_triggered_only = yes

	option = {  # Yes. Proceed with the integration.
		name = distar.3031.a

		enable_special_project = {
			name = "molluscoid_miners_project_2"
			location = root.owner.capital_scope
			owner = root.owner
		}
	}

	option = { # Yes, use this knowledge (to further our technology)
		name = distar.3031.b
		hidden_effect = {
			event_target:molluscoid_miners_planet = {
				create_species = {
					name = random
					class = MOL
					portrait = "mol6"
					namelist = "MOL2"
					traits = {
						trait = "trait_slow_learners"
						trait = "trait_industrious"
					}
					homeworld = event_target:molluscoid_miners_planet
					sapient = no
					effect = {
						save_global_event_target_as = molluscoid_miners_species
					}
				}
				while = {
					limit = {
						count_pops = {
							limit = { is_sapient = no }
							count < 6
						}
					}
					create_pop = { species = last_created }
				}
			}
		}
		enable_special_project = {
			name = "molluscoid_miners_project_3"
			location = root.owner.capital_scope
			owner = root.owner
		}
	}

	option = { # No. Mine their planet.
		name = distar.3031.c
		add_monthly_resource_mult = {
			resource = minerals
			value = @tier2materialreward
			min = @tier2materialmin
			max = @tier2materialmax
		}
		IF = {
			limit = {
				OR = {
					has_ethic = ethic_fanatic_xenophile
					has_ethic = ethic_xenophile
				}
			}
			add_modifier = {
				modifier = disregard_for_alien_life
				days = 360
			}
			gain_negative_media_coverage = yes
		}
	}
}

### Orbital Speed Demon ###

country_event = { # Alien Box opened
	id = distar.3055
	title = "distar.3055.name"
	desc = {
		trigger = {
			hidden:owner = {
				switch = {
					trigger = has_country_flag
					alien_box_researched = { text = distar.3055.desc.1 }
					default = { text = distar.3055.desc }
				}
			}
		}
	}
	picture = GFX_evt_genetic_modification
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	option = { # Use the red solution
		name = distar.3055.a
		allow = { is_robot_empire = no }
		custom_tooltip = distar.3055.a.tooltip
		hidden_effect = {
			modify_species = {
				species = this
				add_trait = trait_social_pheromones
			}
			set_country_flag = verystrong_added # actually socialer now, but keeping the flags
			change_dominant_species = {
				species = last_created_species
			}
			while = {
				limit = {
					any_owned_pop = {
						is_subspecies = root
						NOT = { has_trait = trait_social_pheromones }
					}
				}
				random_owned_pop = {
					limit = {
						is_subspecies = root
						NOT = { has_trait = trait_social_pheromones }
					}
					root = {
						modify_species = {
							species = prev.species
							add_trait = trait_social_pheromones
						}
					}
				}
			}
			set_country_flag = modification_stronger # actually socialer now, but keeping the flags
			country_event = { id = distar.3057 days = 5 }
		}
	}

	option = { # Use the green solution
		name = distar.3055.b
		allow = { is_robot_empire = no }
		custom_tooltip = distar.3055.b.tooltip
		hidden_effect = {
			modify_species = {
				species = this
				add_trait = trait_bioadaptability
			}
			set_country_flag = extremelyadaptive_added
			change_dominant_species = {
				species = last_created_species
			}
			while = {
				limit = {
					any_owned_pop = {
						is_subspecies = root
						NOT = { has_trait = trait_bioadaptability }
					}
				}
				random_owned_pop = {
					limit = {
						is_subspecies = root
						NOT = { has_trait = trait_bioadaptability }
					}
					root = {
						modify_species = {
							species = prev.species
							add_trait = trait_bioadaptability
						}
					}
				}
			}
			set_country_flag = modification_adaptive
			country_event = { id = distar.3057 days = 5 }
		}
	}

	option = { # Use the blue solution
		name = distar.3055.c
		allow = { is_robot_empire = no }
		custom_tooltip = distar.3055.c.tooltip
		hidden_effect = {
			modify_species = {
				species = this
				add_trait = trait_limited_regeneration
			}
			set_country_flag = venerable_added
			change_dominant_species = {
				species = last_created_species
			}
			while = {
				limit = {
					any_owned_pop = {
						is_subspecies = root
						NOT = { has_trait = trait_limited_regeneration }
					}
				}
				random_owned_pop = {
					limit = {
						is_subspecies = root
						NOT = { has_trait = trait_limited_regeneration }
					}
					root = {
						modify_species = {
							species = prev.species
							add_trait = trait_limited_regeneration
						}
					}
				}
			}
			set_country_flag = modification_longlived
			country_event = { id = distar.3057 days = 5 }
		}
	}

	option = { # Sell them
		name = distar.3055.d
		custom_tooltip = distar.3055.d.tooltip
		add_monthly_resource_mult = {
			resource = energy
			value = @tier3materialreward
			min = @tier3materialmin
			max = @tier3materialmax
		}
		add_monthly_resource_mult = {
			resource = minerals
			value = @tier2materialreward
			min = @tier2materialmin
			max = @tier2materialmax
		}
		hidden_effect = {
			if = {
				limit = {
					any_relation = {
						is_robot_empire = no
						is_homicidal = no
						is_ai = yes
						OR = {
							is_country_type = default
							is_country_type = ascended_empire
							is_country_type = lost_empire
						}
						OR = {
							is_xenophile = yes
							is_materialist = yes
							is_friendly_to = ROOT
							is_cordial_to = ROOT
							is_protective_to = ROOT
						}
					}
				}
				random_relation = {
					limit = {
						is_robot_empire = no
						is_homicidal = no
						is_ai = yes
						OR = {
							is_country_type = default
							is_country_type = ascended_empire
							is_country_type = lost_empire
						}
						OR = {
							is_xenophile = yes
							is_materialist = yes
							is_friendly_to = ROOT
							is_cordial_to = ROOT
							is_protective_to = ROOT
						}
					}
					save_event_target_as = purchasing_country
					random_list = {
						1 = {
							ROOT = { set_country_flag = modification_stronger }
							modify_species = {
								species = this
								add_trait = trait_social_pheromones
							}
							change_dominant_species = {
								species = last_created_species
							}
							while = {
								limit = {
									any_owned_pop = {
										is_subspecies = event_target:purchasing_country
										NOT = { has_trait = trait_social_pheromones }
									}
								}
								random_owned_pop = {
									limit = {
										is_subspecies = event_target:purchasing_country
										NOT = { has_trait = trait_social_pheromones }
									}
									root = {
										modify_species = {
											species = prev.species
											add_trait = trait_social_pheromones
										}
									}
								}
							}
						}
						1 = {
							ROOT = { set_country_flag = modification_adaptive }
							modify_species = {
								species = this
								add_trait = trait_bioadaptability
							}
							change_dominant_species = {
								species = last_created_species
							}
							while = {
								limit = {
									any_owned_pop = {
										is_subspecies = event_target:purchasing_country
										NOT = { has_trait = trait_bioadaptability }
									}
								}
								random_owned_pop = {
									limit = {
										is_subspecies = event_target:purchasing_country
										NOT = { has_trait = trait_bioadaptability }
									}
									root = {
										modify_species = {
											species = prev.species
											add_trait = trait_bioadaptability
										}
									}
								}
							}
						}
						1 = {
							ROOT = { set_country_flag = modification_longlived }
							modify_species = {
								species = this
								add_trait = trait_limited_regeneration
							}
							change_dominant_species = {
								species = last_created_species
							}
							while = {
								limit = {
									any_owned_pop = {
										is_subspecies = event_target:purchasing_country
										NOT = { has_trait = trait_limited_regeneration }
									}
								}
								random_owned_pop = {
									limit = {
										is_subspecies = event_target:purchasing_country
										NOT = { has_trait = trait_limited_regeneration }
									}
									root = {
										modify_species = {
											species = prev.species
											add_trait = trait_limited_regeneration
										}
									}
								}
							}
						}
					}
				}
				country_event = { id = anomalymod.89 days = 5 }
			}
		}
	}
	
	option = {
		name = distar.3055.e
		custom_tooltip = distar.3055.e.tooltip
		add_monthly_resource_mult = {
			resource = society_research
			value = @tier5materialreward
			min = @tier5materialmin
			max = @tier5materialmax
		}
	}
}

country_event = { # Alien Box researched
	id = distar.3056
	title = "distar.3056.name"
	desc = "distar.3056.desc"
	picture = GFX_evt_physics_research
	show_sound = event_scanner
	location = from
	trackable = yes

	is_triggered_only = yes

	option = { # Open it.
		name = distar.3056.a
		enable_special_project = {
			name = "speed_demon_open_box_project"
			location = root.owner.capital_scope
			owner = root.owner
		}
		custom_tooltip = distar.3056.a.tooltip
		add_monthly_resource_mult = {
			resource = physics_research
			value = @tier4researchreward
			min = @tier4researchmin
			max = @tier4researchmax
		}
	}

	option = { # Sell it.
		name = distar.3056.b
		custom_tooltip = distar.3056.b.tooltip
		add_monthly_resource_mult = {
			resource = energy
			value = @tier2materialreward
			min = @tier2materialmin
			max = @tier2materialmax
		}
		add_monthly_resource_mult = {
			resource = minerals
			value = @tier1materialreward
			min = @tier1materialmin
			max = @tier1materialmax
		}
		custom_tooltip = distar.3056.a.tooltip
		add_monthly_resource_mult = {
			resource = physics_research
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
		hidden_effect = {
			if = {
				limit = {
					any_relation = {
						is_robot_empire = no
						is_homicidal = no
						is_ai = yes
						OR = {
							is_country_type = default
							is_country_type = ascended_empire
							is_country_type = lost_empire
						}
						OR = {
							is_xenophile = yes
							is_materialist = yes
							is_friendly_to = ROOT
							is_cordial_to = ROOT
							is_protective_to = ROOT
						}
					}
				}
				random_relation = {
					limit = {
						is_robot_empire = no
						is_homicidal = no
						is_ai = yes
						OR = {
							is_country_type = default
							is_country_type = ascended_empire
							is_country_type = lost_empire
						}
						OR = {
							is_xenophile = yes
							is_materialist = yes
							is_friendly_to = ROOT
							is_cordial_to = ROOT
							is_protective_to = ROOT
						}
					}
					save_event_target_as = purchasing_country
					random_list = {
						1 = {
							ROOT = { set_country_flag = modification_stronger }
							modify_species = {
								species = this
								add_trait = trait_social_pheromones
							}
						}
						1 = {
							ROOT = { set_country_flag = modification_adaptive }
							modify_species = {
								species = this
								add_trait = trait_bioadaptability
							}
						}
						1 = {
							ROOT = { set_country_flag = modification_longlived }
							modify_species = {
								species = this
								add_trait = trait_limited_regeneration
							}
						}
					}
				}
				country_event = { id = anomalymod.89 days = 10 }
			}
		}
	}
}

##### THE ENIGMATIC CACHE ######

event = {
	id = distar.2050
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		has_distar = yes
		NOT = {
			any_system = {
				has_star_flag = enigmatic_cache_system
			}
		}
		any_playable_country = {
			is_ai = no
		}
	}
	immediate = {
		# spawn tube by random gateway
		random_system = {
			limit = {
				any_system_megastructure = {
					OR = {
						is_megastructure_type = gateway_ruined
						is_megastructure_type = gateway_restored
						is_megastructure_type = gateway_final
						is_megastructure_type = lgate_base
					}
				}
			}
			star = {
				planet_event = { id = distar.20501 }
			}
		}
	}
}

planet_event = {
	id = distar.20501
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		# save spawn point
		solar_system = {
			if = {
				limit = {
					any_system_megastructure = {
						OR = {
							is_megastructure_type = gateway_ruined
							is_megastructure_type = gateway_restored
							is_megastructure_type = gateway_final
							is_megastructure_type = lgate_base
						}
					}
				}
				random_system_megastructure = {
					limit = {
						OR = {
							is_megastructure_type = gateway_ruined
							is_megastructure_type = gateway_restored
							is_megastructure_type = gateway_final
							is_megastructure_type = lgate_base
						}
					}
					save_event_target_as = spawning_gateway
				}
			}
			# use root planet as spawn point if fired for debugging
			else = {
				root = {
					save_event_target_as = spawning_gateway
				}
			}
		}
		# Finding a target planet to scan and spawning enigmatic cache system
		if = {
			limit = {
				any_system = {
					exists = owner
					owner = {
						is_country_type = default
						is_at_war = no
						any_owned_planet = {
							is_colony = yes
							NOT = { has_planet_flag = has_been_scanned }
						}
					}
				}
			}
			if = {
				limit = {
					any_system = {
						exists = owner
						owner = {
							is_ai = no
							is_country_type = default
							is_at_war = no
							any_owned_planet = {
								is_colony = yes
								NOT = { has_planet_flag = has_been_scanned }
							}
						}
					}
				}
				closest_system = {
					limit = {
						exists = owner
						owner = {
							is_country_type = default
							is_at_war = no
							is_ai = no
							any_owned_planet = {
								is_colony = yes
								NOT = { has_planet_flag = has_been_scanned }
							}
						}
					}
					random_system_planet = {
						limit = { exists = owner }
						#set_planet_flag = has_been_scanned
						save_event_target_as = new_location
						solar_system = { set_star_flag = enigmatic_cache_system }
					}
				}
			}
		}
		else = {
			closest_system = {
				limit = {
					exists = owner
					owner = {
						is_country_type = default
						is_at_war = no
						any_owned_planet = {
							is_colony = yes
							NOT = { has_planet_flag = has_been_scanned }
						}
					}
				}
				random_system_planet = {
					limit = { exists = owner }
					#set_planet_flag = has_been_scanned
					save_event_target_as = new_location
					solar_system = { set_star_flag = enigmatic_cache_system }
				}
			}
		}
		create_country = {
			name = "NAME_enigmatic_cache"
			type = enigmatic_cache
			flag = {
				icon = {
					category = spherical
					file = flag_spherical_4.dds
				}
				background = {
					category = backgrounds
					file = "00_solid.dds"
				}
				colors = {
					"black"
					"black"
					"null"
					"null"
				}
			}
			effect = {
				save_global_event_target_as = enigmatic_cache_country
			}
		}
		event_target:enigmatic_cache_country = {
			set_graphical_culture = guardian_01
			create_enigmatic_cache_fleet = yes
		}
		every_country = {
			establish_communications_no_message = event_target:enigmatic_cache_country
		}
	}
}

#Notification the first time the cache scans one of your planets
planet_event = {
	id = distar.5057
	title = distar.5057.name
	desc = {
		text = distar.5057.desc
		trigger = {
			owner = { is_xenophobe = no }
		}
	}
	desc = {
		text = distar.5057.desc.phobe
		trigger = {
			owner = { is_xenophobe = yes }
		}
	}
	picture = GFX_evt_enigmatic_cache
	show_sound = event_mystic_reveal
	location = Root

	is_triggered_only = yes
	trigger = {
		exists = owner
		owner = {
			NOT = {
				has_country_flag = discovered_enigmatic_cache
			}
		}
	}

	immediate = {
		every_owned_pop = {
			limit = {
				OR = {
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe
				}
			}
			add_modifier = {
				modifier = enigmatic_cache_in_orbit_phobe
				days = -1
			}
		}
		owner = { set_country_flag = discovered_enigmatic_cache }
	}

	option = {
		name = distar.5057.a
		enable_special_project = {
			name = "ENIGMATIC_CACHE_PROJECT"
			location = root
			owner = root.owner
		}
	}

	option = {
		name = distar.5057.b
		owner = {
			add_resource = { influence = 50 }
		}
	}
}

#################################
#
# Distant Stars events
#
# distar.8000 - distar.19999
#
#################################

# Injected cluenomaly followup
country_event = {
	id = distar.9000
	title = distar.9000.name
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_sonic
		}
		text = distar.9000.lcluster_clue_sonic
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_desc_1
		}
		text = distar.9000.lcluster_clue_desc_1
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_desc_2
		}
		text = distar.9000.lcluster_clue_desc_2
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_desc_3
		}
		text = distar.9000.lcluster_clue_desc_3
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_pirate
		}
		text = distar.9000.lcluster_clue_pirate
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_battle
		}
		text = distar.9000.lcluster_clue_battle
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_graveyard
		}
		text = distar.9000.lcluster_clue_graveyard
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_dark_flow
		}
		text = distar.9000.lcluster_clue_dark_flow
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_clones
		}
		text = distar.9000.lcluster_clue_clones
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_junkyard
		}
		text = distar.9000.lcluster_clue_junkyard
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_junkball
		}
		text = distar.9000.lcluster_clue_junkball
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_ratling
		}
		text = distar.9000.lcluster_clue_ratling
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_bunker_bot
		}
		text = distar.9000.lcluster_clue_bunker_bot
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_asteroid_gate
		}
		text = distar.9000.lcluster_clue_asteroid_gate
	}
	desc = {
		trigger = {
			has_country_flag = lcluster_clue_mineral_processing
		}
		text = distar.9000.lcluster_clue_mineral_processing
	}
	desc = distar.9000.fallback
	picture = GFX_evt_drifting_gateway
	location = capital_scope

	is_triggered_only = yes

	# immediate is run before window is drawn,
	# might be safest to remove flags in AFTER?

	after = {
		hidden_effect = {
			switch = {
				trigger = has_country_flag
				lcluster_clue_sonic = { remove_country_flag = lcluster_clue_sonic }
				lcluster_clue_desc_1 = { remove_country_flag = lcluster_clue_desc_1 }
				lcluster_clue_desc_2 = { remove_country_flag = lcluster_clue_desc_2 }
				lcluster_clue_desc_3 = { remove_country_flag = lcluster_clue_desc_3 }
				lcluster_clue_pirate = { remove_country_flag = lcluster_clue_pirate }
				lcluster_clue_battle = { remove_country_flag = lcluster_clue_battle }
				lcluster_clue_graveyard = { remove_country_flag = lcluster_clue_graveyard }
				lcluster_clue_dark_flow = { remove_country_flag = lcluster_clue_dark_flow }
				lcluster_clue_clones = { remove_country_flag = lcluster_clue_clones }
				lcluster_clue_junkyard = { remove_country_flag = lcluster_clue_junkyard }
				lcluster_clue_junkball = { remove_country_flag = lcluster_clue_junkball }
				lcluster_clue_ratling = { remove_country_flag = lcluster_clue_ratling }
				lcluster_clue_bunker_bot = { remove_country_flag = lcluster_clue_bunker_bot }
				lcluster_clue_asteroid_gate = { remove_country_flag = lcluster_clue_asteroid_gate }
				lcluster_clue_mineral_processing = { remove_country_flag = lcluster_clue_mineral_processing }
			}
		}
	}

	option = {
		name = FORTUITOUS
		generate_lcluster_clue = yes
		if = {
			limit = {
				OR = {
					has_country_flag = lcluster_clue_desc_1
					has_country_flag = lcluster_clue_desc_3
					has_country_flag = lcluster_clue_junkyard
					has_country_flag = lcluster_clue_battle
					has_country_flag = lcluster_clue_graveyard
					has_country_flag = lcluster_clue_mineral_processing
				}
			}
			add_resource = { nanites = 250 }
		}
	}
}

# check for gateway within borders
country_event = {
	id = distar.10900
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				any_owned_megastructure = {
					is_megastructure_type = lgate_base
				}
				OR = {
					is_ai = no
					NOT = { has_global_flag = gray_goo_crisis_set }
					fleet_power > 30000
				}
			}
			random_owned_megastructure = {
				limit = {
					is_megastructure_type = lgate_base
				}
				save_event_target_as = candidate_gateway
			}
			country_event = { id = distar.10905 } # enable project
		}
		else = {
			country_event = { id = distar.10901 } # looping check
		}
	}
}

# does not have gateway
country_event = {
	id = distar.10901
	title = "distar.10901.title"
	desc = "distar.10901.desc"
	picture = GFX_evt_binary_stars
	show_sound = event_mystic_reveal

	is_triggered_only = yes

	option = {
		name = "distar.10901.a"
		hidden_effect = {
			set_country_flag = candiate_gateway_looping_check
			country_event = { id = distar.10902 days = 60 }
		}
	}

	option = {
		name = "distar.10901.b"
		trigger = { is_ai = no }
		liquidate_clues = yes
	}
}

# looping check for owning gateway, once every two months
country_event = {
	id = distar.10902
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = l_cluster_opened }
	}

	immediate = {
		if = {
			limit = {
				any_owned_megastructure = {
					is_megastructure_type = lgate_base
				}
				has_technology = tech_lgate_activation
				OR = {
					is_ai = no
					NOT = { has_global_flag = gray_goo_crisis_set }
					fleet_power > 30000
				}
			}
			random_owned_megastructure = {
				limit = {
					is_megastructure_type = lgate_base
				}
				save_event_target_as = candidate_gateway
			}
			country_event = { id = distar.10905 } # enable project
		}
		else = {
			country_event = { id = distar.10902 days = 60 } # *THIS* looping check
		}
	}
}