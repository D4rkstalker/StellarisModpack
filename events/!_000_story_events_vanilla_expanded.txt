###############################
# Narrative Progression Events
# by Maximilian Olbers
###############################

namespace = story

### 2 - Spacers
country_event = {
	id = story.2
	title = story.2.name
	# First / Fallback
	desc = {
		trigger = {
			OR = {
				#fallback
				AND = {
					has_country_flag = StoryFirst
					NOR = {
						has_ethic = ethic_fanatic_xenophile
						has_ethic = ethic_xenophile
						is_gestalt = yes
					}
				}
				#first
				NOR = {
					has_country_flag = StoryFirst
					is_gestalt = yes
				}
			}
		}
		text = story.2.desc
	}
	# Gestalt Consciousness
	desc = {
		trigger = { is_gestalt = yes }
		text = story.2.desc.gesta
	}
	# Xenophile regardless of status
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
			}
		}
		text = story.2.desc.phile
	}
	# Followup
	desc = {
		trigger = {
			has_country_flag = Story1
			NOT = { is_gestalt = yes }
		}
		text = story.2.desc.followup
	}
	picture = GFX_evt_news_room
	show_sound = event_scanner
#	location = from

	is_triggered_only = yes

	trigger = {
		NOR = {
			has_country_flag = Story2
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = StoryFirst } }
			set_country_flag = StoryFirst
		}
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
		set_country_flag = Story2
	}

	option = {
		name = FASCINATING
	}
}

### 3 - Animalia
country_event = {
	id = story.3
	title = story.3.name
	# First
	desc = {
		text = story.3.desc
		trigger = {
			NOT = {
				has_country_flag = StoryFirst
			}
		}
	}
	# Gestalt Consciousness
	desc = {
		text = story.3.desc.gesta
		trigger = { is_gestalt = yes }
	}
	# Spiritualist regardless of status
	desc = {
		text = story.3.desc.spiri
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
		}
	}
	# Followup
	desc = {
		trigger = { OR = { has_country_flag = Story1 has_country_flag = Story2 } }
		text = story.3.desc.followup
	}
	picture = GFX_evt_news_room
	show_sound = event_scanner

	is_triggered_only = yes

	trigger = {
		NOR = {
			has_country_flag = Story3
			has_country_flag = Story4
			has_country_flag = Story6
			has_country_flag = Story7
			has_origin = origin_remnants
			has_origin = origin_scion
			has_origin = origin_common_ground
			has_origin = origin_hegemon
			has_origin = origin_lost_colony
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = StoryFirst } }
			set_country_flag = StoryFirst
		}
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
		#set_country_flag = Story3
		set_country_flag = root
	}

	option = {
		name = INTERESTING
	}
}

### 4 - Pre-Sapients
country_event = {
	id = story.4
	title = story.4.name
	# First
	desc = {
		trigger = { NOT = {has_country_flag = StoryFirst } }
		text = story.4.desc
	}
	# Gestalt Consciousness
	desc = {
		trigger = { is_gestalt = yes }
		text = story.4.desc.gesta
	}
	# Fanatic Spiritualist regardless of status
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_spiritualist has_ethic = ethic_spiritualist } }
		text = story.4.desc.spiri
	}
	# Xenophobe
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_xenophobe
				has_ethic = ethic_xenophobe
			}
		}
		text = story.4.desc.phobe
	}
	# Xenophile
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
			}
		}
		text = story.4.desc.phile
	}
	# Followup
	desc = {
		trigger = {
			OR = {
				has_country_flag = Story1
				has_country_flag = Story2
				has_country_flag = Story3
			}
		}
		text = story.4.desc.followup
	}
	picture = GFX_evt_news_room
	show_sound = event_scanner

	is_triggered_only = yes

	trigger = {
		NOR = {
			has_country_flag = has_uplifted_species
			has_country_flag = Story4
			has_country_flag = Story41
			has_country_flag = Story6
			has_country_flag = Story7
			has_origin = origin_remnants
			has_origin = origin_scion
			has_origin = origin_common_ground
			has_origin = origin_hegemon
			has_origin = origin_lost_colony
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = StoryFirst } }
			set_country_flag = StoryFirst
		}
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
		set_country_flag = Story4
	}

	option = {
		trigger = { NOR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		name = FASCINATING
	}

	option = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		name = DISCONCERTING
	}

	option = {
		exclusive_trigger = { has_valid_civic = civic_machine_exploration_protocol }
		name = fircon.machine_exploration_protocol
	}

	after = {
		hidden_effect = {
			country_event = { id = first_contact.1060 days = 10 random = 10 }
			if = {
				limit = {
					is_fear_of_the_dark_empire = yes
				}
				country_event = { id = origin.6030 }
			}
		}
	}
}

### 5 - Remnants
country_event = {
	id = story.5
	title = story.5.name
	# First
	desc = {
		trigger = { NOT = { has_country_flag = StoryFirst } }
		text = story.5.desc
	}
	# Gestalt Consciousness
	desc = {
		trigger = { is_gestalt = yes }
		text = story.5.desc.gesta
	}
	# Xenophobe
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		text = story.5.desc.phobe
	}
	# Xenophile
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophile has_ethic = ethic_xenophile } }
		text = story.5.desc.phile
	}
	# Followup
	desc = {
		trigger = {
			OR = {
				has_country_flag = Story1
				has_country_flag = Story2
				has_country_flag = Story3
				has_country_flag = Story4
			}
		}
		text = story.5.desc.followup
	}
	picture = GFX_evt_news_room
	show_sound = event_scanner

	is_triggered_only = yes

	trigger = {
		NOR = {
			has_country_flag = Story5
			has_country_flag = Story6
			has_country_flag = Story7
			has_origin = origin_remnants
			has_origin = origin_scion
			has_origin = origin_common_ground
			has_origin = origin_hegemon
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = StoryFirst } }
			set_country_flag = StoryFirst
		}
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
		set_country_flag = Story5
	}

	option = {
		name = REMARKABLE
	}

	after = {
		hidden_effect = {
			country_event = { id = first_contact.1060 days = 10 random = 10 }
		}
		if = {
			limit = {
				is_fear_of_the_dark_empire = yes
			}
			country_event = { id = origin.6030 }
		}
	}
}

### 7 - Unknown Empire
country_event = {
	id = story.7
	title = story.7.name
	# First
	desc = {
		trigger = { NOT = { has_country_flag = StoryFirst } }
		text = story.7.desc
	}
	# Gestalt Consciousness
	desc = {
		trigger = { is_gestalt = yes }
		text = story.7.desc.gesta
	}
	# Xenophobe
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		text = story.7.desc.phobe
	}
	# Xenophile
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophile has_ethic = ethic_xenophile } }
		text = story.7.desc.phile
	}
	# Followup 6
	desc = {
		trigger = { has_country_flag = Story6 }
		text = story.7.desc.followup6
	}
	# Followup 1-2-3-4-5
	desc = {
		trigger = {
			NOT = { is_machine_empire = yes }
			OR = {
				has_country_flag = Story1
				has_country_flag = Story2
				has_country_flag = Story3
				has_country_flag = Story4
				has_country_flag = Story5
			}
		}
		text = story.7.desc.followup12345
	}
	# Followup 1-2-3-4-5 Machine Intelligences
	desc = {
		trigger = {
			is_machine_empire = yes
			OR = {
				has_country_flag = Story1
				has_country_flag = Story2
				has_country_flag = Story3
				has_country_flag = Story4
				has_country_flag = Story5
			}
		}
		text = story.7.desc.mach.followup12345
	}
	picture = {
		picture = GFX_evt_news_room
		trigger = { NOT = { is_gestalt = yes } }
	}
	picture = {
		picture = GFX_evt_unknown_ships
		trigger = { is_gestalt = yes }
	}
	show_sound = event_scanner

	is_triggered_only = yes

	trigger = {
		NOR = {
			has_country_flag = Story7
			has_origin = origin_scion
			has_origin = origin_common_ground
			has_origin = origin_hegemon
		}
		FROM = {
			NOR = {
				has_country_flag = radical_cult
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = primitive
				is_guardian_country = yes
				has_relation_flag = { flag = no_coms who = root }
				has_relation_flag = { flag = AbandonedRefugees who = root }
				has_relation_flag = { flag = pirate_relation who = root }
				has_country_flag = day_0
			}
		}
	}

	immediate = {
		set_country_flag = Story7
		set_country_flag = has_encountered_other_empire
		if = {
			limit = { NOT = { has_country_flag = StoryFirst } }
			set_country_flag = StoryFirst
		}
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
	}

	option = {
		trigger = { NOR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		name = INTRIGUING
	}
	option = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		name = WORRYING
	}

	option = {
		exclusive_trigger = { has_valid_civic = civic_machine_exploration_protocol }
		name = fircon.machine_exploration_protocol
	}

	after = {
		hidden_effect = {
			country_event = { id = first_contact.1060 days = 10 random = 10 }
			if = {
				limit = {
					is_fear_of_the_dark_empire = yes
				}
				country_event = { id = origin.6040 }
			}
		}
	}
}

# Surveyor Activated
country_event = {
	id = story.335
	title = story.335.name
	desc = story.335.desc
	picture = GFX_evt_mining_operations
	location = event_target:chosen_planet

	is_triggered_only = yes

	immediate = {
		random_planet_within_border = {
			limit = {
				habitable_planet = no
				is_artificial = no
				NOR = {
					is_planet_class = pc_ringworld_habitable_damaged
					is_planet_class = pc_ringworld_tech_damaged
					is_planet_class = pc_ringworld_tech
					is_planet_class = pc_ringworld_seam
					is_planet_class = pc_ringworld_seam_damaged
				}
				# check that the random list won't come up empty
				OR = {
					energy_candidate = yes
					mineral_candidate = yes
					research_candidate = yes
					alloy_candidate = yes
					exotic_gas_candidate = yes
					rare_crystal_candidate = yes
					volatile_motes_candidate = yes
					ROOT = { is_gestalt = no }
				}
			}
			save_event_target_as = chosen_planet
		}
	}

	option = {
		name = EXCELLENT

		locked_random_list = {

			# Energy
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { energy_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_energy_5 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { energy_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_energy_7 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { energy_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_energy_9 }
			}

			# Minerals
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { mineral_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_minerals_5 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { mineral_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_minerals_7 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { mineral_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_minerals_9 }
			}

			# Physics
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { research_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_physics_5 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { research_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_physics_7 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { research_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_physics_9 }
			}

			# Society
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { research_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_society_5 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { research_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_society_7 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { research_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_society_9 }
			}

			# Engineering
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { research_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_engineering_5 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { research_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_engineering_7 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { research_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_engineering_9 }
			}

			# Trade
			10 = {
				modifier = {
					factor = 0
					is_gestalt = yes
				}
				event_target:chosen_planet = { add_deposit = d_trade_value_5 }
			}
			10 = {
				modifier = {
					factor = 0
					is_gestalt = yes
				}
				event_target:chosen_planet = { add_deposit = d_trade_value_7 }
			}
			10 = {
				modifier = {
					factor = 0
					is_gestalt = yes
				}
				event_target:chosen_planet = { add_deposit = d_trade_value_9 }
			}

			# Alloys
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { alloy_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_alloys_3 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { alloy_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_alloys_4 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { alloy_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_alloys_5 }
			}

			# Exotic Gas
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { exotic_gas_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_exotic_gases_1 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { exotic_gas_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_exotic_gases_2 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { exotic_gas_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_exotic_gases_3 }
			}

			# Rare Crystals
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { rare_crystal_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_rare_crystals_1 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { rare_crystal_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_rare_crystals_2 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { rare_crystal_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_rare_crystals_3 }
			}

			# Volatile Motes
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { volatile_motes_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_volatile_motes_1 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { volatile_motes_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_volatile_motes_2 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { volatile_motes_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_volatile_motes_3 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { zro_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_zro_deposit_1 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { zro_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_zro_deposit_2 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { dark_matter_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_dark_matter_deposit_1 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { dark_matter_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_dark_matter_deposit_2 }
			}
			10 = {
				modifier = {
					factor = 0
					event_target:chosen_planet = { living_metal_candidate = no }
				}
				event_target:chosen_planet = { add_deposit = d_living_metal_deposit }
			}
		}
	}
}