namespace = FEMawakening

country_event = {
	id = FEMawakening.1
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_ai_personality = fallen_empire_xenophobe_genocidal
		FROM = {
			any_defender = {
				is_same_value = ROOT
			}
		}
	}
	
	immediate = {
		set_global_flag = sleepers_awake_happened
		country_event = { id = fallen_empires_awakening.3 }
		every_country = {
			limit = {
				any_war = {
					is_same_value = FROM
					any_defender = {
						is_same_value = ROOT
					}
				}
			}
			country_event = { id = FEMawakening.2 }
		}
		every_country = {
			limit = {
				is_ai = no
				NOT = {
					any_war = {
						is_same_value = FROM
						any_defender = {
							is_same_value = ROOT
						}
					}
				}
			}
			country_event = { id = fallen_empires_awakening.2 }
		}
		if = {
			limit = { host_has_dlc = "Leviathans Story Pack" }
			random_list = {
				40 = { # War in Heaven with Fallen Empire of opposing ethos
					random_country = {
						limit = {
							NOT = { is_same_value = root }
							is_country_type = fallen_empire
							NOT = { has_ethic = ethic_gestalt_consciousness }
							OR = {
								AND = {
									has_ethic = ethic_fanatic_xenophobe
									root = { has_ethic = ethic_fanatic_xenophile }
								}
								AND = {
									has_ethic = ethic_fanatic_xenophile
									root = { has_ethic = ethic_fanatic_xenophobe }
								}
								AND = {
									has_ethic = ethic_fanatic_spiritualist
									root = { has_ethic = ethic_fanatic_materialist }
								}
								AND = {
									has_ethic = ethic_fanatic_materialist
									root = { has_ethic = ethic_fanatic_spiritualist }
								}
							}
						}
						set_country_flag = sleepers_awake_ancient_rival
						set_timed_country_flag = { flag = timed_ancient_rival days = 3650 }
						set_timed_country_flag = { flag = ai_no_wars days = 3650 }
						root = { set_timed_country_flag = { flag = ai_no_wars days = 3650 } }
						every_country = {
							limit = { is_country_type = default }
							set_timed_country_flag = { flag = ai_no_wars days = 3650 }
						}	
					}
				}
				20 = { # War in Heaven with Fallen Empire of different ethos
					random_country = {
						limit = {
							NOT = { is_same_value = root }
							is_country_type = fallen_empire
							NOT = { has_ethic = ethic_gestalt_consciousness }
						}
						set_country_flag = sleepers_awake_ancient_rival
						set_timed_country_flag = { flag = timed_ancient_rival days = 3650 }
						set_timed_country_flag = { flag = ai_no_wars days = 3650 }
						root = { set_timed_country_flag = { flag = ai_no_wars days = 3650 } }
						every_country = {
							limit = {
								is_country_type = default
							}
							set_timed_country_flag = { flag = ai_no_wars days = 3650 }
						}						
					}
				}
				40 = { } # No War in Heaven
			}
		}
	}
}

country_event = {
	id = FEMawakening.2
	title = FEMawakening.2.name
	desc = {
		text = FEMawakening.2.desc.a
		trigger = {
			FROM = {
				OR = {
					has_ai_personality = fallen_empire_xenophobe_genocidal
					has_ai_personality = awakened_fallen_empire_xenophobe_genocidal
				}
			}
		}
	}
	desc = {
		text = FEMawakening.2.desc.b
		trigger = {
			FROM = {
				OR = {
					has_ai_personality = fallen_empire_gamers
					has_ai_personality = experienced_awakened_fallen_empire_gamers
				}
			}
		}
	}
	
	is_triggered_only = yes
	
	diplomatic = yes
	picture_event_data = {
		portrait = FROM
		planet_background = FROM
		graphical_culture = FROM
		city_level = FROM
		room = FROM.ruler
	}
	
	option = {
		name = FEMawakening.2.a
	}
}

country_event = { #gamers awakening
	id = FEMawakening.10
	
	hide_window = yes
	
	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.5
			any_country = {
				is_country_type = default
				fleet_power > 300000
			}
		}
		modifier = {
			factor = 0.75
			any_country = {
				OR = {
					is_country_type = swarm
					is_country_type = extradimensional
					is_country_type = extradimensional_2
					is_country_type = extradimensional_3
					is_country_type = ai_empire
				}
				any_system_within_border = {
					OR = {
						any_neighbor_system = {
							has_hyperlane_to = ROOT
						}
						any_neighbor_system = {
							any_neighbor_system = {
								has_hyperlane_to = ROOT
							}
						}
						any_neighbor_system = {
							any_neighbor_system = {
								any_neighbor_system = {
									has_hyperlane_to = ROOT
								}
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.75
			any_country = {
				OR = {
					is_country_type = swarm
					is_country_type = extradimensional
					is_country_type = extradimensional_2
					is_country_type = extradimensional_3
					is_country_type = ai_empire
				}
				any_system_within_border = {
					OR = {
						any_neighbor_system = {
							has_hyperlane_to = ROOT
						}
						any_neighbor_system = {
							any_neighbor_system = {
								has_hyperlane_to = ROOT
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.75
			any_country = {
				OR = {
					is_country_type = swarm
					is_country_type = extradimensional
					is_country_type = extradimensional_2
					is_country_type = extradimensional_3
					is_country_type = ai_empire
				}
				any_system_within_border = {
					any_neighbor_system = {
						has_hyperlane_to = ROOT
					}
				}
			}
		}
		modifier = {
			factor = 0.1
			any_country = {
				OR = {
					is_country_type = swarm
					is_country_type = extradimensional
					is_country_type = extradimensional_2
					is_country_type = extradimensional_3
					is_country_type = ai_empire
				}
				any_system_within_border = {
					has_hyperlane_to = ROOT
				}
			}
		}
	}
	
	trigger = {
		NOT = { has_global_flag = sleepers_awake_happened }
		NOT = { has_global_flag = guardians_of_the_galaxy_happened }			
		end_game_years_passed >= 0
		has_ai_personality = fallen_empire_gamers
		is_at_war = no
		fleet_power > 40000
		OR = {
			any_country = {
				is_country_type = default
				fleet_power > 200000
			}
			any_country = {
				OR = {
					is_country_type = swarm
					is_country_type = extradimensional
					is_country_type = extradimensional_2
					is_country_type = extradimensional_3
					is_country_type = ai_empire
				}
				any_system_within_border = {
					OR = { #must be within 10 systems
						any_neighbor_system = {
							any_neighbor_system = {
								any_neighbor_system = {
									any_neighbor_system = {
										any_neighbor_system = {
											any_neighbor_system = {
												any_neighbor_system = {
													any_neighbor_system = {
														any_neighbor_system = {
															any_neighbor_system = {
																has_hyperlane_to = ROOT
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
						any_neighbor_system = {
							any_neighbor_system = {
								any_neighbor_system = {
									any_neighbor_system = {
										any_neighbor_system = {
											any_neighbor_system = {
												any_neighbor_system = {
													any_neighbor_system = {
														any_neighbor_system = {
															has_hyperlane_to = ROOT
														}
													}
												}
											}
										}
									}
								}
							}
						}
						any_neighbor_system = {
							any_neighbor_system = {
								any_neighbor_system = {
									any_neighbor_system = {
										any_neighbor_system = {
											any_neighbor_system = {
												any_neighbor_system = {
													any_neighbor_system = {
														has_hyperlane_to = ROOT
													}
												}
											}
										}
									}
								}
							}
						}
						any_neighbor_system = {
							any_neighbor_system = {
								any_neighbor_system = {
									any_neighbor_system = {
										any_neighbor_system = {
											any_neighbor_system = {
												any_neighbor_system = {
													has_hyperlane_to = ROOT
												}
											}
										}
									}
								}
							}
						}
						any_neighbor_system = {
							any_neighbor_system = {
								any_neighbor_system = {
									any_neighbor_system = {
										any_neighbor_system = {
											any_neighbor_system = {
												has_hyperlane_to = ROOT
											}
										}
									}
								}
							}
						}
						any_neighbor_system = {
							any_neighbor_system = {
								any_neighbor_system = {
									any_neighbor_system = {
										any_neighbor_system = {
											has_hyperlane_to = ROOT
										}
									}
								}
							}
						}
						any_neighbor_system = {
							any_neighbor_system = {
								any_neighbor_system = {
									any_neighbor_system = {
										has_hyperlane_to = ROOT
									}
								}
							}
						}
						any_neighbor_system = {
							any_neighbor_system = {
								any_neighbor_system = {
									has_hyperlane_to = ROOT
								}
							}
						}
						any_neighbor_system = {
							any_neighbor_system = {
								has_hyperlane_to = ROOT
							}
						}
						any_neighbor_system = {
							has_hyperlane_to = ROOT
						}
					}
				}
			}
		}
	}
	
	immediate = {
		set_global_flag = sleepers_awake_happened
		set_country_flag = sleepers_awake_first_sleeper
		set_country_type = awakened_fallen_empire
		add_resource = { minerals = 50000 }
		add_resource = { energy = 50000 }
		add_resource = { food = 5000 }
		add_resource = { influence = 1000 }
		country_event = { id = fallen_empires.13 }
		remove_modifier = gamers_fallen_modifier
		every_country = {
			limit = {
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
				NOT = { has_communications = root }
			}
			
			establish_communications_no_message = root
			root = { save_event_target_as = contact_empire }
			country_event = { id = action.1 }
		}
		random_list = {
			50 = {
				modifier = {
					factor = 10
					AND = {
						NOT = { #no crisis within 5 systems
							any_country = {
								OR = {
									is_country_type = swarm
									is_country_type = extradimensional
									is_country_type = extradimensional_2
									is_country_type = extradimensional_3
									is_country_type = ai_empire
								}
							}
							any_system_within_border = {
								OR = {
									any_neighbor_system = {
										any_neighbor_system = {
											any_neighbor_system = {
												any_neighbor_system = {
													any_neighbor_system = {
														has_hyperlane_to = ROOT
													}
												}
											}
										}
									}
									any_neighbor_system = {
										any_neighbor_system = {
											any_neighbor_system = {
												any_neighbor_system = {
													has_hyperlane_to = ROOT
												}
											}
										}
									}
									any_neighbor_system = {
										any_neighbor_system = {
											any_neighbor_system = {
												has_hyperlane_to = ROOT
											}
										}
									}
									any_neighbor_system = {
										any_neighbor_system = {
											has_hyperlane_to = ROOT
										}
									}
									any_neighbor_system = {
										has_hyperlane_to = ROOT
									}
								}
							}
						}
					}
				}
				modifier = {
					factor = 0
					any_country = {
						OR = {
							is_country_type = swarm
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
							is_country_type = ai_empire
						}
						any_system_within_border = {
							has_hyperlane_to = ROOT
						}
					}
				}
				change_government = {
					civics = {
						civic = civic_revanchist_fervor
						civic = civic_ancient_caches_of_technology
						civic = civic_lethargic_gamers
					}
				}
			}
			50 = {
				modifier = {
					factor = 1.25
					any_country = {
						OR = {
							is_country_type = swarm
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
							is_country_type = ai_empire
						}
						galaxy_percentage > 0.2
					}
				}
				modifier = {
					factor = 1.25
					any_country = {
						OR = {
							is_country_type = swarm
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
							is_country_type = ai_empire
						}
						galaxy_percentage > 0.3
					}
				}
				modifier = {
					factor = 1.25
					any_country = {
						OR = {
							is_country_type = swarm
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
							is_country_type = ai_empire
						}
						galaxy_percentage > 0.4
					}
				}
				change_government = {
					civics = {
						civic = civic_revanchist_fervor
						civic = civic_ancient_caches_of_technology
						civic = civic_experienced_gamers
					}
				}
			}
		}
	}
}

country_event = {
	id = FEMawakening.11
	hide_window = yes
	
	trigger = {
		has_ai_personality = fallen_empire_gamers
		any_country = {
			NOT = { has_ai_personality = fallen_empire_gamers }
			any_owned_planet = {
				has_planet_flag = gamer_world
			}
		}
	}
	
	immediate = {
		set_global_flag = sleepers_awake_happened
		set_country_flag = sleepers_awake_first_sleeper
		set_country_type = awakened_fallen_empire
		add_resource = { minerals = 50000 }
		add_resource = { energy = 50000 }
		add_resource = { food = 5000 }
		add_resource = { influence = 1000 }
		country_event = { id = fallen_empires.13 }
		remove_modifier = gamers_fallen_modifier
		change_government = {
			civics = {
				civic = civic_revanchist_fervor
				civic = civic_ancient_caches_of_technology
				civic = civic_experienced_gamers
			}
		}
		every_country = {
			limit = { any_owned_planet = { has_planet_flag = gamer_world } }
			country_event = { id = FEMawakening.2 }
		}
		every_country = {
			limit = {
				is_ai = no
				NOT = { any_owned_planet = { has_planet_flag = gamer_world } }
			}
			country_event = { id = fallen_empires_awakening.2 }
		}
		every_country = {
			limit = {
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
				NOT = { has_communications = root }
			}
			
			establish_communications_no_message = root
			root = { save_event_target_as = contact_empire }
			country_event = { id = action.1 }
		}
	}
}