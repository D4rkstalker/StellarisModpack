namespace = covenant_events
@extension_time = 720

country_event = {#Bound soul also causes some psychics, like latent psionic
    id=covenant_events.1
    is_triggered_only = yes
    hide_window=yes

    trigger = {
        from = {
            species = {
                OR = {
                    has_trait = trait_bound_soul
                    has_trait = trait_severed_bond
                }
            }
        }
    }

    immediate = {
		from = {
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_admiral_psionic
				add_ruler_trait = leader_trait_ruler_psionic
				break = yes
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_general_psionic
				add_ruler_trait = leader_trait_ruler_psionic
				break = yes
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_governor_psionic
				add_ruler_trait = leader_trait_ruler_psionic
				break = yes
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_scientist_psionic
				add_ruler_trait = leader_trait_ruler_psionic
				break = yes
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_ruler_psionic
				add_ruler_trait = leader_trait_ruler_psionic
				break = yes
			}
		}
	}
}

planet_event = {
    id=covenant_events.2
    is_triggered_only = yes
    hide_window=yes

    trigger = {
        owner = {
			OR = {
				has_modifier = covenant_end_of_the_cycle
				AND = {
					is_subject = yes
					overlord = { has_modifier = covenant_end_of_the_cycle }
				}				
			}	
		}
		NOT = { has_modifier = covenant_shroud_marked }
    }

    immediate = {
        add_modifier = { modifier = covenant_shroud_marked days = -1 }
    }
}

country_event = {
	id=covenant_events.3
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		if = {
			limit = {
				check_variable = {
					which = sacrifices
					value >0
				}
			}
			subtract_variable = {
				which = sacrifices
				value = 1
			}
			add_event_chain_counter = {
				event_chain = "cycle_sacrifices_chain"
				counter = sacrifices_consumed
				amount = 1
			}
			if ={
				limit = {
					OR = {
						check_variable = {
							which = sacrifices
							value <1
						}
						NOT = {has_country_flag = borrowed_time}
					}
				}
				country_event = {id = covenant_events.4}
			}
			add_modifier = {
				modifier = covenant_end_of_the_cycle
				days = @extension_time
			}
			country_event = {id = covenant_events.3 days = @extension_time}
		}
		else = {
			end_event_chain = "cycle_sacrifices_chain"
			country_event = {id = utopia.3320}
		}
	}
}

country_event = {
	id = covenant_events.4
	is_triggered_only = yes
	title = "covenant_events.4.name"
	picture = GFX_evt_unspeakable_horror

	desc = {
		text = "covenant_events.4.desc.a"
		trigger = {
			NOT = {has_country_flag = borrowed_time}
			check_variable = {
				which = sacrifices
				value >0
			}
		}
	}
	desc = {
		text = "covenant_events.4.desc.b"
		trigger = {
			NOT = {has_country_flag = borrowed_time}
			check_variable = {
				which = sacrifices
				value <1
			}
		}
	}

	desc = {
		text = "covenant_events.4.desc.c"
		trigger = {
			has_country_flag = borrowed_time
			check_variable = {
				which = sacrifices
				value <1
			}
		}
	}

	option = {
		name = "covenant_events.4.opt.a"
		hidden_effect = {
			if = {
				limit = {NOT = {has_country_flag = borrowed_time}}
				set_country_flag = borrowed_time
			}
		}
	}
}