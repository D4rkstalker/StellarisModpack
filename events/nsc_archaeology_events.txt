namespace = nsc_archaeology_events

#########################
### DESERTS OF KHARAK ###
#########################

### DISCOVERY SCAN CHANCE ###
planet_event = {
	id = nsc_archaeology_events.100
	hide_window = yes
	is_triggered_only = yes
	
	pre_triggers = {
		has_owner = no
	}

	trigger = {
		NOR = {
			has_global_flag = deserts_of_kharak
			exists = archaeological_site
		}
		is_planet_class = pc_desert
		fromfrom.owner = { is_ai = no }
	}
	
	immediate = {
		random = {
			chance = 5
			fromfrom = {
				fleet_event = {
					id = nsc_archaeology_events.101
					scopes = {
						from = fromfrom.owner
						fromfrom = root
					}
				}
			}
		}
	}
}

### DISCOVERY ###
fleet_event = {
	id = nsc_archaeology_events.101
	title = "nsc_archaeology_events.101.title"
	desc = "nsc_archaeology_events.101.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_scanner
	is_triggered_only = yes
	location = fromfrom

	immediate = {
		set_global_flag = deserts_of_kharak
		fromfrom = { prevent_anomaly = yes }
	}

	option = {
		name = "nsc_archaeology_events.101.a"
		fromfrom = {
			create_archaeological_site = nsc_deserts_of_kharak
			set_name = "NAME_kharak"
		}
		hidden_effect = { from = { set_timed_country_flag = { flag = discovered_site days = 1800 } } }
	}
}

# Stage 1
fleet_event = {
	id = nsc_archaeology_events.1001
	title = "nsc_archaeology_events.1001.title"
	desc = "nsc_archaeology_events.1001.desc"
	picture = GFX_evt_primary_anomaly
	show_sound = event_sensor_ping
	is_triggered_only = yes
	archaeology = yes
	location = from

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}
	
	option = {
		name = "nsc_archaeology_events.1001.a"
		small_artifact_reward = yes
	}
}

# Stage 2
fleet_event = {
	id = nsc_archaeology_events.1002
	title = "nsc_archaeology_events.1002.title"
	desc = "nsc_archaeology_events.1002.desc"
	picture = GFX_evt_desert_planet
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	location = from

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no } 
	}

	option = {
		name = "nsc_archaeology_events.1002.a"
		small_artifact_reward = yes
	}
}

# Stage 3
fleet_event = {
	id = nsc_archaeology_events.1003
	title = "nsc_archaeology_events.1003.title"
	desc = "nsc_archaeology_events.1003.desc"
	picture = GFX_evt_relic_shipyard
	show_sound = event_metal_fatigue
	is_triggered_only = yes
	archaeology = yes
	location = from
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "nsc_archaeology_events.1003.a"
		medium_artifact_reward = yes
	}
}

# Stage 4
fleet_event = {
	id = nsc_archaeology_events.1004
	title = "nsc_archaeology_events.1004.title"
	desc = "nsc_archaeology_events.1004.desc"
	picture = GFX_evt_tombs_of_the_ancients
	show_sound = event_finding_loot
	is_triggered_only = yes
	archaeology = yes
	location = from
	
	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "nsc_archaeology_events.1004.a"
		medium_artifact_reward = yes
	}
}

# Stage 5 (Final)
fleet_event = {
	id = nsc_archaeology_events.1005
	title = "nsc_archaeology_events.1005.title"
	desc = "nsc_archaeology_events.1005.desc"
	picture = GFX_evt_khar_toba
	show_sound = event_energy_field
	is_triggered_only = yes
	archaeology = yes
	location = from

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = { 
		from = { set_site_progress_locked = no }
	}

	option = {
		name = "nsc_archaeology_events.1005.a"
		large_artifact_reward = yes
		owner = { add_relic = r_nsc_hyperspace_core }
	}
}
