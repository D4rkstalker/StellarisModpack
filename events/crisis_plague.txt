namespace = complexplague



## set ground zero for the collectors
planet_event = {
    id = complexplague.0
	hide_window = yes
	is_triggered_only = yes


	immediate = {
	#set_global_flag = plague_happened ## this is douplicate but we use for debugging
	## infect all the pops?
		every_owned_pop = {
				limit = {
						AND = {
							is_sapient = yes
							is_robot_pop = no
						}
				}
				add_modifier = {
					modifier = "pop_plague_1"
					days = -1
				}
			}
	## infect nearby planet empires
	while = {
	count = 3
	closest_system = {
					limit = {
					has_owner = yes
					owner = { 
					is_country_type = default 
					NOT = { has_country_flag = ground_one }
					}
					
				}
					max_steps = 20
					owner = {
					set_country_flag = ground_one
					force_infect_random_owned_planet = yes
					force_infect_random_owned_planet = yes
					force_infect_random_owned_planet = yes
					force_infect_random_owned_planet = yes
					force_infect_random_owned_planet = yes
					force_infect_random_owned_planet = yes
					
					}
				}
	}
	## call everybody for help
	
	every_playable_country = {
	capital_scope = {
			enable_special_project = {
				name = "PLAGUE_CURE_PROJECT"
				location = this
				owner = prev.owner
			}
		}
		establish_communications_no_message = event_target:target_collectors
		country_event = { id = collectors.401 }
	}
	
	
	
	
    }
}

## cycle each country and spread disease 1
event = {
    id = complexplague.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {		
		has_global_flag = plague_started
		NOT = { has_global_flag = plague_ended }
		}
		
	immediate = {
		every_playable_country = {
		limit = {NOT = { has_country_flag = plague_contained }}
			if = {
					limit = {
						any_owned_planet = {
							AND = {
							is_plagued = yes
							NOT = { has_modifier = planet_under_quarentine }
							}
						}
					}
			inner_planets_spread_disease = yes ## inner spread
			spread_disease = yes ## neighbour spread
			
				}
			}	
			
			## heal each year, just in case.. my guess is that this will lag every year, but until i test the cure some more ill be using this fix			
			every_playable_country = {
			limit = {NOT = { has_country_flag = plague_cured }}
			
			if = { limit = { any_owned_pop = { is_infected = yes } } 
			
			every_owned_pop = {
				limit = { is_infected = yes	}
				remove_modifier = "pop_plague_1"
				remove_modifier = "pop_plague_2"
				remove_modifier = "pop_plague_3"
				remove_modifier = "pop_plague_4"
				remove_modifier = "pop_plague_5"
			}
			}
			
			}
			
			
			
    }
}

## cycle each country and increase disease phase
event = {
    id = complexplague.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {		
		has_global_flag = plague_started
		NOT = { has_global_flag = plague_ended }
		}
		
	immediate = {
	
		if = {limit = { any_playable_country = {NOT = { has_country_flag = plague_cured}}}}
		else = {set_global_flag = plague_ended}
			
			
		every_playable_country = {
		limit = {NOT = { has_country_flag = plague_contained }}
			if = {
					limit = {
						any_owned_planet = {
							is_plagued = yes
						}
					}
						every_owned_planet = {
						limit = {is_plagued = yes}
							increase_disease_phase = yes
						}
				}
			}	
    }
}


# A pop has been added to the planet, check for illness and if empire has cure
# Root = pop
# From = planet
pop_event = {
	id = complexplague.31
	hide_window = yes
	is_triggered_only = yes

	immediate = {					
	if = {
		limit = {
			NOT = {has_global_flag = plague_ended}
		}
		
		if = { limit = {is_infected = yes}
		
			if = { limit = { owner = { has_country_flag = plague_cured } }
				remove_modifier = "pop_plague_1"
				remove_modifier = "pop_plague_2"
				remove_modifier = "pop_plague_3"
				remove_modifier = "pop_plague_4"
				remove_modifier = "pop_plague_5"			
			
			

			}
		
		}
	}

	}
	}
	
## test, infect 1 subject
planet_event = {
    id = complexplague.102
	hide_window = yes
	is_triggered_only = yes


	immediate = {
	## infect all the pops
		infect_random_pop = yes

	
    }
}




## tell everybody we are at 50%
country_event = {
    id = complexplague.950
	title = complexplague.950.name
	location = event_target:latest_rift
	desc = {
		text = complexplague.950.desc
	}
	picture = GFX_evt_society_research
	show_sound = event_celebration

	is_triggered_only = yes

	##cool story bro
	option = {
		name = complexplague.950.a	
	}
	##do not disturb
	option = {
		name = complexplague.0.nodisturb
		set_country_flag = plague_no_disturb
		
	}
}

## tell everybody we are at 100% and they can buy the cure from the collectors
country_event = {
    id = complexplague.951
	title = complexplague.951.name
	location = event_target:latest_rift
	desc = {
		text = complexplague.951.desc
	}
	picture = GFX_evt_society_research
	show_sound = event_celebration

	is_triggered_only = yes

	##cool story bro
	option = {
		name = complexplague.951.a	
	}
	##do not disturb
	option = {
		name = complexplague.0.nodisturb
		set_country_flag = plague_no_disturb
		
	}
}

## tell everybody we are at 100%
country_event = {
    id = complexplague.952
	title = complexplague.952.name
	location = event_target:latest_rift
	desc = {
		text = complexplague.952.desc
	}
	picture = GFX_evt_society_research
	show_sound = event_celebration

	is_triggered_only = yes

	##cool story bro
	option = {
		name = complexplague.952.a	
	}
	##do not disturb
	option = {
		name = complexplague.0.nodisturb
		set_country_flag = plague_no_disturb
		
	}
	
	

}

## bought the cure
country_event = {
    id = complexplague.953
	title = complexplague.953.name
	location = event_target:latest_rift
	desc = {
		text = complexplague.953.desc
	}
	picture = GFX_evt_society_research
	show_sound = event_celebration

	is_triggered_only = yes

	##cool story bro
	option = {
		name = complexplague.953.a	
	}

}
 