namespace = complexplague



## set ground zero for the collectors
planet_event = {
    id = complexplague.0
	hide_window = yes
	is_triggered_only = yes


	immediate = {
	set_global_flag = plague_happened ## this is douplicate but we use for debugging
	## infect all the pops?
		every_owned_pop = {
				limit = {
						AND = {
							is_sapient = yes
							is_robot_pop = no
						}
				}
				add_modifier = {
					modifier = "pop_plague_1"
					days = -1
				}
			}
	## infect nearby planet empires
	while = {
	count = 2
	closest_system = {
					limit = {
					has_owner = yes
					owner = { 
					is_country_type = default 
					NOT = { has_country_flag = ground_one }
					}
					
				}
					max_steps = 20
					owner = {
					set_country_flag = ground_one
					force_infect_random_owned_planet = yes
					force_infect_random_owned_planet = yes
					force_infect_random_owned_planet = yes
					
					}
				}
	}
	## call everybody for help
	
	every_playable_country = {
	capital_scope = {
			enable_special_project = {
				name = "PLAGUE_CURE_PROJECT"
				location = this
				owner = prev.owner
			}
		}
		establish_communications_no_message = event_target:target_collectors
		country_event = { id = collectors.401 }
	}
	
	
	
	
    }
}

## cycle each country and spread disease
event = {
    id = complexplague.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {		
		has_global_flag = plague_happened
		NOT = { has_global_flag = plague_ended }
		}
		
	immediate = {
		every_playable_country = {
		limit = {NOT = { has_country_flag = plague_contained }}
			if = {
					limit = {
						any_owned_planet = {
							is_plagued = yes
						}
					}
			infect_random_owned_planet = yes ## inner spread
			country_event = { id = complexplague.103 } ## neighbour spread
				}
			}	
    }
}

## cycle each country and increase disease phase
event = {
    id = complexplague.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {		
		has_global_flag = plague_happened
		NOT = { has_global_flag = plague_ended }
		}
		
	immediate = {
		every_playable_country = {
		limit = {NOT = { has_country_flag = plague_contained }}
			if = {
					limit = {
						any_owned_planet = {
							is_plagued = yes
						}
					}
						every_owned_planet = {
						limit = {is_plagued = yes}
							spread_disease = yes
						}
				}
			}	
    }
}


## test, infect 1 subject
planet_event = {
    id = complexplague.102
	hide_window = yes
	is_triggered_only = yes


	immediate = {
	## infect all the pops
		random_pop = {
			limit = { 
			is_infected = no			
					}
			add_modifier = {
				modifier = "pop_plague_1"
				days = -1
			}
		}

	
    }
}
## spread the disease to my neighbours
country_event = {
    id = complexplague.103
	hide_window = yes
	is_triggered_only = yes


	immediate = {
					
			
	## infect a random planet of every neighbour
	random_neighbor_country = {
	limit = {NOT = { has_country_flag = plague_contained }}
	infect_random_owned_planet = yes
	}
	## of every research agreement
	every_playable_country = {
	limit = {
		has_research_agreement = root
		NOT = { has_country_flag = plague_contained }
		}
		infect_random_owned_planet = yes
	}
	## of every federation member
	every_playable_country = {
		limit = {
		is_in_federation_with = root
		NOT = { has_country_flag = plague_contained }
		}
		infect_random_owned_planet = yes
		infect_random_owned_planet = yes
	}
	## has_association_status
		every_playable_country = {
		limit = {
		has_association_status = root
		NOT = { has_country_flag = plague_contained }
		}
		infect_random_owned_planet = yes
	}
	## of every migration treaty	
	every_playable_country = {
		limit = {
		has_migration_access = root
		NOT = { has_country_flag = plague_contained }
		}
		infect_random_owned_planet = yes
		infect_random_owned_planet = yes
		infect_random_owned_planet = yes
	}
	
	
    }
}



## tell everybody we are at 50%
country_event = {
    id = complexplague.950
	title = complexplague.950.name
	location = event_target:latest_rift
	desc = {
		text = complexplague.950.desc
	}
	picture = GFX_evt_society_research
	show_sound = event_celebration

	is_triggered_only = yes

	##cool story bro
	option = {
		name = complexplague.950.a	
	}

}

## tell everybody we are at 100% and they can buy the cure from the collectors
country_event = {
    id = complexplague.951
	title = complexplague.951.name
	location = event_target:latest_rift
	desc = {
		text = complexplague.951.desc
	}
	picture = GFX_evt_society_research
	show_sound = event_celebration

	is_triggered_only = yes

	##cool story bro
	option = {
		name = complexplague.951.a	
	}

}

## tell everybody we are at 100%
country_event = {
    id = complexplague.952
	title = complexplague.952.name
	location = event_target:latest_rift
	desc = {
		text = complexplague.952.desc
	}
	picture = GFX_evt_society_research
	show_sound = event_celebration

	is_triggered_only = yes

	##cool story bro
	option = {
		name = complexplague.952.a	
	}

}

## bought the cure
country_event = {
    id = complexplague.953
	title = complexplague.953.name
	location = event_target:latest_rift
	desc = {
		text = complexplague.953.desc
	}
	picture = GFX_evt_society_research
	show_sound = event_celebration

	is_triggered_only = yes

	##cool story bro
	option = {
		name = complexplague.953.a	
	}

}
 