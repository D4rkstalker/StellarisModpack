namespace = femegasphile

event = {
	id = femegasphile.1
	hide_window = yes
	
	fire_only_once = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = femegasinit_happened_phile }
	}
	
	immediate = {
		random_country = {
			limit = { is_country_type = fallen_empire }
			country_event = { id = femegasphile.2 days = 1 }
		}
	}
}

country_event = {
	id = femegasphile.2
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = femegasinit_happened_phile }
	}
	
	immediate = {
		every_country = {
			limit = {
				is_country_type = fallen_empire
				has_ethic = ethic_fanatic_xenophile
			}
			random_list = {
				50 = {
					country_event = { id = femegasphile.10 }
				}
				50 = {
					modifier = {
						factor = 0
						NOT = { has_global_flag = gigastructures_enabled }
						NOT = { exists = event_target:FEE_homeworld_ethereal_bastion_capital_target }
					}
					modifier = { factor = 0 always = yes } #temp for virtual worlds
					country_event = { id = femegasphile.20 }
				}
			}
		}
		set_global_flag = femegasinit_happened_phile
	}
}

country_event = { #observers
	id = femegasphile.10
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = fallen_empire
		has_ethic = ethic_fanatic_xenophile
	}
	
	immediate = {
		capital_scope = {
			solar_system = {
				random_system_planet = {
					limit = { is_star = yes }
					solar_system = {
						random_list = {
							9 = {
								spawn_megastructure = {
									type = spy_orb_ruined
									coords_from = PREV
									owner = ROOT
								}
							}
							1 = {
								spawn_megastructure = {
									type = spy_orb_4
									coords_from = PREV
									owner = ROOT
								}
							}
						}
					}
				}
			}
		}
	}
}

country_event = { #preservers
	id = femegasphile.20
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = fallen_empire
		has_ethic = ethic_fanatic_xenophile
		has_global_flag = gigastructures_enabled
	}
	
	immediate = {
		random_owned_planet = { #Matrioshka Simulator
			limit = {
				has_planet_flag = fe_the_preserve
			}
			solar_system = {
				set_asteroid_belt = {
					radius = 0
				}
				every_system_planet = {
					limit = { is_star = no }
					remove_planet = yes
				}
				random_system_planet = {
					limit = { is_star = yes }
					solar_system = {
						spawn_megastructure = {
							type = matrioshka_brain_6
							coords_from = PREV
							owner = ROOT
						}
						random_system_planet = {
							limit = { is_colony = no is_planet_class = pc_virtual_world }
							set_name = "The Preserve I"
							add_building = building_fe_xeno_zoo
							while = {
								count = 2
								create_pop = {
									species = owner_main_species
								}
							}
							while = {
								count = 8
								create_species = {
									name = random
									class = random_non_machine
									portrait = random
									traits = random
								}
								create_pop = {
									species = last_created_species
								}
							}
							set_planet_flag = fe_the_preserve
							set_planet_flag = fallen_empire_world
							set_owner = ROOT
						}
						random_system_planet = {
							limit = { is_colony = no is_planet_class = pc_virtual_world }
							set_name = "The Preserve II"
							add_building = building_fe_xeno_zoo
							while = {
								count = 2
								create_pop = {
									species = owner_main_species
								}
							}
							while = {
								count = 20
								create_species = {
									name = random
									class = random_non_machine
									portrait = random
									traits = random
								}
								create_pop = {
									species = last_created_species
								}
							}
							set_planet_flag = fallen_empire_world
							set_owner = ROOT
						}
						random_system_planet = {
							limit = { is_colony = no is_planet_class = pc_virtual_world }
							set_name = "The Preserve III"
							add_building = building_fe_xeno_zoo
							while = {
								count = 2
								create_pop = {
									species = owner_main_species
								}
							}
							while = {
								count = 20
								create_species = {
									name = random
									class = random_non_machine
									portrait = random
									traits = random
								}
								create_pop = {
									species = last_created_species
								}
							}
							set_planet_flag = fallen_empire_world
							set_owner = ROOT
						}
						random_system_planet = {
							limit = { is_colony = no is_planet_class = pc_virtual_world }
							set_name = "The Preserve IV"
							add_building = building_fe_xeno_zoo
							while = {
								count = 2
								create_pop = {
									species = owner_main_species
								}
							}
							while = {
								count = 20
								create_species = {
									name = random
									class = random_non_machine
									portrait = random
									traits = random
								}
								create_pop = {
									species = last_created_species
								}
							}
							set_planet_flag = fallen_empire_world
							set_owner = ROOT
						}
						random_system_planet = {
							limit = { is_colony = no is_planet_class = pc_virtual_world }
							set_name = "The Preserve V"
							add_building = building_fe_xeno_zoo
							while = {
								count = 2
								create_pop = {
									species = owner_main_species
								}
							}
							while = {
								count = 20
								create_species = {
									name = random
									class = random_non_machine
									portrait = random
									traits = random
								}
								create_pop = {
									species = last_created_species
								}
							}
							set_planet_flag = fallen_empire_world
							set_owner = ROOT
						}
						random_system_planet = {
							limit = { is_colony = no is_planet_class = pc_virtual_world }
							set_name = "The Preserve VI"
							add_building = building_fe_xeno_zoo
							while = {
								count = 2
								create_pop = {
									species = owner_main_species
								}
							}
							while = {
								count = 20
								create_species = {
									name = random
									class = random_non_machine
									portrait = random
									traits = random
								}
								create_pop = {
									species = last_created_species
								}
							}
							set_planet_flag = fallen_empire_world
							set_owner = ROOT
						}
						random_system_planet = {
							limit = { is_colony = no is_planet_class = pc_virtual_world }
							set_name = "The Preserve VII"
							add_building = building_fe_xeno_zoo
							while = {
								count = 2
								create_pop = {
									species = owner_main_species
								}
							}
							while = {
								count = 20
								create_species = {
									name = random
									class = random_non_machine
									portrait = random
									traits = random
								}
								create_pop = {
									species = last_created_species
								}
							}
							set_planet_flag = fallen_empire_world
							set_owner = ROOT
						}
						random_system_planet = {
							limit = { is_colony = no is_planet_class = pc_virtual_world }
							set_name = "The Preserve VIII"
							add_building = building_fe_xeno_zoo
							while = {
								count = 2
								create_pop = {
									species = owner_main_species
								}
							}
							while = {
								count = 20
								create_species = {
									name = random
									class = random_non_machine
									portrait = random
									traits = random
								}
								create_pop = {
									species = last_created_species
								}
							}
							set_planet_flag = fallen_empire_world
							set_owner = ROOT
						}
					}
				}
			}
		}
		if = {
			limit = { has_megastructure = matrioshka_brain_6 }
			add_modifier = { modifier = fe_has_mega days = -1 }
		}
		
		capital_scope = { #Yggdrasil complex
			solar_system = {
				random_system_planet = {
					limit = { is_planet_class = pc_gas_giant }
					solar_system = {
						spawn_megastructure = {
							type = yggdrasil_orchid_3
							coords_from = PREV
							owner = ROOT
						}
					}
					change_pc = pc_food_giant
				}
			}
		}
	}
}