namespace = AAR_evt_torchlight
#	aar火炬领袖spawn*
#	灵舟延时debug*
#	aar火炬恶果循环fw触发




###_[aar火炬领袖spawn]		不能直接给pool_leader添加,与mui的reroll冲突,因为reroll使得pool_leader死亡,会触发守护星产生bug	---禁用
country_event = {
	id = AAR_evt_torchlight.11
	hide_window = yes
	is_triggered_only = yes
	trigger = { has_ascension_perk = AAR_AP_torchlight }
	
	immediate = {
		random_owned_leader = { limit = { FW_trgr_ldr_PROTECT_star_lite_IGNORE = no }	# |无法获得伪护星|非
			
			# 守护星DB
			change_variable = { which = AAR_var_ldr_died_time	 value = 1 }	# +1
			random_list = {
				2 = {}
				1 = {
					modifier = { factor = AAR_var_ldr_died_time						is_variable_set = AAR_var_ldr_died_time }	# 距离上次死亡时间越长,添加几率越高
					if = { limit = { is_variable_set = AAR_var_ldr_died_time }		clear_variable = AAR_var_ldr_died_time }
					add_trait = FW_trait_ldr_PROTECT_star_lite
				}
			}
		}
	}
}




###_[灵舟延时debug]		---禁用
#_eft	<流放与灵舟INIT>
fleet_event = {
	id = AAR_evt_torchlight.2
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		owner = {
			# 通知message
			if = { limit = { NOT = { has_country_flag = FW_flg_cntr_PROTECT_star_MSG } }
				set_timed_country_flag = { flag = FW_flg_cntr_PROTECT_star_MSG days = 30 }
				create_message = {
					type = FW_msg_PROTECT_star
					localization = FW_msg_PROTECT_star_DESC
					days = 30
					target = this
				}
			}
		}
		
		##	领袖回归DB		最多47个预留空位
		if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_1 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 1 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_2 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 2 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_3 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 3 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_4 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 4 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_5 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 5 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_6 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 6 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_7 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 7 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_8 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 8 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_9 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 9 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_10 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 10 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_11 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 11 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_12 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 12 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_13 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 13 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_14 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 14 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_15 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 15 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_16 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 16 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_17 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 17 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_18 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 18 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_19 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 19 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_20 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 20 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_21 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 21 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_22 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 22 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_23 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 23 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_24 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 24 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_25 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 25 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_26 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 26 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_27 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 27 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_28 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 28 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_29 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 29 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_30 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 30 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_31 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 31 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_32 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 32 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_33 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 33 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_34 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 34 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_35 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 35 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_36 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 36 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_37 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 37 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_38 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 38 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_39 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 39 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_10 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 10 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_41 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 41 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_42 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 42 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_43 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 43 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_44 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 44 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_45 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 45 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_46 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 46 }
		}
		else_if = { limit = { is_same_value =  event_target:AAR_GTGT_flt_torchlight_47 }
			AAR_prmt_eft_flt_TORCHLIGHT_db = { NUM = 47 }
		}
	}
}




###_[aar火炬恶果循环fw触发]
#_dec	<DEC火炬之光>
planet_event = {
	id = AAR_evt_torchlight.3
	hide_window = yes
	is_triggered_only = yes
	trigger = { has_planet_flag = AAR_flg_plnt_TORCHLIGHT_backfire_ONGOING }
	
	immediate = {
		##	继续循环
		if = {
			limit = {
				#	|PC|
				exists = owner
				owner = { is_ai = no }
				#	|火炬mod存在|
				OR = {
					has_modifier = AAR_PM_torchlight_PSONIC
					has_modifier = AAR_PM_torchlight_REGULAR
				}
			}
			set_global_flag = AAR_flg_glbl_MONTHLY_planet_db_READY	# |AAR月扫星准备|添加
			set_timed_planet_flag = { flag = AAR_flg_plnt_TORCHLIGHT_backfire_READY days = 31 }	# |AAR火炬之光恶果READY|	短期flg,仅触发下月[AAR火炬恶果FW]
			#	自循环
			planet_event = { id = AAR_evt_torchlight.3		days = 360 }
		}
		##	结束循环
		else = {
			remove_planet_flag = AAR_flg_plnt_TORCHLIGHT_backfire_ONGOING
		}
	}
}

