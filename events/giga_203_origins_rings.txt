namespace = giga_ring_origins

### Gatekeeper event
country_event = {
	id = giga_ring_origins.001
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			has_origin = origin_great_ring
			has_origin = origin_interstellar_ring
			has_origin = origin_penrose_ring
		}
	}

	immediate = {
		capital_scope = {
			# cleanup of stuff used to block New Frontiers subclasser
			solar_system = {
				remove_star_flag = sol_sector
				every_system_planet = {
					limit = {
						OR = {
							is_planet_class = pc_ringworld_habitable
							is_planet_class = pc_interstellar_ringworld_habitable
							is_planet_class = pc_giga_penrose_habitable
						}
					}
					set_ring = no
				}

				every_system_megastructure = {
					set_graphical_culture = root
				}
			}

			clear_deposits = yes
			remove_all_districts = yes

			# Set proper deposits
			add_deposit = d_giga_arcane_generator
			add_deposit = d_decrepit_tunnels_1
			add_deposit = d_decrepit_tunnels_2
			add_deposit = d_decrepit_tunnels_3
			add_deposit = d_great_ring_excavated_mountain
			# amenities 'deposit'
			add_deposit = d_ringworld_capital_city

			# special deposit blockers for DA/RS machines
			if = {
				limit = {
					root = {
						OR = {
							has_valid_civic = civic_machine_servitor
							has_valid_civic = civic_machine_assimilator
						}
					}
				}
				add_deposit = d_segment_rubble_1
				add_deposit = d_segment_rubble_1
				add_deposit = d_segment_rubble_2
				add_deposit = d_segment_rubble_2
			}

			### Behemoth ringworld
			if = {
				limit = { is_planet_class = pc_ringworld_habitable }

				# normal empires
				if = {
					limit = {
						ROOT = { is_gestalt = no }
					}
					# is biological
					if = {
						limit = { ROOT = { is_lithoid_empire = no } }
						add_district = district_rw_farming
					}
					# is lithoid
					else = {
						add_deposit = d_interstellar_ringworld_commerce_blocker
						add_district = district_rw_commercial
						add_deposit = d_great_ring_excavated_mountain
					}
				}
				# hiveminds
				if = {
					limit = {
						ROOT = { is_hive_empire = yes }
					}
					# is biological
					if = {
						limit = { ROOT = { is_lithoid_empire = no } }
						add_district = district_rw_farming
					}
					# is lithoid
					else = {
						add_district = district_rw_generator
						add_deposit = d_great_ring_excavated_mountain
					}
				}
				# machine empires
				else_if = {
					limit = { is_machine_empire = yes }
					# is normal machine empire
					if = {
						limit = {
							ROOT = {
								NOR = {
									has_valid_civic = civic_machine_assimilator
									has_valid_civic = civic_machine_servitor
								}
							}
						}
						add_district = district_rw_generator
					}
					else = {
						# rogue servitor / determined assimilator with biological pops
						if = {
							limit = {
								ROOT = { NOT = { any_owned_pop = { has_trait = trait_lithoid } } }
							}
							add_district = district_rw_nexus
							add_building = building_giga_interstellar_hydroponic_farm
							remove_deposit = d_segment_rubble_1
							remove_deposit = d_segment_rubble_1
							remove_deposit = d_segment_rubble_2
							remove_deposit = d_segment_rubble_2
						}
						# rogue servitor / determined assimilator with lithoid pops
						else = {
							add_district = district_rw_nexus
							add_deposit = d_great_ring_excavated_mountain
							remove_deposit = d_segment_rubble_2
							remove_deposit = d_segment_rubble_2
						}
					}
				}
			}
			### Interstellar ringworld
			else_if = {
				limit = { is_planet_class = pc_interstellar_ringworld_habitable }

				# normal empires
				if = {
					limit = { ROOT = { is_gestalt = no } }
					# is biological
					if = {
						limit = { ROOT = { is_lithoid_empire = no } }
						add_deposit = d_interstellar_ringworld_commerce_blocker
						add_district = district_interstellar_commercial
						add_building = building_giga_interstellar_hydroponic_farm
					}
					# is lithoid
					else = {
						add_deposit = d_interstellar_ringworld_commerce_blocker
						add_district = district_interstellar_commercial
						add_deposit = d_great_ring_excavated_mountain
					}
				}
				# hiveminds
				else_if = {
					limit = { ROOT = { is_hive_empire = yes } }
					# is biological
					if = {
						limit = { ROOT = { is_lithoid_empire = no } }
						add_district = district_interstellar_generator
						add_building = building_giga_interstellar_hydroponic_farm
					}
					# is lithoid
					else = {
						add_district = district_interstellar_generator
						add_deposit = d_great_ring_excavated_mountain
					}
				}
				# machine empires
				else_if = {
					limit = { ROOT = { is_machine_empire = yes } }
					# is normal machine empire
					if = {
						limit = {
							ROOT = {
								NOR = {
									has_valid_civic = civic_machine_assimilator
									has_valid_civic = civic_machine_servitor
								}
							}
						}
						add_district = district_interstellar_generator
					}
					else = {
						# rogue servitor / determined assimilator with biological pops
						if = {
							limit = {
								ROOT = { NOT = { any_owned_pop = { has_trait = trait_lithoid } } }
							}
							add_district = district_interstellar_generator
							add_building = building_giga_interstellar_hydroponic_farm
							remove_deposit = d_segment_rubble_1
							remove_deposit = d_segment_rubble_1
						}
						# rogue servitor / determined assimilator with lithoid pops
						else = {
							add_district = district_interstellar_generator
							add_deposit = d_great_ring_excavated_mountain
						}
					}
				}
			}
			### Penrose ringworld
			else_if = {
				limit = { is_planet_class = pc_giga_penrose_habitable }

				# normal empires
				if = {
					limit = {
						ROOT = { is_gestalt = no }
					}
					# is biological
					if = {
						limit = { ROOT = { is_lithoid_empire = no } }
						add_district = district_penrose_farming
					}
					# is lithoid
					else = {
						add_deposit = d_interstellar_ringworld_commerce_blocker
						add_district = district_penrose_commercial
						add_deposit = d_great_ring_excavated_mountain
					}
				}
				# hivemind empires
				if = {
					limit = {
						ROOT = { is_hive_empire = yes }
					}
					# is biological
					if = {
						limit = { ROOT = { is_lithoid_empire = no } }
						add_district = district_penrose_farming
					}
					# is lithoid
					else = {
						add_district = district_penrose_generator
						add_deposit = d_great_ring_excavated_mountain
					}
				}
				# machine empires
				else_if = {
					limit = { ROOT = { is_machine_empire = yes } }
					# is normal machine empire
					if = {
						limit = {
							ROOT = {
								NOR = {
									has_valid_civic = civic_machine_assimilator
									has_valid_civic = civic_machine_servitor
								}
							}
						}
						add_district = district_penrose_generator
					}
					else = {
						# rogue servitor / determined assimilator with biological pops
						if = {
							limit = {
								ROOT = { NOT = { any_owned_pop = { has_trait = trait_lithoid } } }
							}
							add_district = district_penrose_nexus
							add_building = building_giga_interstellar_hydroponic_farm
							remove_deposit = d_segment_rubble_1
							remove_deposit = d_segment_rubble_1
							remove_deposit = d_segment_rubble_2
							remove_deposit = d_segment_rubble_2
						}
						# rogue servitor / determined assimilator with lithoid pops
						else = {
							add_district = district_penrose_nexus
							add_deposit = d_great_ring_excavated_mountain
							remove_deposit = d_segment_rubble_2
							remove_deposit = d_segment_rubble_2
						}
					}
				}
			}

			# setup mining stations in the system
			solar_system = {
				every_system_planet = {
					if = {
						limit = { has_planet_flag = great_ring_mining_target }
						create_mining_station = { owner = root }
					}
					else_if = {
						limit = { has_planet_flag = great_ring_research_target }
						create_research_station = { owner = root }
					}
				}
			}
		}
	}
}

### On relic Penrose sphere restored
country_event = {
	id = giga_ring_origins.002
	title = "giga_ring_origins.002.name"
	desc = "giga_ring_origins.002.desc"
	picture = GFX_evt_black_hole
	show_sound = event_dyson_sphere_build_complete
	location = event_target:relic_penrose_sphere
	is_triggered_only = yes

	immediate = {
		set_country_flag = has_built_or_repaired_gigastructure
	}

	option = { name = EXCELLENT }
}
