namespace = rare_planets_regeneration

event = {
	id = rare_planets_regeneration.1
	hide_window = yes
	is_triggered_only = no
	fire_only_once = yes
	
	trigger = {
		NOR = {
			OR = {
				has_planet_flag = ratling_planet
				has_planet_flag = prescripted_ideal
				has_planet_flag = rare_planets_regeneration_2
				has_planet_flag = rare_planets_regeneration_3
			}
		}
	}
	
	immediate = {
		every_planet = {
			limit = {
				NOR = {
					is_asteroid = yes
					is_planet_class = pc_gas_giant
					is_planet_class = pc_ringworld_habitable
					is_planet_class = pc_ringworld_habitable_damaged
					is_planet_class = pc_ringworld_tech
					is_planet_class = pc_ringworld_tech_damaged
					is_planet_class = pc_ringworld_seam
					is_planet_class = pc_ringworld_seam_damaged
					is_planet_class = pc_habitat
					is_planet_class = pc_city
					is_planet_class = pc_relic
					is_star = yes
				}
			}	
			if = {
				limit = {
					is_capital = yes
					is_colony = yes
				}				
				set_planet_flag = rare_planets_regeneration_2
			}
			if = {
				limit = {
					NOR = {
						is_planet_class = pc_relic
						is_planet_class = pc_molten
						is_planet_class = pc_barren
						is_planet_class = pc_barren_cold
						is_planet_class = pc_broken
						is_planet_class = pc_toxic
						is_planet_class = pc_frozen
						is_planet_class = pc_ecocity
						is_planet_class = pc_bioforge
						is_planet_class = pc_machine_factory
						is_planet_class = pc_methane
						is_planet_class = pc_ammonia
						is_planet_class = pc_ash
						is_planet_class = pc_gghab
						is_planet_class = pc_tmhab
						is_planet_class = pc_tmhab2
						is_planet_class = pc_mmhab
						is_planet_class = pc_mmhab2
						is_planet_class = pc_bhab
						is_planet_class = pc_bchab
						is_planet_class = pc_mhab
						is_planet_class = pc_fhab
						is_planet_class = pc_primal
						is_planet_class = pc_karst
						is_planet_class = pc_irradiated
						is_planet_class = pc_superhabitable
						is_planet_class = pc_tidallylocked
						is_planet_class = pc_geothermal
						is_planet_class = pc_biolumen
						is_planet_class = pc_hothouse
						is_planet_class = pc_crystal
						is_planet_class = pc_floating
						is_planet_class = pc_graveyard
						is_planet_class = pc_technoorganic
						is_planet_class = pc_archive
						is_planet_class = pc_gaia
						is_planet_class = pc_egg_cracked
						is_planet_class = pc_ll_foggy
						is_planet_class = pc_gigaorbital_ring_ruined
						is_planet_class = pc_tropical_habitability
						is_planet_class = pc_gigaorbital_ring
						is_planet_class = pc_melted_frozen
						is_planet_class = pc_ll_temperate
						is_planet_class = pc_gigabrown_dwarf
						is_planet_class = pc_interstellar_habitat
						is_planet_class = pc_interstellar_ringworld_habitable
						is_planet_class = pc_ringworld_tech
						is_planet_class = pc_ringworld_habitable
						is_planet_class = pc_gigaorbital_ring
						is_planet_class = pc_habitable_gas_giant
						is_planet_class = pc_giga_planetary_computer
						is_planet_class = pc_archive
						is_planet_class = pc_flat_world
						is_planet_class = pc_squareworld_habitable
						is_planet_class = pc_food_giant
						has_planet_flag = ratling_planet
						has_planet_flag = prescripted_ideal
					}
					is_capital = no
					is_colony = no
					is_homeworld = no
				}
				random_list = {
					200 = {
						change_pc = pc_shattered 
						clear_planet_modifiers = yes 
						reroll_planet_modifiers = yes 
						add_anomaly = AST_MINING_CAT 
					}
					400 = { 
						change_pc = pc_broken 
						clear_planet_modifiers = yes 
						reroll_planet_modifiers = yes
						add_anomaly = AST_MINING_CAT 
					}
					1300 = { 
						change_pc = pc_molten 
						clear_planet_modifiers = yes 
						reroll_planet_modifiers = yes 
					}
					1300 = { 
						change_pc = pc_toxic 
						clear_planet_modifiers = yes 
						reroll_planet_modifiers = yes 
					}
					2400 = { 
						change_pc = pc_barren 
						clear_planet_modifiers = yes
						reroll_planet_modifiers = yes 
						add_anomaly = terraforming_candidate_category
					}
					2400 = { 
						change_pc = pc_barren_cold 
						clear_planet_modifiers = yes
						reroll_planet_modifiers = yes 
						add_anomaly = terraforming_candidate_category
					}
					2000 = { }
				}
				set_planet_flag = rare_planets_regeneration_3
			}
		}
	}
}

event = {
	id = rare_planets_regeneration.2
	hide_window = yes
	is_triggered_only = no
	fire_only_once = yes
	
	trigger = {
		NOR = {
			OR = {
				has_planet_flag = ratling_planet
				has_planet_flag = prescripted_ideal
			}
		}
	}
	
	immediate = {
		hidden_effect = {
			limit = {
				NOR = {
					is_asteroid = yes
					is_planet_class = pc_gas_giant
					is_planet_class = pc_ringworld_habitable
					is_planet_class = pc_ringworld_habitable_damaged
					is_planet_class = pc_ringworld_tech
					is_planet_class = pc_ringworld_tech_damaged
					is_planet_class = pc_ringworld_seam
					is_planet_class = pc_ringworld_seam_damaged
					is_planet_class = pc_habitat
					is_star = yes
				}
			}	
			if = {
				limit = {
					is_capital = yes
					is_colony = yes
				}				
				set_planet_flag = rare_planets_regeneration_2
			}
			if = {
				limit = {
					is_capital = no
					is_colony = no
					is_homeworld = no
				}
				random_list = {
					50 = { 
						change_pc = pc_barren 
						clear_planet_modifiers = yes
						reroll_planet_modifiers = yes 
						add_anomaly = terraforming_candidate_category
					}
					50 = { 
						change_pc = pc_barren_cold 
						clear_planet_modifiers = yes
						reroll_planet_modifiers = yes 
						add_anomaly = terraforming_candidate_category
					}
				}
				set_planet_flag = rare_planets_regeneration_3
			}
		}
	}
}

event = {
	id = rare_planets_regeneration.4
	hide_window = yes
	is_triggered_only = no
	fire_only_once = yes
	
	trigger = {
		NOR = {
			OR = {
				has_planet_flag = ratling_planet
				has_planet_flag = prescripted_ideal
				has_planet_flag = rare_planets_regeneration_1
			}
		}
	}
	
	immediate = {
		every_planet = {
			limit = {
				NOR = {
					is_asteroid = yes
					is_planet_class = pc_gas_giant
					is_planet_class = pc_ringworld_habitable
					is_planet_class = pc_ringworld_habitable_damaged
					is_planet_class = pc_ringworld_tech
					is_planet_class = pc_ringworld_tech_damaged
					is_planet_class = pc_ringworld_seam
					is_planet_class = pc_ringworld_seam_damaged
					is_planet_class = pc_habitat
					is_planet_class = pc_city
					is_planet_class = pc_relic
					is_star = yes
				}
			}
			random_list = {
				2 = {change_pc = pc_shattered}
				2 = {change_pc = pc_broken}
				13 = {change_pc = pc_molten}
				13 = {change_pc = pc_toxic}
				25 = {change_pc = pc_barren}
				25 = {change_pc = pc_barren_cold}
				20 = { }
			}
		}
	}
}
