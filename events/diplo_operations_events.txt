###########################################
#
# Diplo Espionage Events
#
###########################################

namespace = diplospy

@OperationBribeCost1 = -400
@OperationBribeCost2 = -600
@OperationBribeCost3 = -800
@OperationBribeThreshold1 = 400
@OperationBribeThreshold2 = 600
@OperationBribeThreshold3 = 800

@StealTechnologyAmount = 1000 #Amount of science research in every discipline which will be granted if the operation cannot steal a Technology
@StealTechnologyTimer = 2160 #days (6 years) until Steal Technology can be repeated. Referenced in tooltip strings "operation.1026.tooltip.cooldown" and "operation_steal_technology_too_recent".
@EncourageEthicsTimer = 7200 #days (20 years)
@SabotageStarbaseTimer = 1440 #days (4 years) until Sabotage Starbase can be repeated against this target.
@CrisisBeaconTimer = 1440 #days (4 years) until Crisis Beacon can be attempted again. Referenced in tooltip string "operation_crisis_beacon_too_recent".

# Number of days before a single event should (ideally) stand a chance of coming up again.
@RandomOperationEventTimer = 600
@RandomOperationEventTimerLong = 1000

@gather_info_infiltration_days = 3600

#############################
# Operation Random Events	#
# Reserved: 1 - 99			#
#############################

### GALPOL
# from = operation; fromfrom = target
country_event = {
    id = diplospy.1
    title = diplospy.1.name
	desc = {
		trigger = { is_active_resolution = resolution_custodian_galpol }
		text = diplospy.1.desc.a
	}
	desc = {
		trigger = { is_active_resolution = resolution_emperor_isd }
		text = diplospy.1.desc.b
	}
    picture = GFX_evt_operative_chase
    show_sound = event_spymaster
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        from = { set_espionage_operation_progress_locked = yes }
        set_timed_country_flag = {
            flag = recent_op_galpol
            days = @RandomOperationEventTimer
        }
    }

    after = {
        from = { set_espionage_operation_progress_locked = no }
    }

    option = { #Bribe
        name = diplospy.1.a
		allow = {
			resource_stockpile_compare = {
                resource = energy
                value > 600
            }
			FROM = {
				NOR = {
					has_espionage_category = op_cat_provocation
					has_espionage_category = op_cat_sabotage
				}
			}
		}
        add_resource = { energy = -600 }
        ai_chance = { factor = 3 }
    }
    option = { #Can't/won't afford bribe
        name = diplospy.1.b
        from.spynetwork = {
            add_modifier = {
                modifier = spynetwork_galpol_hunt
                days = 280
            }
        }
        ai_chance = {
            factor = 1
            modifier = {
                factor = 10
                resource_stockpile_compare = {
					resource = energy
					value <= 1000
				}
            }
        }
    }
    option = { #Expend asset
        name = diplospy.1.c
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_regular_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_bureaucrat }
                from.spynetwork = { has_espionage_asset = asset_bureaucrat }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_bureaucrat }
            }
            from = { destroy_espionage_asset = asset_bureaucrat }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_bureaucrat }
            }
            from.spynetwork = { destroy_espionage_asset = asset_bureaucrat }
        }
        ai_chance = {
            factor = 15
        }
    }
	option = { #Expend asset
        name = diplospy.1.d
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_hive_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_behavioral_regulator }
                from.spynetwork = { has_espionage_asset = asset_behavioral_regulator }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_behavioral_regulator }
            }
            from = { destroy_espionage_asset = asset_behavioral_regulator }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_behavioral_regulator }
            }
            from.spynetwork = { destroy_espionage_asset = asset_behavioral_regulator }
        }
        ai_chance = {
            factor = 15
        }
    }
	option = { #Expend asset
        name = diplospy.1.e
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_machine_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_command_relay }
                from.spynetwork = { has_espionage_asset = asset_command_relay }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_command_relay }
            }
            from = { destroy_espionage_asset = asset_command_relay }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_command_relay }
            }
            from.spynetwork = { destroy_espionage_asset = asset_command_relay }
        }
        ai_chance = {
            factor = 15
        }
    }
}

### Counter Espionage
# High Alert
country_event = {
    id = diplospy.2
    title = diplospy.2.name
	desc = diplospy.2.desc
    picture = GFX_evt_operative_chase
    show_sound = event_spymaster
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        from = { set_espionage_operation_progress_locked = yes }
        set_timed_country_flag = {
            flag = recent_op_counter_spy_alert
            days = @RandomOperationEventTimer
        }
    }

    after = {
        from = { set_espionage_operation_progress_locked = no }
    }

    option = { # Divert security
        name = diplospy.2.a
		custom_tooltip = diplospy.2.a.tooltip
		hidden_effect = {
			random_list = {
				1 = {
					country_event = {
						id = diplospy.102
						days = 15
						random = 90
						scopes = { from = fromfrom }
					}
				}
				5 = {
					# does nothing
					modifier = {
                        factor = 0.5
                        relative_encryption_decryption = {
							target = from.target
							value < 0.6
						}
                    }
					modifier = {
                        factor = 0.5
                        relative_encryption_decryption = {
							target = from.target
							value < 0.8
						}
                    }
					modifier = {
                        factor = 1.5
                        relative_encryption_decryption = {
							target = from.target
							value > 1.3
						}
                    }
					modifier = {
                        factor = 1.5
                        relative_encryption_decryption = {
							target = from.target
							value > 1.6
						}
                    }
				}
			}
		}
        ai_chance = { factor = 2 }
    }
    option = { # Do nothing
        name = diplospy.2.b
		from = {
			add_modifier = { modifier = spynetwork_counter_spy_suspicious days = 280 }
		}
        ai_chance = {
            factor = 5
        }
    }
    option = { #Expend asset
        name = diplospy.2.c
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_regular_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_hacker }
                from.spynetwork = { has_espionage_asset = asset_hacker }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_hacker }
            }
            from = { destroy_espionage_asset = asset_hacker }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_hacker }
            }
            from.spynetwork = { destroy_espionage_asset = asset_hacker }
        }
        ai_chance = {
            factor = 15
        }
    }
	option = { #Expend asset
        name = diplospy.2.c
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_hive_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_ephapse_relay }
                from.spynetwork = { has_espionage_asset = asset_ephapse_relay }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_ephapse_relay }
            }
            from = { destroy_espionage_asset = asset_ephapse_relay }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_ephapse_relay }
            }
            from.spynetwork = { destroy_espionage_asset = asset_ephapse_relay }
        }
        ai_chance = {
            factor = 15
        }
    }
	option = { #Expend asset
        name = diplospy.2.c
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_machine_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_engagement_protocol }
                from.spynetwork = { has_espionage_asset = asset_engagement_protocol }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_engagement_protocol }
            }
            from = { destroy_espionage_asset = asset_engagement_protocol }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_engagement_protocol }
            }
            from.spynetwork = { destroy_espionage_asset = asset_engagement_protocol }
        }
        ai_chance = {
            factor = 15
        }
    }
}

# Security Leak
country_event = {
    id = diplospy.3
    title = diplospy.3.name
	desc = diplospy.3.desc
    picture = GFX_evt_spymaster
    show_sound = event_spymaster
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        from = { set_espionage_operation_progress_locked = yes }
        set_timed_country_flag = {
            flag = recent_op_counter_spy_security
            days = @RandomOperationEventTimer
        }
    }

    after = {
        from = { set_espionage_operation_progress_locked = no }
    }

    option = { # Set a trap
        name = diplospy.3.a
		ai_chance = { factor = 2 }
		add_modifier = { modifier = spynetwork_counter_spy_leak days = 280 }
		from = { add_modifier = { modifier = spynetwork_counter_spy_leak_good days = 280 } }
    }
    option = { # Fix the leak
        name = diplospy.3.b
		from = { add_modifier = { modifier = spynetwork_counter_spy_leak_fixed days = 280 } }
        ai_chance = {
            factor = 4
        }
    }
}

### Starbase Security Officers
# from = operation; fromfrom = target
country_event = {
    id = diplospy.4
    title = diplospy.4.name
	desc = {
		trigger = { is_active_resolution = resolution_custodian_galpol }
		text = diplospy.4.desc.a
	}
	desc = {
		trigger = { is_active_resolution = resolution_emperor_isd }
		text = diplospy.4.desc.b
	}
	desc = {
		trigger = {
			NOR = {
				is_active_resolution = resolution_custodian_galpol
				is_active_resolution = resolution_emperor_isd
			}
		}
		text = diplospy.4.desc.c
	}
    picture = GFX_evt_space_station
    show_sound = event_radio_chatter
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        from = { set_espionage_operation_progress_locked = yes }
        set_timed_country_flag = {
            flag = recent_op_galpol
            days = @RandomOperationEventTimer
        }
    }

    option = { #Stay out of the way
        name = diplospy.4.a
		custom_tooltip = operation.5000.a.tooltip
		allow = {
            from.spynetwork = { has_available_spy_power >= 10 }
        }
        from.spynetwork = {
            add_spy_network_level = -10 #Returned in subsequent events, or when the Spy Network disbands - whichever comes first
        }
        hidden_effect = {
            random_list = {
                8 = { #Re-establish contact
                    country_event = { id = diplospy.5 days = 34 } #"Contact Re-Established"
                }
                2 = { #Contact lost
                    modifier = {
                        factor = 2
                        from = {
                            OR = {
                                has_espionage_category = op_cat_sabotage
                                has_espionage_category = op_cat_provocation
                            }
                        }
                    }
                    modifier = {
                        factor = 4
                        from.target = {
                            relative_encryption_decryption = { target = root value > 1.2 }
                        }
                    }
					modifier = {
                        factor = 0.75
                        from.target = {
                            relative_encryption_decryption = { target = root value < 0.75 }
                        }
                    }
                    country_event = { id = diplospy.6 days = 34 } #"Contact Confirmed Lost"
                    from.target = {
                        if = {
                            limit = {
                                any_spynetwork = {
                                    owner = { is_same_value = prev }
                                    target = { is_same_value = root }
                                }
                            }
                            set_timed_country_flag = {
                                flag = espionage_caught_saboteurs
                                days = 20
                            }
                            country_event = { id = espionage.1040 days = 15 } #A Surprise Catch
                        }
                    }
                }
            }
        }
        ai_chance = {
            factor = 2
            modifier = {
                factor = 10
                from.spynetwork = { has_available_spy_power > 40 }
            }
        }
	}
	option = {
        name = DISAVOW
        custom_tooltip = operation.5000.b.tooltip
        hidden_effect = {
            root = {
                set_timed_country_flag = {
                    flag = has_disavowed_operative
                    days = 36000 #100 years
                }
                set_country_flag = burn_notice_achievement
            }
            from = {
                set_espionage_operation_progress_locked = no
                destroy_espionage_operation = this
            }
        }
        ai_chance = {
            factor = 1
            modifier = {
                factor = 20
                from.target = {
                    relative_encryption_decryption = {
                        target = root
                        value < 1.0
                    }
                }
            }
        }
    }
    option = { #Expend asset
        name = diplospy.4.b
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
        trigger = {
            from = {
                OR = {
					has_espionage_asset = asset_clerk
					has_espionage_asset = asset_laborer
					has_espionage_asset = asset_criminal_underling
					has_espionage_asset = asset_labor_drone
					has_espionage_asset = asset_synapse_drone
					has_espionage_asset = asset_pheromone_emitter
					has_espionage_asset = asset_logistics_system
					has_espionage_asset = asset_command_relay
					has_espionage_asset = asset_dispatch_uplink
				}
            }
        }
		from = {
            locked_random_list = {
				1 = {
                    modifier = {
                        factor = 0
                        NOT = { has_espionage_asset = asset_clerk }
                    }
					modifier = {
                        factor = 10
                        OR = {
                            has_espionage_category = op_cat_subterfuge
                            has_espionage_category = op_cat_diplomacy
                        }
                    }
                    destroy_espionage_asset = asset_clerk
                }
				1 = {
                    modifier = {
                        factor = 0
                        NOT = { has_espionage_asset = asset_laborer }
                    }
					modifier = {
                        factor = 10
                        OR = {
                            has_espionage_category = op_cat_sabotage
                            has_espionage_category = op_cat_economy
                        }
                    }
                    destroy_espionage_asset = asset_laborer
                }
				1 = {
                    modifier = {
                        factor = 0
                        NOT = { has_espionage_asset = asset_criminal_underling }
                    }
					modifier = {
                        factor = 10
                        OR = {
                            has_espionage_category = op_cat_sabotage
                            has_espionage_category = op_cat_government
                        }
                    }
                    destroy_espionage_asset = asset_criminal_underling
                }
				1 = {
                    modifier = {
                        factor = 0
                        NOT = { has_espionage_asset = asset_labor_drone }
                    }
					modifier = {
                        factor = 10
                        OR = {
                            has_espionage_category = op_cat_subterfuge
                            has_espionage_category = op_cat_economy
                        }
                    }
                    destroy_espionage_asset = asset_labor_drone
                }
				1 = {
                    modifier = {
                        factor = 0
                        NOT = { has_espionage_asset = asset_synapse_drone }
                    }
					modifier = {
                        factor = 10
                        OR = {
                            has_espionage_category = op_cat_subterfuge
                            has_espionage_category = op_cat_government
                        }
                    }
                    destroy_espionage_asset = asset_synapse_drone
                }
				1 = {
                    modifier = {
                        factor = 0
                        NOT = { has_espionage_asset = asset_pheromone_emitter }
                    }
					modifier = {
                        factor = 10
                        OR = {
                            has_espionage_category = op_cat_manipulation
                            has_espionage_category = op_cat_diplomacy
                        }
                    }
                    destroy_espionage_asset = asset_pheromone_emitter
                }
				1 = {
                    modifier = {
                        factor = 0
                        NOT = { has_espionage_asset = asset_logistics_system }
                    }
					modifier = {
                        factor = 10
                        OR = {
                            has_espionage_category = op_cat_subterfuge
                            has_espionage_category = op_cat_economy
                        }
                    }
                    destroy_espionage_asset = asset_logistics_system
                }
				1 = {
                    modifier = {
                        factor = 0
                        NOT = { has_espionage_asset = asset_command_relay }
                    }
					modifier = {
                        factor = 10
                        OR = {
                            has_espionage_category = op_cat_sabotage
                            has_espionage_category = op_cat_government
                        }
                    }
                    destroy_espionage_asset = asset_command_relay
                }
				1 = {
                    modifier = {
                        factor = 0
                        NOT = { has_espionage_asset = asset_dispatch_uplink }
                    }
					modifier = {
                        factor = 10
                        OR = {
                            has_espionage_category = op_cat_sabotage
                            has_espionage_category = op_cat_diplomacy
                        }
                    }
                    destroy_espionage_asset = asset_dispatch_uplink
                }
			}
		}
		hidden_effect = {
            country_event = { id = diplospy.5 days = 4 } #Re-establish contact
        }
        ai_chance = {
            factor = 20
        }
    }
}
#Contact Lost: Re-established
#fromfrom = operation
country_event = {
    id = diplospy.5
    title = operation.5001.name
    desc = diplospy.5.desc
    picture = GFX_evt_spy_network
    show_sound = event_radio_chatter
    is_triggered_only = yes

    trigger = {
        exists = fromfrom
    }

    immediate = {
        fromfrom.spynetwork = { add_spy_network_level = 10 }
        fromfrom = { set_espionage_operation_progress_locked = no }
    }

    option = { name = GOOD }
}
#Contact Lost: Proper Lost
#fromfrom = operation
country_event = {
    id = diplospy.6
    title = diplospy.6.name
    desc = diplospy.6.desc
    picture = GFX_evt_spymaster
    show_sound = event_radio_chatter
    is_triggered_only = yes

    trigger = {
        exists = fromfrom
    }

    option = {
        name = UNFORTUNATE
        fromfrom.spynetwork = {
            add_spy_network_level = -10
			add_modifier = { modifier = spynetwork_auxiliaries_lost days = 360 }
        }
    }

    after = { fromfrom = { set_espionage_operation_progress_locked = no } }
}

### MISTAKEN FOR FOOD (regular vs. hive)
# from = operation; fromfrom = target
country_event = {
    id = diplospy.7
    title = operation.5020.name
    desc = {
		trigger = { from.target = { is_open_gestalt = no } }
		text = diplospy.7.desc
	}
	desc = {
		trigger = { from.target = { is_open_gestalt = yes } }
		text = diplospy.7.desc.open
	}
    picture = GFX_evt_aggressive_flora
    show_sound = event_alien_nature
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        from = { set_espionage_operation_progress_locked = yes }
        set_timed_country_flag = {
            flag = recent_op_drones_hunted
            days = @RandomOperationEventTimer
        }
    }

    after = {
        from = { set_espionage_operation_progress_locked = no }
    }

    option = { #Drop a lure (food)
        name = operation.5020.a
        exclusive_trigger = {
            from.target = { is_lithoid_empire = no }
            resource_stockpile_compare = {
                resource = food
                value > 400
            }
        }
        add_resource = { food = -200 }
        ai_chance = { factor = 3 }
    }
    option = { #Drop a lure (lithoids)
        name = operation.5020.a
        exclusive_trigger = {
            from.target = { is_lithoid_empire = yes }
            resource_stockpile_compare = {
                resource = minerals
                value > 400
            }
        }
        add_resource = { minerals = -200 }
        ai_chance = { factor = 2 }
    }
    option = { #Can't/won't afford a lure
        name = diplospy.7.b
        from.spynetwork = {
            add_modifier = {
                modifier = spynetwork_drones_hunted
                days = 280
            }
        }
        ai_chance = {
            factor = 1
            modifier = {
                factor = 10
                OR = {
                    AND = {
                        from.target = { is_lithoid_empire = no }
                        resource_stockpile_compare = {
                            resource = food
                            value <= 600
                        }
                    }
                    AND = {
                        from.target = { is_lithoid_empire = yes }
                        resource_stockpile_compare = {
                            resource = minerals
                            value <= 600
                        }
                    }
                }
            }
        }
    }
    option = { #Expend Warrior Drone asset
        name = operation.5020.c
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
            OR = {
                from = { has_espionage_asset = asset_warrior_drone }
                from.spynetwork = { has_espionage_asset = asset_warrior_drone }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_warrior_drone }
            }
            from = { destroy_espionage_asset = asset_warrior_drone }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_warrior_drone }
            }
            from.spynetwork = { destroy_espionage_asset = asset_warrior_drone }
        }
        ai_chance = {
            factor = 15
        }
    }
	option = {
        name = operation.5020.patrol
        custom_tooltip = tooltip_espionage_asset_unpredictable
        trigger = { from.target = { is_open_gestalt = yes } }
        ai_chance = {
            factor = 10
        }
		hidden_effect = {
			random_list = {
				5 = { country_event = { id = popspyexpanded.1 } }
				2 = { country_event = { id = popspyexpanded.2 } }
				2 = { country_event = { id = popspyexpanded.3 } }
			}
		}
    }
}

### APPREHENDED BY ENFORCERS (regular/hive vs. regular)
# from = operation; fromfrom = target
country_event = {
    id = diplospy.8
    title = diplospy.8.name
    desc = diplospy.8.desc
    picture = GFX_evt_cover_blown
    show_sound = event_comms_cutoff
    is_triggered_only = yes

    trigger = {
        exists = from
        is_machine_empire = no
        from.target = { is_gestalt = no }
    }

    immediate = {
        from = {
            set_espionage_operation_progress_locked = yes
            target = { set_country_flag = drones_apprehended_operatives@root }
        }
        set_timed_country_flag = {
            flag = recent_op_apprehended_by_drones
            days = @RandomOperationEventTimer
        }
    }

    # The friendlier the target, the less chance of mishap.
    option = { #Needs diplomacy (very friendly)
        name = operation.5010.a
        exclusive_trigger = {
            OR = {
                opinion_level = {
                    who = from.target
                    level >= excellent
                }
                is_improving_relations_with = from.target
            }
        }
        locked_random_list = {
            8 = { country_event = { id = operation.5011 days = 4 } }
            2 = { from = { operation_random_events_coverblown = yes } }
        }
        ai_chance = { factor = 1 }
    }
    option = { #Needs diplomacy (friendly)
        name = operation.5010.a
        exclusive_trigger = {
            opinion_level = {
                who = from.target
                level >= neutral
            }
        }
        locked_random_list = {
            6 = { country_event = { id = operation.5011 days = 4 } }
            4 = { from = { operation_random_events_coverblown = yes } }
        }
        ai_chance = { factor = 1 }
    }
    option = { #Needs diplomacy (unfriendly)
        name = operation.5010.a
        exclusive_trigger = {
            OR = {
                opinion_level = {
                    who = from.target
                    level < neutral
                }
                from.target = {
                    has_country_flag = drones_apprehended_operatives@root
                }
            }
        }
        locked_random_list = {
            4 = { country_event = { id = operation.5011 days = 4 } }
            6 = { from = { operation_random_events_coverblown = yes } }
        }
        ai_chance = { factor = 1 }
    }
    option = { #Expend an asset
        name = operation.5010.b
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
        trigger = {
            from = {
                OR = {
                    AND = {
                        has_espionage_category = op_cat_manipulation
                        has_espionage_asset_manipulation = yes
                    }
                    AND = {
                        has_espionage_category = op_cat_sabotage
                        has_espionage_asset_sabotage = yes
                    }
                    AND = {
                        has_espionage_category = op_cat_subterfuge
                        has_espionage_asset_subterfuge = yes
                    }
                }
            }
        }
        from = {
            if = {
                limit = { has_espionage_category = op_cat_manipulation }
                spynetwork = { destroy_espionage_asset_manipulation = yes }
            }
            else_if = {
                limit = { has_espionage_category = op_cat_sabotage }
                spynetwork = { destroy_espionage_asset_sabotage = yes }
            }
            else_if = {
                limit = { has_espionage_category = op_cat_subterfuge }
                spynetwork = { destroy_espionage_asset_subterfuge = yes }
            }
        }
        hidden_effect = {
            country_event = { id = operation.5011 days = 4 }
        }
        ai_chance = { factor = 10 }
    }

    after = {
        from = { set_espionage_operation_progress_locked = no }
    }
}

### SECURITY CONCERNS (operatives get paranoid; gestalt vs. any)
# from = operation; fromfrom = target
country_event = {
    id = diplospy.9
    title = diplospy.9.name
    desc = {
		text = diplospy.9.desc.reg
		trigger = { is_gestalt = no }
	}
	desc = {
		text = diplospy.9.desc.ges
		trigger = { is_gestalt = yes }
	}
    picture = GFX_evt_operative_chase
    show_sound = event_encrypted_comms
    is_triggered_only = yes

    trigger = {
        exists = from
        is_gestalt = yes
    }

    immediate = {
        from = { set_espionage_operation_progress_locked = yes }
        set_timed_country_flag = {
            flag = recent_op_operative_spooked
            days = @RandomOperationEventTimer
        }
    }

    option = { #Deny extra resources
        name = operation.5005.a
        hidden_effect = {
            random_list = {
                6 = { }
                4 = {
                    modifier = {
                        factor = 0.5
                        from = {
                            NOR = {
                                has_espionage_category = op_cat_subterfuge
                                has_espionage_category = op_cat_provocation
                            }
                        }
                    }
                    from = { operation_random_events_coverblown = yes }
                }
            }
        }
        ai_chance = { factor = 10 }
    }
    option = { #Grant resources
        name = operation.5005.b
        allow = {
            from.spynetwork = { has_available_spy_power >= 10 }
        }
        from.spynetwork = { add_spy_network_level = -10 }
        hidden_effect = {
            random_list = {
                9 = { }
                1 = {
                    modifier = {
                        factor = 3
                        from = {
                            OR = {
                                has_espionage_category = op_cat_subterfuge
                                has_espionage_category = op_cat_provocation
                            }
                        }
                    }
                    from = { operation_random_events_coverblown = yes }
                }
            }
        }
        ai_chance = {
            factor = 1
            modifier = {
                factor = 10
                from.spynetwork = { is_spynetwork_level > 50 }
            }
        }
    }
	option = { #Bribery? (High income)
        name = operation.5005.c
        trigger = {
            has_monthly_income = {
                resource = energy
                value >= 40
            }
            from.target = {
                NOR = {
                    has_ethic = ethic_fanatic_xenophobe
                    has_ethic = ethic_fanatic_authoritarian
					is_gestalt = yes
                }
            }
			from = { NOT = { has_espionage_category = op_cat_provocation } }
        }
        allow = {
            resource_stockpile_compare = {
                resource = energy
                value >= @OperationBribeThreshold3
            }
        }
        add_resource = { energy = @OperationBribeCost3 }
        ai_chance = {
            factor = 10
            modifier = { #Less inclined if they're not rolling in dough
                factor = 0.4
                has_monthly_income = {
                    resource = energy
                    value < 60
                }
            }
        }
    }
    option = { #Bribery? (Medium income)
        name = operation.5005.c
        trigger = {
            has_monthly_income = {
                resource = energy
                value >= 10
            }
            NOT = {
                has_monthly_income = {
                    resource = energy
                    value >= 40
                }
            }
            from.target = {
                NOR = {
                    has_ethic = ethic_fanatic_xenophobe
                    has_ethic = ethic_fanatic_authoritarian
					is_gestalt = yes
                }
            }
			from = { NOT = { has_espionage_category = op_cat_provocation } }
        }
        allow = {
            resource_stockpile_compare = {
                resource = energy
                value >= @OperationBribeThreshold2
            }
        }
        add_resource = { energy = @OperationBribeCost2 }
        ai_chance = {
            factor = 10
            modifier = { #Less inclined if they're not rolling in dough
                factor = 0.4
                has_monthly_income = {
                    resource = energy
                    value < 40
                }
            }
        }
    }
    option = { #Bribery? (Low income)
        name = operation.5005.c
        trigger = {
            has_monthly_income = {
                resource = energy
                value < 10
            }
            from.target = {
                NOR = {
                    has_ethic = ethic_fanatic_xenophobe
                    has_ethic = ethic_fanatic_authoritarian
					is_gestalt = yes
                }
            }
			from = { NOT = { has_espionage_category = op_cat_provocation } }
        }
        allow = {
            resource_stockpile_compare = {
                resource = energy
                value >= @OperationBribeThreshold1
            }
        }
        add_resource = { energy = @OperationBribeCost1 }
        ai_chance = {
            factor = 10
            modifier = { #Less inclined if they're not rolling in dough
                factor = 0.5
                has_monthly_income = {
                    resource = energy
                    value < 25
                }
            }
        }
    }
    option = { #Asset can handle this
        name = operation.5005.d
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        trigger = {
            from = {
                OR = {
                    has_espionage_asset_subterfuge = yes
                    has_espionage_asset_technology = yes
                }
            }
        }
        from = {
            if = {
                limit = { has_espionage_asset_subterfuge = yes }
                destroy_espionage_asset_subterfuge = yes
            }
            else_if = {
                limit = { has_espionage_asset_technology = yes }
                destroy_espionage_asset_technology = yes
            }
        }
        ai_chance = { factor = 20 }
    }

    after = { from = { set_espionage_operation_progress_locked = no } }
}

# Lost Contacts (local assets arrested)
# from = operation; fromfrom = target
country_event = {
    id = diplospy.10
    title = diplospy.10.name
    desc = diplospy.10.desc
    picture = GFX_evt_cover_blown
    show_sound = event_comms_cutoff
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        from = {
            set_espionage_operation_progress_locked = yes
        }
        set_timed_country_flag = {
            flag = recent_op_lost_local_asset
            days = @RandomOperationEventTimer
        }
    }

    option = {
        name = MAKE_IT_SO
		allow = {
            from.spynetwork = { has_available_spy_power >= 10 } #To cover the cost - a drop in Spy Network level
        }
		from.spynetwork = { add_modifier = { modifier = spynetwork_network_in_disarray days = 280 } }
        hidden_effect = {
            random_list = {
                2 = {
					modifier = {
                        factor = 2
                        from = { has_espionage_asset_matching_operation_theme = yes }
                    }
					modifier = {
                        factor = 1.5
                        from.spynetwork = { has_available_spy_power >= 20 }
                    }
				}
                1 = {
                    modifier = {
                        factor = 3
                        from.target = {
                            relative_encryption_decryption = { target = root value >= 1.6 }
                        }
                    }
                    modifier = {
                        factor = 2
                        from.target = {
                            relative_encryption_decryption = { target = root value > 1.3 }
                            relative_encryption_decryption = { target = root value < 1.6 }
                        }
                    }
                    modifier = {
                        factor = 0.3
                        from.target = {
                            relative_encryption_decryption = { target = root value < 0.85 }
                        }
                    }
                    from = { operation_random_events_coverblown = yes }
                }
            }
        }
		from = {
            spynetwork = { add_spy_network_level = -10 }
        }
        ai_chance = { factor = 5 }
    }
	
	option = {
        name = DISAVOW
        custom_tooltip = operation.5035.b.tooltip
        hidden_effect = {
            root = { set_country_flag = burn_notice_achievement }
            locked_random_list = {
                4 = { #Successful disavowal
                    modifier = {
                        factor = 0.2
                        from.target = {
                            relative_encryption_decryption = {
                                target = root
                                value > 1.4
                            }
                        }
                    }
                    modifier = {
                        factor = 1.5
                        from = { has_espionage_asset_matching_operation_category = yes }
                    }
                    root = {
                        set_timed_country_flag = {
                            flag = has_disavowed_operative
                            days = 36000 #100 years
                        }
                    }
                }
                1 = { #Identified by the target
                    from.target = {
                        country_event = { id = espionage.1070 } #Hostile Infiltration Detected
                    }
                }
            }
        }
        from = {
            if = {
                limit = { has_espionage_asset_matching_operation_category = yes }
                switch = {
                    trigger = has_espionage_category
                    op_cat_manipulation = { destroy_espionage_asset_manipulation = yes }
                    op_cat_provocation = { } #No action - there are no Provocation-type Assets
                    op_cat_sabotage = { destroy_espionage_asset_sabotage = yes }
                    op_cat_subterfuge = { destroy_espionage_asset_subterfuge = yes }
                }
            }
            set_espionage_operation_progress_locked = no
            destroy_espionage_operation = this
        }
        ai_chance = {
            factor = 1
            modifier = {
                factor = 8
                root = {
                    relative_encryption_decryption = {
                        target = from.target
                        value < 1.0 #At > 1.0 root's encryption is superior to target's decryption
                    }
                }
            }
        }
    }

    option = { #Expend asset
        name = operation.5010.b
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_regular_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_attache }
                from.spynetwork = { has_espionage_asset = asset_attache }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_attache }
            }
            from = { destroy_espionage_asset = asset_attache }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_attache }
            }
            from.spynetwork = { destroy_espionage_asset = asset_attache }
        }
        ai_chance = {
            factor = 15
        }
    }
	option = { #Expend asset
        name = operation.5010.b
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_hive_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_pheromone_emitter }
                from.spynetwork = { has_espionage_asset = asset_pheromone_emitter }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_pheromone_emitter }
            }
            from = { destroy_espionage_asset = asset_pheromone_emitter }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_pheromone_emitter }
            }
            from.spynetwork = { destroy_espionage_asset = asset_pheromone_emitter }
        }
        ai_chance = {
            factor = 15
        }
    }
	option = { #Expend asset
        name = operation.5010.b
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_machine_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_dispatch_uplink }
                from.spynetwork = { has_espionage_asset = asset_dispatch_uplink }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_dispatch_uplink }
            }
            from = { destroy_espionage_asset = asset_dispatch_uplink }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_dispatch_uplink }
            }
            from.spynetwork = { destroy_espionage_asset = asset_dispatch_uplink }
        }
        ai_chance = {
            factor = 15
        }
    }

    after = {
        from = { set_espionage_operation_progress_locked = no }
    }
}

### MILITARY INVESTIGATES (any vs. any)
# from = operation; fromfrom = target
country_event = {
    id = diplospy.11
    title = diplospy.11.name
    desc = {
		text = diplospy.11.desc.reg
		trigger = {
			from.target = { is_gestalt = no }
		}
	}
	desc = {
		text = diplospy.11.desc.ges
		trigger = {
			from.target = { is_gestalt = yes }
		}
	}
    picture = GFX_evt_spy_network
    show_sound = event_encrypted_comms
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        from = {
            set_espionage_operation_progress_locked = yes
        }
        set_timed_country_flag = {
            flag = recent_op_military_investigates
            days = @RandomOperationEventTimer
        }
    }

    # Scale Back
    option = {
        name = diplospy.11.a
		trigger = {
			from = {
				NOR = {
					has_espionage_category = op_cat_sabotage
					has_espionage_category = op_cat_provocation
				}
			}
		}
		from.spynetwork = { add_modifier = { modifier = spynetwork_military_search days = 360 } }
		from = { set_espionage_operation_progress_locked = no }
		ai_chance = { factor = 4 }
    }
	# Halt
    option = {
        name = diplospy.11.b
		trigger = {
			from = {
				OR = {
					has_espionage_category = op_cat_sabotage
					has_espionage_category = op_cat_provocation
				}
			}
		}
		allow = {
            from.spynetwork = { has_available_spy_power >= 10 }
        }
		from.spynetwork = {
            add_spy_network_level = -10
        }
		custom_tooltip =  operation.5000.a.tooltip
		hidden_effect = {
            random_list = {
                8 = { #Investigations Blows Over
                    country_event = { id = diplospy.12 days = 34 } #Investigations Blows Over
                }
                4 = { #Operatives Caught
                    modifier = {
                        factor = 4
                        from.target = {
                            relative_encryption_decryption = { target = root value > 1.2 }
                        }
                    }
					country_event = { id = diplospy.13 days = 34 } #Operatives Caught
                    from.target = {
                        country_event = { id = espionage.1070 days = 20 } #"Hostile Infiltration Detected"
                    }
                }
            }
        }
        ai_chance = { factor = 2 }
    }
	
	option = {
        name = DISAVOW
		trigger = {
			from = {
				NOR = {
					has_espionage_category = op_cat_sabotage
					has_espionage_category = op_cat_provocation
				}
			}
		}
        custom_tooltip = operation.5000.b.tooltip
        hidden_effect = {
            root = {
                set_timed_country_flag = {
                    flag = has_disavowed_operative
                    days = 36000 #100 years
                }
                set_country_flag = burn_notice_achievement
            }
            from = {
                set_espionage_operation_progress_locked = no
                destroy_espionage_operation = this
            }
        }
        ai_chance = {
            factor = 0
        }
    }
	
	option = {
        name = DISAVOW
		trigger = {
			from = {
				OR = {
					has_espionage_category = op_cat_sabotage
					has_espionage_category = op_cat_provocation
				}
			}
		}
        custom_tooltip = operation.5035.b.tooltip
        hidden_effect = {
			from = { set_espionage_operation_progress_locked = no }
            root = { set_country_flag = burn_notice_achievement }
            locked_random_list = {
                4 = { #Successful disavowal
                    modifier = {
                        factor = 0.2
                        from.target = {
                            relative_encryption_decryption = {
                                target = root
                                value > 1.4
                            }
                        }
                    }
                    modifier = {
                        factor = 1.5
                        from = { has_espionage_asset_matching_operation_category = yes }
                    }
                    root = {
                        set_timed_country_flag = {
                            flag = has_disavowed_operative
                            days = 36000 #100 years
                        }
                    }
                }
                1 = { #Identified by the target
                    from.target = {
                        country_event = { id = espionage.1070 } #Hostile Infiltration Detected
                    }
                }
            }
        }
        from = {
            if = {
                limit = { has_espionage_asset_matching_operation_category = yes }
                switch = {
                    trigger = has_espionage_category
                    op_cat_manipulation = { destroy_espionage_asset_manipulation = yes }
                    op_cat_provocation = { } #No action - there are no Provocation-type Assets
                    op_cat_sabotage = { destroy_espionage_asset_sabotage = yes }
                    op_cat_subterfuge = { destroy_espionage_asset_subterfuge = yes }
                }
            }
            set_espionage_operation_progress_locked = no
            destroy_espionage_operation = this
        }
        ai_chance = {
            factor = 1
            modifier = {
                factor = 8
                root = {
                    relative_encryption_decryption = {
                        target = from.target
                        value < 1.0 #At > 1.0 root's encryption is superior to target's decryption
                    }
                }
            }
        }
    }
	
	option = { #Expend asset
        name = operation.5010.b
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_regular_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_junior_officer }
                from.spynetwork = { has_espionage_asset = asset_junior_officer }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_junior_officer }
            }
            from = { destroy_espionage_asset = asset_junior_officer }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_junior_officer }
            }
            from.spynetwork = { destroy_espionage_asset = asset_junior_officer }
        }
        ai_chance = {
            factor = 15
        }
    }
	option = { #Expend asset
        name = operation.5010.b
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_hive_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_warrior_drone }
                from.spynetwork = { has_espionage_asset = asset_warrior_drone }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_warrior_drone }
            }
            from = { destroy_espionage_asset = asset_warrior_drone }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_warrior_drone }
            }
            from.spynetwork = { destroy_espionage_asset = asset_warrior_drone }
        }
        ai_chance = {
            factor = 15
        }
    }
	
	option = { #Expend asset
        name = operation.5010.b
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_machine_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_war_algorithm }
                from.spynetwork = { has_espionage_asset = asset_war_algorithm }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_war_algorithm }
            }
            from = { destroy_espionage_asset = asset_war_algorithm }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_war_algorithm }
            }
            from.spynetwork = { destroy_espionage_asset = asset_war_algorithm }
        }
        ai_chance = {
            factor = 15
        }
    }

    after = {
    }
}
#Investigations Blows Over
#fromfrom = operation
country_event = {
    id = diplospy.12
    title = diplospy.12.name
    desc = diplospy.12.desc
    picture = GFX_evt_spy_network
    show_sound = event_radio_chatter
    is_triggered_only = yes

    trigger = {
        exists = fromfrom
    }

    immediate = {
        fromfrom.spynetwork = { add_spy_network_level = 10 }
        fromfrom = { set_espionage_operation_progress_locked = no }
    }

    option = {
		fromfrom.spynetwork = {
            add_modifier = { modifier = spynetwork_military_search days = 360 }
        }
	}
}
#Operatives Caught
#fromfrom = operation
country_event = {
    id = diplospy.13
    title = diplospy.13.name
    desc = diplospy.13.desc
    picture = GFX_evt_spymaster
    show_sound = event_radio_chatter
    is_triggered_only = yes

    trigger = {
        exists = fromfrom
    }

    option = {
        name = TERRIBLE
		allow = {
            fromfrom.spynetwork = { has_available_spy_power >= 10 }
        }
        fromfrom.spynetwork = {
            add_spy_network_level = -10
			add_modifier = { modifier = spynetwork_auxiliaries_lost days = 360 }
        }
    }
	option = {
        name = DISAVOW
		trigger = {
			OR = {
				is_ai = no
				fromfrom.spynetwork = { has_available_spy_power < 10 }
			}
		}
		custom_tooltip = operation.5000.b.tooltip
		fromfrom.spynetwork = {
			add_modifier = { modifier = spynetwork_auxiliaries_lost days = 360 }
        }
        hidden_effect = {
            root = {
                set_timed_country_flag = {
                    flag = has_disavowed_operative
                    days = 36000 #100 years
                }
                set_country_flag = burn_notice_achievement
            }
            fromfrom = {
                set_espionage_operation_progress_locked = no
                destroy_espionage_operation = this
            }
        }
    }

    after = { fromfrom = { set_espionage_operation_progress_locked = no } }
}

### Incompatible Technology
# from = operation; fromfrom = target
country_event = {
    id = diplospy.14
    title = diplospy.14.name
    desc = diplospy.14.desc
    picture = GFX_evt_engineering_research
    show_sound = event_spymaster
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        from = { set_espionage_operation_progress_locked = yes }
        set_timed_country_flag = {
            flag = recent_op_enigmatic
            days = @RandomOperationEventTimer
        }
    }

    after = {
        from = { set_espionage_operation_progress_locked = no }
    }

    option = {
        name = UNFORTUNATE
		FROM = {
			if = {
				limit = {
					has_espionage_category = op_cat_technology
				}
				spynetwork = { add_modifier = { modifier = spynetwork_incompatible_technology_bad days = 360 } }
			}
			else = {
				spynetwork = { add_modifier = { modifier = spynetwork_incompatible_technology days = 360 } }
			}
		}
        ai_chance = { factor = 3 }
    }
    option = { #Expend asset
        name = diplospy.14.b
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_regular_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_hacker }
                from.spynetwork = { has_espionage_asset = asset_hacker }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_hacker }
            }
            from = { destroy_espionage_asset = asset_hacker }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_hacker }
            }
            from.spynetwork = { destroy_espionage_asset = asset_hacker }
        }
        ai_chance = {
            factor = 15
        }
    }
	option = { #Expend asset
        name = diplospy.14.c
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_hive_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_cortex_node }
                from.spynetwork = { has_espionage_asset = asset_cortex_node }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_cortex_node }
            }
            from = { destroy_espionage_asset = asset_cortex_node }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_cortex_node }
            }
            from.spynetwork = { destroy_espionage_asset = asset_cortex_node }
        }
        ai_chance = {
            factor = 15
        }
    }
	option = { #Expend asset
        name = diplospy.14.d
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target = { is_machine_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_memory_cache }
                from.spynetwork = { has_espionage_asset = asset_memory_cache }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_memory_cache }
            }
            from = { destroy_espionage_asset = asset_memory_cache }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_memory_cache }
            }
            from.spynetwork = { destroy_espionage_asset = asset_memory_cache }
        }
        ai_chance = {
            factor = 15
        }
    }
}

# from = operation; fromfrom = target
country_event = {
    id = diplospy.15
    title = diplospy.14.name
    desc = diplospy.15.desc
    picture = GFX_evt_engineering_research
    show_sound = event_spymaster
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        from = { set_espionage_operation_progress_locked = yes }
        set_timed_country_flag = {
            flag = recent_op_enigmatic
            days = @RandomOperationEventTimer
        }
    }

    after = {
        from = { set_espionage_operation_progress_locked = no }
    }

    option = {
        name = UNFORTUNATE
		FROM = {
			if = {
				limit = {
					has_espionage_category = op_cat_technology
				}
				spynetwork = { add_modifier = { modifier = spynetwork_incompatible_technology_bad days = 360 } }
			}
			else = {
				spynetwork = { add_modifier = { modifier = spynetwork_incompatible_technology days = 360 } }
			}
		}
        ai_chance = { factor = 3 }
    }
    option = { #Expend asset
        name = diplospy.14.b
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target.owner = { is_regular_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_hacker }
                from.spynetwork = { has_espionage_asset = asset_hacker }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_hacker }
            }
            from = { destroy_espionage_asset = asset_hacker }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_hacker }
            }
            from.spynetwork = { destroy_espionage_asset = asset_hacker }
        }
        ai_chance = {
            factor = 15
        }
    }
	option = { #Expend asset
        name = diplospy.14.c
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target.owner = { is_hive_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_cortex_node }
                from.spynetwork = { has_espionage_asset = asset_cortex_node }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_cortex_node }
            }
            from = { destroy_espionage_asset = asset_cortex_node }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_cortex_node }
            }
            from.spynetwork = { destroy_espionage_asset = asset_cortex_node }
        }
        ai_chance = {
            factor = 15
        }
    }
	option = { #Expend asset
        name = diplospy.14.d
        custom_tooltip = tooltip_espionage_asset_guaranteed_resume
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_SPYNETWORK_ASSET_EVENT_OPTION
		}
        trigger = {
			from.target.owner = { is_machine_empire = yes }
            OR = {
                from = { has_espionage_asset = asset_memory_cache }
                from.spynetwork = { has_espionage_asset = asset_memory_cache }
            }
        }
        if = {
            limit = {
                from = { has_espionage_asset = asset_memory_cache }
            }
            from = { destroy_espionage_asset = asset_memory_cache }
        }
        else_if = {
            limit = {
                from.spynetwork = { has_espionage_asset = asset_memory_cache }
            }
            from.spynetwork = { destroy_espionage_asset = asset_memory_cache }
        }
        ai_chance = {
            factor = 15
        }
    }
}

#############################
# Operations				#
# Reserved: 100 - 299		#
#############################

################################
# SUBTERFUGE: COUNTER ESPIONAGE
################################

espionage_operation_event = {
	id = diplospy.100
	title = operation.1000.name
	desc = diplospy.100.desc
	picture = GFX_evt_spy_network
	show_sound = event_spymaster
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
	}

	option = {
		name = ACKNOWLEDGED
	}
}

espionage_operation_event = {
	id = diplospy.101
	title = operation.1021.name # Chasing a Lead
	desc = diplospy.101.desc_a
	desc = diplospy.101.desc_b
	desc = diplospy.101.desc_c
	picture = GFX_evt_intelligence_report
    show_sound = event_encrypted_comms
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				target = {
					NOT = {
						any_spynetwork = {
							owner = { is_same_value = root.target }
							target = { is_same_value = root.owner }
						}
					}
				}
			}
			set_espionage_operation_progress_locked = yes
			owner = { country_event = { id = diplospy.102 } }
		}
		owner = {
			random_owned_planet = { save_event_target_as = operating_planet }
		}
	}

	option = {
		name = ACKNOWLEDGED
	}
}

country_event = {
    id = diplospy.102
    title = diplospy.102.name
    desc = diplospy.102.desc
	picture = GFX_evt_intelligence_report
	show_sound = event_encrypted_comms
    is_triggered_only = yes
	
	trigger = {
		exists = from
	}
	
	immediate = {
		if = {
			limit = { has_modifier = spynetwork_counter_spy_practice }
			remove_modifier = spynetwork_counter_spy_practice
		}
		add_modifier = { modifier = spynetwork_counter_spy_practice days = 3600 }
		set_timed_country_flag = {
            flag = recent_counter_spy@from.target
            days = @StealTechnologyTimer
        }
		from.spynetwork = {
			set_saved_date = {
				key = recent_counter_spy
				days_from_present = @StealTechnologyTimer
				expires = @StealTechnologyTimer
			}
		}
	}

    option = {
        name = ACKNOWLEDGED
		tooltip = {
			add_modifier = { modifier = spynetwork_counter_spy_practice days = 3600 }
		}
    }

    after = {
        destroy_espionage_operation = from
    }
}

espionage_operation_event = {
	id = diplospy.103
	title = diplospy.103.name
	desc = diplospy.103.desc
	picture = GFX_evt_spymaster
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		set_espionage_operation_progress_locked = yes
		target = {
			save_event_target_as = target_country
			random_spynetwork = {
				limit = {
					owner = { is_same_value = root.target }
					target = { is_same_value = root.owner }
				}
				save_event_target_as = target_spynetwork
			}
		}
		if = {
			limit = {
				NOT = { exists = event_target:target_spynetwork }
			}
			owner = { country_event = { id = diplospy.102 } }
		}
	}
	
	option = {
		name = diplospy.103.a
		custom_tooltip = diplospy.103.a.tooltip
		hidden_effect = { set_espionage_operation_flag = counter_spy_security }
	}
	option = {
		name = diplospy.103.c
		custom_tooltip = diplospy.103.c.tooltip
		hidden_effect = { set_espionage_operation_flag = counter_spy_feed }
	}
	option = {
		name = diplospy.103.b
		allow = {
			custom_tooltip_fail = {
				text = MUST_HAVE_ASSETS
				event_target:target_spynetwork = {
					OR = {
						has_espionage_asset_manipulation = yes
						has_espionage_asset_sabotage = yes
						has_espionage_asset_subterfuge = yes
						has_espionage_asset_diplomacy = yes
						has_espionage_asset_economy = yes
						has_espionage_asset_government = yes
						has_espionage_asset_military = yes
						has_espionage_asset_technology = yes
					}
				}
			}
		}
		custom_tooltip = diplospy.103.b.tooltip
		hidden_effect = { set_espionage_operation_flag = counter_spy_asset }
	}
	
	after = {
        set_espionage_operation_progress_locked = no
		hidden_effect = {
            owner = {
                country_event = { id = diplospy.104 days = 1 }
            }
        }
    }
}
# Final setup | from = operation
country_event = {
    id = diplospy.104
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        random_list = {
			3 = {
				modifier = {
					factor = 1.5
					root = {
						relative_encryption_decryption = {
							target = from.target
							value > 1.4
						}
					}
				}
				modifier = {
					factor = 2
					has_tradition = tr_subterfuge_information_security
				}
				modifier = {
					factor = 2
					counter_espionage_operation_disguise_disadvantage = yes
				}
				modifier = {
					factor = 1.5
					any_espionage_operation = {
						owner = { is_same_value = event_target:target_country }
						target = { is_same_value = ROOT }
						OR = {
							has_espionage_category = op_cat_sabotage
							has_espionage_category = op_cat_provocation
						}
					}
				}
				from = { set_espionage_operation_flag = smooth_exit }
			}
			3 = {
				modifier = {
					factor = 0.3
					from = {
						OR = {
							has_espionage_asset_government = yes
							has_espionage_asset_subterfuge = yes
							has_espionage_asset_criminal = yes
						}
					}
				}
				#'Messy' exit (no flag needed)
			}
		}
        country_event = { id = diplospy.105 days = 3 }
    }
}

# Final | fromfrom = operation
country_event = {
	id = diplospy.105
	title = diplospy.105.name
    desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = counter_spy_security
                has_espionage_operation_flag = smooth_exit
            }
        }
        text = diplospy.105.desc.security.smooth
    }
	desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = counter_spy_security
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
        }
        text = diplospy.105.desc.security.messy
    }
	desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = counter_spy_asset
                has_espionage_operation_flag = smooth_exit
            }
        }
        text = diplospy.105.desc.asset.smooth
    }
	desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = counter_spy_asset
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
        }
        text = diplospy.105.desc.asset.messy
    }
	desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = counter_spy_feed
                has_espionage_operation_flag = smooth_exit
            }
        }
        text = diplospy.105.desc.feed.smooth
    }
	desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = counter_spy_feed
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
        }
        text = diplospy.105.desc.feed.messy
    }
	picture = GFX_evt_intelligence_report
    show_sound = event_espionage_concluded
	
	is_triggered_only = yes
	
	trigger = {
        exists = fromfrom
    }
	
	option = {
		name = EXCELLENT
		trigger = {
            fromfrom = { has_espionage_operation_flag = smooth_exit }
        }
		if = {
			limit = { NOT = { has_tradition = tr_subterfuge_information_security } }
			fromfrom.spynetwork = {
				add_spy_network_level_on_success_effect = { VALUE = -10 }
			}
		}
		if = {
			limit = {
				fromfrom = { has_espionage_operation_flag = counter_spy_security }
			}
			event_target:target_spynetwork = {
				add_modifier = { modifier = spynetwork_counter_spy_security_1 days = 3600 }
				add_spy_network_level = -40
			}
		}
		else_if = {
			limit = {
				fromfrom = { has_espionage_operation_flag = counter_spy_asset }
			}
			fromfrom = {
				espionage_sabotage_random_asset = yes
				if = {
                    limit = { target = { is_hive_empire = yes } }
                    espionage_create_asset_hive = yes
                }
                else_if = {
                    limit = { target = { is_machine_empire = yes } }
                    espionage_create_asset_machine = yes
                }
                else = {
                    espionage_create_asset_regular = yes
                }
			}
			event_target:target_spynetwork = {
				add_modifier = { modifier = spynetwork_counter_spy_asset days = 3600 }
				add_spy_network_level = -10
			}
			event_target:target_country = { set_country_flag = asset_destroyed }
		}
		else_if = {
			limit = {
				fromfrom = { has_espionage_operation_flag = counter_spy_feed }
			}
			event_target:target_spynetwork = {
				add_modifier = { modifier = spynetwork_counter_spy_feed_1 days = 3600 }
				add_spy_network_level = -10
			}
		}
	}
	option = {
		name = diplospy.105.b
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            fromfrom = {
				has_espionage_operation_flag = smooth_exit
				has_espionage_asset_subterfuge = yes
			}
			OR = {
				any_espionage_operation = {
					owner = { is_same_value = event_target:target_country }
					target = { is_same_value = ROOT }
				}
				event_target:target_country = {
					any_spynetwork = {
						owner = { is_same_value = event_target:target_country }
						target = { is_same_value = root }
						has_modifier = sleeper_cell_operation_success
					}
				}
			}
        }
		if = {
			limit = { NOT = { has_tradition = tr_subterfuge_information_security } }
			fromfrom.spynetwork = {
				add_spy_network_level_on_success_effect = { VALUE = -10 }
			}
		}
		fromfrom = {
			destroy_espionage_asset_subterfuge = yes
        }
		hidden_effect = {
			if = {
				limit = {
					any_espionage_operation = {
						owner = { is_same_value = event_target:target_country }
						target = { is_same_value = ROOT }
					}
				}
				custom_tooltip = diplospy.105.tooltip.operation
				random_espionage_operation = {
					limit = {
						owner = { is_same_value = event_target:target_country }
						target = { is_same_value = ROOT }
					}
					save_event_target_as = target_operation
					set_espionage_operation_progress_locked = yes
				}
				event_target:target_country = {
					set_country_flag = operation_compromised
				}
			}
			else = {
				custom_tooltip = diplospy.105.tooltip.sleeper
				event_target:target_country = {
					random_spynetwork = {
						limit = {
							owner = { is_same_value = event_target:target_country }
							target = { is_same_value = root }
							has_modifier = sleeper_cell_operation_success
						}
						remove_modifier = sleeper_cell_operation_success
					}
				}
				event_target:target_country = {
					set_country_flag = sleeper_cell_compromised
				}
			}
			#A Surprise Catch (asset granted)
			event_target:target_country = {
				set_timed_country_flag = {
					flag = espionage_caught_spies
					days = 20
				}
			}
			if = {
				limit = {
					any_spynetwork = {
						owner = { is_same_value = root }
						target = { is_same_value = event_target:target_country }
						is_spynetwork_level > 5
					}
					NOT = { has_country_flag = recently_received_espionage_asset }
				}
				country_event = {
					id = espionage.1040
					days = 15
					scopes = { from = event_target:target_country }
				}
			}
		}
		if = {
			limit = {
				fromfrom = { has_espionage_operation_flag = counter_spy_security }
			}
			event_target:target_spynetwork = {
				add_modifier = { modifier = spynetwork_counter_spy_security_1 days = 3600 }
				add_spy_network_level = -40
			}
		}
		else_if = {
			limit = {
				fromfrom = { has_espionage_operation_flag = counter_spy_asset }
			}
			fromfrom = {
				espionage_sabotage_random_asset = yes
				if = {
                    limit = { target = { is_hive_empire = yes } }
                    espionage_create_asset_hive = yes
                }
                else_if = {
                    limit = { target = { is_machine_empire = yes } }
                    espionage_create_asset_machine = yes
                }
                else = {
                    espionage_create_asset_regular = yes
                }
			}
			event_target:target_spynetwork = {
				add_modifier = { modifier = spynetwork_counter_spy_asset days = 3600 }
				add_spy_network_level = -10
			}
			event_target:target_country = { set_country_flag = asset_destroyed }
		}
		else_if = {
			limit = {
				fromfrom = { has_espionage_operation_flag = counter_spy_feed }
			}
			event_target:target_spynetwork = {
				add_modifier = { modifier = spynetwork_counter_spy_feed_1 days = 3600 }
				add_spy_network_level = -10
			}
		}
	}
	option = {
		name = OK
		trigger = {
            fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -15 }
        }
		if = {
			limit = {
				fromfrom = { has_espionage_operation_flag = counter_spy_security }
			}
			event_target:target_spynetwork = {
				add_modifier = { modifier = spynetwork_counter_spy_security_2 days = 3600 }
				add_spy_network_level = -20
			}
		}
		else_if = {
			limit = {
				fromfrom = { has_espionage_operation_flag = counter_spy_asset }
			}
			fromfrom = { espionage_sabotage_random_asset = yes }
			event_target:target_spynetwork = { add_modifier = { modifier = spynetwork_counter_spy_asset days = 3600 } }
			event_target:target_country = { set_country_flag = asset_destroyed }
		}
		else_if = {
			limit = {
				fromfrom = { has_espionage_operation_flag = counter_spy_feed }
			}
			event_target:target_spynetwork = { add_modifier = { modifier = spynetwork_counter_spy_feed_2 days = 3600 } }
		}
	}
	
	after = {
        custom_tooltip = diplospy.105.tooltip.cooldown
		set_timed_country_flag = {
            flag = recent_counter_spy@fromfrom.target
            days = @StealTechnologyTimer
        }
		fromfrom.spynetwork = {
			set_saved_date = {
				key = recent_counter_spy
				days_from_present = @StealTechnologyTimer
				expires = @StealTechnologyTimer
			}
		}
		event_target:target_country = {
			country_event = { id = diplospy.106 }
		}
        destroy_espionage_operation = fromfrom
    }
}

# Spy Network sabotaged! (victim) | from = instigating country
country_event = {
    id = diplospy.106
    title = diplospy.106.name
    desc = {
		trigger = { NOT = { has_country_flag = operation_compromised } }
		text = diplospy.106.desc
	}
	desc = {
		trigger = { has_country_flag = operation_compromised }
		text = diplospy.106.desc_bad
	}
    picture = GFX_evt_operative_chase
    show_sound = event_default
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    option = {
		name = {
            text = UNFORTUNATE
            trigger = { NOT = { has_country_flag = operation_compromised } }
        }
        name = {
            text = TERRIBLE
            trigger = { has_country_flag = operation_compromised }
        }
		if = {
			limit = { has_country_flag = asset_destroyed }
			custom_tooltip = diplospy.106.asset.tooltip
			remove_country_flag = asset_destroyed
		}
		else = {
			custom_tooltip = diplospy.106.operation.tooltip
		}
    }
	
	after = {
		if = {
			limit = {
				has_country_flag = operation_compromised
				exists = event_target:target_operation
			}
			destroy_espionage_operation = event_target:target_operation
		}
		if = {
			limit = {
				has_country_flag = sleeper_cell_compromised
			}
			tooltip = {
				random_spynetwork = {
					limit = {
						owner = { is_same_value = root }
						target = { is_same_value = from }
					}
					remove_modifier = sleeper_cell_operation_success
				}
			}
		}
		remove_country_flag = operation_compromised
		remove_country_flag = sleeper_cell_compromised
	}
}

################################
# MANIPULATION: ENCOURAGE ETHICS
################################

espionage_operation_event = {
	id = diplospy.110
	title = operation.6000.name #Infiltration Begins
	desc = {
		trigger = {
			target = {
				NOR = {
					has_hostile_espionage_operation_ethics = yes
					has_closed_borders = root.owner
					is_at_war_with = root.owner
				}
			}
		}
		text = diplospy.110.desc_envoy
	}
	desc = {
		trigger = {
			target = {
				OR = {
					has_hostile_espionage_operation_ethics = yes
					has_closed_borders = root.owner
					is_at_war_with = root.owner
				}
			}
		}
		text = diplospy.110.desc_cover
	}
	picture = GFX_evt_spy_network
	show_sound = event_spymaster
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { can_encourage_ethics = no }
			owner = { country_event = { id = diplospy.116 } }
		}
		else = {
			owner = { country_event = { id = diplospy.117 } }
		}
	}

	option = {
		name = ACKNOWLEDGED
	}
}

espionage_operation_event = {
	id = diplospy.111
	title = operation.6005.name #Establishing Cover
	desc = {
		trigger = { has_espionage_operation_flag = encourage_pacifist }
		text = diplospy.111.desc.a
	}
	desc = {
		trigger = { has_espionage_operation_flag = encourage_militarist }
		text = diplospy.111.desc.b
	}
	desc = {
		trigger = { has_espionage_operation_flag = encourage_materialist }
		text = diplospy.111.desc.c
	}
	desc = {
		trigger = { has_espionage_operation_flag = encourage_spiritualist }
		text = diplospy.111.desc.d
	}
	desc = {
		trigger = { has_espionage_operation_flag = encourage_egalitarian }
		text = diplospy.111.desc.e
	}
	desc = {
		trigger = { has_espionage_operation_flag = encourage_authoritarian }
		text = diplospy.111.desc.f
	}
	desc = {
		trigger = { has_espionage_operation_flag = encourage_xenophile }
		text = diplospy.111.desc.g
	}
	desc = {
		trigger = { has_espionage_operation_flag = encourage_xenophobe }
		text = diplospy.111.desc.h
	}
	picture = GFX_evt_acquire_asset
	show_sound = event_nem_asset_acquired_positive
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { can_encourage_ethics_continue = no }
			owner = { country_event = { id = diplospy.116 } }
		}
	}

	option = {
		name = ACKNOWLEDGED
	}
}

espionage_operation_event = {
	id = diplospy.112
	title = diplospy.112.name
	desc = diplospy.112.desc
	picture = GFX_evt_spymaster
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		set_espionage_operation_progress_locked = yes
		if = {
			limit = { can_encourage_ethics_continue = no }
			owner = { country_event = { id = diplospy.116 } }
		}
	}
	after = {
        set_espionage_operation_progress_locked = no
		hidden_effect = {
			owner = {
				country_event = { id = diplospy.113 days = 4 }
			}
		}
    }

	option = {
		name = LAUNCH_OPERATION
	}
}

# Final setup | from = operation
country_event = {
    id = diplospy.113
    hide_window = yes
    is_triggered_only = yes

    immediate = {
		if = {
			limit = { from = { can_encourage_ethics_continue = no } }
			country_event = { id = diplospy.116 }
		}
		else = {
			random_list = {
				3 = {
					modifier = {
						factor = 2
						root = {
							relative_encryption_decryption = {
								target = from.target
								value > 1.4
							}
						}
					}
					modifier = {
						factor = 2
						from = { target_has_similar_ethics = yes}
					}
					modifier = {
						factor = 2
						from.target = {
							NOR = {
								has_hostile_espionage_operation_ethics = yes
								has_closed_borders = root
								is_at_war_with = root
							}
						}
					}
					from = { set_espionage_operation_flag = smooth_exit }
				}
				3 = {
					modifier = {
						factor = 0.3
						from = {
							OR = {
								has_espionage_asset_government = yes
								has_espionage_asset_manipulation = yes
								has_espionage_asset_criminal = yes
							}
						}
					}
					modifier = {
						factor = 2
						espionage_operation_disguise_disadvantage = yes
					}
					modifier = {
						factor = 2
						from = { target_has_antagonistic_ethics = yes}
					}
					modifier = {
						factor = 2
						from.target = {
							OR = {
								has_hostile_espionage_operation_ethics = yes
								has_closed_borders = root
								is_at_war_with = root
							}
						}
					}
					#'Messy' exit (no flag needed)
				}
			}
			country_event = { id = diplospy.114 }
		}
    }
}

# Final | fromfrom = operation
country_event = {
	id = diplospy.114
	title = diplospy.114.name
    desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = smooth_exit
            }
        }
        text = diplospy.114.desc.smooth
    }
	desc = {
        trigger = {
			fromfrom = {
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
        }
        text = diplospy.114.desc.messy
    }
	picture = GFX_evt_alien_propaganda
    show_sound = event_espionage_concluded
	
	is_triggered_only = yes
	
	trigger = {
        exists = fromfrom
    }
	
	immediate = {
		#Bonus actions
        if = {
            limit = {
                fromfrom = { has_espionage_asset_manipulation = yes }
            }
            random_list = {
                1 = { #More pops switch
                    modifier = {
                        factor = 5
                        fromfrom = { has_espionage_asset_diplomacy = yes }
                    }
                    set_country_flag = encourage_ethics_pops@fromfrom.target
                }
                1 = { #Foment unrest
                    modifier = {
                        factor = 5
                        fromfrom = { has_espionage_asset_military = yes }
                    }
                    set_country_flag = encourage_ethics_unrest@fromfrom.target
                }
				1 = { #Acquire asset
                    modifier = {
                        factor = 5
                        fromfrom = { has_espionage_asset_government = yes }
                    }
                    set_country_flag = encourage_ethics_asset@fromfrom.target
                }
                5 = {
                    modifier = {
                        factor = 3
                        root = {
                            relative_encryption_decryption = { target = fromfrom.target value < 0.6 }
                        }
                    }
					modifier = {
                        factor = 3
                        fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
                    }
                    #No bonus action
                }
            }
        }
    }
	
	option = {
		name = EXCELLENT
		trigger = {
            fromfrom = { has_espionage_operation_flag = smooth_exit }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -30 }
        }
	}
	option = {
		name = OK
		trigger = {
            fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
	}
	option = { # convert more pops
        name = diplospy.114.b
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
        trigger = {
            has_country_flag = encourage_ethics_pops@fromfrom.target
        }
        hidden_effect = {
            remove_country_flag = encourage_ethics_pops@fromfrom.target
        }
		fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
		fromfrom = {
			custom_tooltip = diplospy.114.b.tooltip
			destroy_espionage_asset_diplomacy = yes
			hidden_effect = {
				while = {
					count = 2
					operation_change_ethics_effect = yes
				}
			}
		}
    }
	option = { # foment unrest
        name = diplospy.114.c
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
        trigger = {
            has_country_flag = encourage_ethics_unrest@fromfrom.target
        }
		allow = {
			resource_stockpile_compare = {
                resource = energy
                value >= @OperationBribeThreshold1
            }
		}
		fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
		add_resource = { energy = @OperationBribeCost1 }
        hidden_effect = {
            remove_country_flag = encourage_ethics_unrest@fromfrom.target
        }
		fromfrom.target = {
			add_modifier = { modifier = influence_campaign_unrest days = @EncourageEthicsTimer }
		}
    }
	option = { # acquire asset
        name = diplospy.114.d
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
        trigger = {
            has_country_flag = encourage_ethics_asset@fromfrom.target
        }
		allow = {
			resource_stockpile_compare = {
                resource = influence
                value >= 50
            }
		}
		fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
		add_resource = { influence = -50 }
        hidden_effect = {
            remove_country_flag = encourage_ethics_asset@fromfrom.target
        }
		fromfrom = {
			if = {
				limit = { target = { is_hive_empire = yes } }
				espionage_create_asset_hive = yes
			}
			else_if = {
				limit = { target = { is_machine_empire = yes } }
				espionage_create_asset_machine = yes
			}
			else = {
				espionage_create_asset_regular = yes
			}
		}
    }
	
	after = {
        custom_tooltip = diplospy.114.a.tooltip
        custom_tooltip = diplospy.114.tooltip.cooldown
		set_timed_country_flag = {
            flag = recent_change_ethics@fromfrom.target
            days = @StealTechnologyTimer
        }
		fromfrom.spynetwork = {
			set_saved_date = {
				key = recent_change_ethics
				days_from_present = @StealTechnologyTimer
				expires = @StealTechnologyTimer
			}
		}
		fromfrom = {
			hidden_effect = {
				operation_change_ethics_country_effect = yes
				if = {
					limit = { target = { num_pops < 40 } }
					while = {
						count = 2
						operation_change_ethics_effect = yes
					}
				}
				else_if = {
					limit = { target = { num_pops < 60 } }
					while = {
						count = 3
						operation_change_ethics_effect = yes
					}
				}
				else_if = {
					limit = { target = { num_pops < 80 } }
					while = {
						count = 4
						operation_change_ethics_effect = yes
					}
				}
				else = {
					while = {
						count = 5
						operation_change_ethics_effect = yes
					}
				}
			}
		}
		fromfrom.target = {
			country_event = { id = diplospy.115 }
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
        destroy_espionage_operation = fromfrom
    }
}

# Ethics Encouraged (victim) || from = instigating country
country_event = {
    id = diplospy.115
    title = diplospy.115.name
    desc = diplospy.115.desc
    picture = GFX_evt_alien_propaganda
    show_sound = event_public_unrest
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        random_list = {
            1 = { #Spies caught
                modifier = {
                    factor = 0
                    OR = {
                        NOT = {
                            any_spynetwork = {
                                owner = { is_same_value = root }
                                target = { is_same_value = from }
                            }
                        }
                        has_country_flag = recently_received_espionage_asset
                    }
                }
                modifier = {
                    factor = 3
                    relative_encryption_decryption = { target = from value > 0.8 }
                    relative_encryption_decryption = { target = from value < 1.6 }
                }
                modifier = {
                    factor = 10
                    relative_encryption_decryption = { target = from value >= 1.6 }
                }
                set_timed_country_flag = {
                    flag = espionage_caught_spies
                    days = 20
                }
                if = {
                    limit = {
                        any_spynetwork = {
                            owner = { is_same_value = root }
                            target = { is_same_value = from }
                            is_spynetwork_level > 5
                        }
                        NOT = { has_country_flag = recently_received_espionage_asset }
                    }
                    country_event = { #A Surprise Catch (asset granted)
                        id = espionage.1040
                        days = 15
                        scopes = { from = fromfrom }
                    }
                }
            }
            9 = { } #Nothing
        }
    }

    option = {
		name = diplospy.115.a
		allow = {
			OR = {
				resource_stockpile_compare = { resource = influence value >= 100 }
				is_egalitarian = no
			}
		}
		if = {
			limit = { is_egalitarian = yes }
			add_resource = { influence = -100 }
		}
		if = {
			limit = { is_authoritarian = yes }
			add_resource = { influence = 100 }
		}
		add_modifier = { modifier = influence_campaign_stamp_out days = @EncourageEthicsTimer }
		custom_tooltip = diplospy.115.a.tooltip
    }
	option = {
		name = diplospy.115.b
		allow = {
			OR = {
				resource_stockpile_compare = { resource = influence value >= 100 }
				is_authoritarian = no
			}
		}
		if = {
			limit = { is_authoritarian = yes }
			add_resource = { influence = -100 }
		}
		if = {
			limit = { is_egalitarian = yes }
			add_resource = { influence = 100 }
		}
		custom_tooltip = diplospy.115.a.tooltip
    }
}

# Can no longer encourage ethic
country_event = {
    id = diplospy.116
    title = diplospy.116.name
    desc = diplospy.116.desc
    picture = GFX_evt_alien_propaganda
    show_sound = event_default
    is_triggered_only = yes
	
	trigger = {
		from = {
			OR = {
				can_encourage_ethics_continue = no
				can_encourage_ethics = no
			}
		}
	}
	
	immediate = {
		from = { set_espionage_operation_progress_locked = yes }
	}
	
	after = {
		from = { set_espionage_operation_progress_locked = no }
		destroy_espionage_operation = from
	}

    trigger = {
        exists = from
    }

    option = {
		name = UNFORTUNATE
		
    }
}

country_event = {
	id = diplospy.117
	title = operation.6000.name #Infiltration Begins
	desc = {
		trigger = {
			from = {
				target = {
					NOR = {
						has_hostile_espionage_operation_ethics = yes
						has_closed_borders = root
						is_at_war_with = root
					}
				}
			}
		}
		text = diplospy.117.desc_envoy
	}
	desc = {
		trigger = {
			from = {
				target = {
					OR = {
						has_hostile_espionage_operation_ethics = yes
						has_closed_borders = root
						is_at_war_with = root
					}
				}
			}
		}
		text = diplospy.117.desc_cover
	}
	picture = GFX_evt_spy_network
	show_sound = event_spymaster
	
	is_triggered_only = yes
	
	immediate = {
		from = { set_espionage_operation_progress_locked = yes }
	}
	
	after = {
		from = { set_espionage_operation_progress_locked = no }
	}

	option = {
		name = diplospy.110.a
		trigger = {
			from = { can_encourage_pacifist = yes }
		}
		ai_chance = {
			factor = 1
		}
		from = { set_espionage_operation_flag = encourage_pacifist }
	}
	option = {
		name = diplospy.110.b
		trigger = {
			from = { can_encourage_militarist = yes }
		}
		ai_chance = {
			factor = 1
		}
		from = { set_espionage_operation_flag = encourage_militarist }
	}
	option = {
		name = diplospy.110.c
		trigger = {
			from = { can_encourage_materialist = yes }
		}
		ai_chance = {
			factor = 1
		}
		from = { set_espionage_operation_flag = encourage_materialist }
	}
	option = {
		name = diplospy.110.d
		trigger = {
			from = { can_encourage_spiritualist = yes }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 10
				has_ai_personality = evangelising_zealots
			}
		}
		from = { set_espionage_operation_flag = encourage_spiritualist }
	}
	option = {
		name = diplospy.110.e
		trigger = {
			from = { can_encourage_egalitarian = yes }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 10
				has_ai_personality = democratic_crusaders
			}
		}
		from = { set_espionage_operation_flag = encourage_egalitarian }
	}
	option = {
		name = diplospy.110.f
		trigger = {
			from = { can_encourage_authoritarian = yes }
		}
		ai_chance = {
			factor = 1
		}
		from = { set_espionage_operation_flag = encourage_authoritarian }
	}
	option = {
		name = diplospy.110.g
		trigger = {
			from = { can_encourage_xenophile = yes }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 5
				is_servitor_empire = yes
			}
		}
		from = { set_espionage_operation_flag = encourage_xenophile }
	}
	option = {
		name = diplospy.110.h
		trigger = {
			from = { can_encourage_xenophobe = yes }
		}
		ai_chance = {
			factor = 0
		}
		from = { set_espionage_operation_flag = encourage_xenophobe }
	}
}

################################
# SUBTERFUGE: ABDUCT POPS
################################

espionage_operation_event = {
	id = diplospy.120
	title = operation.6200.name # Making Contact
	desc = diplospy.120.desc
	picture = GFX_evt_spy_network
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
	}

	option = {
		name = ACKNOWLEDGED
	}
}

espionage_operation_event = {
	id = diplospy.121
	title = operation.6201.name
	desc = {
		text = diplospy.121.desc.reg.1
		text = diplospy.121.desc.reg.2
		text = diplospy.121.desc.reg.3
		text = diplospy.121.desc.reg.4
		trigger = {
			target = {
				is_hive_empire = no
				is_machine_empire = no
			}
		}
	}
	desc = {
		text = diplospy.121.desc.mach.1
		trigger = {
			target = {
				is_machine_empire = yes
				is_homicidal = no
				is_open_gestalt = no
				NOT = { is_servitor_empire = yes }
				NOT = { is_machine_assimilator = yes }
			}
		}
	}
	desc = {
		text = diplospy.121.desc.mach.2
		trigger = {
			target = {
				is_machine_empire = yes
				is_homicidal = yes
			}
		}
	}
	desc = {
		text = diplospy.121.desc.mach.3
		text = diplospy.121.desc.mach.6
		trigger = {
			target = {
				is_machine_empire = yes
				is_open_gestalt = yes
			}
		}
	}
	desc = {
		text = diplospy.121.desc.mach.4
		text = diplospy.121.desc.mach.5
		trigger = {
			target = {
				is_machine_empire = yes
				is_servitor_empire = yes
			}
		}
	}
	desc = {
		text = diplospy.121.desc.mach.7
		text = diplospy.121.desc.mach.8
		trigger = {
			target = {
				is_machine_empire = yes
				is_machine_assimilator = yes
			}
		}
	}
	desc = {
		text = diplospy.121.desc.hive.1
		trigger = {
			target = {
				is_hive_empire = yes
				is_homicidal = no
				is_open_gestalt = no
				NOR = {
					is_current_or_former_necrophage_empire = yes
					has_valid_civic = civic_living_hosts
				}
			}
		}
	}
	desc = {
		text = diplospy.121.desc.hive.2
		trigger = {
			target = {
				is_hive_empire = yes
				is_homicidal = yes
			}
		}
	}
	desc = {
		text = diplospy.121.desc.hive.3
		text = diplospy.121.desc.hive.4
		trigger = {
			target = {
				is_hive_empire = yes
				is_open_gestalt = yes
			}
		}
	}
	desc = {
		text = diplospy.121.desc.hive.5
		trigger = {
			target = {
				is_hive_empire = yes
				OR = {
					is_current_or_former_necrophage_empire = yes
					has_valid_civic = civic_living_hosts
				}
			}
		}
	}
	picture = {
		trigger = {
			target = {
				is_hive_empire = no
				is_machine_empire = no
			}
		}
		picture = GFX_evt_smugglers_in_bar
	}
	picture = {
		trigger = {
			target = { is_machine_empire = yes }
		}
		picture = GFX_evt_robot_encounter
	}
	picture = {
		trigger = {
			target = { is_hive_empire = yes }
		}
		picture = GFX_evt_face_off_in_space
	}
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
	}

	option = {
		name = ACKNOWLEDGED
	}
}

espionage_operation_event = {
	id = diplospy.122
	title = diplospy.122.name
	desc = diplospy.122.desc
	picture = {
		trigger = { 
			root.target = {
				NOT = { is_gestalt = yes }
			}
		}
		picture = GFX_evt_dark_alley
	}
	picture = {
		trigger = { 
			root.target = { is_hive_empire = yes }
		}
		picture = GFX_evt_hive_mind
	}
	picture = {
		trigger = { 
			root.target = { is_machine_empire = yes }
		}
		picture = GFX_evt_glitchy_matrix
	}
	show_sound = event_criminal_activity
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
	}

	option = {
		name = ACKNOWLEDGED
	}
}

espionage_operation_event = {
	id = diplospy.123
	title = diplospy.123.name
	desc = {
		trigger = {
			target = {
				NOR = {
					has_hostile_espionage_operation_ethics = yes
					has_closed_borders = root.owner
					is_at_war_with = root.owner
				}
			}
		}
		text = diplospy.123.desc.lure
		text = diplospy.123.desc.raid
	}
	desc = {
		trigger = {
			target = {
				OR = {
					has_hostile_espionage_operation_ethics = yes
					has_closed_borders = root.owner
					is_at_war_with = root.owner
				}
				is_homicidal = no
			}
		}
		text = diplospy.123.desc.raid
	}
	desc = {
		trigger = {
			target = {
				is_homicidal = yes
			}
		}
		text = diplospy.123.desc.raid
		text = diplospy.123.desc.purge
	}
	picture = GFX_evt_alien_segregation
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		set_espionage_operation_progress_locked = yes
	}
	after = {
        set_espionage_operation_progress_locked = no
		hidden_effect = {
			owner = { country_event = { id = diplospy.124 days = 1 } }
		}
    }

	option = {
		name = LAUNCH_OPERATION
	}
}


# Final setup | from = operation
country_event = {
    id = diplospy.124
    hide_window = yes
    is_triggered_only = yes

    immediate = {
		random_list = {
			3 = {
				modifier = {
					factor = 2
					root = {
						relative_encryption_decryption = {
							target = from.target
							value > 1.4
						}
					}
				}
				modifier = {
					factor = 1.5
					from = {
						has_espionage_asset_criminal = yes
					}
				}
				modifier = {
					factor = 2
					from.target = {
						NOR = {
							has_hostile_espionage_operation_ethics = yes
							has_closed_borders = root
							is_at_war_with = root
						}
					}
				}
				from = { set_espionage_operation_flag = smooth_exit }
			}
			3 = {
				modifier = {
					factor = 0.3
					from = {
						OR = {
							has_espionage_asset_economy = yes
							has_espionage_asset_subterfuge = yes
							has_espionage_asset_criminal = yes
						}
					}
				}
				modifier = {
					factor = 2
					espionage_operation_disguise_disadvantage = yes
				}
				modifier = {
					factor = 2
					from.target = {
						OR = {
							has_hostile_espionage_operation_ethics = yes
							has_closed_borders = root
							is_at_war_with = root
						}
					}
				}
				#'Messy' exit (no flag needed)
			}
		}
		country_event = { id = diplospy.125 days = 3 }
    }
}

# Final | fromfrom = operation
country_event = {
	id = diplospy.125
	title = diplospy.125.name
    desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = smooth_exit
            }
        }
        text = diplospy.125.desc.smooth
    }
	desc = {
        trigger = {
			fromfrom = {
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
        }
        text = diplospy.125.desc.messy
    }
	picture = GFX_evt_alien_segregation
    show_sound = event_espionage_concluded
	
	is_triggered_only = yes
	
	trigger = {
        exists = fromfrom
    }
	
	immediate = {
		random_owned_planet = {
			limit = {
				is_under_colonization = no
			}
			weights = {
				# can use add or factor
				base = 1
				modifier = {
					add = 10
					is_capital = yes
				}
				modifier = {
					add = 100
					free_housing >= 3
				}
				modifier = {
					add = 100
					free_jobs >= 3
				}
				modifier = {
					add = 5
					free_housing >= 6
					free_jobs >= 6
				}
				modifier = {
					add = 5
					free_housing >= 9
					free_jobs >= 9
				}
			}
			save_event_target_as = steal_pops_planet
		}
		if = {
			limit = { NOT = { exists = event_target:steal_pops_planet } }
			capital_scope = { save_event_target_as = steal_pops_planet }
		}
		#Bonus actions
        if = {
            limit = {
                fromfrom = {
					OR = {
						has_espionage_asset_sabotage = yes
						has_espionage_asset_criminal = yes
					}
				}
            }
            random_list = {
                1 = { #Steal more pops
                    modifier = {
                        factor = 5
                        fromfrom = {
							OR = {
								has_espionage_asset_economy = yes
								has_espionage_asset_criminal = yes
							}
						}
                    }
                    set_country_flag = steal_pops_more@fromfrom.target
                }
                1 = { #Spawn pirates
                    modifier = {
                        factor = 5
                        fromfrom = { has_espionage_asset_military = yes }
                    }
                    set_country_flag = steal_pops_pirates@fromfrom.target
                }
				1 = { #Deflect blame
                    modifier = {
                        factor = 5
                        fromfrom = { has_espionage_asset_diplomacy = yes }
                    }
					modifier = {
                        factor = 2
                        fromfrom = { has_espionage_asset_diplomacy = yes }
						fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } } # hide your tracks
                    }
					modifier = {
                        factor = 0
                        NOT = {
							any_playable_country = {
								empire_can_abduct_pops = yes
								NOR = {
									is_same_value = fromfrom.owner
									is_same_value = fromfrom.target
								}
							}
						}
                    }
                    set_country_flag = steal_pops_patsy@fromfrom.target
                }
                5 = {
                    modifier = {
                        factor = 3
                        root = {
                            relative_encryption_decryption = { target = fromfrom.target value < 0.6 }
                        }
                    }
					modifier = {
                        factor = 3
                        fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
                    }
                    #No bonus action
                }
            }
        }
    }
	
	option = {
		name = EXCELLENT
		trigger = {
            fromfrom = { has_espionage_operation_flag = smooth_exit }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
	}
	option = {
		name = OK
		trigger = {
            fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -60 }
        }
	}
	option = {
		name = diplospy.125.b
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            has_country_flag = steal_pops_more@fromfrom.target
        }
		allow = {
			resource_stockpile_compare = {
                resource = energy
                value >= @OperationBribeThreshold1
            }
		}
		add_resource = { energy = @OperationBribeCost1 }
		custom_tooltip = diplospy.125.b.tooltip
		hidden_effect = {
			remove_country_flag = steal_pops_more@fromfrom.target
			random_owned_planet = {
				limit = {
					is_under_colonization = no
				}
				weights = {
					# can use add or factor
					base = 1
					modifier = {
						add = 10
						is_capital = yes
					}
					modifier = {
						add = 100
						free_housing >= 3
					}
					modifier = {
						add = 100
						free_jobs >= 3
					}
					modifier = {
						add = 5
						free_housing >= 6
						free_jobs >= 6
					}
					modifier = {
						add = 5
						free_housing >= 9
						free_jobs >= 9
					}
				}
				save_event_target_as = steal_pops_extra_planet
			}
			if = {
				limit = { NOT = { exists = event_target:steal_pops_extra_planet } }
				capital_scope = { save_event_target_as = steal_pops_extra_planet }
			}
			fromfrom.target = {
				while = {
					count = 3
					random_owned_pop = {
						limit = {
							is_sapient = yes
							is_robot_pop = no
							NOT = { has_trait = trait_hive_mind }
						}
						weights = {
							# can use add or factor
							base = 1
							modifier = {
								add = 10
								is_same_species = root.owner_species # rescues pops of your own species
							}
							modifier = {
								add = 20
								has_citizenship_type = { type = citizenship_slavery country = root }
							}
							modifier = {
								add = 2
								has_citizenship_type = { country = fromfrom.target type = citizenship_purge }
							}
							modifier = {
								factor = 0.01
								ROOT = { NOT = { has_valid_civic = civic_living_hosts } }
								has_citizenship_type = { country = root type = citizenship_purge }
							}
							modifier = {
								add = 20
								ROOT = { has_valid_civic = civic_living_hosts }
								has_citizenship_type = { country = root type = citizenship_purge }
							}
						}
						resettle_pop = {
							pop = this
							planet = event_target:steal_pops_extra_planet
						}
					}
				}
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -60 }
        }
	}
	option = {
		name = diplospy.125.c
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            has_country_flag = steal_pops_pirates@fromfrom.target
        }
		allow = {
			resource_stockpile_compare = {
                resource = energy
                value >= @OperationBribeThreshold1
            }
		}
		add_resource = { energy = @OperationBribeCost1 }
		custom_tooltip = diplospy.125.c.tooltip
		hidden_effect = {
			remove_country_flag = steal_pops_pirates@fromfrom.target
			fromfrom.target = {
				country_event = { id = diplospy.127 days = 5 }
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -60 }
        }
	}
	option = {
		name = diplospy.125.d
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            has_country_flag = steal_pops_patsy@fromfrom.target
        }
		fromfrom = { destroy_espionage_asset_diplomacy = yes }
		custom_tooltip = diplospy.125.d.tooltip
		hidden_effect = {
			remove_country_flag = steal_pops_patsy@fromfrom.target
			random_playable_country = {
				limit = {
					empire_can_abduct_pops = yes
					NOR = {
						is_same_value = fromfrom.owner
						is_same_value = fromfrom.target
					}
				}
				save_event_target_as = blamed_empire
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -60 }
        }
	}
	after = {
		set_timed_country_flag = {
            flag = recent_steal_pops@fromfrom.target
            days = @StealTechnologyTimer
        }
		fromfrom.spynetwork = {
			set_saved_date = {
				key = recent_steal_pops
				days_from_present = @StealTechnologyTimer
				expires = @StealTechnologyTimer
			}
		}
		if = {
			limit = {
				NOT = { exists = event_target:blamed_empire }
				fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
			}
			save_event_target_as = blamed_empire # opinion loss
		}
		fromfrom.target = {
			hidden_effect = {
				while = {
					count = 3
					random_owned_pop = {
						limit = {
							is_sapient = yes
							is_robot_pop = no
							NOT = { has_trait = trait_hive_mind }
						}
						weights = {
							# can use add or factor
							base = 1
							modifier = {
								add = 10
								is_same_species = root.owner_species # rescues pops of your own species
							}
							modifier = {
								add = 20
								has_citizenship_type = { type = citizenship_slavery country = root }
							}
							modifier = {
								add = 2
								has_citizenship_type = { country = fromfrom.target type = citizenship_purge }
							}
							modifier = {
								factor = 0.01
								ROOT = { NOT = { has_valid_civic = civic_living_hosts } }
								has_citizenship_type = { country = root type = citizenship_purge }
							}
							modifier = {
								add = 20
								ROOT = { has_valid_civic = civic_living_hosts }
								has_citizenship_type = { country = root type = citizenship_purge }
							}
						}
						resettle_pop = {
							pop = this
							planet = event_target:steal_pops_planet
						}
					}
				}
			}
			country_event = { id = diplospy.126 }
		}
		custom_tooltip = diplospy.125.tooltip.pops
        custom_tooltip = diplospy.125.tooltip.cooldown
        destroy_espionage_operation = fromfrom
		
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
    }
}

# Pops Stolen (victim) | from = instigating country
country_event = {
    id = diplospy.126
    title = diplospy.126.name
    desc = {
		trigger = {
			NOT = { exists = event_target:blamed_empire }
			is_gestalt = no
		}
		text = diplospy.126.desc.smooth.reg
	}
	desc = {
		trigger = {
			NOT = { exists = event_target:blamed_empire }
			is_gestalt = yes
			NOT = { is_servitor_empire = yes }
			NOT = { is_machine_assimilator = yes }
		}
		text = diplospy.126.desc.smooth.ges.1
	}
	desc = {
		trigger = {
			NOT = { exists = event_target:blamed_empire }
			is_gestalt = yes
			is_servitor_empire = yes
		}
		text = diplospy.126.desc.smooth.ges.2
	}
	desc = {
		trigger = {
			NOT = { exists = event_target:blamed_empire }
			is_gestalt = yes
			is_machine_assimilator = yes
		}
		text = diplospy.126.desc.smooth.ges.3
	}
	desc = {
		trigger = {
			exists = event_target:blamed_empire
			is_gestalt = no
		}
		text = diplospy.126.desc.messy.reg
	}
	desc = {
		trigger = {
			exists = event_target:blamed_empire
			is_gestalt = yes
			NOT = { is_servitor_empire = yes }
			NOT = { is_machine_assimilator = yes }
		}
		text = diplospy.126.desc.messy.ges.1
	}
	desc = {
		trigger = {
			exists = event_target:blamed_empire
			is_gestalt = yes
			is_servitor_empire = yes
		}
		text = diplospy.126.desc.messy.ges.2
	}
	desc = {
		trigger = {
			exists = event_target:blamed_empire
			is_gestalt = yes
			is_servitor_empire = yes
		}
		text = diplospy.126.desc.messy.ges.3
	}
    picture = GFX_evt_alien_segregation
    show_sound = event_public_unrest
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        random_list = {
            1 = { #Spies caught
                modifier = {
                    factor = 0
                    OR = {
                        NOT = {
                            any_spynetwork = {
                                owner = { is_same_value = root }
                                target = { is_same_value = from }
                            }
                        }
                        has_country_flag = recently_received_espionage_asset
                    }
                }
                modifier = {
                    factor = 3
                    relative_encryption_decryption = { target = from value > 0.8 }
                    relative_encryption_decryption = { target = from value < 1.6 }
                }
                modifier = {
                    factor = 10
                    relative_encryption_decryption = { target = from value >= 1.6 }
                }
                set_timed_country_flag = {
                    flag = espionage_caught_saboteurs
                    days = 20
                }
                if = {
                    limit = {
                        any_spynetwork = {
                            owner = { is_same_value = root }
                            target = { is_same_value = from }
                            is_spynetwork_level > 5
                        }
                        NOT = { has_country_flag = recently_received_espionage_asset }
                    }
                    country_event = { #A Surprise Catch (asset granted)
                        id = espionage.1040
                        days = 15
                        scopes = { from = fromfrom }
                    }
                }
            }
            9 = { } #Nothing
        }
    }
	
	after = {
		if = {
			limit = {
				exists = event_target:blamed_empire
				OR = {
					is_homicidal = no
					is_gestalt = no
				}
			}
			add_opinion_modifier = {
				who = event_target:blamed_empire
				modifier = opinion_stole_pops
			}
		}
		if = {
			limit = { is_gestalt = no }
			add_modifier = { modifier = rich_pirates days = 3600 }
			add_modifier = { modifier = pop_stolen days = 3600 }
		}
		else = {
			add_modifier = { modifier = rich_pirates_gestalt days = 3600 }
		}
	}

    option = {
		name = TERRIBLE
		trigger = {
			OR = {
				is_homicidal = no
				is_gestalt = no
			}
		}
		custom_tooltip = diplospy.126.a.tooltip
    }
	option = {
		name = diplospy.126.b
		trigger = {
			is_homicidal = yes
			is_machine_empire = yes
		}
		custom_tooltip = diplospy.126.a.tooltip
    }
	option = {
		name = diplospy.126.c
		trigger = {
			is_homicidal = yes
			is_hive_empire = yes
		}
		custom_tooltip = diplospy.126.a.tooltip
    }
}

# Pops Stolen (victim) | from = instigating country
country_event = {
    id = diplospy.127
    title =  operation.6206.name
    desc = {
		trigger = { is_gestalt = no }
		text = diplospy.127.desc
	}
	desc = {
		trigger = { is_gestalt = yes }
		text = diplospy.127.desc.gestalt
	}
    picture = GFX_evt_pirates_attacking_cargo
	show_sound = event_space_battle
    is_triggered_only = yes

    immediate = {
		if = {
			limit = {
				any_owned_starbase = { has_starbase_size = starbase_outpost }
			}
			random_owned_starbase = {
				limit = { has_starbase_size = starbase_outpost }
				solar_system = {
					save_event_target_as = privateer_system
					create_privateer_country = yes
					create_privateer_fleet = yes
				}
			}
		}
		else = {
			random_system_within_border = {
				save_event_target_as = privateer_system
				create_privateer_country = yes
				create_privateer_fleet = yes
			}
		}
    }

    option = {
		name = CURSES
		custom_tooltip = diplospy.127.a.tooltip
    }
}


################################
# SUBTERFUGE: RESCUE SLAVES
################################

espionage_operation_event = {
	id = diplospy.130
	title = operation.6200.name # Making Contact
	desc = diplospy.130.desc
	picture = GFX_evt_spy_network
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
	}

	option = {
		name = ACKNOWLEDGED
	}
}

espionage_operation_event = {
	id = diplospy.131
	title = operation.6201.name
	desc = {
		trigger = {
			target = {
				is_hive_empire = no
				is_machine_empire = no
			}
		}
		text = diplospy.131.desc.reg.1
		text = diplospy.131.desc.reg.2
	}
	desc = {
		trigger = {
			target = {
				is_machine_empire = yes
				is_homicidal = no
				NOT = { is_machine_assimilator = yes }
			}
		}
		text = diplospy.121.desc.mach.1
	}
	desc = {
		trigger = {
			target = {
				is_machine_empire = yes
				is_homicidal = yes
			}
		}
		text = diplospy.121.desc.mach.2
	}
	desc = {
		trigger = {
			target = {
				is_machine_empire = yes
				is_machine_assimilator = yes
			}
		}
		text = diplospy.121.desc.mach.7
		text = diplospy.131.desc.mach.1
	}
	desc = {
		trigger = {
			target = {
				is_hive_empire = yes
				is_homicidal = no
				NOR = {
					is_current_or_former_necrophage_empire = yes
					has_valid_civic = civic_living_hosts
				}
			}
		}
		text = diplospy.121.desc.hive.1
	}
	desc = {
		trigger = {
			target = {
				is_hive_empire = yes
				is_homicidal = yes
			}
		}
		text = diplospy.121.desc.hive.2
	}
	desc = {
		trigger = {
			target = {
				is_hive_empire = yes
				OR = {
					is_current_or_former_necrophage_empire = yes
					has_valid_civic = civic_living_hosts
				}
			}
		}
		text = diplospy.121.desc.hive.5
	}
	picture = {
		trigger = {
			target = {
				is_hive_empire = no
				is_machine_empire = no
			}
		}
		picture = GFX_evt_smugglers_in_bar
	}
	picture = {
		trigger = {
			target = { is_machine_empire = yes }
		}
		picture = GFX_evt_robot_encounter
	}
	picture = {
		trigger = {
			target = { is_hive_empire = yes }
		}
		picture = GFX_evt_face_off_in_space
	}
	show_sound = event_default
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
	}

	option = {
		name = ACKNOWLEDGED
	}
}

espionage_operation_event = {
	id = diplospy.132
	title = diplospy.122.name
	desc = diplospy.132.desc
	picture = GFX_evt_acquire_asset
	show_sound = event_nem_asset_acquired_positive
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
	}

	option = {
		name = ACKNOWLEDGED
	}
}

espionage_operation_event = {
	id = diplospy.133
	title = diplospy.123.name
	desc = diplospy.133.name
	picture = GFX_evt_alien_segregation
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		set_espionage_operation_progress_locked = yes
	}
	after = {
        set_espionage_operation_progress_locked = no
		hidden_effect = {
			owner = { country_event = { id = diplospy.134 days = 1 } }
		}
    }

	option = {
		name = LAUNCH_OPERATION
	}
}


# Final setup | from = operation
country_event = {
    id = diplospy.134
    hide_window = yes
    is_triggered_only = yes

    immediate = {
		random_list = {
			3 = {
				modifier = {
					factor = 2
					root = {
						relative_encryption_decryption = {
							target = from.target
							value > 1.4
						}
					}
				}
				modifier = {
					factor = 3
					from = {
						has_espionage_asset_economy = yes
					}
				}
				modifier = {
					factor = 2
					from.target = {
						NOR = {
							has_hostile_espionage_operation_ethics = yes
							has_closed_borders = root
							is_at_war_with = root
						}
					}
				}
				from = { set_espionage_operation_flag = smooth_exit }
			}
			3 = {
				modifier = {
					factor = 0.3
					from = {
						OR = {
							has_espionage_asset_economy = yes
							has_espionage_asset_subterfuge = yes
							has_espionage_asset_criminal = yes
						}
					}
				}
				modifier = {
					factor = 2
					espionage_operation_disguise_disadvantage = yes
				}
				modifier = {
					factor = 2
					from.target = {
						OR = {
							has_hostile_espionage_operation_ethics = yes
							has_closed_borders = root
							is_at_war_with = root
						}
					}
				}
				#'Messy' exit (no flag needed)
			}
		}
		country_event = { id = diplospy.135 days = 3 }
    }
}

# Final | fromfrom = operation
country_event = {
	id = diplospy.135
	title = diplospy.135.name
    desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = smooth_exit
            }
        }
        text = diplospy.135.desc.smooth
    }
	desc = {
        trigger = {
			fromfrom = {
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
        }
        text = diplospy.135.desc.messy
    }
	picture = GFX_evt_alien_segregation
    show_sound = event_espionage_concluded
	
	is_triggered_only = yes
	
	trigger = {
        exists = fromfrom
    }
	
	immediate = {
		random_owned_planet = {
			limit = {
				is_under_colonization = no
			}
			weights = {
				# can use add or factor
				base = 1
				modifier = {
					add = 10
					is_capital = yes
				}
				modifier = {
					add = 100
					free_housing >= 3
				}
				modifier = {
					add = 100
					free_jobs >= 3
				}
				modifier = {
					add = 5
					free_housing >= 6
					free_jobs >= 6
				}
				modifier = {
					add = 5
					free_housing >= 9
					free_jobs >= 9
				}
			}
			save_event_target_as = steal_pops_planet
		}
		if = {
			limit = { NOT = { exists = event_target:steal_pops_planet } }
			capital_scope = { save_event_target_as = steal_pops_planet }
		}
		#Bonus actions
        if = {
            limit = {
                fromfrom = {
					OR = {
						has_espionage_asset_sabotage = yes
						has_espionage_asset_criminal = yes
					}
				}
            }
            random_list = {
                1 = { #Rescue more pops
                    modifier = {
                        factor = 6
                        fromfrom = {
							OR = {
								has_espionage_asset_economy = yes
								has_espionage_asset_criminal = yes
							}
						}
                    }
                    set_country_flag = rescue_pops_more@fromfrom.target
                }
                1 = { #Foment unrest
                    modifier = {
                        factor = 6
                        fromfrom = { has_espionage_asset_military = yes }
                    }
                    set_country_flag = rescue_pops_unrest@fromfrom.target
                }
				1 = { #Deflect blame
                    modifier = {
                        factor = 6
                        fromfrom = { has_espionage_asset_diplomacy = yes }
                    }
					modifier = {
                        factor = 2
                        fromfrom = { has_espionage_asset_diplomacy = yes }
						fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } } # hide your tracks
                    }
					modifier = {
                        factor = 0
                        NOT = {
							any_playable_country = {
								empire_can_rescue_pops = yes
								NOR = {
									is_same_value = fromfrom.owner
									is_same_value = fromfrom.target
								}
							}
						}
                    }
                    set_country_flag = rescue_pops_patsy@fromfrom.target
                }
				1 = { #Acquire Asset
                    modifier = {
                        factor = 6
                        fromfrom = { has_espionage_asset_government = yes }
                    }
                    set_country_flag = rescue_pops_asset@fromfrom.target
                }
                6 = {
                    modifier = {
                        factor = 2.5
                        root = {
                            relative_encryption_decryption = { target = fromfrom.target value < 0.6 }
                        }
                    }
					modifier = {
                        factor = 2.5
                        fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
                    }
                    #No bonus action
                }
            }
        }
    }
	
	option = {
		name = EXCELLENT
		trigger = {
            fromfrom = { has_espionage_operation_flag = smooth_exit }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
	}
	option = {
		name = OK
		trigger = {
            fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -60 }
        }
	}
	option = {
		name = diplospy.135.b
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            has_country_flag = rescue_pops_more@fromfrom.target
        }
		allow = {
			resource_stockpile_compare = {
                resource = energy
                value >= @OperationBribeThreshold1
            }
		}
		add_resource = { energy = @OperationBribeCost1 }
		custom_tooltip = diplospy.135.b.tooltip
		hidden_effect = {
			remove_country_flag = rescue_pops_more@fromfrom.target
			random_owned_planet = {
				limit = {
					is_under_colonization = no
				}
				weights = {
					# can use add or factor
					base = 1
					modifier = {
						add = 10
						is_capital = yes
					}
					modifier = {
						add = 100
						free_housing >= 3
					}
					modifier = {
						add = 100
						free_jobs >= 3
					}
					modifier = {
						add = 5
						free_housing >= 6
						free_jobs >= 6
					}
					modifier = {
						add = 5
						free_housing >= 9
						free_jobs >= 9
					}
				}
				save_event_target_as = steal_pops_extra_planet
			}
			if = {
				limit = { NOT = { exists = event_target:steal_pops_extra_planet } }
				capital_scope = { save_event_target_as = steal_pops_extra_planet }
			}
			fromfrom.target = {
				while = {
					count = 3
					random_owned_pop = {
						limit = {
							pop_can_be_rescued = yes
						}
						weights = {
							# can use add or factor
							base = 1
							modifier = {
								add = 30
								is_same_species = root.owner_species # rescues pops of your own species
							}
							modifier = {
								add = 20
								has_citizenship_type = { type = citizenship_slavery country = fromfrom.target }
							}
							modifier = {
								add = 30
								has_citizenship_type = { country = fromfrom.target type = citizenship_purge }
							}
						}
						resettle_pop = {
							pop = this
							planet = event_target:steal_pops_extra_planet
						}
					}
				}
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -60 }
        }
	}
	option = {
		name = diplospy.135.c
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            has_country_flag = rescue_pops_unrest@fromfrom.target
        }
		allow = {
			resource_stockpile_compare = {
                resource = energy
                value >= @OperationBribeThreshold1
            }
		}
		add_resource = { energy = @OperationBribeCost1 }
		hidden_effect = {
			remove_country_flag = rescue_pops_unrest@fromfrom.target
		}
		fromfrom.target = {
			add_modifier = { modifier = emboldened_slaves days = 3600 }
			set_country_flag = emboldened_slaves_flag
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -60 }
        }
	}
	option = {
		name = diplospy.125.d
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            has_country_flag = rescue_pops_patsy@fromfrom.target
        }
		fromfrom = { destroy_espionage_asset_diplomacy = yes }
		custom_tooltip = diplospy.125.d.tooltip
		hidden_effect = {
			remove_country_flag = rescue_pops_patsy@fromfrom.target
			random_playable_country = {
				limit = {
					empire_can_rescue_pops = yes
					NOR = {
						is_same_value = fromfrom.owner
						is_same_value = fromfrom.target
					}
				}
				save_event_target_as = blamed_empire
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -60 }
        }
	}
	option = { # acquire asset
        name = diplospy.114.d
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
        trigger = {
            has_country_flag = rescue_pops_asset@fromfrom.target
        }
		allow = {
			resource_stockpile_compare = {
                resource = influence
                value >= 50
            }
		}
		add_resource = { influence = 50 }
        hidden_effect = {
            remove_country_flag = rescue_pops_asset@fromfrom.target
        }
		fromfrom = {
			if = {
				limit = { target = { is_hive_empire = yes } }
				espionage_create_asset_hive = yes
			}
			else_if = {
				limit = { target = { is_machine_empire = yes } }
				espionage_create_asset_machine = yes
			}
			else = {
				espionage_create_asset_regular = yes
			}
		}
    }
	after = {
		set_timed_country_flag = {
            flag = recent_rescue_pops@fromfrom.target
            days = @StealTechnologyTimer
        }
		fromfrom.spynetwork = {
			set_saved_date = {
				key = recent_steal_pops
				days_from_present = @StealTechnologyTimer
				expires = @StealTechnologyTimer
			}
		}
		if = {
			limit = {
				NOT = { exists = event_target:blamed_empire }
				fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
			}
			save_event_target_as = blamed_empire # opinion loss
		}
		fromfrom.target = {
			hidden_effect = {
				while = {
					count = 3
					random_owned_pop = {
						limit = {
							pop_can_be_rescued = yes
						}
						weights = {
							# can use add or factor
							base = 1
							modifier = {
								add = 30
								is_same_species = root.owner_species # rescues pops of your own species
							}
							modifier = {
								add = 20
								has_citizenship_type = { type = citizenship_slavery country = fromfrom.target }
							}
							modifier = {
								add = 30
								has_citizenship_type = { country = fromfrom.target type = citizenship_purge }
							}
						}
						resettle_pop = {
							pop = this
							planet = event_target:steal_pops_planet
						}
					}
				}
			}
			country_event = { id = diplospy.136 }
		}
		custom_tooltip = diplospy.135.tooltip.pops
        custom_tooltip = diplospy.125.tooltip.cooldown
        destroy_espionage_operation = fromfrom
    }
}

# Pops Stolen (victim) | from = instigating country
country_event = {
    id = diplospy.136
    title = diplospy.136.name
    desc = {
		trigger = {
			NOT = { exists = event_target:blamed_empire }
			is_gestalt = no
			is_homicidal = no
		}
		text = diplospy.136.desc.smooth.reg.1
	}
	desc = {
		trigger = {
			NOT = { exists = event_target:blamed_empire }
			is_gestalt = yes
			is_homicidal = no
			NOT = { is_machine_assimilator = yes }
		}
		text = diplospy.126.desc.smooth.ges.1
	}
	desc = {
		trigger = {
			NOT = { exists = event_target:blamed_empire }
			is_gestalt = yes
			is_machine_assimilator = yes
		}
		text = diplospy.126.desc.smooth.ges.3
	}
	desc = {
		trigger = {
			exists = event_target:blamed_empire
			is_gestalt = no
			is_homicidal = no
		}
		text = diplospy.136.desc.messy.reg.1
	}
	desc = {
		trigger = {
			exists = event_target:blamed_empire
			is_gestalt = yes
			is_homicidal = no
			NOT = { is_machine_assimilator = yes }
		}
		text = diplospy.126.desc.messy.ges.1
	}
	desc = {
		trigger = {
			exists = event_target:blamed_empire
			is_gestalt = yes
			is_machine_assimilator = yes
		}
		text = diplospy.126.desc.messy.ges.3
	}
	desc = {
		trigger = {
			is_homicidal = yes
		}
		text = diplospy.136.desc.smooth.hom
	}
    picture = GFX_evt_alien_segregation
    show_sound = event_public_unrest
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        random_list = {
            1 = { #Spies caught
                modifier = {
                    factor = 0
                    OR = {
                        NOT = {
                            any_spynetwork = {
                                owner = { is_same_value = root }
                                target = { is_same_value = from }
                            }
                        }
                        has_country_flag = recently_received_espionage_asset
                    }
                }
                modifier = {
                    factor = 3
                    relative_encryption_decryption = { target = from value > 0.8 }
                    relative_encryption_decryption = { target = from value < 1.6 }
                }
                modifier = {
                    factor = 10
                    relative_encryption_decryption = { target = from value >= 1.6 }
                }
                set_timed_country_flag = {
                    flag = espionage_caught_saboteurs
                    days = 20
                }
                if = {
                    limit = {
                        any_spynetwork = {
                            owner = { is_same_value = root }
                            target = { is_same_value = from }
                            is_spynetwork_level > 5
                        }
                        NOT = { has_country_flag = recently_received_espionage_asset }
                    }
                    country_event = { #A Surprise Catch (asset granted)
                        id = espionage.1040
                        days = 15
                        scopes = { from = fromfrom }
                    }
                }
            }
            9 = { } #Nothing
        }
    }
	
	after = {
		if = {
			limit = {
				exists = event_target:blamed_empire
				is_homicidal = no
			}
			add_opinion_modifier = {
				who = event_target:blamed_empire
				modifier = opinion_freed_pops
			}
		}
		if = {
			limit = { has_country_flag = emboldened_slaves_flag }
			tooltip = { add_modifier = { modifier = emboldened_slaves days = 3600 } }
			remove_country_flag = emboldened_slaves_flag
		}
	}

    option = {
		name = TERRIBLE
		trigger = {
			is_homicidal = no
		}
		custom_tooltip = diplospy.136.a.tooltip
    }
	option = {
		name = diplospy.126.b
		trigger = {
			is_homicidal = yes
			is_hive_empire = no
		}
		custom_tooltip = diplospy.136.a.tooltip
    }
	option = {
		name = diplospy.126.c
		trigger = {
			is_homicidal = yes
			is_hive_empire = yes
		}
		custom_tooltip = diplospy.136.a.tooltip
    }
}


################################
# SABOTAGE: INDUSTRIAL SABOTAGE
################################

espionage_operation_event = {
	id = diplospy.140
	title = diplospy.140.name
	desc = {
        text = diplospy.140.desc.jobseeker
        text = diplospy.140.desc.vendor
        trigger = {
            exists = event_target:sabotage_planet_1
            target = {
                NOR = {
                    has_hostile_espionage_operation_ethics = yes
                    has_closed_borders = root.owner
                    is_at_war_with = root.owner
                }
            }
        }
    }
    desc = {
        text = diplospy.140.desc.cover
        text = diplospy.140.desc.cargo
        trigger = {
            exists = event_target:sabotage_planet_1
            target = {
                OR = {
					has_hostile_espionage_operation_ethics = yes
					has_closed_borders = root.owner
					is_at_war_with = root.owner
				}
            }
        }
    }
    desc = {
        text = diplospy.140.desc.invalid
        trigger = {
            NOT = { exists = event_target:sabotage_planet_1 }
        }
    }
	picture = GFX_evt_colony_settlement
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		set_espionage_operation_progress_locked = yes
		target = {
			while = {
				count = 3
				random_owned_planet = {
					limit = {
						NOT = { has_modifier = industrial_sabotage }
						NOT = { planet_devastation > 75 }
						NOR = {
                            AND = {
                                exists = event_target:sabotage_planet_1
                                is_same_value = event_target:sabotage_planet_1
                            }
                            AND = {
                                exists = event_target:sabotage_planet_2
                                is_same_value = event_target:sabotage_planet_2
                            }
                            AND = {
                                exists = event_target:sabotage_planet_3
                                is_same_value = event_target:sabotage_planet_3
                            }
                        }
					}
					weights = {
						base = 1
						modifier = {
							add = 10
							OR = {
								has_designation = col_foundry
								has_designation = col_industrial
								has_designation = col_factory
								has_designation = col_refinery
								has_designation = col_habitat_foundry
								has_designation = col_habitat_factory
								has_designation = col_habitat_refinery
								has_designation = col_ecu_foundry
								has_designation = col_ecu_factory
								has_designation = col_mac_foundry
								has_designation = col_mac_factory
								has_designation = col_hiv_foundry
							}
						}
						modifier = {
							add = 10
							OR = {
								num_districts = { type = district_industrial value >= 3 }
								num_districts = { type = district_hab_industrial value >= 3 }
								num_districts = { type = district_arcology_arms_industry value >= 2 }
								num_districts = { type = district_arcology_civilian_industry value >= 2 }
								has_building = building_foundry_1
								has_building = building_foundry_2
								has_building = building_factory_1
								has_building = building_factory_2
								num_buildings = { type = building_refinery value >= 2 }
								num_buildings = { type = building_crystal_plant value >= 2 }
								num_buildings = { type = building_chemical_plant value >= 2 }
							}
						}
						modifier = {
							add = 6
							OR = {
								has_designation = col_mining
								has_designation = col_habitat_mining
							}
						}
						modifier = {
							add = 6
							OR = {
								num_districts = { type = district_mining value >= 3 }
								num_districts = { type = district_hab_mining value >= 3 }
							}
						}
						modifier = {
							add = 3
							OR = {
								has_designation = col_farming
								has_designation = col_generator
								has_designation = col_habitat_energy
								has_designation = col_ring_farming
								has_designation = col_ring_generator
							}
						}
						modifier = {
							add = 3
							OR = {
								num_districts = { type = district_farming value >= 3 }
								num_districts = { type = district_generator value >= 3 }
								num_districts = { type = district_hab_energy value >= 3 }
								num_districts = { type = district_rw_farming value >= 1 }
								num_districts = { type = district_rw_generator value >= 1 }
							}
						}
						modifier = {
							factor = 1.5
							is_capital = yes
						}
						modifier = {
							factor = 0.25
							OR = {
								has_designation = col_habitat_leisure
								has_designation = col_habitat_trade
								has_designation = col_resort
								has_designation = col_ring_trade
								has_designation = col_bureau
							}
						}
					}
					if = {
                        limit = { NOT = { exists = event_target:sabotage_planet_1 } }
                        save_event_target_as = sabotage_planet_1
                    }
                    else_if = {
                        limit = { NOT = { exists = event_target:sabotage_planet_2 } }
                        save_event_target_as = sabotage_planet_2
                    }
                    else_if = {
                        limit = { NOT = { exists = event_target:sabotage_planet_3 } }
                        save_event_target_as = sabotage_planet_3
                    }
				}
			}
		}
	}

	option = {
		name = diplospy.140.a
		trigger = { exists = event_target:sabotage_planet_1 }
		event_target:sabotage_planet_1 = {
			set_planet_flag = sabotage_planet@root.owner
		}
		set_espionage_operation_progress_locked = no
	}
	
	option = {
		name = diplospy.140.b
		trigger = { exists = event_target:sabotage_planet_2 }
		event_target:sabotage_planet_2 = {
			set_planet_flag = sabotage_planet@root.owner
		}
		set_espionage_operation_progress_locked = no
	}
	
	option = {
		name = diplospy.140.c
		trigger = { exists = event_target:sabotage_planet_3 }
		event_target:sabotage_planet_3 = {
			set_planet_flag = sabotage_planet@root.owner
		}
		set_espionage_operation_progress_locked = no
	}
	
	option = {
		name = UNFORTUNATE
		trigger = { NOT = { exists = event_target:sabotage_planet_1 } }
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

espionage_operation_event = {
	id = diplospy.141
	title = operation.2001.name
	desc = {
        text = diplospy.141.desc.vocation
        trigger = {
            target = {
                NOR = {
					has_hostile_espionage_operation_ethics = yes
					has_closed_borders = root.owner
					is_at_war_with = root.owner
				}
            }
        }
    }
    desc = {
        trigger = {
            target = {
                OR = {
					has_hostile_espionage_operation_ethics = yes
					has_closed_borders = root.owner
					is_at_war_with = root.owner
				}
            }
        }
        text = diplospy.141.desc.cover
    }
	picture = GFX_evt_colony_settlement
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		target = {
			random_owned_planet = {
				limit = { has_planet_flag = sabotage_planet@root.owner }
				save_event_target_as = sabotage_planet_target
			}
		}
		if = {
			limit = {
				OR = {
					NOT = { exists = event_target:sabotage_planet_target }
					event_target:sabotage_planet_target = { has_modifier = industrial_sabotage }
					event_target:sabotage_planet_target = { is_colony = no } # make sure it's not blown up or abandoned
				}
			}
			set_espionage_operation_progress_locked = yes
			owner = { country_event = { id = diplospy.143 } }
		}
	}

	option = {
		name = ACKNOWLEDGED
	}
}

espionage_operation_event = {
	id = diplospy.142
	title = operation.2002.name
	desc = {
        text = diplospy.142.desc.vocation
        trigger = {
            target = {
                NOR = {
					has_hostile_espionage_operation_ethics = yes
					has_closed_borders = root.owner
					is_at_war_with = root.owner
				}
            }
        }
    }
    desc = {
        trigger = {
            target = {
                OR = {
					has_hostile_espionage_operation_ethics = yes
					has_closed_borders = root.owner
					is_at_war_with = root.owner
				}
            }
        }
        text = diplospy.142.desc.cover
    }
	picture = GFX_evt_colony_settlement
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		set_espionage_operation_progress_locked = yes
		target = {
			random_owned_planet = {
				limit = { has_planet_flag = sabotage_planet@root.owner }
				save_event_target_as = sabotage_planet_target
			}
		}
		if = {
			limit = {
				OR = {
					NOT = { exists = event_target:sabotage_planet_target }
					event_target:sabotage_planet_target = { has_modifier = industrial_sabotage }
					event_target:sabotage_planet_target = { is_colony = no } # make sure it's not blown up or abandoned
				}
			}
			owner = { country_event = { id = diplospy.143 } }
		}
	}
	
	after = {
        set_espionage_operation_progress_locked = no
		hidden_effect = {
			target = { save_event_target_as = sabotaged_planet_owner }
			owner = { country_event = { id = diplospy.144 } }
		}
    }

	option = {
		name = LAUNCH_OPERATION
	}
}

# invalid target
country_event = {
    id = diplospy.143
    title = diplospy.143.name
    desc = diplospy.143.desc
    picture = GFX_evt_colony_settlement
    show_sound = event_default
    is_triggered_only = yes
	
	immediate = {
		from = { set_espionage_operation_progress_locked = yes }
	}
	
	after = {
		if = {
			limit = { exists = event_target:sabotage_planet_target }
			event_target:sabotage_planet_target = { remove_planet_flag = sabotage_planet@root }
		}
		from = { set_espionage_operation_progress_locked = no }
		destroy_espionage_operation = from
	}

    trigger = {
        exists = from
    }

    option = {
		name = UNFORTUNATE
		
    }
}

# Final | from = operation
country_event = {
    id = diplospy.144
    title = diplospy.144.name
    desc = diplospy.144.desc
    location = event_target:sabotage_planet_target
    picture = GFX_evt_night_raid
    show_sound = event_espionage_concluded
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        #Bonus actions
        if = {
            limit = {
                from = { has_espionage_asset_sabotage = yes }
            }
            random_list = {
                 1 = { #Collateral damage (devastation)
                    modifier = {
                        factor = 6
                        from = { has_espionage_asset_military = yes }
                    }
                    set_country_flag = sabotage_industry_collateral@from.target
                }
				1 = { #Collateral damage (blockers)
                    modifier = {
                        factor = 6
                        from = { has_espionage_asset_government = yes }
                    }
					modifier = {
                        factor = 0
                        event_target:sabotage_planet_target = { free_district_slots < 2 }
                    }
                    set_country_flag = sabotage_industry_blocker@from.target
                }
				1 = { #Earn Energy
                    modifier = {
                        factor = 6
                        from = { has_espionage_asset_economy = yes }
                    }
					modifier = {
                        factor = 0
                        from = { NOT = { has_espionage_asset_economy = yes } }
                    }
                    set_country_flag = sabotage_industry_profit@from.target
                }
				1 = { #Recover Secrets
                    modifier = {
                        factor = 6
                        from = { has_espionage_asset_technology = yes }
                    }
                    set_country_flag = sabotage_industry_research@from.target
                }
                6 = {
                    modifier = {
                        factor = 2.5
                        root = {
                            relative_encryption_decryption = { target = from.target value < 0.6 }
                        }
                    }
                    #No bonus action
                }
            }
        }
    }

    option = { #We're done here (smooth)
        name = operation.2005.a
        trigger = {
            from.target = {
                NOR = {
                    has_hostile_espionage_operation_ethics = yes
                    has_closed_borders = root
                    is_at_war_with = root
                }
            }
        }
        from.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -30 }
        }
    }
    option = { #We're done here (messy)
        name = operation.2005.a
        trigger = {
            from.target = {
                OR = {
                    has_hostile_espionage_operation_ethics = yes
                    has_closed_borders = root
                    is_at_war_with = root
                }
            }
        }
        from.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
    }
    option = { #Collateral damage (devastation)
        name = diplospy.144.b
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
        trigger = {
            has_country_flag = sabotage_industry_collateral@from.target
        }
		allow = { resource_stockpile_compare = { resource = volatile_motes value >= 2 } }
		from.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
		add_resource = { volatile_motes = -2 }
        hidden_effect = {
            remove_country_flag = sabotage_industry_collateral@from.target
        }
        event_target:sabotage_planet_target = {
			add_planet_devastation = 25
		}
    }
	option = { #Collateral damage (blockers)
        name = diplospy.144.b
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
        trigger = {
            has_country_flag = sabotage_industry_blocker@from.target
        }
		allow = { resource_stockpile_compare = { resource = volatile_motes value >= 2 } }
		from.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
		add_resource = { volatile_motes = -2 }
        hidden_effect = {
            remove_country_flag = sabotage_industry_blocker@from.target
        }
        event_target:sabotage_planet_target = {
			add_deposit = d_failing_infrastructure
			add_deposit = d_failing_infrastructure
			add_planet_devastation = 10
		}
    }
	option = { #Earn energy
        name = diplospy.144.c
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
        trigger = {
            has_country_flag = sabotage_industry_profit@from.target
        }
		from.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
		from = { destroy_espionage_asset_economy = yes }
		if = {
			limit = { event_target:sabotage_planet_target = { num_pops < 25 } }
			add_resource = { energy = 1000 }
		}
		else_if = {
			limit = { event_target:sabotage_planet_target = { num_pops < 50 } }
			add_resource = { energy = 2000 }
		}
		else = {
			add_resource = { energy = 3000 }
		}
        hidden_effect = {
            remove_country_flag = sabotage_industry_profit@from.target
        }
    }
	option = { #Recover Secrets
        name = diplospy.144.d
        icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
        trigger = {
            has_country_flag = sabotage_industry_research@from.target
        }
		from.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
		from = { destroy_espionage_asset_technology = yes }
		add_monthly_resource_mult = {
			resource = engineering_research
			value = @tier4researchreward
			min = @tier4researchmin
			max = @tier4researchmax
		}
        hidden_effect = {
			remove_country_flag = sabotage_industry_research@from.target
        }
    }

    after = {
		event_target:sabotage_planet_target = {
			add_planet_devastation = 25
			add_modifier = { modifier = industrial_sabotage days = @StealTechnologyTimer }
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
        hidden_effect = {
            from.target = {
				country_event = { id = diplospy.145 } #Notification of sabotage
            }
        }
        destroy_espionage_operation = from
    }
}

# Planet sabotaged! (victim) | from = instigating country | event_target:sabotage_planet_target = planet
country_event = {
    id = diplospy.145
    title = diplospy.144.name
    desc = {
        text = diplospy.145.desc.phobe
        trigger = {
            is_xenophobe = yes
        }
    }
    desc = {
        text = diplospy.145.desc.regular
        trigger = {
            is_xenophobe = no
            is_gestalt = no
        }
    }
    desc = {
        text = diplospy.145.desc.gestalt
        trigger = {
            is_gestalt = yes
        }
    }
    picture = GFX_evt_burning_settlement
    show_sound = event_default
    is_triggered_only = yes
    location = event_target:sabotage_planet_target

    trigger = {
        exists = from
        exists = event_target:sabotage_planet_target
    }

    immediate = {
        random_list = {
            1 = { #Saboteurs caught
                modifier = {
                    factor = 0
                    OR = {
                        NOT = {
                            any_spynetwork = {
                                owner = { is_same_value = root }
                                target = { is_same_value = from }
                            }
                        }
                        has_country_flag = recently_received_espionage_asset
                    }
                }
                modifier = {
                    factor = 3
                    relative_encryption_decryption = { target = from value > 0.8 }
                    relative_encryption_decryption = { target = from value < 1.6 }
                }
                modifier = {
                    factor = 10
                    relative_encryption_decryption = { target = from value >= 1.6 }
                }
                set_timed_country_flag = {
                    flag = espionage_caught_saboteurs
                    days = 20
                }
                if = {
                    limit = {
                        any_spynetwork = {
                            owner = { is_same_value = root }
                            target = { is_same_value = from }
                            is_spynetwork_level > 5
                        }
                        NOT = { has_country_flag = recently_received_espionage_asset }
                    }
                    country_event = { #A Surprise Catch (asset granted)
                        id = espionage.1040
                        days = 15
                        scopes = { from = fromfrom }
                    }
                }
            }
            9 = { } #Nothing
        }
    }
	
	immediate = {
		every_owned_planet = {
			remove_planet_flag = sabotage_planet@from
		}
	}

    option = {
        name = {
            text = APPALLING
            trigger = {
                OR = {
                    is_xenophobe = yes
                    is_gestalt = yes
                }
            }
        }
        name = {
            text = CURSES
            trigger = {
                NOT = {
                    OR = {
                        is_xenophobe = yes
                        is_gestalt = yes
                    }
                }
            }
        }
    }
}

################################
# MANIPULATION: ANTI-WAR
################################

espionage_operation_event = {
	id = diplospy.150
	title = operation.6000.name #Infiltration Begins
	desc = {
        text = diplospy.150.desc.reg
        trigger = {
			target = {
				NOR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
				is_gestalt = no
			}
        }
    }
	desc = {
        text = diplospy.150.desc.hive
        trigger = {
			target = {
				NOR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
				is_hive_empire = yes
			}
        }
    }
	desc = {
        text = diplospy.150.desc.mach
        trigger = {
			target = {
				NOR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
				is_machine_empire = yes
			}
        }
    }
    desc = {
        text = diplospy.150.desc.invalid
        trigger = {
            target = {
				OR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
			}
        }
    }
	picture = GFX_evt_spy_network
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				target = {
					OR = {
						has_modifier = anti_war_sentiments
						is_at_war = no
					}
				}
			}
			set_espionage_operation_progress_locked = yes
		}
	}

	option = {
		name = ACKNOWLEDGED
		trigger = {
			target = {
				NOR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
			}
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			target = {
				OR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

espionage_operation_event = {
	id = diplospy.151
	title = diplospy.151.name
	desc = {
        text = diplospy.151.desc.reg.protest
        trigger = {
			target = {
				NOR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
				is_gestalt = no
				is_homicidal = no
				any_war = {
					any_attacker = { is_same_value = root.target }
				}
			}
        }
    }
	desc = {
        text = diplospy.151.desc.reg.gov
        trigger = {
			target = {
				NOR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
				is_gestalt = no
			}
        }
    }
    desc = {
        text = diplospy.151.desc.hive
        trigger = {
			target = {
				NOR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
				is_hive_empire = yes
			}
        }
    }
	desc = {
        text = diplospy.151.desc.mach
        trigger = {
			target = {
				NOR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
				is_machine_empire = yes
			}
        }
    }
    desc = {
        text = diplospy.150.desc.invalid
		trigger = {
            target = {
				OR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
			}
        }
    }
	picture = {
		trigger = { 
			root.target = {
				NOT = { is_gestalt = yes }
			}
		}
		picture = GFX_evt_dark_alley
	}
	picture = {
		trigger = { 
			root.target = { is_hive_empire = yes }
		}
		picture = GFX_evt_hive_mind
	}
	picture = {
		trigger = { 
			root.target = { is_machine_empire = yes }
		}
		picture = GFX_evt_glitchy_matrix
	}
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		set_espionage_operation_progress_locked = yes
	}

	option = {
		trigger = {
			target = {
				NOR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
			}
		}
		name = PROCEED
		hidden_effect = {
			owner = { country_event = { id = diplospy.152 days = 60 random = 60 } }
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			target = {
				OR = {
					has_modifier = anti_war_sentiments
					is_at_war = no
				}
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

# Final setup | from = operation
country_event = {
    id = diplospy.152
    hide_window = yes
    is_triggered_only = yes

    immediate = {
		if = {
			limit = {
				from.target = {
					OR = {
						has_modifier = anti_war_sentiments
						is_at_war = no
					}
				}
			}
			country_event = { id = diplospy.154 }
		}
		else = {
			random_list = {
				3 = {
					modifier = {
						factor = 2
						root = {
							relative_encryption_decryption = {
								target = from.target
								value > 1.4
							}
						}
					}
					modifier = {
						factor = 3
						from = {
							has_espionage_asset_military = yes
						}
					}
					modifier = {
						factor = 2
						from.target = {
							NOR = {
								has_hostile_espionage_operation_ethics = yes
								has_closed_borders = root
								is_at_war_with = root
							}
						}
					}
					from = { set_espionage_operation_flag = smooth_exit }
				}
				3 = {
					modifier = {
						factor = 0.3
						from = {
							OR = {
								has_espionage_asset_military = yes
								has_espionage_asset_subterfuge = yes
								has_espionage_asset_criminal = yes
							}
						}
					}
					modifier = {
						factor = 2
							from.target = {
							OR = {
								is_militarist = yes
								is_xenophobe = yes
								is_homicidal = yes
								is_civic_militarist = yes
								is_xenophobic_isolationists = yes
							}
						}
					}
					modifier = {
						factor = 0.5
						from.target = {
							OR = {
								AND = {
									is_xenophobe = no
									is_pacifist = yes
								}
								is_open_gestalt = yes
								is_civic_machine_servitor = yes
							}
						}
					}
					modifier = {
						factor = 2
						from.target = {
							OR = {
								has_hostile_espionage_operation_ethics = yes
								has_closed_borders = root
								is_at_war_with = root
							}
						}
					}
					#'Messy' exit (no flag needed)
				}
			}
			country_event = { id = diplospy.153 }
		}
    }
}

# Final | fromfrom = operation
country_event = {
	id = diplospy.153
	title = diplospy.153.name
    desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = smooth_exit
            }
			fromfrom.target = {
				is_gestalt = no
			}
        }
        text = diplospy.153.desc.smooth.reg
    }
	desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = smooth_exit
            }
			fromfrom.target = {
				is_hive_empire = yes
			}
        }
        text = diplospy.153.desc.smooth.hive
    }
	desc = {
        trigger = {
			fromfrom = {
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
			fromfrom.target = {
				is_machine_empire = yes
			}
        }
        text = diplospy.153.desc.smooth.mach
    }
	desc = {
        trigger = {
			fromfrom = {
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
			fromfrom.target = {
				is_gestalt = no
			}
        }
        text = diplospy.153.desc.messy.reg
    }
	desc = {
        trigger = {
			fromfrom = {
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
			fromfrom.target = {
				is_hive_empire = yes
			}
        }
        text = diplospy.153.desc.messy.hive
        text = diplospy.153.desc.messy.hive.2
    }
	desc = {
        trigger = {
			fromfrom = {
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
			fromfrom.target = {
				is_machine_empire = yes
			}
        }
        text = diplospy.153.desc.messy.mach
    }
	picture = {
		trigger = { 
			fromfrom.target = {
				NOT = { is_gestalt = yes }
			}
		}
		picture = GFX_evt_alien_propaganda
	}
	picture = {
		trigger = { 
			fromfrom.target = { is_hive_empire = yes }
		}
		picture = GFX_evt_hive_mind
	}
	picture = {
		trigger = { 
			fromfrom.target = { is_machine_empire = yes }
		}
		picture = GFX_evt_glitchy_matrix
	}
    show_sound = event_espionage_concluded
	
	is_triggered_only = yes
	
	trigger = {
        exists = fromfrom
    }
	
	immediate = {
    }
	
	option = {
		name = EXCELLENT
		trigger = {
            fromfrom = { has_espionage_operation_flag = smooth_exit }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -15 }
        }
		fromfrom.target = {
			add_modifier = { modifier = anti_war_sentiments days = 3600 }
			set_saved_date = {
				key = anti_war_sentiments
				days_from_present = 3600
				expires = 3600
			}
		}
	}
	option = {
		name = operation.8002.b
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            fromfrom = {
				has_espionage_operation_flag = smooth_exit
				OR = {
					has_espionage_asset_manipulation = yes
					has_espionage_asset_military = yes
				}
			}
        }
		fromfrom = {
			if = {
				limit = { has_espionage_asset_manipulation = yes }
				destroy_espionage_asset_manipulation = yes
			}
			else = {
				destroy_espionage_asset_military = yes
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -30 }
        }
		fromfrom.target = {
			add_modifier = { modifier = anti_war_sentiments days = 3600 }
			if = {
				limit = { is_gestalt = no }
				add_modifier = { modifier = anti_war_unhappiness days = 1800 }
			}
			else = {
				add_modifier = { modifier = anti_war_deviance days = 1800 }
			}
		}
	}
	option = {
		name = OK
		trigger = {
            fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -30 }
        }
		fromfrom.target = {
			add_modifier = { modifier = anti_war_sentiments days = 1800 }
		}
	}
	after = {
		hidden_effect = {
			fromfrom.target = {
				country_event = { id = diplospy.155 }
			}
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
        destroy_espionage_operation = fromfrom
    }
}

# invalid target
country_event = {
    id = diplospy.154
    title = diplospy.154.name
    desc = diplospy.154.desc
    picture = GFX_evt_colony_settlement
    show_sound = event_default
    is_triggered_only = yes
	
	immediate = {
	}
	
	after = {
		fromfrom = { set_espionage_operation_progress_locked = no }
		destroy_espionage_operation = fromfrom
	}

    trigger = {
        exists = fromfrom
    }

    option = {
		name = UNFORTUNATE
		
    }
}

# War effort sabotaged! (victim) | from = instigating country
country_event = {
    id = diplospy.155
    title = diplospy.155.name
    desc = {
        text = diplospy.155.desc.reg
        trigger = {
            is_gestalt = no
        }
    }
    desc = {
        text = diplospy.155.desc.hive
        trigger = {
            is_hive_empire = yes
        }
    }
    desc = {
        text = diplospy.155.desc.mach
        trigger = {
            is_machine_empire = yes
        }
    }
    picture = {
		trigger = { 
			NOT = { is_gestalt = yes }
		}
		picture = GFX_evt_alien_propaganda
	}
	picture = {
		trigger = { 
			is_hive_empire = yes
		}
		picture = GFX_evt_hive_mind
	}
	picture = {
		trigger = { 
			is_machine_empire = yes
		}
		picture = GFX_evt_glitchy_matrix
	}
    show_sound = event_default
    is_triggered_only = yes

    trigger = {
        exists = from
    }

    immediate = {
        random_list = {
            1 = { #Saboteurs caught
                modifier = {
                    factor = 0
                    OR = {
                        NOT = {
                            any_spynetwork = {
                                owner = { is_same_value = root }
                                target = { is_same_value = from }
                            }
                        }
                        has_country_flag = recently_received_espionage_asset
                    }
                }
                modifier = {
                    factor = 3
                    relative_encryption_decryption = { target = from value > 0.8 }
                    relative_encryption_decryption = { target = from value < 1.6 }
                }
                modifier = {
                    factor = 10
                    relative_encryption_decryption = { target = from value >= 1.6 }
                }
                set_timed_country_flag = {
                    flag = espionage_caught_spies
                    days = 20
                }
                if = {
                    limit = {
                        any_spynetwork = {
                            owner = { is_same_value = root }
                            target = { is_same_value = from }
                            is_spynetwork_level > 5
                        }
                        NOT = { has_country_flag = recently_received_espionage_asset }
                    }
                    country_event = { #A Surprise Catch (asset granted)
                        id = espionage.1040
                        days = 15
                        scopes = { from = fromfrom }
                    }
                }
            }
            9 = { } #Nothing
        }
    }
	
	immediate = {
	}

    option = {
		tooltip = { add_modifier = { modifier = anti_war_sentiments days = 3600 } }
        name = {
            text = APPALLING
            trigger = {
                OR = {
                    is_xenophobe = yes
                    is_gestalt = yes
                }
            }
        }
        name = {
            text = CURSES
            trigger = {
                NOT = {
                    OR = {
                        is_xenophobe = yes
                        is_gestalt = yes
                    }
                }
            }
        }
    }
}

################################
# MANIPULATION: FOMENT REBELLION
################################
espionage_operation_event = {
	id = diplospy.160
	title = operation.4000.name
	desc = {
        text = diplospy.160.desc
        trigger = {
			exists = event_target:rebel_planet_1
			exists = event_target:rebel_planet_2
        }
    }
	desc = {
        text = diplospy.160.desc.single
        trigger = {
			exists = event_target:rebel_planet_1
			NOT = { exists = event_target:rebel_planet_2 }
        }
    }
    desc = {
        text = diplospy.150.desc.invalid
        trigger = {
            NOT = { exists = event_target:rebel_planet_1 }
        }
    }
	picture = GFX_evt_spy_network
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		set_espionage_operation_progress_locked = yes
		while = {
			count = 3
			target = {
				random_owned_planet = {
					limit = {
						NOT = { has_modifier = foment_rebellion }
						NOT = { has_modifier = foment_rebellion_more }
						NOT = { has_modifier = foment_rebellion_poor }
						NOR = {
                            AND = {
                                exists = event_target:rebel_planet_1
                                is_same_value = event_target:rebel_planet_1
                            }
                            AND = {
                                exists = event_target:rebel_planet_2
                                is_same_value = event_target:rebel_planet_2
                            }
                            AND = {
                                exists = event_target:rebel_planet_3
                                is_same_value = event_target:rebel_planet_3
                            }
                        }
					}
					weights = {
						base = 1
						modifier = {
							factor = 0.5
							OR = {
								planet_stability > 90
							}
						}
						modifier = {
							factor = 0.5
							OR = {
								planet_stability > 80
							}
						}
						modifier = {
							factor = 0.5
							OR = {
								planet_stability > 70
							}
						}
						modifier = {
							add = 5
							OR = {
								planet_stability < 50
							}
						}
						modifier = {
							add = 7.5
							OR = {
								planet_stability < 40
							}
						}
						modifier = {
							add = 10
							OR = {
								planet_stability < 30
							}
						}
						modifier = {
							add = 10
							OR = {
								planet_stability < 20
							}
						}
					}
					if = {
                        limit = { NOT = { exists = event_target:rebel_planet_1 } }
                        save_event_target_as = rebel_planet_1
                    }
                    else_if = {
                        limit = { NOT = { exists = event_target:rebel_planet_2 } }
                        save_event_target_as = rebel_planet_2
                    }
                    else_if = {
                        limit = { NOT = { exists = event_target:rebel_planet_3 } }
                        save_event_target_as = rebel_planet_3
                    }
				}
			}
		}
	}
	
	after = {
		set_espionage_operation_progress_locked = no
	}

	option = {
		name = ACKNOWLEDGED
		trigger = {
			exists = event_target:rebel_planet_1
			NOT = { exists = event_target:rebel_planet_2 }
		}
		event_target:rebel_planet_1 = { set_planet_flag = rebel_planet@root.owner }
	}
	option = {
		name = diplospy.160.a
		trigger = {
			exists = event_target:rebel_planet_1
			exists = event_target:rebel_planet_2
		}
		event_target:rebel_planet_1 = { set_planet_flag = rebel_planet@root.owner }
	}
	option = {
		name = diplospy.160.b
		trigger = {
			exists = event_target:rebel_planet_2
		}
		event_target:rebel_planet_2 = { set_planet_flag = rebel_planet@root.owner }
	}
	option = {
		name = diplospy.160.c
		trigger = {
			exists = event_target:rebel_planet_3
		}
		event_target:rebel_planet_3 = { set_planet_flag = rebel_planet@root.owner }
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			NOT = { exists = event_target:rebel_planet_1 }
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

espionage_operation_event = {
	id = diplospy.161
	title = diplospy.161.name
	desc = {
        text = diplospy.161.desc.reg
        trigger = {
			exists = event_target:rebel_planet_target
			event_target:rebel_planet_target = {
				NOR = {
					has_modifier = foment_rebellion
					has_modifier = foment_rebellion_more
					has_modifier = foment_rebellion_poor
				}
			}
			target = { is_gestalt = no }
        }
    }
	desc = {
        text = diplospy.161.desc.ges
        trigger = {
			exists = event_target:rebel_planet_target
			event_target:rebel_planet_target = {
				NOR = {
					has_modifier = foment_rebellion
					has_modifier = foment_rebellion_more
					has_modifier = foment_rebellion_poor
				}
			}
			target = { is_gestalt = yes }
        }
    }
	desc = {
        text = diplospy.161.desc.underclass
        trigger = {
			exists = event_target:rebel_planet_target
			event_target:rebel_planet_target = {
				NOR = {
					has_modifier = foment_rebellion
					has_modifier = foment_rebellion_more
					has_modifier = foment_rebellion_poor
				}
				count_owned_pop = {
					limit = {
						OR = {
							is_enslaved = yes
							is_being_purged = yes
							has_living_standard = { type = living_standard_subsistence country = root.target }
							AND = {
								has_living_standard = { type = living_standard_stratified country = root.target }
								is_pop_category = worker
							}
							AND = {
								has_living_standard = { type = living_standard_dystopian_society country = root.target }
								NOT = { is_pop_category = ruler }
							}
						}
					}
					count > 5
				}
			}
        }
    }
	desc = {
        text = diplospy.161.desc.stability
        trigger = {
			exists = event_target:rebel_planet_target
			event_target:rebel_planet_target = {
				NOR = {
					has_modifier = foment_rebellion
					has_modifier = foment_rebellion_more
					has_modifier = foment_rebellion_poor
				}
				planet_stability < 35
			}
        }
    }
	desc = {
        text = diplospy.161.desc.crime.reg
        trigger = {
			exists = event_target:rebel_planet_target
			event_target:rebel_planet_target = {
				NOR = {
					has_modifier = foment_rebellion
					has_modifier = foment_rebellion_more
					has_modifier = foment_rebellion_poor
				}
				planet_crime > 50
			}
			target = { is_gestalt = no }
        }
    }
	desc = {
        text = diplospy.161.desc.crime.ges
        trigger = {
			exists = event_target:rebel_planet_target
			event_target:rebel_planet_target = {
				NOR = {
					has_modifier = foment_rebellion
					has_modifier = foment_rebellion_more
					has_modifier = foment_rebellion_poor
				}
				planet_crime > 50
			}
			target = { is_gestalt = yes }
        }
    }
	desc = {
        text = diplospy.150.desc.invalid
        trigger = {
			OR = {
				NOT = { exists = event_target:rebel_planet_target }
				event_target:rebel_planet_target = {
					OR = {
						has_modifier = foment_rebellion
						has_modifier = foment_rebellion_more
						has_modifier = foment_rebellion_poor
					}
				}
			}
        }
    }
	picture = {
		trigger = { 
			fromfrom.target = {
				NOT = { is_gestalt = yes }
			}
		}
		picture = GFX_evt_alien_propaganda
	}
	picture = {
		trigger = { 
			fromfrom.target = { is_hive_empire = yes }
		}
		picture = GFX_evt_hive_mind
	}
	picture = {
		trigger = { 
			fromfrom.target = { is_machine_empire = yes }
		}
		picture = GFX_evt_glitchy_matrix
	}
	show_sound = event_encrypted_comms
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		target = {
			random_owned_planet = {
				limit = { has_planet_flag = rebel_planet@root.owner }
				save_event_target_as = rebel_planet_target
			}
		}
		if = {
			limit = {
				OR = {
					NOT = { exists = event_target:rebel_planet_target }
					event_target:rebel_planet_target = {
						OR = {
							has_modifier = foment_rebellion
							has_modifier = foment_rebellion_more
							has_modifier = foment_rebellion_poor
						}
					}
				}
			}
			set_espionage_operation_progress_locked = yes
		}
	}

	option = {
		name = ACKNOWLEDGED
		trigger = {
			exists = event_target:rebel_planet_target
			event_target:rebel_planet_target = {
				NOR = {
					has_modifier = foment_rebellion
					has_modifier = foment_rebellion_more
					has_modifier = foment_rebellion_poor
				}
			}
        }
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			OR = {
				NOT = { exists = event_target:rebel_planet_target }
				event_target:rebel_planet_target = {
					OR = {
						has_modifier = foment_rebellion
						has_modifier = foment_rebellion_more
						has_modifier = foment_rebellion_poor
					}
				}
			}
		}
		hidden_effect = {
			event_target:rebel_planet_target = { remove_planet_flag = rebel_planet@root.owner }
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

espionage_operation_event = {
	id = diplospy.162
	title = diplospy.162.name
	desc = {
        text = diplospy.162.desc
        trigger = {
			exists = event_target:rebel_planet_target
			event_target:rebel_planet_target = {
				NOR = {
					has_modifier = foment_rebellion
					has_modifier = foment_rebellion_more
					has_modifier = foment_rebellion_poor
				}
			}
        }
    }
	desc = {
        text = diplospy.150.desc.invalid
        trigger = {
			OR = {
				NOT = { exists = event_target:rebel_planet_target }
				event_target:rebel_planet_target = {
					OR = {
						has_modifier = foment_rebellion
						has_modifier = foment_rebellion_more
						has_modifier = foment_rebellion_poor
					}
				}
			}
        }
    }
	picture = GFX_evt_conclave
	show_sound = event_mystic_reveal
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		target = {
			random_owned_planet = {
				limit = { has_planet_flag = rebel_planet@root.owner }
				save_event_target_as = rebel_planet_target
			}
		}
		if = {
			limit = {
				OR = {
					NOT = { exists = event_target:rebel_planet_target }
					event_target:rebel_planet_target = {
						OR = {
							has_modifier = foment_rebellion
							has_modifier = foment_rebellion_more
							has_modifier = foment_rebellion_poor
						}
					}
				}
			}
			set_espionage_operation_progress_locked = yes
		}
	}

	option = {
		name = PROCEED
		trigger = {
			exists = event_target:rebel_planet_target
			event_target:rebel_planet_target = {
				NOR = {
					has_modifier = foment_rebellion
					has_modifier = foment_rebellion_more
					has_modifier = foment_rebellion_poor
				}
			}
        }
		hidden_effect = {
			owner = { country_event = { id = diplospy.163 days = 60 random = 60 } }
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			OR = {
				NOT = { exists = event_target:rebel_planet_target }
				event_target:rebel_planet_target = {
					OR = {
						has_modifier = foment_rebellion
						has_modifier = foment_rebellion_more
						has_modifier = foment_rebellion_poor
					}
				}
			}
		}
		set_espionage_operation_progress_locked = no
		hidden_effect = {
			event_target:rebel_planet_target = { remove_planet_flag = rebel_planet@root.owner }
		}
		root = {
            destroy_espionage_operation = this
        }
	}
}

# Final setup | from = operation
country_event = {
    id = diplospy.163
    hide_window = yes
    is_triggered_only = yes

    immediate = {
		if = {
			limit = {
				OR = {
					NOT = { exists = event_target:rebel_planet_target }
					event_target:rebel_planet_target = {
						OR = {
							has_modifier = foment_rebellion
							has_modifier = foment_rebellion_more
							has_modifier = foment_rebellion_poor
						}
					}
				}
			}
			event_target:rebel_planet_target = { remove_planet_flag = rebel_planet@root.owner }
			country_event = { id = diplospy.154 }
		}
		else = {
			random_list = {
				3 = {
					modifier = {
						factor = 2
						root = {
							relative_encryption_decryption = {
								target = from.target
								value > 1.4
							}
						}
					}
					modifier = {
						factor = 3
						from = {
							has_espionage_asset_manipulation = yes
						}
					}
					modifier = {
						factor = 2
						event_target:rebel_planet_target = {
							count_owned_pop = {
								limit = {
									OR = {
										is_enslaved = yes
										is_being_purged = yes
										has_living_standard = { type = living_standard_subsistence country = root.target }
										AND = {
											has_living_standard = { type = living_standard_stratified country = root.target }
											is_pop_category = worker
										}
										AND = {
											has_living_standard = { type = living_standard_dystopian_society country = root.target }
											NOT = { is_pop_category = ruler }
										}
									}
								}
								count > 5
							}
						}
					}
					modifier = {
						factor = 2
						event_target:rebel_planet_target = {
							planet_stability < 35
						}
					}
					from = { set_espionage_operation_flag = smooth_exit }
					event_target:rebel_planet_target = { set_timed_planet_flag = { flag = foment_rebellion_smooth days = @StealTechnologyTimer } }
				}
				3 = {
					modifier = {
						factor = 0.3
						from = {
							OR = {
								has_espionage_asset_government = yes
								has_espionage_asset_manipulation = yes
								has_espionage_asset_criminal = yes
							}
						}
					}
					modifier = {
						factor = 2
							from.target = {
							OR = {
								is_civic_police_state = yes
								is_inwards_perfection_empire = yes
								is_pompous_empire = yes
								is_homicidal = yes
								has_policy_flag = state_media
								has_policy_flag = corporate_media
							}
						}
					}
					modifier = {
						factor = 0.5
						from.target = {
							OR = {
								is_civic_cutthroat_politics = yes
								is_open_gestalt = yes
								has_policy_flag = free_press
							}
						}
					}
					modifier = {
						factor = 2
						event_target:rebel_planet_target = {
							planet_stability > 50
						}
					}
					modifier = {
						factor = 3
						event_target:rebel_planet_target = {
							planet_stability > 65
						}
					}
					modifier = {
						factor = 3
						event_target:rebel_planet_target = {
							planet_stability > 75
						}
					}
					modifier = {
						factor = 3
						event_target:rebel_planet_target = {
							planet_stability > 85
						}
					}
					#'Messy' exit (no flag needed)
				}
			}
			country_event = { id = diplospy.164 }
		}
    }
}

# Final | fromfrom = operation
country_event = {
	id = diplospy.164
	title = diplospy.153.name
    desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = smooth_exit
            }
			fromfrom.target = {
				is_gestalt = no
			}
        }
        text = diplospy.164.desc.smooth.reg
    }
	desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = smooth_exit
            }
			fromfrom.target = {
				is_gestalt = yes
			}
        }
        text = diplospy.164.desc.smooth.ges
    }
	desc = {
        trigger = {
			fromfrom = {
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
			fromfrom.target = {
				is_gestalt = no
			}
        }
        text = diplospy.164.desc.messy.reg
    }
	desc = {
        trigger = {
			fromfrom = {
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
			fromfrom.target = {
				is_gestalt = yes
			}
        }
        text = diplospy.164.desc.messy.ges
    }
	picture = {
		trigger = { 
			fromfrom.target = {
				NOT = { is_gestalt = yes }
			}
		}
		picture = GFX_evt_alien_propaganda
	}
	picture = {
		trigger = { 
			fromfrom.target = { is_hive_empire = yes }
		}
		picture = GFX_evt_hive_mind
	}
	picture = {
		trigger = { 
			fromfrom.target = { is_machine_empire = yes }
		}
		picture = GFX_evt_glitchy_matrix
	}
    show_sound = event_espionage_concluded
	
	is_triggered_only = yes
	
	trigger = {
        exists = fromfrom
    }
	
	immediate = {
    }
	
	option = {
		name = EXCELLENT
		trigger = {
            fromfrom = { has_espionage_operation_flag = smooth_exit }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
		event_target:rebel_planet_target = {
			add_modifier = { modifier = foment_rebellion days = 7200 }
		}
	}
	option = {
		name = operation.8002.b
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            fromfrom = {
				has_espionage_operation_flag = smooth_exit
				has_espionage_asset_manipulation = yes
			}
        }
		fromfrom = {
			destroy_espionage_asset_manipulation = yes
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -60 }
        }
		event_target:rebel_planet_target = {
			add_modifier = { modifier = foment_rebellion_more days = 7200 }
		}
	}
	option = {
		name = diplospy.164.c
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            fromfrom = {
				has_espionage_operation_flag = smooth_exit
				OR = {
					has_espionage_asset_government = yes
					has_espionage_asset_military = yes
				}
			}
        }
		allow = {
			custom_tooltip = {
				fromfrom.target = {
					any_owned_planet = {
						planet_stability < 60
						NOR = {
							has_modifier = foment_rebellion
							has_modifier = foment_rebellion_more
							has_modifier = foment_rebellion_poor
						}
						NOT = { is_same_value = event_target:rebel_planet_target }
					}
				}
				fail_text = diplospy.164.c.fail_text
			}
		}
		fromfrom = {
			if = {
				limit = { has_espionage_asset_government = yes }
				destroy_espionage_asset_government = yes
			}
			else_if = {
				limit = { has_espionage_asset_military = yes }
				destroy_espionage_asset_military = yes
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -60 }
        }
		custom_tooltip = diplospy.164.c.tooltip
		event_target:rebel_planet_target = {
			add_modifier = { modifier = foment_rebellion days = 7200 }
			hidden_effect = {
				set_timed_planet_flag = { flag = foment_rebellion_spread days = @StealTechnologyTimer }
			}
		}
	}
	option = {
		name = OK
		trigger = {
            fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -60 }
        }
		event_target:rebel_planet_target = {
			add_modifier = { modifier = foment_rebellion_poor days = 7200 }
		}
	}
	after = {
		hidden_effect = {
			event_target:rebel_planet_target = {
				planet_event = { id = diplospy.165 }
				remove_planet_flag = rebel_planet@root.owner
			}
			set_timed_country_flag = {
				flag = recent_foment_rebellion@fromfrom.target
				days = @StealTechnologyTimer
			}
			fromfrom.spynetwork = {
				set_saved_date = {
					key = recent_foment_rebellion
					days_from_present = @StealTechnologyTimer
					expires = @StealTechnologyTimer
				}
			}
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
        destroy_espionage_operation = fromfrom
    }
}

planet_event = {
	id = diplospy.165
	title = diplospy.165.name
    desc = {
        trigger = {
			owner = {
				is_gestalt = no
			}
        }
        text = diplospy.165.desc.reg
    }
	desc = {
        trigger = {
			owner = {
				is_gestalt = yes
			}
        }
        text = diplospy.165.desc.ges
    }
	picture = {
		trigger = { 
			fromfrom.target = {
				NOT = { is_gestalt = yes }
			}
		}
		picture = GFX_evt_alien_propaganda
	}
	picture = {
		trigger = { 
			fromfrom.target = { is_hive_empire = yes }
		}
		picture = GFX_evt_hive_mind
	}
	picture = {
		trigger = { 
			fromfrom.target = { is_machine_empire = yes }
		}
		picture = GFX_evt_glitchy_matrix
	}
    show_sound = event_espionage_concluded
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			if = {
				limit = { has_planet_flag = foment_rebellion_smooth }
				planet_event = { id = diplospy.166 days = 360 random = 360 }
				planet_event = { id = diplospy.166 days = 720 random = 360 }
				planet_event = { id = diplospy.166 days = 1080 random = 360 }
				planet_event = { id = diplospy.166 days = 1440 random = 360 }
			}
			else = {
				planet_event = { id = diplospy.166 days = 360 random = 360 }
				planet_event = { id = diplospy.166 days = 1080 random = 360 }
			}
		}
	}
	
	option = {
		name = TERRIBLE
		tooltip = {
			if = {
				limit = { root = { has_modifier = foment_rebellion } }
				add_modifier = { modifier = foment_rebellion days = 7200 }
			}
			else_if = {
				limit = { root = { has_modifier = foment_rebellion_more } }
				add_modifier = { modifier = foment_rebellion_more days = 7200 }
			}
			else_if = {
				limit = { root = { has_modifier = foment_rebellion_poor } }
				add_modifier = { modifier = foment_rebellion_poor days = 7200 }
			}
		}
	}
}

planet_event = {
	id = diplospy.166
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		owner = {
			any_owned_planet = {
				planet_stability < 60
				NOR = {
					has_modifier = foment_rebellion
					has_modifier = foment_rebellion_more
					has_modifier = foment_rebellion_poor
				}
			}
		}
	}
	
	immediate = {
		owner = {
			random_owned_planet = {
				limit = {
					planet_stability < 60
					NOR = {
						has_modifier = foment_rebellion
						has_modifier = foment_rebellion_more
						has_modifier = foment_rebellion_poor
					}
				}
				random_list = {
					1 = {
						planet_event = { id = diplospy.167 }
						modifier = {
							factor = 4
							has_planet_flag = foment_rebellion_spread
						}
						modifier = {
							factor = 2
							planet_stability < 40
						}
						modifier = {
							factor = 3
							planet_stability < 30
						}
					}
					3 = {
						# no spread
					}
				}
			}
		}
	}
}

planet_event = {
	id = diplospy.167
	title = diplospy.167.name
    desc = {
        trigger = {
			owner = {
				is_gestalt = no
			}
        }
        text = diplospy.167.desc.reg
    }
	desc = {
        trigger = {
			owner = {
				is_gestalt = yes
			}
        }
        text = diplospy.167.desc.ges
    }
	picture = {
		trigger = { 
			fromfrom.target = {
				NOT = { is_gestalt = yes }
			}
		}
		picture = GFX_evt_alien_propaganda
	}
	picture = {
		trigger = { 
			fromfrom.target = { is_hive_empire = yes }
		}
		picture = GFX_evt_hive_mind
	}
	picture = {
		trigger = { 
			fromfrom.target = { is_machine_empire = yes }
		}
		picture = GFX_evt_glitchy_matrix
	}
    show_sound = event_espionage_concluded
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { from = { has_modifier = foment_rebellion } }
			add_modifier = { modifier = foment_rebellion days = 7200 }
		}
		else_if = {
			limit = { from = { has_modifier = foment_rebellion_more } }
			add_modifier = { modifier = foment_rebellion_more days = 7200 }
		}
		else_if = {
			limit = { from = { has_modifier = foment_rebellion_poor } }
			add_modifier = { modifier = foment_rebellion_poor days = 7200 }
		}
	}
	
	option = {
		name = TERRIBLE
		tooltip = {
			if = {
				limit = { from = { has_modifier = foment_rebellion } }
				add_modifier = { modifier = foment_rebellion days = 7200 }
			}
			else_if = {
				limit = { from = { has_modifier = foment_rebellion_more } }
				add_modifier = { modifier = foment_rebellion_more days = 7200 }
			}
			else_if = {
				limit = { from = { has_modifier = foment_rebellion_poor } }
				add_modifier = { modifier = foment_rebellion_poor days = 7200 }
			}
		}
	}
}

################################
# SUBTERFUGE: STUDY DEFENSES
################################
espionage_operation_event = {
	id = diplospy.170
	title = operation.1000.name
	desc = {
        text = diplospy.170.desc.friendly
		trigger = {
			target = {
				NOR = {
					has_hostile_espionage_operation_ethics = yes
					has_closed_borders = root.owner
					is_at_war_with = root.owner
				}
			}
		}
    }
	desc = {
        text = diplospy.170.desc.unfriendly
		trigger = {
			target = {
				OR = {
					has_hostile_espionage_operation_ethics = yes
					has_closed_borders = root.owner
					is_at_war_with = root.owner
				}
			}
		}
    }
	picture = GFX_evt_spymaster
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes

	option = {
		name = ACKNOWLEDGED
	}
}
espionage_operation_event = {
	id = diplospy.171
	title = operation.1021.name # Chasing a Lead
	desc = {
        text = diplospy.171.desc.asset.codes
		trigger = {
			target = {
				is_gestalt = no
			}
		}
    }
	desc = {
        text = diplospy.171.desc.asset.officer
		trigger = {
			target = {
				is_gestalt = no
				NOR = {
					has_hostile_espionage_operation_ethics = yes
					has_closed_borders = root.owner
					is_at_war_with = root.owner
				}
			}
		}
    }
	desc = {
        text = diplospy.171.desc.asset.hive
		trigger = {
			target = {
				is_hive_empire = yes
			}
		}
    }
	desc = {
        text = diplospy.171.desc.asset.mach
		trigger = {
			target = {
				is_machine_empire = yes
			}
		}
    }
	desc = diplospy.171.desc.comms
	desc = diplospy.171.desc.hack
	picture = GFX_evt_spy_network
	show_sound = event_encrypted_comms
	espionage_operation = yes

	is_triggered_only = yes

	option = {
		name = ACKNOWLEDGED
	}
}
espionage_operation_event = {
	id = diplospy.172
	title = diplospy.172.name
	desc = {
		text = diplospy.172.desc.smooth
		trigger = { has_espionage_operation_flag = smooth_exit }
	}
	desc = {
		text = diplospy.172.desc.messy
		trigger = { NOT = { has_espionage_operation_flag = smooth_exit } }
	}
	picture = GFX_evt_intelligence_report
	show_sound = event_espionage_concluded
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		set_espionage_operation_progress_locked = yes
		root.target = { save_event_target_as = military_intel_target }
		random_list = {
			3 = {
				modifier = {
					factor = 1.5
					owner = {
						relative_encryption_decryption = {
							target = root.target
							value > 1.4
						}
					}
				}
				modifier = {
					factor = 3
					has_espionage_asset_subterfuge = yes
				}
				set_espionage_operation_flag = smooth_exit
			}
			3 = {
				modifier = {
					factor = 0.3
					OR = {
						has_espionage_asset_military = yes
						has_espionage_asset_subterfuge = yes
						has_espionage_asset_criminal = yes
					}
				}
				modifier = {
					factor = 1.5
					target = {
						OR = {
							has_hostile_espionage_operation_ethics = yes
							has_closed_borders = root.owner
							is_at_war_with = root.owner
						}
					}
				}
				#'Messy' exit (no flag needed)
			}
		}
	}

	option = {
		name = EXCELLENT
		trigger = { has_espionage_operation_flag = smooth_exit }
		spynetwork = {
			add_spy_network_level_on_success_effect = { VALUE = -15 }
        }
	}
	
	option = {
		name = OK
		trigger = { NOT = { has_espionage_operation_flag = smooth_exit } }
		spynetwork = {
			add_spy_network_level_on_success_effect = { VALUE = -25 }
        }
		hidden_effect = {
			owner = { save_event_target_as = target_country }
			target = {
				if = {
					limit = {
						any_spynetwork = {
							owner = { is_same_value = root.owner }
							target = { is_same_value = root.target }
							is_spynetwork_level > 5
						}
						NOT = { has_country_flag = recently_received_espionage_asset }
					}
					set_timed_country_flag = {
						flag = espionage_caught_spies
						days = 20
					}
					country_event = { #A Surprise Catch (asset granted)
						id = espionage.1040
						days = 15
						scopes = { from = event_target:target_country }
					}
				}
			}
		}
	}
	
	option = {
		name = diplospy.172.a
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
			has_espionage_operation_flag = smooth_exit
			has_espionage_asset_military = yes
			owner = {
				NOT = {
					has_intel_level = {
						category = military
						level >= 2
						who = prev.target
					}
				}
			}
		}
		spynetwork = {
			add_spy_network_level_on_success_effect = { VALUE = -25 }
			destroy_espionage_asset_military = yes
        }
		owner = {
			add_intel = { amount = 5 who = prev.target }
			add_intel_report = { category = military level = 3 days = 360 who = prev.target }
		}
	}
	
	after = {
		custom_tooltip = diplospy.172.tooltip
		hidden_effect = {
			owner = {
				set_timed_country_flag = {
					flag = recent_military_intel@event_target:military_intel_target
					days = @StealTechnologyTimer
				}
			}
			spynetwork = {
				set_saved_date = {
					key = recent_military_intel
					days_from_present = @StealTechnologyTimer
					expires = @StealTechnologyTimer
				}
			}
			set_espionage_operation_progress_locked = no
			destroy_espionage_operation = this
		}
	}
}

planet_event = {
	id = diplospy.173
	hide_window = yes
	
	trigger = {
		NOT = { has_modifier = defenses_surveyed }
		FROM = {
			OR = {
				has_country_flag = recent_military_intel@root.owner
				any_relation = {
					is_in_federation_with = FROM
					has_country_flag = recent_military_intel@root.owner
				}
			}
		}
	}

	is_triggered_only = yes
	
	immediate = {
		add_modifier = { modifier = defenses_surveyed days = 360 }
	}
}
planet_event = {
	id = diplospy.174
	hide_window = yes
	
	trigger = {
		FROM = {
			OR = {
				has_country_flag = recent_military_intel@root.owner
				any_relation = {
					is_in_federation_with = FROM
					has_country_flag = recent_military_intel@root.owner
				}
			}
		}
	}

	is_triggered_only = yes
	
	immediate = {
		remove_modifier = defenses_surveyed
		add_modifier = { modifier = defenses_surveyed days = @StealTechnologyTimer }
	}
}

country_event = {
	id = diplospy.175
	hide_window = yes
	
	trigger = {
		FromFrom = { has_modifier = defenses_surveyed }
	}

	is_triggered_only = yes
	
	immediate = {
		FromFrom = { remove_modifier = defenses_surveyed }
	}
}

################################
# SABOTAGE: HOSTILE TAKEOVER
################################

espionage_operation_event = {
	id = diplospy.180
	title = operation.6000.name #Infiltration Begins
	desc = {
        text = diplospy.180.desc
        trigger = {
			target = { is_megacorp = yes }
			target = { is_galactic_emperor = no }
			owner = { is_megacorp = yes }
			owner = {
				any_relation = {
					any_owned_planet = {
						has_branch_office = yes
						exists = branch_office_owner
						branch_office_owner = { is_same_value = root.target }
					}
				}
			}
        }
    }
    desc = {
        text = diplospy.150.desc.invalid
        trigger = {
            OR = {
				target = { is_megacorp = no }
				target = { is_galactic_emperor = yes }
				owner = { is_megacorp = no }
				NOT = {
					owner = {
						any_relation = {
							any_owned_planet = {
								has_branch_office = yes
								exists = branch_office_owner
								branch_office_owner = { is_same_value = root.target }
							}
						}
					}
				}
			}
        }
    }
	picture = GFX_evt_spy_network
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					target = { is_megacorp = no }
					target = { is_galactic_emperor = yes }
					owner = { is_megacorp = no }
					NOT = {
						owner = {
							any_relation = {
								any_owned_planet = {
									has_branch_office = yes
									exists = branch_office_owner
									branch_office_owner = { is_same_value = root.target }
								}
							}
						}
					}
				}
			}
			set_espionage_operation_progress_locked = yes
		}
	}

	option = {
		name = ACKNOWLEDGED
		trigger = {
			target = { is_megacorp = yes }
			target = { is_galactic_emperor = no }
			owner = { is_megacorp = yes }
			owner = {
				any_relation = {
					any_owned_planet = {
						has_branch_office = yes
						exists = branch_office_owner
						branch_office_owner = { is_same_value = root.target }
					}
				}
			}
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			OR = {
				target = { is_megacorp = no }
				target = { is_galactic_emperor = yes }
				owner = { is_megacorp = no }
				NOT = {
					owner = {
						any_relation = {
							any_owned_planet = {
								has_branch_office = yes
								exists = branch_office_owner
								branch_office_owner = { is_same_value = root.target }
							}
						}
					}
				}
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

espionage_operation_event = {
	id = diplospy.181
	title = diplospy.181.name
	desc = {
        text = diplospy.181.desc.a
        text = diplospy.181.desc.b
        text = diplospy.181.desc.c
        text = diplospy.181.desc.d
        trigger = {
			target = { is_megacorp = yes }
			target = { is_galactic_emperor = no }
			owner = { is_megacorp = yes }
			owner = {
				any_relation = {
					any_owned_planet = {
						has_branch_office = yes
						exists = branch_office_owner
						branch_office_owner = { is_same_value = root.target }
					}
				}
			}
        }
    }
    desc = {
        text = diplospy.150.desc.invalid
		trigger = {
            OR = {
				target = { is_megacorp = no }
				target = { is_galactic_emperor = yes }
				owner = { is_megacorp = no }
				NOT = {
					owner = {
						any_relation = {
							any_owned_planet = {
								has_branch_office = yes
								exists = branch_office_owner
								branch_office_owner = { is_same_value = root.target }
							}
						}
					}
				}
			}
        }
    }
	picture = GFX_evt_acquire_asset
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					target = { is_megacorp = no }
					target = { is_galactic_emperor = yes }
					owner = { is_megacorp = no }
					NOT = {
						owner = {
							any_relation = {
								any_owned_planet = {
									has_branch_office = yes
									exists = branch_office_owner
									branch_office_owner = { is_same_value = root.target }
								}
							}
						}
					}
				}
			}
			set_espionage_operation_progress_locked = yes
		}
	}

	option = {
		trigger = {
			target = { is_megacorp = yes }
			target = { is_galactic_emperor = no }
			owner = { is_megacorp = yes }
			owner = {
				any_relation = {
					any_owned_planet = {
						has_branch_office = yes
						exists = branch_office_owner
						branch_office_owner = { is_same_value = root.target }
					}
				}
			}
		}
		name = ACKNOWLEDGED
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			OR = {
				target = { is_megacorp = no }
				target = { is_galactic_emperor = yes }
				owner = { is_megacorp = no }
				NOT = {
					owner = {
						any_relation = {
							any_owned_planet = {
								has_branch_office = yes
								exists = branch_office_owner
								branch_office_owner = { is_same_value = root.target }
							}
						}
					}
				}
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

espionage_operation_event = {
	id = diplospy.182
	title = diplospy.182.name
	desc = {
        text = diplospy.182.desc
        trigger = {
			target = { is_megacorp = yes }
			target = { is_galactic_emperor = no }
			owner = { is_megacorp = yes }
			owner = {
				any_relation = {
					any_owned_planet = {
						has_branch_office = yes
						exists = branch_office_owner
						branch_office_owner = { is_same_value = root.target }
					}
				}
			}
        }
    }
    desc = {
        text = diplospy.150.desc.invalid
		trigger = {
            OR = {
				target = { is_megacorp = no }
				target = { is_galactic_emperor = yes }
				owner = { is_megacorp = no }
				NOT = {
					owner = {
						any_relation = {
							any_owned_planet = {
								has_branch_office = yes
								exists = branch_office_owner
								branch_office_owner = { is_same_value = root.target }
							}
						}
					}
				}
			}
        }
    }
	picture = GFX_evt_financial_instruments
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		set_espionage_operation_progress_locked = yes
	}

	option = {
		trigger = {
			target = { is_megacorp = yes }
			target = { is_galactic_emperor = no }
			owner = { is_megacorp = yes }
			owner = {
				any_relation = {
					any_owned_planet = {
						has_branch_office = yes
						exists = branch_office_owner
						branch_office_owner = { is_same_value = root.target }
					}
				}
			}
		}
		name = LAUNCH_OPERATION
		hidden_effect = {
			owner = { country_event = { id = diplospy.183 days = 5 random = 25 } }
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			OR = {
				target = { is_megacorp = no }
				target = { is_galactic_emperor = yes }
				owner = { is_megacorp = no }
				NOT = {
					owner = {
						any_relation = {
							any_owned_planet = {
								has_branch_office = yes
								exists = branch_office_owner
								branch_office_owner = { is_same_value = root.target }
							}
						}
					}
				}
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

# Final setup | from = operation
country_event = {
    id = diplospy.183
    hide_window = yes
    is_triggered_only = yes

    immediate = {
		if = {
			limit = {
				FROM = {
					OR = {
						target = { is_megacorp = no }
						target = { is_galactic_emperor = yes }
						root = { is_megacorp = no }
					}
				}
			}
			country_event = { id = diplospy.185 }
		}
		else = {
			random_list = {
				3 = {
					modifier = {
						factor = 2
						root = {
							relative_encryption_decryption = {
								target = from.target
								value > 1.4
							}
						}
					}
					modifier = {
						factor = 3
						from = {
							OR = {
								has_espionage_asset_economy = yes
								AND = {
									target = { is_criminal_syndicate = yes }
									has_espionage_asset_criminal = yes
								}
							}
						}
					}
					modifier = {
						factor = 2
						from.target = {
							NOR = {
								has_hostile_espionage_operation_ethics = yes
								has_closed_borders = root
								is_at_war_with = root
							}
						}
					}
					modifier = {
						factor = 2
						root = {
							is_criminal_syndicate = yes
						}
					}
					modifier = {
						factor = 2
						root = {
							OR = {
								has_valid_civic = civic_media_conglomerate
								has_valid_civic = civic_public_relations_specialists
							}
						}
					}
					modifier = {
						factor = 1.5
						from.target = {
							has_valid_civic = civic_ruthless_competition
						}
					}
					modifier = {
						factor = 1.5
						from.target = {
							OR = {
								has_valid_civic = civic_franchising
								has_valid_civic = civic_free_traders
								has_valid_civic = civic_parliamentary_system_corp
							}
						}
					}
					modifier = {
						factor = 2
						from.target = { NOT = { has_valid_civic = civic_worker_coop } }
						root = { has_valid_civic = civic_worker_coop }
					}
					modifier = {
						factor = 1.5
						from.target = { is_authoritarian = yes }
						root = { is_egalitarian = yes }
					}
					from = { set_espionage_operation_flag = smooth_exit }
				}
				3 = {
					modifier = {
						factor = 0.3
						from = {
							OR = {
								has_espionage_asset_economy = yes
								has_espionage_asset_sabotage = yes
								has_espionage_asset_criminal = yes
							}
						}
					}
					modifier = {
						factor = 2
						from.target = {
							OR = {
								has_hostile_espionage_operation_ethics = yes
								has_closed_borders = root
								is_at_war_with = root
							}
						}
					}
					modifier = {
						factor = 3
						from.target = {
							OR = {
								has_valid_civic = civic_brand_loyalty
								has_valid_civic = civic_shadow_council_megacorp
							}
						}
					}
					modifier = {
						factor = 2
						from.target = {
							is_criminal_syndicate = yes
						}
					}
					modifier = {
						factor = 2
						from.target = {
							OR = {
								has_valid_civic = civic_indentured_assets
								has_valid_civic = civic_corvee_system_megacorp
							}
						}
					}
					modifier = {
						factor = 1.5
						from.target = {
							OR = {
								has_valid_civic = civic_gospel_of_the_masses
								has_valid_civic = civic_death_cult_corporate
							}
						}
					}
					modifier = {
						factor = 1.5
						from.target = {
							OR = {
								has_valid_civic = civic_corp_philosopher_king
								has_valid_civic = civic_royal_trading_company
								has_valid_civic = civic_visionary_founder
							}
						}
					}
					modifier = {
						factor = 2
						root = { NOT = { has_valid_civic = civic_worker_coop } }
						from.target = { has_valid_civic = civic_worker_coop }
					}
					modifier = {
						factor = 1.5
						from.target = { is_egalitarian = yes }
						root = { is_authoritarian = yes }
					}
					#'Messy' exit (no flag needed)
				}
			}
			random_relation = {
				limit = {
					any_owned_planet = {
						has_branch_office = yes
						exists = branch_office_owner
						branch_office_owner = { is_same_value = from.target }
					}
				}
				weights = {
					base = 1
					modifier = {
						add = 500
						has_commercial_pact = ROOT
					}
				}
				random_owned_planet = {
					limit = {
						has_branch_office = yes
						exists = branch_office_owner
						branch_office_owner = { is_same_value = from.target }
					}
					save_event_target_as = corp_planet_target
				}
			}
			country_event = { id = diplospy.184 }
		}
    }
}

# Final | fromfrom = operation
country_event = {
	id = diplospy.184
	title = diplospy.184.name
    desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = smooth_exit
            }
        }
        text = diplospy.184.desc.smooth
    }
	desc = {
        trigger = {
			fromfrom = {
                NOT = { has_espionage_operation_flag = smooth_exit }
            }
        }
        text = diplospy.184.desc.messy
    }
	picture = GFX_evt_financial_instruments
	show_sound = event_espionage_concluded
	location = event_target:corp_planet_target
	
	is_triggered_only = yes
	
	trigger = {
        exists = fromfrom
    }
	
	immediate = {
    }
	
	option = {
		name = EXCELLENT
		trigger = {
            fromfrom = { has_espionage_operation_flag = smooth_exit }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -30 }
        }
		custom_tooltip = diplospy.184.a.tooltip
		hidden_effect = {
			event_target:corp_planet_target = {
				close_branch_office = yes
				establish_branch_office = root
			}
		}
		hidden_effect = {
			fromfrom.target = {
				country_event = { id = diplospy.186 }
			}
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
	}
	option = {
		name = diplospy.184.b
		trigger = {
            fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
        }
		allow = { resource_stockpile_compare = { resource = energy value >= 2000 } }
		add_resource = { energy = -2000 }
		custom_tooltip = diplospy.184.a.tooltip
		hidden_effect = {
			event_target:corp_planet_target = {
				close_branch_office = yes
				establish_branch_office = root
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
		hidden_effect = {
			fromfrom.target = {
				country_event = { id = diplospy.186 }
			}
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
	}
	option = {
		name = diplospy.184.c
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            fromfrom = {
				NOT = { has_espionage_operation_flag = smooth_exit }
				has_espionage_asset_criminal = yes
			}
        }
		fromfrom = {
			destroy_espionage_asset_criminal = yes
		}
		custom_tooltip = diplospy.184.a.tooltip
		hidden_effect = {
			event_target:corp_planet_target = {
				close_branch_office = yes
				establish_branch_office = root
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -45 }
        }
		hidden_effect = {
			fromfrom.target = {
				country_event = { id = diplospy.186 }
			}
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
	}
	option = {
		name = diplospy.184.d
		trigger = {
            fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
			OR = {
				is_ai = no
				resource_stockpile_compare = { resource = energy value < 2000 }
			}
        }
		fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -30 }
        }
		add_favors = {
			target = fromfrom.target
			value = 1
		}
	}
	after = {
        destroy_espionage_operation = fromfrom
    }
}

# invalid target
country_event = {
    id = diplospy.185
    title = diplospy.154.name
    desc = diplospy.154.desc
    picture = GFX_evt_financial_instruments
    show_sound = event_default
    is_triggered_only = yes
	
	immediate = {
	}
	
	after = {
		fromfrom = { set_espionage_operation_progress_locked = no }
		destroy_espionage_operation = fromfrom
	}

    trigger = {
        exists = fromfrom
    }

    option = {
		name = UNFORTUNATE
		
    }
}

# Branch Office Stolen! (victim) | from = instigating country
country_event = {
    id = diplospy.186
    title = diplospy.186.name
    desc = diplospy.186.desc
    picture = GFX_evt_financial_instruments
    show_sound = event_default
    is_triggered_only = yes
    location = event_target:corp_planet_target

    trigger = {
        exists = from
        exists = event_target:corp_planet_target
    }

    immediate = {
        random_list = {
            1 = { #Saboteurs caught
                modifier = {
                    factor = 0
                    OR = {
                        NOT = {
                            any_spynetwork = {
                                owner = { is_same_value = root }
                                target = { is_same_value = from }
                            }
                        }
                        has_country_flag = recently_received_espionage_asset
                    }
                }
                modifier = {
                    factor = 3
                    relative_encryption_decryption = { target = from value > 0.8 }
                    relative_encryption_decryption = { target = from value < 1.6 }
                }
                modifier = {
                    factor = 10
                    relative_encryption_decryption = { target = from value >= 1.6 }
                }
                set_timed_country_flag = {
                    flag = espionage_caught_spies
                    days = 20
                }
                if = {
                    limit = {
                        any_spynetwork = {
                            owner = { is_same_value = root }
                            target = { is_same_value = from }
                            is_spynetwork_level > 5
                        }
                        NOT = { has_country_flag = recently_received_espionage_asset }
                    }
                    country_event = { #A Surprise Catch (asset granted)
                        id = espionage.1040
                        days = 15
                        scopes = { from = fromfrom }
                    }
                }
            }
            9 = { } #Nothing
        }
    }
	
	immediate = {
	}

    option = {
        name = TERRIBLE
		custom_tooltip = diplospy.186.a.tooltip
		add_opinion_modifier = { who = from modifier = opinion_seized_office }
    }
}

################################
# SUBTERFUGE: EXPROPRIATION
################################

espionage_operation_event = {
	id = diplospy.190
	title = operation.1021.name # Chasing a Lead
	desc = {
        text = diplospy.190.desc
        trigger = {
			target = { is_megacorp = yes }
			target = { is_galactic_emperor = no }
			target = { is_criminal_syndicate = no }
			owner = {
				any_owned_planet = {
					has_branch_office = yes
					exists = branch_office_owner
					branch_office_owner = { is_same_value = root.target }
				}
			}
        }
    }
	desc = {
        text = diplospy.190.desc.crime
        trigger = {
			target = { is_megacorp = yes }
			target = { is_galactic_emperor = no }
			target = { is_criminal_syndicate = yes }
			owner = {
				any_owned_planet = {
					has_branch_office = yes
					exists = branch_office_owner
					branch_office_owner = { is_same_value = root.target }
				}
			}
        }
    }
    desc = {
        text = diplospy.150.desc.invalid
        trigger = {
            OR = {
				target = { is_megacorp = no }
				target = { is_galactic_emperor = yes }
				owner = {
					NOT = {
						any_owned_planet = {
							has_branch_office = yes
							exists = branch_office_owner
							branch_office_owner = { is_same_value = root.target }
						}
					}
				}
			}
        }
    }
	picture = GFX_evt_spy_network
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					target = { is_megacorp = no }
					target = { is_galactic_emperor = yes }
					owner = {
						NOT = {
							any_owned_planet = {
								has_branch_office = yes
								exists = branch_office_owner
								branch_office_owner = { is_same_value = root.target }
							}
						}
					}
				}
			}
			set_espionage_operation_progress_locked = yes
		}
	}

	option = {
		name = ACKNOWLEDGED
		trigger = {
			target = { is_megacorp = yes }
			target = { is_galactic_emperor = no }
			owner = {
				any_owned_planet = {
					has_branch_office = yes
					exists = branch_office_owner
					branch_office_owner = { is_same_value = root.target }
				}
			}
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			OR = {
				target = { is_megacorp = no }
				target = { is_galactic_emperor = yes }
				owner = {
					NOT = {
						any_owned_planet = {
							has_branch_office = yes
							exists = branch_office_owner
							branch_office_owner = { is_same_value = root.target }
						}
					}
				}
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

espionage_operation_event = {
	id = diplospy.191
	title = diplospy.191.name
	desc = {
        text = diplospy.191.desc
        trigger = {
			target = { is_megacorp = yes }
			target = { is_galactic_emperor = no }
			target = { is_criminal_syndicate = no }
			owner = {
				any_owned_planet = {
					has_branch_office = yes
					exists = branch_office_owner
					branch_office_owner = { is_same_value = root.target }
				}
			}
        }
    }
	desc = {
        text = diplospy.191.desc.crime
        trigger = {
			target = { is_megacorp = yes }
			target = { is_galactic_emperor = no }
			target = { is_criminal_syndicate = no }
			owner = {
				any_owned_planet = {
					has_branch_office = yes
					exists = branch_office_owner
					branch_office_owner = { is_same_value = root.target }
				}
			}
        }
    }
    desc = {
        text = diplospy.150.desc.invalid
		trigger = {
            OR = {
				target = { is_megacorp = no }
				target = { is_galactic_emperor = yes }
				owner = {
					NOT = {
						any_owned_planet = {
						has_branch_office = yes
						exists = branch_office_owner
							branch_office_owner = { is_same_value = root.target }
						}
					}
				}
			}
        }
    }
	picture = GFX_evt_financial_instruments
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		set_espionage_operation_progress_locked = yes
	}

	option = {
		trigger = {
			target = { is_megacorp = yes }
			target = { is_galactic_emperor = no }
			owner = {
				any_owned_planet = {
					has_branch_office = yes
					exists = branch_office_owner
					branch_office_owner = { is_same_value = root.target }
				}
			}
		}
		name = PROCEED
		hidden_effect = {
			owner = { country_event = { id = diplospy.192 days = 1 } }
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			OR = {
				target = { is_megacorp = no }
				target = { is_galactic_emperor = yes }
				owner = {
					NOT = {
						any_owned_planet = {
							has_branch_office = yes
							exists = branch_office_owner
							branch_office_owner = { is_same_value = root.target }
						}
					}
				}
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

# Final setup | from = operation
country_event = {
    id = diplospy.192
    hide_window = yes
    is_triggered_only = yes

    immediate = {
		if = {
			limit = {
				from = {
					OR = {
						target = { is_megacorp = no }
						target = { is_galactic_emperor = yes }
						root = {
							NOT = {
								any_owned_planet = {
									has_branch_office = yes
									exists = branch_office_owner
									branch_office_owner = { is_same_value = from.target }
								}
							}
						}
					}
				}
			}
			country_event = { id = diplospy.185 }
		}
		else = {
			random_list = {
				3 = {
					modifier = {
						factor = 2
						root = {
							relative_encryption_decryption = {
								target = from.target
								value > 1.4
							}
						}
					}
					modifier = {
						factor = 3
						from = {
							OR = {
								has_espionage_asset_economy = yes
								AND = {
									target = { is_criminal_syndicate = yes }
									has_espionage_asset_criminal = yes
								}
							}
						}
					}
					modifier = {
						factor = 2
						from.target = {
							has_hostile_espionage_operation_ethics = no
						}
					}
					modifier = {
						factor = 2
						from.target = {
							OR = {
								has_closed_borders = root # harder for corp to justify their presence
								is_at_war_with = root # easier to justify their removal
							}
						}
					}
					from = { set_espionage_operation_flag = smooth_exit }
				}
				3 = {
					modifier = {
						factor = 0.3
						from = {
							OR = {
								has_espionage_asset_economy = yes
								has_espionage_asset_subterfuge = yes
								has_espionage_asset_criminal = yes
							}
						}
					}
					modifier = {
						factor = 2
						from.target = {
							has_hostile_espionage_operation_ethics = yes
						}
					}
					modifier = {
						factor = 3
						from.target = {
							is_criminal_syndicate = yes
						}
					}
					modifier = {
						factor = 3
						from.target = {
							has_valid_civic = civic_shadow_council_megacorp
						}
					}
					modifier = {
						factor = 1.5
						from.target = {
							OR = {
								has_valid_civic = civic_franchising
								has_valid_civic = civic_free_traders
							}
						}
					}
					#'Messy' exit (no flag needed)
				}
			}
			random_owned_planet = {
				limit = {
					has_branch_office = yes
					exists = branch_office_owner
					branch_office_owner = { is_same_value = from.target }
				}
				save_event_target_as = corp_planet_target
				branch_office_owner = { save_event_target_as = office_owner }
			}
			random_owned_planet = {
				limit = {
					NOT = { is_same_value = event_target:corp_planet_target }
					has_branch_office = yes
					exists = branch_office_owner
					branch_office_owner = { is_same_value = from.target }
				}
				save_event_target_as = corp_planet_target_two
			}
			country_event = { id = diplospy.193 }
		}
    }
}

# Final | fromfrom = operation
country_event = {
	id = diplospy.193
	title = diplospy.193.name
    desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = smooth_exit
				target = { is_criminal_syndicate = no }
            }
        }
        text = diplospy.193.desc.smooth
    }
	desc = {
        trigger = {
			fromfrom = {
                has_espionage_operation_flag = smooth_exit
				target = { is_criminal_syndicate = yes }
            }
        }
        text = diplospy.193.desc.smooth.crime
    }
	desc = {
        trigger = {
			fromfrom = {
                NOT = { has_espionage_operation_flag = smooth_exit }
				target = { is_criminal_syndicate = no }
            }
        }
        text = diplospy.193.desc.messy
    }
	desc = {
        trigger = {
			fromfrom = {
                NOT = { has_espionage_operation_flag = smooth_exit }
				target = { is_criminal_syndicate = yes }
            }
        }
        text = diplospy.193.desc.messy.crime
    }
	picture = GFX_evt_financial_instruments
	show_sound = event_espionage_concluded
	location = event_target:corp_planet_target
	
	is_triggered_only = yes
	
	trigger = {
        exists = fromfrom
    }
	
	immediate = {
    }
	
	option = {
		name = EXCELLENT
		trigger = {
            fromfrom = { has_espionage_operation_flag = smooth_exit }
        }
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -20 }
        }
		custom_tooltip = diplospy.193.a.tooltip
		hidden_effect = {
			event_target:corp_planet_target = {
				close_branch_office = yes
				set_timed_planet_flag = { flag = criminal_branch_closed_cooldown_planet@event_target:office_owner days = 3600 }
			}
		}
		hidden_effect = {
			fromfrom.target = {
				country_event = { id = diplospy.194 }
			}
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
	}
	option = {
		name = diplospy.193.c
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            fromfrom = {
				has_espionage_operation_flag = smooth_exit
				has_espionage_asset_economy = yes
				target = { is_criminal_syndicate = no }
				exists = event_target:corp_planet_target_two
			}
        }
		fromfrom = {
			destroy_espionage_asset_economy = yes
		}
		custom_tooltip = diplospy.193.c.tooltip
		hidden_effect = {
			event_target:corp_planet_target = {
				close_branch_office = yes
				set_timed_planet_flag = { flag = criminal_branch_closed_cooldown_planet@event_target:office_owner days = 3600 }
			}
			event_target:corp_planet_target_two = {
				close_branch_office = yes
				set_timed_planet_flag = { flag = criminal_branch_closed_cooldown_planet@event_target:office_owner days = 3600 }
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -30 }
        }
		hidden_effect = {
			fromfrom.target = {
				country_event = { id = diplospy.194 }
			}
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
	}
	option = {
		name = diplospy.193.c
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            fromfrom = {
				has_espionage_operation_flag = smooth_exit
				has_espionage_asset_criminal = yes
				target = { is_criminal_syndicate = yes }
				exists = event_target:corp_planet_target_two
			}
        }
		fromfrom = {
			destroy_espionage_asset_criminal = yes
		}
		custom_tooltip = diplospy.193.c.tooltip
		hidden_effect = {
			event_target:corp_planet_target = {
				close_branch_office = yes
				set_timed_planet_flag = { flag = criminal_branch_closed_cooldown_planet@event_target:office_owner days = 3600 }
			}
			event_target:corp_planet_target_two = {
				close_branch_office = yes
				set_timed_planet_flag = { flag = criminal_branch_closed_cooldown_planet@event_target:office_owner days = 3600 }
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -30 }
        }
		hidden_effect = {
			fromfrom.target = {
				country_event = { id = diplospy.194 }
			}
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
	}
	option = {
		name = {
			text = diplospy.193.b
			trigger = {
				fromfrom.target = { is_criminal_syndicate = no }
            }
		}
		name = {
			text = diplospy.193.b.crime
			trigger = {
				fromfrom.target = { is_criminal_syndicate = yes }
            }
		}
		trigger = {
            fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
        }
		allow = { resource_stockpile_compare = { resource = energy value >= 2000 } }
		add_resource = { energy = -2000 }
		if = {
			limit = {
				fromfrom.target = { is_criminal_syndicate = yes }
			}
			event_target:corp_planet_target = {
				add_modifier = { modifier = rooting_out_criminals days = 3600 }
			}
		}
		else = {
			hidden_effect = {
				fromfrom.target = { add_resource = { energy = 2000 } }
			}
		}
		custom_tooltip = diplospy.193.a.tooltip
		hidden_effect = {
			event_target:corp_planet_target = {
				close_branch_office = yes
				set_timed_planet_flag = { flag = criminal_branch_closed_cooldown_planet@event_target:office_owner days = 3600 }
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -30 }
        }
		hidden_effect = {
			fromfrom.target = {
				country_event = { id = diplospy.194 }
			}
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
	}
	option = {
		name = diplospy.184.c
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            fromfrom = {
				NOT = { has_espionage_operation_flag = smooth_exit }
				has_espionage_asset_economy = yes
				target = { is_criminal_syndicate = no }
			}
        }
		fromfrom = {
			destroy_espionage_asset_economy = yes
		}
		custom_tooltip = diplospy.193.a.tooltip
		hidden_effect = {
			event_target:corp_planet_target = {
				close_branch_office = yes
				set_timed_planet_flag = { flag = criminal_branch_closed_cooldown_planet@event_target:office_owner days = 3600 }
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -30 }
        }
		hidden_effect = {
			fromfrom.target = {
				country_event = { id = diplospy.194 }
			}
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
	}
	option = {
		name = diplospy.184.c
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
            fromfrom = {
				NOT = { has_espionage_operation_flag = smooth_exit }
				has_espionage_asset_criminal = yes
				target = { is_criminal_syndicate = yes }
			}
        }
		fromfrom = {
			destroy_espionage_asset_criminal = yes
		}
		custom_tooltip = diplospy.193.a.tooltip
		hidden_effect = {
			event_target:corp_planet_target = {
				close_branch_office = yes
				set_timed_planet_flag = { flag = criminal_branch_closed_cooldown_planet@event_target:office_owner days = 3600 }
			}
		}
        fromfrom.spynetwork = {
            add_spy_network_level_on_success_effect = { VALUE = -30 }
        }
		hidden_effect = {
			fromfrom.target = {
				country_event = { id = diplospy.194 }
			}
		}
		if = { 
			limit = { has_ascension_perk = ap_become_the_crisis }
			complete_crisis_objective = crisobj_perform_upsetting_operations 
		}
	}
	option = {
		name = diplospy.184.d
		trigger = {
            fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
			OR = {
				is_ai = no
				resource_stockpile_compare = { resource = energy value < 2000 }
			}
        }
	}
	after = {
        destroy_espionage_operation = fromfrom
    }
}

# Branch Office Closed! (victim) | from = instigating country
country_event = {
    id = diplospy.194
    title = diplospy.194.name
    desc = {
		text = diplospy.194.desc
		trigger = {
			is_criminal_syndicate = no
			NOT = { event_target:corp_planet_target_two = { has_planet_flag = criminal_branch_closed_cooldown_planet@root } }
		}
	}
	desc = {
		text = diplospy.194.desc.two
		trigger = {
			is_criminal_syndicate = no
			event_target:corp_planet_target_two = { has_planet_flag = criminal_branch_closed_cooldown_planet@root }
		}
	}
	desc = {
		text = diplospy.194.desc.crime
		trigger = {
			is_criminal_syndicate = yes
			NOT = { event_target:corp_planet_target_two = { has_planet_flag = criminal_branch_closed_cooldown_planet@root } }
		}
	}
	desc = {
		text = diplospy.194.desc.crime.two
		trigger = {
			is_criminal_syndicate = yes
			event_target:corp_planet_target_two = { has_planet_flag = criminal_branch_closed_cooldown_planet@root }
		}
	}
    picture = GFX_evt_financial_instruments
    show_sound = event_default
    is_triggered_only = yes
    location = event_target:corp_planet_target

    trigger = {
        exists = from
        exists = event_target:corp_planet_target
    }

    immediate = {
        random_list = {
            1 = { #Saboteurs caught
                modifier = {
                    factor = 0
                    OR = {
                        NOT = {
                            any_spynetwork = {
                                owner = { is_same_value = root }
                                target = { is_same_value = from }
                            }
                        }
                        has_country_flag = recently_received_espionage_asset
                    }
                }
                modifier = {
                    factor = 3
                    relative_encryption_decryption = { target = from value > 0.8 }
                    relative_encryption_decryption = { target = from value < 1.6 }
                }
                modifier = {
                    factor = 10
                    relative_encryption_decryption = { target = from value >= 1.6 }
                }
                set_timed_country_flag = {
                    flag = espionage_caught_spies
                    days = 20
                }
                if = {
                    limit = {
                        any_spynetwork = {
                            owner = { is_same_value = root }
                            target = { is_same_value = from }
                            is_spynetwork_level > 5
                        }
                        NOT = { has_country_flag = recently_received_espionage_asset }
                    }
                    country_event = { #A Surprise Catch (asset granted)
                        id = espionage.1040
                        days = 15
                        scopes = { from = fromfrom }
                    }
                }
            }
            9 = { } #Nothing
        }
    }
	
	immediate = {
	}

    option = {
        name = TERRIBLE
		if = {
			limit = {
				event_target:corp_planet_target_two = { has_planet_flag = criminal_branch_closed_cooldown_planet@root }
			}
			custom_tooltip = diplospy.194.a.tooltip
		}
		else = {
			custom_tooltip = diplospy.186.a.tooltip
		}
    }
}

################################
# SUBTERFUGE: HACK COMMUNICATIONS
################################

# this = operation; from = target (country)


# Single Stage Operation - the stakes have never been lower
espionage_operation_event = {
	id = diplospy.200
	title = operation_hack_communications
	desc = {
		text = diplospy.200.desc
		trigger = {
			exists = event_target:contact_empire
		}
	}
	desc = {
		text = diplospy.200.desc_fail
		trigger = {
			NOT = { exists = event_target:contact_empire }
		}
	}

	picture = GFX_evt_spymaster
	show_sound = event_espionage_concluded
	espionage_operation = yes
	is_triggered_only = yes
	
	trigger = {
		exists = from
	}
	
	immediate = {
		target = {
			random_relation = {
				limit = {
					is_playable = yes
					has_communications = prev
					NOT = { has_communications = root.owner }
					NOT = { is_same_value = root.owner }
				}
				save_event_target_as = contact_empire
				establish_communications_no_message = root.owner
			}
		}
	}
	
	option = {
		name = communications_spread.1.a
		custom_tooltip = communications_spread.1.tooltip
		hidden_effect = {
			owner = { country_event = { id = action.1 } }
			event_target:contact_empire = {
				country_event = {
					id = communications_spread.2
					scopes = { from = root.owner }
				}
			}
		}
	}

	after = {
		if = {
			limit = {
				exists = event_target:contact_empire
				owner = { NOT = { has_tradition = tr_subterfuge_adopt } }
			}
			spynetwork = {
				add_spy_network_level_on_success_effect = { VALUE = -5 }
			}
		}
		destroy_espionage_operation = this
	}
}

###############################
# SUBTERFUGE: STEAL L-GATE RESEARCH
###############################
# this = operation
# from = operation.target (country)

# Finding an 'in'
espionage_operation_event = {
	id = diplospy.210
	title = operation.1020.name
	espionage_operation = yes
	desc = {
		text = diplospy.210.desc.conf
		trigger = {
			has_espionage_operation_flag = steal_tech_conference
		}
	}
	desc = {
		text = diplospy.210.desc.lecture
		trigger = {
			has_espionage_operation_flag = steal_tech_lecture
		}
	}
	desc = {
		text = diplospy.210.desc.theft
		trigger = {
			has_espionage_operation_flag = steal_tech_theft
		}
	}
	picture = {
		trigger = {
			OR = {
				has_espionage_operation_flag = steal_tech_conference
				has_espionage_operation_flag = steal_tech_lecture
			}
		}
		picture = GFX_evt_voting
	}
	picture = {
		trigger = {
			has_espionage_operation_flag = steal_tech_theft
		}
		picture = GFX_evt_smugglers_in_bar
	}
	show_sound = event_default
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { #Disregard empires which wouldn't hold a scientific debate
				target = {
					NOR = {
						has_valid_civic = civic_fanatic_purifiers
						has_valid_civic = civic_ruthless_competition
						has_valid_civic = civic_hive_subsumed_will
						has_valid_civic = civic_machine_introspective
						is_homicidal = yes
					}
				}
			}
			random_list = {
				2 = { set_espionage_operation_flag = steal_tech_conference }
				2 = {
					modifier = { factor = 0 target = { is_gestalt = yes } }
					set_espionage_operation_flag = steal_tech_lecture
				}
				1 = {
					modifier = { factor = 0 root.target = { opinion_level = { who = root.owner level >= good } } }
					set_espionage_operation_flag = steal_tech_theft
				}
			}
		}
		else = {
			set_espionage_operation_flag = steal_tech_theft
		}
	}

	option = {
		name = ACKNOWLEDGED
	}
}
# Contact made
espionage_operation_event = {
	id = diplospy.211
	title = operation.1021.name # Chasing a Lead
	espionage_operation = yes
	desc = {
		text = diplospy.211.desc.creds
		trigger = {
			OR = {
				has_espionage_operation_flag = steal_tech_conference
				has_espionage_operation_flag = steal_tech_lecture
				has_espionage_operation_flag = steal_tech_outreach
			}
			owner = { is_gestalt = no }
		}
	}
	desc = {
		text = diplospy.211.desc.appeal
		trigger = {
			OR = {
				has_espionage_operation_flag = steal_tech_conference
				has_espionage_operation_flag = steal_tech_lecture
				has_espionage_operation_flag = steal_tech_outreach
			}
		}
	}
	desc = {
		trigger = {
			has_espionage_operation_flag = steal_tech_theft
		}
		text = diplospy.211.desc.theft
	}
	picture = GFX_evt_engineering_research
	show_sound = event_default
	is_triggered_only = yes

	immediate = { }

	option = { name = OK }
}
# Drawing up plans
espionage_operation_event = {
	id = diplospy.212
	title = operation.1022.name # Entry Secured
	espionage_operation = yes
	desc = {
		trigger = {
			OR = {
				has_espionage_operation_flag = steal_tech_conference
				has_espionage_operation_flag = steal_tech_lecture
				has_espionage_operation_flag = steal_tech_outreach
			}
		}
		text = diplospy.212.desc.invited
	}
	desc = {
		trigger = {
			has_espionage_operation_flag = steal_tech_theft
		}
		text = diplospy.212.desc.theft
	}
	picture = GFX_evt_physics_research
	show_sound = event_default
	is_triggered_only = yes

	immediate = {
		set_espionage_operation_progress_locked = yes
	}

	option = {
		name = LAUNCH_OPERATION
		hidden_effect = {
			owner = {
				country_event = { id = diplospy.213 days = 1 }
			}
		}
	}

	after = {
		set_espionage_operation_progress_locked = no
	}
}
# Final setup | from = operation
country_event = {
	id = diplospy.213
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = { #Theft from a facility
			limit = {
				from = { has_espionage_operation_flag = steal_tech_theft }
			}
			random_list = {
				3 = {
					modifier = {
						factor = 1.5
						root = {
							relative_encryption_decryption = {
								target = from.target
								value > 1.3
							}
						}
					}
					from = { set_espionage_operation_flag = smooth_exit }
				}
				2 = {
					modifier = {
						factor = 2
						espionage_operation_disguise_disadvantage = yes
					}
					modifier = {
						factor = 0.3
						from = {
							OR = {
								has_espionage_asset_technology = yes
								has_espionage_asset_subterfuge = yes
								has_espionage_asset_criminal = yes
							}
						}
					}
					#'Messy' exit (no flag needed)
				}
			}
		}
		else = { #Theft via a cover alias
			random_list = {
				3 = {
					modifier = {
						factor = 1.5
						root = {
							relative_encryption_decryption = {
								target = from.target
								value > 1.5
							}
						}
					}
					from = { set_espionage_operation_flag = smooth_exit }
				}
				1 = {
					modifier = {
						factor = 2
						espionage_operation_disguise_disadvantage = yes
					}
					modifier = {
						factor = 0.3
						from = {
							OR = {
								has_espionage_asset_technology = yes
								has_espionage_asset_subterfuge = yes
							}
						}
					}
					#'Messy' exit (no flag needed)
				}
			}
		}
		country_event = { id = diplospy.214 days = 3 }
	}
}
# Final | fromfrom = operation
country_event = {
	id = diplospy.214
	title = operation.1026.name
	desc = {
		trigger = {
			fromfrom = {
				has_espionage_operation_flag = steal_tech_theft
				has_espionage_operation_flag = smooth_exit
			}
		}
		text = operation.1026.desc.ducts.smooth
		text = operation.1026.desc.goods.smooth
	}
	desc = {
		trigger = {
			fromfrom = {
				has_espionage_operation_flag = steal_tech_theft
				NOT = { has_espionage_operation_flag = smooth_exit }
			}
		}
		text = operation.1026.desc.ducts.messy
		text = operation.1026.desc.goods.messy
	}
	desc = {
		trigger = {
			fromfrom = {
				NOT = { has_espionage_operation_flag = steal_tech_theft }
				has_espionage_operation_flag = smooth_exit
			}
		}
		text = operation.1026.desc.invited.smooth
	}
	desc = {
		trigger = {
			fromfrom = {
				NOT = {
					has_espionage_operation_flag = steal_tech_theft
					has_espionage_operation_flag = smooth_exit
				}
			}
		}
		text = operation.1026.desc.invited.messy
	}
	picture = GFX_evt_physics_research
	show_sound = event_espionage_concluded
	is_triggered_only = yes

	trigger = {
		exists = fromfrom
	}

	immediate = {
	}

	option = { #We're done here (smooth)
		name = operation.1026.a.smooth
		trigger = {
			fromfrom = { has_espionage_operation_flag = smooth_exit }
		}
		fromfrom.spynetwork = {
			add_spy_network_level_on_success_effect = { VALUE = -20 }
		}
	}
	option = { #We're done here (messy)
		name = operation.1026.a.messy
		trigger = {
			fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
		}
		fromfrom.spynetwork = {
			add_spy_network_level_on_success_effect = { VALUE = -30 }
		}

	}
	option = { #Sabotage their current research
		name = {
			trigger = {
				fromfrom = { has_espionage_operation_flag = smooth_exit }
			}
			text = operation.1026.b.smooth
		}
		name = {
			trigger = {
				fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
			}
			text = operation.1026.b.messy
		}
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
			fromfrom = {
				OR = {
					has_espionage_asset = asset_hacker
					has_espionage_asset = asset_memory_cache
				}
			}
		}
		allow = {
			resource_stockpile_compare = { resource = influence value >= 100 }
			custom_tooltip = {
				fail_text = "requires_not_completed_clues"
				fromfrom.target = { NOT = { has_country_flag = completed_lcluster_chain } }
			}
			custom_tooltip = {
				fail_text = "requires_not_enigmatic_research_sabotage"
				fromfrom.target = { NOT = { has_ascension_perk = ap_enigmatic_engineering } }
			}
		}
		hidden_effect = {
			fromfrom.target = {
				country_event = { id = diplospy.215 }
			}
		}
		custom_tooltip = operation.1026.b.tooltip
		add_resource = { influence = -100 }
		fromfrom = {
			if = {
				limit = { has_espionage_operation_flag = smooth_exit }
				spynetwork = {
					add_spy_network_level_on_success_effect = { VALUE = -30 }
				}
			}
			else = {
				spynetwork = {
					add_spy_network_level_on_success_effect = { VALUE = -45 }
				}
			}
			destroy_espionage_asset_sabotage = yes
		}
		owner = {
			if = {
				limit = { has_ascension_perk = ap_become_the_crisis }
				complete_crisis_objective = crisobj_perform_upsetting_operations
			}
		}
	}
	option = { #Research backdoor
		name = operation.1026.c
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
			root = {
				relative_encryption_decryption = {
					target = fromfrom.target
					value > 1.4
				}
			}
			fromfrom = {
				OR = {
					has_espionage_asset_subterfuge = yes
					has_espionage_asset_technology = yes
				}
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = "requires_not_espionage_research_backdoor"
				NOT = { has_modifier = espionage_research_backdoor } #Not stackable
			}
			custom_tooltip = {
				fail_text = "requires_not_enigmatic_research_backdoor"
				fromfrom.target = { NOT = { has_ascension_perk = ap_enigmatic_engineering } }
			}
		}
		root = {
			add_modifier = { modifier = espionage_research_backdoor days = 720 }
		}
		fromfrom = {
			if = {
				limit = { has_espionage_operation_flag = smooth_exit }
				spynetwork = {
					add_spy_network_level_on_success_effect = { VALUE = -20 }
				}
			}
			else = {
				spynetwork = {
					add_spy_network_level_on_success_effect = { VALUE = -30 }
				}
			}
			if = {
				limit = { has_espionage_asset_technology = yes }
				destroy_espionage_asset_technology = yes
			}
			else_if = {
				limit = { has_espionage_asset_subterfuge = yes }
				destroy_espionage_asset_subterfuge = yes
			}
		}
	}

	after = {
		custom_tooltip = diplospy.214.tooltip
		set_country_flag = stole_l_gate_research@fromfrom.target
		generate_lcluster_clue = yes
		if = {
			limit = {
				fromfrom.target = {
					NOT = { has_ascension_perk = ap_enigmatic_engineering }
					check_variable = {
						which = num_lcluster_clues
						value > 4
					}
				}
			}
			generate_lcluster_clue = yes
		}
		destroy_espionage_operation = fromfrom
	}
}

# Operation target experiences sabotage | from = instigating country
country_event = {
	id = diplospy.215
	title = diplospy.215.name
	desc = diplospy.215.desc
	picture = GFX_evt_archaeologists_escaping
	show_sound = event_default
	is_triggered_only = yes

	trigger = {
		exists = from
	}

	immediate = {
		add_event_chain_counter = {
			event_chain = l_cluster_chain
			counter = clues
			amount = -1
		}
		# increment variable
		change_variable = {
			which = num_lcluster_clues
			value = -1
		}
	}

	option = {
		name = CURSES
		custom_tooltip = diplospy.215.tooltip
	}
}

# Someone opens L-GATE
espionage_operation_event = {
	id = diplospy.216
	title = diplospy.216.name
	desc = diplospy.216.desc
	picture = GFX_evt_drifting_gateway
	show_sound = event_radio_chatter
	is_triggered_only = yes

	option = {
		name = OK
		destroy_espionage_operation = root
	}
}


###############################
# SUBTERFUGE: STEAL GALATRON
###############################

espionage_operation_event = {
	id = diplospy.220
	title = operation.6000.name #Infiltration Begins
	desc = {
        text = diplospy.220.desc
        trigger = {
			target = {
				NOR = {
					is_xenophobe = yes
					is_xenophobic_isolationists = yes
				}
				OR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
        }
    }
	desc = {
        text = diplospy.220.desc.phobe
        trigger = {
			target = {
				OR = {
					is_xenophobe = yes
					is_xenophobic_isolationists = yes
				}
				OR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
        }
    }
    desc = {
        text = diplospy.220.desc.invalid
        trigger = {
            target = {
				NOR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
        }
    }
	picture = GFX_evt_analyzing_artifacts
	show_sound = event_mystic_reveal
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				target = {
					NOR = {
						has_modifier = galatron_modifier
						has_relic = r_galatron
					}
				}
			}
			set_espionage_operation_progress_locked = yes
		}
	}

	option = {
		name = ACKNOWLEDGED
		trigger = {
			target = {
				OR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			target = {
				NOR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

espionage_operation_event = {
	id = diplospy.221
	title = operation.1021.name # Chasing a Lead
	desc = {
        text = diplospy.221.desc
        trigger = {
			target = {
				OR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
        }
    }
    desc = {
        text = diplospy.220.desc.invalid
        trigger = {
            target = {
				NOR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
        }
    }
	picture = GFX_evt_intelligence_report
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				target = {
					NOR = {
						has_modifier = galatron_modifier
						has_relic = r_galatron
					}
				}
			}
			set_espionage_operation_progress_locked = yes
		}
	}

	option = {
		name = ACKNOWLEDGED
		trigger = {
			target = {
				OR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			target = {
				NOR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

espionage_operation_event = {
	id = diplospy.222
	title = operation.1022.name # Entry Secured
	desc = {
        text = diplospy.222.desc
        trigger = {
			target = {
				OR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
        }
    }
    desc = {
        text = diplospy.220.desc.invalid
        trigger = {
            target = {
				NOR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
        }
    }
	picture = GFX_evt_spy_network
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				target = {
					NOR = {
						has_modifier = galatron_modifier
						has_relic = r_galatron
					}
				}
			}
			set_espionage_operation_progress_locked = yes
		}
	}

	option = {
		name = LAUNCH_OPERATION
		trigger = {
			target = {
				OR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
		}
		hidden_effect = {
			owner = {
				country_event = { id = diplospy.223 days = 1 }
			}
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			target = {
				NOR = {
					has_modifier = galatron_modifier
					has_relic = r_galatron
				}
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

# Final setup | from = operation
country_event = {
	id = diplospy.223
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = { #Theft from a facility
			limit = {
				from = { has_espionage_operation_flag = steal_tech_theft }
			}
			random_list = {
				3 = {
					modifier = {
						factor = 1.5
						root = {
							relative_encryption_decryption = {
								target = from.target
								value > 1.3
							}
						}
					}
					from = { set_espionage_operation_flag = smooth_exit }
				}
				2 = {
					modifier = {
						factor = 2
						espionage_operation_disguise_disadvantage = yes
					}
					modifier = {
						factor = 0.3
						from = {
							OR = {
								has_espionage_asset_government = yes
								has_espionage_asset_subterfuge = yes
								has_espionage_asset_criminal = yes
							}
						}
					}
					#'Messy' exit (no flag needed)
				}
			}
		}
		else = { #Theft via a cover alias
			random_list = {
				3 = {
					modifier = {
						factor = 1.5
						root = {
							relative_encryption_decryption = {
								target = from.target
								value > 1.5
							}
						}
					}
					from = { set_espionage_operation_flag = smooth_exit }
				}
				1 = {
					modifier = {
						factor = 2
						espionage_operation_disguise_disadvantage = yes
					}
					modifier = {
						factor = 0.3
						from = {
							OR = {
								has_espionage_asset_government = yes
								has_espionage_asset_subterfuge = yes
							}
						}
					}
					#'Messy' exit (no flag needed)
				}
			}
		}
		country_event = { id = diplospy.224 days = 3 }
	}
}
# Final | fromfrom = operation
country_event = {
	id = diplospy.224
	title = diplospy.224.name
	desc = {
		trigger = {
			fromfrom = {
				has_espionage_operation_flag = smooth_exit
			}
		}
		text = diplospy.224.desc.smooth.pilgrim
	}
	desc = {
		trigger = {
			fromfrom = {
				NOT = { has_espionage_operation_flag = smooth_exit }
				OR = {
					has_espionage_asset_subterfuge = yes
					has_espionage_asset_government = yes
				}
			}
		}
		text = diplospy.224.desc.messy.agent
	}
	desc = {
		trigger = {
			fromfrom = {
				NOT = { has_espionage_operation_flag = smooth_exit }
				NOR = {
					has_espionage_asset_subterfuge = yes
					has_espionage_asset_government = yes
				}
			}
		}
		text = diplospy.224.desc.messy.no_agent
	}
	picture = GFX_evt_analyzing_artifacts
	show_sound = event_espionage_concluded
	is_triggered_only = yes

	trigger = {
		exists = fromfrom
	}

	immediate = {
	}

	option = {
		name = diplospy.224.a
		trigger = {
			fromfrom = { has_espionage_operation_flag = smooth_exit }
		}
		if = {
			limit = { has_ancrel = yes }
			fromfrom.target = {
				add_modifier = { modifier = humiliated days = 3600 }
				hidden_effect = { country_event = { id = diplospy.225 } }
				hidden_effect = { remove_relic = r_galatron }
			}
			add_relic = r_galatron
		}
		else = {
			fromfrom.target = {
				remove_modifier = galatron_modifier
				add_modifier = { modifier = humiliated days = 3600 }
				hidden_effect = { country_event = { id = diplospy.225 } }
			}
			add_modifier = { modifier = galatron_modifier days = -1 }
		}
		fromfrom.spynetwork = {
			add_spy_network_level_on_success_effect = { VALUE = -60 }
		}
	}
	option = {
		name = diplospy.224.b
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
			fromfrom = {
				NOT = { has_espionage_operation_flag = smooth_exit }
				OR = {
					has_espionage_asset_subterfuge = yes
					has_espionage_asset_government = yes
				}
			}
		}
		allow = {
			resource_stockpile_compare = { resource = influence value >= 250 }
		}
		add_resource = { influence = -250 }
		if = {
			limit = { has_ancrel = yes }
			fromfrom.target = {
				add_modifier = { modifier = humiliated days = 3600 }
				hidden_effect = { country_event = { id = diplospy.225 } }
				hidden_effect = { remove_relic = r_galatron }
			}
			add_relic = r_galatron
		}
		else = {
			fromfrom.target = {
				remove_modifier = galatron_modifier
				add_modifier = { modifier = humiliated days = 3600 }
				hidden_effect = { country_event = { id = diplospy.225 } }
			}
			add_modifier = { modifier = galatron_modifier days = -1 }
		}
		fromfrom = {
			if = {
				limit = { has_espionage_asset_government = yes }
				destroy_espionage_asset_government = yes
			}
			else_if = {
				limit = { has_espionage_asset_subterfuge = yes }
				destroy_espionage_asset_subterfuge = yes
			}
		}
		fromfrom.spynetwork = {
			add_spy_network_level_on_success_effect = { VALUE = -90 }
		}
	}
	option = {
		name = diplospy.224.c
		trigger = {
			fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
		}
		fromfrom.spynetwork = {
			add_spy_network_level_on_success_effect = { VALUE = -60 }
		}
	}

	after = {
		destroy_espionage_operation = fromfrom
	}
}

# Lost the Galatron by Guile
country_event = {
	id = diplospy.225
	title = cara.951.name
	desc = diplospy.225.desc
	picture = GFX_evt_alien_segregation
	show_sound = event_life_support_fail

	is_triggered_only = yes

	option = {
		name = cara.951.a
		tooltip = {
			add_modifier = { modifier = humiliated days = 3600 }
		}
		add_opinion_modifier = { who = from modifier = opinion_stole_galatron }
	}
}

###############################
# MANIPULATION: ECONOMY
###############################

espionage_operation_event = {
	id = diplospy.230
	title = operation.1020.name # Gathering Leads
	desc = {
        text = diplospy.230.desc
        trigger = {
			target = {
				NOT = { has_modifier = operation_market_manipulation_mod }
			}
        }
    }
    desc = {
        text = diplospy.150.desc.invalid
        trigger = {
			target = {
				has_modifier = operation_market_manipulation_mod
			}
        }
    }
	picture = GFX_evt_intelligence_report
	show_sound = event_encrypted_comms
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				target = {
					has_modifier = operation_market_manipulation_mod
				}
			}
			set_espionage_operation_progress_locked = yes
		}
	}

	option = {
		name = ACKNOWLEDGED
		trigger = {
			target = {
				NOT = { has_modifier = operation_market_manipulation_mod }
			}
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			target = {
				has_modifier = operation_market_manipulation_mod
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

espionage_operation_event = {
	id = diplospy.231
	title = operation.1001.name # Narrowing the Field
	desc = {
        text = diplospy.231.desc
		trigger = {
			target = {
				NOT = { has_modifier = operation_market_manipulation_mod }
			}
        }
    }
	desc = {
		text = diplospy.231.desc.invalid
		trigger = {
			target = {
				has_valid_civic = civic_shared_burden
			}
		}
	}
	desc = {
		text = diplospy.150.desc.invalid
		trigger = {
			target = {
				NOT = { has_valid_civic = civic_shared_burden }
				has_modifier = operation_market_manipulation_mod
			}
		}
	}
	picture = GFX_evt_spy_network
	show_sound = event_default
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				target = {
					OR = {
						has_modifier = operation_market_manipulation_mod
						has_valid_civic = civic_shared_burden
					}
				}
			}
			set_espionage_operation_progress_locked = yes
		}
		if = {
			limit = {
				target = {
					OR = {
						has_modifier = operation_market_manipulation_mod
						has_valid_civic = civic_shared_burden
					}
				}
			}
			owner = { set_country_flag = cannot_manipulate_sb_economy@root.target }
		}
	}

	option = {
		name = ACKNOWLEDGED
		trigger = {
			target = {
				NOT = { has_modifier = operation_market_manipulation_mod }
			}
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			target = {
				OR = {
					has_modifier = operation_market_manipulation_mod
					has_valid_civic = civic_shared_burden
				}
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

espionage_operation_event = {
	id = diplospy.232
	title = diplospy.232.name
	desc = {
        text = diplospy.232.desc.bash
        trigger = {
			target = {
				NOT = { has_modifier = operation_market_manipulation_mod }
			}
        }
    }
	desc = {
        text = diplospy.232.desc.pump
        trigger = {
			target = {
				NOT = { has_modifier = operation_market_manipulation_mod }
			}
        }
    }
	desc = {
        text = diplospy.232.desc.run
        trigger = {
			target = {
				NOT = { has_modifier = operation_market_manipulation_mod }
			}
        }
    }
	desc = {
        text = diplospy.232.desc.hack
        trigger = {
			target = {
				NOT = { has_modifier = operation_market_manipulation_mod }
			}
        }
    }
    desc = {
        text = diplospy.150.desc.invalid
        trigger = {
			target = {
				has_modifier = operation_market_manipulation_mod
			}
        }
    }
	picture = GFX_evt_financial_instruments
	show_sound = event_galactic_market
	espionage_operation = yes

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				target = {
					has_modifier = operation_market_manipulation_mod
				}
			}
			set_espionage_operation_progress_locked = yes
		}
	}

	option = {
		name = LAUNCH_OPERATION
		trigger = {
			target = {
				NOT = { has_modifier = operation_market_manipulation_mod }
			}
		}
		hidden_effect = {
			owner = {
				country_event = { id = diplospy.233 days = 1 }
			}
		}
	}
	
	option = {
		name = UNFORTUNATE
		trigger = {
			target = {
				has_modifier = operation_market_manipulation_mod
			}
		}
		set_espionage_operation_progress_locked = no
		root = {
            destroy_espionage_operation = this
        }
	}
}

# Final setup | from = operation
country_event = {
	id = diplospy.233
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			3 = {
				modifier = {
					factor = 1.5
					root = {
						relative_encryption_decryption = {
							target = from.target
							value > 1.3
						}
					}
				}
				modifier = {
					factor = 1.5
					root = {
						is_capitalist = yes
					}
				}
				from = { set_espionage_operation_flag = smooth_exit }
			}
			2 = {
				modifier = {
					factor = 2
					espionage_operation_disguise_disadvantage = yes
				}
				modifier = {
					factor = 1.5
					from.target = {
						is_capitalist = yes
					}
				}
				modifier = {
					factor = 2
					root = {
						is_gestalt = yes # what is economics?
					}
				}
				modifier = {
					factor = 0.3
					from = {
						OR = {
							has_espionage_asset_economy = yes
							has_espionage_asset_manipulation = yes
							has_espionage_asset_criminal = yes
						}
					}
				}
				#'Messy' exit (no flag needed)
			}
		}
		country_event = { id = diplospy.234 days = 3 }
	}
}
# Final | fromfrom = operation
country_event = {
	id = diplospy.234
	title = diplospy.234.name
	desc = {
		trigger = {
			fromfrom = {
				has_espionage_operation_flag = smooth_exit
			}
		}
		text = diplospy.234.desc.smooth
	}
	desc = {
		trigger = {
			fromfrom = {
				NOT = { has_espionage_operation_flag = smooth_exit }
			}
		}
		text = diplospy.234.desc.messy
	}
	picture = GFX_evt_city_planet
	show_sound = event_espionage_concluded
	is_triggered_only = yes

	trigger = {
		exists = fromfrom
	}

	immediate = {
	}

	option = {
		name = {
			text = diplospy.234.a
			trigger = {
				fromfrom = {
					OR = {
						has_espionage_asset = asset_laborer
						has_espionage_asset = asset_economist
						has_espionage_asset = asset_veteran
						has_espionage_asset = asset_bureaucrat
						has_espionage_asset = asset_pop_icon
						has_espionage_asset = asset_newscaster
					}
				}
			}
		}
		name = {
			text = EXCELLENT
			trigger = {
				fromfrom = {
					NOR = {
						has_espionage_asset = asset_laborer
						has_espionage_asset = asset_economist
						has_espionage_asset = asset_veteran
						has_espionage_asset = asset_bureaucrat
						has_espionage_asset = asset_pop_icon
						has_espionage_asset = asset_newscaster
					}
				}
			}
		}
		trigger = {
			fromfrom = { has_espionage_operation_flag = smooth_exit }
		}
		fromfrom.spynetwork = {
			add_spy_network_level_on_success_effect = { VALUE = -20 }
		}
		add_resource = { energy = 5000 }
	}
	option = {
		name = diplospy.234.b
		icon = {
			icon = GFX_espionage_asset_icon
			text = ESPIONAGE_OPERATION_ASSET_EVENT_OPTION
		}
		trigger = {
			fromfrom = {
				has_espionage_operation_flag = smooth_exit
				OR = {
					has_espionage_asset = asset_laborer
					has_espionage_asset = asset_economist
					has_espionage_asset = asset_veteran
					has_espionage_asset = asset_bureaucrat
					has_espionage_asset = asset_pop_icon
					has_espionage_asset = asset_newscaster
				}
			}
		}
		add_resource = { energy = 5000 }
		if = {
			limit = { fromfrom = { has_espionage_asset = asset_laborer } }
			if = {
				limit = { country_uses_food = yes }
				add_resource = { food = 3000 }
				add_resource = { minerals = 3000 }
			}
			else = {
				add_resource = { minerals = 6000 }
			}
			fromfrom = {
				destroy_espionage_asset = asset_laborer
			}
		}
		else_if = {
			limit = { fromfrom = { has_espionage_asset = asset_economist } }
			if = {
				limit = { country_uses_consumer_goods = yes }
				add_resource = { consumer_goods = 3000 }
			}
			else = {
				add_resource = { energy = 6000 }
			}
			fromfrom = {
				destroy_espionage_asset = asset_economist
			}
		}
		else_if = {
			limit = { fromfrom = { has_espionage_asset = asset_veteran } }
			add_resource = { alloys = 1500 }
			fromfrom = {
				destroy_espionage_asset = asset_veteran
			}
		}
		else_if = {
			limit = { fromfrom = { has_espionage_asset = asset_bureaucrat } }
			add_resource = { energy = 6000 }
			fromfrom = {
				destroy_espionage_asset = asset_bureaucrat
			}
		}
		else_if = {
			limit = { fromfrom = { has_espionage_asset = asset_pop_icon } }
			add_resource = { influence = 300 }
			fromfrom = {
				destroy_espionage_asset = asset_pop_icon
			}
		}
		else_if = {
			limit = { fromfrom = { has_espionage_asset = asset_newscaster } }
			add_resource = { unity = 3000 }
			fromfrom = {
				destroy_espionage_asset = asset_newscaster
			}
		}
		fromfrom.spynetwork = {
			add_spy_network_level_on_success_effect = { VALUE = -30 }
		}
	}
	option = {
		name = diplospy.234.messy
		trigger = {
			fromfrom = { NOT = { has_espionage_operation_flag = smooth_exit } }
		}
		fromfrom.spynetwork = {
			add_spy_network_level_on_success_effect = { VALUE = -40 }
		}
		add_resource = { energy = 3000 }
		hidden_effect = {
			fromfrom.target = { set_country_flag = operation_market_manipulation_messy }
		}
	}

	after = {
		destroy_espionage_operation = fromfrom
		fromfrom.target = {
			hidden_effect = { remove_modifier = operation_market_manipulation_mod }
			add_modifier = { modifier = operation_market_manipulation_mod days = @StealTechnologyTimer }
			hidden_effect = { country_event = { id = diplospy.235 } }
		}
	}
}

# Market Crash
country_event = {
	id = diplospy.235
	title = cara.951.name
	desc = {
		text = diplospy.235.desc.smooth
		trigger = {
			NOT = { has_country_flag = operation_market_manipulation_messy }
		}
	}
	desc = {
		text = diplospy.235.desc.messy
		trigger = {
			has_country_flag = operation_market_manipulation_messy
		}
	}
	picture = GFX_evt_financial_instruments
	show_sound = event_galactic_market

	is_triggered_only = yes

	option = {
		name = CURSES
		tooltip = {
			add_modifier = { modifier = operation_market_manipulation_mod days = 3600 }
		}
		if = {
			limit = { has_country_flag = operation_market_manipulation_messy }
			hidden_effect = { remove_country_flag = operation_market_manipulation_messy }
			add_opinion_modifier = { who = from modifier = opinion_market_manipulation }
		}
	}
}