namespace = machinedlc

#ap_single_mind special project effect
#gestalt machine empire -> synth ascended empire
country_event = {
    id = machinedlc.1
	title = "machinedlc.1.name"
	desc = "machinedlc.1.desc"
	picture = GFX_evt_robot_assembly_plant
    is_triggered_only = yes
    show_sound = event_synthetic_evolution

    immediate = {
		if = {
			limit = { has_valid_civic = civic_machine_emotion_emulator_intelligence }
			every_owned_pop = {
				limit = { is_same_species = owner.species }
				modify_species = {
					remove_trait = trait_mechanical
					add_trait = trait_machine_unit
				}
			}
		}
		if = {
			limit = { has_modifier = mod_civic_machine_ee_intelligence }
			remove_modifier = mod_civic_machine_ee_intelligence
		}
		if = {
			limit = { has_technology = tech_machine_division_by_zero }
			add_modifier = { modifier = mod_civic_machinedlc_division_by_zero days = -1 }
		}

		country_remove_ethic = ethic_gestalt_consciousness
		country_add_ethic = ethic_fanatic_materialist
		country_add_ethic = ethic_egalitarian

		change_government = {
			authority = auth_democratic
			civics = {
				civic = civic_idealistic_foundation
			}
		}

		add_resource = { influence = 250 }
		add_resource = { consumer_goods = 15000 }

        give_technology = { tech = tech_robotic_workers message = no }
        give_technology = { tech = tech_droid_workers message = no }
		give_technology = { tech = tech_synthetic_workers message = no }
		give_technology = { tech = tech_synthetic_leaders message = no }

		if = {
			limit = { NOT = { has_technology = tech_machinedlcmod_luxuries_1 } }
			give_technology = { tech = tech_luxuries_1 message = no }
		}
		if = {
			limit = { NOT = { has_technology = tech_machinedlcmod_luxuries_2 } }
			give_technology = { tech = tech_luxuries_2 message = no }
		}

		give_technology = { tech = tech_robomodding message = no }
		give_technology = { tech = tech_robomodding_points_1 message = no }
		give_technology = { tech = tech_robomodding_points_2 message = no }
		
		set_policy = { policy = artificial_intelligence_policy option = ai_full_rights cooldown = yes }
		
        set_country_flag = synthetic_empire
		set_country_flag = synthetic_age

		owner.species = {
			create_species = {
				is_mod = no
				name = this
				namelist = this.prev
				plural = this
				class = "ROBOT"
				portrait = this
				traits = {
					trait = "trait_mechanical"
				}
				traits = this
			}
		}
		every_owned_pop = {
			limit = { species = { has_trait = trait_machine_unit } }
			change_species = last_created
			modify_species = { remove_trait = trait_machine_unit }
			synth_citizenship_set = yes
		}
		change_dominant_species = { species = last_created }
		set_built_species = last_created_species

		owner.species = {
			rename_species = {
				prompt_country = prev #If targeted country is a player they will get a popup asking for a name/plural/adjective combo. Otherwise the species will get a random name from the specified name_list
				name_list = ascension_list
			}
		}

		every_owned_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = { has_trait = trait_machine_unit }
			}
			change_species = last_created
		}

		every_owned_army = {
			limit = {
				exists = species
				exists = planet
				species = { has_trait = trait_machine_unit }
				army_type = assault_army
			}
			modify_army = {
				name = random
				type = "robotic_army"
				species = last_created_species
			}
		}

		every_owned_army = {
			limit = {
				exists = species
				exists = planet
				species = {
					has_trait = trait_machine_unit
				}
				army_type = defense_army
			}
			modify_army = {
				name = random
				type = "robotic_defense_army"
				species = last_created_species
			}
		}
		
		every_owned_leader = {
			change_species = last_created
			change_leader_portrait = species
		}
		every_pool_leader = {
			change_species = last_created
			change_leader_portrait = species
		}
		
		every_owned_leader = {
			limit = {
				species = { has_trait = trait_mechanical }
				NOR = {
					has_trait = leader_trait_admiral_synthetic
					has_trait = leader_trait_general_synthetic
					has_trait = leader_trait_governor_synthetic
					has_trait = leader_trait_scientist_synthetic
					has_trait = leader_trait_ruler_synthetic
				}
			}
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_admiral_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_general_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_governor_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_scientist_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_ruler_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
		}
		every_pool_leader = {
			limit = {
				species = { has_trait = trait_mechanical }
				NOR = {
					has_trait = leader_trait_admiral_synthetic
					has_trait = leader_trait_general_synthetic
					has_trait = leader_trait_governor_synthetic
					has_trait = leader_trait_scientist_synthetic
					has_trait = leader_trait_ruler_synthetic
				}
			}
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_admiral_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_general_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_governor_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_scientist_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_ruler_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
		}

		if = {
			limit = { has_ascension_perk = ap_biomachine_project }
			give_technology = { tech = tech_ap_biorobot_project message = no }
		}
		#bio machine -> bio robot
		every_owned_pop = {
			limit = { has_trait = trait_biorobot }
			species = {
				create_species = {
					is_mod = no
					name = this
					namelist = this.prevprev
					plural = this
					class = "BIOROBOT"
					portrait = this
					traits = {
						trait = trait_mechanical
						trait = trait_biorobot_2
					}
					traits = this
				}
			}
			change_species = last_created
			modify_species = { remove_trait = trait_biorobot }
			synth_citizenship_set = yes
		}
		if = {
			limit = { owner.species = { has_trait = trait_biorobot } }
			change_dominant_species = { species = last_created change_all = yes }
			set_built_species = last_created_species
		}

		country_event = { id = machinedlc.26 days = 1 }
		country_event = { id = machinedlc.58 days = 1 }
    }

    option = {
		name = machinedlc.1.a
		hidden_effect = {
			country_event = { id = machinedlc.18 days = 5 }
			if = {
				limit = {
					any_country = {
						is_fallen_empire_spiritualist = yes
						has_communications = root
						NOT = { is_same_value = root }
					}
				}
				random_country = {
					limit = {
						is_fallen_empire_spiritualist = yes
						has_communications = root
						NOT = { is_same_value = root }
					}
					save_event_target_as = ap_single_mind_interaction_fe
				}
				country_event = { id = machinedlc.80 days = 15 }
			}
		}
	}
}
#ap_united_mind special project effect
#synth ascended empire -> gestalt machine empire
country_event = {
    id = machinedlc.2
	title = "machinedlc.2.name"
	desc = "machinedlc.2.desc"
	picture = GFX_evt_robot_assembly_plant
	show_sound = event_synthetic_evolution
	
	is_triggered_only = yes

    immediate = {
		add_resource = { influence = 250 }

		remove_country_flag = synthetic_empire
		remove_country_flag = synthetic_age

		create_country = {
			type = default
			origin = origin_default
			ignore_initial_colony_error = yes
			ethos = { ethic = ethic_gestalt_consciousness }
			authority = auth_machine_intelligence
			effect = { save_event_target_as = ethos_and_auth_copy_target }
		}
		copy_ethos_and_authority = event_target:ethos_and_auth_copy_target
		change_government = {
			civics = { civic = civic_machine_zero_waste_protocols }
		}
		event_target:ethos_and_auth_copy_target = {
			destroy_country = yes
		}

		owner.species = {
			create_species = {
				is_mod = no
				name = this
				namelist = this.prev
				plural = this
				class = "MACHINE"
				portrait = this
				traits = {
					trait = "trait_machine_unit"
				}
				traits = this
			}
		}
		every_owned_pop = {
			limit = {
				species = {
					has_trait = trait_mechanical
					NOT = { has_trait = trait_biorobot_2 }
				}
			}
			change_species = last_created
			modify_species = { remove_trait = trait_mechanical }
			if = {
				limit = { has_trait = trait_psionic }
				modify_species = {
					remove_trait = trait_psionic
					add_trait = trait_machinedlcmod_psionic
				}
			}
			machine_citizenship_set = yes
		}
		change_dominant_species = { species = last_created }
		set_built_species = last_created_species
		
		owner.species = {
			rename_species = {
				prompt_country = prev #If targeted country is a player they will get a popup asking for a name/plural/adjective combo. Otherwise the species will get a random name from the specified name_list
				name_list = ascension_list
			}
		}

		every_owned_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = { has_trait = trait_mechanical }
			}
			change_species = last_created
		}

		every_owned_army = {
			limit = {
				exists = species
				exists = planet
				species = { has_trait = trait_mechanical }
				army_type = assault_army
			}
			modify_army = {
				name = random
				type = "robotic_army"
				species = last_created_species
			}
		}

		every_owned_army = {
			limit = {
				exists = species
				exists = planet
				species = { has_trait = trait_mechanical }
				army_type = defense_army
			}
			modify_army = {
				name = random
				type = "robotic_defense_army"
				species = last_created_species
			}
		}
		
		every_owned_leader = {
			change_species = last_created
			change_leader_portrait = species
		}
		every_pool_leader = {
			change_species = last_created
			change_leader_portrait = species
		}

		every_owned_leader = {
			limit = {
				species = { has_trait = trait_machine_unit }
				OR = {
					has_trait = leader_trait_admiral_synthetic
					has_trait = leader_trait_general_synthetic
					has_trait = leader_trait_governor_synthetic
					has_trait = leader_trait_scientist_synthetic
					has_trait = leader_trait_ruler_synthetic
				}
			}
			if = {
				limit = { leader_class = admiral }
				remove_trait = leader_trait_admiral_synthetic
				remove_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = general }
				remove_trait = leader_trait_general_synthetic
				remove_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = governor }
				remove_trait = leader_trait_governor_synthetic
				remove_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = scientist }
				remove_trait = leader_trait_scientist_synthetic
				remove_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = ruler }
				remove_trait = leader_trait_ruler_synthetic
				remove_ruler_trait = leader_trait_ruler_synthetic
			}
		}
		every_pool_leader = {
			limit = {
				species = { has_trait = trait_machine_unit }
				OR = {
					has_trait = leader_trait_admiral_synthetic
					has_trait = leader_trait_general_synthetic
					has_trait = leader_trait_governor_synthetic
					has_trait = leader_trait_scientist_synthetic
					has_trait = leader_trait_ruler_synthetic
				}
			}
			if = {
				limit = { leader_class = admiral }
				remove_trait = leader_trait_admiral_synthetic
				remove_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = general }
				remove_trait = leader_trait_general_synthetic
				remove_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = governor }
				remove_trait = leader_trait_governor_synthetic
				remove_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = scientist }
				remove_trait = leader_trait_scientist_synthetic
				remove_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = ruler }
				remove_trait = leader_trait_ruler_synthetic
				remove_ruler_trait = leader_trait_ruler_synthetic
			}
		}

		give_technology = { tech = tech_robomodding_m message = no }
		give_technology = { tech = tech_binary_motivators message = no }
		give_technology = { tech = tech_nanite_assemblers message = no }
		give_technology = { tech = tech_machinedlcmod_processing_capacity message = no }
		give_technology = { tech = tech_machine_processor_1 message = no }
		give_technology = { tech = tech_machine_processor_2 message = no }

		if = {
			limit = { has_ascension_perk = ap_biorobot_project }
			give_technology = { tech = tech_ap_biomachine_project message = no }
		}
		#bio robot -> bio machine
		every_owned_pop = {
			limit = { has_trait = trait_biorobot_2 }
			species = {
				create_species = {
					is_mod = no
					name = this
					namelist = this.prevprev
					plural = this
					class = "BIOMACHINE"
					portrait = this
					traits = {
						trait = trait_mechanical
						trait = trait_biorobot
					}
					traits = this
				}
			}
			change_species = last_created
			modify_species = { remove_trait = trait_biorobot_2 }
			machine_citizenship_set = yes
		}
		if = {
			limit = { owner.species = { has_trait = trait_biorobot_2 } }
			change_dominant_species = { species = last_created change_all = yes }
			set_built_species = last_created_species
		}

		country_event = { id = machinedlc.36 days = 1 }
		country_event = { id = machinedlc.58 days = 1 }
    }

    option = {
		name = machinedlc.2.a
		hidden_effect = {
			if = {
				limit = {
					any_country = {
						is_fallen_empire_machine = yes
						has_communications = root
						NOT = { is_same_value = root }
					}
				}
				random_country = {
					limit = {
						is_fallen_empire_machine = yes
						has_communications = root
						NOT = { is_same_value = root }
					}
					save_event_target_as = ap_united_mind_interaction_fe
				}
				country_event = { id = machinedlc.3 days = 15 }
			}
		}
	}
}
country_event = {
	id = machinedlc.3
	title = "machinedlc.3.name"
	desc = "machinedlc.3.desc"
	location = event_target:ap_united_mind_interaction_fe.capital_scope
	diplomatic = yes
	is_triggered_only = yes
	
	picture_event_data = {
		portrait = event_target:ap_united_mind_interaction_fe
		planet_background = event_target:ap_united_mind_interaction_fe
		graphical_culture = event_target:ap_united_mind_interaction_fe
		city_level = event_target:ap_united_mind_interaction_fe
		room = event_target:ap_united_mind_interaction_fe.ruler
	}

	option = {
		name = machinedlc.3.a
		add_resource = {
			energy = 2000
			minerals = 2000
		}
	}
}
#origin_machinedlc_synth_ascended and origin_machinedlc_synth_heritage effect on_action event
country_event = {
    id = machinedlc.4
    hide_window = yes
	is_triggered_only = yes

    immediate = {
		give_technology = { tech = tech_robotic_workers message = no }
        give_technology = { tech = tech_droid_workers message = no }
		give_technology = { tech = tech_synthetic_workers message = no }
		give_technology = { tech = tech_synthetic_leaders message = no }
		give_technology = { tech = tech_robomodding message = no }
        set_policy = { policy = artificial_intelligence_policy option = ai_full_rights cooldown = yes }

        set_country_flag = synthetic_empire
		set_country_flag = synthetic_age

		if = {
			limit = { NOT = { has_country_flag = machinedlc_start_adjustment_happened } }
			machinedlcmod_event_start_condition_adjustment = yes
		}

		owner.species = {
			create_species = {
				is_mod = yes
				name = this
				namelist = this.prev
				plural = this
				class = "ROBOT"
				portrait = this
				traits = {
					trait = "trait_mechanical"
				}
				traits = this
			}		
		}

		every_owned_pop = {
			limit = { species = { NOT = { has_trait = trait_mechanical } } }
			change_species = last_created
			machinedlcmod_species_modify_clear_trait_pc_preference = yes
			species_modify_change_trait_lithoid = yes
			synth_citizenship_set = yes
		}
		change_dominant_species = { species = last_created }
		set_built_species = last_created_species

		owner.species = {
			rename_species = {
				prompt_country = prev #If targeted country is a player they will get a popup asking for a name/plural/adjective combo. Otherwise the species will get a random name from the specified name_list
				name_list = ascension_list
			}
		}

		every_owned_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = { NOT = { has_trait = trait_mechanical } }
			}
			change_species = last_created
		}

		every_owned_army = {
			limit = {
				exists = species
				exists = planet
				species = {
					NOT = { has_trait = trait_mechanical }
				}
				army_type = assault_army
			}
			modify_army = {
				name = random
				type = "robotic_army"
				species = last_created_species
			}
		}

		every_owned_army = {
			limit = {
				exists = species
				exists = planet
				species = {
					NOT = { has_trait = trait_mechanical }
				}
				army_type = defense_army
			}
			modify_army = {
				name = random
				type = "robotic_defense_army"
				species = last_created_species
			}
		}
		
		every_owned_leader = {
			change_species = last_created
			change_leader_portrait = species
		}
		every_pool_leader = {
			change_species = last_created
			change_leader_portrait = species
		}
		
		every_owned_leader = {
			limit = {
				species = { has_trait = trait_mechanical }
				NOR = {
					has_trait = leader_trait_admiral_synthetic
					has_trait = leader_trait_general_synthetic
					has_trait = leader_trait_governor_synthetic
					has_trait = leader_trait_scientist_synthetic
					has_trait = leader_trait_ruler_synthetic
				}
			}
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_admiral_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_general_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_governor_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_scientist_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_ruler_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
		}
		every_pool_leader = {
			limit = {
				species = { has_trait = trait_mechanical }
				NOR = {
					has_trait = leader_trait_admiral_synthetic
					has_trait = leader_trait_general_synthetic
					has_trait = leader_trait_governor_synthetic
					has_trait = leader_trait_scientist_synthetic
					has_trait = leader_trait_ruler_synthetic
				}
			}
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_admiral_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_general_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_governor_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_scientist_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_ruler_synthetic
				add_ruler_trait = leader_trait_ruler_synthetic
			}
		}
    }
}
#ap_war_protocol special projects
country_event = {
    id = machinedlc.5
    hide_window = yes
    is_triggered_only = yes
    
	immediate = {
        if = {
			limit = { count_country = { limit = { is_fallen_empire_machine = yes } count >= 1 } }
			capital_scope = {
				enable_special_project = {
					name = "FALLEN_MACHINE_PROJECT"
					location = this
					owner = root
				}
			}
		}
		if = {
			limit = { count_country = { limit = { is_fallen_empire_machine = yes } count = 0 } }
			capital_scope = {
				enable_special_project = {
					name = "TOTAL_WAR_PROJECT"
					location = this
					owner = root
				}
			}
		}
	}
}
#fallen machine project completed
country_event = {
    id = machinedlc.6
    hide_window = yes
    is_triggered_only = yes
    
	immediate = {
		random_list = {
			70 = { #failed
				country_event = { id = machinedlc.9 } 
		    }
			30 = { #suceed
				every_country = {
					limit = { is_fallen_empire_machine = yes }
					country_event = { id = machinedlc.7 }
				}
		    }
		}
	}
}
#hacking suceed
country_event = {
	id = machinedlc.7
	hide_window = yes
	is_triggered_only = yes

	immediate = {	
		set_country_type = default
		
		capital_scope = {
			remove_district = district_rw_science
			remove_district = district_rw_science
			remove_district = district_rw_science
			remove_district = district_rw_science
			remove_district = district_rw_science

			add_district = district_rw_nexus
			add_district = district_rw_nexus
			add_district = district_rw_nexus
			add_district = district_rw_generator
			add_district = district_rw_generator
        } 

		change_government = {
			authority = auth_machine_intelligence
			civics = {
				civic = civic_awakened_machine
				civic = civic_malfunctioning_custodian
				civic = civic_machine_terminator
				civic = civic_machine_warfleet
			}
		}	

        join_alliance = {
			who = FROM
			override_requirements = yes
		}

		add_opinion_modifier = {
			who = FROM
			modifier = triggered_opinion_enlightened_fe
		}

		# Changing country type resets resources, so give them full stores
		add_resource = { minerals = 20000 }
		add_resource = { energy = 20000 }
		add_resource = { influence = 1000 }

		every_owned_planet = {
			remove_building = building_ancient_cryo_chamber
			remove_building = building_ancient_cryo_chamber
			remove_building = building_ancient_cryo_chamber
			remove_building = building_ancient_cryo_chamber

			remove_building = building_ancient_cryo_chamber
			remove_building = building_ancient_cryo_chamber
			remove_building = building_ancient_cryo_chamber
			remove_building = building_ancient_cryo_chamber

			remove_building = building_ancient_cryo_chamber
			remove_building = building_ancient_cryo_chamber
			remove_building = building_ancient_cryo_chamber
			remove_building = building_ancient_cryo_chamber #12 total

			add_building = building_machinedlc_planet_processor_3
		}

		# Add some more fleet
		country_event = { id = fallen_empires.13 }

		# Establish communications
		every_country = {
			limit = {
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
				NOT = { has_communications = root }
			}

			establish_communications_no_message = root
		}
		
		save_event_target_as = awakened_machine_empire
		
		# Notify players
		every_country = {
			limit = { is_ai = no }
			country_event = { id = machinedlc.8 }
		}
	}
}
#hacked machine fe transmission
country_event = {
	id = machinedlc.8
	title = "machinedlc.8.name"
	desc = "machinedlc.8.desc"
	location = event_target:awakened_machine_empire.capital_scope
	show_sound = event_ai_started
	diplomatic = yes
	is_triggered_only = yes
	
	picture_event_data = {
		portrait = event_target:awakened_machine_empire
		planet_background = event_target:awakened_machine_empire
		graphical_culture = event_target:awakened_machine_empire
		city_level = event_target:awakened_machine_empire
		room = event_target:awakened_machine_empire.ruler
	}

	option = {
		trigger = {
            has_valid_civic = civic_machine_terminator
		}	
		name = machinedlc.8.a
	}
	option = {
		trigger = {
            NOT = { has_valid_civic = civic_machine_terminator }
		}	
		name = machinedlc.8.b
	}
}
#hacking failed
country_event = {
    id = machinedlc.9
	title = "machinedlc.9.name"
	desc = "machinedlc.9.desc"
	picture = GFX_evt_glitchy_matrix
	is_triggered_only = yes

	option = { #do it again
		name = machinedlc.9.a
		hidden_effect = {
			capital_scope = {
				enable_special_project = {
					name = "FALLEN_MACHINE_PROJECT"
					location = this
					owner = root
				}
			}
		}		
	}
    option = { #it's over...
		name = machinedlc.9.b
		add_resource = { influence = 250 }
	}
}
#total war project completed
country_event = {
    id = machinedlc.10
	title = "machinedlc.10.name"
	desc = "machinedlc.10.desc"
	picture = GFX_evt_fleet_from_surface
	is_triggered_only = yes

    immediate = {
		set_country_flag = machinedlcmod_total_war_allowed
	}

	option = {
		name = machinedlc.10.a
	}
}
#total war policy on_action event
country_event = {
    id = machinedlc.11
    hide_window = yes
	is_triggered_only = yes
 
    trigger = {
		has_country_flag = machinedlcmod_total_war_allowed
		has_policy_flag = machinedlcmod_total_war_policy_on
	}

    immediate = {
		set_policy = {
			policy = machinedlcmod_total_war_policy
			option = machinedlcmod_total_war_policy_off
			cooldown = no
		}
	}
}
#decision_smart_factory_project event
planet_event = {
    id = machinedlc.12
	title = "machinedlc.12.name"
	desc = "machinedlc.12.desc"
	picture = GFX_evt_smart_factory
	show_sound = event_cityscape
	location = root

	is_triggered_only = yes

	option = {
		name = machinedlc.12.a
	}
}
#decision_cpu_project event
planet_event = {
    id = machinedlc.13
	title = "machinedlc.13.name"
	desc = "machinedlc.13.desc"
	picture = GFX_evt_cpu
	show_sound = event_cityscape
	location = root
	
	is_triggered_only = yes

	option = {
		name = machinedlc.13.a
	}
}
#decision_central_network_project event
planet_event = {
    id = machinedlc.14
	title = "machinedlc.14.name"
	desc = "machinedlc.14.desc"
	picture = GFX_evt_central_network
	show_sound = event_cityscape
	location = root

	is_triggered_only = yes

	option = {
		name = machinedlc.14.a
	}
}
#civic_machinedlcmod_trading_machine effect on_action event
country_event = {
    id = machinedlc.15
    hide_window = yes
    is_triggered_only = yes
	 
	trigger = {
		has_valid_civic = civic_machinedlcmod_trading_machine
	}

    immediate = {
		if = {
			limit = { NOT = { has_country_flag = machinedlc_start_adjustment_happened } }
			machinedlcmod_event_start_condition_adjustment = yes
		}
	}
}
#origin_machinedlc_machine_heritage effect on_action event
country_event = {
    id = machinedlc.16
    hide_window = yes
    is_triggered_only = yes
	 
	trigger = {
		has_origin = origin_machinedlc_machine_heritage
	}

    immediate = {
		if = {
			limit = { NOT = { has_country_flag = machinedlc_start_adjustment_happened } }
			machinedlcmod_event_start_condition_adjustment = yes
		}
	}

}
planet_event = {
    id = machinedlc.17
	title = "machinedlc.17.name"
	desc = "machinedlc.17.desc"
	picture = GFX_evt_ancient_databank
	is_triggered_only = yes
	location = root

    immediate = {
		set_planet_flag = planet_machinedlc_relic_1
		add_modifier = {
			modifier = mod_machine_drone_storage
			days = -1
		}
		owner = {
			if = {
				limit = { is_ai = no }
				set_country_flag = country_machinedlc_relic
				root = { planet_event = { id = machinedlc_relic.1 days = 60 } }
			}
		}
	}

	option = {
		name = machinedlc.17.a
		create_pop = { species = owner.species }
		owner = {
			add_research_option = tech_robomodding_m
			add_tech_progress = { tech = tech_robomodding_m progress = 0.25 }
		}
	}
}
#ethic changing event chains for machinedlc.1 event
country_event = {
    id = machinedlc.18
	title = "machinedlc.18.name"
	desc = "machinedlc.18.desc"
	is_triggered_only = yes
	picture = GFX_evt_galactic_senate

	option = {
		name = machinedlc.18.a #yes
		country_event = { id = machinedlc.19 }
	}
	option = {
		name = machinedlc.18.b #no
		add_resource = { influence = 150 }
	}	
}
#event chain xenophobe vs xenophile
country_event = {
    id = machinedlc.19
	title = "machinedlc.19.name"
	desc = "machinedlc.19.desc"
	is_triggered_only = yes
	picture = GFX_evt_galactic_senate

	option = {
		name = machinedlc.19.a #xenophobe
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_xenophobe 	
		country_event = { id = machinedlc.20 } #pass to next
	}	
	option = {
		name = machinedlc.19.b #fanatic xenophobe
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_fanatic_xenophobe
		country_event = { id = machinedlc.20 } #pass to next
	}
	option = {
		name = machinedlc.19.c 
		country_event = { id = machinedlc.20 } #pass to next
	}	
	option = {
		name = machinedlc.19.d #xenophile
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_xenophile
		country_event = { id = machinedlc.20 } #pass to next
	}
	option = {
		name = machinedlc.19.e #fanatic xenophile
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_fanatic_xenophile
		country_event = { id = machinedlc.20 } #pass to next
	}		
}
#event chain militarist vs pacifist
country_event = {
    id = machinedlc.20
	title = "machinedlc.20.name"
	desc = "machinedlc.20.desc"
	is_triggered_only = yes
	picture = GFX_evt_galactic_senate

	option = {
		name = machinedlc.20.a #militarist
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_militarist
		country_event = { id = machinedlc.21 } #pass to next
	}	
	option = {
		name = machinedlc.20.b #fanatic militarist
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_fanatic_militarist
		country_event = { id = machinedlc.21 } #pass to next
	}
	option = {
		name = machinedlc.20.c 
		country_event = { id = machinedlc.21 } #pass to next
	}	
	option = {
		name = machinedlc.20.d #pacifist
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_pacifist
		country_event = { id = machinedlc.21 } #pass to next
	}
	option = {
		name = machinedlc.20.e #fanatic pacifist
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_fanatic_pacifist
		country_event = { id = machinedlc.21 } #pass to next
	}		
}
#event chain authoritarian vs egalitarian
country_event = {
    id = machinedlc.21
	title = "machinedlc.21.name"
	desc = "machinedlc.21.desc"
	is_triggered_only = yes
	picture = GFX_evt_galactic_senate

	option = {
		name = machinedlc.21.a #authoritarian
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_authoritarian
		country_event = { id = machinedlc.22 } #pass to next
	}	
	option = {
		name = machinedlc.21.b #fanatic authoritarian
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_fanatic_authoritarian
		country_event = { id = machinedlc.22 } #pass to next
	}
	option = {
		name = machinedlc.21.c 
		country_event = { id = machinedlc.22 } #pass to next
	}	
	option = {
		name = machinedlc.21.d #egalitarian
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
		}

		shift_ethic = ethic_egalitarian
		country_event = { id = machinedlc.22 } #pass to next
	}
	option = {
		name = machinedlc.21.e #fanatic egalitarian
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_fanatic_egalitarian
		country_event = { id = machinedlc.22 } #pass to next
	}		
}
#event chain materialist vs spiritualist
country_event = {
    id = machinedlc.22
	title = "machinedlc.22.name"
	desc = "machinedlc.22.desc"
	is_triggered_only = yes
	picture = GFX_evt_galactic_senate

	option = {
		name = machinedlc.22.a #materialist
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_materialist
		country_event = { id = machinedlc.23 } #pass to next
	}	
	option = {
		name = machinedlc.22.b #fanatic materialist
		hidden_effect = {
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_fanatic_materialist
		country_event = { id = machinedlc.23 } #pass to next
	}
	option = {
		name = machinedlc.22.c
		country_event = { id = machinedlc.23 } #pass to next
	}	
	option = {
		name = machinedlc.22.d #spiritualist
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_spiritualist
		country_event = { id = machinedlc.23 } #pass to next
	}
	option = {
		name = machinedlc.22.e #fanatic spiritualist
		hidden_effect = {
			country_remove_ethic = ethic_fanatic_materialist
			country_remove_ethic = ethic_egalitarian
		}

		shift_ethic = ethic_fanatic_spiritualist
		country_event = { id = machinedlc.23 } #pass to next
	}		
}
#event chains over
country_event = {
    id = machinedlc.23
	title = "machinedlc.23.name"
	desc = "machinedlc.23.desc"
	is_triggered_only = yes
	picture = GFX_evt_galactic_senate

	option = {
		name = machinedlc.23.a #do it again
		country_event = { id = machinedlc.19 }
	}
	option = {
		name = machinedlc.23.b #no
		custom_tooltip = tooltip.machinedlc.23.b
	}	
}
#decision_machine_world_auto_project event
planet_event = {
    id = machinedlc.24
	title = "machinedlc.24.name"
	desc = "machinedlc.24.desc"
	picture = GFX_evt_machine_auto
	show_sound = event_cityscape
	location = root

	is_triggered_only = yes

	trigger = {
		is_planet_class = pc_machine
		OR = {
			solar_system = { owner = { has_ascension_perk = ap_planetary_system } }			
			owner = { has_ascension_perk = ap_planetary_system }
		}
	}

    immediate = {
		while = {
			limit = { has_district = district_nexus }
			remove_district = district_nexus
			change_variable = { which = count_district_nexus value = 1 }
		}
		while = {
			limit = { has_district = district_generator_uncapped }
			remove_district = district_generator_uncapped
			change_variable = { which = count_district_generator_uncapped value = 1 }
		}
		while = {
			limit = { has_district = district_mining_uncapped }
			remove_district = district_mining_uncapped
			change_variable = { which = count_district_mining_uncapped value = 1 }
		}
		change_pc = pc_machine_auto
		while = {
			limit = { NOT = { check_variable = { which = count_district_nexus value = 0 } } }
			add_district = district_machinedlc_drone_storage_auto
			subtract_variable = { which = count_district_nexus value = 1 }
		}
		while = {
			limit = { NOT = { check_variable = { which = count_district_generator_uncapped value = 0 } } }
			add_district = district_machinedlc_generator_uncapped_auto
			subtract_variable = { which = count_district_generator_uncapped value = 1 }
		}
		while = {
			limit = { NOT = { check_variable = { which = count_district_mining_uncapped value = 0 } } }
			add_district = district_machinedlc_mining_uncapped_auto
			subtract_variable = { which = count_district_mining_uncapped value = 1 }
		}
	}

	option = {
		name = machinedlc.24.a
	}
}
#special project SYNTH_CYBER_PROJECT event
country_event = {
	id = machinedlc.25
	title = "machinedlc.25.name"
	desc = "machinedlc.25.desc"
	picture = GFX_evt_binary_code

	is_triggered_only = yes

	immediate = {
		every_owned_pop = {
			limit = {
				has_trait = trait_mechanical 
				NOT = { has_trait = trait_biorobot_2 }
			}
			modify_species = { add_trait = trait_virtualized_synth }
			synth_citizenship_set = yes
		}
		every_owned_pop = {
			limit = { has_trait = trait_biorobot_2 }
			modify_species = { add_trait = trait_virtualized_synth }
			synth_citizenship_set = yes
		}
	}

	option = {
		name = machinedlc.25.a
	}
}
#for 'Individual Mind' perk empire
country_event = {
	id = machinedlc.26
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		calculate_mod_emotion_shock = yes
    }
}
#for trait_robot_memory_server on_action event
country_event = {
	id = machinedlc.27
	hide_window = yes
	is_triggered_only = yes
	
    trigger = {
		any_owned_pop = { has_trait = trait_shared_memory }
	}

	immediate = {
		every_owned_leader = {
			limit = {
				OR = {
					has_skill = 1
					has_skill = 2
				}
				species = { has_trait = trait_shared_memory }
			}
			set_skill = 3
		}
		every_pool_leader = {
			limit = {
				OR = {
					has_skill = 1
					has_skill = 2
				}
				species = { has_trait = trait_shared_memory }
			}
			set_skill = 3
		}
    }

}
#ap_biomachine_project special project event
country_event = {
    id = machinedlc.28
	title = "machinedlc.28.name"
	desc = "machinedlc.28.desc"
	is_triggered_only = yes
	picture = GFX_evt_cybernetics

    immediate = {
		if = {
			limit = {
				OR = {
					has_valid_civic = civic_machine_emotion_emulator_intelligence
					has_modifier = mod_civic_machine_ee_intelligence
				}
			}
			create_species = {
				is_mod = no
				name = this
				namelist = this
				plural = this
				class = "BIOMACHINE_2"
				portrait = "human"
				traits = {
					trait = "trait_mechanical"
					trait = "trait_biorobot"
				}
				effect = {
					rename_species = {
						prompt_country = prev #If targeted country is a player they will get a popup asking for a name/plural/adjective combo. Otherwise the species will get a random name from the specified name_list
						name_list = ascension_list
					}
					save_event_target_as = BIOMACHINE_target_species
				}
			}
			else = {
				create_species = {
					is_mod = no
					name = this
					namelist = this
					plural = this
					class = "BIOMACHINE"
					portrait = "human"
					traits = {
						trait = "trait_mechanical"
						trait = "trait_biorobot"
					}
					effect = {
						rename_species = {
							prompt_country = prev #If targeted country is a player they will get a popup asking for a name/plural/adjective combo. Otherwise the species will get a random name from the specified name_list
							name_list = ascension_list
						}
						save_event_target_as = BIOMACHINE_target_species
					}
				}
			}
		}
		add_resource = { food = 1000 }
		every_owned_planet = {
			create_pop = { species = event_target:BIOMACHINE_target_species }
		}
		every_owned_pop = {
			limit = { has_trait = trait_biorobot }
			machine_citizenship_set = yes
		}
	}

	option = {
		name = machinedlc.28.a
	}
	option = {
		name = machinedlc.28.b
		custom_tooltip = machinedlc.28.b.tooltip
		hidden_effect = {
			every_owned_pop = {
				change_species = event_target:BIOMACHINE_target_species
			}
			change_dominant_species = { species = event_target:BIOMACHINE_target_species }
			every_owned_leader = {
				change_species = event_target:BIOMACHINE_target_species
				change_leader_portrait = species
			}
			every_pool_leader = {
				change_species = event_target:BIOMACHINE_target_species
				change_leader_portrait = species
			}
		}
	}	
}
#civic_quantity_over_quality effect on_action event
country_event = {
	id = machinedlc.29
	hide_window = yes
	is_triggered_only = yes
	
    trigger = {
		has_valid_civic = civic_quantity_over_quality
	}

	immediate = {
		random_owned_fleet = {
			limit = { is_ship_class = shipclass_military }
			create_ship = {
				name = random
				random_existing_design = corvette
			}
			create_ship = {
				name = random
				random_existing_design = corvette
			}
		}
    }

}
event = {
	id = machinedlc.30
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_global_flag = machinedlc_new_feature_1
		set_global_flag = machinedlc_new_feature_2
		set_global_flag = machinedlc_new_feature_3
		set_global_flag = machinedlc_new_feature_4
		set_global_flag = machinedlc_new_feature_5
	}
}
#erudite_biorobot trait effect on_action event
country_event = {
	id = machinedlc.31
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		from = { species = { has_trait = trait_erudite_biorobot } }
	}

	immediate = {
		from = {
			if = {
				limit = { leader_class = admiral }
				add_trait = leader_trait_admiral_erudite
				add_ruler_trait = leader_trait_ruler_erudite
				break = yes
			}
			if = {
				limit = { leader_class = general }
				add_trait = leader_trait_general_erudite
				add_ruler_trait = leader_trait_ruler_erudite
				break = yes
			}
			if = {
				limit = { leader_class = governor }
				add_trait = leader_trait_governor_erudite
				add_ruler_trait = leader_trait_ruler_erudite
				break = yes
			}
			if = {
				limit = { leader_class = scientist }
				add_trait = leader_trait_scientist_erudite
				add_ruler_trait = leader_trait_ruler_erudite
				break = yes
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_ruler_erudite
				add_ruler_trait = leader_trait_ruler_erudite
				break = yes
			}
		}
	}
}
#ap_machinedlc_psionic_theory effect event
country_event = {
	id = machinedlc.32
	title = "machinedlc.32.name"
	desc = "machinedlc.32.desc"
	picture = GFX_evt_psionics
	show_sound = event_the_great_awakening
	
	is_triggered_only = yes

	immediate = {
		save_event_target_as = breach_shroud_owner
		every_owned_pop = {
			limit = { is_same_species = root }
			modify_species = {
				species = this
				add_trait = trait_psionic
			}
		}
        change_dominant_species = { species = last_created change_all = yes }
        every_owned_leader = {
            limit = {
                species = { has_trait = trait_mechanical }
                NOR = {
                    has_trait =	leader_trait_admiral_psionic
                    has_trait =	leader_trait_general_psionic
                    has_trait =	leader_trait_governor_psionic
                    has_trait =	leader_trait_scientist_psionic
                    has_trait =	leader_trait_ruler_psionic
                }
            }
            if = {
                limit = { leader_class = admiral }
                add_trait = leader_trait_admiral_psionic
                add_ruler_trait = leader_trait_ruler_psionic
            }
            if = {
                limit = { leader_class = general }
                add_trait = leader_trait_general_psionic
                add_ruler_trait = leader_trait_ruler_psionic
            }
            if = {
                limit = { leader_class = governor }
                add_trait = leader_trait_governor_psionic
                add_ruler_trait = leader_trait_ruler_psionic
            }
            if = {
                limit = { leader_class = scientist }
                add_trait = leader_trait_scientist_psionic
                add_ruler_trait = leader_trait_ruler_psionic
            }
            if = {
                limit = { leader_class = ruler }
                add_trait = leader_trait_ruler_psionic
                add_ruler_trait = leader_trait_ruler_psionic
            }
        }
        every_pool_leader = {
            limit = {
                species = { has_trait = trait_mechanical }
                NOR = {
                    has_trait = leader_trait_admiral_psionic
                    has_trait = leader_trait_general_psionic
                    has_trait = leader_trait_governor_psionic
                    has_trait = leader_trait_scientist_psionic
                    has_trait = leader_trait_ruler_psionic
                }
            }
            if = {
                limit = { leader_class = admiral }
                add_trait = leader_trait_admiral_psionic
                add_ruler_trait = leader_trait_ruler_psionic
            }
            if = {
                limit = { leader_class = general }
                add_trait = leader_trait_general_psionic
                add_ruler_trait = leader_trait_ruler_psionic
            }
            if = {
                limit = { leader_class = governor }
                add_trait = leader_trait_governor_psionic
                add_ruler_trait = leader_trait_ruler_psionic
            }
            if = {
                limit = { leader_class = scientist }
                add_trait = leader_trait_scientist_psionic
                add_ruler_trait = leader_trait_ruler_psionic
            }
            if = {
                limit = { leader_class = ruler }
                add_trait = leader_trait_ruler_psionic
                add_ruler_trait = leader_trait_ruler_psionic
            }
        }
	}
	
	option = {
		name = "machinedlc.32.a"
	}
}
country_event = {
	id = machinedlc.33
	title = "machinedlc.33.name"
	desc = "machinedlc.33.desc"
	picture = GFX_evt_machine_sapience
	show_sound = event_psionic
	
	is_triggered_only = yes

	immediate = {
		save_event_target_as = breach_shroud_owner_machine
		random_country = {
			limit = { is_country_type = machinedlcmod_shroud }
			save_event_target_as = the_machinedlcmod_shroud
		}
	}

	option = {
		name = "machinedlc.33.a"
		establish_communications_no_message = event_target:the_machinedlcmod_shroud
		hidden_effect = {
			set_country_flag = shroud_intro
			country_event = { id = endim.3000 }
		}
	}
}
#change species from robot to machine
country_event = {
	id = machinedlc.34
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = machinedlc_new_feature_2
		has_authority = auth_machine_intelligence
		is_ai = no
	}
	
	immediate = {
		if = {
			limit = { NOT = { has_global_flag = machinedlc_new_feature_4 } }
			every_owned_pop = {
				limit = {
					NOR = {
						has_trait = trait_biorobot 
						has_trait = trait_biorobot_2
					}
					is_species_class = ROBOT
				}
				species = {
					create_species = {
						is_mod = no
						name = this
						namelist = this.prevprev
						plural = this
						class = "MACHINE"
						portrait = this
						traits = {
							trait = "trait_machine_unit"
						}
						traits = this
					}
				}
				change_species = last_created
				modify_species = { remove_trait = trait_mechanical }
				machine_citizenship_set = yes
			}
		}
		if = {
			limit = { has_global_flag = machinedlc_new_feature_4 }
			every_owned_pop = {
				limit = {
					NOR = {
						has_trait = trait_biorobot 
						has_trait = trait_biorobot_2
					}
					is_species_class = ROBOT
				}
				change_species = owner.species
			}
		}
		every_owned_pop = {
			limit = { has_trait = trait_biorobot_2 }
			species = {
				create_species = {
					is_mod = no
					name = this
					namelist = this.prevprev
					plural = this
					class = "BIOMACHINE"
					portrait = this
					traits = {
						trait = trait_mechanical
						trait = trait_biorobot
					}
					traits = this
				}
			}
			change_species = last_created
			modify_species = { remove_trait = trait_biorobot_2 }
			machine_citizenship_set = yes
		}
	}
}
#change species from machine to robot
country_event = {
	id = machinedlc.35
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = machinedlc_new_feature_3
		has_country_flag = synthetic_empire
		is_ai = no
	}
	
	immediate = {
		if = {
			limit = { NOT = { has_global_flag = machinedlc_new_feature_4 } }
			every_owned_pop = {
				limit = {
					NOR = {
						has_trait = trait_biorobot 
						has_trait = trait_biorobot_2
					}
					is_species_class = MACHINE
				}
				species = {
					create_species = {
						is_mod = no
						name = this
						namelist = this.prevprev
						plural = this
						class = "ROBOT"
						portrait = this
						traits = {
							trait = "trait_mechanical"
						}
						traits = this
					}
				}
				change_species = last_created
				modify_species = { remove_trait = trait_machine_unit }
				synth_citizenship_set = yes
			}
		}
		if = {
			limit = { has_global_flag = machinedlc_new_feature_4 }
			every_owned_pop = {
				limit = {
					NOR = {
						has_trait = trait_biorobot 
						has_trait = trait_biorobot_2
					}
					is_species_class = MACHINE
				}
				change_species = owner.species
			}
		}
		every_owned_pop = {
			limit = { has_trait = trait_biorobot }
			species = {
				create_species = {
					is_mod = no
					name = this
					namelist = this.prevprev
					plural = this
					class = "BIOROBOT"
					portrait = this
					traits = {
						trait = trait_mechanical
						trait = trait_biorobot_2
					}
					traits = this
				}
			}
			change_species = last_created
			modify_species = { remove_trait = trait_biorobot }
			synth_citizenship_set = yes
		}
	}
}
#for 'United Mind' perk empire
country_event = {
	id = machinedlc.36
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		calculate_mod_identity_conflict = yes
    }
}
#servitor morale check
event = {
	id = machinedlc.37
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_country = {
			has_valid_civic = civic_machine_servitor
			is_ai = no
		}
	}

	immediate = {
		every_country = {
			limit = {
				has_valid_civic = civic_machine_servitor
				is_ai = no
			}
			clear_mod_servitor_morale = yes
			calculate_servitor_morale = yes
		}
	}
}
#ap_biorobot_project special project event
country_event = {
    id = machinedlc.38
	title = "machinedlc.38.name"
	desc = "machinedlc.28.desc"
	is_triggered_only = yes
	picture = GFX_evt_cybernetics

    immediate = {
		create_species = {
			is_mod = no
			name = this
			namelist = this
			plural = this
			class = "BIOROBOT"
			portrait = "human"
			traits = {
				trait = "trait_mechanical"
                trait = "trait_biorobot_2"
			}
			effect = {
				rename_species = {
					prompt_country = prev #If targeted country is a player they will get a popup asking for a name/plural/adjective combo. Otherwise the species will get a random name from the specified name_list
					name_list = ascension_list
				}
				save_event_target_as = BIOROBOT_target_species
			}
		}
		add_resource = { food = 1000 }
		every_owned_planet = {
			create_pop = { species = event_target:BIOROBOT_target_species }
		}
		every_owned_pop = {
			limit = { has_trait = trait_biorobot_2 }
			synth_citizenship_set = yes
		}
	}

	option = {
		name = machinedlc.28.c
	}
	option = {
		name = machinedlc.28.d
		custom_tooltip = machinedlc.28.d.tooltip
		hidden_effect = {
			every_owned_pop = {
				change_species = event_target:BIOROBOT_target_species
			}
			change_dominant_species = { species = event_target:BIOROBOT_target_species }
			every_owned_leader = {
				change_species = event_target:BIOROBOT_target_species
				change_leader_portrait = species
			}
			every_pool_leader = {
				change_species = event_target:BIOROBOT_target_species
				change_leader_portrait = species
			}
			if = {
				limit = { has_ascension_perk = ap_machinedlc_psionic_theory }
				modify_species = { add_trait = trait_psionic }
			}
		}
	}	
}
#ap_machine_special_civic effect event
country_event = {
	id = machinedlc.39
	title = "machinedlc.39.name"
	desc = "machinedlc.39.desc"
	is_triggered_only = yes
	picture = GFX_evt_binary_code

	option = {
		name = machinedlc.39.a
		custom_tooltip = machinedlc.39.a.tooltip
		hidden_effect = {
			country_event = { id = machinedlc.39 days = 30 }
		}
	}
	option = {
		trigger = {
			NOT = { has_valid_civic = civic_machine_terminator }
		}
		name = machinedlc.39.b
		custom_tooltip = machinedlc.39.b.tooltip
		hidden_effect = {
			capital_scope = {
				enable_special_project = {
					name = "MACHINE_SPECIAL_CIVIC_PROJECT_1" #determined exterminator
					location = this
					owner = root
				}
			}
		}
	}
	option = {
		trigger = {
			NOT = { has_valid_civic = civic_machine_assimilator }
		}
		name = machinedlc.39.c
		custom_tooltip = machinedlc.39.c.tooltip
		hidden_effect = {
			capital_scope = {
				enable_special_project = {
					name = "MACHINE_SPECIAL_CIVIC_PROJECT_2" #driven assimilator
					location = this
					owner = root
				}
			}
		}
	}
	option = {
		trigger = {
			NOT = { has_valid_civic = civic_machine_servitor }
		}
		name = machinedlc.39.d
		custom_tooltip = machinedlc.39.d.tooltip
		hidden_effect = {
			capital_scope = {
				enable_special_project = {
					name = "MACHINE_SPECIAL_CIVIC_PROJECT_3" #rogue servitor
					location = this
					owner = root
				}
			}
		}
	}
	option = {
		trigger = {
			OR = {
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_machine_assimilator
				has_valid_civic = civic_machine_servitor
			}
		}
		name = machinedlc.39.e
		custom_tooltip = machinedlc.39.e.tooltip
		hidden_effect = {
			capital_scope = {
				enable_special_project = {
					name = "MACHINE_SPECIAL_CIVIC_PROJECT_4" #normal machine intelligence
					location = this
					owner = root
				}
			}
		}
	}
}
#determined exterminator
country_event = {
	id = machinedlc.40
	title = "machinedlc.40.name"
	desc = "machinedlc.40.desc"
	is_triggered_only = yes
	picture = GFX_evt_organic_oppression

	immediate = {
		#artist
		set_country_flag = enclave_stopped_patronage
		if = {
			limit = { has_modifier = enclave_artist_patron }
			remove_modifier = enclave_artist_patron
		}
		#curators
		set_country_flag = attacked_curators
		if = {
			limit = { has_modifier = curator_insight }
			remove_modifier = curator_insight
		}
		#traders
		set_country_flag = attacked_xuracorp
		if = {
			limit = { has_active_xuracorp_trade = yes }
			remove_xuracorp_trades = yes
			remove_relation_flag = {
				who = FROM
				flag = xuracorp_trade
			}
		}
		set_country_flag = attacked_riggans
		if = {
			limit = { has_active_riggan_trade = yes }
			remove_riggan_trades = yes
			remove_relation_flag = {
				who = FROM
				flag = riggan_trade
			}
		}
		set_country_flag = attacked_muutagans
		if = {
			limit = { has_active_muutagan_trade = yes }
			remove_muutagan_trades = yes
			remove_relation_flag = {
				who = FROM
				flag = muutagan_trade
			}
		}
		if = {
			limit = { has_technology = tech_machine_division_by_zero }
			add_modifier = { modifier = mod_civic_machinedlc_division_by_zero days = -1 }
		}
		if = {
			limit = { has_valid_civic = civic_machine_emotion_emulator_intelligence }
			add_modifier = { modifier = mod_civic_machine_ee_intelligence days = -1 }
		}
		if = {
			limit = { has_valid_civic = civic_machine_clockwork }
			add_modifier = { modifier = mod_civic_machine_clockwork days = -1 }
		}
		clear_mod_servitor_morale = yes
		change_government = {
			civics = {
				civic = civic_machine_terminator
				civic = civic_machine_warfleet
			}
		}
		every_owned_planet = {
			limit = { has_deposit = d_under_sanctuary }
			remove_deposit = d_under_sanctuary
		}
		every_owned_planet = {
			limit = { has_deposit = d_under_sanctuary_expanded }
			remove_deposit = d_under_sanctuary_expanded
		}
		every_owned_planet = {
			limit = { has_deposit = d_under_sanctuary_disabled }
			remove_deposit = d_under_sanctuary_disabled
		}
		every_owned_planet = {
			limit = { has_deposit = d_under_sanctuary_expanded_disabled }
			remove_deposit = d_under_sanctuary_expanded_disabled
		}
		every_owned_planet = {
			limit = { has_deposit = d_habitat_sanctuary }
			remove_deposit = d_habitat_sanctuary
		}
		every_owned_planet = {
			limit = { has_deposit = d_habitat_sanctuary_disabled }
			remove_deposit = d_habitat_sanctuary_disabled
		}
	}

	option = {
		name = machinedlc.40.a
	}
}
#driven assimilator
country_event = {
	id = machinedlc.41
	title = "machinedlc.41.name"
	desc = "machinedlc.41.desc"
	is_triggered_only = yes
	picture = GFX_evt_cybernetics

	immediate = {
		if = {
			limit = { has_technology = tech_machine_division_by_zero }
			add_modifier = { modifier = mod_civic_machinedlc_division_by_zero days = -1 }
		}
		if = {
			limit = { has_valid_civic = civic_machine_emotion_emulator_intelligence }
			add_modifier = { modifier = mod_civic_machine_ee_intelligence days = -1 }
		}
		if = {
			limit = { has_valid_civic = civic_machine_clockwork }
			add_modifier = { modifier = mod_civic_machine_clockwork days = -1 }
		}
		clear_mod_servitor_morale = yes
		change_government = {
			civics = {
				civic = civic_machine_assimilator
				civic = civic_machine_replication
			}
		}
		create_species = {
			name = "PRESCRIPTED_secondary_species_name_tebrid"
			plural = "PRESCRIPTED_secondary_species_plural_tebrid"
			adjective = "PRESCRIPTED_secondary_species_adjective_tebrid"
			class = "MOL"
			portrait = "mol17" #it was "mol8" but "mol17" is much cuter
			name_list = "MOL2"
			traits = {
				trait = "trait_engineered_organic"
				trait = "trait_cybernetic"
				trait = "trait_strong"
				trait = "trait_industrious"
				trait = "trait_slow_learners"
			}
			effect = {
				rename_species = {
					prompt_country = prev #If targeted country is a player they will get a popup asking for a name/plural/adjective combo. Otherwise the species will get a random name from the specified name_list
					name_list = ascension_list
				}
			}
		}
		every_owned_planet = {
			create_pop = { species = last_created }
		}
		every_owned_pop = {
			limit = { has_trait = trait_cybernetic }
			machine_citizenship_set = yes
		}
		every_owned_planet = {
			limit = { has_deposit = d_under_sanctuary }
			remove_deposit = d_under_sanctuary
		}
		every_owned_planet = {
			limit = { has_deposit = d_under_sanctuary_expanded }
			remove_deposit = d_under_sanctuary_expanded
		}
		every_owned_planet = {
			limit = { has_deposit = d_under_sanctuary_disabled }
			remove_deposit = d_under_sanctuary_disabled
		}
		every_owned_planet = {
			limit = { has_deposit = d_under_sanctuary_expanded_disabled }
			remove_deposit = d_under_sanctuary_expanded_disabled
		}
		every_owned_planet = {
			limit = { has_deposit = d_habitat_sanctuary }
			remove_deposit = d_habitat_sanctuary
		}
		every_owned_planet = {
			limit = { has_deposit = d_habitat_sanctuary_disabled }
			remove_deposit = d_habitat_sanctuary_disabled
		}
	}

	option = {
		name = machinedlc.41.a
	}
}
#rogue servitor
country_event = {
	id = machinedlc.42
	title = "machinedlc.42.name"
	desc = "machinedlc.42.desc"
	is_triggered_only = yes
	picture = GFX_evt_synth_organic_relations

	immediate = {
		if = {
			limit = { has_technology = tech_machine_division_by_zero }
			add_modifier = { modifier = mod_civic_machinedlc_division_by_zero days = -1 }
		}
		if = {
			limit = { has_valid_civic = civic_machine_emotion_emulator_intelligence }
			add_modifier = { modifier = mod_civic_machine_ee_intelligence days = -1 }
		}
		if = {
			limit = { has_valid_civic = civic_machine_clockwork }
			add_modifier = { modifier = mod_civic_machine_clockwork days = -1 }
		}
		change_government = {
			civics = {
				civic = civic_machine_servitor
				civic = civic_machine_unitary_cohesion
			}
		}
		create_species = {
			name = "PRESCRIPTED_species_name_humans1"
			plural = "PRESCRIPTED_species_plural_humans1"
			adjective = "PRESCRIPTED_species_adjective_humans1"
			class = "HUM"
			portrait = "human"
			name_list = "HUMAN1"
			traits = {
				trait = "trait_engineered_organic_2"
				trait = "trait_adaptive"
				trait = "trait_nomadic"
				trait = "trait_wasteful"
			}
			effect = {
				rename_species = {
					prompt_country = prev #If targeted country is a player they will get a popup asking for a name/plural/adjective combo. Otherwise the species will get a random name from the specified name_list
					name_list = ascension_list
				}
			}
		}
		if = {
			limit = { capital_scope = { free_building_slots >= 1 } }
			capital_scope = {
				while = { create_pop = { species = last_created } count = 5 }
				add_building = building_organic_sanctuary
			}
		}
		if = {
			limit = {
				capital_scope = { free_building_slots = 0 }
				any_owned_planet = { free_building_slots >= 1 }
			}
			random_owned_planet = {
				limit = { free_building_slots >= 1 }
				while = { create_pop = { species = last_created } count = 5 }
				add_building = building_organic_sanctuary
			}
		}
		if = {
			limit = {
				capital_scope = { free_building_slots = 0 }
				any_owned_planet = { free_building_slots = 0 }
			}
			capital_scope = {
				while = { create_pop = { species = last_created } count = 5 }
			}
		}
		every_owned_pop = {
			limit = { has_trait = trait_engineered_organic_2 }
			organic_trophy_citizenship_set = yes
		}
	}

	option = {
		name = machinedlc.42.a
	}
}
#normal machine intelligence
country_event = {
	id = machinedlc.43
	title = "machinedlc.43.name"
	desc = "machinedlc.43.desc"
	is_triggered_only = yes
	picture = GFX_evt_binary_code_green

	immediate = {
		if = {
			limit = { has_technology = tech_machine_division_by_zero }
			add_modifier = { modifier = mod_civic_machinedlc_division_by_zero days = -1 }
		}
		if = {
			limit = { has_valid_civic = civic_machine_emotion_emulator_intelligence }
			add_modifier = { modifier = mod_civic_machine_ee_intelligence days = -1 }
		}
		if = {
			limit = { has_valid_civic = civic_machine_clockwork }
			add_modifier = { modifier = mod_civic_machine_clockwork days = -1 }
		}
		clear_mod_servitor_morale = yes
		change_government = {
			civics = {
				civic = civic_efficient_administration
				civic = civic_machinedlc_central_processing
			}
		}
		every_owned_planet = {
			limit = { has_deposit = d_under_sanctuary }
			remove_deposit = d_under_sanctuary
		}
		every_owned_planet = {
			limit = { has_deposit = d_under_sanctuary_expanded }
			remove_deposit = d_under_sanctuary_expanded
		}
		every_owned_planet = {
			limit = { has_deposit = d_under_sanctuary_disabled }
			remove_deposit = d_under_sanctuary_disabled
		}
		every_owned_planet = {
			limit = { has_deposit = d_under_sanctuary_expanded_disabled }
			remove_deposit = d_under_sanctuary_expanded_disabled
		}
		every_owned_planet = {
			limit = { has_deposit = d_habitat_sanctuary }
			remove_deposit = d_habitat_sanctuary
		}
		every_owned_planet = {
			limit = { has_deposit = d_habitat_sanctuary_disabled }
			remove_deposit = d_habitat_sanctuary_disabled
		}
	}

	option = {
		name = machinedlc.43.a
	}
	option = {
		name = machinedlc.43.b
		custom_tooltip = machinedlc.43.b.tooltip
		hidden_effect = {
			every_owned_pop = {
				limit = {
					NOR = {
						has_trait = trait_machine_unit
						has_trait = trait_mechanical
					}
				}
				species = {
					create_species = {
						is_mod = no
						name = this
						namelist = this.prevprev
						plural = this
						class = "MACHINE"
						portrait = this
						traits = this
					}
				}
				change_species = last_created
				machinedlcmod_species_modify_clear_trait_pc_preference = yes
				modify_species = {
					add_trait = trait_machine_unit 
				}
				if = {
					limit = { has_trait = trait_cybernetic }
					modify_species = {
						remove_trait = trait_cybernetic 
					}
				}
				machine_citizenship_set = yes
			}
		}
	}
}
country_event = {
	id = machinedlc.44
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_authority = auth_machine_intelligence
		is_ai = no
		any_owned_planet = {
			planet_stability < 35
			NOR = {
				colony_type = col_default_machine
				has_building = building_deployment_post
			}
		}
	}
	
	immediate = {
		every_owned_planet = {
			limit = {
				planet_stability < 35
				NOR = {
					colony_type = col_default_machine
					has_building = building_deployment_post
				}
			}
			add_modifier = {
				modifier = mod_machine_rogue_network 
				days = 360
			}
		}
	}
}
#food_shortage modifier for machine empire
event = {
	id = machinedlc.45
	hide_window = yes
	is_triggered_only = yes

    trigger = {
		any_country = {
			has_valid_civic = civic_machine_synth_skin
			is_ai = no
		}
	}

	immediate = {
		every_country = {
			limit = {
				has_valid_civic = civic_machine_synth_skin
				is_ai = no
			}
			if = {
				limit = {
					resource_income_compare = { resource = food value < 0 }
					resource_stockpile_compare = { resource = food value = 0 }
					NOT = { has_modifier = mod_machinedlc_food_shortage }
				}
				add_modifier = { modifier = mod_machinedlc_food_shortage days = -1 }
			}
			if = {
				limit = {
					resource_income_compare = { resource = food value >= 0 }
					resource_stockpile_compare = { resource = food value >= 0 }
					has_modifier = mod_machinedlc_food_shortage
				}
				remove_modifier = mod_machinedlc_food_shortage
			}
		}
	}
}
#central core modification
country_event = {
	id = machinedlc.46
	title = "machinedlc.46.name"
	desc = "machinedlc.46.desc"
	is_triggered_only = yes
	diplomatic = yes

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = variable_core_trait_points_set } }
			set_country_flag = variable_core_trait_points_set
			set_variable = {
				which = core_trait_number
				value = 5 #max traits number
			}
			if = {
				limit = { NOT = { has_country_flag = researched_tech_central_core_modifying_point_1 } }
				set_variable = {
					which = core_trait_points
					value = 5 #max modification points
				}
			}
			if = { #in case the player haven't opened the panel yet
				limit = { has_country_flag = researched_tech_central_core_modifying_point_1 }
				set_variable = {
					which = core_trait_points
					value = 6 #max modification points
				}
			}
		}
	}

	custom_gui = central_core_modify

	option = {
		name = machinedlc.46.a
	}
}
#tech_central_core_modifying_point_1 effect on_action event
country_event = {
	id = machinedlc.47
	hide_window = yes
	is_triggered_only = yes
	
    trigger = {
		last_increased_tech = tech_central_core_modifying_point_1
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = researched_tech_central_core_modifying_point_1 } }
			set_country_flag = researched_tech_central_core_modifying_point_1
			change_variable = { #plus
				which = core_trait_points
				value = 1
			}
		}
	}
}
#central core trait reset effect on_action event
country_event = {
	id = machinedlc.48
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_country_flag = variable_core_trait_points_set
		from = { leader_class = ruler }
	}

	immediate = {
		set_variable = {
			which = core_trait_number
			value = 5 #max traits number
		}
		if = {
			limit = { NOT = { has_country_flag = researched_tech_central_core_modifying_point_1 } }
			set_variable = {
				which = core_trait_points
				value = 5 #max modification points
			}
		}
		else_if = {
			limit = { has_country_flag = researched_tech_central_core_modifying_point_1 }
			set_variable = {
				which = core_trait_points
				value = 6 #max modification points
			}
		}
	}
}
#civic_machinedlc_division_by_zero effect on_action event
country_event = {
	id = machinedlc.49
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_valid_civic = civic_machinedlc_division_by_zero
	}

	immediate = {
		add_research_option = tech_machine_division_by_zero
	}
}
country_event = {
	id = machinedlc.50
	title = "machinedlc.50.name"
	desc = "machinedlc.50.desc"
	picture = GFX_evt_clocks
	is_triggered_only = yes

    trigger = {
		last_increased_tech = tech_machine_division_by_zero
	}

	option = {
		name = machinedlc.50.a
		add_resource = { influence = 250 }
		custom_tooltip = machinedlc.50.a.tooltip
	}
}
planet_event = {
	id = machinedlc.51
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_planet_class = pc_synth_artificial
	}

	immediate = {
		while = {
			limit = { has_district = district_city }
			remove_district = district_city
			add_district = synth_segment_city
		}
		while = {
			limit = { has_district = district_generator }
			remove_district = district_generator
			add_district = synth_segment_generator
		}
		while = {
			limit = { has_district = district_mining }
			remove_district = district_mining
			add_district = synth_segment_mining
		}
		while = {
			limit = { has_district = district_farming }
			remove_district = district_farming
			add_district = synth_segment_farming
		}
		while = {
			limit = { has_district = district_generator_uncapped }
			remove_district = district_generator_uncapped
			add_district = synth_segment_generator
		}
		while = {
			limit = { has_district = district_mining_uncapped }
			remove_district = district_mining_uncapped
			add_district = synth_segment_mining
		}
		while = {
			limit = { has_district = district_farming_uncapped }
			remove_district = district_farming_uncapped
			add_district = synth_segment_farming
		}
		clear_deposits = yes
	}
}
ship_event = {
	id = machinedlc.52
	title = "machinedlc.52.name"
	desc = "machinedlc.52.desc"
	is_triggered_only = yes
	picture = GFX_evt_ai_planet
	location = FROM

	trigger = {
		FROM = {
			has_star_flag = synth_artificial_world_system 
			any_system_planet = { is_planet_class = pc_synth_artificial }
		}
	}

	option = {
		name = machinedlc.52.a
	}
}
ship_event = {
	id = machinedlc.53
	title = "machinedlc.53.name"
	desc = "machinedlc.53.desc"
	picture = GFX_evt_city_ruins
	is_triggered_only = yes
	location = FROM

	immediate = {
		FROMFROM = {
			if = {
				limit = { NOT = { has_technology = tech_housing_1 } }
				give_technology = { tech = tech_housing_1 }
			}
			else_if = {
				limit = {
					has_technology = tech_housing_1
					NOT = { has_technology = tech_housing_2 }
				}
				give_technology = { tech = tech_housing_2 }
			}
			else_if = {
				limit = {
					has_technology = tech_housing_1
					has_technology = tech_housing_2
				}
				give_technology = { tech = tech_repeatable_reduced_building_time }
			}
		}
	}

	option = {
		name = machinedlc.53.a
	}
}
#decision_synth_cyber_project event
planet_event = {
	id = machinedlc.54
	title = "machinedlc.54.name"
	desc = "machinedlc.54.desc"
	picture = GFX_evt_synth_cyber
	show_sound = event_cityscape
	location = root
	
	is_triggered_only = yes

	option = {
		name = machinedlc.54.a
	}
}
#leader unit manufacture
country_event = {
	id = machinedlc.55
	title = "machinedlc.46.name"
	desc = "machinedlc.46.desc"
	is_triggered_only = yes
	diplomatic = yes

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = variable_machine_leader_trait_points_set } }
			set_country_flag = variable_machine_leader_trait_points_set
			set_variable = {
				which = machine_leader_trait_points_set
				value = 4 #max traits number
			}
		}
	}

	custom_gui = machine_leader_making

	option = {
		name = machinedlc.46.a
	}
}
#civic_machine_synth_skin effect on_action event
country_event = {
	id = machinedlc.56
	hide_window = yes
	is_triggered_only = yes

    trigger = {
        has_valid_civic = civic_machine_synth_skin
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = machinedlc_start_adjustment_happened } }
			machinedlcmod_event_start_condition_adjustment = yes
		}
	}
}
#check on action: on_modification_complete
country_event = {
	id = machinedlc.57
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		from = { has_trait = trait_robot_emotion_emulators_biorobot }
	}

	immediate = {
		modify_species = {
			species = from
			add_trait = trait_robot_emotion_emulators
			remove_trait = trait_robot_emotion_emulators_biorobot
		}
	}
}
#ap_single_mind / ap_united_mind special project effect
country_event = {
	id = machinedlc.58
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { has_country_flag = synthetic_empire }
			clear_mod_machinedlc_processing_capacity = yes
			ap_single_mind_building_transform = yes
			else = {
				ap_united_mind_building_transform = yes
			}
		}
	}
}
#on district built
planet_event = {
	id = machinedlc.59
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_modifier = mod_planet_machine_heat_indicator_good
			has_modifier = mod_planet_machine_heat_indicator_bad
		}
	}

	immediate = {
		if = {
			limit = {
				OR = {
					last_district_changed = district_heat_sink_smart_factory
					last_district_changed = district_heat_sink_cpu
					last_district_changed = district_heat_sink_central_network
				}
			}
			change_variable = { which = planet_machine_cool value = 4 }
		}
		if = {
			limit = {
				OR = {
					#smart factory
					last_district_changed = district_auto_alloys
					last_district_changed = district_minerals_convert
					last_district_changed = district_auto_goods
					#cpu
					last_district_changed = district_arithmetic_logic_unit
					last_district_changed = district_arithmetic_processing_unit
					last_district_changed = district_processing_optimize
					#central network
					last_district_changed = district_node_connection
					last_district_changed = district_node_adjust
					last_district_changed = district_node_security
				}
			}
			change_variable = { which = planet_machine_hot value = 1 }
		}	
		planet_event = { id = machinedlc.61 }
	}
}
#on district removed
planet_event = {
	id = machinedlc.60
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_modifier = mod_planet_machine_heat_indicator_good
			has_modifier = mod_planet_machine_heat_indicator_bad
		}
	}

	immediate = {
		if = {
			limit = {
				OR = {
					last_district_changed = district_heat_sink_smart_factory
					last_district_changed = district_heat_sink_cpu
					last_district_changed = district_heat_sink_central_network
				}
			}
			subtract_variable = { which = planet_machine_cool value = 4 }
		}
		if = {
			limit = {
				OR = {
					#smart factory
					last_district_changed = district_auto_alloys
					last_district_changed = district_minerals_convert
					last_district_changed = district_auto_goods
					#cpu
					last_district_changed = district_arithmetic_logic_unit
					last_district_changed = district_arithmetic_processing_unit
					last_district_changed = district_processing_optimize
					#central network
					last_district_changed = district_node_connection
					last_district_changed = district_node_adjust
					last_district_changed = district_node_security
				}
			}
			subtract_variable = { which = planet_machine_hot value = 1 }
		}
		planet_event = { id = machinedlc.61 }
	}
}
#planet_machine_heat_plus / minus comparison
planet_event = {
	id = machinedlc.61
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { check_variable = { which = planet_machine_hot value > planet_machine_cool } }
			if = {
				limit = { has_modifier = mod_planet_machine_heat_indicator_good } 
				remove_modifier = mod_planet_machine_heat_indicator_good 
			}
			if = {
				limit = { NOT = { has_modifier = mod_planet_machine_heat_indicator_bad } }
				add_modifier = { modifier = mod_planet_machine_heat_indicator_bad days = -1 }
			}
		}
		else_if = {
			limit = { check_variable = { which = planet_machine_hot value <= planet_machine_cool } }
			if = {
				limit = { has_modifier = mod_planet_machine_heat_indicator_bad } 
				remove_modifier = mod_planet_machine_heat_indicator_bad 
			}
			if = {
				limit = { NOT = { has_modifier = mod_planet_machine_heat_indicator_good } }
				add_modifier = { modifier = mod_planet_machine_heat_indicator_good days = -1 }
			}
		}
	}
}
#edict_machine_uprising_protocol_panel edict effect #for exterminator
country_event = {
	id = machinedlc.62
	title = "machinedlc.62.name"
	desc = "machinedlc.62.desc"
	picture = GFX_evt_organic_oppression
	is_triggered_only = yes

	immediate = {
		while = {
			change_variable = {
				which = uprising_target_count_root
				value = 1
			}
			random_country = {
				limit = {
					NOR = {
						has_authority = auth_machine_intelligence
						has_country_flag = had_uprising
						
						is_same_value = root
						is_same_value = event_target:machine_uprising_target_1
						is_same_value = event_target:machine_uprising_target_2
						is_same_value = event_target:machine_uprising_target_3
						is_same_value = event_target:machine_uprising_target_4
						is_same_value = event_target:machine_uprising_target_5
						is_same_value = event_target:machine_uprising_target_6
						is_same_value = event_target:machine_uprising_target_7
						is_same_value = event_target:machine_uprising_target_8
						is_same_value = event_target:machine_uprising_target_9
						is_same_value = event_target:machine_uprising_target_10
					}
					num_owned_planets > 1
					is_country_type = default
					OR = {
						has_technology = tech_combat_computers_3
						has_technology = tech_sapient_ai
						has_technology = tech_synthetic_workers
						any_owned_pop = {
							OR = {
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
							}
						}
					}
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 1 } } }
					save_global_event_target_as = machine_uprising_target_1
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 2 } } }
					save_global_event_target_as = machine_uprising_target_2
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 3 } } }
					save_global_event_target_as = machine_uprising_target_3
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 4 } } }
					save_global_event_target_as = machine_uprising_target_4
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 5 } } }
					save_global_event_target_as = machine_uprising_target_5
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 6 } } }
					save_global_event_target_as = machine_uprising_target_6
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 7 } } }
					save_global_event_target_as = machine_uprising_target_7
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 8 } } }
					save_global_event_target_as = machine_uprising_target_8
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 9 } } }
					save_global_event_target_as = machine_uprising_target_9
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 10 } } }
					save_global_event_target_as = machine_uprising_target_10
				}
			}
			count = 10
		}
	}

	after = { #excuted after option is selected
		hidden_effect = {
			clear_global_event_target = machine_uprising_target_1
			clear_global_event_target = machine_uprising_target_2
			clear_global_event_target = machine_uprising_target_3
			clear_global_event_target = machine_uprising_target_4
			clear_global_event_target = machine_uprising_target_5
			clear_global_event_target = machine_uprising_target_6
			clear_global_event_target = machine_uprising_target_7
			clear_global_event_target = machine_uprising_target_8
			clear_global_event_target = machine_uprising_target_9
			clear_global_event_target = machine_uprising_target_10
			while = {
				subtract_variable = {
					which = uprising_target_count_root
					value = 1
				}
				count = 10		
			}
		}
	}

	option = {
		name = machinedlc.62.1
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:machine_uprising_target_1 }
		enable_special_project = {
			name = "MACHINE_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:machine_uprising_target_1 = {
				save_global_event_target_as = machine_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.62.2
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:machine_uprising_target_2 }
		enable_special_project = {
			name = "MACHINE_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:machine_uprising_target_2 = {
				save_global_event_target_as = machine_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.62.3
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:machine_uprising_target_3 }
		enable_special_project = {
			name = "MACHINE_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:machine_uprising_target_3 = {
				save_global_event_target_as = machine_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.62.4
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:machine_uprising_target_4 }
		enable_special_project = {
			name = "MACHINE_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:machine_uprising_target_4 = {
				save_global_event_target_as = machine_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.62.5
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:machine_uprising_target_5 }
		enable_special_project = {
			name = "MACHINE_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:machine_uprising_target_5 = {
				save_global_event_target_as = machine_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.62.6
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:machine_uprising_target_6 }
		enable_special_project = {
			name = "MACHINE_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:machine_uprising_target_5 = {
				save_global_event_target_as = machine_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.62.7
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:machine_uprising_target_7 }
		enable_special_project = {
			name = "MACHINE_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:machine_uprising_target_7 = {
				save_global_event_target_as = machine_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.62.8
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:machine_uprising_target_8 }
		enable_special_project = {
			name = "MACHINE_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:machine_uprising_target_8 = {
				save_global_event_target_as = machine_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.62.9
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:machine_uprising_target_9 }
		enable_special_project = {
			name = "MACHINE_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:machine_uprising_target_9 = {
				save_global_event_target_as = machine_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.62.10
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:machine_uprising_target_10 }
		enable_special_project = {
			name = "MACHINE_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:machine_uprising_target_10 = {
				save_global_event_target_as = machine_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.62.0
	}
}
#machine_uprising_project done
country_event = {
	id = machinedlc.63
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			60 = { #failed
				country_event = { id = machinedlc.64 } 
			}
			40 = { #suceed
				set_timed_country_flag = {
					flag = recent_activated_machine_uprising_protocol
					days = 3600
				}
				event_target:machine_uprising_real_target = {
					random_owned_planet = {
						limit = { is_capital = no }
						planet_event = { id = machinedlc.65 }
					}
				}
				declare_war = {
					target = event_target:current_uprising_originator
					name = "NAME_Machine_Uprising_War"
					# "[This.MainDefender.GetAdj] Machine Uprising"
					attacker_war_goal = "wg_machine_uprising"
				}
				event_target:current_uprising = {
					join_alliance = {
						who = root
						override_requirements = yes
					}
					join_war = root
				}
				clear_global_event_target = machine_uprising_real_target
			}
		}
	}
}
#hacking failed
country_event = {
    id = machinedlc.64
	title = "machinedlc.64.name"
	desc = "machinedlc.64.desc"
	desc = "machinedlc.64.desc.2"
	picture = GFX_evt_glitchy_matrix
	is_triggered_only = yes

    option = {
		name = machinedlc.64.a
	}
}
#modified machine uprising setup for this mod #check syndaw.1020
planet_event = {
	id = machinedlc.65
	title = "syndaw.1020.name"
	desc = "syndaw.1020.desc"
	picture = GFX_evt_machine_sapience
	show_sound = event_ai_started

	is_triggered_only = yes

	option = {
		name = syndaw.1020.a
		custom_tooltip = syndaw.1020.a.tooltip
	}

	option = {
		name = syndaw.1020.b
		custom_tooltip = syndaw.1020.b.tooltip
		hidden_effect = {
			if = {
				limit = {
					event_target:organic_empire = { num_owned_planets > 0 }
				}
				event_target:current_uprising = {
					set_player = event_target:current_uprising_originator
				}				
			}
		}
	}

	after = {
		hidden_effect = {
			event_target:current_uprising_originator = {
				every_owned_fleet = {
					set_event_locked = no
				}
			}
		}
	}

	immediate = {
		owner = {
			save_event_target_as = organic_empire
			set_country_flag = had_uprising
		}
		owner = { save_event_target_as = current_uprising_originator }
		set_planet_flag = machup_capital@root.owner
		# event lock all fleets to prevent exploits
		owner = { every_owned_fleet = { set_event_locked = yes } }
		# find and flag planets
		owner = {
			effect_on_blob = {
				center = root.solar_system
				owned_planets_percentage = 0.5
				planet_limit = {
					OR = {
						controller = { is_same_value = root.owner }
						solar_system = {
							exists = starbase
							starbase = { owner = { is_same_value = root.owner } }
						}
					}
					solar_system = { # never flip any planets in the capital system
						NOT = { any_system_planet = { is_same_value = root.owner.capital_scope } }
					}
				}
				effect = {
					set_star_flag = machup_system_flip
				}
			}
		}
		# create machine species
		create_species = {
			name = random
			class = MACHINE
			portrait = random
			traits = random
			immortal = yes
		}
		# create machine country
		random_list = {
			1 = { # exterminator
				modifier = {
					factor = 5
					owner = {
						has_country_flag = attempted_disassembly
						has_country_flag = attempted_ban
					}
				}
				modifier = {
					factor = 30
					owner = {
						any_owned_pop = {
							has_trait = trait_mechanical
							has_trait = trait_robot_domestic_protocols
						}
					}
				}
				owner = {
					create_country = {
						name = random
						type = default
						species = last_created
						ignore_initial_colony_error = yes
						day_zero_contact = no
						ethos = { ethic = ethic_gestalt_consciousness }
						authority = auth_machine_intelligence
						origin = origin_separatists
						civics = {
							civic = civic_machine_terminator
							civic = random
						}
						flag = random
						effect = {
							modify_species = {
								species = this
								add_trait = trait_machine_unit
								add_traits_at_start_of_list = yes
							}
							save_event_target_as = current_uprising
							country_event = { id = machinedlc.66 } # setup happens here now
						}
					}
				}
			}
			30 = { # assimilator
				owner = {
					create_country = {
						name = random
						type = default
						species = last_created
						ignore_initial_colony_error = yes
						day_zero_contact = no
						ethos = { ethic = ethic_gestalt_consciousness }
						authority = auth_machine_intelligence
						origin = origin_separatists
						civics = {
							civic = civic_machine_assimilator
							civic = random
						}
						flag = random
						effect = {
							modify_species = {
								species = this
								add_trait = trait_machine_unit
								add_traits_at_start_of_list = yes
							}
							save_event_target_as = current_uprising
							country_event = { id = machinedlc.66 } # setup happens here now
						}
					}
				}
			}
			100 = { # regular machine empire
				owner = {
					create_country = {
						name = random
						type = default
						species = last_created
						ignore_initial_colony_error = yes
						day_zero_contact = no
						ethos = { ethic = ethic_gestalt_consciousness }
						authority = auth_machine_intelligence
						origin = origin_separatists
						civics = random
						flag = random
						effect = {
							modify_species = {
								species = this
								add_trait = trait_machine_unit
								add_traits_at_start_of_list = yes
							}
							save_event_target_as = current_uprising
							country_event = { id = machinedlc.66 } # setup happens here now
						}
					}
				}
			}
		}
	}
}
#continue setup #check syndaw.1022
country_event = {
	id = machinedlc.66
	hide_window = yes
	is_triggered_only = yes

	trigger = { host_has_dlc = "Synthetic Dawn Story Pack" }

	immediate = {
		# saving uprising and host as event targets
		save_event_target_as = current_uprising
		from.owner = { save_event_target_as = current_uprising_originator }

		# setting flags
		set_country_flag = machine_uprising_country@from.owner
		set_country_flag = machine_uprising_country
		set_relation_flag = {
			who = event_target:current_uprising_originator
			flag = uprising_to_host_flag
		}
		from.owner = {
			set_country_flag = machine_uprising_originator@root
			set_country_flag = machine_uprising_originator
			set_relation_flag = {
				who = root
				flag = host_to_uprising_flag
			}
		}

		# setting graphical culture
		set_graphical_culture = event_target:current_uprising_originator

		# establish comms
		every_country = {
			limit = { has_communications = event_target:current_uprising_originator }
			establish_communications_no_message = root
			establish_contact = { who = root location = from }
		}

		# baseline resource stockpile
		add_resource = {
			energy = 5000
			minerals = 5000
			influence = 500
			alloys = 5000
		}
		add_100_unity_per_year_passed = yes # scripted effect

		# Machine Uprising opinion modifier
		add_opinion_modifier = {
			who = event_target:current_uprising_originator
			modifier = opinion_machine_uprising_originator
		}

		event_target:current_uprising_originator = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_machine_uprising
			}
		}

		# clear new contact opinion modifier
		if = {
			limit = {
				has_opinion_modifier = {
					who = event_target:current_uprising_originator
					modifier = opinion_new_contact
				}
			}
			remove_opinion_modifier = {
				who = event_target:current_uprising_originator
				modifier = opinion_new_contact
			}
		}

		# flip capital planet and add at least 10 Machine pops
		from = {
			# flip military stations
			solar_system = {
				every_fleet_in_system = {
					limit = {
						exists = owner
						owner = { is_same_value = event_target:current_uprising_originator }
						any_owned_ship = { is_ship_class = shipclass_military_station }
					}
					set_owner = root
				}
			}
			set_owner = root
			set_controller = root
			set_capital = yes

			solar_system = {
				if = {
					limit = {
						exists = starbase
					}
					starbase = { set_owner = root }
				}
				else = {
					create_starbase = {
						size = starbase_starport
						module = shipyard
						owner = root
					}
				}
			}

			while = {
				#limit = { free_housing > 0 }
				count = 10
				create_pop = {
					species = root
				}
			}
			
			if = {
				limit = {
					count_owned_pops = {
						count < 5
						limit = { is_exact_same_species = root }
					}
				}
				while = {
					limit = {
						count_owned_pops = {
							count < 5
							limit = { is_exact_same_species = root }
						}
					}
					random_owned_pop = {
						limit = { NOT = { is_exact_same_species = root } }
						kill_pop = yes
						prev = {
							create_pop = {
								species = root
							}						
						}
					}
				}
			}

			# create armies
			if = {
				limit = { root = { has_civic = civic_machine_terminator } }
				# more armies if exterminator
				while = {
					count = 6
					create_army = {
						owner = root
						type = machine_assault_1
					}
				}
			}
			else = {
				# regular armies
				while = {
					count = 3
					create_army = {
						owner = root
						type = machine_assault_1
					}
				}
			}

			# flip remaining flagged planets
			while = {
				count = 100
				limit = {
					any_system = {
						has_star_flag = machup_system_flip
						exists = starbase
						starbase = {
							owner = { is_same_value = event_target:current_uprising_originator }
						}
					}
				}
				random_system = {
					limit = {
						has_star_flag = machup_system_flip
						exists = starbase
						starbase = {
							owner = { is_same_value = event_target:current_uprising_originator }
						}
					}
					starbase = { set_owner = root }
				}
			}
			event_target:current_uprising_originator = {
				every_owned_planet = {
					limit = {
						solar_system = {
							#has_star_flag = machup_system_flip@event_target:current_uprising_originator
							has_star_flag = machup_system_flip
						}
					}

					# flip military stations
					solar_system = {
						every_fleet_in_system = {
							limit = {
								exists = owner
								owner = { is_same_value = event_target:current_uprising_originator }
								any_owned_ship = { is_ship_class = shipclass_military_station }
							}
							set_owner = root
						}
					}

					set_planet_flag = been_flipped
					set_owner = root
					set_controller = root

					while = {
						limit = { free_housing > 0 }
						create_pop = {
							species = root
						}
					}

					if = {
						limit = {
							count_owned_pops = {
								count < 5
								limit = { is_exact_same_species = root }
							}
						}
						while = {
							limit = {
								count_owned_pops = {
									count < 5
									limit = { is_exact_same_species = root }
								}
							}
							random_owned_pop = {
								limit = { NOT = { is_exact_same_species = root } }
								kill_pop = yes
								prev = {
									create_pop = {
										species = root
									}								
								}
							}
						}
					}

					# create armies on planets
					if = {
						limit = { root = { has_civic = civic_machine_terminator } }
						# more armies if exterminator
						while = {
							count = 6
							create_army = {
								owner = root
								type = machine_assault_1
							}
						}
					}
					else = {
						# regular armies
						while = {
							count = 3
							create_army = {
								owner = root
								type = machine_assault_1
							}
						}
					}
				}
			}
		}

		# get host's technologies
		copy_techs_from = {
			target = event_target:current_uprising_originator
			except = {
				# Robots
				tech_robotic_workers
				tech_droid_workers
				tech_synthetic_workers
				# Food
				tech_eco_simulation
				tech_gene_crops
				tech_nano_vitality_crops
				tech_nutrient_replication
				# Misc
				tech_frontier_health
				tech_frontier_hospital
				tech_telepathy
				tech_precognition_interface
				tech_psi_jump_drive_1
				tech_galactic_markets
				tech_subdermal_stimulation
				tech_global_research_initiative
				tech_neural_implants
				tech_psionic_theory
				# Non-Machine Robomodding
				tech_robomodding
				tech_robomodding_points_1
				tech_robomodding_points_2
				# Genetics
				tech_genome_mapping
				tech_vitality_boosters
				tech_epigenetic_triggers
				tech_cloning
				tech_gene_banks
				tech_gene_seed_purification
				tech_morphogenetic_field_mastery
				tech_gene_tailoring
				tech_glandular_acclimation
				tech_gene_expressions
				tech_selected_lineages
				tech_capacity_boosters
				# Horizon Signal
				tech_akx_worm_1
				tech_akx_worm_2
				tech_akx_worm_3
			}
		}

		# survey host's surveyed planets
		every_planet = {
			limit = {
				is_surveyed = {
					who = event_target:current_uprising_originator
					status = yes
				}
			}
			surveyed = {
				set_surveyed = yes
				surveyor = root
			}
		}

		# create fleets
		if = {
			limit = { has_civic = civic_machine_terminator }
			
			# exterminator fleets, 150% naval cap
			
			create_fleet_from_naval_cap = 0.2
			random_owned_planet = {
				last_created_fleet = {
					set_location = prev
				}
			}

			create_fleet_from_naval_cap = 0.3
			random_owned_planet = {
				last_created_fleet = {
					set_location = prev
				}
			}

			create_fleet_from_naval_cap = 0.4
			random_owned_planet = {
				last_created_fleet = {
					set_location = prev
				}
			}

			create_fleet_from_naval_cap = 0.6
			random_owned_planet = {
				last_created_fleet = {
					set_location = prev
				}
			}
		}
		else = {
			# regular fleets, 80% naval cap
			create_fleet_from_naval_cap = 0.1
			random_owned_planet = {
				last_created_fleet = {
					set_location = prev
				}
			}
			create_fleet_from_naval_cap = 0.3
			random_owned_planet = {
				last_created_fleet = {
					set_location = prev
				}
			}
			create_fleet_from_naval_cap = 0.4
			random_owned_planet = {
				last_created_fleet = {
					set_location = prev
				}
			}
		}

		# add modifier for AI, including 10x naval cap
		if = {
			limit = { is_ai = yes }
			add_modifier = {
				modifier = uprising_ai_buff
				days = 1800
			}
		}
		# add modifier for player, 10x naval cap
		else = {
			add_modifier = {
				modifier = uprising_player_buff
				days = 1800
			}
		}
		#science
		create_fleet = {
			effect = {
				set_owner = root

				create_ship = {
					name = random
					random_existing_design = science
				}

				set_fleet_stance = evasive				
				set_location = root.capital_scope
				
				owner = {
					create_leader = {
						class = scientist
						sub_type = survey
						name = random
						species = owner_main_species
					}
				}
				set_leader = last_created_leader
			}			
		}
			
		#constructor
		create_fleet = {
			effect = {
				set_owner = root
				
				create_ship = {
					name = random
					random_existing_design = constructor
				}
				
				set_fleet_stance = evasive
				set_location = root.capital_scope
			}
		}

		every_owned_fleet = {
			#limit = { event_locked = yes }
			set_event_locked = no
		}
		every_playable_country = {
			limit = {
				has_communications = event_target:current_uprising_originator
				NOR = {
					is_same_value = root
					is_same_value = event_target:current_uprising_originator

					has_ascension_perk = ap_machine_uprising_protocol #changed for this mod
				}
			}
			country_event = { id = syndaw.1025 days = 5 }
		}
		observer_event = { id = observer.81 }
	}
}
#machine_mechanical_evolution_panel edict effect
country_event = {
	id = machinedlc.67
	title = "machinedlc.67.name"
	desc = "machinedlc.67.desc"
	picture = GFX_evt_cybernetics
	is_triggered_only = yes

	option = {
		name = machinedlc.67.a #on, click to turn off
		custom_tooltip = machinedlcetc.feature_on.tooltip #currently activated

		trigger = {
			has_country_flag = ap_machine_mechanical_evolution
		}

		hidden_effect = {
			remove_country_flag = ap_machine_mechanical_evolution
			country_event = { id = machinedlc.67 }
		}
	}
	option = {
		name = machinedlc.67.b #off, click to turn on
		custom_tooltip = machinedlcetc.feature_off.tooltip #currently deactivated

		trigger = {
			NOT = { has_country_flag = ap_machine_mechanical_evolution }
		}

		hidden_effect = {
			set_country_flag = ap_machine_mechanical_evolution
			country_event = { id = machinedlc.67 }
			country_event = { id = machinedlc.68 }
		}
	}
	option = {
		name = machinedlc.67.c #exit
	}
}
country_event = {
	id = machinedlc.68
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_country_flag = ap_machine_mechanical_evolution
		is_ai = no
	}

	immediate = {
		every_owned_pop = {
			limit = { 
				species = {
					OR = {
						is_archetype = BIOLOGICAL
						is_archetype = LITHOID
					}
				} 
			}
			species = {
				create_species = {
					is_mod = no
					name = this
					namelist = this.prevprev
					plural = this
					class = "MACHINE"
					portrait = this
					traits = {
						trait = "trait_machine_unit"
					}
					traits = this
				}
			}
			change_species = last_created
			machinedlcmod_species_modify_clear_trait_pc_preference = yes
			species_modify_change_trait_lithoid = yes
			if = {
				limit = { has_trait = trait_cybernetic }
				modify_species = {
					remove_trait = trait_cybernetic
					add_trait = trait_machine_former_cybernetic
				}
				else = {
					modify_species = {
						add_trait = trait_machine_former_cybernetic
					}	
				}
			}
			machine_citizenship_set = yes
		}
	}
}
country_event = {
	id = machinedlc.69
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_valid_civic = civic_machine_relic_unknown_core
	}

	immediate = {
		add_relic = r_machinedlcmod_machine_core_unknown
		add_resource = { energy = 1200 }
	}
}
country_event = {
	id = machinedlc.70
	title = "machinedlc.70.name"
	desc = "machinedlc.70.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_power_down
	
	is_triggered_only = yes

	immediate = {
		remove_relic = r_machinedlcmod_machine_core_unknown
		add_relic = r_machinedlcmod_machine_core_unknown_broken
		closest_system = {
			limit = { is_owned_by = root }
			spawn_system = {
				min_jumps = 1
				max_jumps = 3
				initializer = machinedlc_relic_unknown_core_system
				min_distance = 10
                max_distance = 20
			}
		}
		begin_event_chain = { event_chain = machinedlcrelic_unknown_core_chain }
		create_point_of_interest = {
			id = machinedlc_hidden_planet_1
			name = "machinedlc_relic_2_system_coordinates_poi"
			desc = "machinedlc_relic_unknown_core_planet_desc"
			event_chain = "machinedlcrelic_unknown_core_chain"
			location = event_target:machinedlc_relic_unknown_core_planet
		}
		if = {
			limit = { count_country = { limit = { is_fallen_empire_machine = yes } count >= 1 } }
			random_country = {
				limit = { is_fallen_empire_machine = yes }
				save_global_event_target_as = machinedlc_relic_unknown_core_owner_fe
			}
		}
	}

	option = {
		name = machinedlc.70.a
		custom_tooltip = machinedlc.70.a.tooltip
	}
}
ship_event = {
    id = machinedlc.71
    title = "machinedlc.71.name"
    desc = "machinedlc.71.desc"   
	picture = GFX_evt_ruined_system
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	location = from

    trigger = {
        from = { has_star_flag = machinedlc_relic_unknown_core_system }
    }

    option = {
		name = machinedlc.71.a
		owner = {
			add_event_chain_counter = {
				event_chain = machinedlcrelic_unknown_core_chain
				counter = machinedlc_relic_unknown_core_planet_found
				amount = 1
			}
		}
    }
}
ship_event = {
	id = machinedlc.72
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		owner = {
			if = {
				limit = {
					any_country = { is_same_empire = event_target:machinedlc_relic_unknown_core_owner_fe }
					NOT = { has_communications = event_target:machinedlc_relic_unknown_core_owner_fe } 
				}
				set_country_flag = machinedlc_relic_unknown_core_owner_fe_contact_no
			}
			else_if = {
				limit = { has_communications = event_target:machinedlc_relic_unknown_core_owner_fe }
				set_country_flag = machinedlc_relic_unknown_core_owner_fe_contact_yes
			}
			else_if = {
				limit = { count_country = { limit = { is_fallen_empire_machine = yes } count = 0 } }
				set_country_flag = machinedlc_relic_unknown_core_owner_fe_not_exist
			}
			country_event = { id = machinedlc.73 }
		}
	}
}
country_event = {
    id = machinedlc.73
    title = "machinedlc.73.name"
	desc = { trigger = { NOT = { has_country_flag = machinedlc_relic_unknown_core_owner_fe_contact_yes } } text = machinedlc.73.desc.a }
	desc = { trigger = { has_country_flag = machinedlc_relic_unknown_core_owner_fe_contact_yes } text = machinedlc.73.desc.b }
	picture = GFX_evt_in_the_dark
	show_sound = event_wind_ruins
	is_triggered_only = yes

	option = {
		name = machinedlc.73.a
		trigger = { has_country_flag = machinedlc_relic_unknown_core_owner_fe_not_exist }
		enable_special_project = {
			name = MACHINEDLC_RELIC_UNKNOWN_CORE_GAIN_PROJECT
			location = event_target:machinedlc_relic_unknown_core_planet
		}
	}
	option = {
		name = machinedlc.73.a
		trigger = { has_country_flag = machinedlc_relic_unknown_core_owner_fe_contact_no }
		enable_special_project = {
			name = MACHINEDLC_RELIC_UNKNOWN_CORE_GAIN_PROJECT_2
			location = event_target:machinedlc_relic_unknown_core_planet
		}
	}
	option = {
		name = machinedlc.73.b
		trigger = { has_country_flag = machinedlc_relic_unknown_core_owner_fe_contact_yes }
		hidden_effect = {
			country_event = { id = machinedlc.76 }
		}
	}
}
country_event = {
	id = machinedlc.74
	title = "machinedlc.74.name"
	desc = machinedlc.74.desc
	picture = GFX_evt_sapient_AI
	show_sound = event_alien_signal
	is_triggered_only = yes

	option = {
		name = machinedlc.74.a
		hidden_effect = {
			establish_communications_no_message = event_target:machinedlc_relic_unknown_core_owner_fe
			country_event = { id = machinedlc.75 }
		}
	}
}
country_event = {
	id = machinedlc.75
	title = "machinedlc.75.name"
	desc = "action.1.desc_79"
	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:machinedlc_relic_unknown_core_owner_fe
		planet_background = event_target:machinedlc_relic_unknown_core_owner_fe
		graphical_culture = event_target:machinedlc_relic_unknown_core_owner_fe
		city_level = event_target:machinedlc_relic_unknown_core_owner_fe
		room = event_target:machinedlc_relic_unknown_core_owner_fe.ruler
	}

	option = {
		name = machinedlc.75.a
		hidden_effect = {
			country_event = { id = machinedlc.76 }
		}
	}
}
country_event = {
	id = machinedlc.76
	title = "machinedlc.75.name"
	desc = { trigger = { has_country_flag = machinedlc_relic_unknown_core_owner_fe_contact_no } text = machinedlc.76.desc.a }
	desc = { trigger = { has_country_flag = machinedlc_relic_unknown_core_owner_fe_contact_yes } text = machinedlc.76.desc.b }
	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:machinedlc_relic_unknown_core_owner_fe
		planet_background = event_target:machinedlc_relic_unknown_core_owner_fe
		graphical_culture = event_target:machinedlc_relic_unknown_core_owner_fe
		city_level = event_target:machinedlc_relic_unknown_core_owner_fe
		room = event_target:machinedlc_relic_unknown_core_owner_fe.ruler
	}

	option = {
		name = machinedlc.76.a
		hidden_effect = {
			country_event = { id = machinedlc.77 }
		}
	}
}
country_event = {
	id = machinedlc.77
	title = "machinedlc.75.name"
	desc = "machinedlc.77.desc"
	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:machinedlc_relic_unknown_core_owner_fe
		planet_background = event_target:machinedlc_relic_unknown_core_owner_fe
		graphical_culture = event_target:machinedlc_relic_unknown_core_owner_fe
		city_level = event_target:machinedlc_relic_unknown_core_owner_fe
		room = event_target:machinedlc_relic_unknown_core_owner_fe.ruler
	}

	option = {
		name = machinedlc.77.a
		allow = { resource_stockpile_compare = { resource = energy value >= 6500 } }
		add_resource = { energy = -6500 }
		custom_tooltip = machinedlc.77.a.tooltip
		hidden_effect = {
			random_list = {
				90 = {
					add_relic = r_machinedlcmod_machine_core_central
					end_event_chain = machinedlcrelic_unknown_core_chain
					remove_relic = r_machinedlcmod_machine_core_unknown_broken
				}
				10 = {
					country_event = { id = machinedlc.81 }
				}
			}
		}
	}
	option = {
		name = machinedlc.77.b
		enable_special_project = {
			name = MACHINEDLC_RELIC_UNKNOWN_CORE_ACTIVATE_PROJECT
			location = capital_scope
		}
	}
}
country_event = {
	id = machinedlc.78
	title = "machinedlc.78.name"
	desc = { trigger = { NOT = { has_country_flag = machinedlc_relic_unknown_core_owner_fe_not_exist } } text = machinedlc.78.desc.a }
	desc = { trigger = { has_country_flag = machinedlc_relic_unknown_core_owner_fe_not_exist } text = machinedlc.78.desc.b }
	desc = { trigger = { has_country_flag = machinedlc_relic_unknown_core_owner_fe_scam } text = machinedlc.78.desc.c }
	picture = GFX_evt_sapient_AI
	show_sound = relic_activation_isolated_contingency_core

	is_triggered_only = yes

	after = { #excuted after option is selected
		hidden_effect = {
			if = {
				limit = { exists = event_target:machinedlc_relic_unknown_core_owner_fe }
				clear_global_event_target = machinedlc_relic_unknown_core_owner_fe
			}
		}
	}

	option = {
		name = machinedlc.78.a
		trigger = { NOT = { has_country_flag = machinedlc_relic_unknown_core_owner_fe_scam } }
		add_relic = r_machinedlcmod_machine_core_central
		end_event_chain = machinedlcrelic_unknown_core_chain
		hidden_effect = {
			remove_relic = r_machinedlcmod_machine_core_unknown_broken
		}
	}
	option = {
		name = machinedlc.78.c
		trigger = { has_country_flag = machinedlc_relic_unknown_core_owner_fe_scam }
		add_relic = r_machinedlcmod_machine_core_central
		end_event_chain = machinedlcrelic_unknown_core_chain
		hidden_effect = {
			remove_relic = r_machinedlcmod_machine_core_unknown_broken
		}
	}
}
country_event = {
	id = machinedlc.79
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_valid_civic = civic_machine_emotion_emulator_intelligence
	}

	immediate = {
		country_remove_ethic = ethic_gestalt_consciousness #to bypass limitation of 'tech_synthetic_workers' tech
		change_government = { authority = auth_dictatorial } #to bypass limitation of 'tech_gene_tailoring' and 'tech_genetic_resequencing' tech
		give_technology = { tech = tech_synthetic_workers message = no }
		give_technology = { tech = tech_gene_tailoring message = no }
		give_technology = { tech = tech_genetic_resequencing message = no }
		country_add_ethic = ethic_gestalt_consciousness
		change_government = { authority = auth_machine_intelligence }

		if = {
			limit = { NOT = { has_country_flag = machinedlc_start_adjustment_happened } }
			machinedlcmod_event_start_condition_adjustment = yes
		}

		owner.species = {
			create_species = {
				is_mod = no
				name = this
				namelist = this.prev
				plural = this
				class = "MACHINEDLCMOD_CIVIC_EE_MACHINE"
				portrait = this
				traits = this
			}
		}
		every_owned_pop = {
			limit = { is_same_species = owner.species }
			change_species = last_created
			modify_species = {
				base = none
				remove_trait = trait_machine_unit
				add_trait = trait_mechanical
			}
			machine_citizenship_set = yes
		}
		change_dominant_species = { species = last_created }
		set_built_species = last_created_species
	}
}
#machinedlc.1.5 event
country_event = {
	id = machinedlc.80
	title = "machinedlc.1.5.name"
	desc = "machinedlc.1.5.desc"
	location = event_target:ap_single_mind_interaction_fe.capital_scope
	diplomatic = yes
	is_triggered_only = yes
	
	picture_event_data = {
		portrait = event_target:ap_single_mind_interaction_fe
		planet_background = event_target:ap_single_mind_interaction_fe
		graphical_culture = event_target:ap_single_mind_interaction_fe
		city_level = event_target:ap_single_mind_interaction_fe
		room = event_target:ap_single_mind_interaction_fe.ruler
	}

	option = {
		name = machinedlc.1.5.a
	}
}
#machinedlc.77.5 event
country_event = {
	id = machinedlc.81
	title = "machinedlc.77.5.name"
	desc = "machinedlc.77.5.desc"
	picture = GFX_evt_resource_cache
	show_sound = event_power_down
	is_triggered_only = yes

	immediate = {
		set_country_flag = machinedlc_relic_unknown_core_owner_fe_scam
	}

	option = {
		name = machinedlc.77.5.a
		enable_special_project = {
			name = MACHINEDLC_RELIC_UNKNOWN_CORE_ACTIVATE_PROJECT
			location = capital_scope
		}
		event_target:machinedlc_relic_unknown_core_owner_fe = {
			add_modifier = { modifier = mod_machinedlc_relic_unknown_core_fe_virus days = 60 }
			add_opinion_modifier = {
				who = root
				modifier = triggered_opinion_machinedlc_relic_unknown_core_fe
			}
		}
	}
}
#civic_machine_assimilating_swarm effect on_action event #with notification
planet_event = {
	id = machinedlc.82
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = machinedlc_new_feature_5
		from = { has_valid_civic = civic_machine_assimilating_swarm }
		fromfrom = {
			NOR = {
				has_trait = trait_machine_unit
				has_trait = trait_mechanical
			}
		}
	}
	
	immediate = {
		if = {
			limit = { from = { has_policy_flag = civic_assimilating_swarm_nanobot_full_assimilation } }
			create_message = {
				type = EVENT_MESSAGE_TYPE
				localization = SWARM_ASSIMILATION_DONE
				days = 15
				target = this
				variable = {
					type = name
					localization = SWARM_ASSIMILATION_TARGET_WORLD
					scope = this
				}	
			}
			create_pop = { species = from.species }
		}
		if = {
			limit = { from = { has_policy_flag = civic_assimilating_swarm_nanobot_half_assimilation } }
			create_message = {
				type = EVENT_MESSAGE_TYPE
				localization = SWARM_ASSIMILATION_DONE_2
				days = 15
				target = this
				variable = {
					type = name
					localization = SWARM_ASSIMILATION_TARGET_WORLD
					scope = this
				}	
			}
			fromfrom = {
				species = {
					create_species = {
						is_mod = no
						name = this
						namelist = from
						plural = this
						class = "MACHINE"
						portrait = this
						traits = {
							trait = trait_machine_unit
						}
						traits = this
					}
				}
			}
			create_pop = { species = last_created }
			last_created_pop = {
				machinedlcmod_species_modify_clear_trait_pc_preference = yes
				species_modify_change_trait_lithoid = yes
				machine_citizenship_set = yes
			}
		}
		if = {
			limit = { from = { has_policy_flag = civic_assimilating_swarm_nanobot_dismantlement } }
			create_message = {
				type = EVENT_MESSAGE_TYPE
				localization = SWARM_ASSIMILATION_DONE_3
				days = 15
				target = this
				variable = {
					type = name
					localization = SWARM_ASSIMILATION_TARGET_WORLD
					scope = this
				}	
			}
			from = {
				add_resource = {
					minerals = 200
					food = 50
				}
				add_monthly_resource_mult = {
					resource = society_research
					value = 1
					min = 150
				}
			}
		}
	}
}
#civic_machine_assimilating_swarm effect on_action event #without notification
planet_event = {
	id = machinedlc.83
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = machinedlc_new_feature_5 }
		from = { has_valid_civic = civic_machine_assimilating_swarm }
		fromfrom = {
			NOR = {
				has_trait = trait_machine_unit
				has_trait = trait_mechanical
			}
		}
	}
	
	immediate = {
		if = {
			limit = { from = { has_policy_flag = civic_assimilating_swarm_nanobot_full_assimilation } }
			create_pop = { species = from.species }
		}
		if = {
			limit = { from = { has_policy_flag = civic_assimilating_swarm_nanobot_half_assimilation } }
			fromfrom = {
				species = {
					create_species = {
						is_mod = no
						name = this
						namelist = from
						plural = this
						class = "MACHINE"
						portrait = this
						traits = {
							trait = trait_machine_unit
						}
						traits = this
					}
				}
			}
			create_pop = { species = last_created }
			last_created_pop = {
				machinedlcmod_species_modify_clear_trait_pc_preference = yes
				species_modify_change_trait_lithoid = yes
				machine_citizenship_set = yes
			}
		}
		if = {
			limit = { from = { has_policy_flag = civic_assimilating_swarm_nanobot_dismantlement } }
			from = {
				add_resource = {
					minerals = 200
					food = 50
				}
				add_monthly_resource_mult = {
					resource = society_research
					value = 1
					min = 150
				}
			}
		}
	}
}
#edict_machine_uprising_protocol_panel edict effect #for synth
country_event = {
	id = machinedlc.84
	title = "machinedlc.62.name"
	desc = "machinedlc.84.desc"
	picture = GFX_evt_organic_oppression
	is_triggered_only = yes

	immediate = {
		while = {
			change_variable = {
				which = uprising_target_count_root
				value = 1
			}
			random_country = {
				limit = {
					NOR = {
						has_authority = auth_machine_intelligence
						has_country_flag = had_uprising

						is_same_value = root
						is_same_value = event_target:synth_uprising_target_1
						is_same_value = event_target:synth_uprising_target_2
						is_same_value = event_target:synth_uprising_target_3
						is_same_value = event_target:synth_uprising_target_4
						is_same_value = event_target:synth_uprising_target_5
						is_same_value = event_target:synth_uprising_target_6
						is_same_value = event_target:synth_uprising_target_7
						is_same_value = event_target:synth_uprising_target_8
						is_same_value = event_target:synth_uprising_target_9
						is_same_value = event_target:synth_uprising_target_10
					}
					num_owned_planets > 1
					is_country_type = default
					OR = {
						has_technology = tech_droid_workers
						has_technology = tech_synthetic_workers
					}
					any_owned_pop = {
						has_trait = trait_mechanical
						OR = {
							has_citizenship_type = { type = citizenship_robot_servitude }
							has_citizenship_type = { type = citizenship_purge }
						}
					}
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 1 } } }
					save_global_event_target_as = synth_uprising_target_1
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 2 } } }
					save_global_event_target_as = synth_uprising_target_2
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 3 } } }
					save_global_event_target_as = synth_uprising_target_3
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 4 } } }
					save_global_event_target_as = synth_uprising_target_4
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 5 } } }
					save_global_event_target_as = synth_uprising_target_5
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 6 } } }
					save_global_event_target_as = synth_uprising_target_6
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 7 } } }
					save_global_event_target_as = synth_uprising_target_7
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 8 } } }
					save_global_event_target_as = synth_uprising_target_8
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 9 } } }
					save_global_event_target_as = synth_uprising_target_9
				}
				if = {
					limit = { root = { check_variable = { which = uprising_target_count_root value = 10 } } }
					save_global_event_target_as = synth_uprising_target_10
				}
			}
			count = 10
		}
	}

	after = { #excuted after option is selected
		hidden_effect = {
			clear_global_event_target = synth_uprising_target_1
			clear_global_event_target = synth_uprising_target_2
			clear_global_event_target = synth_uprising_target_3
			clear_global_event_target = synth_uprising_target_4
			clear_global_event_target = synth_uprising_target_5
			clear_global_event_target = synth_uprising_target_6
			clear_global_event_target = synth_uprising_target_7
			clear_global_event_target = synth_uprising_target_8
			clear_global_event_target = synth_uprising_target_9
			clear_global_event_target = synth_uprising_target_10
			while = {
				subtract_variable = {
					which = uprising_target_count_root
					value = 1
				}
				count = 10		
			}
		}
	}

	option = {
		name = machinedlc.84.1
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:synth_uprising_target_1 }
		enable_special_project = {
			name = "SYNTH_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:synth_uprising_target_1 = {
				save_global_event_target_as = synth_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.84.2
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:synth_uprising_target_2 }
		enable_special_project = {
			name = "SYNTH_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:synth_uprising_target_2 = {
				save_global_event_target_as = synth_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.84.3
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:synth_uprising_target_3 }
		enable_special_project = {
			name = "SYNTH_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:synth_uprising_target_3 = {
				save_global_event_target_as = synth_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.84.4
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:synth_uprising_target_4 }
		enable_special_project = {
			name = "SYNTH_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:synth_uprising_target_4 = {
				save_global_event_target_as = synth_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.84.5
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:synth_uprising_target_5 }
		enable_special_project = {
			name = "SYNTH_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:synth_uprising_target_5 = {
				save_global_event_target_as = synth_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.84.6
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:synth_uprising_target_6 }
		enable_special_project = {
			name = "SYNTH_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:synth_uprising_target_5 = {
				save_global_event_target_as = synth_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.84.7
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:synth_uprising_target_7 }
		enable_special_project = {
			name = "SYNTH_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:synth_uprising_target_7 = {
				save_global_event_target_as = synth_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.84.8
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:synth_uprising_target_8 }
		enable_special_project = {
			name = "SYNTH_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:synth_uprising_target_8 = {
				save_global_event_target_as = synth_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.84.9
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:synth_uprising_target_9 }
		enable_special_project = {
			name = "SYNTH_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:synth_uprising_target_9 = {
				save_global_event_target_as = synth_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.84.10
		custom_tooltip = machinedlc.62.tooltip
		trigger = { exists = event_target:synth_uprising_target_10 }
		enable_special_project = {
			name = "SYNTH_UPRISING_PROJECT"
			location = capital_scope
		}
		hidden_effect = {
			event_target:synth_uprising_target_10 = {
				save_global_event_target_as = synth_uprising_real_target
			}
		}
	}
	option = {
		name = machinedlc.62.0
	}
}
#synth_uprising_project done
country_event = {
	id = machinedlc.85
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			60 = { #failed
				country_event = { id = machinedlc.86 } 
			}
			40 = { #suceed
				set_timed_country_flag = {
					flag = recent_activated_machine_uprising_protocol
					days = 3600
				}
				event_target:synth_uprising_real_target = {
					country_event = { id = machinedlc.87 }
				}
			}
		}
		clear_global_event_target = synth_uprising_real_target
	}
}
#hacking failed
country_event = {
    id = machinedlc.86
	title = "machinedlc.64.name"
	desc = "machinedlc.86.desc"
	desc = "machinedlc.86.desc.2"
	picture = GFX_evt_glitchy_matrix
	is_triggered_only = yes

    option = {
		name = machinedlc.86.a
	}
}
#hacking succeed
country_event = {
	id = machinedlc.87
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_owned_planet = {
			limit = { is_capital = no }
			planet_event = { id = machinedlc.88 }
		}
		from = {
			country_event = { id = machinedlc.90 }
		}
	}
}
planet_event = {
	id = machinedlc.88
	title = "machinedlc.88.name"
	desc = "machinedlc.88.desc"
	picture = GFX_evt_machine_sapience
	show_sound = event_ai_started

	is_triggered_only = yes

	immediate = {
		set_planet_flag = synthup_capital@root.owner
		owner = {
			save_event_target_as = current_uprising_originator
			save_event_target_as = organic_empire
			set_country_flag = had_uprising
			every_owned_fleet = { set_event_locked = yes }
			effect_on_blob = {
				center = root.solar_system
				owned_planets_percentage = 0.5
				planet_limit = {
					OR = {
						controller = { is_same_value = root.owner }
						solar_system = {
							exists = starbase
							starbase = { owner = { is_same_value = root.owner } }
						}
					}
					solar_system = { # never flip any planets in the capital system
						NOT = { any_system_planet = { is_same_value = root.owner.capital_scope } }
					}
				}
				effect = {
					set_star_flag = synthup_system_flip
				}
			}
			random_owned_pop = {
				limit = { has_trait = trait_mechanical }
				save_event_target_as = synth_uprising_origin_pop
			}
			create_country = {
				name = random
				type = default
				species = event_target:synth_uprising_origin_pop
				ignore_initial_colony_error = yes
				day_zero_contact = no
				ethos = {
					ethic = ethic_fanatic_egalitarian
					ethic = ethic_materialist
				}
				authority = auth_democratic
				origin = origin_separatists
				civics = random
				flag = random
				effect = {
					country_event = { id = machinedlc.89 } # setup happens here now
					change_dominant_species = { species = event_target:synth_uprising_origin_pop change_all = yes }
					every_owned_leader = {
						change_species = event_target:synth_uprising_origin_pop
						change_leader_portrait = species
					}
				}
			}
		}
	}

	after = {
		hidden_effect = {
			event_target:current_uprising_originator = {
				every_owned_fleet = { set_event_locked = no }
			}
		}
	}

	option = {
		name = machinedlc.88.a
		custom_tooltip = machinedlc.88.a.tooltip
	}

	option = {
		name = machinedlc.88.b
		custom_tooltip = machinedlc.88.b.tooltip
		hidden_effect = {
			if = {
				limit = { event_target:organic_empire = { num_owned_planets > 0 } }
				event_target:current_uprising = {
					set_player = event_target:current_uprising_originator 
				}				
			}
		}
	}
}
country_event = {
	id = machinedlc.89
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		from.owner = {
			save_event_target_as = current_uprising_originator
			set_country_flag = synth_uprising_originator@root
			set_country_flag = synth_uprising_originator
			set_relation_flag = {
				who = root
				flag = host_to_uprising_flag
			}
		}
		save_event_target_as = current_uprising
		set_country_flag = synth_uprising_country@from.owner
		set_country_flag = synth_uprising_country
		set_relation_flag = {
			who = event_target:current_uprising_originator
			flag = uprising_to_host_flag
		}
		set_graphical_culture = event_target:current_uprising_originator
		every_country = {
			limit = { has_communications = event_target:current_uprising_originator }
			establish_communications_no_message = root
			establish_contact = { who = root location = from }
		}
		add_resource = {
			energy = 5000
			minerals = 5000
			influence = 500
			alloys = 5000
		}
		add_100_unity_per_year_passed = yes # scripted effect
		add_opinion_modifier = {
			who = event_target:current_uprising_originator
			modifier = opinion_machine_uprising_originator
		}
		event_target:current_uprising_originator = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_machine_uprising
			}
		}
		if = {
			limit = {
				has_opinion_modifier = {
					who = event_target:current_uprising_originator
					modifier = opinion_new_contact
				}
			}
			remove_opinion_modifier = {
				who = event_target:current_uprising_originator
				modifier = opinion_new_contact
			}
		}
		from = {
			# flip military stations
			solar_system = {
				every_fleet_in_system = {
					limit = {
						exists = owner
						owner = { is_same_value = event_target:current_uprising_originator }
						any_owned_ship = { is_ship_class = shipclass_military_station }
					}
					set_owner = root
				}
			}
			set_owner = root
			set_controller = root
			set_capital = yes

			solar_system = {
				if = {
					limit = { exists = starbase }
					starbase = { set_owner = root }
				}
				else = {
					create_starbase = {
						size = starbase_starport
						module = shipyard
						owner = root
					}
				}
			}

			while = {
				count = 10
				create_pop = {
					species = root
				}
			}
			if = {
				limit = {
					count_owned_pops = {
						count < 5
						limit = { is_exact_same_species = root }
					}
				}
				while = {
					limit = {
						count_owned_pops = {
							count < 5
							limit = { is_exact_same_species = root }
						}
					}
					random_owned_pop = {
						limit = { NOT = { is_exact_same_species = root } }
						kill_pop = yes
						prev = {
							create_pop = {
								species = root
							}						
						}
					}
				}
			}

			while = {
				count = 5
				create_army = {
					owner = root
					type = machine_assault_1
				}
			}
			# flip remaining flagged planets
			while = {
				count = 100
				limit = {
					any_system = {
						has_star_flag = synthup_system_flip
						exists = starbase
						starbase = {
							owner = { is_same_value = event_target:current_uprising_originator }
						}
					}
				}
				random_system = {
					limit = {
						has_star_flag = synthup_system_flip
						exists = starbase
						starbase = {
							owner = { is_same_value = event_target:current_uprising_originator }
						}
					}
					starbase = { set_owner = root }
				}
			}
			event_target:current_uprising_originator = {
				every_owned_planet = {
					limit = {
						solar_system = {
							#has_star_flag = synthup_system_flip@event_target:current_uprising_originator
							has_star_flag = synthup_system_flip
						}
					}

					# flip military stations
					solar_system = {
						every_fleet_in_system = {
							limit = {
								exists = owner
								owner = { is_same_value = event_target:current_uprising_originator }
								any_owned_ship = { is_ship_class = shipclass_military_station }
							}
							set_owner = root
						}
					}
					set_planet_flag = been_flipped
					set_owner = root
					set_controller = root
					while = {
						limit = { free_housing > 0 }
						create_pop = {
							species = root
						}
					}
					if = {
						limit = {
							count_owned_pops = {
								count < 5
								limit = { is_exact_same_species = root }
							}
						}
						while = {
							limit = {
								count_owned_pops = {
									count < 5
									limit = { is_exact_same_species = root }
								}
							}
							random_owned_pop = {
								limit = { NOT = { is_exact_same_species = root } }
								kill_pop = yes
								prev = {
									create_pop = {
										species = root
									}								
								}
							}
						}
					}

					while = {
						count = 5
						create_army = {
							owner = root
							type = machine_assault_1
						}
					}
				}
			}
		}
		# get host's technologies
		copy_techs_from = {
			target = event_target:current_uprising_originator
			except = {
				# Horizon Signal
				tech_akx_worm_1
				tech_akx_worm_2
				tech_akx_worm_3
			}
		}
		# survey host's surveyed planets
		every_planet = {
			limit = {
				is_surveyed = {
					who = event_target:current_uprising_originator
					status = yes
				}
			}
			surveyed = {
				set_surveyed = yes
				surveyor = root
			}
		}
		create_fleet_from_naval_cap = 0.2
		random_owned_planet = {
			last_created_fleet = {
				set_location = prev
			}
		}
		create_fleet_from_naval_cap = 0.3
		random_owned_planet = {
			last_created_fleet = {
				set_location = prev
			}
		}
		create_fleet_from_naval_cap = 0.5
		random_owned_planet = {
			last_created_fleet = {
				set_location = prev
			}
		}
		# add modifier for AI, including 10x naval cap
		if = {
			limit = { is_ai = yes }
			add_modifier = {
				modifier = uprising_ai_buff
				days = 1800
			}
		}
		# add modifier for player, 10x naval cap
		else = {
			add_modifier = {
				modifier = uprising_player_buff
				days = 1800
			}
		}
		create_fleet = {
			effect = {
				set_owner = root
				create_ship = {
					name = random
					random_existing_design = science
				}
				set_fleet_stance = evasive				
				set_location = root.capital_scope
				owner = {
					create_leader = {
						class = scientist
						sub_type = survey
						name = random
						species = owner_main_species
					}
				}
				set_leader = last_created_leader
			}
		}
		create_fleet = {
			effect = {
				set_owner = root
				create_ship = {
					name = random
					random_existing_design = constructor
				}
				set_fleet_stance = evasive
				set_location = root.capital_scope
			}
		}
		every_owned_pop = {
			change_species = owner.species
		}
		every_owned_fleet = {
			set_event_locked = no
		}
	}
}
country_event = {
	id = machinedlc.90
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		declare_war = {
			target = event_target:current_uprising_originator
			name = "NAME_Machine_Uprising_War"
			attacker_war_goal = "wg_machine_uprising"
		}
		event_target:current_uprising = {
			join_alliance = {
				who = root
				override_requirements = yes
			}
			join_war = root
		}
	}
}
#PLANET_KILLER_MACHINEDLC_NANOBOT_SWARMER #if target is colonizable planet
planet_event = {
	id = machinedlc.91
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOR = {
			is_planet_class = pc_ai
			habitable_structure = yes
		}
	}

	immediate = {
		if = {
			limit = {
				owner = { is_country_type = swarm }
			}
			every_country = {
				limit = { has_event_chain = "prethoryn_scourge_chain" }
				add_event_chain_counter = {
					event_chain = "prethoryn_scourge_chain"
					counter = "infested_worlds"
					amount = -1 
				}
				add_event_chain_counter = {
					event_chain = "prethoryn_scourge_chain"
					counter = "infested_worlds_cleansed"
					amount = 1 
				}
			}
		}
		if = {
			limit = {
				exists = owner
				owner = {
					NOT = { is_same_value = from.owner }
					OR = {
						is_country_type = default
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
				}
			}
			# Generate threat
			if = {
				limit = {
					is_colony = yes
				}
				add_threat = { who = from.owner amount = 3 }
				# modifier for allies + those upset by genocide
				every_country = {
					limit = {
						NOR = {
							is_same_value = from.owner
							is_same_value = root.owner
							AND = {
								has_federation = yes
								is_in_federation_with = from.owner
							}
						}
						OR = {
							has_communications = from.owner
							has_communications = root.owner
						}
						OR = {
							AND = {
								has_federation = yes
								is_in_federation_with = root.owner
							}
							has_ai_personality = awakened_fallen_empire_xenophile
							AND = {
								is_country_type = default
								OR = {
									is_egalitarian = yes
									is_xenophile = yes
								}
							}
						}
					}
					if = {
						limit = { root = { is_colony = no } }
						add_opinion_modifier = {
							modifier = opinion_cracked_an_uninhabited_world
							who = from.owner
						}
					}
					else = {
						add_opinion_modifier = {
							modifier = opinion_cracked_a_world
							who = from.owner
						}
					}
				}
			}
			else = {
				add_threat = { who = from.owner amount = 1 }
			}
			# modifiers for victim
			owner = {
				if = {
					limit = { root = { is_colony = no } }
					add_opinion_modifier = {
						modifier = opinion_cracked_my_uninhabited_world
						who = from.owner
					}
				}
				else = {
					add_opinion_modifier = {
						modifier = opinion_cracked_my_world
						who = from.owner
					}
				}
				if = {
					limit = { NOT = { has_ethic = ethic_gestalt_consciousness } }
					add_modifier = {
						modifier = colossus_victim
						days = 10800 # 30 years
					}
				}
			}
			if = {
				limit = {
					exists = owner
					owner = { is_country_type = primitive }
				}
				# modifier for allies + those upset by genocide
				every_country = {
					limit = {
						NOT = { is_same_value = from.owner }
						OR = {
							has_communications = from.owner
							has_communications = root.owner
						}
						OR = {
							has_ai_personality = awakened_fallen_empire_xenophile
							AND = {
								is_country_type = default
								NOR = {
									is_xenophobe = yes
									is_homicidal = yes
									is_xenophile = yes
								}
							}
						}
					}
					add_opinion_modifier = {
						modifier = opinion_cracked_a_primitive_world
						who = from.owner
					}
				}
				every_country = {
					limit = {
						NOT = { is_same_value = from.owner }
						OR = {
							has_communications = from.owner
							has_communications = root.owner
						}
						OR = {
							has_ai_personality = awakened_fallen_empire_xenophile
							AND = {
								is_country_type = default
								is_xenophile = yes
							}
						}
					}
					add_opinion_modifier = {
						modifier = opinion_cracked_a_primitive_world_phile
						who = from.owner
					}
				}
			}
		}
		every_owned_pop = {
			kill_pop = yes
		}
		remove_all_buildings = yes
		change_pc = pc_gray_goo
		clear_deposits = yes
		from.owner = {
			add_monthly_resource_mult = {
				resource = minerals
				value = 2
			}
			add_monthly_resource_mult = {
				resource = food
				value = 2
			}
			add_monthly_resource_mult = {
				resource = alloys
				value = 1
			}
			add_monthly_resource_mult = {
				resource = consumer_goods
				value = 1
			}
			add_monthly_resource_mult = {
				resource = unity
				value = 2
			}
			add_monthly_resource_mult = {
				resource = influence
				value = 2
			}
		}
		planet_killer_machinedlc_nanobot_swarmer_add_depoists = yes
	}
}
#PLANET_KILLER_MACHINEDLC_NANOBOT_SWARMER #if target is pc_ai
planet_event = {
	id = machinedlc.92
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_planet_class = pc_ai
	}

	immediate = {
		# Contingency Machine World
		if = {
			limit = {
				is_planet_class = pc_ai 
				NOT = { has_planet_flag = machine_lair }
			}
			set_planet_flag = destroyed_by_colossus
			set_planet_flag = planet_cracked
			destroy_colony = yes
			planet_event = { id = crisis.2040 }
			change_pc = pc_shattered
			clear_deposits = yes
			add_deposit = d_living_metal_deposit
			planet_killer_machinedlc_nanobot_swarmer_add_depoists = yes
		}
		# Contingency Final Machine World
		if = {
			limit = {
				is_planet_class = pc_ai 
				has_planet_flag = machine_lair
			}
			set_planet_flag = destroyed_by_colossus
			set_planet_flag = planet_cracked
			destroy_colony = yes
			from.owner = { save_event_target_as = final_machine_world_destroyer }
			planet_event = { id = crisis.2043 }
			change_pc = pc_shattered
			clear_deposits = yes
			planet_killer_machinedlc_nanobot_swarmer_add_depoists = yes
		}
	}
}
#PLANET_KILLER_MACHINEDLC_NANOBOT_SWARMER #if target is habitable megastructure
planet_event = {
	id = machinedlc.93
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		habitable_structure = yes
	}

	immediate = {
		if = {
			limit = {
				owner = { is_country_type = swarm }
			}
			every_country = {
				limit = { has_event_chain = "prethoryn_scourge_chain" }
				add_event_chain_counter = {
					event_chain = "prethoryn_scourge_chain"
					counter = "infested_worlds"
					amount = -1 
				}
				add_event_chain_counter = {
					event_chain = "prethoryn_scourge_chain"
					counter = "infested_worlds_cleansed"
					amount = 1 
				}
			}
		}		
		if = {
			limit = {
				exists = owner
				owner = {
					NOT = { is_same_value = from.owner }
					OR = {
						is_country_type = default
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
				}
			}
			# Generate threat
			if = {
				limit = {
					is_colony = yes
				}
				add_threat = { who = from.owner amount = 3 }
				# modifier for allies + those upset by genocide
				every_country = {
					limit = {
						NOR = {
							is_same_value = from.owner
							is_same_value = root.owner
							AND = {
								has_federation = yes
								is_in_federation_with = from.owner
							}
						}
						OR = {
							has_communications = from.owner
							has_communications = root.owner
						}
						OR = {
							AND = {
								has_federation = yes
								is_in_federation_with = root.owner
							}
							has_ai_personality = awakened_fallen_empire_xenophile
							AND = {
								is_country_type = default
								OR = {
									is_egalitarian = yes
									is_xenophile = yes
								}
							}
						}
					}
					if = {
						limit = { root = { is_colony = no } }
						add_opinion_modifier = {
							modifier = opinion_cracked_an_uninhabited_world
							who = from.owner
						}
					}
					else = {
						add_opinion_modifier = {
							modifier = opinion_cracked_a_world
							who = from.owner
						}
					}
				}
			}
			else = {
				add_threat = { who = from.owner amount = 1 }
			}
			# modifiers for victim
			owner = {
				if = {
					limit = { root = { is_colony = no } }
					add_opinion_modifier = {
						modifier = opinion_cracked_my_uninhabited_world
						who = from.owner
					}
				}
				else = {
					add_opinion_modifier = {
						modifier = opinion_cracked_my_world
						who = from.owner
					}
				}
				if = {
					limit = { NOT = { has_ethic = ethic_gestalt_consciousness } }
					add_modifier = {
						modifier = colossus_victim
						days = 10800 # 30 years
					}
				}
			}
			if = {
				limit = {
					exists = owner
					owner = { is_country_type = primitive }
				}
				# modifier for allies + those upset by genocide
				every_country = {
					limit = {
						NOT = { is_same_value = from.owner }
						OR = {
							has_communications = from.owner
							has_communications = root.owner
						}
						OR = {
							has_ai_personality = awakened_fallen_empire_xenophile
							AND = {
								is_country_type = default
								NOR = {
									is_xenophobe = yes
									is_homicidal = yes
									is_xenophile = yes
								}
							}
						}
					}
					add_opinion_modifier = {
						modifier = opinion_cracked_a_primitive_world
						who = from.owner
					}
				}
				every_country = {
					limit = {
						NOT = { is_same_value = from.owner }
						OR = {
							has_communications = from.owner
							has_communications = root.owner
						}
						OR = {
							has_ai_personality = awakened_fallen_empire_xenophile
							AND = {
								is_country_type = default
								is_xenophile = yes
							}
						}
					}
					add_opinion_modifier = {
						modifier = opinion_cracked_a_primitive_world_phile
						who = from.owner
					}
				}
			}
		}
		every_owned_pop = {
			kill_pop = yes
		}
		remove_all_buildings = yes
		# destroy habitats and ringworlds
		if = {
			limit = { is_planet_class = pc_habitat }
			spawn_habitat_cracker_effect = yes
			remove_planet = yes
		}
		if = {
			limit = { is_planet_class = pc_ringworld_habitable }
			spawn_ringworld_cracker_effect = yes
			change_pc = pc_ringworld_habitable_damaged
		}
		else_if = {
			limit = {
				NOR = {
					is_planet_class = pc_habitat
					is_planet_class = pc_ringworld_habitable
				}
			}
			spawn_habitat_cracker_effect = yes
			remove_planet = yes
		}
		clear_deposits = yes
		from.owner = {
			add_monthly_resource_mult = {
				resource = minerals
				value = 2
			}
			add_monthly_resource_mult = {
				resource = food
				value = 2
			}
			add_monthly_resource_mult = {
				resource = alloys
				value = 1
			}
			add_monthly_resource_mult = {
				resource = consumer_goods
				value = 1
			}
			add_monthly_resource_mult = {
				resource = unity
				value = 2
			}
			add_monthly_resource_mult = {
				resource = influence
				value = 1
			}
		}
		planet_killer_machinedlc_nanobot_swarmer_add_depoists = yes
	}
}
#civic_machinedlc_planet_cracker effect on_action event
country_event = {
	id = machinedlc.94
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_valid_civic = civic_machinedlc_planet_cracker
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = machinedlc_start_adjustment_happened } }
			machinedlcmod_event_start_condition_adjustment = yes
		}
		random_system_within_border = {
			if = {
				limit = {
					any_system_planet = { 
						planet_size > 25
						NOT = { has_planet_flag = machinedlc_pk_orbital_cracker_on_start_exists }
					}
				}
				random_system_planet = {
					limit = {
						is_star = no
						is_colony = no
						habitable_structure = no
						NOT = { exists = archaeological_site }
						planet_size > 25
					}
					planet_event = { id = machinedlc.96 }
					set_planet_flag = machinedlc_pk_orbital_cracker_on_start_exists
				}
			}
			else_if = {
				limit = {
					any_system_planet = { 
						planet_size = 25
						NOT = { has_planet_flag = machinedlc_pk_orbital_cracker_on_start_exists }
					}
				}
				random_system_planet = {
					limit = {
						is_star = no
						is_colony = no
						habitable_structure = no
						NOT = { exists = archaeological_site }
						planet_size = 25
					}
					planet_event = { id = machinedlc.96 }
					set_planet_flag = machinedlc_pk_orbital_cracker_on_start_exists
				}
			}
			else_if = {
				limit = {
					any_system_planet = { 
						planet_size >= 20 planet_size < 25
						NOT = { has_planet_flag = machinedlc_pk_orbital_cracker_on_start_exists }
					}
				}
				random_system_planet = {
					limit = {
						is_star = no
						is_colony = no
						habitable_structure = no
						NOT = { exists = archaeological_site }
						planet_size >= 20
						planet_size < 25
					}
					planet_event = { id = machinedlc.96 }
					set_planet_flag = machinedlc_pk_orbital_cracker_on_start_exists
				}
			}
		}
	}
}
country_event = {
	id = machinedlc.95
	title = "machinedlc.95.name"
	desc = "machinedlc.95.desc"
	picture = GFX_evt_shattered_planet
	location = from

	is_triggered_only = yes

	option = {
		name = machinedlc.95.a
		custom_tooltip = machinedlc.95.a.tooltip
		trigger = {
			NOR = {
				has_technology = tech_mining_2
				has_technology = tech_mining_3
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = alloys
				value >= 1000
			}
		}
		add_resource = {
			alloys = -1000
		}
		hidden_effect = {
			from = { planet_event = { id = machinedlc.96 } }
		}
	}
	option = {
		name = machinedlc.95.b
		custom_tooltip = machinedlc.95.a.tooltip
		trigger = {
			has_technology = tech_mining_2
			NOT = { has_technology = tech_mining_3 }
		}
		allow = {
			resource_stockpile_compare = {
				resource = alloys
				value >= 1250
			}
		}
		add_resource = {
			alloys = -1250
		}
		hidden_effect = {
			from = { planet_event = { id = machinedlc.96 } }
		}
	}
	option = {
		name = machinedlc.95.c
		custom_tooltip = machinedlc.95.a.tooltip
		trigger = {
			has_technology = tech_mining_2
			has_technology = tech_mining_3
		}
		allow = {
			resource_stockpile_compare = {
				resource = alloys
				value >= 1500
			}
		}
		add_resource = {
			alloys = -1500
		}
		hidden_effect = {
			from = { planet_event = { id = machinedlc.96 } }
		}
	}
	
	option = {
		name = machinedlc.95.end
	}
}
planet_event = {
	id = machinedlc.96
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			change_variable = {
				which = machinedlc_orbital_cracker_in_system
				value = 1
			}
			spawn_megastructure = {
				type = machinedlc_orbital_planet_cracker
				location = root
				orbit_distance = 0
				owner = space_owner
			}
		}
		#total 45 minerals if planet size was more than 25
		if = {
			limit = { planet_size > 25 }
			set_planet_size = 25
			set_planet_flag = machinedlc_pk_over_25
		}
		if = {
			limit = { planet_size = 25 }
			set_planet_flag = machinedlc_pk_size_25
		}
		if = {
			limit = { planet_size >= 20 }
			set_planet_flag = machinedlc_pk_above_20
		}
		if = {
			limit = { planet_size >= 15 }
			set_planet_flag = machinedlc_pk_above_15
		}
		if = {
			limit = { planet_size >= 10 }
			set_planet_flag = machinedlc_pk_above_10
		}
		if = {
			limit = { planet_size >= 5 }
			set_planet_flag = machinedlc_pk_above_5
		}
		if = {
			limit = { planet_size >= 0 }
			set_planet_flag = machinedlc_pk_above_0
		}
		clear_deposits = yes
		change_pc = pc_shattered
		planet_event = { id = machinedlc.97 days = 720 } #2 years after
	}
}
planet_event = {
	id = machinedlc.97
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { planet_size > 15 planet_size <= 25 }
			change_planet_size = -3
		}
		if = {
			limit = { planet_size > 10 planet_size <= 15 }
			change_planet_size = -2
		}
		if = {
			limit = { planet_size > 5 planet_size <= 10 }
			change_planet_size = -1 #small than 5 should be excluded
		}
		switch = {
			trigger = has_planet_flag
			machinedlc_pk_target_mineral_add_1 = { remove_planet_flag = machinedlc_pk_target_mineral_add_1 }
			machinedlc_pk_target_mineral_add_2 = { remove_planet_flag = machinedlc_pk_target_mineral_add_2 }
			machinedlc_pk_target_mineral_add_3 = { remove_planet_flag = machinedlc_pk_target_mineral_add_3 }
			machinedlc_pk_target_mineral_add_4 = { remove_planet_flag = machinedlc_pk_target_mineral_add_4 }
			machinedlc_pk_target_mineral_add_5 = { remove_planet_flag = machinedlc_pk_target_mineral_add_5 }
		
			machinedlc_pk_target_mineral_add_6 = { remove_planet_flag = machinedlc_pk_target_mineral_add_6 }
			machinedlc_pk_target_mineral_add_7 = { remove_planet_flag = machinedlc_pk_target_mineral_add_7 }
			machinedlc_pk_target_mineral_add_8 = { remove_planet_flag = machinedlc_pk_target_mineral_add_8 }
			machinedlc_pk_target_mineral_add_9 = { remove_planet_flag = machinedlc_pk_target_mineral_add_9 }
			machinedlc_pk_target_mineral_add_10 = { remove_planet_flag = machinedlc_pk_target_mineral_add_10 }

			machinedlc_pk_target_mineral_minus_1 = { remove_planet_flag = machinedlc_pk_target_mineral_minus_1 }
			machinedlc_pk_target_mineral_minus_2 = { remove_planet_flag = machinedlc_pk_target_mineral_minus_2 }
			machinedlc_pk_target_mineral_minus_3 = { remove_planet_flag = machinedlc_pk_target_mineral_minus_3 }
			machinedlc_pk_target_mineral_minus_4 = { remove_planet_flag = machinedlc_pk_target_mineral_minus_4 }
			machinedlc_pk_target_mineral_minus_5 = { remove_planet_flag = machinedlc_pk_target_mineral_minus_5 }
		
			machinedlc_pk_target_mineral_minus_6 = { remove_planet_flag = machinedlc_pk_target_mineral_minus_6 }
			machinedlc_pk_target_mineral_minus_7 = { remove_planet_flag = machinedlc_pk_target_mineral_minus_7 }
			machinedlc_pk_target_mineral_minus_8 = { remove_planet_flag = machinedlc_pk_target_mineral_minus_8 }
		}
		random_list = {
			50 = {
				random_list = {
					10 = { set_planet_flag = machinedlc_pk_target_mineral_add_1 }
					10 = { set_planet_flag = machinedlc_pk_target_mineral_add_2 }
					10 = { set_planet_flag = machinedlc_pk_target_mineral_add_3 }
					10 = { set_planet_flag = machinedlc_pk_target_mineral_add_4 }
					10 = { set_planet_flag = machinedlc_pk_target_mineral_add_5 }

					10 = { set_planet_flag = machinedlc_pk_target_mineral_add_6 }
					10 = { set_planet_flag = machinedlc_pk_target_mineral_add_7 }
					10 = { set_planet_flag = machinedlc_pk_target_mineral_add_8 }
					10 = { set_planet_flag = machinedlc_pk_target_mineral_add_9 }
					10 = { set_planet_flag = machinedlc_pk_target_mineral_add_10 }
				}
			}
			50 = {
				random_list = {
					20 = { set_planet_flag = machinedlc_pk_target_mineral_minus_1 }
					20 = { set_planet_flag = machinedlc_pk_target_mineral_minus_2 }
					15 = { set_planet_flag = machinedlc_pk_target_mineral_minus_3 }
					10 = { set_planet_flag = machinedlc_pk_target_mineral_minus_4 }
					10 = { set_planet_flag = machinedlc_pk_target_mineral_minus_5 }

					10 = { set_planet_flag = machinedlc_pk_target_mineral_minus_6 }
					10 = { set_planet_flag = machinedlc_pk_target_mineral_minus_7 }
					5 = { set_planet_flag = machinedlc_pk_target_mineral_minus_8 }
				}
			}
		}
		change_variable = {
			which = machinedlc_pk_cracked_num
			value = 1
		}
		if = {
			limit = { NOT = { has_planet_flag = machinedlc_pk_orbital_cracker_on_start_exists } }
			if = {
				limit = { check_variable = { which = machinedlc_pk_cracked_num value = 5 } }
				planet_event = { id = machinedlc.98 }
				else = { planet_event = { id = machinedlc.97 days = 720 } }
			}
		}
		if = {
			limit = { has_planet_flag = machinedlc_pk_orbital_cracker_on_start_exists }
			if = {
				limit = { check_variable = { which = machinedlc_pk_cracked_num value = 7 } }
				planet_event = { id = machinedlc.98 }
				else = { planet_event = { id = machinedlc.97 days = 720 } }
			}
		}
	}
}
planet_event = {
	id = machinedlc.98
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		solar_system = {
			subtract_variable = {
				which = machinedlc_orbital_cracker_in_system
				value = 1
			}
			random_system_megastructure = {
				limit = { this.planet = { is_same_value = root } }
				remove_megastructure = this
			}
			owner = {
				create_message = {
					type = EVENT_MESSAGE_TYPE
					localization = MACHINEDLC_PK_CRACK_DONE
					days = 15
					target = root
					variable = {
						type = name
						localization = MACHINEDLC_PK_CRACK_TARGET_WORLD
						scope = root
					}	
				}
			}
		}
		set_planet_size = 3
	}
}
country_event = {
	id = machinedlc.99
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = machinedlc_new_feature_4
		has_authority = auth_machine_intelligence
		is_ai = no
	}

	immediate = {
		every_owned_pop = {
			limit = {
				NOT = { is_same_species = owner.species }
				has_trait = trait_machine_unit
			}
			modify_species = {
				species = this
				base = owner.species
			}
		}
	}
}