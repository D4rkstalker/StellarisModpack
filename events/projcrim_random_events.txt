namespace = projcrim_random

# The owner = {} parts are redundant but they were initially situation events
# and I didn't want to go through to remove them all

## Bad Events ##

# Random Leader Infected
country_event = {
	id = projcrim_random.1
	title = "projcrim_random.1.name"
	desc = "projcrim_random.1.desc"
	picture = GFX_evt_alien_propaganda
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_event_chain = projcrim_main_chain
			NOT = { has_country_flag = projcrim_plague_cured }
		}
	}

	immediate = {
		owner = {
			random_owned_leader = {
				limit = {
					is_ruler = no
				}
				save_event_target_as = newly_infected_leader
			}
		}
	}
	
	option = {
		name = "projcrim_random.1.a"
		event_target:newly_infected_leader = {
			infect_leader_projcrim = yes
		}
	}
	option = {
		name = "projcrim_random.1.b"
		hidden_effect = {
			event_target:newly_infected_leader = {
				infect_leader_projcrim = yes
				kill_leader = {
					show_notification = no
					fire = yes
				}
			}
		}
		custom_tooltip = projcrim_fire_leader
	}
	option = {
		name = "projcrim_random.1.c"
		trigger = {
			owner = {
				OR = {
					is_authoritarian = yes
					is_militarist = yes
				}
			}
		}
		hidden_effect = {
			event_target:newly_infected_leader = {
				infect_leader_projcrim = yes
				kill_leader = {
					show_notification = yes
				}
			}
		}
		owner = {
			add_resource = {
				unity = 750
			}
		}
	}
}

# Ruler Infected
country_event = {
	id = projcrim_random.2
	title = "projcrim_random.2.name"
	desc = "projcrim_random.2.desc"
	picture = GFX_evt_space_funeral
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_event_chain = projcrim_main_chain
			NOT = { has_country_flag = projcrim_plague_cured }
			ruler = {
				NOT = {
					has_trait = trait_crimson_infected
				}
			}
		}
	}

	immediate = {
	}
	
	option = {
		name = "projcrim_random.2.a"
		owner = { ruler = { add_trait = leader_trait_projcrim_infected_ruler } }
	}
	option = {
		name = "projcrim_random.2.b"
		trigger = {
			owner = { is_gestalt = no }
		}
		hidden_effect = {
			owner = {
				ruler = {
					add_trait = leader_trait_projcrim_infected_ruler
					kill_leader = {
						show_notification = no
						fire = no
					}
				}
			}
		}
		custom_tooltip = projcrim_fire_ruler
	}
	option = {
		name = "projcrim_random.2.c"
		trigger = {
			owner = {
				OR = {
					is_authoritarian = yes
					is_militarist = yes
				}
			}
		}
		owner = {
			hidden_effect = { ruler = { add_trait = leader_trait_projcrim_infected_ruler } }
			ruler = {
				kill_leader = {
					show_notification = yes
					fire = yes
				}
			}
			add_resource = {
				unity = -200
				influence = 100
			}
		}
	}
	option = {
		name = "projcrim_random.2.d"
		trigger = {
			owner = {
				OR = {
					is_materialist = yes
					is_spiritualist = yes
				}
			}
		}
		owner = {
			ruler = { add_trait = leader_trait_projcrim_infected_ruler }
			custom_tooltip = projcrim_healing_ruler
			hidden_effect = {
				random_list = {
					50 = {
						country_event = {
							id = projcrim_random.3
							days = 10
							random = 20
						}
					}
					50 = {
						country_event = {
							id = projcrim_random.4
							days = 10
							random = 20
						}
					}
				}
			}
		}
	}
}

# Ruler Died
country_event = {
	id = projcrim_random.3
	title = "projcrim_random.3.name"
	desc = "projcrim_random.3.desc"
	picture = GFX_evt_space_funeral
	
	is_triggered_only = yes
	
	trigger = {
		has_event_chain = projcrim_main_chain
		NOT = { has_country_flag = projcrim_plague_cured }
	}

	immediate = {
	}
	
	option = {
		name = "projcrim_random.3.a"
		ruler = {
			kill_leader = {
				show_notification = yes
				fire = no
			}
		}
	}
}

# Ruler Survived
country_event = {
	id = projcrim_random.4
	title = "projcrim_random.4.name"
	desc = "projcrim_random.4.desc"
	picture = GFX_evt_grand_speech
	
	is_triggered_only = yes
	
	trigger = {
		has_event_chain = projcrim_main_chain
		NOT = { has_country_flag = projcrim_plague_cured }
	}

	immediate = {
	}
	
	option = {
		name = "projcrim_random.4.a"
		ruler = {
			remove_trait = leader_trait_projcrim_infected_ruler
		}
	}
}

# Fleet Infected
country_event = {
	id = projcrim_random.5
	title = "projcrim_random.5.name"
	desc = "projcrim_random.5.desc"
	picture = GFX_evt_fleet_evil
	location = event_target:projcrim_fleet_target
	
	is_triggered_only = yes
	

	trigger = {
		owner = {
			has_event_chain = projcrim_main_chain
			NOR = {
				has_country_flag = projcrim_plague_cured
				has_country_flag = fleet_hijacked
			}
			any_owned_fleet = {
				is_mobile = yes
			}
		}
	}

	immediate = {
		owner = {
			set_timed_country_flag = {
				flag = fleet_hijacked
				days = 3600
			}
		}
	}
	
	option = {
		name = "projcrim_random.5.a"
		owner = {
			hidden_effect = {
				random_planet_within_border = {
					save_event_target_as = projcrim_fleet_target
				}
				random_owned_fleet = {
					limit = {
						fleet_power < 2500
						is_mobile = yes
					}
					set_owner = event_target:crimson_throng_country
					# FLEET MOVEMENT REMOVED - FOUND TO BE ANNOYING,
					# ESPECIALLY WITH LARGER FLEETS
					# fleet_event = {
					# 	id = projcrim_random.13
					# 	days = 15
					# }
				}
			}
			custom_tooltip = projcrim_fleet_hijacked
		}
	}
}

# Superspreader 1
country_event = {
	id = projcrim_random.6
	title = "projcrim_random.6.name"
	desc = "projcrim_random.6.desc"
	picture = GFX_evt_disease_outbreak
	location = event_target:superspread_world
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_event_chain = projcrim_main_chain
			NOT = { has_country_flag = projcrim_plague_cured }
		}
	}

	immediate = {
		owner = {
			random_owned_planet = {
				limit = {
					any_owned_pop = {
						pop_has_trait = trait_crimson_infected
					}
					is_colony = yes
					is_under_colonization = no
				}
				save_event_target_as = superspread_world
			}
		}
	}
	
	option = {
		name = "projcrim_random.6.a"
		hidden_effect = {
			owner = {
				event_target:superspread_world = {
					while = {
						count = 2
						projcrim_infect_pops = yes
					}
				}
			}
		}
		custom_tooltip = projcrim_2_infected
	}
}

# Superspreader 2
country_event = {
	id = projcrim_random.7
	title = "projcrim_random.6.name"
	desc = "projcrim_random.6.desc"
	picture = GFX_evt_disease_outbreak
	location = event_target:superspread_world
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_event_chain = projcrim_main_chain
			NOT = { has_country_flag = projcrim_plague_cured }
		}
	}

	immediate = {
		owner = {
			random_owned_planet = {
				limit = {
					any_owned_pop = {
						pop_has_trait = trait_crimson_infected
					}
					is_colony = yes
					is_under_colonization = no
				}
				save_event_target_as = superspread_world
			}
		}
	}
	
	option = {
		name = "projcrim_random.6.a"
		hidden_effect = {
			owner = {
				event_target:superspread_world = {
					while = {
						count = 3
						projcrim_infect_pops = yes
					}
				}
			}
		}
		custom_tooltip = projcrim_3_infected
	}
}

# Wave of Violence
country_event = {
	id = projcrim_random.8
	title = "projcrim_random.8.name"
	desc = "projcrim_random.8.desc"
	picture = GFX_evt_burning_settlement
	location = event_target:violence_world
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_event_chain = projcrim_main_chain
			NOT = { has_country_flag = projcrim_plague_cured }
		}
	}

	immediate = {
		owner = {
			random_owned_planet = {
				limit = {
					any_owned_pop = {
						pop_has_trait = trait_crimson_infected
					}
					is_colony = yes
					is_under_colonization = no
				}
				save_event_target_as = violence_world
			}
			event_target:violence_world = {
				random_list = {
					33 = {
						random_owned_pop = {
							kill_pop = yes
						}
						set_timed_planet_flag = {
							flag = projcrim_wov_a
							days = 180
						}
					}
					33 = {
						add_modifier = {
							modifier = projcrim_initial_crime_1
							days = 360
						}
						set_timed_planet_flag = {
							flag = projcrim_wov_b
							days = 180
						}
					}
					33 = {
						add_deposit = d_city_ruins
						set_timed_planet_flag = {
							flag = projcrim_wov_c
							days = 180
						}
					}
				}
			}
		}
	}
	
	option = {
		name = "projcrim_random.6.a"
		if = {
			limit = { event_target:violence_world = { has_planet_flag = projcrim_wov_a } }
			custom_tooltip = projcrim_wov_a
		}
		else_if = {
			limit = { event_target:violence_world = { has_planet_flag = projcrim_wov_b } }
			custom_tooltip = projcrim_wov_b
		}
		else_if = {
			limit = { event_target:violence_world = { has_planet_flag = projcrim_wov_c } }
			custom_tooltip = projcrim_wov_c
		}
	}
}

# Upset Populace
country_event = {
	id = projcrim_random.9
	title = "projcrim_random.9.name"
	desc = "projcrim_random.9.desc"
	picture = GFX_evt_civil_action
	location = event_target:discontent_world
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_event_chain = projcrim_main_chain
			NOT = { has_country_flag = projcrim_plague_cured }
			is_gestalt = no
		}
	}

	immediate = {
		owner = {
			random_owned_planet = {
				limit = {
					any_owned_pop = {
						pop_has_trait = trait_crimson_infected
					}
					is_colony = yes
					is_under_colonization = no
					NOR = {
						has_modifier = projcrim_happy_pops
						has_modifier = projcrim_upset_pops
					}
				}
				save_event_target_as = discontent_world
			}
		}
	}
	
	option = {
		name = "projcrim_random.9.a"
		owner = {
			event_target:discontent_world = {
				add_modifier = {
					modifier = projcrim_upset_pops
					days = 360
				}
			}
		}
	}
}

# Starbase Occupied
country_event = {
	id = projcrim_random.12
	title = "projcrim_random.12.name"
	desc = "projcrim_random.12.desc"
	picture = GFX_evt_fleet_evil
	location = event_target:infected_base
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_event_chain = projcrim_main_chain
			NOT = { has_country_flag = projcrim_plague_cured }
		}
	}

	immediate = {
		owner = {
			random_owned_starbase = {
				save_event_target_as = infected_base
			}
		}
	}
	
	option = {
		name = "projcrim_random.5.a"
		hidden_effect = {
			event_target:infected_base = {
				set_owner = event_target:crimson_throng_country
			}
		}
		custom_tooltip = projcrim_starbase_taken
	}
}

## Good Events ##

# Wave of Peace
country_event = {
	id = projcrim_random.10
	title = "projcrim_random.10.name"
	desc = "projcrim_random.10.desc"
	picture = GFX_evt_colony_settlement
	location = event_target:peaceful_world
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_event_chain = projcrim_main_chain
			NOT = { has_country_flag = projcrim_plague_cured }
		}
	}

	immediate = {
		owner = {
			random_owned_planet = {
				limit = {
					any_owned_pop = {
						pop_has_trait = trait_crimson_infected
					}
					is_colony = yes
					is_under_colonization = no
					NOR = {
						has_modifier = projcrim_peace
						has_modifier = projcrim_initial_crime_1
					}
				}
				save_event_target_as = peaceful_world
			}
		}
	}
	
	option = {
		name = "projcrim_random.10.a"
		owner = {
			event_target:peaceful_world = {
				add_modifier = {
					modifier = projcrim_peace
					days = 360
				}
			}
		}
	}
}

# Happy Populace
country_event = {
	id = projcrim_random.11
	title = "projcrim_random.11.name"
	desc = "projcrim_random.11.desc"
	picture = GFX_evt_galactic_community
	location = event_target:satisfied_population
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_event_chain = projcrim_main_chain
			NOT = { has_country_flag = projcrim_plague_cured }
			is_gestalt = no
		}
	}

	immediate = {
		owner = {
			random_owned_planet = {
				limit = {
					any_owned_pop = {
						pop_has_trait = trait_crimson_infected
					}
					is_colony = yes
					is_under_colonization = no
					NOR = {
						has_modifier = projcrim_happy_pops
						has_modifier = projcrim_upset_pops
					}
				}
				save_event_target_as = satisfied_population
			}
		}
	}
	
	option = {
		name = "projcrim_random.10.a"
		owner = {
			event_target:satisfied_population = {
				add_modifier = {
					modifier = projcrim_happy_pops
					days = 720
				}
			}
		}
	}
}

# Sets overtaken fleet target
fleet_event = {
	id = projcrim_random.13
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		fleet_event = {
			id = projcrim_random.13
			days = 360
		}
		if = {
			limit = {
				controller = {
					is_country_type = throng_country
				}
			}
			closest_system = {
				min_steps = 0
				max_steps = 30
				use_bypasses = yes
				limit = {
					exists = owner
					has_access_fleet = root.owner
					any_system_planet = {
						is_colony = yes
						NOR = {
							is_planet_class = pc_infested
							is_planet_class = pc_ai
						}
						# NOR = {
						# 	has_planet_flag = projcrim_current_target
						# }
					}
				}
				set_timed_star_flag = {
					flag = projcrim_current_target_system
					days = 5
				}
				# random_system_planet = {
				# 	limit = {
				# 		is_colony = yes
				# 		NOR = {
				# 			is_planet_class = pc_infested
				# 			is_planet_class = pc_ai
				# 		}
				# 	}
				# 	set_timed_planet_flag = {
				# 		flag = projcrim_current_target
				# 		days = 5
				# 	}
				# }
			}
			queue_actions = {
				find_closest_system = {
					trigger = {
						id = "projcrim_hijacked"
						has_star_flag = projcrim_current_target_system
					}
					found_system = {
						move_to = this
					}
				}
			}
		}
	}
}

# Throng-Occupied Starbase gets Re-taken
starbase_event = {
	id = projcrim_random.14
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		this.owner = {
			is_country_type = throng_country
		}
		from.owner = {
			OR = {
				is_country_type = default
				is_country_type = awakened_marauders
				is_country_type = awakened_fallen_empire
			}
		}
	}

	immediate = {
		set_owner = from.owner
	}
}

# Random Event GATEKEEPER
country_event = {
	id = projcrim_random.50
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = projcrim_in_progress
	}

	immediate = {
		if = {
			limit = { has_global_flag = projcrim_in_progress }
			random_country = {
				limit = { is_country_type = global_event }
				country_event = { id = projcrim_random.50 days = 120 }
			}
		}
		every_playable_country = {
			limit = {
				OR = {
					has_country_flag = plague_present
					has_event_chain = "projcrim_main_chain"
				}
			}
			random_list = {
				200 = {
					# Nothing
				}
				15 = {
					country_event = {
						id = projcrim_random.1
						days = 5
						random = 25
					}
				}
				10 = {
					country_event = {
						id = projcrim_random.2
						days = 5
						random = 25
					}
				}
				10 = {
					country_event = {
						id = projcrim_random.5
						days = 5
						random = 25
					}
				}
				15 = {
					country_event = {
						id = projcrim_random.6
						days = 5
						random = 25
					}
				}
				20 = {
					country_event = {
						id = projcrim_random.7
						days = 5
						random = 25
					}
				}
				20 = {
					country_event = {
						id = projcrim_random.8
						days = 5
						random = 25
					}
				}
				20 = {
					country_event = {
						id = projcrim_random.9
						days = 5
						random = 25
					}
				}
				15 = {
					country_event = {
						id = projcrim_random.10
						days = 5
						random = 25
					}
				}
				10 = {
					country_event = {
						id = projcrim_random.11
						days = 5
						random = 25
					}
				}
				5 = {
					country_event = {
						id = projcrim_random.12
						days = 5
						random = 25
					}
				}
			}
		}
	}
}