namespace = solarstorm_fleet_event

# Gatekeeper - Ship Events
ship_event = {
	id = solarstorm_fleet_event.1
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_ship_flag = ship_hazard_event }
		OR = {
			is_ship_class = shipclass_science_ship
			is_ship_class = shipclass_constructor
			is_ship_class = shipclass_colonizer
		}
	}
	
	immediate = {
		# Stellar Millstones
		if = {
			limit = {
				FROM = {
					OR = {
						is_star_class = sc_tt_red
						is_star_class = sc_tt_orange
						is_star_class = sc_tt_white
						is_star_class = sc_ae
						is_star_class = sc_protostar
						is_star_class = sc_fu
					}
				}
			}
			random_list = {
				#Accident has occurred
				1 = {
					modifier = {
						factor = 2
						from = { is_star_class = sc_protostar }
					}
					modifier = {
						factor = 0.2
						from = { 
							exists = space_owner
							space_owner = { is_same_value = prev.owner }
							exists = starbase
							starbase = { has_starbase_building = beacon_service_station }
						}
					}
					set_ship_flag = ship_hazard_event
					save_event_target_as = ship_threatened
					from = { save_event_target_as = dangerous_system }
					#Science ship
					if = {
						limit = { is_ship_class = shipclass_science_ship }
						random_list = {
							50 = {
							#Ship survived
								modifier = {
									factor = 1.5
									AND = {
										exists = leader
										leader = {
											leader_class = scientist
											has_trait = leader_trait_roamer
										}
									}
								}
								owner = { country_event = { id = solarstorm_fleet_event.10 days = 5 random = 10 } }
							}
							#Ship destroyed
							50 = {
								if = {
									limit = { exists = leader }
									random_list = {
										20 = {
											#Scientist survived
											set_ship_flag = scientist_survived
										}
										80 = {
											#Scientist died
										}
									}
								}
								owner = { country_event = { id = solarstorm_fleet_event.11 days = 5 random = 10 } }
							}
						}
					}
					#Сonstructor ship
					else_if = {
						limit = { is_ship_class = shipclass_constructor }
						random_list = {
							#Ship survived
							30 = {
								owner = { country_event = { id = solarstorm_fleet_event.12 days = 5 random = 10 } }
							}
							#Ship destroyed
							70 = {
								owner = { country_event = { id = solarstorm_fleet_event.13 days = 5 random = 10 } }
							}
						}
					}
					#Colonizer ship
					else = {
						limit = { is_ship_class = shipclass_colonizer }
						random_list = {
							#Ship survived
							15 = {
								owner = { country_event = { id = solarstorm_fleet_event.14 days = 5 random = 10 } }
							}
							#Ship destroyed
							85 = {
								owner = { country_event = { id = solarstorm_fleet_event.15 days = 5 random = 10 } }
							}
						}
					}
				}
				85 = {
					#Null
				}
			}
		}
		
		# Solar Storm and Gamma Splash
		if = {
			limit = {
				FROM = {
					OR = {
						is_star_class = sc_w_azure
						is_star_class = sc_w_red
						is_star_class = sc_w_green
						is_star_class = sc_w_purple
						is_star_class = sc_nova_1
						is_star_class = sc_nova_2
						is_star_class = sc_collapsar
						is_star_class = sc_lbv_blue
						is_star_class = sc_lbv_green
						is_star_class = sc_lbv_red
						is_star_class = sc_microquasar_1
						is_star_class = sc_microquasar_2
					}
				}
			}
			random_list = {
				# Solar Storm
				15 = {
					modifier = {
						factor = 2
						from = { is_star_class = sc_collapsar }
					}
					modifier = {
						factor = 0.2
						from = { 
							exists = space_owner
							space_owner = { is_same_value = prev.owner }
							exists = starbase
							starbase = { has_starbase_building = solar_disturbance_recorder }
						}
					}
					set_ship_flag = ship_hazard_event
					save_event_target_as = ship_threatened
					from = { save_event_target_as = dangerous_system }
					#Science ship
					if = {
						limit = { is_ship_class = shipclass_science_ship }
						random_list = {
							30 = {
								#Ship survived
								modifier = {
									factor = 1.5
									AND = {
										exists = leader
										leader = {
											leader_class = scientist
											has_trait = leader_trait_roamer
										}
									}
								}
								owner = { country_event = { id = solarstorm_fleet_event.30 days = 5 random = 10 } }
							}
							#Ship destroyed
							70 = {
								if = {
									limit = { exists = leader }
									random_list = {
										20 = {
											#Scientist survived
											set_ship_flag = scientist_survived
										}
										80 = {
											#Scientist died
										}
									}
								}
								owner = { country_event = { id = solarstorm_fleet_event.31 days = 5 random = 10 } }
							}
						}
					}
					#Сonstructor ship
					else_if = {
						limit = { is_ship_class = shipclass_constructor }
						random_list = {
							#Ship survived
							30 = {
								owner = { country_event = { id = solarstorm_fleet_event.32 days = 5 random = 10 } }
							}
							#Ship destroyed
							70 = {
								owner = { country_event = { id = solarstorm_fleet_event.33 days = 5 random = 10 } }
							}
						}
					}
					#Colonizer ship
					else = {
						limit = { is_ship_class = shipclass_colonizer }
						random_list = {
							#Ship survived
							50 = {
								owner = { country_event = { id = solarstorm_fleet_event.34 days = 5 random = 10 } }
							}
							#Ship destroyed
							50 = {
								owner = { country_event = { id = solarstorm_fleet_event.35 days = 5 random = 10 } }
							}
						}
					}
				}
				85 = {
					#Null
				}
			}
		}
	}
}

# Gatekeeper - Fleet Events
fleet_event = {
	id = solarstorm_fleet_event.2
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_fleet_flag = fleet_hazard_event }
		any_owned_ship = { 
			NOR = {
				is_ship_class = shipclass_science_ship
				is_ship_class = shipclass_constructor
				is_ship_class = shipclass_colonizer
			}
		}
	}
	
	immediate = {
		# Stellar Millstones
		if = {
			limit = {
				FROM = {
					OR = {
						is_star_class = sc_tt_red
						is_star_class = sc_tt_orange
						is_star_class = sc_tt_white
						is_star_class = sc_ae
						is_star_class = sc_protostar
						is_star_class = sc_fu
					}
				}
			}
			random_list = {
				#Accident has occurred
				1 = {
					modifier = {
						factor = 2
						from = { is_star_class = sc_protostar }
					}
					modifier = {
						factor = 0.5
						AND = {
							exists = leader
							leader = {
								leader_class = admiral
								has_trait = leader_trait_scout
							}
						}
					}
					modifier = {
						factor = 0.2
						from = { 
							exists = space_owner
							space_owner = { is_same_value = prev.owner }
							exists = starbase
							starbase = { has_starbase_building = beacon_service_station }
						}
					}
					set_fleet_flag = fleet_hazard_event
					save_event_target_as = fleet_threatened
					from = { save_event_target_as = dangerous_system }
					if = {
						limit = { NOT = { any_owned_ship = { has_large_ship = yes } } }
						random_list = {
							#All ships survived
							30 = {
								owner = { country_event = { id = solarstorm_fleet_event.20 days = 5 random = 10 } }
							}
							#Several ships destroyed
							70 = {
								modifier = {
									factor = 0
									num_ships <= 2
								}
								if = {
									limit = { 
										exists = leader
										leader = { leader_class = admiral }
									}
									random_list = {
										20 = {
											#Admiral survived
										}
										80 = {
											set_fleet_flag = admiral_died
										}
									}
								}
								owner = { country_event = { id = solarstorm_fleet_event.21 days = 5 random = 10 } }
							}
						}
					}
					#All ships destroyed
					else_if = {
						limit = {
							NOT = { any_owned_ship = { has_small_ship = yes } }
						}
						if = {
							limit = { 
								exists = leader
								leader = { leader_class = admiral }
							}
							random_list = {
								20 = {
									#Admiral survived
								}
								80 = {
									set_fleet_flag = admiral_died
								}
							}
						}
						owner = { country_event = { id = solarstorm_fleet_event.23 days = 5 random = 10 } }
					}
					#Many ships destroyed
					else = {
						limit = { any_owned_ship = { has_large_ship = yes } }
						if = {
							limit = { any_owned_ship = { has_small_ship = yes } }
							if = {
								limit = { 
									exists = leader
									leader = { leader_class = admiral }
								}
								random_list = {
									50 = {
										#Admiral survived
									}
									50 = {
										set_fleet_flag = admiral_died
									}
								}
								owner = { country_event = { id = solarstorm_fleet_event.22 days = 5 random = 10 } }
							}
						}
					}
				}
				85 = {
					#Null
				}
			}
		}
		
		# Solar Storm
		if = {
			limit = {
				FROM = {
					OR = {
						is_star_class = sc_w_azure
						is_star_class = sc_w_red
						is_star_class = sc_w_green
						is_star_class = sc_w_purple
						is_star_class = sc_nova_1
						is_star_class = sc_nova_2
						is_star_class = sc_collapsar
						is_star_class = sc_lbv_blue
						is_star_class = sc_lbv_green
						is_star_class = sc_lbv_red
						is_star_class = sc_microquasar_1
						is_star_class = sc_microquasar_2
					}
				}
			}
			random_list = {
				#Accident has occurred
				1 = {
					modifier = {
						factor = 2
						from = { is_star_class = sc_collapsar }
					}
					modifier = {
						factor = 0.5
						AND = {
							exists = leader
							leader = {
								leader_class = admiral
								has_trait = leader_trait_scout
							}
						}
					}
					modifier = {
						factor = 0.2
						from = { 
							exists = space_owner
							space_owner = { is_same_value = prev.owner }
							exists = starbase
							starbase = { has_starbase_building = solar_disturbance_recorder }
						}
					}
					set_fleet_flag = fleet_hazard_event
					save_event_target_as = fleet_threatened
					from = { save_event_target_as = dangerous_system }
					if = {
						limit = { NOT = { any_owned_ship = { has_small_ship = yes } } }
						random_list = {
							#All ships survived
							30 = {
								owner = { country_event = { id = solarstorm_fleet_event.40 days = 5 random = 10 } }
							}
							#Several ships destroyed
							70 = {
								modifier = {
									factor = 0
									num_ships <= 2
								}
								if = {
									limit = { 
										exists = leader
										leader = { leader_class = admiral }
									}
									random_list = {
										20 = {
											#Admiral survived
										}
										80 = {
											set_fleet_flag = admiral_died
										}
									}
								}
								owner = { country_event = { id = solarstorm_fleet_event.41 days = 5 random = 10 } }
							}
						}
					}
					#All ships destroyed
					else_if = {
						limit = {
							NOT = { any_owned_ship = { has_large_ship = yes } }
						}
						if = {
							limit = { exists = leader }
							random_list = {
								20 = {
									#Admiral survived
								}
								80 = {
									set_fleet_flag = admiral_died
								}
							}
						}
						owner = { country_event = { id = solarstorm_fleet_event.43 days = 5 random = 10 } }
					}
					#Many ships destroyed
					else = {
						limit = { any_owned_ship = { has_large_ship = yes } }
						if = {
							limit = { any_owned_ship = { has_small_ship = yes } }
							if = {
								limit = { 
									exists = leader
									leader = { leader_class = admiral }
								}
								random_list = {
									50 = {
										#Admiral survived
									}
									50 = {
										set_fleet_flag = admiral_died
									}
								}
								owner = { country_event = { id = solarstorm_fleet_event.42 days = 5 random = 10 } }
							}
						}
					}
				}
				85 = {
					#Null
				}
			}
		}
	}
}

# Gatekeeper - Gamma-ray Burst
event = {
	id = solarstorm_fleet_event.3
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
	}
	
	immediate = {
		
		random_planet = {
			limit = {
				OR = {
					is_planet_class = pc_collapsar
					is_planet_class = pc_nova_1
					is_planet_class = pc_nova_2
					is_planet_class = pc_magnetar
				}
			}
			random_list = {
				15 = {
					modifier = {
						factor = 2
						is_planet_class = pc_magnetar
					}
					modifier = {
						factor = 1.5
						is_planet_class = pc_collapsar
					}
					modifier = {
						factor = 0.2
						solar_system = { 
							exists = starbase
							starbase = { has_starbase_building = gamma_stabilizer }
						}
					}
					solar_system = { save_event_target_as = gamma_burst_system }
					planet_event = { id = solarstorm_fleet_event.50 days = 30 random = 90 }
				}
				85 = {
					#Not effect
				}
			}
		}
	}
}


# Stellar Millstones: Science ship survived
country_event = {
	id = solarstorm_fleet_event.10
	title = "solarstorm_fleet_event.10.name"
	desc = "solarstorm_fleet_event.10.desc"
	picture = GFX_evt_stellar_millstones
	show_sound = event_sensor_ping
	location = event_target:ship_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ship_threatened
		event_target:ship_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:ship_threatened = {
			if = {
				limit = { exists = leader }
				locked_random_list = {
					30 = {
						modifier = {
							factor = 0
							leader = { has_trait = leader_trait_roamer }
						}
						leader = { add_trait = leader_trait_roamer }
					}
					70 = {
						#Null
					}
				}
				leader = { add_experience = 200 }
			}
			remove_ship_flag = ship_hazard_event
		}
	}
}

# Stellar Millstones: Science ship destroyed
country_event = {
	id = solarstorm_fleet_event.11
	title = "solarstorm_fleet_event.11.name"
	desc = {
		trigger = { event_target:ship_threatened = { has_ship_flag = scientist_survived } }
		text = "solarstorm_fleet_event.11.desc.scientist_survived"
	}
	desc = {
		trigger = { event_target:ship_threatened = { NOT = { has_ship_flag = scientist_survived } } }
		text = "solarstorm_fleet_event.11.desc"
	}
	picture = GFX_evt_stellar_millstones
	show_sound = event_air_raid_siren
	location = event_target:ship_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ship_threatened
		event_target:ship_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
		event_target:ship_threatened = {
			if = {
				limit = { has_ship_flag = scientist_survived }
				leader = { unassign_leader = this }
			}
		}
		
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:ship_threatened = { 
			destroy_ship = this
			if = {
				limit = { has_ship_flag = scientist_survived }
				if = {
					limit = { exists = leader }
					locked_random_list = {
						30 = {
							modifier = {
								factor = 0
								leader = { has_trait = leader_trait_roamer }
							}
							leader = { add_trait = leader_trait_roamer }
						}
						70 = {
							#Null
						}
					}
					leader = { add_experience = 200 }
				}
				remove_ship_flag = scientist_survived
			}
			remove_ship_flag = ship_hazard_event
		}
	}
}

# Stellar Millstones: Сonstructor ship survived
country_event = {
	id = solarstorm_fleet_event.12
	title = "solarstorm_fleet_event.12.name"
	desc = "solarstorm_fleet_event.12.desc"
	picture = GFX_evt_stellar_millstones
	show_sound = event_sensor_ping
	location = event_target:ship_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ship_threatened
		event_target:ship_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:ship_threatened = {
			remove_ship_flag = ship_hazard_event
		}
	}
}

# Stellar Millstones: Сonstructor ship destroyed
country_event = {
	id = solarstorm_fleet_event.13
	title = "solarstorm_fleet_event.13.name"
	desc = "solarstorm_fleet_event.13.desc"
	picture = GFX_evt_stellar_millstones
	show_sound = event_air_raid_siren
	location = event_target:ship_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ship_threatened
		event_target:ship_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:ship_threatened = { 
			destroy_ship = this
			remove_ship_flag = ship_hazard_event
		}
	}
}

# Stellar Millstones: Colonizer ship survived
country_event = {
	id = solarstorm_fleet_event.14
	title = "solarstorm_fleet_event.14.name"
	desc = "solarstorm_fleet_event.14.desc"
	picture = GFX_evt_stellar_millstones
	show_sound = event_sensor_ping
	location = event_target:ship_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ship_threatened
		event_target:ship_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:ship_threatened = {
			remove_ship_flag = ship_hazard_event
		}
	}
}

# Stellar Millstones: Colonizer ship destroyed
country_event = {
	id = solarstorm_fleet_event.15
	title = "solarstorm_fleet_event.15.name"
	desc = "solarstorm_fleet_event.15.desc"
	picture = GFX_evt_stellar_millstones
	show_sound = event_air_raid_siren
	location = event_target:ship_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ship_threatened
		event_target:ship_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:ship_threatened = { 
			destroy_ship = this
			remove_ship_flag = ship_hazard_event
		}
	}
}



# Stellar Millstones: All ships survived
country_event = {
	id = solarstorm_fleet_event.20
	title = "solarstorm_fleet_event.20.name"
	desc = "solarstorm_fleet_event.20.desc"
	picture = GFX_evt_stellar_millstones
	show_sound = event_sensor_ping
	location = event_target:fleet_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:fleet_threatened
		event_target:fleet_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
		event_target:fleet_threatened = {
			remove_fleet_flag = fleet_hazard_event
		}
	}

	option = {
		name = GOOD
		
		event_target:fleet_threatened = {
			if = {
				limit = { exists = leader }
				locked_random_list = {
					30 = {
						modifier = {
							factor = 0
							leader = { has_trait = leader_trait_scout }
						}
						leader = { add_trait = leader_trait_scout }
					}
					70 = {
						#Null
					}
				}
				leader = { add_experience = 200 }
			}
		}
	}
}

# Stellar Millstones: Several ships destroyed
country_event = {
	id = solarstorm_fleet_event.21
	title = "solarstorm_fleet_event.21.name"
	desc = {
		trigger = { event_target:fleet_threatened = { has_fleet_flag = admiral_died } }
		text = "solarstorm_fleet_event.21.desc.admiral_died"
	}
	desc = {
		trigger = { 
			event_target:fleet_threatened = {
				exists = leader
				leader = { leader_class = admiral }
				NOT = { has_fleet_flag = admiral_died }	
			}
		}
		text = "solarstorm_fleet_event.21.desc.admiral_survived"
	}
	desc = {
		trigger = { 
			event_target:fleet_threatened = {
				NOR = {
					exists = leader
					leader = { leader_class = admiral }
				}
			}
		}
		text = "solarstorm_fleet_event.21.desc"
	}
	picture = GFX_evt_stellar_millstones
	show_sound = event_air_raid_siren
	location = event_target:fleet_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:fleet_threatened
		event_target:fleet_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
		event_target:fleet_threatened = {
			if = {
				limit = { has_fleet_flag = admiral_died }
				leader = { 
					save_event_target_as = fleet_threatened_admiral
					kill_leader = { type = admiral show_notification = no }
				}
				remove_fleet_flag = admiral_died
			}
		}
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:fleet_threatened = {
			locked_random_list = {
				15 = {
					modifier = {
						factor = 0
						num_ships <= 10
					}
					while = {
						count = 10
						random_owned_ship = {
							destroy_ship = this
						}
					}
					custom_tooltip = ten_small_ships_are_lost
				}
				35 = {
					modifier = {
						factor = 0
						num_ships <= 5
					}
					while = {
						count = 5
						random_owned_ship = {
							destroy_ship = this
						}
					}
					custom_tooltip = five_small_ships_are_lost
				}
				50 = {
					while = {
						count = 2
						random_owned_ship = {
							destroy_ship = this
						}
					}
					custom_tooltip = two_small_ships_are_lost
				}
			}
			
			if = {
				limit = { has_fleet_flag = admiral_died }
				remove_fleet_flag = admiral_died
			}
			else = {
				limit = { exists = leader }
				locked_random_list = {
					30 = {
						modifier = {
							factor = 0
							leader = { has_trait = leader_trait_scout }
						}
						leader = { add_trait = leader_trait_scout }
					}
					70 = {
						#Null
					}
				}
				leader = { add_experience = 200 }
			}
			remove_fleet_flag = fleet_hazard_event
		}
	}
}

# Stellar Millstones: Many ships destroyed
country_event = {
	id = solarstorm_fleet_event.22
	title = "solarstorm_fleet_event.22.name"
	desc = {
		trigger = { event_target:fleet_threatened = { has_fleet_flag = admiral_died } }
		text = "solarstorm_fleet_event.22.desc.admiral_died"
	}
	desc = {
		trigger = { 
			event_target:fleet_threatened = {
				exists = leader
				leader = { leader_class = admiral }
				NOT = { has_fleet_flag = admiral_died }	
			}
		}
		text = "solarstorm_fleet_event.22.desc.admiral_survived"
	}
	desc = {
		trigger = { 
			event_target:fleet_threatened = {
				NOR = {
					exists = leader
					leader = { leader_class = admiral }
				}
			}
		}
		text = "solarstorm_fleet_event.22.desc"
	}
	picture = GFX_evt_stellar_millstones
	show_sound = event_air_raid_siren
	location = event_target:fleet_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:fleet_threatened
		event_target:fleet_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
		event_target:dangerous_system = {
			if = {
				limit = {
					AND = {
						exists = space_owner
						NOT = { space_owner = {	is_same_value = prev } }
					}
				}
				space_owner = {
					if = {
						limit = {
							AND = {
								is_country_type = default
								is_homicidal = no
								has_communications = prevprev
							}
						}
						country_event = { id = solarstorm_fleet_event.24 days = 1 }
					}
					if = {
						limit = {
							AND = {
								is_country_type = default
								is_homicidal = no
								NOT = { has_communications = prevprev }
							}
						}
						country_event = { id = solarstorm_fleet_event.25 days = 1 }
						
						create_ambient_object = {
							type = "small_debris_object"
							location = event_target:fleet_threatened
						}
						last_created_ambient_object = {
							save_global_event_target_as = fleet_wreckage
						}
					}
					
					prevprev = { save_global_event_target_as = wreckage_country }
				}
			}
		}
		
		every_owned_ship = {
			limit = {
				fleet = { is_same_value = event_target:fleet_threatened }
				has_large_ship = yes
			}
			destroy_ship = this
		}
		
		event_target:fleet_threatened = {
			if = {
				limit = { has_fleet_flag = admiral_died }
				leader = { 
					save_event_target_as = fleet_threatened_admiral
					kill_leader = { type = admiral show_notification = no }
				}
				remove_fleet_flag = admiral_died
			}
		}
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		custom_tooltip = all_large_ships_are_lost
		
		event_target:fleet_threatened = {
			locked_random_list = {
				15 = {
					modifier = {
						factor = 0
						num_ships <= 10
					}
					while = {
						count = 10
						random_owned_ship = {
							destroy_ship = this
						}
					}
					custom_tooltip = ten_small_ships_are_lost
				}
				35 = {
					modifier = {
						factor = 0
						num_ships <= 5
					}
					while = {
						count = 5
						random_owned_ship = {
							destroy_ship = this
						}
					}
					custom_tooltip = five_small_ships_are_lost
				}
				50 = {
					while = {
						count = 2
						random_owned_ship = {
							destroy_ship = this
						}
					}
					custom_tooltip = two_small_ships_are_lost
				}
			}
			remove_fleet_flag = fleet_hazard_event
		}
	}
}

# Stellar Millstones: All ships destroyed
country_event = {
	id = solarstorm_fleet_event.23
	title = "solarstorm_fleet_event.23.name"
	desc = {
		trigger = { event_target:fleet_threatened = { has_fleet_flag = admiral_died } }
		text = "solarstorm_fleet_event.23.desc.admiral_died"
	}
	desc = {
		trigger = { 
			event_target:fleet_threatened = {
				exists = leader
				leader = { leader_class = admiral }
				NOT = { has_fleet_flag = admiral_died }	
			}
		}
		text = "solarstorm_fleet_event.23.desc.admiral_survived"
	}
	desc = {
		trigger = { 
			event_target:fleet_threatened = {
				NOR = {
					exists = leader
					leader = { leader_class = admiral }
				}
			}
		}
		text = "solarstorm_fleet_event.23.desc"
	}
	picture = GFX_evt_stellar_millstones
	show_sound = event_air_raid_siren
	location = event_target:fleet_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:fleet_threatened
		event_target:fleet_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
		event_target:dangerous_system = {
			if = {
				limit = {
					AND = {
						exists = space_owner
						NOT = { space_owner = {	is_same_value = prev } }
					}
				}
				space_owner = {
					if = {
						limit = {
							AND = {
								is_country_type = default
								is_homicidal = no
								has_communications = prevprev
							}
						}
						country_event = { id = solarstorm_fleet_event.25 days = 1 }
						
						create_ambient_object = {
							type = "small_debris_object"
							location = event_target:fleet_threatened
						}
						last_created_ambient_object = {
							save_global_event_target_as = fleet_wreckage
						}
					}
					if = {
						limit = {
							AND = {
								is_country_type = default
								is_homicidal = no
								NOT = { has_communications = prevprev }
							}
						}
						country_event = { id = solarstorm_fleet_event.26 days = 1 }
						
						create_ambient_object = {
							type = "small_debris_object"
							location = event_target:fleet_threatened
						}
						last_created_ambient_object = {
							save_global_event_target_as = fleet_wreckage
						}
					}
					
					prevprev = { save_global_event_target_as = wreckage_country }
				}
			}
		}
		
		event_target:fleet_threatened = {
			leader = { save_event_target_as = fleet_threatened_admiral }
			if = {
				limit = { has_fleet_flag = admiral_died }
				destroy_fleet = {
					target = this
					kill_leader = yes
				}
			}
			else = {
				destroy_fleet = {
					target = this
					kill_leader = no
				}
			}
		}
	}

	option = {
		name = TERRIBLE
		
		custom_tooltip = fleet_lost
	}
}

# Stellar Millstones: Owner Space Message ( No wreckage )
country_event = {
	id = solarstorm_fleet_event.24
	title = "solarstorm_fleet_event.24.name"
	desc = "solarstorm_fleet_event.24.desc"
	picture = GFX_evt_stellar_millstones
	show_sound = event_sensor_ping
	location = from
	
	is_triggered_only = yes

	trigger = {
	}
	
	immediate = {
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		trigger = {
			OR = {
				NOT = { is_at_war_with = event_target:wreckage_country }
				event_target:wreckage_country = { is_homicidal = no }
			}
		}
		clear_global_event_target = wreckage_country
	}
	
	option = {
		name = EXCELLENT
		trigger = {
			OR = {
				is_at_war_with = event_target:wreckage_country
				event_target:wreckage_country = { is_homicidal = yes }
			}
		}
		clear_global_event_target = wreckage_country
	}
}

# Stellar Millstones: Owner Space Message ( Wreckage exists )
country_event = {
	id = solarstorm_fleet_event.25
	title = "solarstorm_fleet_event.25.name"
	desc = "solarstorm_fleet_event.25.desc"
	picture = GFX_evt_wreckage
	show_sound = event_sensor_ping
	location = event_target:fleet_wreckage
	
	is_triggered_only = yes

	trigger = {
	}
	
	immediate = {
	}

	option = {
		name = "help_wreckage_country"
		trigger = {
			OR = {
				NOT = { is_at_war_with = event_target:wreckage_country }
				event_target:wreckage_country = { is_homicidal = no }
			}
		}
		event_target:fleet_wreckage = {
			enable_special_project = {
				name = "RESCUE_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
	
	option = {
		name = "explore_fleet_wreckage"
		event_target:fleet_wreckage = {
			enable_special_project = {
				name = "EXPLORE_WRECKAGE_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
	
	option = {
		name = IS_A_DANGEROUS_PLACE
		trigger = {
			OR = {
				NOT = { is_at_war_with = event_target:wreckage_country }
				event_target:wreckage_country = { is_homicidal = no }
			}
		}
		hidden_effect = { 
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			}
			clear_global_event_target = fleet_wreckage
		}
	}
	
	option = {
		name = EXCELLENT
		trigger = {
			OR = {
				is_at_war_with = event_target:wreckage_country
				event_target:wreckage_country = { is_homicidal = yes }
			}
		}
		hidden_effect = { 
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			}
			clear_global_event_target = fleet_wreckage
		}
	}
}

# Stellar Millstones: Owner Space Message ( Unknown wreckage )
country_event = {
	id = solarstorm_fleet_event.26
	title = "solarstorm_fleet_event.26.name"
	desc = "solarstorm_fleet_event.26.desc"
	picture = GFX_evt_wreckage
	show_sound = event_sensor_ping
	location = event_target:fleet_wreckage
	
	is_triggered_only = yes

	trigger = {
	}
	
	immediate = {
	}
	
	option = {
		name = "explore_fleet_wreckage"
		event_target:fleet_wreckage = {
			enable_special_project = {
				name = "EXPLORE_WRECKAGE_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
	
	option = {
		name = IS_A_DANGEROUS_PLACE
		trigger = {
			OR = {
				NOT = { is_at_war_with = event_target:wreckage_country }
				event_target:wreckage_country = { is_homicidal = no }
			}
		}
		hidden_effect = { 
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			} 
			clear_global_event_target = fleet_wreckage
		}
	}
	
	option = {
		name = EXCELLENT
		trigger = {
			OR = {
				is_at_war_with = event_target:wreckage_country
				event_target:wreckage_country = { is_homicidal = yes }
			}
		}
		hidden_effect = { 
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			}
			clear_global_event_target = fleet_wreckage
		}
	}
}



# Solar Storm: Science ship survived
country_event = {
	id = solarstorm_fleet_event.30
	title = "solarstorm_fleet_event.30.name"
	desc = "solarstorm_fleet_event.30.desc"
	picture = GFX_evt_solar_storm
	show_sound = event_sensor_ping
	location = event_target:ship_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ship_threatened
		event_target:ship_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:ship_threatened = {
			if = {
				limit = { exists = leader }
				locked_random_list = {
					30 = {
						modifier = {
							factor = 0
							leader = { has_trait = leader_trait_roamer }
						}
						leader = { add_trait = leader_trait_roamer }
					}
					70 = {
						#Null
					}
				}
				leader = { add_experience = 200 }
			}
			remove_ship_flag = ship_hazard_event
		}
	}
}

# Solar Storm: Science ship destroyed
country_event = {
	id = solarstorm_fleet_event.31
	title = "solarstorm_fleet_event.31.name"
	desc = {
		trigger = { event_target:ship_threatened = { has_ship_flag = scientist_survived } }
		text = "solarstorm_fleet_event.31.scientist_survived"
	}
	desc = {
		trigger = { event_target:ship_threatened = { NOT = { has_ship_flag = scientist_survived } } }
		text = "solarstorm_fleet_event.31.desc"
	}
	picture = GFX_evt_solar_storm
	show_sound = event_air_raid_siren
	location = event_target:ship_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ship_threatened
		event_target:ship_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
		event_target:ship_threatened = {
			if = {
				limit = { has_ship_flag = scientist_survived }
				leader = {unassign_leader = this}
			}
		}
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:ship_threatened = { 
			destroy_ship = this
			if = {
				limit = { has_ship_flag = scientist_survived }
				if = {
					limit = { exists = leader }
					locked_random_list = {
						30 = {
							modifier = {
								factor = 0
								leader = { has_trait = leader_trait_roamer }
							}
							leader = { add_trait = leader_trait_roamer }
						}
						70 = {
							#Null
						}
					}
					leader = { add_experience = 200 }
				}
				remove_ship_flag = scientist_survived
			}
			remove_ship_flag = ship_hazard_event
		}
	}
}

# Solar Storm: Сonstructor ship survived
country_event = {
	id = solarstorm_fleet_event.32
	title = "solarstorm_fleet_event.32.name"
	desc = "solarstorm_fleet_event.32.desc"
	picture = GFX_evt_solar_storm
	show_sound = event_sensor_ping
	location = event_target:ship_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ship_threatened
		event_target:ship_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:ship_threatened = {
			remove_ship_flag = ship_hazard_event
		}
	}
}

# Solar Storm: Сonstructor ship destroyed
country_event = {
	id = solarstorm_fleet_event.33
	title = "solarstorm_fleet_event.33.name"
	desc = "solarstorm_fleet_event.33.desc"
	picture = GFX_evt_solar_storm
	show_sound = event_air_raid_siren
	location = event_target:ship_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ship_threatened
		event_target:ship_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:ship_threatened = { 
			destroy_ship = this
			remove_ship_flag = ship_hazard_event
		}
	}
}

# Solar Storm: Colonizer ship survived
country_event = {
	id = solarstorm_fleet_event.34
	title = "solarstorm_fleet_event.34.name"
	desc = "solarstorm_fleet_event.34.desc"
	picture = GFX_evt_solar_storm
	show_sound = event_sensor_ping
	location = event_target:ship_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ship_threatened
		event_target:ship_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:ship_threatened = {
			remove_ship_flag = ship_hazard_event
		}
	}
}

# Solar Storm: Colonizer ship destroyed
country_event = {
	id = solarstorm_fleet_event.35
	title = "solarstorm_fleet_event.35.name"
	desc = "solarstorm_fleet_event.35.desc"
	picture = GFX_evt_solar_storm
	show_sound = event_air_raid_siren
	location = event_target:ship_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:ship_threatened
		event_target:ship_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:ship_threatened = { 
			destroy_ship = this
			remove_ship_flag = ship_hazard_event
		}
	}
}



# Solar Storm: All ships survived
country_event = {
	id = solarstorm_fleet_event.40
	title = "solarstorm_fleet_event.40.name"
	desc = "solarstorm_fleet_event.40.desc"
	picture = GFX_evt_solar_storm
	show_sound = event_sensor_ping
	location = event_target:fleet_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:fleet_threatened
		event_target:fleet_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
		event_target:fleet_threatened = {
			remove_fleet_flag = fleet_hazard_event
		}
	}

	option = {
		name = GOOD
		
		event_target:fleet_threatened = {
			if = {
				limit = { exists = leader }
				locked_random_list = {
					30 = {
						modifier = {
							factor = 0
							leader = { has_trait = leader_trait_scout }
						}
						leader = { add_trait = leader_trait_scout }
					}
					70 = {
						#Null
					}
				}
				leader = { add_experience = 200 }
			}
		}
	}
}

# Solar Storm: Several ships destroyed
country_event = {
	id = solarstorm_fleet_event.41
	title = "solarstorm_fleet_event.41.name"
	desc = {
		trigger = { event_target:fleet_threatened = { has_fleet_flag = admiral_died } }
		text = "solarstorm_fleet_event.41.desc.admiral_died"
	}
	desc = {
		trigger = { 
			event_target:fleet_threatened = {
				exists = leader
				leader = { leader_class = admiral }
				NOT = { has_fleet_flag = admiral_died }	
			}
		}
		text = "solarstorm_fleet_event.41.desc.admiral_survived"
	}
	desc = {
		trigger = { 
			event_target:fleet_threatened = {
				NOR = {
					exists = leader
					leader = { leader_class = admiral }
				}
			}
		}
		text = "solarstorm_fleet_event.41.desc"
	}
	picture = GFX_evt_solar_storm
	show_sound = event_air_raid_siren
	location = event_target:fleet_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:fleet_threatened
		event_target:fleet_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
		event_target:fleet_threatened = {
			if = {
				limit = { has_fleet_flag = admiral_died }
				leader = { 
					save_event_target_as = fleet_threatened_admiral
					kill_leader = { type = admiral show_notification = no }
				}
				remove_fleet_flag = admiral_died
			}
		}
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		
		event_target:fleet_threatened = {
			locked_random_list = {
				15 = {
					modifier = {
						factor = 0
						num_ships <= 10
					}
					while = {
						count = 10
						random_owned_ship = {
							destroy_ship = this
						}
					}
					custom_tooltip = ten_large_ships_are_lost
				}
				35 = {
					modifier = {
						factor = 0
						num_ships <= 5
					}
					while = {
						count = 5
						random_owned_ship = {
							destroy_ship = this
						}
					}
					custom_tooltip = five_large_ships_are_lost
				}
				50 = {
					while = {
						count = 2
						random_owned_ship = {
							destroy_ship = this
						}
					}
					custom_tooltip = two_large_ships_are_lost
				}
			}
			
			if = {
				limit = { has_fleet_flag = admiral_died }
				remove_fleet_flag = admiral_died
			}
			else = {
				limit = { exists = leader }
				locked_random_list = {
					30 = {
						modifier = {
							factor = 0
							leader = { has_trait = leader_trait_scout }
						}
						leader = { add_trait = leader_trait_scout }
					}
					70 = {
						#Null
					}
				}
				leader = { add_experience = 200 }
			}
			remove_fleet_flag = fleet_hazard_event
		}
	}
}

# Solar Storm: Many ships destroyed
country_event = {
	id = solarstorm_fleet_event.42
	title = "solarstorm_fleet_event.42.name"
	desc = {
		trigger = { event_target:fleet_threatened = { has_fleet_flag = admiral_died } }
		text = "solarstorm_fleet_event.42.desc.admiral_died"
	}
	desc = {
		trigger = { 
			event_target:fleet_threatened = {
				exists = leader
				leader = { leader_class = admiral }
				NOT = { has_fleet_flag = admiral_died }	
			}
		}
		text = "solarstorm_fleet_event.42.desc.admiral_survived"
	}
	desc = {
		trigger = { 
			event_target:fleet_threatened = {
				NOR = {
					exists = leader
					leader = { leader_class = admiral }
				}
			}
		}
		text = "solarstorm_fleet_event.42.desc"
	}
	picture = GFX_evt_solar_storm
	show_sound = event_air_raid_siren
	location = event_target:fleet_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:fleet_threatened
		event_target:fleet_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
		event_target:dangerous_system = {
			if = {
				limit = {
					AND = {
						exists = space_owner
						NOT = { space_owner = {	is_same_value = prev } }
					}
				}
				space_owner = {
					if = {
						limit = {
							AND = {
								is_country_type = default
								is_homicidal = no
								has_communications = prevprev
							}
						}
						country_event = { id = solarstorm_fleet_event.44 days = 1 }
					}
					if = {
						limit = {
							AND = {
								is_country_type = default
								is_homicidal = no
								NOT = { has_communications = prevprev }
							}
						}
						country_event = { id = solarstorm_fleet_event.45 days = 1 }
						
						create_ambient_object = {
							type = "small_debris_object"
							location = event_target:fleet_threatened
						}
						last_created_ambient_object = {
							save_global_event_target_as = fleet_wreckage
						}
					}
					
					prevprev = { save_global_event_target_as = wreckage_country }
				}
			}
		}
		
		event_target:fleet_threatened = {
			if = {
				limit = { has_fleet_flag = admiral_died }
				leader = { 
					save_event_target_as = fleet_threatened_admiral
					kill_leader = { type = admiral show_notification = no }
				}
				remove_fleet_flag = admiral_died
			}
		}
		
		every_owned_ship = {
			limit = {
				fleet = { is_same_value = event_target:fleet_threatened }
				has_small_ship = yes
			}
			destroy_ship = this
		}
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		custom_tooltip = all_small_ships_are_lost
		
		event_target:fleet_threatened = {
			locked_random_list = {
				15 = {
					modifier = {
						factor = 0
						num_ships <= 10
					}
					while = {
						count = 10
						random_owned_ship = {
							destroy_ship = this
						}
					}
					custom_tooltip = ten_large_ships_are_lost
				}
				35 = {
					modifier = {
						factor = 0
						num_ships <= 5
					}
					while = {
						count = 5
						random_owned_ship = {
							destroy_ship = this
						}
					}
					custom_tooltip = five_large_ships_are_lost
				}
				50 = {
					while = {
						count = 2
						random_owned_ship = {
							destroy_ship = this
						}
					}
					custom_tooltip = two_large_ships_are_lost
				}
			}
			remove_fleet_flag = fleet_hazard_event
		}
	}
}

# Solar Storm: All ships destroyed
country_event = {
	id = solarstorm_fleet_event.43
	title = "solarstorm_fleet_event.43.name"
	desc = {
		trigger = { event_target:fleet_threatened = { has_fleet_flag = admiral_died } }
		text = "solarstorm_fleet_event.43.desc.admiral_died"
	}
	desc = {
		trigger = { 
			event_target:fleet_threatened = {
				exists = leader
				leader = { leader_class = admiral }
				NOT = { has_fleet_flag = admiral_died }	
			}
		}
		text = "solarstorm_fleet_event.43.desc.admiral_survived"
	}
	desc = {
		trigger = { 
			event_target:fleet_threatened = {
				NOR = {
					exists = leader
					leader = { leader_class = admiral }
				}
			}
		}
		text = "solarstorm_fleet_event.43.desc"
	}
	picture = GFX_evt_solar_storm
	show_sound = event_air_raid_siren
	location = event_target:fleet_threatened
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:fleet_threatened
		event_target:fleet_threatened = {
			solar_system = {
				is_same_value = event_target:dangerous_system
			}
		}
	}
	
	immediate = {
		event_target:dangerous_system = {
			if = {
				limit = {
					AND = {
						exists = space_owner
						NOT = { space_owner = {	is_same_value = prev } }
					}
				}
				space_owner = {
					if = {
						limit = {
							AND = {
								is_country_type = default
								is_homicidal = no
								has_communications = prevprev
							}
						}
						country_event = { id = solarstorm_fleet_event.45 days = 1 }
						
						create_ambient_object = {
							type = "small_debris_object"
							location = event_target:fleet_threatened
						}
						last_created_ambient_object = {
							save_global_event_target_as = fleet_wreckage
						}
					}
					if = {
						limit = {
							AND = {
								is_country_type = default
								is_homicidal = no
								NOT = { has_communications = prevprev }
							}
						}
						country_event = { id = solarstorm_fleet_event.46 days = 1 }
						
						create_ambient_object = {
							type = "small_debris_object"
							location = event_target:fleet_threatened
						}
						last_created_ambient_object = {
							save_global_event_target_as = fleet_wreckage
						}
					}
					
					prevprev = { save_global_event_target_as = wreckage_country }
				}
			}
		}
		
		event_target:fleet_threatened = {
			leader = { save_event_target_as = fleet_threatened_admiral }
			if = {
				limit = { has_fleet_flag = admiral_died }
				destroy_fleet = {
					target = this
					kill_leader = yes
				}
			}
			else = {
				destroy_fleet = {
					target = this
					kill_leader = no
				}
			}}
	}

	option = {
		name = TERRIBLE	
		custom_tooltip = fleet_lost
	}
}

# Solar Storm: Owner Space Message ( No wreckage )
country_event = {
	id = solarstorm_fleet_event.44
	title = "solarstorm_fleet_event.44.name"
	desc = "solarstorm_fleet_event.44.desc"
	picture = GFX_evt_solar_storm
	show_sound = event_sensor_ping
	location = from
	
	is_triggered_only = yes

	trigger = {
	}
	
	immediate = {
	}

	option = {
		name = IS_A_DANGEROUS_PLACE
		trigger = {
			OR = {
				NOT = { is_at_war_with = event_target:wreckage_country }
				event_target:wreckage_country = { is_homicidal = no }
			}
		}
		clear_global_event_target = wreckage_country
	}
	
	option = {
		name = EXCELLENT
		trigger = {
			OR = {
				is_at_war_with = event_target:wreckage_country
				event_target:wreckage_country = { is_homicidal = yes }
			}
		}
		clear_global_event_target = wreckage_country
	}
}

# Solar Storm: Owner Space Message ( Wreckage exists )
country_event = {
	id = solarstorm_fleet_event.45
	title = "solarstorm_fleet_event.45.name"
	desc = "solarstorm_fleet_event.45.desc"
	picture = GFX_evt_wreckage
	show_sound = event_sensor_ping
	location = event_target:fleet_wreckage
	
	is_triggered_only = yes

	trigger = {
	}
	
	immediate = {
	}

	option = {
		name = "help_wreckage_country"
		trigger = {
			OR = {
				NOT = { is_at_war_with = event_target:wreckage_country }
				event_target:wreckage_country = { is_homicidal = no }
			}
		}
		event_target:fleet_wreckage = {
			enable_special_project = {
				name = "RESCUE_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
	
	option = {
		name = "explore_fleet_wreckage"
		event_target:fleet_wreckage = {
			enable_special_project = {
				name = "EXPLORE_WRECKAGE_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
	
	option = {
		name = IS_A_DANGEROUS_PLACE
		trigger = {
			OR = {
				NOT = { is_at_war_with = event_target:wreckage_country }
				event_target:wreckage_country = { is_homicidal = no }
			}
		}
		hidden_effect = { 
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			}
			clear_global_event_target = fleet_wreckage
		}
	}
	
	option = {
		name = EXCELLENT
		trigger = {
			OR = {
				is_at_war_with = event_target:wreckage_country
				event_target:wreckage_country = { is_homicidal = yes }
			}
		}
		hidden_effect = { 
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			}
			clear_global_event_target = fleet_wreckage
		}
	}
}

# Solar Storm: Owner Space Message ( Unknown wreckage )
country_event = {
	id = solarstorm_fleet_event.46
	title = "solarstorm_fleet_event.46.name"
	desc = "solarstorm_fleet_event.46.desc"
	picture = GFX_evt_wreckage
	show_sound = event_sensor_ping
	location = event_target:fleet_wreckage
	
	is_triggered_only = yes

	trigger = {
	}
	
	immediate = {
	}
	
	option = {
		name = "explore_fleet_wreckage"
		event_target:fleet_wreckage = {
			enable_special_project = {
				name = "EXPLORE_WRECKAGE_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
	
	option = {
		name = IS_A_DANGEROUS_PLACE
		trigger = {
			OR = {
				NOT = { is_at_war_with = event_target:wreckage_country }
				event_target:wreckage_country = { is_homicidal = no }
			}
		}
		hidden_effect = { 
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			}
			clear_global_event_target = fleet_wreckage
		}
	}
	
	option = {
		name = EXCELLENT
		trigger = {
			OR = {
				is_at_war_with = event_target:wreckage_country
				event_target:wreckage_country = { is_homicidal = yes }
			}
		}
		hidden_effect = { 
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			}
			clear_global_event_target = fleet_wreckage
		}
	}
}


# Gamma-ray Burst occurred
planet_event = {
	id = solarstorm_fleet_event.50
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
	}
	
	immediate = {
		solar_system = {
			every_fleet_in_system = { 
				limit = { NOT = { is_ship_class = shipclass_military_station } }
				save_event_target_as = destroyed_fleet
				owner = { country_event = { id = solarstorm_fleet_event.51 days = 1 } }
			}
		}
	}
}

# Gamma-ray Burst: All ships destroyed
country_event = {
	id = solarstorm_fleet_event.51
	title = "solarstorm_fleet_event.51.name"
	desc = "solarstorm_fleet_event.51.desc"
	picture = GFX_evt_gamma_burst
	show_sound = event_air_raid_siren
	location = event_target:destroyed_fleet
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:destroyed_fleet
		event_target:destroyed_fleet = {
			solar_system = {
				is_same_value = event_target:gamma_burst_system
			}
		}
	}
	
	immediate = {
		event_target:gamma_burst_system = {
			if = {
				limit = {
					AND = {
						exists = space_owner
						NOT = { space_owner = {	is_same_value = prev } }
					}
				}
				space_owner = {
					if = {
						limit = {
							AND = {
								is_country_type = default
								is_homicidal = no
								has_communications = prevprev
							}
						}
						country_event = { id = solarstorm_fleet_event.52 days = 1 }
						
						create_ambient_object = {
							type = "small_debris_object"
							location = event_target:destroyed_fleet
						}
						last_created_ambient_object = {
							save_event_target_as = fleet_wreckage
						}
					}
					if = {
						limit = {
							AND = {
								is_country_type = default
								is_homicidal = no
								NOT = { has_communications = prevprev }
							}
						}
						country_event = { id = solarstorm_fleet_event.53 days = 1 }
								
						create_ambient_object = {
							type = "small_debris_object"
							location = event_target:destroyed_fleet
						}
						last_created_ambient_object = {
							save_event_target_as = fleet_wreckage
						}
					}
							
					prevprev = { save_event_target_as = wreckage_country }
				}
			}
		}
	}

	option = {
		name = TERRIBLE
		event_target:destroyed_fleet = { destroy_fleet = this }
	}
}


# Gamma-ray Burst: Owner Space Message ( Wreckage exists )
country_event = {
	id = solarstorm_fleet_event.52
	title = "solarstorm_fleet_event.52.name"
	desc = "solarstorm_fleet_event.52.desc"
	picture = GFX_evt_wreckage
	show_sound = event_sensor_ping
	location = event_target:fleet_wreckage
	
	is_triggered_only = yes

	trigger = {
	}
	
	immediate = {
	}
	
	option = {
		name = "explore_fleet_wreckage"
		event_target:fleet_wreckage = {
			enable_special_project = {
				name = "EXPLORE_WRECKAGE_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
	
	option = {
		name = IS_A_DANGEROUS_PLACE
		trigger = {
			OR = {
				NOT = { is_at_war_with = event_target:wreckage_country }
				event_target:wreckage_country = { is_homicidal = no }
			}
		}
		hidden_effect = { 
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			}
			clear_global_event_target = fleet_wreckage
		}
	}
	
	option = {
		name = EXCELLENT
		trigger = {
			OR = {
				is_at_war_with = event_target:wreckage_country
				event_target:wreckage_country = { is_homicidal = yes }
			}
		}
		hidden_effect = { 
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			}
			clear_global_event_target = fleet_wreckage
		}
	}
}

# Gamma-ray Burst: Owner Space Message ( Unknown wreckage )
country_event = {
	id = solarstorm_fleet_event.53
	title = "solarstorm_fleet_event.53.name"
	desc = "solarstorm_fleet_event.53.desc"
	picture = GFX_evt_wreckage
	show_sound = event_sensor_ping
	location = event_target:fleet_wreckage
	
	is_triggered_only = yes

	trigger = {
	}
	
	immediate = {
	}
	
	option = {
		name = "solarstorm_fleet_event.53.explore"
		event_target:fleet_wreckage = {
			enable_special_project = {
				name = "EXPLORE_WRECKAGE_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
	
	option = {
		name = IS_A_DANGEROUS_PLACE
		trigger = {
			OR = {
				NOT = { is_at_war_with = event_target:wreckage_country }
				event_target:wreckage_country = { is_homicidal = no }
			}
		}
		hidden_effect = { 
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			}
			clear_global_event_target = fleet_wreckage
		}
	}
	
	option = {
		name = EXCELLENT
		trigger = {
			OR = {
				is_at_war_with = event_target:wreckage_country
				event_target:wreckage_country = { is_homicidal = yes }
			}
		}
		hidden_effect = { 
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			}
			clear_global_event_target = fleet_wreckage
		}
	}
}


# Joint rescue operation
country_event = {
	id = solarstorm_fleet_event.100
	title = "solarstorm_fleet_event.100.name"
	desc = "solarstorm_fleet_event.100.desc"
	location = event_target:wreckage_country

	diplomatic = yes
	
	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:wreckage_country
		planet_background = event_target:wreckage_country
		graphical_culture = event_target:wreckage_country
		city_level = event_target:wreckage_country
		room = event_target:wreckage_country.ruler
	}

	option = {
		name = "solarstorm_fleet_event.100.a"
		add_resource = { influence = 150 }
		event_target:wreckage_country = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_rescue_operation
			}
		}
		hidden_effect = {
			event_target:fleet_wreckage = {
				destroy_ambient_object = this
			}
			clear_global_event_target = fleet_wreckage
			clear_global_event_target = wreckage_country
		}
	}
}

# Exploring known wreckage
country_event = {
	id = solarstorm_fleet_event.101
	title = "solarstorm_fleet_event.101.name"
	desc = "solarstorm_fleet_event.101.desc"
	picture = GFX_evt_wreckage
	show_sound = event_sensor_ping
	location = event_target:fleet_wreckage
	
	is_triggered_only = yes

	trigger = {
	}
	
	immediate = {
		event_target:fleet_wreckage = {
			destroy_ambient_object = this
		}
		clear_global_event_target = fleet_wreckage
		clear_global_event_target = wreckage_country
	}
	
	option = {
		name = SPLENDID
		locked_random_list = {
			10 = {
				add_random_research_option = {
					add_progress = 0.99
					area = engineering
					tier = 2
					ignore_prereqs = no
					fail_effects = {
						add_monthly_resource_mult = {
							resource = engineering_research
							value = @tier5researchreward
							min = @tier5researchmin
							max = @tier5researchmax
						}
					}
				}
			}
			10 = {
				add_random_research_option = {
					add_progress = 0.99
					area = physics
					tier = 2
					ignore_prereqs = no
					fail_effects = {
						add_monthly_resource_mult = {
							resource = physics_research
							value = @tier5researchreward
							min = @tier5researchmin
							max = @tier5researchmax
						}
					}
				}
			}
			10 = {
				add_random_research_option = {
					add_progress = 0.99
					area = society
					tier = 2
					ignore_prereqs = no
					fail_effects = {
						add_monthly_resource_mult = {
							resource = society_research
							value = @tier5researchreward
							min = @tier5researchmin
							max = @tier5researchmax
						}
					}
				}
			}	
			10 = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier4researchreward
					min = @tier4researchmin
					max = @tier4researchmax
				}
			}
		}
	}
}

# Exploring unknown wreckage
country_event = {
	id = solarstorm_fleet_event.102
	title = "solarstorm_fleet_event.102.name"
	desc = "solarstorm_fleet_event.102.desc"
	picture = GFX_evt_wreckage
	show_sound = event_sensor_ping
	location = event_target:fleet_wreckage
	
	is_triggered_only = yes

	trigger = {
	}
	
	immediate = {
		event_target:fleet_wreckage = {
			destroy_ambient_object = this
		}
		clear_global_event_target = fleet_wreckage
		
		country_event = { id = story.5 days = 30 }

		event_target:wreckage_country = {
			#Improve communication in the future...
			establish_communications_no_message = root
		}
		clear_global_event_target = fleet_wreckage
		clear_global_event_target = wreckage_country
	}
	
	option = {
		name = SPLENDID
		owner = {
			locked_random_list = {
				10 = {
					add_random_research_option = {
						add_progress = 0.99
						area = engineering
						tier = 2
						ignore_prereqs = no
						fail_effects = {
							add_monthly_resource_mult = {
								resource = engineering_research
								value = @tier5researchreward
								min = @tier5researchmin
								max = @tier5researchmax
							}
						}
					}
				}
				10 = {
					add_random_research_option = {
						add_progress = 0.99
						area = physics
						tier = 2
						ignore_prereqs = no
						fail_effects = {
							add_monthly_resource_mult = {
								resource = physics_research
								value = @tier5researchreward
								min = @tier5researchmin
								max = @tier5researchmax
							}
						}
					}
				}
				10 = {
					add_random_research_option = {
						add_progress = 0.99
						area = society
						tier = 2
						ignore_prereqs = no
						fail_effects = {
							add_monthly_resource_mult = {
								resource = society_research
								value = @tier5researchreward
								min = @tier5researchmin
								max = @tier5researchmax
							}
						}
					}
				}	
				10 = {
					add_monthly_resource_mult = {
						resource = society_research
						value = @tier4researchreward
						min = @tier4researchmin
						max = @tier4researchmax
					}
				}
			}
		}
	}
}
