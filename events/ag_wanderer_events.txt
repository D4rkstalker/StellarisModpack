namespace = ag_wanderer

# on_entering_system_fleet, Notification for encounter anchor station
fleet_event = {
	id = ag_wanderer.1
	title = "ag_wanderer.1.name"
	desc = "ag_wanderer.1.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_ancient_anchor_station_room }
	show_sound = event_radio_chatter
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		from = { has_star_flag = ag_ancient_anchor_system }
		exists = owner
		owner = {
			NOR = {
				has_country_flag = ag_encountered_first_anchor_station
				has_country_flag = ag_encountered_anchor_station@from
				has_country_flag = ag_ancient_anchor_station_located
			}
		}
	}
	immediate = {
		owner = {
			set_country_flag = ag_encountered_first_anchor_station
			set_country_flag = ag_encountered_anchor_station@from
		}
	}

	option = { name = "ag_wanderer.1.a" }
}
fleet_event = {
	id = ag_wanderer.2
	title = "ag_wanderer.2.name"
	desc = "ag_wanderer.2.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_ancient_anchor_station_room }
	show_sound = event_radio_chatter
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		from = { has_star_flag = ag_ancient_anchor_system }
		exists = owner
		owner = {
			has_country_flag = ag_encountered_first_anchor_station
			NOR = {
				has_country_flag = ag_encountered_anchor_station@from
				has_country_flag = ag_ancient_anchor_station_located
			}
		}
	}
	immediate = { owner = { set_country_flag = ag_encountered_anchor_station@from } }

	option = { name = "ag_wanderer.2.a" }
}
fleet_event = {
	id = ag_wanderer.3
	title = "ag_wanderer.3.name"
	desc = "ag_wanderer.3.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_ancient_anchor_station_alt_room }
	show_sound = event_radio_chatter
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		from = { has_star_flag = ag_ancient_anchor_system }
		exists = owner
		owner = {
			has_country_flag = ag_ancient_anchor_station_located
			NOT = { has_country_flag = ag_encountered_anchor_station@from }
		}
	}
	immediate = { owner = { set_country_flag = ag_encountered_anchor_station@from } }

	option = { name = "ag_wanderer.3.a" }
}

# on_yearly_pulse, Find Riikinak Empire's colony
event = {
	id = ag_wanderer.11
	hide_window = yes
	trigger = {
		ag_spawnsystem_gatekeeper_trigger = yes
		NOT = { has_global_flag = ag_wanderer_site_spawned }
	}
	is_triggered_only = yes
	immediate = {
		random_list = {
			90 = { }
			10 = {
				if = {
					limit = {
						any_country = {
							is_ai = no
							has_country_flag = ag_encountered_first_anchor_station
							has_technology = tech_sensors_4
							any_owned_planet = {
								is_capital = no
								solar_system = {
									NOT = {
										any_system_planet = {
											is_capital = yes
										}
									}
									any_system_planet = {
										OR = {
											is_planet_class = pc_barren
											is_planet_class = pc_barren_cold
											is_planet_class = pc_frozen
											is_planet_class = pc_toxic
										}
									}
								}
							}
						}
					}
					set_global_flag = ag_wanderer_site_spawned
					random_country = {
						limit = {
							is_ai = no
							has_country_flag = ag_encountered_first_anchor_station
							has_technology = tech_sensors_4
							any_owned_planet = {
								is_capital = no
								solar_system = {
									NOT = {
										any_system_planet = {
											is_capital = yes
										}
									}
									any_system_planet = {
										OR = {
											is_planet_class = pc_barren
											is_planet_class = pc_barren_cold
											is_planet_class = pc_frozen
											is_planet_class = pc_toxic
										}
									}
								}
							}
						}
						country_event = { id = ag_wanderer.12 days = 60 random = 30 }
					}
				}
			}
		}
	}
}
country_event = {
	id = ag_wanderer.12
	title = "ag_wanderer.12.name"
	desc = "ag_wanderer.12.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_archaeological_dig_room }
	show_sound = event_sensor_ping
	location = event_target:ag_target_planet
	
	is_triggered_only = yes
	
	immediate = {
		random_owned_planet = {
			limit = {
				is_capital = no
				solar_system = {
					NOT = {
						any_system_planet = {
							is_capital = yes
						}
					}
					any_system_planet = {
						OR = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
							is_planet_class = pc_frozen
							is_planet_class = pc_toxic
						}
					}
				}
			}
			save_event_target_as = ag_target_planet
			solar_system = {
				random_system_planet = {
					limit = {
						OR = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
							is_planet_class = pc_frozen
							is_planet_class = pc_toxic
						}
					}
					save_global_event_target_as = ag_riikinak_colony_planet
				}
			}
		}
	}
	
	option = {
		name = "ag_wanderer.12.a"
		enable_special_project = {
			name = ag_riikinak_colony_project
			location = event_target:ag_riikinak_colony_planet
			owner = root
		}
	}
	option = {
		name = "ag_wanderer.12.b"
		custom_tooltip = "ag_wanderer.12.b.tooltip"
		add_resource = { influence = 80 }
	}
}
ship_event = {
	id = ag_wanderer.13
	title = "ag_wanderer.13.name"
	desc = "ag_wanderer.13.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_sensor_ping
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.13.a"
		enable_special_project = {
			name = ag_riikinak_colony_project_2
			location = event_target:ag_riikinak_colony_planet
			owner = root
		}
	}
	option = {
		name = "ag_wanderer.13.b"
		custom_tooltip = "ag_wanderer.12.b.tooltip"
		owner = { add_resource = { influence = 80 } }
	}
}
ship_event = {
	id = ag_wanderer.14
	title = "ag_wanderer.14.name"
	desc = "ag_wanderer.14.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_gaia_planet_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes

	immediate = {
		event_target:ag_riikinak_colony_planet = {
			change_pc = pc_gaia
			reroll_planet = yes
			ag_add_blocker_on_wanderer_gaia = yes
		}
	}
	
	option = {
		name = "ag_wanderer.14.a"
		event_target:ag_riikinak_colony_planet = {
			create_archaeological_site = ag_silence_colony_site
		}
		hidden_effect = { owner = { set_country_flag = ag_silence_colony_site_discovered } }
	}
	option = {
		name = "ag_wanderer.14.b"
		custom_tooltip = "ag_wanderer.12.b.tooltip"
		owner = { add_resource = { influence = 80 } }
	}
}

# Archaeological Site: Silence Colony
# Stage 1
fleet_event = {
	id = ag_wanderer.21
	title = "ag_wanderer.21.name"
	desc = "ag_wanderer.21.desc"
	picture = GFX_evt_overgrown_city
	show_sound = event_dig_site
	
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	
	option = {
		name = "ag_wanderer.21.a"
	}
}
# Stage 2
fleet_event = {
	id = ag_wanderer.22
	title = "ag_wanderer.22.name"
	desc = "ag_wanderer.22.desc"
	picture = GFX_evt_alien_ruins
	show_sound = event_dig_site
	
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	
	option = {
		name = "ag_wanderer.22.a"
		small_artifact_reward = yes
	}
}
# Stage 3
fleet_event = {
	id = ag_wanderer.23
	title = "ag_wanderer.23.name"
	desc = "ag_wanderer.23.desc"
	picture = GFX_evt_ancient_records
	show_sound = event_dig_site
	
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	
	option = {
		name = "ag_wanderer.23.a"
		small_artifact_reward = yes
	}
}
# Stage 4
fleet_event = {
	id = ag_wanderer.24
	title = "ag_wanderer.24.name"
	desc = "ag_wanderer.24.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	
	option = {
		name = "ag_wanderer.24.a"
		small_artifact_reward = yes
	}
}
# Stage 5
fleet_event = {
	id = ag_wanderer.25
	title = "ag_wanderer.25.name"
	desc = "ag_wanderer.25.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_mystic_reveal
	
	archaeology = yes
	is_triggered_only = yes
	immediate = { from = { set_site_progress_locked = yes } }
	after = { from = { set_site_progress_locked = no } }
	
	option = {
		name = "ag_wanderer.25.a"
		custom_tooltip = "ag_wanderer.25.a.tooltip"
		medium_artifact_reward = yes
		hidden_effect = {
			set_global_flag = ag_wanderer_returning
			owner = { set_country_flag = ag_wanderer_25_fired }
			event_target:global_event_country = {
				country_event = { id = ag_wanderer.31 days = 540 random = 360 }
			}
			every_country = {
				limit = { ag_is_common_country = yes has_technology = tech_sensors_4 }
				country_event = { id = ag_wanderer.32 days = 90 random = 45 }
			}
			every_country = {
				limit = { any_owned_megastructure = { is_megastructure_type = ag_ancient_anchor_station_0 } }
				country_event = { id = ag_wanderer.26 }
			}
			every_megastructure = {
				limit = { is_megastructure_type = ag_ancient_anchor_station_0 }
				upgrade_megastructure_to = ag_ancient_anchor_station_1
				finish_upgrade = yes
				ag_spawn_buff_effect = { ag_color = red ag_scale = xl }
			}
		}
	}
	option = {
		name = "ag_wanderer.25.b"
		large_artifact_reward = yes
		owner = { add_resource = { influence = 80 } }
	}
}
# Notification: Anchor station actived
country_event = {
	id = ag_wanderer.26
	title = "ag_wanderer.26.name"
	desc = "ag_wanderer.26.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_ancient_anchor_station_alt_room }
	show_sound = event_sensor_ping
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.26.a" }
	option = {
		name = "ag_wanderer.26.b"
		trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
		}
	}
}

# Spawn Wandering Ship
country_event = {
	id = ag_wanderer.31
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_global_flag = ag_wanderer_ship_spawned
		from = { save_event_target_as = ag_system_discover_country }
		random_rim_system = {
			limit = { ag_spawnsystem_trigger = yes }
			save_event_target_as = ag_ancient_wanderer_spawn_loc
		}
		if = {
			limit = { NOT = { exists = event_target:ag_ancient_wanderer_spawn_loc } }
			random_rim_system = {
				limit = { ag_spawnsystem_trigger_fallback_1 = yes }
				save_event_target_as = ag_ancient_wanderer_spawn_loc
			}
		}
		if = {
			limit = { NOT = { exists = event_target:ag_ancient_wanderer_spawn_loc } }
			random_rim_system = {
				limit = {
					NOR = {
						has_star_flag = guardian
						has_star_flag = lcluster
					}
				}
				save_event_target_as = ag_ancient_wanderer_spawn_loc
			}
		}
		if = {
			limit = { NOT = { exists = event_target:ag_ancient_wanderer_spawn_loc } }
			random_rim_system = {
				limit = { always = yes }
				save_event_target_as = ag_ancient_wanderer_spawn_loc
			}
		}
		event_target:ag_ancient_wanderer_spawn_loc = {
			random_system_planet = {
				limit = { is_primary_star = yes }
				ag_create_ancient_guardian = {
					ag_country_name = "NAME_ag_ancient_wanderer_country"
					ag_country_type = ag_ancient_wanderer_country
				}
				last_created_country = {
					set_country_flag = ag_ancient_wanderer_country
					save_global_event_target_as = ag_ancient_wanderer_country
					ag_ancient_country_friendly_to_each_other = yes
				}
				ag_ancient_wandering_ship_spawn = {
					ag_target = prev
					ag_distance = 300
				}
			}
		}
		every_country = {
			limit = {
				ag_is_common_country = yes
				has_country_flag = ag_wanderer_32_fired
			}
			if = {
				limit = {
					NOT = { is_same_value = root.from }
					intel_level = {
						level >= high
						system = event_target:ag_ancient_wanderer_spawn_loc
					}
				}
				country_event = { id = ag_wanderer.33 }
			}
			else_if = {
				limit = {
					intel_level = {
						level >= high
						system = event_target:ag_ancient_wanderer_spawn_loc
					}
				}
				country_event = { id = ag_wanderer.34 }
			}
			else_if = {
				limit = { always = yes }
				country_event = { id = ag_wanderer.35 }
			}
		}
		every_country = {
			limit = { NOT = { has_communications = event_target:ag_ancient_wanderer_country } }
			establish_communications_no_message = event_target:ag_ancient_wanderer_country
		}
	}
}

# Notifications
country_event = {
	id = ag_wanderer.32
	title = "ag_wanderer.32.name"
	desc = "ag_wanderer.32.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_star_chart_room }
	show_sound = event_sensor_ping
	
	is_triggered_only = yes
	immediate = { set_country_flag = ag_wanderer_32_fired }
	
	option = { name = "ag_wanderer.32.a" }
	option = { name = "ag_wanderer.32.b" }
}
country_event = {
	id = ag_wanderer.33
	title = "ag_wanderer.33.name"
	desc = "ag_wanderer.33.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unknown_ships_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes
	immediate = { set_country_flag = ag_seen_ancient_wanderer }
	
	option = {
		name = "ag_wanderer.33.a"
		custom_tooltip = "ag_wanderer.33.a.tooltip"
		begin_event_chain = {
			event_chain = ag_ancient_wandering_ship_tracker
			target = root
		}
		hidden_effect = {
			set_country_flag = ag_tracks_wandering_ship
			if = {
				limit = {
					exists = event_target:ag_ancient_wandering_ship_fleet
					event_target:ag_ancient_wandering_ship_fleet = { exists = solar_system }
				}
				create_point_of_interest = {
					id = ag_ancient_wandering_ship_poi
					name = "ag_ancient_wandering_ship_poi"
					desc = "ag_ancient_wandering_ship_poi_desc"
					event_chain = ag_ancient_wandering_ship_tracker
					location = event_target:ag_ancient_wandering_ship_fleet.solar_system
				}
			}
			if = {
				limit = { NOT = { has_special_project = ag_stop_tracking_wandering_ship } }
				enable_special_project = {
					name = "ag_stop_tracking_wandering_ship"
					owner = root
				}
			}
		}
	}
	option = {
		name = "ag_wanderer.33.b"
		begin_event_chain = {
			event_chain = ag_ancient_wandering_ship_tracker
			target = root
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_special_project = ag_tracking_wandering_ship } }
				enable_special_project = {
					name = "ag_tracking_wandering_ship"
					owner = root
				}
			}
		}
	}
}
country_event = {
	id = ag_wanderer.34
	title = "ag_wanderer.34.name"
	desc = "ag_wanderer.34.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unknown_ships_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes
	immediate = { set_country_flag = ag_seen_ancient_wanderer }
	
	option = {
		name = "ag_wanderer.34.a"
		custom_tooltip = "ag_wanderer.33.a.tooltip"
		begin_event_chain = {
			event_chain = ag_ancient_wandering_ship_tracker
			target = root
		}
		hidden_effect = {
			set_country_flag = ag_tracks_wandering_ship
			if = {
				limit = {
					exists = event_target:ag_ancient_wandering_ship_fleet
					event_target:ag_ancient_wandering_ship_fleet = { exists = solar_system }
				}
				create_point_of_interest = {
					id = ag_ancient_wandering_ship_poi
					name = "ag_ancient_wandering_ship_poi"
					desc = "ag_ancient_wandering_ship_poi_desc"
					event_chain = ag_ancient_wandering_ship_tracker
					location = event_target:ag_ancient_wandering_ship_fleet.solar_system
				}
			}
			if = {
				limit = { NOT = { has_special_project = ag_stop_tracking_wandering_ship } }
				enable_special_project = {
					name = "ag_stop_tracking_wandering_ship"
					owner = root
				}
			}
		}
	}
	option = {
		name = "ag_wanderer.34.b"
		begin_event_chain = {
			event_chain = ag_ancient_wandering_ship_tracker
			target = root
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_special_project = ag_tracking_wandering_ship } }
				enable_special_project = {
					name = "ag_tracking_wandering_ship"
					owner = root
				}
			}
		}
	}
}
country_event = {
	id = ag_wanderer.35
	title = "ag_wanderer.35.name"
	desc = "ag_wanderer.35.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_unknown_ships_room }
	show_sound = event_sensor_ping
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.35.a" }
	option = { name = "ag_wanderer.35.b" }
}

# on_entering_system_fleet, Delayed notification for wandering ship
fleet_event = {
	id = ag_wanderer.36
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_fleet_flag = ag_ancient_wandering_ship_fleet
		from = {
			exists = space_owner
			space_owner = {
				ag_is_common_country = yes
				NOT = { has_country_flag = ag_seen_ancient_wanderer }
			}
		}
	}

	immediate = {
		from.space_owner = {
			set_country_flag = ag_seen_ancient_wanderer
			if = {
				limit = { has_country_flag = ag_wanderer_25_fired }
				country_event = { id = ag_wanderer.37 }
			}
			else = { country_event = { id = ag_wanderer.38 } }
		}
	}
}
country_event = {
	id = ag_wanderer.37
	title = "ag_wanderer.37.name"
	desc = "ag_wanderer.37.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unknown_ships_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.37.a"
		custom_tooltip = "ag_wanderer.33.a.tooltip"
		begin_event_chain = {
			event_chain = ag_ancient_wandering_ship_tracker
			target = root
		}
		hidden_effect = {
			set_country_flag = ag_tracks_wandering_ship
			if = {
				limit = {
					exists = event_target:ag_ancient_wandering_ship_fleet
					event_target:ag_ancient_wandering_ship_fleet = { exists = solar_system }
				}
				create_point_of_interest = {
					id = ag_ancient_wandering_ship_poi
					name = "ag_ancient_wandering_ship_poi"
					desc = "ag_ancient_wandering_ship_poi_desc"
					event_chain = ag_ancient_wandering_ship_tracker
					location = event_target:ag_ancient_wandering_ship_fleet.solar_system
				}
			}
			if = {
				limit = { NOT = { has_special_project = ag_stop_tracking_wandering_ship } }
				enable_special_project = {
					name = "ag_stop_tracking_wandering_ship"
					owner = root
				}
			}
		}
	}
	option = {
		name = "ag_wanderer.37.b"
		begin_event_chain = {
			event_chain = ag_ancient_wandering_ship_tracker
			target = root
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_special_project = ag_tracking_wandering_ship } }
				enable_special_project = {
					name = "ag_tracking_wandering_ship"
					owner = root
				}
			}
		}
	}
}
country_event = {
	id = ag_wanderer.38
	title = "ag_wanderer.38.name"
	desc = "ag_wanderer.38.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_unknown_ships_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.38.a"
		custom_tooltip = "ag_wanderer.33.a.tooltip"
		begin_event_chain = {
			event_chain = ag_ancient_wandering_ship_tracker
			target = root
		}
		hidden_effect = {
			set_country_flag = ag_tracks_wandering_ship
			if = {
				limit = {
					exists = event_target:ag_ancient_wandering_ship_fleet
					event_target:ag_ancient_wandering_ship_fleet = { exists = solar_system }
				}
				create_point_of_interest = {
					id = ag_ancient_wandering_ship_poi
					name = "ag_ancient_wandering_ship_poi"
					desc = "ag_ancient_wandering_ship_poi_desc"
					event_chain = ag_ancient_wandering_ship_tracker
					location = event_target:ag_ancient_wandering_ship_fleet.solar_system
				}
			}
			if = {
				limit = { NOT = { has_special_project = ag_stop_tracking_wandering_ship } }
				enable_special_project = {
					name = "ag_stop_tracking_wandering_ship"
					owner = root
				}
			}
		}
	}
	option = {
		name = "ag_wanderer.38.b"
		begin_event_chain = {
			event_chain = ag_ancient_wandering_ship_tracker
			target = root
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_special_project = ag_tracking_wandering_ship } }
				enable_special_project = {
					name = "ag_tracking_wandering_ship"
					owner = root
				}
			}
		}
	}
}

# Wandering ship's actions
fleet_event = {
	id = ag_wanderer.40
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = this
		has_fleet_flag = ag_ancient_wandering_ship_fleet
	}

	immediate = {
		if = {
			limit = { has_fleet_flag = ag_ancient_wandering_ship_ordered }
			remove_fleet_flag = ag_ancient_wandering_ship_ordered
		}
		ag_ancient_wandering_ship_action = yes
	}
}

# on_fleet_auto_move_arrival, Wandering ship arrives its target
country_event = {
	id = ag_wanderer.41
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		is_country_type = ag_ancient_wanderer_country
		has_country_flag = ag_ancient_wanderer_country
		from = { has_fleet_flag = ag_ancient_wandering_ship_fleet }
	}

	immediate = {
		if = {
			limit = {
				fromfrom.solar_system = { has_star_flag = ag_ancient_wandering_ship_visited }
				NOT = { has_global_flag = ag_wanderer_42_fired }
			}
			set_global_flag = ag_wanderer_42_fired
		}
		if = {
			limit = { fromfrom.solar_system = { has_star_flag = ag_ancient_anchor_system } }
			fromfrom.solar_system = {
				switch = {
					trigger = has_star_flag
					ag_ancient_anchor_system_1 = {
						root.from = {
							set_variable = {
								which = ag_ancient_wandering_current_anchor
								value = 1
							}
						}
						if = {
							limit = { NOT = { has_star_flag = ag_ancient_wandering_ship_visited } }
							set_star_flag = ag_ancient_wandering_ship_visited
						}
					}
					ag_ancient_anchor_system_2 = {
						root.from = {
							set_variable = {
								which = ag_ancient_wandering_current_anchor
								value = 2
							}
						}
						if = {
							limit = { NOT = { has_star_flag = ag_ancient_wandering_ship_visited } }
							set_star_flag = ag_ancient_wandering_ship_visited
						}
					}
					ag_ancient_anchor_system_3 = {
						root.from = {
							set_variable = {
								which = ag_ancient_wandering_current_anchor
								value = 3
							}
						}
						if = {
							limit = { NOT = { has_star_flag = ag_ancient_wandering_ship_visited } }
							set_star_flag = ag_ancient_wandering_ship_visited
						}
					}
					ag_ancient_anchor_system_4 = {
						root.from = {
							set_variable = {
								which = ag_ancient_wandering_current_anchor
								value = 4
							}
						}
						if = {
							limit = { NOT = { has_star_flag = ag_ancient_wandering_ship_visited } }
							set_star_flag = ag_ancient_wandering_ship_visited
						}
					}
					ag_ancient_anchor_system_5 = {
						root.from = {
							set_variable = {
								which = ag_ancient_wandering_current_anchor
								value = 5
							}
						}
						if = {
							limit = { NOT = { has_star_flag = ag_ancient_wandering_ship_visited } }
							set_star_flag = ag_ancient_wandering_ship_visited
						}
					}
					ag_ancient_anchor_system_6 = {
						root.from = {
							set_variable = {
								which = ag_ancient_wandering_current_anchor
								value = 6
							}
						}
						if = {
							limit = { NOT = { has_star_flag = ag_ancient_wandering_ship_visited } }
							set_star_flag = ag_ancient_wandering_ship_visited
						}
					}
					ag_ancient_anchor_system_7 = {
						root.from = {
							set_variable = {
								which = ag_ancient_wandering_current_anchor
								value = 7
							}
						}
						if = {
							limit = { NOT = { has_star_flag = ag_ancient_wandering_ship_visited } }
							set_star_flag = ag_ancient_wandering_ship_visited
						}
					}
					ag_ancient_anchor_system_8 = {
						root.from = {
							set_variable = {
								which = ag_ancient_wandering_current_anchor
								value = 8
							}
						}
						if = {
							limit = { NOT = { has_star_flag = ag_ancient_wandering_ship_visited } }
							set_star_flag = ag_ancient_wandering_ship_visited
						}
					}
					ag_ancient_anchor_system_9 = {
						root.from = {
							set_variable = {
								which = ag_ancient_wandering_current_anchor
								value = 9
							}
						}
						if = {
							limit = { NOT = { has_star_flag = ag_ancient_wandering_ship_visited } }
							set_star_flag = ag_ancient_wandering_ship_visited
						}
					}
					ag_ancient_anchor_system_10 = {
						root.from = {
							set_variable = {
								which = ag_ancient_wandering_current_anchor
								value = 0
							}
						}
						if = {
							limit = { NOT = { has_star_flag = ag_ancient_wandering_ship_visited } }
							set_star_flag = ag_ancient_wandering_ship_visited
						}
					}
				}
			}
		}
		from = {
			fleet_event = { id = ag_wanderer.40 days = 15 random = 20 }
			set_fleet_flag = ag_ancient_wandering_ship_ordered
		}
	}
}

# on_monthly_pulse, Failsafe for unexpected bugs or events make wandering ship stoped
event = {
	id = ag_wanderer.42
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = event_target:ag_ancient_wanderer_country
		exists = event_target:ag_ancient_wandering_ship_fleet
	}

	immediate = {
		if = {
			limit = { event_target:ag_ancient_wandering_ship_fleet = { is_in_combat = no } }
			every_country = {
				limit = {
					NOT = { is_same_value = event_target:ag_ancient_wanderer_country }
					is_hostile = event_target:ag_ancient_wanderer_country
					NOT = { has_country_flag = ag_wanderer_set_hostile_flag }
					NAND = {
						ag_zeta_crisis_event_active = yes
						is_same_value = event_target:ag_zeta_crisis_country
						event_target:ag_ancient_wandering_ship_fleet = {
							exists = solar_system
							solar_system = {
								exists = space_owner
								space_owner = {
									is_same_value = prevprevprev
								}
							}
						}
					}
				}
				set_faction_hostility = {
					target = event_target:ag_ancient_wanderer_country
					set_hostile = no
					set_neutral = yes
					set_friendly = no
				}
				country_event = { id = ag_wanderer.44 }
			}
		}
		if = {
			limit = {
				event_target:ag_ancient_wandering_ship_fleet = {
					is_fleet_idle = yes
					NAND = {
						exists = orbit
						orbit = { has_planet_flag = ag_ancient_anchor_planet }
						has_fleet_flag = ag_ancient_wandering_ship_ordered
					}
				}
			}
			event_target:ag_ancient_wandering_ship_fleet = {
				clear_orders = yes
				clear_fleet_actions = this
				fleet_event = { id = ag_wanderer.40 days = 2 random = 3 }
				set_fleet_flag = ag_ancient_wandering_ship_ordered
			}
		}
	}
}

# on_entering_system_fleet, Hostile to Shroud Invaders when entering their systems
fleet_event = {
	id = ag_wanderer.43
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		ag_zeta_crisis_event_active = yes
		has_fleet_flag = ag_ancient_wandering_ship_fleet
		exists = owner
		owner = {
			is_country_type = ag_ancient_wanderer_country
			has_country_flag = ag_ancient_wanderer_country
			NOT = { is_hostile = event_target:ag_zeta_crisis_country }
		}
		from = {
			exists = space_owner
			space_owner = {
				is_same_value = event_target:ag_zeta_crisis_country
			}
		}
	}

	immediate = {
		owner = {
			set_faction_hostility = {
				target = event_target:ag_zeta_crisis_country
				set_hostile = yes
				set_neutral = no
				set_friendly = no
			}
		}
		clear_orders = yes
		clear_fleet_actions = this
		auto_move_to_planet = {
			target = from.star
			clear_auto_move_on_arrival = yes
		}
	}
}

# Notification for wandering ship turn into neutral
country_event = {
	id = ag_wanderer.44
	title = "ag_wanderer.44.name"
	desc = "ag_wanderer.44.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_yellow_alert
	location = event_target:ag_ancient_wandering_ship_fleet
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.44.a" }
	option = { name = "ag_wanderer.44.b" }
}

# on_entering_system_fleet, Update trackers
fleet_event = {
	id = ag_wanderer.45
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_fleet_flag = ag_ancient_wandering_ship_fleet
		exists = owner
		owner = {
			is_country_type = ag_ancient_wanderer_country
			has_country_flag = ag_ancient_wanderer_country
		}
	}

	immediate = {
		every_country = {
			limit = { has_country_flag = ag_tracks_wandering_ship has_event_chain = ag_ancient_wandering_ship_tracker }
			remove_point_of_interest = ag_ancient_wandering_ship_poi
			create_point_of_interest = {
				id = ag_ancient_wandering_ship_poi
				name = "ag_ancient_wandering_ship_poi"
				desc = "ag_ancient_wandering_ship_poi_desc"
				event_chain = ag_ancient_wandering_ship_tracker
				location = root.solar_system
			}
		}
	}
}

# on_ship_disabled, Disabled wandering ship
ship_event = {
	id = ag_wanderer.51
	hide_window = yes

	is_triggered_only = yes

	trigger = { has_ship_flag = ag_ancient_wandering_ship }

	immediate = {
		fleet = {
			if = {
				limit = { NOT = { is_variable_set = ag_num_disabled_anchor_stations } }
				set_variable = { which = ag_num_disabled_anchor_stations value = 0 }
			}
			random_list = {
				0 = {
					modifier = {
						add = 20
						check_variable = { which = ag_num_disabled_anchor_stations value > 4 }
					}
					modifier = {
						add = 20
						check_variable = { which = ag_num_disabled_anchor_stations value > 3 }
					}
					modifier = {
						add = 20
						check_variable = { which = ag_num_disabled_anchor_stations value > 2 }
					}
					modifier = {
						add = 20
						check_variable = { which = ag_num_disabled_anchor_stations value > 1 }
					}
					modifier = {
						add = 20
						check_variable = { which = ag_num_disabled_anchor_stations value > 0 }
						NOT = { has_fleet_flag = ag_ancient_wandering_ship_repair_flag }
					}
					modifier = {
						add = 1000
						ag_zeta_crisis_event_active = yes
						root.from.owner = { is_same_value = event_target:ag_zeta_crisis_country }
					}
					root = {
						ag_set_disable_at_health = { ag_value = -1 }
						set_disabled = no
					}
				}
				100 = {
					modifier = {
						add = -20
						check_variable = { which = ag_num_disabled_anchor_stations value > 4 }
					}
					modifier = {
						add = -20
						check_variable = { which = ag_num_disabled_anchor_stations value > 3 }
					}
					modifier = {
						add = -20
						check_variable = { which = ag_num_disabled_anchor_stations value > 2 }
					}
					modifier = {
						add = -20
						check_variable = { which = ag_num_disabled_anchor_stations value > 1 }
					}
					modifier = {
						add = -20
						check_variable = { which = ag_num_disabled_anchor_stations value > 0 }
						NOT = { has_fleet_flag = ag_ancient_wandering_ship_repair_flag }
					}
					modifier = {
						factor = 0
						ag_zeta_crisis_event_active = yes
						root.from.owner = { is_same_value = event_target:ag_zeta_crisis_country }
					}
					root = {
						# ag_spawn_buff_effect = { ag_color = red ag_scale = l }
						repair_ship = yes
						set_disabled = no
						fleet = {
							if = {
								limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 1 } }
								set_timed_fleet_flag = {
									flag = ag_ancient_wandering_ship_repair_flag
									days = 8
								}
							}
							if = {
								limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 0 } }
								root = {
									remove_modifier = ag_ancient_wandering_ship_power_0
									random_list = {
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_0 days = 20 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_0 days = 16 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_0 days = 12 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_0 days = 8 } }
									}
								}
								solar_system = {
									every_fleet_in_system = {
										limit = {
											exists = owner
											owner = { is_hostile = prevprevprev.owner }
										}
										add_modifier = { modifier = ag_wandering_ship_system_debuff days = 30 }
									}
								}
							}
							else_if = {
								limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 1 } }
								root = {
									remove_modifier = ag_ancient_wandering_ship_power_1
									random_list = {
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_1 days = 20 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_1 days = 16 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_1 days = 12 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_1 days = 8 } }
									}
								}
								random_list = {
									25 = { }
									75 = {
										modifier = {
											factor = 0.2
											prev = { has_ship_flag = ag_ancient_wandering_ship_repair_flag }
										}
										solar_system = {
											every_fleet_in_system = {
												limit = {
													exists = owner
													owner = { is_hostile = prevprevprev.owner }
												}
												add_modifier = { modifier = ag_wandering_ship_system_debuff days = 20 }
											}
										}
									}
								}
							}
							else_if = {
								limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 2 } }
								root = {
									remove_modifier = ag_ancient_wandering_ship_power_2
									random_list = {
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_2 days = 20 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_2 days = 16 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_2 days = 12 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_2 days = 8 } }
									}
								}
								random_list = {
									50 = { }
									50 = {
										solar_system = {
											every_fleet_in_system = {
												limit = {
													exists = owner
													owner = { is_hostile = prevprevprev.owner }
												}
												add_modifier = { modifier = ag_wandering_ship_system_debuff days = 10 }
											}
										}
									}
								}
							}
							else_if = {
								limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 3 } }
								root = {
									remove_modifier = ag_ancient_wandering_ship_power_3
									random_list = {
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_3 days = 20 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_3 days = 16 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_3 days = 12 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_3 days = 8 } }
									}
								}
								random_list = {
									25 = { }
									75 = {
										solar_system = {
											every_fleet_in_system = {
												limit = {
													exists = owner
													owner = { is_hostile = prevprevprev.owner }
												}
												add_modifier = { modifier = ag_wandering_ship_system_debuff days = 5 }
											}
										}
									}
								}
							}
							else_if = {
								limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 4 } }
								root = {
									remove_modifier = ag_ancient_wandering_ship_power_4
									random_list = {
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_4 days = 20 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_4 days = 16 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_4 days = 12 } }
										25 = { add_modifier = { modifier = ag_ancient_wandering_ship_power_4 days = 8 } }
									}
								}
							}
						}
						from.owner = {
							if = {
								limit = { NOT = { has_country_flag = ag_seen_wandering_ship_repaired } }
								set_country_flag = ag_seen_wandering_ship_repaired
								country_event = { id = ag_wanderer.52 }
							}
						}
					}
				}
			}
		}
	}
}
# Notification for wandering ship repaired
country_event = {
	id = ag_wanderer.52
	title = "ag_wanderer.52.name"
	desc = "ag_wanderer.52.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_red_alert
	location = from
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.52.a" }
}

# on_fleet_destroyed_victim, Notification: Wandering ship is invincible befor anchor station deactivated
country_event = {
	id = ag_wanderer.53
	title = "ag_wanderer.53.name"
	desc = "ag_wanderer.53.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_yellow_alert
	location = fromfromfrom
	
	is_triggered_only = yes

	trigger = {
		NOT = { has_country_flag = ag_wanderer_warning_flag }
		ag_is_common_country = yes
		from = {
			is_country_type = ag_ancient_wanderer_country
			has_country_flag = ag_ancient_wanderer_country
		}
		fromfromfrom = {
			has_fleet_flag = ag_ancient_wandering_ship_fleet
			check_variable = { which = ag_num_disabled_anchor_stations value = 0 }
		}
	}

	immediate = { set_country_flag = ag_wanderer_warning_flag }
	
	option = { name = "ag_wanderer.53.a" }
}

# Find wandering ship's connection with anchor station
country_event = {
	id = ag_wanderer.61
	title = "ag_wanderer.61.name"
	desc = "ag_wanderer.61.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_mystic_reveal
	location = capital_scope
	
	mean_time_to_happen = { years = 8 }
	
	trigger = {
		NOT = { has_country_flag = ag_anchor_station_event_available }
		has_country_flag = ag_wanderer_25_fired
		exists = event_target:ag_ancient_wanderer_country
	}

	immediate = {
		set_country_flag = ag_anchor_station_event_available
	}

	option = {
		name = "ag_wanderer.61.a"
		enable_special_project = {
			name = ag_ancient_anchor_station_project
			location = root.capital_scope
			owner = root
		}
	}
	option = {
		name = "ag_wanderer.61.b"
		add_resource = { influence = 80 }
	}
}
country_event = {
	id = ag_wanderer.62
	title = "ag_wanderer.62.name"
	desc = "ag_wanderer.62.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_mystic_reveal
	location = capital_scope
	
	mean_time_to_happen = { years = 2 }
	
	trigger = {
		NOR = {
			has_country_flag = ag_anchor_station_event_available
			has_country_flag = ag_wanderer_25_fired
		}
		has_country_flag = ag_wanderer_warning_flag
		exists = event_target:ag_ancient_wanderer_country
	}

	immediate = {
		set_country_flag = ag_anchor_station_event_available
	}

	option = {
		name = "ag_wanderer.62.a"
		enable_special_project = {
			name = ag_ancient_anchor_station_project
			location = root.capital_scope
			owner = root
		}
	}
	option = {
		name = "ag_wanderer.62.b"
		add_resource = { influence = 80 }
	}
}
# Finished special project, give tech option
country_event = {
	id = ag_wanderer.63
	title = "ag_wanderer.63.name"
	desc = "ag_wanderer.63.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	location = from
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.63.a"
		add_research_option = tech_ag_ancient_anchor_station
		add_tech_progress = {
			tech = tech_ag_ancient_anchor_station
			progress = 0.05
		}
	}
}
# on_tech_increased, Researched technology, notification to upgrade anchor station
country_event = {
	id = ag_wanderer.64
	title = "ag_wanderer.64.name"
	desc = "ag_wanderer.64.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_ancient_anchor_station_room }
	show_sound = event_laboratory_sound
	location = from
	
	is_triggered_only = yes

	trigger = { last_increased_tech = tech_ag_ancient_anchor_station }
	
	option = {
		name = "ag_wanderer.64.a"
		custom_tooltip = "ag_wanderer.64.a.tooltip"
		begin_event_chain = {
			event_chain = ag_ancient_anchor_station_chain
			target = root
		}
		hidden_effect = {
			set_country_flag = ag_ancient_anchor_station_located
			every_megastructure = {
				limit = {
					OR = {
						is_megastructure_type = ag_ancient_anchor_station_0
						is_megastructure_type = ag_ancient_anchor_station_1
						is_megastructure_type = ag_ancient_anchor_station_2
					}
				}
				solar_system = {
					ag_ancient_random_system_set_name = yes
					if = {
						limit = { has_star_flag = ag_ancient_anchor_system_1 }
						root = {
							create_point_of_interest = {
								id = ag_ancient_anchor_station_1
								name = "ag_ancient_anchor_station_poi"
								desc = "ag_ancient_anchor_station_poi_desc"
								event_chain = "ag_ancient_anchor_station_chain"
								location = prevprev
							}
							add_event_chain_counter = {
								event_chain = ag_ancient_anchor_station_chain
								counter = ag_ancient_anchor_station
								amount = 1
							}
						}
					}
					else_if = {
						limit = { has_star_flag = ag_ancient_anchor_system_2 }
						root = {
							create_point_of_interest = {
								id = ag_ancient_anchor_station_2
								name = "ag_ancient_anchor_station_poi"
								desc = "ag_ancient_anchor_station_poi_desc"
								event_chain = "ag_ancient_anchor_station_chain"
								location = prevprev
							}
							add_event_chain_counter = {
								event_chain = ag_ancient_anchor_station_chain
								counter = ag_ancient_anchor_station
								amount = 1
							}
						}
					}
					else_if = {
						limit = { has_star_flag = ag_ancient_anchor_system_3 }
						root = {
							create_point_of_interest = {
								id = ag_ancient_anchor_station_3
								name = "ag_ancient_anchor_station_poi"
								desc = "ag_ancient_anchor_station_poi_desc"
								event_chain = "ag_ancient_anchor_station_chain"
								location = prevprev
							}
							add_event_chain_counter = {
								event_chain = ag_ancient_anchor_station_chain
								counter = ag_ancient_anchor_station
								amount = 1
							}
						}
					}
					else_if = {
						limit = { has_star_flag = ag_ancient_anchor_system_4 }
						root = {
							create_point_of_interest = {
								id = ag_ancient_anchor_station_4
								name = "ag_ancient_anchor_station_poi"
								desc = "ag_ancient_anchor_station_poi_desc"
								event_chain = "ag_ancient_anchor_station_chain"
								location = prevprev
							}
							add_event_chain_counter = {
								event_chain = ag_ancient_anchor_station_chain
								counter = ag_ancient_anchor_station
								amount = 1
							}
						}
					}
					else_if = {
						limit = { has_star_flag = ag_ancient_anchor_system_5 }
						root = {
							create_point_of_interest = {
								id = ag_ancient_anchor_station_5
								name = "ag_ancient_anchor_station_poi"
								desc = "ag_ancient_anchor_station_poi_desc"
								event_chain = "ag_ancient_anchor_station_chain"
								location = prevprev
							}
							add_event_chain_counter = {
								event_chain = ag_ancient_anchor_station_chain
								counter = ag_ancient_anchor_station
								amount = 1
							}
						}
					}
					else_if = {
						limit = { has_star_flag = ag_ancient_anchor_system_6 }
						root = {
							create_point_of_interest = {
								id = ag_ancient_anchor_station_6
								name = "ag_ancient_anchor_station_poi"
								desc = "ag_ancient_anchor_station_poi_desc"
								event_chain = "ag_ancient_anchor_station_chain"
								location = prevprev
							}
							add_event_chain_counter = {
								event_chain = ag_ancient_anchor_station_chain
								counter = ag_ancient_anchor_station
								amount = 1
							}
						}
					}
					else_if = {
						limit = { has_star_flag = ag_ancient_anchor_system_7 }
						root = {
							create_point_of_interest = {
								id = ag_ancient_anchor_station_7
								name = "ag_ancient_anchor_station_poi"
								desc = "ag_ancient_anchor_station_poi_desc"
								event_chain = "ag_ancient_anchor_station_chain"
								location = prevprev
							}
							add_event_chain_counter = {
								event_chain = ag_ancient_anchor_station_chain
								counter = ag_ancient_anchor_station
								amount = 1
							}
						}
					}
					else_if = {
						limit = { has_star_flag = ag_ancient_anchor_system_8 }
						root = {
							create_point_of_interest = {
								id = ag_ancient_anchor_station_8
								name = "ag_ancient_anchor_station_poi"
								desc = "ag_ancient_anchor_station_poi_desc"
								event_chain = "ag_ancient_anchor_station_chain"
								location = prevprev
							}
							add_event_chain_counter = {
								event_chain = ag_ancient_anchor_station_chain
								counter = ag_ancient_anchor_station
								amount = 1
							}
						}
					}
					else_if = {
						limit = { has_star_flag = ag_ancient_anchor_system_9 }
						root = {
							create_point_of_interest = {
								id = ag_ancient_anchor_station_9
								name = "ag_ancient_anchor_station_poi"
								desc = "ag_ancient_anchor_station_poi_desc"
								event_chain = "ag_ancient_anchor_station_chain"
								location = prevprev
							}
							add_event_chain_counter = {
								event_chain = ag_ancient_anchor_station_chain
								counter = ag_ancient_anchor_station
								amount = 1
							}
						}
					}
					else_if = {
						limit = { has_star_flag = ag_ancient_anchor_system_10 }
						root = {
							create_point_of_interest = {
								id = ag_ancient_anchor_station_10
								name = "ag_ancient_anchor_station_poi"
								desc = "ag_ancient_anchor_station_poi_desc"
								event_chain = "ag_ancient_anchor_station_chain"
								location = prevprev
							}
							add_event_chain_counter = {
								event_chain = ag_ancient_anchor_station_chain
								counter = ag_ancient_anchor_station
								amount = 1
							}
						}
					}
				}
			}
			every_megastructure = {
				limit = { is_megastructure_type = ag_ancient_anchor_station_2 }
				root = {
					add_event_chain_counter = {
						event_chain = ag_ancient_anchor_station_chain
						counter = ag_ancient_anchor_station_modified
						amount = 1
					}
				}
			}
		}
	}
}

# Anchor station modified when wandering ship still exists, for megastructure builder
country_event = {
	id = ag_wanderer.65
	title = "ag_wanderer.65.name"
	desc = "ag_wanderer.65.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_ancient_anchor_station_alt_room }
	show_sound = event_spy_orb_build_complete
	location = fromfromfrom
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.65.a"
		add_event_chain_counter = {
			event_chain = ag_ancient_anchor_station_chain
			counter = ag_ancient_anchor_station_modified
			amount = 1
		}
	}
}
# Anchor station modified when wandering ship still exists, for others
country_event = {
	id = ag_wanderer.66
	title = "ag_wanderer.66.name"
	desc = "ag_wanderer.66.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_ancient_anchor_station_alt_room }
	show_sound = event_mega_structure_other_empire_build_complete
	location = fromfrom
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.66.a"
		add_event_chain_counter = {
			event_chain = ag_ancient_anchor_station_chain
			counter = ag_ancient_anchor_station_modified
			amount = 1
		}
	}
}

# Anchor station modified after wandering ship get killed, for megastructure builder
country_event = {
	id = ag_wanderer.67
	title = "ag_wanderer.67.name"
	desc = "ag_wanderer.67.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_ancient_anchor_station_alt_room }
	show_sound = event_spy_orb_build_complete
	location = fromfrom
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.67.a" }
}
# Anchor station modified after wandering ship get killed, for others
country_event = {
	id = ag_wanderer.68
	title = "ag_wanderer.68.name"
	desc = "ag_wanderer.68.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_ancient_anchor_station_alt_room }
	show_sound = event_mega_structure_other_empire_build_complete
	location = fromfrom
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.68.a" }
}

# Notification that an anchor station tuen into hostile
country_event = {
	id = ag_wanderer.71
	title = "ag_wanderer.71.name"
	desc = "ag_wanderer.71.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_fleet_evil_room }
	show_sound = event_red_alert
	location = event_target:ag_target_system.star
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.71.a" }
}

# on_ship_destroyed_perp, Destroy anchor station(Hidden)
country_event = {
	id = ag_wanderer.72
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		from = { is_country_type = ag_ancient_anchor_station_country }
		fromfromfrom = { is_ship_size = ag_ancient_anchor_station_hostile }
	}

	immediate = {
		if = {
			limit = { exists = event_target:ag_ancient_wandering_ship_fleet }
			event_target:ag_ancient_wandering_ship_fleet = {
				change_variable = { which = ag_num_disabled_anchor_stations value = 1 }
				if = {
					limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 6 } }
					add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_1" days = -1 }
				}
				else_if = {
					limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 7 } }
					add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_2" days = -1 }
				}
				else_if = {
					limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 8 } }
					add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_3" days = -1 }
				}
				else_if = {
					limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 9 } }
					add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_4" days = -1 }
				}
				else_if = {
					limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 10 } }
					add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_5" days = -1 }
				}
			}
		}
		fromfromfrom.solar_system = {
			save_event_target_as = ag_target_system
			random_system_planet = {
				limit = { has_planet_flag = ag_ancient_anchor_planet }
				remove_planet_flag = ag_ancient_anchor_planet
			}
			switch = {
				trigger = has_star_flag
				ag_ancient_anchor_system_1 = {
					remove_star_flag = ag_ancient_anchor_system
					remove_star_flag = ag_ancient_anchor_system_1
					remove_global_flag = ag_ancient_anchor_station_1_spawned
				}
				ag_ancient_anchor_system_2 = {
					remove_star_flag = ag_ancient_anchor_system
					remove_star_flag = ag_ancient_anchor_system_2
					remove_global_flag = ag_ancient_anchor_station_2_spawned
				}
				ag_ancient_anchor_system_3 = {
					remove_star_flag = ag_ancient_anchor_system
					remove_star_flag = ag_ancient_anchor_system_3
					remove_global_flag = ag_ancient_anchor_station_3_spawned
				}
				ag_ancient_anchor_system_4 = {
					remove_star_flag = ag_ancient_anchor_system
					remove_star_flag = ag_ancient_anchor_system_4
					remove_global_flag = ag_ancient_anchor_station_4_spawned
				}
				ag_ancient_anchor_system_5 = {
					remove_star_flag = ag_ancient_anchor_system
					remove_star_flag = ag_ancient_anchor_system_5
					remove_global_flag = ag_ancient_anchor_station_5_spawned
				}
				ag_ancient_anchor_system_6 = {
					remove_star_flag = ag_ancient_anchor_system
					remove_star_flag = ag_ancient_anchor_system_6
					remove_global_flag = ag_ancient_anchor_station_6_spawned
				}
				ag_ancient_anchor_system_7 = {
					remove_star_flag = ag_ancient_anchor_system
					remove_star_flag = ag_ancient_anchor_system_7
					remove_global_flag = ag_ancient_anchor_station_7_spawned
				}
				ag_ancient_anchor_system_8 = {
					remove_star_flag = ag_ancient_anchor_system
					remove_star_flag = ag_ancient_anchor_system_8
					remove_global_flag = ag_ancient_anchor_station_8_spawned
				}
				ag_ancient_anchor_system_9 = {
					remove_star_flag = ag_ancient_anchor_system
					remove_star_flag = ag_ancient_anchor_system_9
					remove_global_flag = ag_ancient_anchor_station_9_spawned
				}
				ag_ancient_anchor_system_10 = {
					remove_star_flag = ag_ancient_anchor_system
					remove_star_flag = ag_ancient_anchor_system_10
					remove_global_flag = ag_ancient_anchor_station_10_spawned
				}
			}
		}
		country_event = { id = ag_wanderer.73 }
		every_country = {
			limit = { NOT = { is_same_value = from } }
			country_event = { id = ag_wanderer.74 }
		}
		every_country = {
			limit = { has_event_chain = ag_ancient_anchor_station_chain }
			add_event_chain_counter = {
				event_chain = ag_ancient_anchor_station_chain
				counter = ag_ancient_anchor_station_destroyed
				amount = 1
			}
		}
		if = {
			limit = {
				NOT = {
					any_country = {
						is_country_type = ag_ancient_anchor_station_country
						NOT = { is_same_value = root.from }
						num_ships > 0
					}
				}
			}
			every_country = {
				if = {
					limit = { has_modifier = ag_ancient_anchor_station_weakness }
					remove_modifier = "ag_ancient_anchor_station_weakness"
				}
				if = {
					limit = { has_country_flag = ag_has_ancient_anchor_station_weakness }
					remove_country_flag = ag_has_ancient_anchor_station_weakness
				}
				if = {
					limit = { has_special_project = ag_find_ancient_anchor_station_weakness }
					abort_special_project = {
						type = "ag_find_ancient_anchor_station_weakness"
						location = capital_scope
					}
				}
			}
		}
	}
}
# Notification: An anchor station has been destroyed
country_event = {
	id = ag_wanderer.73
	title = "ag_wanderer.73.name"
	desc = "ag_wanderer.73.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_space_battle
	location = event_target:ag_target_system
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.73.a"
		if = {
			limit = { has_event_chain = ag_ancient_anchor_station_chain }
			add_event_chain_counter = {
				event_chain = ag_ancient_anchor_station_chain
				counter = ag_ancient_anchor_station
				amount = -1
			}
			ag_remove_anchor_station_poi = { ag_target_loc = event_target:ag_target_system }
		}
	}
}
country_event = {
	id = ag_wanderer.74
	title = "ag_wanderer.74.name"
	desc = "ag_wanderer.74.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_target_system
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.74.a"
		if = {
			limit = { has_event_chain = ag_ancient_anchor_station_chain }
			add_event_chain_counter = {
				event_chain = ag_ancient_anchor_station_chain
				counter = ag_ancient_anchor_station
				amount = -1
			}
			ag_remove_anchor_station_poi = { ag_target_loc = event_target:ag_target_system }
		}
	}
}

# on_ship_destroyed_victim, Wandering ship destroyed(Hidden)
country_event = {
	id = ag_wanderer.81
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		is_country_type = ag_ancient_wanderer_country
		has_country_flag = ag_ancient_wanderer_country
		fromfrom = { is_ship_size = ag_ancient_wandering_ship_hostile }
	}

	immediate = {
		create_ambient_object = {
			type = ag_ancient_wandering_ship_debris_object
		}
		last_created_ambient_object = {
			set_location = {
				target = fromfrom
				distance = -1
				angle = 0
			}
			save_global_event_target_as = ag_ancient_wandering_ship_debris
			set_ambient_object_flag = ag_ancient_wandering_ship_debris
		}
		create_ambient_object = {
			type = large_debris_object
		}
		last_created_ambient_object = {
			set_location = {
				target = event_target:ag_ancient_wandering_ship_debris
				distance = 0
				angle = random
			}
			set_ambient_object_flag = ag_ancient_wandering_ship_debris
		}
		from = {
			country_event = { id = ag_wanderer.82 }
			save_event_target_as = ag_ancient_wandering_ship_killer
			add_threat = { who = this amount = 50 }
		}
		fromfrom = {
			ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
			if = {
				limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 1 } }
				event_target:global_event_country = { set_variable = { which = ag_num_disabled_anchor_stations value = 1 } }
			}
			else_if = {
				limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 2 } }
				event_target:global_event_country = { set_variable = { which = ag_num_disabled_anchor_stations value = 2 } }
			}
			else_if = {
				limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 3 } }
				event_target:global_event_country = { set_variable = { which = ag_num_disabled_anchor_stations value = 3 } }
			}
			else_if = {
				limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 4 } }
				event_target:global_event_country = { set_variable = { which = ag_num_disabled_anchor_stations value = 4 } }
			}
			else_if = {
				limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 5 } }
				event_target:global_event_country = { set_variable = { which = ag_num_disabled_anchor_stations value = 5 } }
			}
			else_if = {
				limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 6 } }
				event_target:global_event_country = { set_variable = { which = ag_num_disabled_anchor_stations value = 6 } }
			}
			else_if = {
				limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 7 } }
				event_target:global_event_country = { set_variable = { which = ag_num_disabled_anchor_stations value = 7 } }
			}
			else_if = {
				limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 8 } }
				event_target:global_event_country = { set_variable = { which = ag_num_disabled_anchor_stations value = 8 } }
			}
			else_if = {
				limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 9 } }
				event_target:global_event_country = { set_variable = { which = ag_num_disabled_anchor_stations value = 9 } }
			}
			else_if = {
				limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 10 } }
				event_target:global_event_country = { set_variable = { which = ag_num_disabled_anchor_stations value = 10 } }
			}
		}
		fromfromfrom = { save_event_target_as = ag_ancient_wandering_ship_killer_fleet }
		every_country = {
			limit = { NOT = { is_same_value = root.from } }
			country_event = { id = ag_wanderer.83 }
		}
		every_country = {
			if = {
				limit = { has_modifier = ag_ancient_wandering_ship_weakness }
				remove_modifier = "ag_ancient_wandering_ship_weakness"
			}
			if = {
				limit = { has_country_flag = ag_has_ancient_wandering_ship_weakness }
				remove_country_flag = ag_has_ancient_wandering_ship_weakness
			}
			if = {
				limit = { has_special_project = ag_find_ancient_wandering_ship_weakness }
				abort_special_project = {
					type = "ag_find_ancient_wandering_ship_weakness"
					location = capital_scope
				}
			}
		}
	}
}
country_event = {
	id = ag_wanderer.82
	title = "ag_wanderer.82.name"
	desc = "ag_wanderer.82.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_space_battle
	location = event_target:ag_ancient_wandering_ship_killer_fleet.solar_system
	
	is_triggered_only = yes
	
	trigger = { NOT = { has_country_flag = ag_wanderer_82_fired } }
	immediate = {
		set_country_flag = ag_wanderer_82_fired
		event_target:ag_ancient_wandering_ship_killer_fleet.solar_system = { save_event_target_as = ag_target_system }
	}
	
	option = {
		name = "ag_wanderer.82.a"
		enable_special_project = {
			name = ag_capture_wandering_ship
			location = event_target:ag_ancient_wandering_ship_debris
			owner = root
		}
	}
	option = {
		name = "ag_wanderer.82.b"
		if = {
			limit = { has_event_chain = ag_ancient_anchor_station_chain }
			remove_point_of_interest = ag_ancient_anchor_station_1
			remove_point_of_interest = ag_ancient_anchor_station_2
			remove_point_of_interest = ag_ancient_anchor_station_3
			remove_point_of_interest = ag_ancient_anchor_station_4
			remove_point_of_interest = ag_ancient_anchor_station_5
			remove_point_of_interest = ag_ancient_anchor_station_6
			remove_point_of_interest = ag_ancient_anchor_station_7
			remove_point_of_interest = ag_ancient_anchor_station_8
			remove_point_of_interest = ag_ancient_anchor_station_9
			remove_point_of_interest = ag_ancient_anchor_station_10
			end_event_chain = ag_ancient_anchor_station_chain
			if = {
				limit = { has_event_chain = ag_ancient_wandering_ship_tracker }
				remove_point_of_interest = ag_ancient_wandering_ship_poi
				if = {
					limit = { has_special_project = "ag_stop_tracking_wandering_ship" }
					abort_special_project = { type = "ag_stop_tracking_wandering_ship" }
				}
				if = {
					limit = { has_special_project = "ag_tracking_wandering_ship" }
					abort_special_project = { type = "ag_tracking_wandering_ship" }
				}
				end_event_chain = ag_ancient_wandering_ship_tracker
			}
		}
		add_resource = {
			sr_living_metal = 8000
			nanites = 4500
			sr_dark_matter = 500
			minor_artifacts = 25
		}
		locked_random_list = {
			80 = { }
			20 = {
				modifier = {
					factor = 0
					OR = {
						has_technology = tech_ag_ship_hull_upgrade
						has_tech_option = tech_ag_ship_hull_upgrade
					}
				}
				add_research_option = tech_ag_ship_hull_upgrade
				add_tech_progress = {
					tech = tech_ag_ship_hull_upgrade
					progress = 0.10
				}
			}
		}
		hidden_effect = {
			every_country = {
				limit = { NOT = { is_same_value = root } }
				if = {
					limit = { has_event_chain = ag_ancient_anchor_station_chain }
					remove_point_of_interest = ag_ancient_anchor_station_1
					remove_point_of_interest = ag_ancient_anchor_station_2
					remove_point_of_interest = ag_ancient_anchor_station_3
					remove_point_of_interest = ag_ancient_anchor_station_4
					remove_point_of_interest = ag_ancient_anchor_station_5
					remove_point_of_interest = ag_ancient_anchor_station_6
					remove_point_of_interest = ag_ancient_anchor_station_7
					remove_point_of_interest = ag_ancient_anchor_station_8
					remove_point_of_interest = ag_ancient_anchor_station_9
					remove_point_of_interest = ag_ancient_anchor_station_10
					end_event_chain = ag_ancient_anchor_station_chain
				}
				if = {
					limit = { has_event_chain = ag_ancient_wandering_ship_tracker }
					remove_point_of_interest = ag_ancient_wandering_ship_poi
					if = {
						limit = { has_special_project = "ag_stop_tracking_wandering_ship" }
						abort_special_project = { type = "ag_stop_tracking_wandering_ship" }
					}
					if = {
						limit = { has_special_project = "ag_tracking_wandering_ship" }
						abort_special_project = { type = "ag_tracking_wandering_ship" }
					}
					end_event_chain = ag_ancient_wandering_ship_tracker
				}
			}
		}
	}
}
country_event = {
	id = ag_wanderer.83
	title = "ag_wanderer.83.name"
	desc = "ag_wanderer.83.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_ancient_wandering_ship_killer_fleet.solar_system
	
	is_triggered_only = yes
	
	trigger = { NOT = { has_country_flag = ag_wanderer_83_fired } }
	immediate = { set_country_flag = ag_wanderer_83_fired }
	
	option = {
		name = "ag_wanderer.83.a"
	}
}
# Successfully controlled wandering ship, notification for owner
ship_event = {
	id = ag_wanderer.84
	title = "ag_wanderer.84.name"
	desc = "ag_wanderer.84.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_dyson_sphere_build_complete
	location = root
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.84.a"
		custom_tooltip = "ag_wanderer.84.a.tooltip"
		owner = {
			if = {
				limit = { has_event_chain = ag_ancient_anchor_station_chain }
				remove_point_of_interest = ag_ancient_anchor_station_1
				remove_point_of_interest = ag_ancient_anchor_station_2
				remove_point_of_interest = ag_ancient_anchor_station_3
				remove_point_of_interest = ag_ancient_anchor_station_4
				remove_point_of_interest = ag_ancient_anchor_station_5
				remove_point_of_interest = ag_ancient_anchor_station_6
				remove_point_of_interest = ag_ancient_anchor_station_7
				remove_point_of_interest = ag_ancient_anchor_station_8
				remove_point_of_interest = ag_ancient_anchor_station_9
				remove_point_of_interest = ag_ancient_anchor_station_10
				end_event_chain = ag_ancient_anchor_station_chain
			}
			if = {
				limit = { has_event_chain = ag_ancient_wandering_ship_tracker }
				remove_point_of_interest = ag_ancient_wandering_ship_poi
				if = {
					limit = { has_special_project = "ag_stop_tracking_wandering_ship" }
					abort_special_project = { type = "ag_stop_tracking_wandering_ship" }
				}
				if = {
					limit = { has_special_project = "ag_tracking_wandering_ship" }
					abort_special_project = { type = "ag_tracking_wandering_ship" }
				}
				end_event_chain = ag_ancient_wandering_ship_tracker
			}
		}
		hidden_effect = {
			set_global_flag = ag_ancient_wandering_ship_destroyed
			event_target:ag_ancient_wanderer_country = {
				destroy_country = yes
			}
			event_target:global_event_country = {
				set_variable = { which = ag_num_disabled_anchor_stations value = 0 }
			}
			ag_ancient_wandering_ship_player_spawn = {
				ag_unlock_ship = no
				ag_owner = root.owner
				ag_location = event_target:ag_ancient_wandering_ship_debris
			}
			solar_system = {
				every_system_ambient_object = {
					limit = { has_ambient_object_flag = ag_ancient_wandering_ship_debris }
					destroy_ambient_object = this
				}
			}
		}
	}
}
# Successfully controlled wandering ship, notification for others
country_event = {
	id = ag_wanderer.85
	title = "ag_wanderer.85.name"
	desc = "ag_wanderer.85.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_target_country.capital_scope
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.85.a"
		if = {
			limit = { has_event_chain = ag_ancient_anchor_station_chain }
			remove_point_of_interest = ag_ancient_anchor_station_1
			remove_point_of_interest = ag_ancient_anchor_station_2
			remove_point_of_interest = ag_ancient_anchor_station_3
			remove_point_of_interest = ag_ancient_anchor_station_4
			remove_point_of_interest = ag_ancient_anchor_station_5
			remove_point_of_interest = ag_ancient_anchor_station_6
			remove_point_of_interest = ag_ancient_anchor_station_7
			remove_point_of_interest = ag_ancient_anchor_station_8
			remove_point_of_interest = ag_ancient_anchor_station_9
			remove_point_of_interest = ag_ancient_anchor_station_10
			end_event_chain = ag_ancient_anchor_station_chain
		}
		if = {
			limit = { has_event_chain = ag_ancient_wandering_ship_tracker }
			remove_point_of_interest = ag_ancient_wandering_ship_poi
			if = {
				limit = { has_special_project = "ag_stop_tracking_wandering_ship" }
				abort_special_project = { type = "ag_stop_tracking_wandering_ship" }
			}
			if = {
				limit = { has_special_project = "ag_tracking_wandering_ship" }
				abort_special_project = { type = "ag_tracking_wandering_ship" }
			}
			end_event_chain = ag_ancient_wandering_ship_tracker
		}
	}
}
# Failed to control wandering ship, notification for project owner
country_event = {
	id = ag_wanderer.86
	title = "ag_wanderer.86.name"
	desc = "ag_wanderer.86.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = {
				NOT = { is_same_value = event_target:ag_ancient_wanderer_country }
				is_hostile = event_target:ag_ancient_wanderer_country
			}
			set_faction_hostility = {
				target = event_target:ag_ancient_wanderer_country
				set_hostile = no
				set_neutral = yes
				set_friendly = no
			}
		}
		event_target:ag_ancient_wandering_ship_debris.solar_system = {
			ag_ancient_wandering_ship_spawn = {
				ag_target = event_target:ag_ancient_wandering_ship_debris
				ag_distance = -1
			}
			event_target:global_event_country = {
				event_target:ag_ancient_wandering_ship_fleet = {
					if = {
						limit = { prev = { check_variable = { which = ag_num_disabled_anchor_stations value = 1 } } }
						set_variable = { which = ag_num_disabled_anchor_stations value = 1 }
					}
					else_if = {
						limit = { prev = { check_variable = { which = ag_num_disabled_anchor_stations value = 2 } } }
						set_variable = { which = ag_num_disabled_anchor_stations value = 2 }
					}
					else_if = {
						limit = { prev = { check_variable = { which = ag_num_disabled_anchor_stations value = 3 } } }
						set_variable = { which = ag_num_disabled_anchor_stations value = 3 }
					}
					else_if = {
						limit = { prev = { check_variable = { which = ag_num_disabled_anchor_stations value = 4 } } }
						set_variable = { which = ag_num_disabled_anchor_stations value = 4 }
					}
					else_if = {
						limit = { prev = { check_variable = { which = ag_num_disabled_anchor_stations value = 5 } } }
						set_variable = { which = ag_num_disabled_anchor_stations value = 5 }
					}
					else_if = {
						limit = { prev = { check_variable = { which = ag_num_disabled_anchor_stations value = 6 } } }
						set_variable = { which = ag_num_disabled_anchor_stations value = 6 }
					}
					else_if = {
						limit = { prev = { check_variable = { which = ag_num_disabled_anchor_stations value = 7 } } }
						set_variable = { which = ag_num_disabled_anchor_stations value = 7 }
					}
					else_if = {
						limit = { prev = { check_variable = { which = ag_num_disabled_anchor_stations value = 8 } } }
						set_variable = { which = ag_num_disabled_anchor_stations value = 8 }
					}
					else_if = {
						limit = { prev = { check_variable = { which = ag_num_disabled_anchor_stations value = 9 } } }
						set_variable = { which = ag_num_disabled_anchor_stations value = 9 }
					}
					else_if = {
						limit = { prev = { check_variable = { which = ag_num_disabled_anchor_stations value = 10 } } }
						set_variable = { which = ag_num_disabled_anchor_stations value = 10 }
					}
					if = {
						limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 6 } }
						add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_1" days = -1 }
					}
					else_if = {
						limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 7 } }
						add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_2" days = -1 }
					}
					else_if = {
						limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 8 } }
						add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_3" days = -1 }
					}
					else_if = {
						limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 9 } }
						add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_4" days = -1 }
					}
					else_if = {
						limit = { check_variable = { which = ag_num_disabled_anchor_stations value = 10 } }
						add_modifier = { modifier = "ag_ancient_wandering_ship_debuff_5" days = -1 }
					}
					clear_orders = yes
					clear_fleet_actions = this
					fleet_event = { id = ag_wanderer.40 days = 2 random = 2 }
				}
				set_variable = { which = ag_num_disabled_anchor_stations value = 0 }
			}
			every_system_ambient_object = {
				limit = { has_ambient_object_flag = ag_ancient_wandering_ship_debris }
				destroy_ambient_object = this
			}
		}
	}
	
	option = {
		name = "ag_wanderer.86.a"
	}
}
# Failed to control wandering ship, notification for others
country_event = {
	id = ag_wanderer.87
	title = "ag_wanderer.87.name"
	desc = "ag_wanderer.87.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_sensor_ping
	location = event_target:ag_target_country.capital_scope
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.87.a"
	}
}

# on_ship_destroyed_victim, Give wandering ship's weakness research project if player lost too many ships
country_event = {
	id = ag_wanderer.91
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			is_country_type = ag_ancient_wanderer_country
			has_country_flag = ag_ancient_wanderer_country
		}
		is_ai = no
		NOR = {
			has_global_flag = ag_ancient_wandering_ship_destroyed
			has_country_flag = ag_has_ancient_wandering_ship_weakness
		}
		fromfromfrom.fleet = {
			check_variable = {
				which = ag_num_disabled_anchor_stations
				value > 0
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				check_variable = {
					which = ag_ancient_wandering_ship_guardian_killcount
					value < 1
				}
			}
			set_variable = {
				which = ag_ancient_wandering_ship_guardian_killcount
				value = 1
			}
		}
		fromfrom = {
			root = {
				ag_hostile_kill_counter = {
					ag_variable_name = ag_ancient_wandering_ship_guardian_killcount
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = ag_ancient_wandering_ship_guardian_killcount
					value > 512
				}
				NOR = {
					has_global_flag = ag_ancient_wandering_ship_destroyed
					has_country_flag = ag_has_ancient_wandering_ship_weakness
				}
			}
			set_variable = {
				which = ag_ancient_wandering_ship_guardian_killcount
				value = 512
			}
			random_list = {
				25 = {
					country_event = { id = ag_wanderer.92 days = 30 random = 30 }
					set_country_flag = ag_has_ancient_wandering_ship_weakness
				}
				75 = { }
			}
		}
	}
}
country_event = {
	id = ag_wanderer.92
	title = "ag_wanderer.92.name"
	desc = "ag_wanderer.92.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes

	trigger = {
		NOT = {
			has_global_flag = ag_ancient_wandering_ship_destroyed
		}
	}
	
	option = {
		name = "ag_wanderer.92.a"
		enable_special_project = {
			name = "ag_find_ancient_wandering_ship_weakness"
			location = capital_scope
			owner = root
		}
	}
	option = {
		name = "ag_wanderer.92.b"
		add_resource = { influence = 120 }
	}
}
country_event = {
	id = ag_wanderer.93
	title = "ag_wanderer.93.name"
	desc = "ag_wanderer.93.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	
	is_triggered_only = yes

	option = {
		name = "ag_wanderer.93.a"
		if = {
			limit = {
				NOT = {
					has_modifier = ag_ancient_wandering_ship_weakness
				}
			}
			add_modifier = {
				modifier = ag_ancient_wandering_ship_weakness
				days = -1
			}
		}
	}
}
# on_ship_destroyed_victim, Give anchor station's weakness research project if player lost too many ships
country_event = {
	id = ag_wanderer.94
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			is_country_type = ag_ancient_anchor_station_country
			has_country_flag = ag_ancient_anchor_station_country
		}
		is_ai = no
		NOT = { has_country_flag = ag_has_ancient_anchor_station_weakness }
	}
	
	immediate = {
		if = {
			limit = {
				check_variable = {
					which = ag_ancient_anchor_station_guardian_killcount
					value < 1
				}
			}
			set_variable = {
				which = ag_ancient_anchor_station_guardian_killcount
				value = 1
			}
		}
		fromfrom = {
			root = {
				ag_hostile_kill_counter = {
					ag_variable_name = ag_ancient_anchor_station_guardian_killcount
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = ag_ancient_anchor_station_guardian_killcount
					value > 512
				}
				NOR = {
					has_global_flag = ag_ancient_anchor_station_destroyed
					has_country_flag = ag_has_ancient_anchor_station_weakness
				}
			}
			set_variable = {
				which = ag_ancient_anchor_station_guardian_killcount
				value = 512
			}
			random_list = {
				25 = {
					country_event = { id = ag_wanderer.95 days = 30 random = 30 }
					set_country_flag = ag_has_ancient_anchor_station_weakness
				}
				75 = { }
			}
		}
	}
}
country_event = {
	id = ag_wanderer.95
	title = "ag_wanderer.95.name"
	desc = "ag_wanderer.95.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.95.a"
		enable_special_project = {
			name = "ag_find_ancient_anchor_station_weakness"
			location = capital_scope
			owner = root
		}
	}
	option = {
		name = "ag_wanderer.95.b"
		add_resource = { influence = 120 }
	}
}
country_event = {
	id = ag_wanderer.96
	title = "ag_wanderer.96.name"
	desc = "ag_wanderer.96.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	
	is_triggered_only = yes

	option = {
		name = "ag_wanderer.96.a"
		if = {
			limit = {
				NOT = {
					has_modifier = ag_ancient_anchor_station_weakness
				}
			}
			add_modifier = {
				modifier = ag_ancient_anchor_station_weakness
				days = -1
			}
		}
	}
}

# Disable ancient security system
country_event = {
	id = ag_wanderer.101
	title = "ag_wanderer.101.name"
	desc = "ag_wanderer.101.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	
	mean_time_to_happen = {
		years = 5
		modifier = { factor = 0.5 has_country_flag = ag_has_ancient_code }
	}
	
	trigger = {
		NOR = {
			has_country_flag = ag_wandering_ships_unlocked
			has_country_flag = ag_wanderer_101_fired
		}
		any_owned_ship = { is_ship_size = ag_ancient_wandering_ship_0 }
	}
	
	immediate = { set_country_flag = ag_wanderer_101_fired }
	
	option = {
		name = "ag_wanderer.101.a"
		custom_tooltip = "ag_wanderer.101.a.tooltip"
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = ag_wandering_ship_unlock_project_flag } }
				set_country_flag = ag_wandering_ship_unlock_project_flag
				random_list = {
					25 = { ag_give_research_project = { ag_project_id = @ag_wandering_ship_unlock_project_id ag_progress = 29 } }
					25 = { ag_give_research_project = { ag_project_id = @ag_wandering_ship_unlock_project_id ag_progress = 23 } }
					25 = { ag_give_research_project = { ag_project_id = @ag_wandering_ship_unlock_project_id ag_progress = 19 } }
					25 = { ag_give_research_project = { ag_project_id = @ag_wandering_ship_unlock_project_id ag_progress = 17 } }
				}
			}
		}
		if = {
			limit = { is_ai = yes }
			country_event = { id = ag_wanderer.102 days = 1800 }
		}
		# enable_special_project = {
		# 	name = "ag_wandering_ships_unlock"
		# 	location = capital_scope
		# 	owner = root
		# }
		ai_chance = {
			factor = 1000
		}
	}
	option = {
		name = "ag_wanderer.101.b"
		add_resource = { influence = 80 }
		ai_chance = {
			factor = 0
		}
	}
}
country_event = {
	id = ag_wanderer.102
	title = "ag_wanderer.102.name"
	desc = "ag_wanderer.102.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = ag_wandering_ships_unlocked
		set_country_flag = ag_has_ancient_code
		country_event = { id = ag_wanderer.103 days = 0 random = 60 }
	}
	
	option = {
		name = "ag_wanderer.102.a"
	}
}

# Upgrade ships(Hidden)
country_event = {
    id = ag_wanderer.103
    hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = ag_wandering_ships_unlocked
	}
	
	immediate = {
		set_country_flag = ag_wanderer_103_fired
		while = {
			limit = {
				any_owned_ship = {
					is_ship_size = ag_ancient_wandering_ship_0
				}
			}
			random_owned_ship = {
				limit = {
					is_ship_size = ag_ancient_wandering_ship_0
				}
				ag_spawn_buff_effect = { ag_color = red ag_scale = xl }
				fleet = {
					if = {
						limit = { exists = leader }
						leader = {
							save_global_event_target_as = ag_target_leader_on_fleet
							prev = { save_global_event_target_as = ag_target_fleet_swap }
							unassign_leader = this
						}
					}
					ag_create_ancient_wandering_ship_player = { ag_unlock_ship = yes ag_owner = $ag_owner$ }
				}
				delete_ship = this
				if = {
					limit = { exists = event_target:ag_target_fleet_swap }
					event_target:ag_target_fleet_swap = {
						assign_leader = event_target:ag_target_leader_on_fleet
					}
					clear_global_event_target = ag_target_fleet_swap
					clear_global_event_target = ag_target_leader_on_fleet
				}
			}
		}
	}
}

# Reverse engineering on ancient ship
country_event = {
	id = ag_wanderer.111
	title = "ag_wanderer.111.name"
	desc = "ag_wanderer.111.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	
	mean_time_to_happen = {
		years = 5
	}
	
	trigger = {
		NOT = { has_country_flag = ag_wanderer_111_fired }
		has_country_flag = ag_wandering_ships_unlocked
		has_country_flag = ag_known_construction_section
		OR = {
			has_technology = tech_ag_beta_station_type1
			has_technology = tech_ag_beta_station_type2
			has_technology = tech_ag_gamma_station
			has_technology = tech_ag_delta_titan
			has_technology = tech_ag_delta_platform
		}
		any_owned_ship = { has_ship_flag = ag_ancient_wandering_ship_player }
	}
	
	immediate = { set_country_flag = ag_wanderer_111_fired }
	
	option = {
		name = "ag_wanderer.111.a"
		custom_tooltip = "ag_wanderer.111.a.tooltip"
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = ag_reverse_engineering_wandering_ship_project_flag } }
				set_country_flag = ag_reverse_engineering_wandering_ship_project_flag
				random_list = {
					25 = { ag_give_research_project = { ag_project_id = @ag_reverse_engineering_wandering_ship_project_id ag_progress = 13 } }
					25 = { ag_give_research_project = { ag_project_id = @ag_reverse_engineering_wandering_ship_project_id ag_progress = 11 } }
					25 = { ag_give_research_project = { ag_project_id = @ag_reverse_engineering_wandering_ship_project_id ag_progress = 7 } }
					25 = { ag_give_research_project = { ag_project_id = @ag_reverse_engineering_wandering_ship_project_id ag_progress = 5 } }
				}
			}
		}
		if = {
			limit = { is_ai = yes }
			country_event = { id = ag_wanderer.113 days = 1800 }
		}
		ai_chance = { factor = 1000 }
	}
	option = {
		name = "ag_wanderer.111.b"
		add_resource = { influence = 80 }
		ai_chance = { factor = 0 }
	}
}
country_event = {
	id = ag_wanderer.112
	title = "ag_wanderer.112.name"
	desc = "ag_wanderer.112.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	option = {
		name = "ag_wanderer.112.a"
		if = {
			limit = {
				NOR = {
					has_technology = tech_ag_ancient_wandering_ship
					has_tech_option = tech_ag_ancient_wandering_ship
				}
			}
			add_research_option = tech_ag_ancient_wandering_ship
			add_tech_progress = {
				tech = tech_ag_ancient_wandering_ship
				progress = 0.10
			}
		}
	}
}
country_event = {
	id = ag_wanderer.113
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ai = yes }
	immediate = { give_technology = { tech = tech_ag_ancient_wandering_ship } }
}

# Ancient Ship Megastructure
# Stage 1/6
country_event = {
	id = ag_wanderer.121
	title = "ag_wanderer.121.name"
	desc = "ag_wanderer.121.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_ringworld_build_start
	location = fromfromfrom
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.121.a" }
}
# Stage 2/6
country_event = {
	id = ag_wanderer.122
	title = "ag_wanderer.122.name"
	desc = "ag_wanderer.122.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_upgrade_frame
	location = fromfromfrom
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.122.a" }
}
# Stage 3/6
country_event = {
	id = ag_wanderer.123
	title = "ag_wanderer.123.name"
	desc = "ag_wanderer.123.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_upgrade_frame
	location = fromfromfrom
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.123.a" }
}
# Stage 4/6
country_event = {
	id = ag_wanderer.124
	title = "ag_wanderer.124.name"
	desc = "ag_wanderer.124.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_upgrade_frame
	location = fromfromfrom
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.124.a" }
}
# Stage 5/6
country_event = {
	id = ag_wanderer.125
	title = "ag_wanderer.125.name"
	desc = "ag_wanderer.125.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_upgrade_frame
	location = fromfromfrom
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.125.a" }
}
# Stage 6/6
country_event = {
	id = ag_wanderer.126
	title = "ag_wanderer.126.name"
	desc = "ag_wanderer.126.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_m_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_complete
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.126.a" }
}
# Ancient Ship, stage 1/6 (others)
country_event = {
	id = ag_wanderer.127
	title = "ag_wanderer.127.name"
	desc = "ag_wanderer.127.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_mega_structure_other_empire_build_complete
	location = fromfromfrom
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.127.a" }
}
# Ancient Ship, stage 6/6 (others)
country_event = {
	id = ag_wanderer.128
	title = "ag_wanderer.128.name"
	desc = "ag_wanderer.128.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_s_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_mega_structure_other_empire_build_complete
	
	is_triggered_only = yes
	
	option = { name = "ag_wanderer.128.a" }
}

country_event = {
	id = ag_wanderer.131
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		if = {
			limit = {
				exists = event_target:ag_ancient_wanderer_country
				is_hostile = event_target:ag_ancient_wanderer_country
				NAND = {
					exists = event_target:ag_ancient_wandering_ship_fleet
					event_target:ag_ancient_wandering_ship_fleet = { is_in_combat = yes }
					any_owned_fleet = {
						is_in_combat = yes
						exists = solar_system
						solar_system = { is_same_value = event_target:ag_ancient_wandering_ship_fleet.solar_system }
					}
				}
			}
			set_faction_hostility = {
				target = event_target:ag_ancient_wanderer_country
				set_hostile = no
				set_neutral = yes
				set_friendly = no
			}
		}
	}
}


# Unlocks Ancient Ship's ability
# country_event = {
# 	id = ag_wanderer.141
# 	title = "ag_wanderer.141.name"
# 	desc = "ag_wanderer.141.desc"
# 	diplomatic = yes
# 	custom_gui = "ag_ancient_event_window"
# 	custom_gui_option = "ag_ancient_event_option"
# 	picture_event_data = { room = ag_event_ancient_AI_room }
# 	show_sound = event_mystic_reveal
	
# 	mean_time_to_happen = { years = 6 }
	
# 	trigger = {
# 		NOT = { has_country_flag = ag_wanderer_141_fired }
# 		has_technology = tech_ag_ancient_wandering_ship
# 		any_owned_ship = { is_ship_size = ag_ancient_wandering_ship_1 }
# 	}
	
# 	immediate = { set_country_flag = ag_wanderer_141_fired }
	
# 	option = {
# 		name = "ag_wanderer.141.a"
# 		enable_special_project = {
# 			name = "ag_wandering_ship_ability_unlock"
# 			location = capital_scope
# 			owner = root
# 		}
# 		ai_chance = { factor = 1000 }
# 	}
# 	option = {
# 		name = "ag_wanderer.141.b"
# 		add_resource = { influence = 80 }
# 		ai_chance = { factor = 0 }
# 	}
# }
# country_event = {
# 	id = ag_wanderer.142
# 	title = "ag_wanderer.142.name"
# 	desc = "ag_wanderer.142.desc"
# 	diplomatic = yes
# 	custom_gui = "ag_ancient_event_s_window"
# 	custom_gui_option = "ag_ancient_event_s_option"
# 	picture_event_data = { room = ag_event_ancient_AI_room }
# 	show_sound = event_mystic_reveal
	
# 	is_triggered_only = yes
	
# 	immediate = {
# 		set_country_flag = ag_wandering_ship_ability_unlocked
# 		every_owned_ship = {
# 			limit = { is_ship_size = ag_ancient_wandering_ship_1 }
# 			ag_set_disable_at_health = { ag_value = 0.05 }
# 		}
# 	}
	
# 	option = { name = "ag_wanderer.142.a" }
# }
# ship_event = {
# 	id = ag_wanderer.143
# 	hide_window = yes
	
# 	is_triggered_only = yes
	
# 	trigger = { is_ship_size = ag_ancient_wandering_ship_1 }
	
# 	immediate = {
# 		if = {
# 			limit = {
# 				owner = { has_country_flag = ag_wandering_ship_ability_unlocked }
# 				NOT = { has_ship_flag = ag_wandering_ship_self_repair_cooldown }
# 			}
# 			set_timed_ship_flag = {
# 				flag = ag_wandering_ship_self_repair_cooldown
# 				days = 180
# 			}
# 			save_event_target_as = ag_wandering_ship_loc
# 			repair_ship = yes
# 			set_disabled = no
# 			ag_spawn_buff_effect = { ag_color = red ag_scale = l }
# 			add_modifier = { modifier = "ag_wandering_ship_power" days = 30 }
# 			owner = { country_event = { id = ag_wanderer.144 } }
# 			ship_event = { id = ag_wanderer.145 days = 30 }
# 		}
# 		else = {
# 			ag_set_disable_at_health = { ag_value = -1 }
# 			set_disabled = no
# 			ship_event = { id = ag_wanderer.147 days = 60 }
# 		}
# 	}
# }
# country_event = {
# 	id = ag_wanderer.144
# 	title = "ag_wanderer.144.name"
# 	desc = "ag_wanderer.144.desc"
# 	diplomatic = yes
# 	custom_gui = "ag_ancient_event_s_window"
# 	custom_gui_option = "ag_ancient_event_s_option"
# 	picture_event_data = { room = ag_event_small_space_battle_room }
# 	show_sound = event_yellow_alert
# 	location = event_target:ag_wandering_ship_loc
	
# 	is_triggered_only = yes

# 	option = {
# 		name = "ag_wanderer.144.a"
# 	}
# }
# ship_event = {
# 	id = ag_wanderer.145
# 	hide_window = yes
	
# 	is_triggered_only = yes
	
# 	trigger = { exists = this }
	
# 	immediate = {
# 		random_list = {
# 			50 = { }
# 			50 = {
# 				add_modifier = {
# 					modifier = "ag_wandering_ship_cooldown_debuff"
# 					days = 30
# 				}
# 				owner = {
# 					country_event = { id = ag_wanderer.146 }
# 				}
# 			}
# 		}
# 	}
# }
# country_event = {
# 	id = ag_wanderer.146
# 	title = "ag_wanderer.146.name"
# 	desc = "ag_wanderer.146.desc"
# 	diplomatic = yes
# 	custom_gui = "ag_ancient_event_s_window"
# 	custom_gui_option = "ag_ancient_event_s_option"
# 	picture_event_data = { room = ag_event_ancient_AI_room }
# 	show_sound = event_yellow_alert
# 	location = event_target:ag_wandering_ship_loc
	
# 	is_triggered_only = yes

# 	option = {
# 		name = "ag_wanderer.146.a"
# 	}
# }
# ship_event = {
# 	id = ag_wanderer.147
# 	hide_window = yes
# 	is_triggered_only = yes
# 	trigger = { exists = this }
# 	immediate = { ag_set_disable_at_health = { ag_value = 0.10 } }
# }

country_event = {
	id = ag_wanderer.151
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		set_country_flag = ag_tracks_wandering_ship
		if = {
			limit = { NOT = { has_event_chain = "ag_ancient_wandering_ship_tracker" } }
			begin_event_chain = {
				event_chain = "ag_ancient_wandering_ship_tracker"
				target = root
			}
		}
		if = {
			limit = {
				exists = event_target:ag_ancient_wandering_ship_fleet
				event_target:ag_ancient_wandering_ship_fleet = { exists = solar_system }
			}
			create_point_of_interest = {
				id = ag_ancient_wandering_ship_poi
				name = "ag_ancient_wandering_ship_poi"
				desc = "ag_ancient_wandering_ship_poi_desc"
				event_chain = ag_ancient_wandering_ship_tracker
				location = event_target:ag_ancient_wandering_ship_fleet.solar_system
			}
		}
		if = {
			limit = { NOT = { has_special_project = ag_stop_tracking_wandering_ship } }
			enable_special_project = {
				name = "ag_stop_tracking_wandering_ship"
				owner = root
			}
		}
	}
	after = { abort_special_project = { type = "ag_tracking_wandering_ship" } }
}
country_event = {
	id = ag_wanderer.152
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		remove_country_flag = ag_tracks_wandering_ship
		if = {
			limit = { NOT = { has_event_chain = "ag_ancient_wandering_ship_tracker" } }
			begin_event_chain = {
				event_chain = "ag_ancient_wandering_ship_tracker"
				target = root
			}
		}
		remove_point_of_interest = ag_ancient_wandering_ship_poi
		if = {
			limit = { NOT = { has_special_project = ag_tracking_wandering_ship } }
			enable_special_project = {
				name = "ag_tracking_wandering_ship"
				owner = root
			}
		}
	}
	after = { abort_special_project = { type = "ag_stop_tracking_wandering_ship" } }
}

event = {
	id = ag_wanderer.1000
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	trigger = { NOT = { has_global_flag = ag_wanderer_ship_spawned } exists = event_target:ag_ancient_wandering_ship_fleet }
	immediate = { set_global_flag = ag_wanderer_ship_spawned }
}
