namespace = ag_beta

# Hidden, Spawn the Beta Area
country_event = {
    id = ag_beta.1
    hide_window = yes
	is_triggered_only = yes
	
    immediate = {
		ag_spawn_ancient_system = { ag_system_to_spawn = "ag_ancient_beta_init" }
		ag_spawned_system_effect = yes
		create_point_of_interest = {
			id = ag_beta_area
			name = "ag_beta_area"
			desc = "ag_beta_area_desc"
			event_chain = ag_hidden_system_chain
			location = event_target:ag_ancient_beta_star
		}
		random_system = {
			limit = { has_star_flag = ag_ancient_beta_system }
			random_list = {
				25 = { ag_add_extra_hyperlane = { ag_num = 2 } }
				25 = { ag_add_extra_hyperlane = { ag_num = 3 } }
				25 = { ag_add_extra_hyperlane = { ag_num = 4 } }
				25 = { ag_add_extra_hyperlane = { ag_num = 5 } }
			}
			reroll_random = yes
			ag_spawned_system_hyperlane_fixup = yes
		}
    }
	
	after = { hidden_effect = {
		every_country = {
			limit = { has_special_project = ag_located_beta_area }
			abort_special_project = {
				type = "ag_located_beta_area"
				location = capital_scope
			}
		}
	} }
}

# on_entering_system_fleet, Notification for entering the Beta Area first time
fleet_event = {
	id = ag_beta.2
	title = "ag_beta.2.name"
	desc = "ag_beta.2.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ruined_system_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_star_flag = ag_ancient_beta_system
		}
		owner = {
			is_ai = no
			NOT = {
				has_country_flag = ag_beta_area_entered
			}
		}
		NOR = {
			has_global_flag = ag_beta_ringworld_unlocked
			any_country = {
				has_special_project = ag_beta_ringworld_project
			}
		}
	}
	
    immediate = {
		owner = {
			set_country_flag = ag_beta_area_entered
			ag_refresh_ancient_system_poi = { ag_system_id = ag_beta_area }
		}
	}
	
	option = {
		name = "ag_beta.2.a"
		owner = {
			enable_special_project = {
				name = "ag_beta_ringworld_project"
				location = event_target:ag_ancient_beta_shielded_world
				owner = root.owner
			}
		}
	}
	option = {
		name = "ag_beta.2.b"
		custom_tooltip = "ag_beta.2.b.tooltip"
		owner = {
			add_resource = { influence = @ag_end_event_influence_large }
		}
	}
}

# Special Project completed, unlock ringworld
ship_event = {
	id = ag_beta.3
	title = "ag_beta.3.name"
	desc = "ag_beta.3.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_tropical_planet_room }
	show_sound = event_power_down
	location = root
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = ag_beta_ringworld_unlocked
		event_target:ag_ancient_beta_shielded_world = {
			ag_change_pc = { ag_planet_class = pc_ag_ringworld_tropical }
			ag_set_ancient_ringworld = {
				ag_picture = pc_ag_ringworld_tropical
				ag_color = red
				ag_type = habitable
				ag_surface_type = tropical_03
				ag_generate_ruins = yes
			}
			add_modifier = {
				modifier = "ag_atmospheric_aphrodisiac_0"
				days = -1
			}
			while = {
				count = 4
				add_deposit = ag_beta_dense_jungle_deposit_ringworld
			}
		}
	}
	
	option = {
		name = "ag_beta.3.a"
	}
	option = {
		name = "ag_beta.3.b"
	}
}

# on_colonized, Colonized Beta Area's ringworld
planet_event = {
	id = ag_beta.4
	title = "ag_beta.4.name"
	desc = "ag_beta.4.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_tropical_planet_room }
	location = event_target:ag_ancient_beta_shielded_world
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		is_same_value = event_target:ag_ancient_beta_shielded_world
	}
	
	option = {
		name = "ag_beta.4.a"
	}
}

# on_blocker_cleared, create Ancient Archive
planet_event = {
	id = ag_beta.5
	title = "ag_beta.5.name"
	desc = "ag_beta.5.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_alien_ruins_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_ancient_beta_shielded_world
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		is_same_value = event_target:ag_ancient_beta_shielded_world
		NOT = { has_building = ag_ancient_beta_archive }
		from = { is_deposit_type = ag_beta_dense_jungle_deposit_ringworld }
	}

	option = {
		name = "ag_beta.5.a"
		add_building = ag_ancient_beta_archive
	}
	option = {
		name = "ag_beta.5.b"
		custom_tooltip = "ag_beta.2.b.tooltip"
		owner = {
			add_resource = {
				minerals = 200
			}
		}
	}
}

# First ancient station reactived
planet_event = {
	id = ag_beta.11
	title = "ag_beta.11.name"
	desc = "ag_beta.11.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_yellow_alert
	location = root
	
	fire_only_once = yes
	mean_time_to_happen = {
		years = 3
	}
	
	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}
	trigger = {
		exists = event_target:ag_ancient_beta_shielded_world
		is_same_value = event_target:ag_ancient_beta_shielded_world
		has_building = ag_ancient_beta_archive
		ag_has_researcher = yes
	}

	immediate = {
		set_planet_flag = ag_ancient_beta_station_1_activated
		add_modifier = {
			modifier = ag_ancient_beta_station_1_activated
			days = -1
		}
		solar_system = {
			random_ambient_object = {
				limit = {
					has_ambient_object_flag = ag_beta_station_1
				}
				destroy_ambient_object = this
			}
			create_ambient_object = {
				type = "ag_beta_station_type1_1_object"
			}
			last_created_ambient_object = {
				set_location = {
					target = event_target:ag_ancient_beta_star
					distance = 150
					angle = 0
				}
				set_ambient_object_flag = ag_beta_station_1
				ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
			}
		}
	}
	option = {
		name = "ag_beta.11.a"
	}
	option = {
		name = "ag_beta.11.b"
	}
}
# Second ancient station reactived
planet_event = {
	id = ag_beta.12
	title = "ag_beta.12.name"
	desc = "ag_beta.12.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_yellow_alert
	location = root
	
	fire_only_once = yes
	mean_time_to_happen = {
		years = 2
	}
	
	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}
	trigger = {
		exists = event_target:ag_ancient_beta_shielded_world
		is_same_value = event_target:ag_ancient_beta_shielded_world
		has_planet_flag = ag_ancient_beta_station_1_activated
		has_building = ag_ancient_beta_archive
		ag_has_researcher = yes
	}

	immediate = {
		set_planet_flag = ag_ancient_beta_station_2_activated
		add_modifier = {
			modifier = ag_ancient_beta_station_2_activated
			days = -1
		}
		solar_system = {
			random_ambient_object = {
				limit = {
					has_ambient_object_flag = ag_beta_station_2
				}
				destroy_ambient_object = this
			}
			create_ambient_object = {
				type = "ag_beta_station_type1_1_object"
			}
			last_created_ambient_object = {
				set_location = {
					target = event_target:ag_ancient_beta_star
					distance = 150
					angle = 120
				}
				set_ambient_object_flag = ag_beta_station_2
				ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
			}
		}
	}
	option = {
		name = "ag_beta.12.a"
	}
	option = {
		name = "ag_beta.12.b"
	}
}
# Third ancient station reactived, psionic effect appears
planet_event = {
	id = ag_beta.13
	title = "ag_beta.13.name"
	desc = "ag_beta.13.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_yellow_alert
	location = root
	
	fire_only_once = yes
	mean_time_to_happen = {
		years = 1
	}
	
	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
		is_occupied_flag = no
	}
	trigger = {
		exists = event_target:ag_ancient_beta_shielded_world
		is_same_value = event_target:ag_ancient_beta_shielded_world
		has_planet_flag = ag_ancient_beta_station_2_activated
		has_building = ag_ancient_beta_archive
		ag_has_researcher = yes
	}

	immediate = {
		set_global_flag = ag_aneient_beta_psionic_effect_begins
		ag_change_shroud_type = yes
		event_target:global_event_country = {
			set_variable = { which = ag_beta_num_systems_total value = 1 }
			set_variable = { which = ag_beta_num_planets_total value = 12 }
			set_variable = { which = ag_beta_num_blockers_total value = 0 }
			set_variable = { which = ag_beta_num_victims_total value = 0 }
		}
		random_list = {
			10 = { set_timed_global_flag = { flag = ag_beta_46_locked days = 270 } }
			10 = { set_timed_global_flag = { flag = ag_beta_46_locked days = 360 } }
			10 = { set_timed_global_flag = { flag = ag_beta_46_locked days = 450 } }
			10 = { set_timed_global_flag = { flag = ag_beta_46_locked days = 540 } }
		}
		set_planet_flag = ag_ancient_beta_station_3_activated
		add_modifier = {
			modifier = ag_ancient_beta_station_3_activated
			days = -1
		}
		solar_system = {
			random_ambient_object = {
				limit = {
					has_ambient_object_flag = ag_beta_station_3
				}
				destroy_ambient_object = this
			}
			create_ambient_object = {
				type = "ag_beta_station_type1_1_object"
			}
			last_created_ambient_object = {
				set_location = {
					target = event_target:ag_ancient_beta_star
					distance = 150
					angle = 240
				}
				set_ambient_object_flag = ag_beta_station_3
				ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
			}
			ag_beta_psionic_system_effect = { ag_level = 1 }
			event_target:global_event_country = {
				country_event = { id = ag_beta.21 days = 360 random = 180 }
				country_event = { id = ag_beta.22 days = 540 random = 120 }
			}
		}
		owner = { country_event = { id = ag_beta.14 days = 30 random = 60 } }
		every_country = {
			limit = {
				NOT = {
					is_same_value = root.owner
				}
			}
			country_event = { id = ag_beta.15 days = 120 random = 30 }
		}
	}
	option = {
		name = "ag_beta.13.a"
		ag_give_psionic_theory = yes
	}
}
# Notification for psionic effect appears, to Beta Ringworld's owner
country_event = {
	id = ag_beta.14
	title = "ag_beta.14.name"
	desc = "ag_beta.14.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_burning_settlement_room }
	show_sound = event_red_alert
	location = event_target:ag_ancient_beta_shielded_world
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.14.a"
		if = {
			limit = { NOT = { has_event_chain = ag_beta_psionic_environment_chain } }
			begin_event_chain = {
				event_chain = ag_beta_psionic_environment_chain
				target = root.owner
			}
			while = {
				count = event_target:global_event_country.ag_beta_num_systems_total
				add_event_chain_counter = {
					event_chain = ag_beta_psionic_environment_chain
					counter = ag_beta_psionic_environment_systems
					amount = 1
				}
			}
			while = {
				count = event_target:global_event_country.ag_beta_num_planet_total
				add_event_chain_counter = {
					event_chain = ag_beta_psionic_environment_chain
					counter = ag_beta_psionic_environment_planets
					amount = 1
				}
			}
			while = {
				count = event_target:global_event_country.ag_beta_num_blockers_total
				add_event_chain_counter = {
					event_chain = ag_beta_psionic_environment_chain
					counter = ag_beta_psionic_environment_blockers
					amount = 1
				}
			}
			while = {
				count = event_target:global_event_country.ag_beta_num_victims_total
				add_event_chain_counter = {
					event_chain = ag_beta_psionic_environment_chain
					counter = ag_beta_psionic_environment_victims
					amount = 1
				}
			}
		}
	}
	option = {
		name = "ag_beta.14.b"
		if = {
			limit = { NOT = { has_event_chain = ag_beta_psionic_environment_chain } }
			begin_event_chain = {
				event_chain = ag_beta_psionic_environment_chain
				target = root.owner
			}
			while = {
				count = event_target:global_event_country.ag_beta_num_systems_total
				add_event_chain_counter = {
					event_chain = ag_beta_psionic_environment_chain
					counter = ag_beta_psionic_environment_systems
					amount = 1
				}
			}
			while = {
				count = event_target:global_event_country.ag_beta_num_planet_total
				add_event_chain_counter = {
					event_chain = ag_beta_psionic_environment_chain
					counter = ag_beta_psionic_environment_planets
					amount = 1
				}
			}
			while = {
				count = event_target:global_event_country.ag_beta_num_blockers_total
				add_event_chain_counter = {
					event_chain = ag_beta_psionic_environment_chain
					counter = ag_beta_psionic_environment_blockers
					amount = 1
				}
			}
			while = {
				count = event_target:global_event_country.ag_beta_num_victims_total
				add_event_chain_counter = {
					event_chain = ag_beta_psionic_environment_chain
					counter = ag_beta_psionic_environment_victims
					amount = 1
				}
			}
		}
	}
}
# Notification for psionic effect appears, to other countries
country_event = {
	id = ag_beta.15
	title = "ag_beta.15.name"
	desc = "ag_beta.15.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_news_room }
	show_sound = event_yellow_alert
	location = event_target:ag_ancient_beta_shielded_world
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.15.a"
	}
	option = {
		name = "ag_beta.15.b"
		trigger = {
			OR = {
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_machine_terminator
			}
		}
	}
}

# Psionic Effect's spreading cycle
country_event = {
	id = ag_beta.21
	hide_window = yes
	is_triggered_only = yes
	trigger = { ag_beta_psionic_effect_event_active = yes }
	immediate = {
		random_list = {
			80 = {
				every_system = {
					limit = {
						NOT = { has_star_flag = ag_beta_psionic_system_3 }
						any_neighbor_system = {
							OR = {
								has_star_flag = ag_beta_psionic_system_1
								has_star_flag = ag_beta_psionic_system_2
								has_star_flag = ag_beta_psionic_system_3
							}
							NOT = { has_star_flag = ag_psionic_inhibitor_platform_in_system }
						}
						NOT = { has_star_flag = ag_psionic_inhibitor_platform_in_system }
					}
					if = { limit = { NOT = { has_global_flag = ag_beta_psi_effect_spreaded } } set_global_flag = ag_beta_psi_effect_spreaded }
					if = {
						limit = { has_star_flag = ag_beta_psionic_system_2 }
						random_list = {
							45 = {
								random_list = {
									50 = {
										ag_beta_psionic_system_effect = { ag_level = 3 }
									}
									50 = {
										modifier = {
											factor = 0
											NAND = {
												exists = space_owner
												space_owner = { has_technology = tech_ag_psionic_signal_3 }
											}
										}
									}
								}
								reroll_random = yes
							}
							55 = { }
						}
						reroll_random = yes
					}
					else_if = {
						limit = { has_star_flag = ag_beta_psionic_system_1 }
						random_list = {
							65 = {
								random_list = {
									50 = {
										ag_beta_psionic_system_effect = { ag_level = 2 }
									}
									50 = {
										modifier = {
											factor = 0
											NAND = {
												exists = space_owner
												space_owner = { has_technology = tech_ag_psionic_signal_3 }
											}
										}
									}
								}
								reroll_random = yes
							}
							35 = { }
						}
						reroll_random = yes
					}
					else_if = {
						limit = { always = yes }
						random_list = {
							75 = {
								random_list = {
									50 = {
										ag_beta_psionic_system_effect = { ag_level = 1 }
									}
									50 = {
										modifier = {
											factor = 0
											NAND = {
												exists = space_owner
												space_owner = { has_technology = tech_ag_psionic_signal_3 }
											}
										}
									}
								}
								reroll_random = yes
							}
							25 = { }
						}
						reroll_random = yes
					}
				}
			}
			20 = { if = { limit = { NOT = { has_global_flag = ag_beta_psi_effect_spreaded } } set_global_flag = ag_beta_psi_effect_spreaded } }
		}
		reroll_random = yes
		if = {
			limit = { NOT = { has_global_flag = ag_beta_psi_effect_spreaded } }
			random_system = {
				limit = {
					NOR = {
						has_star_flag = ag_beta_psionic_system_1
						has_star_flag = ag_beta_psionic_system_2
						has_star_flag = ag_beta_psionic_system_3
						has_star_flag = ag_psionic_inhibitor_platform_in_system
					}
				}
				random_list = {
					50 = { ag_beta_psionic_system_effect = { ag_level = 1 } }
					50 = {
						modifier = {
							factor = 0
							NAND = {
								exists = space_owner
								space_owner = { has_technology = tech_ag_psionic_signal_3 }
							}
						}
					}
				}
				reroll_random = yes
			}
		}
		else = { remove_global_flag = ag_beta_psi_effect_spreaded }
		event_target:global_event_country = { if = {
			limit = { OR = { is_variable_set = ag_beta_num_systems_temp is_variable_set = ag_beta_num_planets_temp } }
			change_variable = { which = ag_beta_num_systems_total value = ag_beta_num_systems_temp }
			change_variable = { which = ag_beta_num_planets_total value = ag_beta_num_planets_temp }
			every_country = {
				limit = { has_event_chain = ag_beta_psionic_environment_chain }
				if = {
					limit = { prev = { is_variable_set = ag_beta_num_systems_temp } }
					while = {
						count = prev.ag_beta_num_systems_temp
						add_event_chain_counter = {
							event_chain = ag_beta_psionic_environment_chain
							counter = ag_beta_psionic_environment_systems
							amount = 1
						}
					}
					prev = { clear_variable = ag_beta_num_systems_temp }
				}
				if = {
					limit = { prev = { is_variable_set = ag_beta_num_planets_temp } }
					while = {
						count = prev.ag_beta_num_planets_temp
						add_event_chain_counter = {
							event_chain = ag_beta_psionic_environment_chain
							counter = ag_beta_psionic_environment_planets
							amount = 1
						}
					}
					prev = { clear_variable = ag_beta_num_planets_temp }
				}
			}
		} }
		if = {
			limit = { any_playable_country = {
				is_ai = no
				OR = {
					AND = {
						exists = capital_scope
						capital_scope = { OR = {
							has_modifier = "ag_atmospheric_aphrodisiac_1"
							has_modifier = "ag_atmospheric_aphrodisiac_2"
							has_modifier = "ag_atmospheric_aphrodisiac_3"
						} }
					}
					count_owned_planet = {
						count > 2
						limit = {
							is_sector_capital = yes
							is_capital = no
							OR = {
								has_modifier = "ag_atmospheric_aphrodisiac_1"
								has_modifier = "ag_atmospheric_aphrodisiac_2"
								has_modifier = "ag_atmospheric_aphrodisiac_3"
							}
						}
					}
				}
			} }
			every_playable_country = {
				limit = {
					is_ai = no
					OR = {
						AND = {
							exists = capital_scope
							capital_scope = { OR = {
								has_modifier = "ag_atmospheric_aphrodisiac_1"
								has_modifier = "ag_atmospheric_aphrodisiac_2"
								has_modifier = "ag_atmospheric_aphrodisiac_3"
							} }
						}
						count_owned_planet = {
							count > 2
							limit = {
								is_sector_capital = yes
								is_capital = no
								OR = {
									has_modifier = "ag_atmospheric_aphrodisiac_1"
									has_modifier = "ag_atmospheric_aphrodisiac_2"
									has_modifier = "ag_atmospheric_aphrodisiac_3"
								}
							}
						}
					}
				}
				random_list = {
					95 = {
						modifier = { add = -5 capital_scope = { has_modifier = "ag_atmospheric_aphrodisiac_1" } }
						modifier = { add = -15 capital_scope = { has_modifier = "ag_atmospheric_aphrodisiac_2" } }
						modifier = { add = -20 capital_scope = { has_modifier = "ag_atmospheric_aphrodisiac_3" } }
					}
					5 = {
						modifier = { add = 5 capital_scope = { has_modifier = "ag_atmospheric_aphrodisiac_1" } }
						modifier = { add = 15 capital_scope = { has_modifier = "ag_atmospheric_aphrodisiac_2" } }
						modifier = { add = 20 capital_scope = { has_modifier = "ag_atmospheric_aphrodisiac_3" } }
						country_event = { id = ag_beta.41 days = 60 random = 60 }
					}
				}
				reroll_random = yes
			}
		}
		random_list = {
			25 = { country_event = { id = ag_beta.21 days = 100 random = 90 } }
			25 = { country_event = { id = ag_beta.21 days = 125 random = 90 } }
			25 = { country_event = { id = ag_beta.21 days = 150 random = 90 } }
			25 = { country_event = { id = ag_beta.21 days = 175 random = 90 } }
		}
		reroll_random = yes
	}
}

# Psionic Effect's planetary damage cycle
country_event = {
	id = ag_beta.22
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		ag_beta_psionic_effect_event_active = yes
	}

	immediate = {
		every_galaxy_planet = {
			limit = {
				has_planet_flag = ag_beta_psionic_affected_planet
				exists = owner
				owner = { ag_is_common_country = yes }
				num_pops > 0
			}
			random_list = {
				20 = {
					modifier = {
						factor = 0
						NOT = { has_modifier = ag_beta_protection }
					}
				}
				80 = {
					switch = {
						trigger = has_planet_flag
						ag_atmospheric_aphrodisiac_1 = {
							random_list = {
								25 = {
									modifier = {
										factor = 0.571
										owner = { has_technology = tech_ag_psionic_signal_3 }
									}
									modifier = { factor = 0.25 owner = { is_ai = yes } }
									random_list = {
										460 = {
											modifier = {
												factor = 2
												event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value < 1 } }
											}
											modifier = {
												factor = 0.8
												event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 1.75 } check_variable = { which = ag_scaled_difficulty value < 3.5 } }
											}
											modifier = {
												factor = 0.7
												event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
											}
										}
										# 40 totally
										10 = {
											add_planet_devastation = 5
											ag_beta_set_blocker = { ag_num_blockers = 1 }
										}
										10 = {
											add_planet_devastation = 10
											ag_beta_set_blocker = { ag_num_blockers = 2 }
										}
										10 = {
											add_planet_devastation = 5
											ag_beta_kill_pop = yes
											ag_beta_destroy_planet_check = yes
										}
										10 = {
											add_planet_devastation = 10
											ag_beta_kill_pop = yes
											ag_beta_set_blocker = { ag_num_blockers = 1 }
											ag_beta_destroy_planet_check = yes
										}
									}
									reroll_random = yes
								}
								75 = { }
							}
							reroll_random = yes
						}
						ag_atmospheric_aphrodisiac_2 = {
							random_list = {
								50 = {
									modifier = {
										factor = 0.667
										owner = { has_technology = tech_ag_psionic_signal_3 }
									}
									modifier = { factor = 0.25 owner = { is_ai = yes } }
									random_list = {
										440 = {
											modifier = {
												factor = 2
												event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value < 1 } }
											}
											modifier = {
												factor = 0.8
												event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 1.75 } check_variable = { which = ag_scaled_difficulty value < 3.5 } }
											}
											modifier = {
												factor = 0.7
												event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
											}
										}
										# 60 totally
										10 = {
											add_planet_devastation = 5
											ag_beta_set_blocker = { ag_num_blockers = 1 }
										}
										10 = {
											add_planet_devastation = 10
											ag_beta_set_blocker = { ag_num_blockers = 2 }
										}
										10 = {
											add_planet_devastation = 5
											ag_beta_kill_pop = yes
											ag_beta_destroy_planet_check = yes
										}
										10 = {
											add_planet_devastation = 10
											ag_beta_kill_pop = yes
											ag_beta_set_blocker = { ag_num_blockers = 1 }
											ag_beta_destroy_planet_check = yes
										}
										10 = {
											add_planet_devastation = 10
											ag_beta_kill_pop = yes
											if = { limit = { num_pops > 0 } ag_beta_kill_pop = yes }
											ag_beta_set_blocker = { ag_num_blockers = 1 }
											ag_beta_destroy_planet_check = yes
										}
										10 = {
											add_planet_devastation = 10
											ag_beta_kill_pop = yes
											if = { limit = { num_pops > 0 } ag_beta_kill_pop = yes }
											ag_beta_set_blocker = { ag_num_blockers = 2 }
											ag_beta_destroy_planet_check = yes
											ag_beta_planet_debuff_check = yes
										}
									}
									reroll_random = yes
								}
								50 = { }
							}
							reroll_random = yes
						}
						ag_atmospheric_aphrodisiac_3 = {
							random_list = {
								75 = {
									modifier = {
										factor = 0.800
										owner = { has_technology = tech_ag_psionic_signal_3 }
									}
									modifier = { factor = 0.25 owner = { is_ai = yes } }
									random_list = {
										430 = {
											modifier = {
												factor = 2
												event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value < 1 } }
											}
											modifier = {
												factor = 0.8
												event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 1.75 } check_variable = { which = ag_scaled_difficulty value < 3.5 } }
											}
											modifier = {
												factor = 0.7
												event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value > 2 } }
											}
										}
										# 70 totally
										10 = {
											add_planet_devastation = 5
											ag_beta_set_blocker = { ag_num_blockers = 1 }
										}
										10 = {
											add_planet_devastation = 10
											ag_beta_set_blocker = { ag_num_blockers = 2 }
										}
										10 = {
											add_planet_devastation = 5
											ag_beta_kill_pop = yes
											ag_beta_destroy_planet_check = yes
										}
										10 = {
											add_planet_devastation = 10
											ag_beta_kill_pop = yes
											ag_beta_set_blocker = { ag_num_blockers = 1 }
											ag_beta_destroy_planet_check = yes
										}
										10 = {
											add_planet_devastation = 10
											ag_beta_kill_pop = yes
											if = { limit = { num_pops > 0 } ag_beta_kill_pop = yes }
											ag_beta_set_blocker = { ag_num_blockers = 1 }
											ag_beta_destroy_planet_check = yes
										}
										10 = {
											add_planet_devastation = 10
											ag_beta_kill_pop = yes
											if = { limit = { num_pops > 0 } ag_beta_kill_pop = yes }
											ag_beta_set_blocker = { ag_num_blockers = 2 }
											ag_beta_destroy_planet_check = yes
											ag_beta_planet_debuff_check = yes
										}
										5 = {
											add_planet_devastation = 15
											ag_beta_kill_pop = yes
											if = { limit = { num_pops > 0 } ag_beta_kill_pop = yes }
											if = { limit = { num_pops > 0 } ag_beta_kill_pop = yes }
											ag_beta_set_blocker = { ag_num_blockers = 2 }
											ag_beta_destroy_planet_check = yes
											ag_beta_planet_debuff_check = yes
										}
										5 = {
											add_planet_devastation = 20
											ag_beta_kill_pop = yes
											if = { limit = { num_pops > 0 } ag_beta_kill_pop = yes }
											if = { limit = { num_pops > 0 } ag_beta_kill_pop = yes }
											ag_beta_set_blocker = { ag_num_blockers = 3 }
											ag_beta_destroy_planet_check = yes
											ag_beta_planet_debuff_check = yes
										}
									}
									reroll_random = yes
								}
								25 = { }
							}
							reroll_random = yes
						}
					}
				}
			}
			reroll_random = yes
		}
		random_list = {
			25 = { country_event = { id = ag_beta.22 days = 90 random = 80 } }
			25 = { country_event = { id = ag_beta.22 days = 180 random = 80 } }
			25 = { country_event = { id = ag_beta.22 days = 270 random = 80 } }
			25 = { country_event = { id = ag_beta.22 days = 360 random = 80 } }
		}
		reroll_random = yes
		event_target:global_event_country = { if = {
			limit = { OR = { is_variable_set = ag_beta_num_blockers_temp is_variable_set = ag_beta_num_victims_temp } }
			change_variable = { which = ag_beta_num_blockers_total value = ag_beta_num_blockers_temp }
			change_variable = { which = ag_beta_num_victims_total value = ag_beta_num_victims_temp }
			every_country = {
				limit = { has_event_chain = ag_beta_psionic_environment_chain }
				if = {
					limit = { prev = { is_variable_set = ag_beta_num_blockers_temp } }
					while = {
						count = prev.ag_beta_num_blockers_temp
						add_event_chain_counter = {
							event_chain = ag_beta_psionic_environment_chain
							counter = ag_beta_psionic_environment_blockers
							amount = 1
						}
					}
					clear_variable = ag_beta_num_blockers_temp
				}
				if = {
					limit = { prev = { is_variable_set = ag_beta_num_victims_temp } }
					while = {
						count = prev.ag_beta_num_victims_temp
						add_event_chain_counter = {
							event_chain = ag_beta_psionic_environment_chain
							counter = ag_beta_psionic_environment_victims
							amount = 1
						}
					}
					clear_variable = ag_beta_num_victims_temp
				}
			}
		} }
	}
}

# Psionic Effect stop spreading
country_event = {
	id = ag_beta.23
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		change_variable = { which = ag_beta_23_fire_counter value = 1 }
		every_system = {
			limit = {
				OR = {
					has_star_flag = ag_beta_psionic_system_1
					has_star_flag = ag_beta_psionic_system_2
					has_star_flag = ag_beta_psionic_system_3
				}
			}
			switch = {
				trigger = has_star_flag
				ag_beta_psionic_system_3 = { ag_beta_psionic_system_effect = { ag_level = 2 } }
				ag_beta_psionic_system_2 = { ag_beta_psionic_system_effect = { ag_level = 1 } }
				ag_beta_psionic_system_1 = { ag_beta_psionic_system_effect = { ag_level = 0 } }
			}
		}
		if = {
			limit = {
				check_variable = {
					which = ag_beta_23_fire_counter
					value < 3
				}
			}
			country_event = { id = ag_beta.23 days = 120 random = 180 }
		}
	}
}

# Notification for colony effected, first time
planet_event = {
	id = ag_beta.31
	title = "ag_beta.31.name"
	desc = "ag_beta.31.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_burning_settlement_room }
	show_sound = event_yellow_alert
	location = root
	
	is_triggered_only = yes

	immediate = { owner = { set_country_flag = ag_beta_31_fired } }

	option = {
		name = "ag_beta.31.a"
		owner = { if = {
			limit = { NOT = { has_event_chain = ag_beta_psionic_environment_chain } }
			begin_event_chain = {
				event_chain = ag_beta_psionic_environment_chain
				target = root.owner
			}
			while = {
				count = event_target:global_event_country.ag_beta_num_systems_total
				add_event_chain_counter = {
					event_chain = ag_beta_psionic_environment_chain
					counter = ag_beta_psionic_environment_systems
					amount = 1
				}
			}
			while = {
				count = event_target:global_event_country.ag_beta_num_planet_total
				add_event_chain_counter = {
					event_chain = ag_beta_psionic_environment_chain
					counter = ag_beta_psionic_environment_planets
					amount = 1
				}
			}
			while = {
				count = event_target:global_event_country.ag_beta_num_blockers_total
				add_event_chain_counter = {
					event_chain = ag_beta_psionic_environment_chain
					counter = ag_beta_psionic_environment_blockers
					amount = 1
				}
			}
			while = {
				count = event_target:global_event_country.ag_beta_num_victims_total
				add_event_chain_counter = {
					event_chain = ag_beta_psionic_environment_chain
					counter = ag_beta_psionic_environment_victims
					amount = 1
				}
			}
		} }
	}
	option = {
		name = "ag_beta.31.b"
		hidden_effect = { owner = { set_country_flag = ag_beta_31_banned } }
	}
}
# Notification for colony effected
planet_event = {
	id = ag_beta.32
	title = "ag_beta.32.name"
	desc = "ag_beta.32.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_burning_settlement_room }
	show_sound = event_yellow_alert
	location = root
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.32.a"
	}
	option = {
		name = "ag_beta.32.b"
		hidden_effect = {
			owner = { set_country_flag = ag_beta_31_banned }
		}
	}
}

# Notification for losting pops
country_event = {
	id = ag_beta.33
	title = "ag_beta.33.name"
	desc = "ag_beta.33.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_disease_outbreak_room }
	show_sound = event_laboratory_sound
	location = event_target:ag_target_planet
	
	fire_only_once = yes
	mean_time_to_happen = {
		months = 6
	}
	
	trigger = {
		ag_beta_psionic_effect_event_active = yes
		check_variable = {
			which = ag_beta_num_victims_country
			value > 1
		}
	}

	immediate = {
		random_owned_planet = {
			limit = {
				check_variable = {
					which = ag_beta_num_victims_planet
					value > 1
				}
			}
			save_event_target_as = ag_target_planet
		}
	}

	option = {
		name = "ag_beta.33.a"
	}
}

# Notification for colony debuff
planet_event = {
	id = ag_beta.34
	title = "ag_beta.34.name"
	desc = "ag_beta.34.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_civil_action_room }
	show_sound = event_planetary_riot
	location = root
	
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
	}
	trigger = {
		ag_beta_psionic_effect_event_active = yes
		owner = {
			NOT = {
				has_country_flag = ag_beta_34_cooldown
			}
		}
	}

	immediate = {
		owner = {
			random_list = {
				10 = { set_timed_country_flag = { flag = ag_beta_34_cooldown days = 540 } }
				10 = { set_timed_country_flag = { flag = ag_beta_34_cooldown days = 580 } }
				10 = { set_timed_country_flag = { flag = ag_beta_34_cooldown days = 620 } }
				10 = { set_timed_country_flag = { flag = ag_beta_34_cooldown days = 660 } }
				10 = { set_timed_country_flag = { flag = ag_beta_34_cooldown days = 700 } }
				10 = { set_timed_country_flag = { flag = ag_beta_34_cooldown days = 740 } }
				10 = { set_timed_country_flag = { flag = ag_beta_34_cooldown days = 780 } }
				10 = { set_timed_country_flag = { flag = ag_beta_34_cooldown days = 820 } }
				10 = { set_timed_country_flag = { flag = ag_beta_34_cooldown days = 860 } }
				10 = { set_timed_country_flag = { flag = ag_beta_34_cooldown days = 900 } }
			}
		}
		add_modifier = {
			modifier = ag_beta_planet_unstable
			days = 3600
		}
	}

	option = {
		name = "ag_beta.34.a"
	}
}

# Planet destroyed by Psionic Effect
planet_event = {
	id = ag_beta.35
	title = "ag_beta.35.name"
	desc = "ag_beta.35.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_city_ruins_room }
	show_sound = event_ghost_town
	location = root
	
	is_triggered_only = yes
	pre_triggers = { has_owner = yes }

	immediate = {
		every_owned_pop = { kill_pop = yes }
		if = { limit = { has_branch_office = yes } close_branch_office = yes }
		destroy_colony = yes
	}

	option = { name = "ag_beta.35.a" }
}

# Give Special Project when lost too many pops
country_event = {
	id = ag_beta.41
	title = "ag_beta.41.name"
	desc = "ag_beta.41.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_mystic_reveal
	location = event_target:ag_ancient_beta_shielded_world
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = ag_beta_41_fired } }
	immediate = { set_country_flag = ag_beta_41_fired }
	option = {
		name = "ag_beta.41.a"
		enable_special_project = {
			name = "ag_beta_psionic_technology_project"
			location = event_target:ag_ancient_beta_shielded_world
			owner = root
		}
	}
}

# Finish Special Project, technologies now available
country_event = {
	id = ag_beta.42
	title = "ag_beta.42.name"
	desc = "ag_beta.42.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	location = root.capital_scope
	
	is_triggered_only = yes
	
	trigger = {
		ag_beta_psionic_effect_event_active = yes
	}

	immediate = {
		set_country_flag = ag_psionic_signal_research_available
	}

	option = {
		name = "ag_beta.42.a"
	}
}

# on_tech_increased, set country flag if researched technology without flag
country_event = {
	id = ag_beta.43
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		last_increased_tech = tech_ag_psionic_signal_1
		NOT = { has_country_flag = ag_beta_41_fired }
	}

	immediate = {
		set_country_flag = ag_beta_41_fired
		if = {
			limit = {
				has_special_project = ag_beta_psionic_technology_project
			}
			abort_special_project = {
				type = ag_beta_psionic_technology_project
				location = event_target:ag_ancient_beta_shielded_world
			}
		}
	}
}

# on_tech_increased, Psionic Inhibition Platforms are available for construction
country_event = {
	id = ag_beta.44
	title = "ag_beta.44.name"
	desc = "ag_beta.44.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_mystic_reveal
	location = root.capital_scope
	
	is_triggered_only = yes
	
	trigger = {
		last_increased_tech = tech_ag_psionic_signal_42
	}

	immediate = {
		create_ship_design = { design = "NAME_ag_psionic_inhibition_station" }
		add_ship_design = last_created_design
	}

	option = {
		name = "ag_beta.44.a"
		custom_tooltip = "ag_beta.44.a.tooltip"
	}
}

# on_tech_increased, give Special Project to find Psionic Sources
country_event = {
	id = ag_beta.45
	title = "ag_beta.45.name"
	desc = "ag_beta.45.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	trigger = {
		last_increased_tech = tech_ag_psionic_signal_41
	}
	
	option = {
		name = "ag_beta.45.a"
		custom_tooltip = "ag_beta.45.a.tooltip"
		hidden_effect = {
			ag_give_research_project = { ag_project_id = @ag_beta_psionic_source_project_id ag_progress = 10 }
			if = {
				limit = { is_ai = yes ag_is_common_country = yes }
				country_event = { id = ag_beta.61 days = 1800 }
			}
		}
	}
}

# Ask other country for technologies
country_event = {
	id = ag_beta.46
	title = "ag_beta.46.name"
	desc = {
		trigger = {
			NOR = {
				AND = {
					has_valid_civic = civic_fanatic_purifiers
					event_target:ag_target_country = {
						owner_species = {
							NOT = { is_same_species = root.owner_species }
						}
					}
				}
				has_valid_civic = civic_hive_devouring_swarm
				AND = {
					has_valid_civic = civic_machine_terminator
					event_target:ag_target_country = {
						NOR = {
							is_machine_empire = yes
							has_country_flag = synthetic_empire
						}
					}
				}
			}
			OR = {
				has_research_agreement = event_target:ag_target_country
				is_in_federation_with = event_target:ag_target_country
				is_improving_relations_with = event_target:ag_target_country
				opinion_level = { who = event_target:ag_target_country level > neutral }
			}
		}
		text = "ag_beta.46.a.desc"
	}
	desc = {
		trigger = {
			NOR = {
				AND = {
					has_valid_civic = civic_fanatic_purifiers
					event_target:ag_target_country = {
						owner_species = {
							NOT = { is_same_species = root.owner_species }
						}
					}
				}
				has_valid_civic = civic_hive_devouring_swarm
				AND = {
					has_valid_civic = civic_machine_terminator
					event_target:ag_target_country = {
						NOR = {
							is_machine_empire = yes
							has_country_flag = synthetic_empire
						}
					}
				}
				has_research_agreement = event_target:ag_target_country
				is_in_federation_with = event_target:ag_target_country
				is_improving_relations_with = event_target:ag_target_country
				opinion_level = { who = event_target:ag_target_country level > neutral }
			}
			OR = {
				opinion_level = { who = event_target:ag_target_country level <= terrible }
				is_harming_relations_with = event_target:ag_target_country
				is_at_war_with = event_target:ag_target_country
				is_rival = event_target:ag_target_country
				event_target:ag_target_country = { is_rival = root }
			}
		}
		text = "ag_beta.46.b.desc"
	}
	desc = {
		trigger = {
			OR = {
				AND = {
					has_valid_civic = civic_fanatic_purifiers
					event_target:ag_target_country = {
						owner_species = {
							NOT = { is_same_species = root.owner_species }
						}
					}
				}
				has_valid_civic = civic_hive_devouring_swarm
				AND = {
					has_valid_civic = civic_machine_terminator
					event_target:ag_target_country = {
						NOR = {
							is_machine_empire = yes
							has_country_flag = synthetic_empire
						}
					}
				}
			}
		}
		text = "ag_beta.46.c.desc"
	}
	desc = {
		trigger = {
			NOR = {
				AND = {
					has_valid_civic = civic_fanatic_purifiers
					event_target:ag_target_country = {
						owner_species = {
							NOT = { is_same_species = root.owner_species }
						}
					}
				}
				has_valid_civic = civic_hive_devouring_swarm
				AND = {
					has_valid_civic = civic_machine_terminator
					event_target:ag_target_country = {
						NOR = {
							is_machine_empire = yes
							has_country_flag = synthetic_empire
						}
					}
				}
				has_research_agreement = event_target:ag_target_country
				is_in_federation_with = event_target:ag_target_country
				is_improving_relations_with = event_target:ag_target_country
				opinion_level = { who = event_target:ag_target_country level > neutral }
				opinion_level = { who = event_target:ag_target_country level <= terrible }
				is_harming_relations_with = event_target:ag_target_country
				is_at_war_with = event_target:ag_target_country
				is_rival = event_target:ag_target_country
				event_target:ag_target_country = { is_rival = root }
			}
		}
		text = "ag_beta.46.d.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_arguing_senate_room }
	show_sound = event_mystic_reveal
	
	mean_time_to_happen = { years = 2 }

	trigger = {
		ag_beta_psionic_effect_event_active = yes
		NOR = {
			has_global_flag = ag_beta_46_locked
			has_country_flag = ag_beta_41_fired
			has_country_flag = ag_beta_46_fired
			has_country_flag = ag_beta_psi_tech_refused
		}
		is_fallen_empire = no
		ag_is_common_country = yes
		is_primitive = no
		any_owned_planet = {
			OR = {
				has_planet_flag = ag_atmospheric_aphrodisiac_1
				has_planet_flag = ag_atmospheric_aphrodisiac_2
				has_planet_flag = ag_atmospheric_aphrodisiac_3
			}
		}
		any_country = {
			ag_is_common_country = yes
			NOT = { has_country_flag = ag_beta_46_cooldown }
			OR = {
				has_technology = tech_ag_psionic_signal_1
				has_tech_option = tech_ag_psionic_signal_1
			}
		}
	}

	immediate = {
		set_country_flag = ag_beta_46_fired
		random_country = {
			limit = {
				ag_is_common_country = yes
				NOT = { has_country_flag = ag_beta_46_cooldown }
				OR = {
					has_technology = tech_ag_psionic_signal_1
					has_tech_option = tech_ag_psionic_signal_1
				}
			}
			save_event_target_as = ag_target_country
		}
	}
	
	option = {
		name = "ag_beta.46.a"
		hidden_effect = {
			event_target:ag_target_country = {
				random_list = {
					20 = { set_timed_country_flag = { flag = ag_beta_46_cooldown days = 180 } }
					20 = { set_timed_country_flag = { flag = ag_beta_46_cooldown days = 240 } }
					20 = { set_timed_country_flag = { flag = ag_beta_46_cooldown days = 300 } }
					20 = { set_timed_country_flag = { flag = ag_beta_46_cooldown days = 360 } }
					20 = { set_timed_country_flag = { flag = ag_beta_46_cooldown days = 420 } }
				}
				country_event = { id = ag_beta.47 days = 1 random = 2 }
			}
		}
	}
	option = {
		name = "ag_beta.46.b"
		add_resource = { influence = @ag_end_event_influence_large }
	}
	option = {
		name = "ag_beta.46.c"
		trigger = { NOR = {
			has_ethic = ethic_fanatic_pacifist
			has_ethic = ethic_pacifist
		} }
		hidden_effect = { set_country_flag = ag_beta_psi_tech_refused }
		if = {
			limit = { NOR = {
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_machine_terminator
				has_ethic = ethic_gestalt_consciousness
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
			} }
			add_resource = { influence = -25 }
		}
		else_if = {
			limit = { OR = {
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_machine_terminator
			} }
			add_resource = { influence = 50 }
		}
		else_if = {
			limit = { OR = {
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
			} }
			add_resource = { influence = -50 }
		}
	}
}

# Other country ask for technology
country_event = {
	id = ag_beta.47
	title = "ag_beta.47.name"
	desc = {
		trigger = {
			from = {
				NOR = {
					AND = {
						has_valid_civic = civic_fanatic_purifiers
						root = {
							owner_species = {
								NOT = { is_same_species = prevprev.owner_species }
							}
						}
					}
					has_valid_civic = civic_hive_devouring_swarm
					AND = {
						has_valid_civic = civic_machine_terminator
						root = {
							NOR = {
								is_machine_empire = yes
								has_country_flag = synthetic_empire
							}
						}
					}
				}
				OR = {
					has_research_agreement = root
					is_in_federation_with = root
					is_improving_relations_with = root
					opinion_level = { who = root level > neutral }
				}
			}
		}
		text = "ag_beta.47.a.desc"
	}
	desc = {
		trigger = {
			from = {
				NOR = {
					AND = {
						has_valid_civic = civic_fanatic_purifiers
						root = {
							owner_species = {
								NOT = { is_same_species = prevprev.owner_species }
							}
						}
					}
					has_valid_civic = civic_hive_devouring_swarm
					AND = {
						has_valid_civic = civic_machine_terminator
						root = {
							NOR = {
								is_machine_empire = yes
								has_country_flag = synthetic_empire
							}
						}
					}
					has_research_agreement = root
					is_in_federation_with = root
					is_improving_relations_with = root
					opinion_level = { who = root level > neutral }
				}
				OR = {
					opinion_level = { who = root level <= terrible }
					is_harming_relations_with = root
					is_at_war_with = root
					is_rival = root
					root = { is_rival = root }
				}
			}
		}
		text = "ag_beta.47.b.desc"
	}
	desc = {
		trigger = {
			from = {
				OR = {
					AND = {
						has_valid_civic = civic_fanatic_purifiers
						root = {
							owner_species = {
								NOT = { is_same_species = prevprev.owner_species }
							}
						}
					}
					has_valid_civic = civic_hive_devouring_swarm
					AND = {
						has_valid_civic = civic_machine_terminator
						root = {
							NOR = {
								is_machine_empire = yes
								has_country_flag = synthetic_empire
							}
						}
					}
				}
			}
		}
		text = "ag_beta.47.c.desc"
	}
	desc = {
		trigger = {
			from = {
				NOR = {
					AND = {
						has_valid_civic = civic_fanatic_purifiers
						root = {
							owner_species = {
								NOT = { is_same_species = prevprev.owner_species }
							}
						}
					}
					has_valid_civic = civic_hive_devouring_swarm
					AND = {
						has_valid_civic = civic_machine_terminator
						root = {
							NOR = {
								is_machine_empire = yes
								has_country_flag = synthetic_empire
							}
						}
					}
					has_research_agreement = root
					is_in_federation_with = root
					is_improving_relations_with = root
					opinion_level = { who = root level > neutral }
					opinion_level = { who = root level <= terrible }
					is_harming_relations_with = root
					is_at_war_with = root
					is_rival = root
					root = { is_rival = root }
				}
			}
		}
		text = "ag_beta.47.d.desc"
	}
	diplomatic = yes
	force_open = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	picture_event_data = {
		room = from
		portrait = from.ruler
		planet_background = from.capital_scope
		graphical_culture = from
		city_level = from.capital_scope
	}
	show_sound = event_alien_signal
	location = from.capital_scope
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.47.a"
		response_text = "ag_beta.47.a.response"
		trigger = {
			from = {
				NOR = {
					AND = {
						has_valid_civic = civic_fanatic_purifiers
						root = {
							owner_species = {
								NOT = { is_same_species = prevprev.owner_species }
							}
						}
					}
					has_valid_civic = civic_hive_devouring_swarm
					AND = {
						has_valid_civic = civic_machine_terminator
						root = {
							NOR = {
								is_machine_empire = yes
								has_country_flag = synthetic_empire
							}
						}
					}
					is_fallen_empire_xenophobe = yes
				}
				OR = {
					has_research_agreement = root
					is_in_federation_with = root
					is_improving_relations_with = root
					opinion_level = { who = root level > neutral }
				}
			}
		}
		allow = {
			NOR = {
				AND = {
					has_valid_civic = civic_fanatic_purifiers
					from = {
						owner_species = {
							NOT = { is_same_species = root.owner_species }
						}
					}
				}
				has_valid_civic = civic_hive_devouring_swarm
				AND = {
					has_valid_civic = civic_machine_terminator
					from = {
						NOR = {
							is_machine_empire = yes
							has_country_flag = synthetic_empire
						}
					}
				}
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				from = {
					OR = {
						AND = {
							has_valid_civic = civic_fanatic_purifiers
							root = {
								owner_species = {
									NOT = { is_same_species = prevprev.owner_species }
								}
							}
						}
						has_valid_civic = civic_hive_devouring_swarm
						AND = {
							has_valid_civic = civic_machine_terminator
							root = {
								NOR = {
									is_machine_empire = yes
									has_country_flag = synthetic_empire
								}
							}
						}
						is_fallen_empire_xenophobe = yes
					}
				}
			}
		}
		hidden_effect = {
			from = {
				add_opinion_modifier = { who = root modifier = ag_opinion_beta_psionic_knowledge }
				country_event = { id = ag_beta.48 days = 1 random = 2 }
			}
		}
	}
	option = {
		name = "ag_beta.47.b"
		response_text = "ag_beta.47.b.response"
		trigger = {
			from = {
				NOR = {
					AND = {
						has_valid_civic = civic_fanatic_purifiers
						root = {
							owner_species = {
								NOT = { is_same_species = prevprev.owner_species }
							}
						}
					}
					has_valid_civic = civic_hive_devouring_swarm
					AND = {
						has_valid_civic = civic_machine_terminator
						root = {
							NOR = {
								is_machine_empire = yes
								has_country_flag = synthetic_empire
							}
						}
					}
					has_research_agreement = root
					is_in_federation_with = root
					is_improving_relations_with = root
					opinion_level = { who = root level > neutral }
				}
				OR = {
					opinion_level = { who = root level <= terrible }
					is_harming_relations_with = root
					is_at_war_with = root
					is_rival = root
					root = { is_rival = root }
				}
			}
		}
		allow = {
			NOR = {
				AND = {
					has_valid_civic = civic_fanatic_purifiers
					from = {
						owner_species = {
							NOT = { is_same_species = root.owner_species }
						}
					}
				}
				has_valid_civic = civic_hive_devouring_swarm
				AND = {
					has_valid_civic = civic_machine_terminator
					from = {
						NOR = {
							is_machine_empire = yes
							has_country_flag = synthetic_empire
						}
					}
				}
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				from = {
					OR = {
						AND = {
							has_valid_civic = civic_fanatic_purifiers
							root = {
								owner_species = {
									NOT = { is_same_species = prevprev.owner_species }
								}
							}
						}
						has_valid_civic = civic_hive_devouring_swarm
						AND = {
							has_valid_civic = civic_machine_terminator
							root = {
								NOR = {
									is_machine_empire = yes
									has_country_flag = synthetic_empire
								}
							}
						}
					}
				}
			}
		}
		hidden_effect = {
			from = {
				add_opinion_modifier = { who = root modifier = ag_opinion_beta_psionic_knowledge }
				country_event = { id = ag_beta.48 days = 1 random = 2 }
			}
		}
	}
	option = {
		name = "ag_beta.47.c"
		response_text = "ag_beta.47.c.response"
		trigger = {
			from = {
				OR = {
					AND = {
						has_valid_civic = civic_fanatic_purifiers
						root = {
							owner_species = {
								NOT = { is_same_species = prevprev.owner_species }
							}
						}
					}
					has_valid_civic = civic_hive_devouring_swarm
					AND = {
						has_valid_civic = civic_machine_terminator
						root = {
							NOR = {
								is_machine_empire = yes
								has_country_flag = synthetic_empire
							}
						}
					}
				}
			}
		}
		allow = {
			NOR = {
				AND = {
					has_valid_civic = civic_fanatic_purifiers
					from = {
						owner_species = {
							NOT = { is_same_species = root.owner_species }
						}
					}
				}
				has_valid_civic = civic_hive_devouring_swarm
				AND = {
					has_valid_civic = civic_machine_terminator
					from = {
						NOR = {
							is_machine_empire = yes
							has_country_flag = synthetic_empire
						}
					}
				}
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				from = {
					OR = {
						AND = {
							has_valid_civic = civic_fanatic_purifiers
							root = {
								owner_species = {
									NOT = { is_same_species = prevprev.owner_species }
								}
							}
						}
						has_valid_civic = civic_hive_devouring_swarm
						AND = {
							has_valid_civic = civic_machine_terminator
							root = {
								NOR = {
									is_machine_empire = yes
									has_country_flag = synthetic_empire
								}
							}
						}
					}
				}
			}
		}
		hidden_effect = {
			from = {
				add_opinion_modifier = { who = root modifier = ag_opinion_beta_psionic_knowledge }
				country_event = { id = ag_beta.48 days = 1 random = 2 }
			}
		}
	}
	option = {
		name = "ag_beta.47.d"
		response_text = "ag_beta.47.d.response"
		trigger = {
			from = {
				NOR = {
					AND = {
						has_valid_civic = civic_fanatic_purifiers
						root = {
							owner_species = {
								NOT = { is_same_species = prevprev.owner_species }
							}
						}
					}
					has_valid_civic = civic_hive_devouring_swarm
					AND = {
						has_valid_civic = civic_machine_terminator
						root = {
							NOR = {
								is_machine_empire = yes
								has_country_flag = synthetic_empire
							}
						}
					}
					has_research_agreement = root
					is_in_federation_with = root
					is_improving_relations_with = root
					opinion_level = { who = root level > neutral }
					opinion_level = { who = root level <= terrible }
					is_harming_relations_with = root
					is_at_war_with = root
					is_rival = root
					root = { is_rival = root }
				}
			}
		}
		allow = {
			NOR = {
				AND = {
					has_valid_civic = civic_fanatic_purifiers
					from = {
						owner_species = {
							NOT = { is_same_species = root.owner_species }
						}
					}
				}
				has_valid_civic = civic_hive_devouring_swarm
				AND = {
					has_valid_civic = civic_machine_terminator
					from = {
						NOR = {
							is_machine_empire = yes
							has_country_flag = synthetic_empire
						}
					}
				}
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				from = {
					OR = {
						AND = {
							has_valid_civic = civic_fanatic_purifiers
							root = {
								owner_species = {
									NOT = { is_same_species = prevprev.owner_species }
								}
							}
						}
						has_valid_civic = civic_hive_devouring_swarm
						AND = {
							has_valid_civic = civic_machine_terminator
							root = {
								NOR = {
									is_machine_empire = yes
									has_country_flag = synthetic_empire
								}
							}
						}
					}
				}
			}
		}
		hidden_effect = {
			from = {
				add_opinion_modifier = { who = root modifier = ag_opinion_beta_psionic_knowledge }
				country_event = { id = ag_beta.48 days = 1 random = 2 }
			}
		}
	}
	option = {
		name = "ag_beta.47.e"
		response_text = "ag_beta.47.e.response"
		trigger = {
			from = {
				NOR = {
					AND = {
						has_valid_civic = civic_fanatic_purifiers
						root = {
							owner_species = {
								NOT = { is_same_species = prevprev.owner_species }
							}
						}
					}
					has_valid_civic = civic_hive_devouring_swarm
					AND = {
						has_valid_civic = civic_machine_terminator
						root = {
							NOR = {
								is_machine_empire = yes
								has_country_flag = synthetic_empire
							}
						}
					}
				}
				OR = {
					has_research_agreement = root
					is_in_federation_with = root
					is_improving_relations_with = root
					opinion_level = { who = root level > neutral }
				}
			}
		}
		ai_chance = { factor = 10 }
		hidden_effect = {
			from = {
				add_opinion_modifier = {
					who = root
					modifier = ag_opinion_beta_psionic_knowledge_refuse
				}
				country_event = { id = ag_beta.49 days = 1 random = 2 }
			}
		}
	}
	option = {
		name = "ag_beta.47.f"
		response_text = "ag_beta.47.f.response"
		trigger = {
			from = {
				NOR = {
					AND = {
						has_valid_civic = civic_fanatic_purifiers
						root = {
							owner_species = {
								NOT = { is_same_species = prevprev.owner_species }
							}
						}
					}
					has_valid_civic = civic_hive_devouring_swarm
					AND = {
						has_valid_civic = civic_machine_terminator
						root = {
							NOR = {
								is_machine_empire = yes
								has_country_flag = synthetic_empire
							}
						}
					}
					has_research_agreement = root
					is_in_federation_with = root
					is_improving_relations_with = root
					opinion_level = { who = root level > neutral }
				}
				OR = {
					opinion_level = { who = root level <= terrible }
					is_harming_relations_with = root
					is_at_war_with = root
					is_rival = root
					root = { is_rival = root }
				}
			}
		}
		ai_chance = { factor = 10 }
		hidden_effect = {
			from = {
				add_opinion_modifier = {
					who = root
					modifier = ag_opinion_beta_psionic_knowledge_refuse
				}
				country_event = { id = ag_beta.49 days = 1 random = 2 }
			}
		}
	}
	option = {
		name = "ag_beta.47.g"
		response_text = "ag_beta.47.g.response"
		trigger = {
			from = {
				OR = {
					AND = {
						has_valid_civic = civic_fanatic_purifiers
						root = {
							owner_species = {
								NOT = { is_same_species = prevprev.owner_species }
							}
						}
					}
					has_valid_civic = civic_hive_devouring_swarm
					AND = {
						has_valid_civic = civic_machine_terminator
						root = {
							NOR = {
								is_machine_empire = yes
								has_country_flag = synthetic_empire
							}
						}
					}
				}
			}
		}
		ai_chance = { factor = 10 }
		hidden_effect = {
			from = {
				add_opinion_modifier = {
					who = root
					modifier = ag_opinion_beta_psionic_knowledge_refuse
				}
				country_event = { id = ag_beta.49 days = 1 random = 2 }
			}
		}
	}
	option = {
		name = "ag_beta.47.h"
		response_text = "ag_beta.47.h.response"
		trigger = {
			from = {
				NOR = {
					AND = {
						has_valid_civic = civic_fanatic_purifiers
						root = {
							owner_species = {
								NOT = { is_same_species = prevprev.owner_species }
							}
						}
					}
					has_valid_civic = civic_hive_devouring_swarm
					AND = {
						has_valid_civic = civic_machine_terminator
						root = {
							NOR = {
								is_machine_empire = yes
								has_country_flag = synthetic_empire
							}
						}
					}
					has_research_agreement = root
					is_in_federation_with = root
					is_improving_relations_with = root
					opinion_level = { who = root level > neutral }
					opinion_level = { who = root level <= terrible }
					is_harming_relations_with = root
					is_at_war_with = root
					is_rival = root
					root = { is_rival = root }
				}
			}
		}
		ai_chance = { factor = 10 }
		hidden_effect = {
			from = {
				add_opinion_modifier = {
					who = root
					modifier = ag_opinion_beta_psionic_knowledge_refuse
				}
				country_event = { id = ag_beta.49 days = 1 random = 2 }
			}
		}
	}
}

# Notification: other country give tech option
country_event = {
	id = ag_beta.48
	title = "ag_beta.48.name"
	desc = "ag_beta.48.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	location = from.capital_scope
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.48.a"
		if = {
			limit = { NOR = { has_technology = tech_ag_psionic_signal_1 has_tech_option = tech_ag_psionic_signal_1 } }
			hidden_effect = { set_country_flag = ag_psionic_signal_research_available }
			ag_add_research_option = { ag_tech = tech_ag_psionic_signal_1 }
		}
		else_if = {
			limit = { has_tech_option = tech_ag_psionic_signal_1 }
			ag_give_technology = { ag_tech = tech_ag_psionic_signal_1 }
		}
	}
}

# Notification: other country refuse to give tech option
country_event = {
	id = ag_beta.49
	title = "ag_beta.49.name"
	desc = "ag_beta.49.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_default
	location = from.capital_scope
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.49.a"
		hidden_effect = { set_country_flag = ag_beta_psi_tech_refused }
	}
}

# on_ship_bulit, spawn Psionic Inhibitor Platform platform in system
ship_event = {
	id = ag_beta.51
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = { is_ship_size = ag_psionic_inhibition_station }
	
	immediate = {
		solar_system = {
			set_star_flag = ag_psionic_inhibitor_platform_in_system
			if = {
				limit = {
					NOT = {
						any_ship_in_system = {
							is_ship_size = ag_psionic_inhibition_station
							NOT = { is_same_value = root }
						}
					}
				}
				space_owner = { save_event_target_as = ag_station_owner }
				random_system_planet = {
					limit = {
						is_primary_star = yes
					}
					create_fleet = {
						name = "NAME_ag_psionic_inhibition_station_fleet"
						settings = {
							spawn_debris = no
						}
						effect = {
							set_owner = event_target:ag_station_owner
							create_ship = {
								name = "NAME_ag_psionic_inhibition_station_ship"
								design = "NAME_ag_psionic_inhibition_station"
								prefix = no
								effect = {
									ag_difficulty_bonus = yes
								}
							}
							set_location = {
								target = prev
								distance = 20
								angle = random
							}
							fleet_event = { id = ag_beta.52 days = 180 random = 60 }
						}
					}
				}
			}
		}
		delete_ship = this
		# delete_fleet = { target = this.fleet kill_leader = yes destroy_template = yes }
	}
}

# Psionic Inhibotor Planform rudece Psionic Effect
fleet_event = {
	id = ag_beta.52
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		solar_system = {
			OR = {
				has_star_flag = ag_beta_psionic_system_1
				has_star_flag = ag_beta_psionic_system_2
				has_star_flag = ag_beta_psionic_system_3
			}
		}
	}

	immediate = {
		solar_system = {
			switch = {
				trigger = has_star_flag
				ag_beta_psionic_system_3 = {
					ag_beta_psionic_system_effect = { ag_level = 2 }
					root = { fleet_event = { id = ag_beta.52 days = 150 random = 60 } }
				}
				ag_beta_psionic_system_2 = {
					ag_beta_psionic_system_effect = { ag_level = 1 }
					root = { fleet_event = { id = ag_beta.52 days = 120 random = 60 } }
				}
				ag_beta_psionic_system_1 = {
					if = {
						limit = { NOT = { has_star_flag = ag_ancient_beta_system } }
						ag_beta_psionic_system_effect = { ag_level = 0 }
					}
				}
				default = { }
			}
		}
	}
}

# on_bi_yearly_pulse, checks if system flag need to be remove
event = {
	id = ag_beta.53
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		ag_beta_psionic_effect_event_active = yes
	}

	immediate = {
		every_system = {
			limit = {
				has_star_flag = ag_psionic_inhibitor_platform_in_system
				NOT = { any_ship_in_system = { is_ship_size = ag_psionic_inhibition_station } }
			}
			remove_star_flag = ag_psionic_inhibitor_platform_in_system
		}
	}
}

# Finish Special Project, find Psionic Effect's sources
country_event = {
	id = ag_beta.61
	title = "ag_beta.61.name"
	desc = "ag_beta.61.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_arguing_senate_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes

	trigger = { ag_beta_psionic_effect_event_active = yes }
	
	option = {
		name = "ag_beta.61.a"
		allow = {
			fail_text = {
				text = "ag_beta.61.a.fail_text"
				NOT = { has_global_flag = ag_ancient_beta_relay_station_hostility }
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1000
				has_global_flag = ag_beta_61_a_selected
			}
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = ag_beta_61_a_selected } }
				set_global_flag = ag_beta_61_a_selected
				ag_beta_spawn_signal_station = { ag_system_to_spawn = "ag_beta_station_system_1" }
				ag_beta_spawn_signal_station = { ag_system_to_spawn = "ag_beta_station_system_2" }
				ag_beta_spawn_signal_station = { ag_system_to_spawn = "ag_beta_station_system_3" }
				every_system = {
					limit = { OR = {
						has_star_flag = ag_beta_station_system_1
						has_star_flag = ag_beta_station_system_2
						has_star_flag = ag_beta_station_system_3
					} }
					isolate_system = yes
				}
				every_country = { limit = { NOT = { is_same_value = root } } country_event = { id = ag_beta.62 } }
				ag_beta_signal_station_event_chain_check = yes
				ag_beta_psionic_patten_chain_check = yes
			}
			else = {
				ag_beta_signal_station_event_chain_check = yes
				ag_beta_psionic_patten_chain_check = yes
			}
		}
	}
	option = {
		name = "ag_beta.61.b"
		ai_chance = { factor = 1 }
		custom_tooltip = "ag_beta.61.b.tooltip"
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = ag_ancient_beta_relay_station_hostility } }
				set_global_flag = ag_ancient_beta_relay_station_hostility
				every_playable_country = {
					limit = { NOT = { is_same_value = root } ag_is_common_country = yes }
					if = {
						limit = { has_event_chain = ag_beta_station_chain }
						country_event = { id = ag_beta.81 }
						if = {
							limit = { has_special_project = ag_beta_station_source_station }
							abort_special_project = { type = ag_beta_station_source_station }
						}
						if = {
							limit = { has_special_project = ag_beta_station_source_station_psi }
							abort_special_project = { type = ag_beta_station_source_station_psi }
						}
						end_event_chain = ag_beta_station_chain
					}
					else = { country_event = { id = ag_beta.82 } }
				}
				ag_beta_relay_station_spawn_effect = yes
			}
		}
	}
}

# Notification for other countries
country_event = {
	id = ag_beta.62
	title = "ag_beta.62.name"
	desc = "ag_beta.62.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	option = {
		name = "ag_beta.62.a"
		hidden_effect = {
			ag_beta_signal_station_event_chain_check = yes
		}
	}
}

# on_entering_system_fleet, notification for entering ancient signal station system first time
fleet_event = {
	id = ag_beta.71
	title = "ag_beta.71.name"
	desc = "ag_beta.71.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_mystic_reveal_light
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		ag_beta_psionic_effect_event_active = yes
		NOT = { has_global_flag = ag_ancient_beta_relay_station_hostility }
		owner = { NOT = { has_country_flag = ag_beta_71_fired } }
		from = {
			NOR = {
				has_star_flag = ag_beta_station_hostility
				has_star_flag = ag_beta_station_destroyed
			}
			OR = {
				AND = {
					has_star_flag = ag_beta_station_system_1
					root.owner = { NOT = { has_country_flag = ag_beta_station_system_1_entered } }
				}
				AND = {
					has_star_flag = ag_beta_station_system_2
					root.owner = { NOT = { has_country_flag = ag_beta_station_system_2_entered } }
				}
				AND = {
					has_star_flag = ag_beta_station_system_3
					root.owner = { NOT = { has_country_flag = ag_beta_station_system_3_entered } }
				}
			}
		}
	}

	immediate = {
		owner = { set_country_flag = ag_beta_71_fired }
		from = { ag_beta_reset_poi = yes }
	}

	option = {
		name = "ag_beta.71.a"
		hidden_effect = {
			owner = { ag_beta_psionic_patten_chain_check = yes }
			from = {
				random_system_ambient_object = {
					limit = {
						has_ambient_object_flag = ag_beta_station_source
					}
					enable_special_project = {
						name = "ag_beta_station_source_station"
						location = this
						owner = root.owner
					}
				}
			}
		}
	}
	option = {
		name = "ag_beta.71.b"
		custom_tooltip = "ag_beta.61.b.tooltip"
		hidden_effect = { from = { ag_beta_source_station_spawn = yes } }
	}
}

# on_entering_system_fleet, notification for entering ancient signal station system first time
fleet_event = {
	id = ag_beta.72
	title = "ag_beta.72.name"
	desc = "ag_beta.72.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_mystic_reveal
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		ag_beta_psionic_effect_event_active = yes
		NOT = { has_global_flag = ag_ancient_beta_relay_station_hostility }
		owner = { has_country_flag = ag_beta_71_fired }
		from = {
			NOR = {
				has_star_flag = ag_beta_station_hostility
				has_star_flag = ag_beta_station_destroyed
			}
			OR = {
				AND = {
					has_star_flag = ag_beta_station_system_1
					root.owner = { NOT = { has_country_flag = ag_beta_station_system_1_entered } }
				}
				AND = {
					has_star_flag = ag_beta_station_system_2
					root.owner = { NOT = { has_country_flag = ag_beta_station_system_2_entered } }
				}
				AND = {
					has_star_flag = ag_beta_station_system_3
					root.owner = { NOT = { has_country_flag = ag_beta_station_system_3_entered } }
				}
			}
		}
	}

	immediate = { from = { ag_beta_reset_poi = yes } }

	option = {
		name = "ag_beta.72.a"
		hidden_effect = {
			owner = { ag_beta_psionic_patten_chain_check = yes }
			from = {
				random_system_ambient_object = {
					limit = {
						has_ambient_object_flag = ag_beta_station_source
					}
					enable_special_project = {
						name = "ag_beta_station_source_station"
						location = this
						owner = root.owner
					}
				}
			}
		}
	}
	option = {
		name = "ag_beta.72.b"
		custom_tooltip = "ag_beta.61.b.tooltip"
		hidden_effect = { from = { ag_beta_source_station_spawn = yes } }
	}
}

# on_entering_system_fleet, notification for entering ancient signal station system, but other has triggered its defensive system
fleet_event = {
	id = ag_beta.73
	title = "ag_beta.73.name"
	desc = "ag_beta.73.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_fleet_evil_room }
	show_sound = event_red_alert
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		ag_beta_psionic_effect_event_active = yes
		NOT = { has_global_flag = ag_ancient_beta_relay_station_hostility }
		from = {
			has_star_flag = ag_beta_station_hostility
			NOT = { has_star_flag = ag_beta_station_destroyed }
			OR = {
				AND = {
					has_star_flag = ag_beta_station_system_1
					root.owner = { NOT = { has_country_flag = ag_beta_station_system_1_entered } }
				}
				AND = {
					has_star_flag = ag_beta_station_system_2
					root.owner = { NOT = { has_country_flag = ag_beta_station_system_2_entered } }
				}
				AND = {
					has_star_flag = ag_beta_station_system_3
					root.owner = { NOT = { has_country_flag = ag_beta_station_system_3_entered } }
				}
			}
		}
	}

	immediate = { from = { ag_beta_reset_poi = yes } }

	option = {
		name = "ag_beta.73.a"
		hidden_effect = { owner = { ag_beta_psionic_patten_chain_check = yes } }
	}
}

# on_entering_system_fleet, notification for entering ancient signal station system, but other has destroyed it
fleet_event = {
	id = ag_beta.74
	title = "ag_beta.74.name"
	desc = "ag_beta.74.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ruined_system_room }
	show_sound = event_sensor_ping
	location = root
	
	is_triggered_only = yes
	
	trigger = {
		ag_beta_psionic_effect_event_active = yes
		NOT = { has_global_flag = ag_ancient_beta_relay_station_hostility }
		from = {
			has_star_flag = ag_beta_station_destroyed
			OR = {
				AND = {
					has_star_flag = ag_beta_station_system_1
					root.owner = { NOT = { has_country_flag = ag_beta_station_system_1_entered } }
				}
				AND = {
					has_star_flag = ag_beta_station_system_2
					root.owner = { NOT = { has_country_flag = ag_beta_station_system_2_entered } }
				}
				AND = {
					has_star_flag = ag_beta_station_system_3
					root.owner = { NOT = { has_country_flag = ag_beta_station_system_3_entered } }
				}
			}
		}
	}

	immediate = {
		from = {
			ag_beta_reset_poi = yes
			random_system_ambient_object = {
				limit = {
					has_ambient_object_flag = ag_beta_station_psionic_structure
				}
				save_event_target_as = ag_target_object
			}
		}
	}

	option = {
		name = "ag_beta.74.a"
		owner = {
			ag_beta_psionic_patten_chain_check = yes
			enable_special_project = {
				name = ag_beta_station_source_station_psi
				location = event_target:ag_target_object
				owner = root.owner
			}
		}
	}
}

# Special project completed
ship_event = {
	id = ag_beta.75
	title = "ag_beta.75.name"
	desc = "ag_beta.75.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_wormhole_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = ag_ancient_beta_relay_station_hostility }
	}
	
	option = {
		name = "ag_beta.75.a"
		hidden_effect = {
			owner = {
				change_variable = {
					which = ag_ancient_psionic_signal_patten
					value = 1
				}
				ag_beta_psionic_patten_chain_check = yes
				add_event_chain_counter = {
					event_chain = ag_beta_station_chain
					counter = ag_ancient_code
					amount = 1
				}
				if = {
					limit = {
						has_completed_event_chain_counter = {
							event_chain = "ag_beta_station_chain"
							counter = "ag_ancient_code"
						}
					}
					country_event = { id = ag_beta.91 days = 1 random = 2 }
				}
			}
		}
	}
}

# Special project failed, notification for player to save science ship
ship_event = {
	id = ag_beta.76
	title = "ag_beta.76.name"
	desc = "ag_beta.76.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = ag_ancient_beta_relay_station_hostility }
	}

	immediate = {
		solar_system = { save_event_target_as = ag_target_system }
		event_target:global_event_country = {
			country_event = { id = ag_beta.77 days = 17 }
		}
		owner = {
			country_event = { id = ag_beta.78 days = 17 }
		}
	}
	
	option = {
		name = "ag_beta.76.a"
	}
}

# Spawn ancient fleet
country_event = {
	id = ag_beta.77
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		event_target:ag_target_system = {
			ag_beta_source_station_spawn = yes
		}
	}
}

# Notification for ancient fleet spawn
country_event = {
	id = ag_beta.78
	title = "ag_beta.78.name"
	desc = "ag_beta.78.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_fleet_evil_room }
	show_sound = event_red_alert
	
	is_triggered_only = yes
	
	option = {
		name = "ag_beta.78.a"
	}
}

# on_ship_destroyed_perp, Ancient Signal Station destroyed, enable special project for its killer
country_event = {
	id = ag_beta.79
	title = "ag_beta.79.name"
	desc = "ag_beta.79.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_space_battle
	
	is_triggered_only = yes
	
	trigger = {
		fromfromfrom = {
			is_ship_size = ag_beta_station_type2_hostile
			NOT = { has_ship_flag = ag_set_disable_at_health }
			OR = {
				AND = { root = { NOT = { has_country_flag = ag_beta_station_system_1_destroyed } } solar_system = { has_star_flag = ag_beta_station_system_1 } }
				AND = { root = { NOT = { has_country_flag = ag_beta_station_system_2_destroyed } } solar_system = { has_star_flag = ag_beta_station_system_2 } }
				AND = { root = { NOT = { has_country_flag = ag_beta_station_system_3_destroyed } } solar_system = { has_star_flag = ag_beta_station_system_3 } }
			}
		}
	}
	
	immediate = {
		if = { limit = { fromfromfrom.solar_system = { has_star_flag = ag_beta_station_system_1 } } set_country_flag = ag_beta_station_system_1_destroyed }
		else_if = { limit = { fromfromfrom.solar_system = { has_star_flag = ag_beta_station_system_2 } } set_country_flag = ag_beta_station_system_2_destroyed }
		else_if = { limit = { fromfromfrom.solar_system = { has_star_flag = ag_beta_station_system_3 } } set_country_flag = ag_beta_station_system_3_destroyed }
		create_ambient_object = { type = ag_beta_psionic_structure_object }
		last_created_ambient_object = {
			set_location = { target = fromfrom.solar_system.star distance = -1 angle = 0 }
			set_ambient_object_flag = ag_beta_station_psionic_structure
			save_event_target_as = ag_target_object
		}
		fromfrom.solar_system = { save_event_target_as = ag_target_system set_star_flag = ag_beta_station_destroyed }
		if = {
			limit = { NOT = { event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value < 1 } } } }
			fromfrom = { solar_system = { every_fleet_in_system = {
				limit = { owner = { is_same_value = root.from } }
				add_modifier = { modifier = "ag_ancient_beta_guardian_power" days = -1 }
			} } }
		}
		add_threat = { who = root amount = 10 }
	}
	
	option = {
		name = "ag_beta.79.a"
		trigger = { NOT = { has_global_flag = ag_ancient_beta_relay_station_hostility } }
		if = {
			limit = { OR = {
				AND = { fromfromfrom.solar_system = { has_star_flag = ag_beta_station_system_1 } NOT = { has_country_flag = ag_beta_station_system_1_project } }
				AND = { fromfromfrom.solar_system = { has_star_flag = ag_beta_station_system_2 } NOT = { has_country_flag = ag_beta_station_system_2_project } }
				AND = { fromfromfrom.solar_system = { has_star_flag = ag_beta_station_system_3 } NOT = { has_country_flag = ag_beta_station_system_3_project } }
			} }
			enable_special_project = {
				name = ag_beta_station_source_station_psi
				location = event_target:ag_target_object
				owner = root
			}
			hidden_effect = {
				if = { limit = { fromfromfrom.solar_system = { has_star_flag = ag_beta_station_system_1 } } set_country_flag = ag_beta_station_system_1_project }
				else_if = { limit = { fromfromfrom.solar_system = { has_star_flag = ag_beta_station_system_2 } } set_country_flag = ag_beta_station_system_2_project }
				else_if = { limit = { fromfromfrom.solar_system = { has_star_flag = ag_beta_station_system_3 } } set_country_flag = ag_beta_station_system_3_project }
			}
		}
	}
	option = {
		name = "ag_beta.79.b"
		trigger = { has_global_flag = ag_ancient_beta_relay_station_hostility }
	}
}

# Notification that other has triggered ancient defensive system, for countries with event chain
country_event = {
	id = ag_beta.81
	title = "ag_beta.81.name"
	desc = "ag_beta.81.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_news_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes
	
	option = {
		name = "ag_beta.81.a"
	}
}

# Notification that other has triggered ancient defensive system, for countries without event chain
country_event = {
	id = ag_beta.82
	title = "ag_beta.82.name"
	desc = "ag_beta.82.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	option = {
		name = "ag_beta.82.a"
	}
}

# on_ship_disabled, Disable Ancient Relay Station, has chance to reactive
ship_event = {
	id = ag_beta.83
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = { is_ship_size = ag_beta_station_type1_hostile }
	
	immediate = {
		random_list = {
			50 = {
				modifier = { factor = 0 event_target:global_event_country = { check_variable = { which = ag_scaled_difficulty value < 1 } } }
				modifier = { factor = 0 fleet = { check_variable = { which = ag_beta_station_repair_counter value > 3 } } }
				if = {
					limit = { fleet = { check_variable = { which = ag_beta_station_repair_counter value > 3 } } }
					ag_spawn_explosion_effect = { ag_scale = l ag_color = red }
					ag_clear_disable_at_health = { ag_disable_type = event }
					set_disabled = no
				}
				else = {
					repair_percentage = 0.8
					set_disabled = no
					ag_spawn_extra_lives_effect = yes
					add_modifier = { modifier = "ag_beta_station_repair_power" days = 180 }
					fleet = { change_variable = { which = ag_beta_station_repair_counter value = 1 } }
				}
			}
			50 = {
				modifier = { factor = 1.5 fleet = { check_variable = { which = ag_beta_station_repair_counter value < 1 } } }
				ag_spawn_explosion_effect = { ag_scale = l ag_color = red }
				ag_clear_disable_at_health = { ag_disable_type = event }
				set_disabled = no
				# ship_event = { id = ag_beta.831 days = 1 }
			}
		}
		reroll_random = yes
	}
}
# ship_event = {
	# id = ag_beta.831
	# hide_window = yes
	# is_triggered_only = yes
	# immediate = { set_disabled = no }
# }

# on_ship_destroyed_victim, Destroy Ancient Relay Station
country_event = {
	id = ag_beta.84
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = { fromfrom = { is_ship_size = ag_beta_station_type1_hostile NOT = { has_ship_flag = ag_set_disable_at_health } } }
	
	immediate = {
		create_ambient_object = { type = ag_beta_psionic_structure_object }
		last_created_ambient_object = {
			set_location = {
				target = fromfrom
				distance = -1
				angle = 0
			}
			set_ambient_object_flag = ag_beta_station_psionic_structure
			save_event_target_as = ag_target_object
		}
		if = {
			limit = {
				fromfrom = { has_ship_flag = ag_beta_station_1 }
			}
			event_target:ag_ancient_beta_shielded_world = {
				remove_modifier = "ag_ancient_beta_station_1_activated"
			}
		}
		if = {
			limit = {
				fromfrom = { has_ship_flag = ag_beta_station_2 }
			}
			event_target:ag_ancient_beta_shielded_world = {
				remove_modifier = "ag_ancient_beta_station_2_activated"
			}
		}
		if = {
			limit = {
				fromfrom = { has_ship_flag = ag_beta_station_3 }
			}
			event_target:ag_ancient_beta_shielded_world = {
				remove_modifier = "ag_ancient_beta_station_3_activated"
			}
		}
		fromfrom.solar_system = {
			every_fleet_in_system = {
				limit = { owner = { NOT = { is_country_type = ag_ancient_beta_guardian } } }
				while = {
					limit = { any_controlled_ship = { NOT = { has_ship_flag = ag_beta_system_destroyed_debuffed } } }
					random_controlled_ship = {
						limit = { NOT = { has_ship_flag = ag_beta_system_destroyed_debuffed } }
						set_timed_ship_flag = {
							flag = ag_beta_system_destroyed_debuffed
							days = 2
						}
						ag_spawn_explosion_effect = { ag_scale = m ag_color = red }
						add_modifier = {
							modifier = "ag_beta_system_destroyed_debuff"
							days = 15
						}
					}
				}
			}
		}
		if = {
			limit = {
				count_controlled_ship = {
					limit = { is_ship_size = ag_beta_station_type1_hostile }
					count < 1
				}
			}
			fromfromfrom.solar_system = {
				random_system_ambient_object = {
					limit = {
						has_ambient_object_flag = ag_beta_station_psionic_structure
					}
					save_event_target_as = ag_poject_object
				}
			}
			from = {
				save_global_event_target_as = ag_ancient_beta_guardian_killer
				country_event = { id = ag_beta.85 }
			}
			every_playable_country = {
				limit = {
					NOR = {
						is_same_value = root
						is_same_value = root.from
						ag_is_common_country = yes
					}
				}
				country_event = { id = ag_beta.86 }
			}
			every_playable_country = {
				if = {
					limit = { has_special_project = ag_beta_station_source_station }
					abort_special_project = { type = ag_beta_station_source_station }
				}
				if = {
					limit = { has_special_project = ag_beta_station_source_station_psi }
					abort_special_project = { type = ag_beta_station_source_station_psi }
				}
				if = {
					limit = { has_special_project = ag_beta_station_input_code }
					abort_special_project = { type = ag_beta_station_input_code }
				}
				if = {
					limit = { has_special_project = ag_find_ancient_beta_weakness }
					abort_special_project = { type = ag_find_ancient_beta_weakness }
				}
				if = {
					limit = { has_special_project = ag_find_ancient_beta_signal_station_weakness }
					abort_special_project = { type = ag_find_ancient_beta_signal_station_weakness }
				}
				if = {
					limit = { has_modifier = ag_ancient_beta_weakness }
					remove_modifier = ag_ancient_beta_weakness 
				}
				if = {
					limit = { has_modifier = ag_ancient_beta_signal_station_weakness }
					remove_modifier = ag_ancient_beta_signal_station_weakness 
				}
				if = {
					limit = { has_event_chain = ag_beta_station_chain }
					end_event_chain = ag_beta_station_chain
				}
			}
			add_threat = {
				who = from
				amount = 50
			}
			destroy_country = yes
		}
		else = {
			random_list = {
				50 = { }
				50 = {
					fromfrom.solar_system.star = {
						ag_beta_guardian_drone_squadron_spawn = { ag_target_owner = root }
					}
				}
			}
		}
	}
}

# Notification: Ancient Relay Station destroyed, for killer
country_event = {
	id = ag_beta.85
	title = "ag_beta.85.name"
	desc = "ag_beta.85.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_small_space_battle_room }
	show_sound = event_space_battle
	
	is_triggered_only = yes
	
	option = {
		name = "ag_beta.85.a"
		enable_special_project = {
			name = ag_beta_station_relay_station_psi
			location = event_target:ag_poject_object
			owner = root
		}
	}
}

# Notification: Ancient Relay Station destroyed, for others
country_event = {
	id = ag_beta.86
	title = "ag_beta.86.name"
	desc = "ag_beta.86.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	option = {
		name = "ag_beta.86.a"
		enable_special_project = {
			name = ag_beta_station_relay_station_psi
			location = event_target:ag_poject_object
			owner = root
		}
	}
}

# Special Project completed, Psionic Effect stop spreading
ship_event = {
	id = ag_beta.87
	title = "ag_beta.87.name"
	desc = "ag_beta.87.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_debris_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes

	immediate = {
		set_global_flag = ag_aneient_beta_psionic_effect_ended
		if = { limit = { NOT = { has_global_flag = ag_ancient_zeta_guardian_destroyed } } ag_reset_shroud_type = yes }
		every_country = {
			limit = { NOT = { is_same_value = root.owner } }
			country_event = { id = ag_beta.102 }
		}
		event_target:global_event_country = { country_event = { id = ag_beta.23 days = 5 random = 5 } }
	}

	after = { hidden_effect = {
		every_country = {
			# if = {
			# 	limit = { has_special_project = ag_beta_track_psionic_signal }
			# 	abort_special_project = { type = ag_beta_track_psionic_signal }
			# }
			if = {
				limit = { has_special_project = ag_beta_station_source_station }
				abort_special_project = { type = ag_beta_station_source_station }
			}
			if = {
				limit = { has_special_project = ag_beta_station_source_station_psi }
				abort_special_project = { type = ag_beta_station_source_station_psi }
			}
			if = {
				limit = { has_special_project = ag_beta_station_relay_station_psi }
				abort_special_project = { type = ag_beta_station_relay_station_psi }
			}
			if = {
				limit = { has_special_project = ag_beta_station_input_code }
				abort_special_project = { type = ag_beta_station_input_code }
			}
			if = {
				limit = { has_special_project = ag_find_ancient_beta_weakness }
				abort_special_project = { type = ag_find_ancient_beta_weakness }
			}
			if = {
				limit = { has_special_project = ag_find_ancient_beta_signal_station_weakness }
				abort_special_project = { type = ag_find_ancient_beta_signal_station_weakness }
			}
			if = {
				limit = { has_modifier = ag_ancient_beta_weakness }
				remove_modifier = ag_ancient_beta_weakness 
			}
			if = {
				limit = { has_modifier = ag_ancient_beta_signal_station_weakness }
				remove_modifier = ag_ancient_beta_signal_station_weakness 
			}
			if = {
				limit = { has_event_chain = ag_beta_station_chain }
				end_event_chain = ag_beta_station_chain
			}
		}
	} }
	
	option = {
		name = "ag_beta.87.a"
		owner = { if = {
			limit = { has_event_chain = ag_beta_psionic_environment_chain }
			end_event_chain = ag_beta_psionic_environment_chain
		} }
		hidden_effect = { event_target:global_event_country = {
			if = { limit = { is_variable_set = ag_beta_num_systems_total } clear_variable = ag_beta_num_systems_total }
			if = { limit = { is_variable_set = ag_beta_num_planets_total } clear_variable = ag_beta_num_planets_total }
			if = { limit = { is_variable_set = ag_beta_num_blockers_total } clear_variable = ag_beta_num_blockers_total }
			if = { limit = { is_variable_set = ag_beta_num_victims_total } clear_variable = ag_beta_num_victims_total }
		} }
	}
}

# Notification for shut down ancient relay station
country_event = {
	id = ag_beta.91
	title = "ag_beta.91.name"
	desc = "ag_beta.91.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes

	immediate = {
		event_target:ag_ancient_beta_star = {
			solar_system = {
				random_system_ambient_object = {
					limit = {
						OR = {
							has_ambient_object_flag = ag_beta_station_1
							has_ambient_object_flag = ag_beta_station_2
							has_ambient_object_flag = ag_beta_station_3
						}
					}
					save_event_target_as = ag_target_object
				}
			}
		}
	}
	
	option = {
		name = "ag_beta.91.a"
		end_event_chain = ag_beta_station_chain
		enable_special_project = {
			name = ag_beta_station_input_code
			location = event_target:ag_target_object
			owner = root
		}
	}
}

# Completed special project, begins communication with ancient stations
country_event = {
	id = ag_beta.92
	title = "ag_beta.92.name"
	desc = "ag_beta.92.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_activating_unknown_technology
	
	is_triggered_only = yes
	fire_only_once = yes

	after = { hidden_effect = {
		every_country = {
			limit = { has_special_project = ag_beta_station_input_code NOT = { is_same_value = root } }
			country_event = { id = ag_beta.104 }
			abort_special_project = { type = ag_beta_station_input_code }
		}
	} }
	
	option = {
		name = "ag_beta.92.a"
		hidden_effect = { country_event = { id = ag_beta.93 } }
	}
}

# Provide psionic signal flow pattens
# Code Sequence: 2-1-3-1(8191 = 2^13-1)
country_event = {
	id = ag_beta.93
	title = "ag_beta.93.name"
	desc = "ag_beta.93.desc"
	diplomatic = yes
	force_open = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	picture_event_data = {
		room = ag_ancient_ai_red_room
		portrait = ag_ancient_ai_red
	}
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.93.a"
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = ag_ancient_psionic_signal_flow_patten_flag } }
				set_global_flag = ag_ancient_psionic_signal_flow_patten_flag
			}
			country_event = { id = ag_beta.94 }
		}
	}
	option = {
		name = "ag_beta.93.b"
		hidden_effect = {
			country_event = { id = ag_beta.94 }
		}
	}
	option = {
		name = "ag_beta.93.c"
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = ag_ancient_psionic_signal_flow_patten_flag } }
				set_global_flag = ag_ancient_psionic_signal_flow_patten_flag
			}
			country_event = { id = ag_beta.94 }
		}
	}
}
country_event = {
	id = ag_beta.94
	title = "ag_beta.94.name"
	desc = "ag_beta.94.desc"
	diplomatic = yes
	force_open = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	picture_event_data = {
		room = ag_ancient_ai_red_room
		portrait = ag_ancient_ai_red
	}
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.94.a"
		hidden_effect = {
			country_event = { id = ag_beta.95 }
		}
	}
	option = {
		name = "ag_beta.94.b"
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = ag_ancient_psionic_signal_flow_patten_flag } }
				set_global_flag = ag_ancient_psionic_signal_flow_patten_flag
			}
			country_event = { id = ag_beta.95 }
		}
	}
	option = {
		name = "ag_beta.94.c"
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = ag_ancient_psionic_signal_flow_patten_flag } }
				set_global_flag = ag_ancient_psionic_signal_flow_patten_flag
			}
			country_event = { id = ag_beta.95 }
		}
	}
}
country_event = {
	id = ag_beta.95
	title = "ag_beta.95.name"
	desc = "ag_beta.95.desc"
	diplomatic = yes
	force_open = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	picture_event_data = {
		room = ag_ancient_ai_red_room
		portrait = ag_ancient_ai_red
	}
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.95.a"
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = ag_ancient_psionic_signal_flow_patten_flag } }
				set_global_flag = ag_ancient_psionic_signal_flow_patten_flag
			}
			country_event = { id = ag_beta.96 }
		}
	}
	option = {
		name = "ag_beta.95.b"
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = ag_ancient_psionic_signal_flow_patten_flag } }
				set_global_flag = ag_ancient_psionic_signal_flow_patten_flag
			}
			country_event = { id = ag_beta.96 }
		}
	}
	option = {
		name = "ag_beta.95.c"
		hidden_effect = {
			country_event = { id = ag_beta.96 }
		}
	}
}
country_event = {
	id = ag_beta.96
	title = "ag_beta.96.name"
	desc = "ag_beta.96.desc"
	diplomatic = yes
	force_open = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	picture_event_data = {
		room = ag_ancient_ai_red_room
		portrait = ag_ancient_ai_red
	}
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.96.a"
		hidden_effect = {
			country_event = { id = ag_beta.97 }
		}
	}
	option = {
		name = "ag_beta.96.b"
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = ag_ancient_psionic_signal_flow_patten_flag } }
				set_global_flag = ag_ancient_psionic_signal_flow_patten_flag
			}
			country_event = { id = ag_beta.97 }
		}
	}
	option = {
		name = "ag_beta.96.c"
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = ag_ancient_psionic_signal_flow_patten_flag } }
				set_global_flag = ag_ancient_psionic_signal_flow_patten_flag
			}
			country_event = { id = ag_beta.97 }
		}
	}
}
country_event = {
	id = ag_beta.97
	title = "ag_beta.97.name"
	desc = "ag_beta.97.desc"
	diplomatic = yes
	force_open = yes
	custom_gui = "ag_ancient_event_diplomacy_window"
	custom_gui_option = "ag_ancient_event_diplomacy_option"
	picture_event_data = {
		room = ag_ancient_ai_red_room
		portrait = ag_ancient_ai_red
	}
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.97.a"
		hidden_effect = {
			country_event = { id = ag_beta.98 }
			event_target:global_event_country = {
				country_event = { id = ag_beta.99 days = 8 random = 10 }
			}
		}
	}
}

# Ancient Station checking psionic signal flow pattens
country_event = {
	id = ag_beta.98
	title = "ag_beta.98.name"
	desc = "ag_beta.98.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	option = {
		name = "ag_beta.98.a"
	}
}

# Ancient Station checking psionic signal flow pattens
country_event = {
	id = ag_beta.99
	hide_window = yes
	
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				NOT = { has_global_flag = ag_ancient_psionic_signal_flow_patten_flag }
			}
			set_global_flag = ag_aneient_beta_psionic_effect_ended
			if = { limit = { NOT = { has_global_flag = ag_ancient_zeta_guardian_destroyed } } ag_reset_shroud_type = yes }
			from = { country_event = { id = ag_beta.101 } }
			every_country = {
				limit = { NOT = { is_same_value = from } }
				country_event = { id = ag_beta.102 }
			}
			every_country = {
				# if = {
				# 	limit = { has_special_project = ag_beta_track_psionic_signal }
				# 	abort_special_project = { type = ag_beta_track_psionic_signal }
				# }
				if = {
					limit = { has_special_project = ag_beta_station_source_station }
					abort_special_project = { type = ag_beta_station_source_station }
				}
				if = {
					limit = { has_special_project = ag_beta_station_source_station_psi }
					abort_special_project = { type = ag_beta_station_source_station_psi }
				}
				if = {
					limit = { has_special_project = ag_beta_station_relay_station_psi }
					abort_special_project = { type = ag_beta_station_relay_station_psi }
				}
				if = {
					limit = { has_special_project = ag_beta_station_input_code }
					abort_special_project = { type = ag_beta_station_input_code }
				}
				if = {
					limit = { has_special_project = ag_find_ancient_beta_weakness }
					abort_special_project = { type = ag_find_ancient_beta_weakness }
				}
				if = {
					limit = { has_special_project = ag_find_ancient_beta_signal_station_weakness }
					abort_special_project = { type = ag_find_ancient_beta_signal_station_weakness }
				}
				if = {
					limit = { has_modifier = ag_ancient_beta_weakness }
					remove_modifier = ag_ancient_beta_weakness 
				}
				if = {
					limit = { has_modifier = ag_ancient_beta_signal_station_weakness }
					remove_modifier = ag_ancient_beta_signal_station_weakness 
				}
				if = {
					limit = { has_event_chain = ag_beta_station_chain }
					end_event_chain = ag_beta_station_chain
				}
			}
			event_target:global_event_country = { country_event = { id = ag_beta.23 days = 5 random = 5 } }
		}
		else = {
			set_global_flag = ag_ancient_beta_relay_station_hostility
			every_country = {
				limit = { ag_is_common_country = yes }
				if = {
					limit = { is_same_value = from }
					country_event = { id = ag_beta.103 }
				}
				else_if = {
					limit = {
						has_event_chain = ag_beta_station_chain
						NOT = { is_same_value = from }
					}
					country_event = { id = ag_beta.81 }
					# if = {
					# 	limit = { has_special_project = ag_beta_track_psionic_signal }
					# 	abort_special_project = { type = ag_beta_track_psionic_signal }
					# }
					if = {
						limit = { has_special_project = ag_beta_station_source_station }
						abort_special_project = { type = ag_beta_station_source_station }
					}
					if = {
						limit = { has_special_project = ag_beta_station_source_station_psi }
						abort_special_project = { type = ag_beta_station_source_station_psi }
					}
					end_event_chain = ag_beta_station_chain
				}
				else_if = {
					limit = { always = yes }
					country_event = { id = ag_beta.82 }
				}
			}
			ag_beta_relay_station_spawn_effect = yes
		}
	}
}

# Notification, Ancient Relay Station shut down
country_event = {
	id = ag_beta.101
	title = "ag_beta.101.name"
	desc = "ag_beta.101.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	option = {
		name = "ag_beta.101.a"
		if = {
			limit = { has_event_chain = ag_beta_psionic_environment_chain }
			end_event_chain = ag_beta_psionic_environment_chain
		}
		hidden_effect = { event_target:global_event_country = {
			if = { limit = { is_variable_set = ag_beta_num_systems_total } clear_variable = ag_beta_num_systems_total }
			if = { limit = { is_variable_set = ag_beta_num_planets_total } clear_variable = ag_beta_num_planets_total }
			if = { limit = { is_variable_set = ag_beta_num_blockers_total } clear_variable = ag_beta_num_blockers_total }
			if = { limit = { is_variable_set = ag_beta_num_victims_total } clear_variable = ag_beta_num_victims_total }
		} }
	}
}
country_event = {
	id = ag_beta.102
	title = "ag_beta.102.name"
	desc = "ag_beta.102.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	option = {
		name = "ag_beta.102.a"
		if = {
			limit = { has_event_chain = ag_beta_psionic_environment_chain }
			end_event_chain = ag_beta_psionic_environment_chain
		}
		hidden_effect = { event_target:global_event_country = {
			if = { limit = { is_variable_set = ag_beta_num_systems_total } clear_variable = ag_beta_num_systems_total }
			if = { limit = { is_variable_set = ag_beta_num_planets_total } clear_variable = ag_beta_num_planets_total }
			if = { limit = { is_variable_set = ag_beta_num_blockers_total } clear_variable = ag_beta_num_blockers_total }
			if = { limit = { is_variable_set = ag_beta_num_victims_total } clear_variable = ag_beta_num_victims_total }
		} }
	}
}

# Notification, Ancient Relay Station turn into hostile
country_event = {
	id = ag_beta.103
	title = "ag_beta.103.name"
	desc = "ag_beta.103.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_space_station_room }
	show_sound = event_red_alert
	
	is_triggered_only = yes
	
	option = {
		name = "ag_beta.103.a"
	}
}

# Notification, Ancient Relay Station is communication with other country
country_event = {
	id = ag_beta.104
	title = "ag_beta.104.name"
	desc = "ag_beta.104.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_default
	
	is_triggered_only = yes
	
	option = {
		name = "ag_beta.104.a"
	}
}

# on_bi_yearly_pulse, Failsase event for ancient relay station destroyed for unknown reason, end event chain
event = {
	id = ag_beta.105
	hide_window = yes

	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		ag_beta_psionic_effect_event_active = yes
		has_global_flag = ag_ancient_beta_guradian_awaken
		exists = event_target:ag_ancient_beta_guardian_country
		event_target:ag_ancient_beta_guardian_country = {
			count_controlled_ship = {
				limit = { is_ship_size = ag_beta_station_type1_hostile }
				count < 1
			}
		}
	}

	immediate = {
		set_global_flag = ag_aneient_beta_psionic_effect_ended
		if = { limit = { NOT = { has_global_flag = ag_ancient_zeta_guardian_destroyed } } ag_reset_shroud_type = yes }
		event_target:ag_ancient_beta_guardian_country = { destroy_country = yes }
		event_target:global_event_country = { country_event = { id = ag_beta.23 days = 5 random = 5 } }
		every_country = {
			# if = {
			# 	limit = { has_special_project = ag_beta_track_psionic_signal }
			# 	abort_special_project = { type = ag_beta_track_psionic_signal }
			# }
			if = {
				limit = { has_special_project = ag_beta_station_source_station }
				abort_special_project = { type = ag_beta_station_source_station }
			}
			if = {
				limit = { has_special_project = ag_beta_station_source_station_psi }
				abort_special_project = { type = ag_beta_station_source_station_psi }
			}
			if = {
				limit = { has_special_project = ag_beta_station_input_code }
				abort_special_project = { type = ag_beta_station_input_code }
			}
			if = {
				limit = { has_special_project = ag_find_ancient_beta_weakness }
				abort_special_project = { type = ag_find_ancient_beta_weakness }
			}
			if = {
				limit = { has_special_project = ag_find_ancient_beta_signal_station_weakness }
				abort_special_project = { type = ag_find_ancient_beta_signal_station_weakness }
			}
			if = {
				limit = { has_modifier = ag_ancient_beta_weakness }
				remove_modifier = ag_ancient_beta_weakness 
			}
			if = {
				limit = { has_modifier = ag_ancient_beta_signal_station_weakness }
				remove_modifier = ag_ancient_beta_signal_station_weakness 
			}
			if = {
				limit = { has_event_chain = ag_beta_station_chain }
				end_event_chain = ag_beta_station_chain
			}
		}
	}
}

# on_ship_destroyed_victim, Give Beta Installation Defensive System's weakness research project if player lost too many ships
country_event = {
	id = ag_beta.111
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		ag_beta_psionic_effect_event_active = yes
		from = {
			is_country_type = ag_ancient_beta_guardian
			has_country_flag = ag_ancient_beta_guardian_country
			is_same_value = event_target:ag_ancient_beta_guardian_country
		}
		is_ai = no
		NOT = { has_country_flag = ag_has_ancient_beta_weakness }
	}
	
	immediate = {
		if = {
			limit = {
				check_variable = {
					which = ag_ancient_beta_guardian_killcount
					value < 1
				}
			}
			set_variable = {
				which = ag_ancient_beta_guardian_killcount
				value = 1
			}
		}
		fromfrom = {
			root = {
				ag_hostile_kill_counter = {
					ag_variable_name = ag_ancient_beta_guardian_killcount
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = ag_ancient_beta_guardian_killcount
					value > 512
				}
				ag_beta_psionic_effect_event_active = yes
				NOT = { has_country_flag = ag_has_ancient_beta_weakness }
			}
			set_variable = {
				which = ag_ancient_beta_guardian_killcount
				value = 512
			}
			random_list = {
				25 = {
					country_event = {
						id = ag_beta.112
						days = 30
						random = 30
					}
					set_country_flag = ag_has_ancient_beta_weakness
				}
				75 = {
				}
			}
		}
	}
}
country_event = {
	id = ag_beta.112
	title = "ag_beta.112.name"
	desc = "ag_beta.112.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes

	trigger = {
		ag_beta_psionic_effect_event_active = yes
	}
	
	option = {
		name = "ag_beta.112.a"
		enable_special_project = {
			name = "ag_find_ancient_beta_weakness"
			location = capital_scope
			owner = root
		}
	}
	option = {
		name = "ag_beta.112.b"
		add_resource = { influence = @ag_end_event_influence_large }
	}
}
country_event = {
	id = ag_beta.113
	title = "ag_beta.113.name"
	desc = "ag_beta.113.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.113.a"
		if = {
			limit = {
				NOT = {
					has_modifier = ag_ancient_beta_weakness
				}
			}
			add_modifier = {
				modifier = ag_ancient_beta_weakness
				days = -1
			}
		}
	}
}

# on_ship_destroyed_victim, Give Ancient Signal Station Defensive System's weakness research project if player lost too many ships
country_event = {
	id = ag_beta.114
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		ag_beta_psionic_effect_event_active = yes
		from = { is_country_type = ag_ancient_beta_signal_station_guardian }
		is_ai = no
		NOT = { has_country_flag = ag_has_ancient_beta_signal_station_weakness }
	}
	
	immediate = {
		if = {
			limit = {
				check_variable = {
					which = ag_ancient_beta_signal_station_guardian_killcount
					value < 1
				}
			}
			set_variable = {
				which = ag_ancient_beta_signal_station_guardian_killcount
				value = 1
			}
		}
		fromfrom = {
			root = {
				ag_hostile_kill_counter = {
					ag_variable_name = ag_ancient_beta_signal_station_guardian_killcount
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = ag_ancient_beta_signal_station_guardian_killcount
					value > 512
				}
				ag_beta_psionic_effect_event_active = yes
				NOT = { has_country_flag = ag_has_ancient_beta_signal_station_weakness }
			}
			set_variable = {
				which = ag_ancient_beta_signal_station_guardian_killcount
				value = 512
			}
			random_list = {
				25 = {
					country_event = {
						id = ag_beta.115
						days = 30
						random = 30
					}
					set_country_flag = ag_has_ancient_beta_signal_station_weakness
				}
				75 = {
				}
			}
		}
	}
}
country_event = {
	id = ag_beta.115
	title = "ag_beta.115.name"
	desc = "ag_beta.115.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_sabotaged_ship_room }
	show_sound = event_yellow_alert
	
	is_triggered_only = yes

	trigger = {
		ag_beta_psionic_effect_event_active = yes
	}
	
	option = {
		name = "ag_beta.115.a"
		enable_special_project = {
			name = "ag_find_ancient_beta_signal_station_weakness"
			location = capital_scope
			owner = root
		}
	}
	option = {
		name = "ag_beta.115.b"
		add_resource = { influence = @ag_end_event_influence_large }
	}
}
country_event = {
	id = ag_beta.116
	title = "ag_beta.116.name"
	desc = "ag_beta.116.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	
	is_triggered_only = yes

	option = {
		name = "ag_beta.116.a"
		if = {
			limit = {
				NOT = {
					has_modifier = ag_ancient_beta_signal_station_weakness
				}
			}
			add_modifier = {
				modifier = ag_ancient_beta_signal_station_weakness
				days = -1
			}
		}
	}
}

# Reward events' gatekeeper, Ancient Archive research breakthrought
# country_event = {
	# id = ag_beta.120
	# title = "ag_beta.120.name"
	# desc = "ag_beta.120.desc"
	# diplomatic = yes
	# custom_gui = "ag_ancient_event_window"
	# custom_gui_option = "ag_ancient_event_option"
	# picture_event_data = { room = ag_event_excavation_team_room }
	# show_sound = event_mystic_reveal
	# location = event_target:ag_ancient_beta_shielded_world
	
	# mean_time_to_happen = {
		# months = @ag_event_reward_mtth_short
		# modifier = { factor = 0.5 has_country_flag = ag_ancient_beta_data_flag }
	# }
	
	# trigger = {
		# has_global_flag = ag_aneient_beta_psionic_effect_ended
		# NOT = { has_country_flag = ag_beta_120_fired }
		# exists = event_target:ag_ancient_beta_shielded_world
		# event_target:ag_ancient_beta_shielded_world = {
			# exists = owner
			# owner = { is_same_value = root }
			# has_building = ag_ancient_beta_archive
			# has_ground_combat = no
			# ag_has_researcher = yes
		# }
	# }
	
	# immediate = {
		# set_country_flag = ag_beta_120_fired
		# random_list = {
			# 10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 1 } }
			# 10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 1.5 } }
			# 10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 2 } }
			# 10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 2.5 } }
			# 10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 3 } }
		# }
		# random_list = {
			# 10 = { change_variable = { which = ag_ancient_knowledge_common_var value = 0.25 } }
			# 10 = { change_variable = { which = ag_ancient_knowledge_common_var value = 0.125 } }
			# 10 = { subtract_variable = { which = ag_ancient_knowledge_common_var value = 0.25 } }
			# 10 = { subtract_variable = { which = ag_ancient_knowledge_common_var value = 0.125 } }
			# 10 = { }
		# }
	# }
	# after = { hidden_effect = { clear_variable = ag_ancient_knowledge_common_var } }
	
	# option = {
		# name = "ag_beta.120.a"
		# ag_add_ancient_knowledge = {
			# ag_value = ag_ancient_knowledge_common_var
			# ag_notification_desc = ""
		# }
	# }
# }

# Reward event, Ancient Station, defensive platforms
country_event = {
	id = ag_beta.121
	title = "ag_beta.121.name"
	desc = "ag_beta.121.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	location = event_target:ag_ancient_beta_shielded_world
	is_triggered_only = yes
	option = {
		name = "ag_beta.121.a"
		ag_add_research_option = { ag_tech = tech_ag_beta_station_type1 }
		hidden_effect = { country_event = { id = ag_beta.128 days = 20 random = 20 } }
	}
}

# Reward event, Ancient Station, megastructure
country_event = {
	id = ag_beta.122
	title = "ag_beta.122.name"
	desc = "ag_beta.122.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_finding_loot
	location = event_target:ag_ancient_beta_shielded_world
	is_triggered_only = yes
	immediate = { set_country_flag = ag_beta_122_fired }
	option = {
		name = "ag_beta.122.a"
		ag_add_research_option = { ag_tech = tech_ag_beta_station_type2 }
	}
}

# Construction Sections Project
country_event = {
	id = ag_beta.123
	title = "ag_beta.123.name"
	desc = {
		trigger = { NOT = { has_country_flag = ag_known_construction_section } }
		text = "ag_beta.123.a.desc"
	}
	desc = {
		trigger = { has_country_flag = ag_known_construction_section }
		text = "ag_beta.123.b.desc"
	}
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ringworld_room }
	show_sound = event_finding_loot
	location = event_target:ag_ancient_beta_shielded_world
	is_triggered_only = yes
	immediate = {
		event_target:ag_ancient_beta_shielded_world = { solar_system = { random_system_planet = {
			limit = { has_planet_flag = ag_ancient_construction_section_0 }
			save_event_target_as = ag_ancient_construction_section_loc
		} } }
	}
	option = {
		name = "ag_beta.123.a"
		enable_special_project = {
			name = "ag_beta_construction_section"
			location = event_target:ag_ancient_construction_section_loc
			owner = root.owner
		}
		ai_chance = { factor = 1000 }
	}
	option = {
		name = "ag_beta.123.b"
		add_resource = { influence = @ag_end_event_influence_medium }
		ai_chance = { factor = 0 }
	}
}
country_event = {
	id = ag_beta.124
	title = "ag_beta.124.name"
	desc = "ag_beta.124.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ringworld_room }
	show_sound = event_think_tank_build_complete
	location = from
	is_triggered_only = yes
	immediate = {
		set_global_flag = ag_beta_construction_section_unlocked
		set_country_flag = ag_known_construction_section
		event_target:ag_ancient_beta_shielded_world = { solar_system = {
			ag_spawn_ancient_construction_section = yes
		} }
	}
	option = { name = "ag_beta.124.a" }
}

# Reward event, Unlocks Ancient Ships
# country_event = {
	# id = ag_beta.125
	# title = "ag_beta.125.name"
	# desc = "ag_beta.125.desc"
	# diplomatic = yes
	# custom_gui = "ag_ancient_event_window"
	# custom_gui_option = "ag_ancient_event_option"
	# picture_event_data = { room = ag_event_ancient_AI_room }
	# show_sound = event_mystic_reveal
	
	# mean_time_to_happen = {
		# years = @ag_event_reward_mtth
		# modifier = { factor = 0.5 has_country_flag = ag_ancient_beta_data_flag }
		# modifier = { factor = 0.5 has_country_flag = ag_has_ancient_code }
	# }
	
	# trigger = {
		# NOR = {
			# has_country_flag = ag_beta_ships_unlocked
			# has_country_flag = ag_beta_125_fired
		# }
		# any_controlled_ship = {
			# OR = {
				# is_ship_size = ag_beta_station_type1_0
				# is_ship_size = ag_beta_station_type2_0
			# }
		# }
		# any_owned_planet = {
			# has_building = ag_ancient_beta_archive
			# is_same_value = event_target:ag_ancient_beta_shielded_world
		# }
	# }
	# immediate = { set_country_flag = ag_beta_125_fired }
	# option = {
		# name = "ag_beta.125.a"
		# custom_tooltip = "ag_beta.125.a.tooltip"
		# hidden_effect = {
			# ag_give_research_project = { ag_project_id = @ag_beta_ship_unlock_project_id }
			# if = {
				# limit = { is_ai = yes }
				# country_event = { id = ag_beta.126 days = 1800 }
			# }
		# }
		# ai_chance = { factor = 1000 }
	# }
	# option = {
		# name = "ag_beta.125.b"
		# add_resource = { influence = @ag_end_event_influence_medium }
		# ai_chance = { factor = 0 }
	# }
# }
country_event = {
	id = ag_beta.126
	title = "ag_beta.126.name"
	desc = "ag_beta.126.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = ag_has_ancient_code
		country_event = { id = ag_beta.127 days = 5 random = 55 }
	}
	
	option = { name = "ag_beta.126.a" }
}

# Upgrade Ancient Ships
country_event = {
    id = ag_beta.127
    hide_window = yes
	is_triggered_only = yes
	
	trigger = { has_country_flag = ag_beta_ships_unlocked }
	
	immediate = {
		set_country_flag = ag_beta_127_fired
		if = {
			limit = {
				any_controlled_ship = {
					is_ship_size = ag_beta_station_type1_0
				}
			}
			while = {
				limit = {
					any_controlled_ship = {
						is_ship_size = ag_beta_station_type1_0
					}
				}
				random_controlled_ship = {
					limit = {
						is_ship_size = ag_beta_station_type1_0
					}
					ag_spawn_explosion_effect = { ag_scale = xl ag_color = red }
					create_fleet = {
						name = "NAME_ag_beta_station_type1_fleet"
						settings = {
							can_upgrade = no 
							can_change_composition = no 
							can_change_leader = no 
							spawn_debris = no 
						}
						effect = {
							set_fleet_flag = ag_beta_station_type1_player
							set_owner = from
							create_ship = {
								name = "NAME_ag_beta_station_type1_ship"
								design = "NAME_ag_beta_station_type1_1"
								prefix = no
								effect = {
									ag_difficulty_bonus = yes
									if = {
										limit = { prevprev = { has_ship_flag = ag_beta_station_loc_1 } }
										set_ship_flag = ag_beta_station_loc_1
									}
									else_if = {
										limit = { prevprev = { has_ship_flag = ag_beta_station_loc_2 } }
										set_ship_flag = ag_beta_station_loc_2
									}
									else_if = {
										limit = { prevprev = { has_ship_flag = ag_beta_station_loc_3 } }
										set_ship_flag = ag_beta_station_loc_3
									}
									else_if = {
										limit = { prevprev = { has_ship_flag = ag_beta_station_loc_4 } }
										set_ship_flag = ag_beta_station_loc_4
									}
									else_if = {
										limit = { prevprev = { has_ship_flag = ag_beta_station_loc_5 } }
										set_ship_flag = ag_beta_station_loc_5
									}
									else_if = {
										limit = { prevprev = { has_ship_flag = ag_beta_station_loc_6 } }
										set_ship_flag = ag_beta_station_loc_6
									}
								}
							}
							set_location = {
								target = prev
								distance = 0
								angle = 0
							}
						}
					}
					delete_ship = this
				}
			}
		}
	}
}

# Reward event, Psionic Weapons
country_event = {
	id = ag_beta.128
	title = "ag_beta.128.name"
	desc = "ag_beta.128.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_finding_loot
	location = event_target:ag_ancient_beta_shielded_world
	is_triggered_only = yes
	immediate = { set_country_flag = ag_beta_128_fired }
	option = {
		name = "ag_beta.128.a"
		ag_add_research_option = { ag_tech = tech_ag_beta_psi_weapon_1 }
		hidden_effect = { country_event = { id = ag_beta.172 days= 20 random = 20 } }
		ai_chance = { factor = 1000 }
	}
	option = {
		name = "ag_beta.128.b"
		add_resource = { influence = @ag_end_event_influence_medium }
		ai_chance = { factor = 0 }
	}
}

# Built Ancient Relay Station (Megastructure) first time
country_event = {
	id = ag_beta.131
	title = "ag_beta.131.name"
	desc = "ag_beta.131.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	option = {
		name = "ag_beta.131.a"
	}
}
country_event = {
	id = ag_beta.1311
	hide_window = yes
	is_triggered_only = yes
	trigger = { last_increased_tech = tech_ag_beta_station_type1 }
	immediate = {
		create_ship_design = { design = "NAME_ag_beta_station_type1_dummy" }
		add_ship_design = last_created_design
		create_ship_design = { design = "NAME_ag_beta_station_type1_dummy_alt" }
		add_ship_design = last_created_design
	}
}

# Built Ancient Signal Station
country_event = {
	id = ag_beta.132
	title = "ag_beta.132.name"
	desc = "ag_beta.132.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_megastructure_construction_room }
	show_sound = event_dyson_sphere_build_complete
	location = fromfromfrom
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = ag_beta_132_fired } }
	immediate = { set_country_flag = ag_beta_132_fired }
	option = {
		name = "ag_beta.132.a"
		custom_tooltip = "ag_beta.132.a.tooltip"
	}
}

# on_ship_bulit, spawn Ancient Relay Station in system
ship_event = {
	id = ag_beta.133
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = { OR = {
		is_ship_size = ag_beta_station_type1_dummy
		is_ship_size = ag_beta_station_type1_dummy_alt
	} }
	
	immediate = {
		if = {
			limit = { is_ship_size = ag_beta_station_type1_dummy }
			solar_system = {
				space_owner = { save_event_target_as = ag_station_owner }
				if = {
					limit = { NOT = { any_ship_in_system = { has_ship_flag = ag_beta_station_loc_1 } } }
					random_system_planet = {
						limit = { is_primary_star = yes }
						ag_player_relay_station_spawn = {
							ag_owner = event_target:ag_station_owner
							ag_ship_flag = ag_beta_station_loc_1
							ag_angle = 0
						}
					}
				}
				else = {
					if = {
						limit = { NOT = { any_ship_in_system = { has_ship_flag = ag_beta_station_loc_2 } } }
						random_system_planet = {
							limit = { is_primary_star = yes }
							ag_player_relay_station_spawn = {
								ag_owner = event_target:ag_station_owner
								ag_ship_flag = ag_beta_station_loc_2
								ag_angle = 60
							}
						}
					}
					else = {
						if = {
							limit = { NOT = { any_ship_in_system = { has_ship_flag = ag_beta_station_loc_3 } } }
							random_system_planet = {
								limit = { is_primary_star = yes }
								ag_player_relay_station_spawn = {
									ag_owner = event_target:ag_station_owner
									ag_ship_flag = ag_beta_station_loc_3
									ag_angle = 120
								}
							}
						}
						else = {
							if = {
								limit = { NOT = { any_ship_in_system = { has_ship_flag = ag_beta_station_loc_4 } } }
								random_system_planet = {
									limit = { is_primary_star = yes }
									ag_player_relay_station_spawn = {
										ag_owner = event_target:ag_station_owner
										ag_ship_flag = ag_beta_station_loc_4
										ag_angle = 180
									}
								}
							}
							else = {
								if = {
									limit = { NOT = { any_ship_in_system = { has_ship_flag = ag_beta_station_loc_5 } } }
									random_system_planet = {
										limit = { is_primary_star = yes }
										ag_player_relay_station_spawn = {
											ag_owner = event_target:ag_station_owner
											ag_ship_flag = ag_beta_station_loc_5
											ag_angle = 240
										}
									}
								}
								else = {
									if = {
										limit = { NOT = { any_ship_in_system = { has_ship_flag = ag_beta_station_loc_6 } } }
										random_system_planet = {
											limit = { is_primary_star = yes }
											ag_player_relay_station_spawn = {
												ag_owner = event_target:ag_station_owner
												ag_ship_flag = ag_beta_station_loc_6
												ag_angle = 300
											}
										}
									}
								}
							}
						}
					}
				}
			}
			delete_ship = this
		}
		else = {
			owner = {
				if = {
					limit = { NOT = { has_country_flag = ag_beta_station_type1_built } }
					set_country_flag = ag_beta_station_type1_built
					country_event = { id = ag_beta.131 }
				}
				if = {
					limit = { NOT = { is_variable_set = ag_num_beta_station_type1_cores } }
					set_variable = { which = ag_num_beta_station_type1_cores value = 1 }
				}
				else = { change_variable = { which = ag_num_beta_station_type1_cores value = 1 } }
			}
			delete_ship = this
			delete_fleet = { target = this.fleet kill_leader = yes destroy_template = yes }
		}
	}
}

# Reward event, Upgrade Psionic Weapons
country_event = {
	id = ag_beta.134
	hide_window = yes
	
	mean_time_to_happen = {
		years = 4
		modifier = {
			factor = 0.5
			any_owned_megastructure = {
				OR = {
					is_megastructure_type = think_tank_3
					is_megastructure_type = think_tank_4
					is_megastructure_type = think_tank_restored
				}
			}
		}
		modifier = { factor = 0.5 has_ascension_perk = ap_technological_ascendancy }
	}
	
	trigger = {
		has_country_flag = ag_beta_128_fired
		has_technology = tech_ag_beta_psi_weapon_1
		NOT = { has_country_flag = ag_beta_134_fired }
		any_owned_megastructure = { is_megastructure_type = ag_beta_station_type2_megastructure }
	}
	
	immediate = {
		set_country_flag = ag_beta_134_fired
	}
}

# Notification for Psionic Signal Station's Abilities is available
country_event = {
	id = ag_beta.140
	title = "ag_beta.140.name"
	desc = "ag_beta.140.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = "ag_beta.140.a"
		ag_add_research_option = { ag_tech = tech_ag_beta_station_type2_effect }
	}
}

# Psionic Signal Station's Abilities
country_event = {
	id = ag_beta.141
	title = "ag_beta.141.name"
	desc = "ag_beta.141.desc"

	is_triggered_only = yes

	diplomatic = yes
	force_open = yes
	custom_gui = "ag_beta_psionic_station_window"
	custom_gui_option = "ag_beta_psionic_station_option"
	
	picture_event_data = {
		portrait = shroud1
		room = shroud_room
	}

	after = { hidden_effect = { remove_country_flag = ag_beta_psionic_signal_station_window_opened } }
	
	option = {
		name = "ag_beta.141.a"
		allow = {
			custom_tooltip = { fail_text = "ag_beta_station_requires_attack_type" is_variable_set = ag_beta_psionic_station_attack_type }
			custom_tooltip = { fail_text = "ag_beta_station_requires_attack_range" is_variable_set = ag_beta_psionic_station_attack_range }
			custom_tooltip = {
				fail_text = "ag_beta_station_requires_attack_target"
				OR = {
					check_variable = { which = ag_beta_psionic_station_attack_range value = 5 }
					AND = {
						exists = event_target:ag_beta_psionic_station_target_1
						OR = {
							NOT = { check_variable = { which = ag_beta_psionic_station_attack_range value = 2 } }
							exists = event_target:ag_beta_psionic_station_target_2
						}
					}
				}
			}
			resource_stockpile_compare = { resource = energy value >= 2500 mult = ag_beta_psionic_station_attack_type_lvl }
			resource_stockpile_compare = { resource = sr_zro value >= 1200 mult = ag_beta_psionic_station_attack_type_lvl }
		}
		add_resource = { energy = -2500 sr_zro = -1200 mult = ag_beta_psionic_station_attack_type_lvl }
		hidden_effect = {
			# Cooldown
			set_timed_country_flag = { flag = ag_beta_psionic_signal_station_cooldown days = @ag_beta_psionic_signal_cooldown_days }
			country_event = { id = ag_beta.162 days = @ag_beta_psionic_signal_cooldown_days }
			# Side effects
			event_target:ag_ancient_beta_star.solar_system = {
				if = {
					limit = { NOR = {
						has_star_flag = ag_beta_psionic_system_1
						has_star_flag = ag_beta_psionic_system_2
						has_star_flag = ag_beta_psionic_system_3
					} }
					ag_beta_psionic_system_effect = { ag_level = 3 }
					system_event = { id = ag_beta.161 days = 180 random = 180 }
				}
				every_neighbor_system = {
					limit = {
						has_hyperlane_to = prev
						NOR = {
							has_star_flag = ag_beta_psionic_system_1
							has_star_flag = ag_beta_psionic_system_2
							has_star_flag = ag_beta_psionic_system_3
						}
					}
					ag_beta_psionic_system_effect = { ag_level = 3 }
					system_event = { id = ag_beta.161 days = 150 random = 150 }
				}
			}
			while = {
				count = 3
				random_system_within_border = {
					limit = { NOR = {
						has_star_flag = ag_beta_psionic_system_1
						has_star_flag = ag_beta_psionic_system_2
						has_star_flag = ag_beta_psionic_system_3
					} }
					ag_beta_psionic_system_effect = { ag_level = 3 }
					system_event = { id = ag_beta.161 days = 120 random = 120 }
					weights = { base = 10 modifier = { factor = 10 any_system_planet = { exists = owner owner = { is_same_value = root } } } }
				}
			}
			# Effects on target(s)
			if = { limit = { exists = event_target:ag_beta_psionic_station_target_1 } event_target:ag_beta_psionic_station_target_1 = { save_event_target_as = ag_target_system } }
			if = { limit = { exists = event_target:ag_beta_psionic_station_target_2 } event_target:ag_beta_psionic_station_target_2 = { save_event_target_as = ag_target_system_alt } }
			random_list = {
				60 = {
					modifier = { add = -3 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 1 } }
					modifier = { add = -3 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 2 } }
					modifier = { add = -3 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 3 } }
					modifier = { add = -3 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 4 } }
					modifier = { add = -3 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 5 } }
					country_event = { id = ag_beta.145 }
				}
				20 = {
					modifier = { add = 2 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 1 } }
					modifier = { add = 2 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 2 } }
					modifier = { add = 2 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 3 } }
					modifier = { add = 2 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 4 } }
					modifier = { add = 2 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 5 } }
					event_target:global_event_country = { country_event = { id = ag_beta.145 } }
				}
				20 = {
					modifier = { add = 1 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 1 } }
					modifier = { add = 1 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 2 } }
					modifier = { add = 1 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 3 } }
					modifier = { add = 1 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 4 } }
					modifier = { add = 1 check_variable = { which = ag_beta_psionic_station_attack_type_lvl value > 5 } }
					country_event = { id = ag_beta.155 }
					every_playable_country = { limit = { NOT = { is_same_value = root } } country_event = { id = ag_beta.158 } }
				}
			}
			reroll_random = yes
		}
	}
	option = { 
		name = "ag_beta.141.b" default_hide_option = yes
		hidden_effect = {
			if = { limit = { is_variable_set = ag_beta_psionic_station_attack_type } clear_variable = ag_beta_psionic_station_attack_type }
			if = { limit = { is_variable_set = ag_beta_psionic_station_attack_type_lvl } clear_variable = ag_beta_psionic_station_attack_type_lvl }
			if = { limit = { is_variable_set = ag_beta_psionic_station_attack_range } clear_variable = ag_beta_psionic_station_attack_range }
			if = { limit = { exists = event_target:ag_beta_psionic_station_target_1 } clear_global_event_target = ag_beta_psionic_station_target_1 }
			if = { limit = { exists = event_target:ag_beta_psionic_station_target_2 } clear_global_event_target = ag_beta_psionic_station_target_2 }
		}
	}
}
country_event = {
	id = ag_beta.142
	title = "ag_beta.142.name"
	desc = "ag_beta.141.desc"
	diplomatic = yes
	custom_gui = "ag_beta_station_selector_window"
	custom_gui_option = "ag_beta_station_selector_option"
	picture_event_data = { room = ag_event_throne_room }
	is_triggered_only = yes
	after = { hidden_effect = { remove_country_flag = ag_beta_station_attack_type_selector_opened } }
	option = {
		name = "ag_attack_type_1"
		custom_tooltip = "ag_attack_type_1_desc"
		default_hide_option = yes
		hidden_effect = {
			set_variable = { which = ag_beta_psionic_station_attack_type value = 1 }
			set_variable = { which = ag_beta_psionic_station_attack_type_lvl value = 1 }
			if = {
				limit = { is_variable_set = ag_beta_psionic_station_attack_range check_variable = { which = ag_beta_psionic_station_attack_range value = 5 } }
				clear_variable = ag_beta_psionic_station_attack_range
			}
		}
	}
	option = {
		name = "ag_attack_type_2"
		custom_tooltip = "ag_attack_type_2_desc"
		hidden_effect = {
			set_variable = { which = ag_beta_psionic_station_attack_type value = 2 }
			set_variable = { which = ag_beta_psionic_station_attack_type_lvl value = 1 }
			if = {
				limit = { is_variable_set = ag_beta_psionic_station_attack_range check_variable = { which = ag_beta_psionic_station_attack_range value = 5 } }
				clear_variable = ag_beta_psionic_station_attack_range
			}
		}
	}
	option = {
		name = "ag_attack_type_3"
		custom_tooltip = "ag_attack_type_3_desc"
		hidden_effect = {
			set_variable = { which = ag_beta_psionic_station_attack_type value = 3 }
			set_variable = { which = ag_beta_psionic_station_attack_type_lvl value = 1 }
			if = {
				limit = { is_variable_set = ag_beta_psionic_station_attack_range check_variable = { which = ag_beta_psionic_station_attack_range value = 5 } }
				clear_variable = ag_beta_psionic_station_attack_range
			}
		}
	}
	option = {
		name = "ag_attack_type_4"
		custom_tooltip = "ag_attack_type_4_desc"
		hidden_effect = {
			set_variable = { which = ag_beta_psionic_station_attack_type value = 4 }
			set_variable = { which = ag_beta_psionic_station_attack_type_lvl value = 1 }
			if = {
				limit = { is_variable_set = ag_beta_psionic_station_attack_range check_variable = { which = ag_beta_psionic_station_attack_range value = 5 } }
				clear_variable = ag_beta_psionic_station_attack_range
			}
		}
	}
	option = {
		name = "ag_attack_type_5"
		custom_tooltip = "ag_attack_type_5_desc"
		hidden_effect = {
			set_variable = { which = ag_beta_psionic_station_attack_type value = 5 }
			set_variable = { which = ag_beta_psionic_station_attack_type_lvl value = 1 }
			if = {
				limit = { is_variable_set = ag_beta_psionic_station_attack_range check_variable = { which = ag_beta_psionic_station_attack_range value = 5 } }
				clear_variable = ag_beta_psionic_station_attack_range
			}
		}
	}
	option = {
		name = "ag_attack_type_6"
		custom_tooltip = "ag_attack_type_6_desc"
		hidden_effect = {
			set_variable = { which = ag_beta_psionic_station_attack_type value = 6 }
			set_variable = { which = ag_beta_psionic_station_attack_type_lvl value = 1 }
			if = {
				limit = { is_variable_set = ag_beta_psionic_station_attack_range check_variable = { which = ag_beta_psionic_station_attack_range value = 5 } }
				clear_variable = ag_beta_psionic_station_attack_range
			}
		}
	}
	option = {
		name = "ag_attack_type_7"
		custom_tooltip = "ag_attack_type_7_desc"
		trigger = { has_global_flag = ag_zeta_crisis_stage_2 NOT = { has_global_flag = ag_zeta_crisis_ended } }
		hidden_effect = {
			set_variable = { which = ag_beta_psionic_station_attack_type value = 7 }
			set_variable = { which = ag_beta_psionic_station_attack_type_lvl value = 1 }
			if = {
				limit = { is_variable_set = ag_beta_psionic_station_attack_range NOT = { check_variable = { which = ag_beta_psionic_station_attack_range value = 5 } } }
				clear_variable = ag_beta_psionic_station_attack_range
			}
		}
	}
}
country_event = {
	id = ag_beta.143
	title = "ag_beta.143.name"
	desc = "ag_beta.141.desc"
	diplomatic = yes
	custom_gui = "ag_beta_station_selector_window"
	custom_gui_option = "ag_beta_station_selector_option"
	picture_event_data = { room = ag_event_throne_room }
	is_triggered_only = yes
	after = { hidden_effect = { remove_country_flag = ag_beta_station_attack_range_selector_opened } }
	option = {
		name = "ag_attack_range_1"
		custom_tooltip = "ag_attack_range_1_desc"
		default_hide_option = yes
		trigger = { NAND = { is_variable_set = ag_beta_psionic_station_attack_type check_variable = { which = ag_beta_psionic_station_attack_type value = 7 } } }
		hidden_effect = { set_variable = { which = ag_beta_psionic_station_attack_range value = 1 } }
	}
	option = {
		name = "ag_attack_range_2"
		custom_tooltip = "ag_attack_range_2_desc"
		trigger = { NAND = { is_variable_set = ag_beta_psionic_station_attack_type check_variable = { which = ag_beta_psionic_station_attack_type value = 7 } } }
		hidden_effect = { set_variable = { which = ag_beta_psionic_station_attack_range value = 2 } }
	}
	option = {
		name = "ag_attack_range_3"
		custom_tooltip = "ag_attack_range_3_desc"
		trigger = { NAND = { is_variable_set = ag_beta_psionic_station_attack_type check_variable = { which = ag_beta_psionic_station_attack_type value = 7 } } }
		hidden_effect = { set_variable = { which = ag_beta_psionic_station_attack_range value = 3 } }
	}
	option = {
		name = "ag_attack_range_4"
		custom_tooltip = "ag_attack_range_4_desc"
		trigger = { NAND = { is_variable_set = ag_beta_psionic_station_attack_type check_variable = { which = ag_beta_psionic_station_attack_type value = 7 } } }
		hidden_effect = { set_variable = { which = ag_beta_psionic_station_attack_range value = 4 } }
	}
	option = {
		name = "ag_attack_range_5"
		custom_tooltip = "ag_attack_range_5_desc"
		trigger = { is_variable_set = ag_beta_psionic_station_attack_type check_variable = { which = ag_beta_psionic_station_attack_type value = 7 } }
		hidden_effect = {
			set_variable = { which = ag_beta_psionic_station_attack_range value = 5 }
			if = { limit = { exists = event_target:ag_beta_psionic_station_target_1 } clear_global_event_target = ag_beta_psionic_station_target_1 }
			if = { limit = { exists = event_target:ag_beta_psionic_station_target_2 } clear_global_event_target = ag_beta_psionic_station_target_2 }
		}
	}
}
country_event = {
	id = ag_beta.144
	hide_window = yes
	is_triggered_only = yes
	trigger = { has_country_flag = ag_enabled_beta_psionic_station_target_selector }
	immediate = {
		remove_country_flag = ag_enabled_beta_psionic_station_target_selector
		if = { limit = { exists = event_target:ag_beta_psionic_station_target_1 } clear_global_event_target = ag_beta_psionic_station_target_1 }
		if = { limit = { exists = event_target:ag_beta_psionic_station_target_2 } clear_global_event_target = ag_beta_psionic_station_target_2 }
		every_system = {
			limit = { has_star_flag = ag_system_selector_selected_system }
			remove_star_flag = ag_system_selector_selected_system
			if = { limit = { NOT = { exists = event_target:ag_beta_psionic_station_target_1 } } save_global_event_target_as = ag_beta_psionic_station_target_1 }
			else_if = { limit = { NOT = { exists = event_target:ag_beta_psionic_station_target_2 } } save_global_event_target_as = ag_beta_psionic_station_target_2 }
		}
	}
	after = {
		ag_system_selector_after_effect = yes
		ag_clear_system_selection = yes
	}
}
country_event = {
	id = ag_beta.145
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		ag_beta_psionic_station_effect_spawn = yes
		if = { limit = { is_same_value = from } country_event = { id = ag_beta.153 } }
		else = { from = { country_event = { id = ag_beta.154 } } }
		every_playable_country = {
			limit = { NOR = { is_same_value = root.from has_country_flag = ag_beta_psionic_station_noti } }
			country_event = { id = ag_beta.156 }
		}
	}
	after = { hidden_effect = { from = {
		if = { limit = { is_variable_set = ag_beta_psionic_station_attack_type } clear_variable = ag_beta_psionic_station_attack_type }
		if = { limit = { is_variable_set = ag_beta_psionic_station_attack_type_lvl } clear_variable = ag_beta_psionic_station_attack_type_lvl }
		if = { limit = { is_variable_set = ag_beta_psionic_station_attack_range } clear_variable = ag_beta_psionic_station_attack_range }
		if = { limit = { exists = event_target:ag_beta_psionic_station_target_1 } clear_global_event_target = ag_beta_psionic_station_target_1 }
		if = { limit = { exists = event_target:ag_beta_psionic_station_target_2 } clear_global_event_target = ag_beta_psionic_station_target_2 }
	} } }
}

# Triggered by event, Psionic Station's system effect
fleet_event = {
	id = ag_beta.151
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		if = {
			limit = { exists = from from = { is_scope_type = ambient_object exists = solar_system } }
			if = {
				limit = {
					from.solar_system = {
						has_star_flag = ag_beta_psionic_station_effect_1
						NOT = { has_star_flag = ag_beta_psionic_station_effect_1_@root.owner }
					}
					owner = { NOR = {
						is_country_type = ag_zeta_crisis_country
						is_country_type = ag_zeta_crisis_portal_holder
						is_country_type = ag_zeta_crisis_relic_country
						is_country_type = shroud
						is_country_type = shroud_spirits
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
					} }
				}
				clear_orders = yes
				clear_fleet_actions = this
				set_location = from fleet_event = { id = ag_beta.151 days = 1 scopes = { from = from } }
			}
			else = { if = { limit = { exists = from from = { is_scope_type = ambient_object } } destroy_ambient_object = from } }
			if = {
				limit = {
					from.solar_system = {
						has_star_flag = ag_beta_psionic_station_effect_6
						NOT = { has_star_flag = ag_beta_psionic_station_effect_6_@root.owner }
					}
					owner = { NOR = {
						is_country_type = ag_zeta_crisis_country
						is_country_type = ag_zeta_crisis_portal_holder
						is_country_type = ag_zeta_crisis_relic_country
						is_country_type = shroud
						is_country_type = shroud_spirits
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
					} }
				}
				clear_orders = yes
				clear_fleet_actions = this
				set_location = from fleet_event = { id = ag_beta.151 days = 1 scopes = { from = from } }
			}
			else = {
				if = { limit = { exists = from from = { is_scope_type = ambient_object } } destroy_ambient_object = from }
				if = { limit = { has_fleet_flag = ag_beta_station_fleet_event_locked } remove_fleet_flag = ag_beta_station_fleet_event_locked set_event_locked = no }
			}
		}
		else = {
			if = {
				limit = { has_fleet_flag = ag_beta_psionic_station_effect_3 }
				if = {
					limit = { NAND = {
						exists = solar_system
						solar_system = {
							has_star_flag = ag_beta_psionic_station_effect_3
							NOT = { has_star_flag = ag_beta_psionic_station_effect_3_@root.owner }
						}
						owner = { NOR = {
							is_country_type = ag_zeta_crisis_country
							is_country_type = ag_zeta_crisis_portal_holder
							is_country_type = ag_zeta_crisis_relic_country
							is_country_type = shroud
							is_country_type = shroud_spirits
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
						} }
					} }
					remove_fleet_flag = ag_beta_psionic_station_effect_3
					every_controlled_ship = {
						while = { limit = { has_modifier = "ag_beta_psionic_station_regen_buff_static" } remove_modifier = "ag_beta_psionic_station_regen_buff_static" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_regen_buff_perc" } remove_modifier = "ag_beta_psionic_station_regen_buff_perc" }
					}
				}
				else = { fleet_event = { id = ag_beta.151 days = 1 } }
			}
			if = {
				limit = { has_fleet_flag = ag_beta_psionic_station_effect_4 }
				if = {
					limit = { NAND = {
						exists = solar_system
						solar_system = {
							has_star_flag = ag_beta_psionic_station_effect_4
							NOT = { has_star_flag = ag_beta_psionic_station_effect_4_@root.owner }
						}
						owner = { NOR = {
							is_country_type = ag_zeta_crisis_country
							is_country_type = ag_zeta_crisis_portal_holder
							is_country_type = ag_zeta_crisis_relic_country
							is_country_type = shroud
							is_country_type = shroud_spirits
							is_country_type = extradimensional
							is_country_type = extradimensional_2
							is_country_type = extradimensional_3
						} }
					} }
					remove_fleet_flag = ag_beta_psionic_station_effect_4
					every_controlled_ship = {
						while = { limit = { has_modifier = "ag_beta_psionic_station_energy_damage" } remove_modifier = "ag_beta_psionic_station_energy_damage" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_energy_fire_rate" } remove_modifier = "ag_beta_psionic_station_energy_fire_rate" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_kinetic_damage" } remove_modifier = "ag_beta_psionic_station_kinetic_damage" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_kinetic_fire_rate" } remove_modifier = "ag_beta_psionic_station_kinetic_fire_rate" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_explosive_damage" } remove_modifier = "ag_beta_psionic_station_explosive_damage" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_explosive_fire_rate" } remove_modifier = "ag_beta_psionic_station_explosive_fire_rate" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_strike_craft_damage" } remove_modifier = "ag_beta_psionic_station_strike_craft_damage" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_strike_craft_fire_rate" } remove_modifier = "ag_beta_psionic_station_strike_craft_fire_rate" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_gravity_damage" } remove_modifier = "ag_beta_psionic_station_gravity_damage" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_gravity_fire_rate" } remove_modifier = "ag_beta_psionic_station_gravity_fire_rate" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_psionic_damage" } remove_modifier = "ag_beta_psionic_station_psionic_damage" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_psionic_fire_rate" } remove_modifier = "ag_beta_psionic_station_psionic_fire_rate" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_anti_psionic_damage" } remove_modifier = "ag_beta_psionic_station_anti_psionic_damage" }
						while = { limit = { has_modifier = "ag_beta_psionic_station_anti_psionic_fire_rate" } remove_modifier = "ag_beta_psionic_station_anti_psionic_fire_rate" }
					}
				}
				else_if = { limit = { NOT = { has_fleet_flag = ag_beta_psionic_station_effect_3 } } fleet_event = { id = ag_beta.151 days = 1 } }
			}
		}
	}
}
# on_entering_system_fleet, Psionic Station's system effect
fleet_event = {
	id = ag_beta.152
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		from = { has_star_flag = ag_beta_psionic_station_affected }
		exists = owner
		owner = { NOR = {
			is_country_type = ag_zeta_crisis_country
			is_country_type = ag_zeta_crisis_portal_holder
			is_country_type = ag_zeta_crisis_relic_country
			is_country_type = shroud
			is_country_type = shroud_spirits
			is_country_type = extradimensional
			is_country_type = extradimensional_2
			is_country_type = extradimensional_3
		} }
	}
	immediate = {
		if = {
			limit = {
				from = {
					has_star_flag = ag_beta_psionic_station_effect_1
					NOT = { has_star_flag = ag_beta_psionic_station_effect_1_@root.owner }
				}
				NOT = { any_controlled_ship = { OR = {
					is_ship_class = shipclass_military_station
					is_ship_size = ag_gamma_station_small_moving_hostile
					is_ship_size = ag_epsilon_titan_hostile
					is_ship_size = ag_eta_titan_hostile
					is_ship_size = ag_ancient_wandering_ship_hostile
				} } }
			}
			clear_orders = yes
			clear_fleet_actions = this
			create_ambient_object = { type = "ag_beta_psionic_station_effect_object" }
			last_created_ambient_object = {
				set_ambient_object_flag = ag_beta_psionic_station_effect_1_loc
				set_location = prev
				prev = { set_location = prev fleet_event = { id = ag_beta.151 days = 1 scopes = { from = prev } } }
			}
		}
		if = {
			limit = {
				exists = solar_system
				solar_system = {
					has_star_flag = ag_beta_psionic_station_effect_3
					NOT = { has_star_flag = ag_beta_psionic_station_effect_3_@root.owner }
				}
			}
			if = { limit = { NOT = { has_fleet_flag = ag_beta_psionic_station_effect_3 } } set_fleet_flag = ag_beta_psionic_station_effect_3 }
			every_controlled_ship = {
				if = { limit = { has_modifier = "ag_beta_psionic_station_regen_buff_static" } remove_modifier = "ag_beta_psionic_station_regen_buff_static" }
				if = {
					limit = { check_modifier_value = { modifier = ship_hull_regen_add_static value > 0 } }
					export_modifier_to_variable = { modifier = ship_hull_regen_add_static variable = ag_beta_regen_debuff_temp_var }
					multiply_variable = { which = ag_beta_regen_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_regen_buff_static" multiplier = ag_beta_regen_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_regen_buff_perc" } remove_modifier = "ag_beta_psionic_station_regen_buff_perc" }
				if = {
					limit = { check_modifier_value = { modifier = ship_hull_regen_add_perc value > 0 } }
					export_modifier_to_variable = { modifier = ship_hull_regen_add_perc variable = ag_beta_regen_debuff_temp_var }
					multiply_variable = { which = ag_beta_regen_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_regen_buff_perc" multiplier = ag_beta_regen_debuff_temp_var days = -1 }
				}
				if = { limit = { is_variable_set = ag_beta_regen_debuff_temp_var } clear_variable = ag_beta_regen_debuff_temp_var }
			}
			fleet_event = { id = ag_beta.151 days = 1 }
		}
		if = {
			limit = {
				exists = solar_system
				solar_system = {
					has_star_flag = ag_beta_psionic_station_effect_4
					NOT = { has_star_flag = ag_beta_psionic_station_effect_4_@root.owner }
				}
			}
			if = { limit = { NOT = { has_fleet_flag = ag_beta_psionic_station_effect_4 } } set_fleet_flag = ag_beta_psionic_station_effect_4 }
			every_controlled_ship = {
				if = { limit = { has_modifier = "ag_beta_psionic_station_energy_damage" } remove_modifier = "ag_beta_psionic_station_energy_damage" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_energy_weapon_damage_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_energy_weapon_damage_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_energy_damage" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_energy_fire_rate" } remove_modifier = "ag_beta_psionic_station_energy_fire_rate" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_energy_weapon_fire_rate_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_energy_weapon_fire_rate_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_energy_fire_rate" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_kinetic_damage" } remove_modifier = "ag_beta_psionic_station_kinetic_damage" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_kinetic_weapon_damage_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_kinetic_weapon_damage_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_kinetic_damage" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_kinetic_fire_rate" } remove_modifier = "ag_beta_psionic_station_kinetic_fire_rate" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_kinetic_weapon_fire_rate_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_kinetic_weapon_fire_rate_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_kinetic_fire_rate" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_explosive_damage" } remove_modifier = "ag_beta_psionic_station_explosive_damage" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_explosive_weapon_damage_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_explosive_weapon_damage_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_explosive_damage" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_explosive_fire_rate" } remove_modifier = "ag_beta_psionic_station_explosive_fire_rate" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_explosive_weapon_fire_rate_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_explosive_weapon_fire_rate_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_explosive_fire_rate" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_strike_craft_damage" } remove_modifier = "ag_beta_psionic_station_strike_craft_damage" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_strike_craft_weapon_damage_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_strike_craft_weapon_damage_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_strike_craft_damage" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_strike_craft_fire_rate" } remove_modifier = "ag_beta_psionic_station_strike_craft_fire_rate" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_strike_craft_weapon_fire_rate_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_strike_craft_weapon_fire_rate_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_strike_craft_fire_rate" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_gravity_damage" } remove_modifier = "ag_beta_psionic_station_gravity_damage" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_gravity_weapon_damage_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_gravity_weapon_damage_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_gravity_damage" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_gravity_fire_rate" } remove_modifier = "ag_beta_psionic_station_gravity_fire_rate" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_gravity_weapon_fire_rate_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_gravity_weapon_fire_rate_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_gravity_fire_rate" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_psionic_damage" } remove_modifier = "ag_beta_psionic_station_psionic_damage" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_psionic_weapon_damage_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_psionic_weapon_damage_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_psionic_damage" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_psionic_fire_rate" } remove_modifier = "ag_beta_psionic_station_psionic_fire_rate" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_psionic_weapon_fire_rate_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_psionic_weapon_fire_rate_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_psionic_fire_rate" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_anti_psionic_damage" } remove_modifier = "ag_beta_psionic_station_anti_psionic_damage" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_anti_psionic_weapon_damage_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_anti_psionic_weapon_damage_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_anti_psionic_damage" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { has_modifier = "ag_beta_psionic_station_anti_psionic_fire_rate" } remove_modifier = "ag_beta_psionic_station_anti_psionic_fire_rate" }
				if = {
					limit = { check_modifier_value = { modifier = weapon_type_anti_psionic_weapon_fire_rate_mult value > 0 } }
					export_modifier_to_variable = { modifier = weapon_type_anti_psionic_weapon_fire_rate_mult variable = ag_beta_weapon_debuff_temp_var }
					multiply_variable = { which = ag_beta_weapon_debuff_temp_var value = prev.ag_beta_psionic_station_var }
					add_modifier = { modifier = "ag_beta_psionic_station_anti_psionic_fire_rate" multiplier = ag_beta_weapon_debuff_temp_var days = -1 }
				}
				if = { limit = { is_variable_set = ag_beta_weapon_debuff_temp_var } clear_variable = ag_beta_weapon_debuff_temp_var }
			}
			fleet_event = { id = ag_beta.151 days = 1 }
		}
		if = {
			limit = {
				from = {
					has_star_flag = ag_beta_psionic_station_effect_5
					NOT = { has_star_flag = ag_beta_psionic_station_effect_5_@root.owner }
				}
				NOT = { has_fleet_flag = ag_beta_psionic_station_effect_5_recently_moved }
				NOT = { any_controlled_ship = { OR = {
					NOR = {
						is_ship_class = shipclass_military
						is_ship_class = shipclass_military_special
					}
					is_ship_size = ag_gamma_station_small_moving_hostile
					is_ship_size = ag_epsilon_titan_hostile
					is_ship_size = ag_eta_titan_hostile
					is_ship_size = ag_ancient_wandering_ship_hostile
				} } }
			}
			from = {
				random_neighbor_system = {
					limit = {
						has_hyperlane_to = prev
						NOR = {
							has_star_flag = ag_beta_psionic_station_effect_5
							AND = { exists = space_owner prev = { has_star_flag = ag_beta_psionic_station_effect_5_@prev.space_owner } }
						}
					}
					save_event_target_as = ag_fleet_evasion_loc
				}
				if = {
					limit = { NOT = { exists = event_target:ag_fleet_evasion_loc } }
					random_system = {
						limit = {
							NOR = {
								has_star_flag = ag_beta_psionic_station_effect_5
								AND = { exists = space_owner prev = { has_star_flag = ag_beta_psionic_station_effect_5_@prev.space_owner } }
							}
							distance = {
								source = prev
								type = hyperlane
								use_bypasses = yes
								min_jumps >= 3
								max_jumps <= 5
							}
						}
						save_event_target_as = ag_fleet_evasion_loc
					}
					if = {
						limit = { NOT = { exists = event_target:ag_fleet_evasion_loc } }
						random_system = {
							limit = {
								NOR = {
									has_star_flag = ag_beta_psionic_station_effect_5
									AND = { exists = space_owner prev = { has_star_flag = ag_beta_psionic_station_effect_5_@prev.space_owner } }
								}
								distance = {
									source = prev
									type = euclidean
									use_bypasses = no
									min_distance >= 30
									max_distance <= 150
								}
							}
							save_event_target_as = ag_fleet_evasion_loc
						}
						if = {
							limit = { NOT = { exists = event_target:ag_fleet_evasion_loc } }
							random_system = {
								limit = { NOT = { has_star_flag = ag_beta_psionic_station_effect_5 } }
								save_event_target_as = ag_fleet_evasion_loc
							}
							if = {
								limit = { NOT = { exists = event_target:ag_fleet_evasion_loc } }
								random_system = { save_event_target_as = ag_fleet_evasion_loc }
							}
						}
					}
				}
			}
			clear_orders = yes
			clear_fleet_actions = this
			if = {
				limit = { event_target:ag_fleet_evasion_loc = { has_star_flag = ag_beta_psionic_station_effect_5 } }
				set_timed_fleet_flag = { flag = ag_beta_psionic_station_effect_5_recently_moved days = 2 }
			}
			set_location = { target = event_target:ag_fleet_evasion_loc.star distance = 45 angle = random }
		}
		if = {
			limit = {
				from = {
					has_star_flag = ag_beta_psionic_station_effect_6
					NOT = { has_star_flag = ag_beta_psionic_station_effect_6_@root.owner }
				}
				NOT = { any_controlled_ship = { OR = {
					is_ship_class = shipclass_military_station
					is_ship_size = ag_gamma_station_small_moving_hostile
					is_ship_size = ag_epsilon_titan_hostile
					is_ship_size = ag_eta_titan_hostile
					is_ship_size = ag_ancient_wandering_ship_hostile
				} } }
			}
			clear_orders = yes
			clear_fleet_actions = this
			create_ambient_object = { type = "ag_beta_psionic_station_effect_object" }
			last_created_ambient_object = {
				set_ambient_object_flag = ag_beta_psionic_station_effect_1_loc
				set_location = prev
				prev = {
					set_location = prev
					fleet_event = { id = ag_beta.151 days = 1 scopes = { from = prev } }
					set_fleet_flag = ag_beta_station_fleet_event_locked
					set_event_locked = yes
				}
			}
		}
	}
}

# Psionic Signal Station's Abilities, succeeded
country_event = {
	id = ag_beta.153
	title = "ag_beta.153.name"
	desc = { trigger = { NOR = { exists = event_target:ag_target_system exists = event_target:ag_target_system_alt } } text = "ag_beta.153.a.desc" }
	desc = { trigger = { exists = event_target:ag_target_system NOT = { exists = event_target:ag_target_system_alt } } text = "ag_beta.153.b.desc" }
	desc = { trigger = { exists = event_target:ag_target_system exists = event_target:ag_target_system_alt } text = "ag_beta.153.c.desc" }
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_star_pulsar_room }
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = { name = "ag_beta.153.a" }
}
# Psionic Signal Station's Abilities, succeeded with side effect
country_event = {
	id = ag_beta.154
	title = "ag_beta.154.name"
	desc = { trigger = { NOR = { exists = event_target:ag_target_system exists = event_target:ag_target_system_alt } } text = "ag_beta.154.a.desc" }
	desc = { trigger = { exists = event_target:ag_target_system NOT = { exists = event_target:ag_target_system_alt } } text = "ag_beta.154.b.desc" }
	desc = { trigger = { exists = event_target:ag_target_system exists = event_target:ag_target_system_alt } text = "ag_beta.154.c.desc" }
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_star_pulsar_room }
	show_sound = event_yellow_alert
	is_triggered_only = yes
	option = { name = "ag_beta.154.a" }
}
# Psionic Signal Station's Abilities, failed
country_event = {
	id = ag_beta.155
	title = "ag_beta.155.name"
	desc = { trigger = { NOR = { exists = event_target:ag_target_system exists = event_target:ag_target_system_alt } } text = "ag_beta.155.a.desc" }
	desc = { trigger = { exists = event_target:ag_target_system NOT = { exists = event_target:ag_target_system_alt } } text = "ag_beta.155.b.desc" }
	desc = { trigger = { exists = event_target:ag_target_system exists = event_target:ag_target_system_alt } text = "ag_beta.155.c.desc" }
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unspeakable_horror_room }
	show_sound = event_activating_unknown_technology
	is_triggered_only = yes
	option = { name = "ag_beta.155.a" }
}

# Psionic Signal Station's Abilities, succeeded, for others
country_event = {
	id = ag_beta.156
	title = "ag_beta.156.name"
	desc = { trigger = { NOR = { exists = event_target:ag_target_system exists = event_target:ag_target_system_alt } } text = "ag_beta.156.a.desc" }
	desc = { trigger = { exists = event_target:ag_target_system NOT = { exists = event_target:ag_target_system_alt } } text = "ag_beta.156.b.desc" }
	desc = { trigger = { exists = event_target:ag_target_system exists = event_target:ag_target_system_alt } text = "ag_beta.156.c.desc" }
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unspeakable_horror_room }
	show_sound = event_activating_unknown_technology
	is_triggered_only = yes
	option = { name = "ag_beta.156.a" }
}
# Psionic Signal Station's Abilities, succeeded, for victims
country_event = {
	id = ag_beta.157
	title = "ag_beta.157.name"
	desc = { trigger = { NOR = { exists = event_target:ag_target_system exists = event_target:ag_target_system_alt } } text = "ag_beta.157.a.desc" }
	desc = { trigger = { exists = event_target:ag_target_system NOT = { exists = event_target:ag_target_system_alt } } text = "ag_beta.157.b.desc" }
	desc = { trigger = { exists = event_target:ag_target_system exists = event_target:ag_target_system_alt } text = "ag_beta.157.c.desc" }
	diplomatic = yes
	custom_gui = "ag_ancient_event_s_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_unspeakable_horror_room }
	show_sound = event_activating_unknown_technology
	is_triggered_only = yes
	option = { name = "ag_beta.157.a" }
}
# Psionic Signal Station's Abilities, failed, for others
country_event = {
	id = ag_beta.158
	title = "ag_beta.158.name"
	desc = { trigger = { NOR = { exists = event_target:ag_target_system exists = event_target:ag_target_system_alt } } text = "ag_beta.158.a.desc" }
	desc = { trigger = { exists = event_target:ag_target_system NOT = { exists = event_target:ag_target_system_alt } } text = "ag_beta.158.b.desc" }
	desc = { trigger = { exists = event_target:ag_target_system exists = event_target:ag_target_system_alt } text = "ag_beta.158.c.desc" }
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ship_in_orbit_room }
	show_sound = event_yellow_alert
	is_triggered_only = yes
	option = { name = "ag_beta.158.a" }
}

# Remove Psionic Environment
system_event = {
	id = ag_beta.161
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { has_star_flag = ag_beta_psionic_system_3 }
			ag_beta_psionic_system_effect = { ag_level = 2 }
			system_event = { id = ag_beta.161 days = 60 random = 30 }
		}
		else_if = {
			limit = { has_star_flag = ag_beta_psionic_system_2 }
			ag_beta_psionic_system_effect = { ag_level = 1 }
			system_event = { id = ag_beta.161 days = 60 random = 30 }
		}
		else_if = {
			limit = { has_star_flag = ag_beta_psionic_system_1 }
			ag_beta_psionic_system_effect = { ag_level = 0 }
		}
	}
}

# Notification for psionic signal station ready.
country_event = {
	id = ag_beta.162
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = this
		any_owned_megastructure = { is_megastructure_type = ag_beta_station_type2_megastructure }
	}

	immediate = { random_owned_megastructure = {
		limit = { is_megastructure_type = ag_beta_station_type2_megastructure }
		prev = { create_message = {
			type = "message_ag_beta_station_ready"
			localization = "message_ag_beta_station_ready_desc"
			days = -1
			target = prev
			variable = {
				type = name
				localization = "ag_megastructure_system"
				scope = prev.solar_system
			}
		} }
	} }
}

# Situation events.
country_event = {
	id = ag_beta.170
	title = "ag_beta.170.name"
	desc = "ag_beta.170.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	option = { name = "ag_beta.170.a" }
}
country_event = {
	id = ag_beta.171
	title = "ag_beta.171.name"
	desc = "ag_beta.171.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_ancient_AI_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	option = {
		name = "ag_beta.171.a"
		hidden_effect = { country_event = { id = ag_beta.122 days = 20 random = 20 } }
	}
}
country_event = {
	id = ag_beta.172
	title = "ag_beta.172.name"
	desc = "ag_beta.172.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_physics_research_room }
	show_sound = event_laboratory_sound
	location = event_target:ag_ancient_beta_shielded_world
	is_triggered_only = yes
	option = {
		name = "ag_beta.172.a"
		ag_add_research_option = { ag_tech = tech_ag_psionic_shielded }
	}
}
country_event = {
	id = ag_beta.173
	title = "ag_beta.173.name"
	desc = "ag_beta.173.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	immediate = {
		random_list = {
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 1 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 1.5 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 2 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 2.5 } }
			10 = { set_variable = { which = ag_ancient_knowledge_common_var value = 3 } }
		}
		reroll_random = yes
		random_list = {
			10 = { change_variable = { which = ag_ancient_knowledge_common_var value = 0.25 } }
			10 = { change_variable = { which = ag_ancient_knowledge_common_var value = 0.125 } }
			10 = { subtract_variable = { which = ag_ancient_knowledge_common_var value = 0.25 } }
			10 = { subtract_variable = { which = ag_ancient_knowledge_common_var value = 0.125 } }
			10 = { }
		}
		reroll_random = yes
	}
	after = { hidden_effect = {
		# clear_variable = ag_ancient_knowledge_common_var
		destroy_situation = from
	} }
	option = { name = "ag_beta.173.a" ag_add_ancient_knowledge = { ag_value = ag_ancient_knowledge_common_var ag_notification_desc = "" } }
}
country_event = {
	id = ag_beta.174
	title = "ag_beta.174.name"
	desc = "ag_beta.174.desc"
	diplomatic = yes
	custom_gui = "ag_ancient_event_m_window"
	custom_gui_option = "ag_ancient_event_option"
	picture_event_data = { room = ag_event_throne_room }
	show_sound = event_mystic_reveal
	location = root
	is_triggered_only = yes
	trigger = {
		NOT = { has_country_flag = ag_beta_situation_started }
		has_global_flag = ag_aneient_beta_psionic_effect_ended
		exists = event_target:ag_ancient_beta_shielded_world
		event_target:ag_ancient_beta_shielded_world = {
			exists = owner
			owner = { is_same_value = root }
			has_building = ag_ancient_beta_archive
			has_ground_combat = no
			ag_has_researcher = yes
		}
	}
	immediate = { set_country_flag = ag_beta_situation_started }
	option = {
		name = "ag_beta.174.a"
		start_situation = { type = "ag_beta_situation" target = event_target:ag_ancient_beta_shielded_world }
	}
}
