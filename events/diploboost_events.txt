# Mod by Terak_Lapis

namespace = dpboo

country_event = { # Testevent for Diplocheat
	id = dpboo.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		add_modifier = {
			modifier = diplocheat
			days = -1
		}
	}
}

country_event = { # Testevent for Diploforce
	id = dpboo.2
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		add_resource = {
			diploforce = 1000
		}
	}
}

country_event = { # Testevent for Diplodrugs
	id = dpboo.3
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		add_resource = {
			diplodrugs = 1000
		}
	}
}


# Churl Power
country_event = { # Churlpowers
	id = dpboo.20
	is_triggered_only = no
	hide_window = yes 
	trigger = {
		has_ascension_perk = ap_churl
		NOT = {
			has_country_flag = churl_activated
		}
	}

	immediate = { # Gives you the Churl Powers
		set_country_flag = churl_activated 
		add_modifier = {
			modifier = churl_power
			days = -1
		}
		country_event = {
			id = dpboo.21
		}
	}
}

country_event = { # Gives you the Churl -  This ones shows up
	id = dpboo.21
	is_triggered_only = no
	hide_window = no
	title = "churl_ap_evt_title"
	desc = "churl_ap_evt_desc"
	show_sound = event_announcement
	picture = GFX_evt_fleet_evil
	location = capital_scope
	trackable = yes

	trigger = {
		NOR = {
			has_country_flag = churl_fired
			has_global_flag = churl_fired_global
		}
		has_ascension_perk = ap_churl
	}

	option = {
		name = PERFECT
		hidden_effect = {
			set_country_flag = churl_fired
			set_global_flag = churl_fired_global
		}
		create_leader = {
			class = admiral 
			species = owner_main_species
			name = "NAME_CHURL_ADMIRAL"
			skill = 9
			traits = {
				trait = leader_trait_admiral_hells_heart
				trait = leader_trait_army_logistician
				trait = leader_trait_dragonslayer
			}
		}
	}

}

# Galactic Community

# Mil_1 Adopt Events

country_event = { # is hidden - prep for 1001 - checks conditions
	id = dpboo.1000
	hide_window = yes

	trigger = { # Only fires when Mili 1 is active
		is_active_resolution = "resolution_mil_1"
		has_global_flag = mil_1_active
		NOR = { # prevented to ensure no eventual dobble proposing causes problems
			has_global_flag = mil_2_active
			has_global_flag = mil_3_active
			has_global_flag = mil_final_active
			has_country_flag = mil_temp_1
		}
		is_country_type = default
	}

	immediate = {
		save_event_target_as = prop_buyer
		country_event = {
			id = dpboo.1001 # The visible one
			days = 1
		}
		hidden_effect = {
			set_timed_global_flag = {
				flag = temp_1_mil_1
				days = 3
			}
		}
		random_owned_ship = {
			save_event_target_as = mil_1_location
		}		
		set_country_flag = mil_temp_1
	}

}

country_event = { # buy armies or scare your citizen
	id = dpboo.1001
	hide_window = no
	is_triggered_only = yes
	picture = GFX_evt_announcement
	show_sound = event_celebration
	title = "evt_mil_1_title"
	desc = "evt_mil_1_main_desc"
	trackable = yes
	location = event_target:mil_1_location

	trigger = {
		has_global_flag = temp_1_mil_1
		is_active_resolution = "resolution_mil_1"
		is_country_type = default
	}

	immediate = {
		remove_global_flag = temp_1_mil_1
	}

	option = { # Buy Armies
		name = "buy_option_mil_1"
		spawn_armies_mil1 = yes
		add_resource = { # Cost of employing Armys
			energy = -2500
			influence = -50
			diploforce = 5
		}
		hidden_effect = {
			set_country_flag = bought_armies_mil1	
		}
	}

	option = {
		name = "no_money_option"
		hidden_effect = {
			add_modifier = {
				modifier = scared_citizen
				years = 7
			}
			country_event = {
				id = dpboo.1002
			}
		}
	}
}

country_event = { # informs you of panic
	id = dpboo.1002
	picture = GFX_evt_atmospheric_flight
	title = "scared_mil_title"
	desc = "scared_mil_desc"
	is_triggered_only = yes

	immediate = {
		set_timed_country_flag = {
			flag = scared_citizen
			days = 1800
		}
	}

	option = {
		name = "worrying_option"
	}
}

planet_event = { # Should Create the army on the Planet
	id = dpboo.1003
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes 
		is_capital = yes
		is_occupied_flag = no
		has_ground_combat = no

	}

	trigger = {
		owner = {
			has_country_flag = bought_armies_mil1
		}
		is_active_resolution = "resolution_mil_1"
	}

	immediate = {
		create_army = {
			name = "NAME_Army_mil1"
			species = root.owner
			owner = root.owner
			type = defense_army
		}
	}
}

# Mil_2 Event

country_event = { # hidden - checks conditions - prep for 1101
	id = dpboo.1100
	hide_window = yes
	trigger = {
		is_active_resolution = "resolution_mil_2"
		has_global_flag = mil_2_active
		NOT = { # Prevent double triggering
			has_global_flag = mil_1_active
			has_global_flag = mil_3_active
			has_global_flag = mil_final_active 
			has_country_flag = mil_temp_2
		}
		is_country_type = default
	}

	immediate = {
		country_event = {
			id = dpboo.1101
			days = 1
		}
		set_timed_global_flag = {
			flag = temp_1_mil_2
			days = 3
		}
		random_owned_starbase = {
			save_event_target_as = mil_2_location
		}
		set_country_flag = mil_temp_2
	}
}

country_event = { # Main Event for 1101 - Shipbuild Challange
	id = dpboo.1101
	hide_window = no
	picture = GFX_evt_federation_fleet
	title = "evt_mil_2_title"
	desc = "evt_mil_2_desc"
	show_sound = event_spy_orb_build_upgrade # Mod by Terak_Lapis
	is_triggered_only = yes
	trackable = yes
	location = event_target:mil_2_location

	immediate = {
		set_country_flag = chance_to_build_up
		remove_global_flag = temp_1_mil_2
	}

	option = {
		name = "favor_morebuild_option"
		hidden_effect = {
			remove_country_flag = chance_to_build_up
			set_timed_country_flag = {
				flag = fleet_built_boost
				days = 1800
			}
			add_modifier = {
				modifier = starship_build_fever
				days = 1800
			}
			add_resource = { # Expensive but worth it if you want to wage war quickly
				alloys = 2000
				influence = 100
				unity = 50
				diploforce = 5
			}
		}
	}

	option = {
		name = "no_money_option"
		hidden_effect = {
			remove_country_flag = chance_to_build_up
			set_country_flag = failed_our_crew
			add_modifier = {
				modifier = scared_citizen
				days = 1800
			}
			country_event = {
				id = dpboo.1002 # We failed our People
			}
		}
		
	}
}

# Mil_3 Event

country_event = { # hidden - checks conditions - prep for 1201
	id = dpboo.1200
	hide_window = yes
	trigger = {
		is_active_resolution = "resolution_mil_3"
		has_global_flag = mil_3_active
		NOT = { # Prevent double triggering
			has_global_flag = mil_1_active
			has_global_flag = mil_2_active
			has_global_flag = mil_final_active
			has_country_flag = mil_temp_3
		}
		is_country_type = default
	}

	immediate = {
		country_event = {
			id = dpboo.1201
			days = 1
		}
		set_timed_global_flag = {
			flag = temp_1_mil_3
			days = 3
		}
		random_owned_starbase = {
			save_event_target_as = mil_3_location
		}
		set_country_flag = mil_temp_3
	}
}

country_event = { # Buy yourself a nice Ship - Main 1201
	id = dpboo.1201
	hide_window = no
	picture = GFX_evt_galactic_senate
	show_sound = event_assembly_fight
	title = "evt_mil_3_title"
	desc = "evt_mil_3_desc"
	trackable = no
	location = capital_scope
	is_triggered_only = yes

	immediate = {
		set_country_flag = chanche_to_get_ships
		remove_global_flag = temp_1_mil_3
	}

	option = { # buy titan
		name = "buy_titan"
		spawn_titan_mil3 = yes
		add_resource = {
			alloys = -2800
			energy = -2500
			rare_crystals = -200
			sr_dark_matter = -40
			diploforce = 5
		}
		hidden_effect = {
			remove_country_flag = chanche_to_get_ships
			set_country_flag = got_titan
		
		}
	}

	option = { # buy battleship
		name = "buy_battleship"
		spawn_battleship_mil3 = yes
		add_resource = {
			alloys = -1700
			energy = -1000
			rare_crystals = -200
			sr_dark_matter = -4
			diploforce = 5
		}
		hidden_effect = {
			remove_country_flag = chanche_to_get_ships
			set_country_flag = got_battleship
			
		}
	}

	option = { # buy cruiser
		name = "buy_cruiser"
		spawn_cruiser_mil3 = yes
		add_resource = {
			alloys = -900
			energy = -500
			rare_crystals = -100
			sr_dark_matter = -1
			diploforce = 5
		}
		hidden_effect = {
			remove_country_flag = chanche_to_get_ships
			set_country_flag = got_titan
			
		}
	}

	option = { # Scrap them
		name = "scrap_option"
		hidden_effect = {
			remove_country_flag = chanche_to_get_ships
			set_country_flag = scrap_parts		
		}
		add_resource = {
			minerals = 500
		}
	}
}

# Mil_final Event

country_event = { # hidden - checks conditions - prep for 1301
	id = dpboo.1300
	hide_window = yes
	trigger = {
		is_active_resolution = "resolution_mil_final"
		has_global_flag = mil_final_active
		NOT = { # Prevent double triggering
			has_global_flag = mil_1_active
			has_global_flag = mil_2_active
			has_global_flag = mil_3_active
			has_country_flag = mil_temp_final
		}
		is_country_type = default
	}

	immediate = {
		country_event = {
			id = dpboo.1301
			days = 1
		}
		set_timed_global_flag = {
			flag = temp_1_mil_final
			days = 3
		}
		capital_scope = {
			save_event_target_as = mil_final_location
		}
		set_country_flag = mil_temp_final
	}
}

country_event = { # Main Event - 1301 Code - Prep for War
	id = dpboo.1301
	hide_window = no
	picture = GFX_evt_fallen_empire_awakes
	show_sound = event_conversation
	title = "evt_mil_final_title"
	desc = "evt_mil_final_desc"
	trackable = yes
	location = event_target:mil_final_location
	is_triggered_only = yes	

	immediate = {
		set_country_flag = war_preperations
		remove_global_flag = temp_1_mil_final
	}

	option = { # Wartimes
		name = "prepare"
		hidden_effect = {
			remove_country_flag = war_preperations
			set_country_flag = prepare_for_the_worst
			add_modifier = {
				modifier = mil_spending_high
				days = -1
			}
		}
		add_resource = {
			energy = -750
			alloys = -4000
			influence = 300
		}
	}

	option = { # Peacetimes
		name = "everthing_will_be_fine"
		hidden_effect = {
			add_modifier = {
				modifier = mil_spending_low
				days = -1
			}
		}
		add_resource = {
			unity = 500
			influence = -200
			alloys = 200
			energy = 500
		}
	}
	
}

# Planned Followup with aggressor from within
# Sport Match for Preperators
# Festival for Peacelovers
# Costs from Prep
# Fleetbuildup events over time

event = { # as support for tmtt
	id = dpboo.0
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		set_global_flag = diplo_ventures_active
	}
}
country_event = {
	id = dpboo.70000
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_global_flag = diplo_ventures_active
	}
}










###################################
# Planetkiller Events #############
###################################

planet_event = {
	id = dpboo.40000
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		add_planet_devastation = -10
		root = {
			add_modifier = {
				modifier = happy_after_brainwash
				years = 10
			}
		}
		owner = { # flag for opinion
			set_country_flag = brainwashed_his_people
		}
	}
}

###########################
## Special Projects #######
###########################
country_event = { # Calc and Flag Event
	id = dpboo.5500
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		set_country_flag = peke_tech_reached
		set_country_flag = special_project_finished_dpboo
		set_global_flag = peke_reached
		remove_country_flag = peke_project_inprogress
		country_event = {
			id = dpboo.5501
			days = 1
		}
	}

}

country_event = { # Shoup for Gate Tech and Vow
	id = dpboo.5501
	is_triggered_only = yes
	title = dpboo.5501.title
	desc = dpboo.5501.desc
	picture = GFX_evt_fleet_good
	show_sound = event_mystic_reveal_light
	immediate = {
		add_modifier = {
			modifier = peke_fever
			days = -1
		}
	}
	option = {
		trigger = {
			NOR = {
				has_origin = origin_churl
				is_brutal_empire = yes
			}
		}
		name = dpboo.5501.option.a
		add_resource = {
			unity = -1000
			influence = 100
			diploforce = 300
		}
		hidden_effect = {
			add_research_option = tech_peace_keeper_tech
		}
	}
	option = {
		name = dpboo.5501.option.b
		remove_modifier = peke_fever
	}
}

country_event = {
	id = dpboo.5502
	is_triggered_only = yes
	title = dpboo.5502.title
	desc = dpboo.5502.desc
	picture = GFX_evt_fallen_empire
	show_sound = event_first_discovery_advisor
	immediate = {
		set_country_flag = peke_project_inprogress
		enable_special_project = {
			name = "ANCIENT_TECH_PROJECT" #Reconstruction Programm
			location = capital_scope
		}
	}
	option = {
		name = PERFECT
	}
}


#################################################################################
######### Technical Stuff - Do not touch if you don´t know what your doing ######
#################################################################################



############
# Origin ###
#############

planet_event = { # To assign the Boost for peaceloving Homeworld - should only fire once
	id = dpboo.650
	hide_window = yes

 #	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		owner = {
			has_origin = origin_peaceloving
		}
		is_homeworld = yes
		NOT = {
			has_global_flag = pl_fired
		}
	}

	immediate = {
		root = {
			add_modifier = {
				modifier = peace_loving_pl
				days = -1
			}
		}
		set_global_flag = pl_fired
	}
}





###########################
# Ancient Debris ##########
###########################
#
# Any Modification here can break the regular Debries Loop -  Do only modify it if you know what youre doing - if you know of any better way to create such a regular triggered Loop with checks please contact me, I would be happy to repleace it with something more smooth thx:)
#
country_event = { # Sets up the loop - is biyearly to check up on new stuff - checks for active loop and triggers calc
	id = dpboo.740 
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOR = {
			is_ai = yes
			has_global_flag = peke_reached # Not needed if the player reached guardian tech
			has_country_flag = peke_project_inprogress # Not needed if special Project is on its way already
			check_variable = {
				which = peke_debris
				value > 7 # Max Perk Count to reach Unlock_flag
			}
			any_playable_country = { # Loop not needed if Player has Perk already
				has_ascension_perk = ap_guardian_techt
			}
			any_playable_country = {
				has_country_flag = ap_guardian_unlocked # Finished the Site already
			}
			has_global_flag = peke_debris_loop_closed
			has_global_flag = debris_loop_in_waiting
		}
	}
	immediate = {
		if = {
			limit = { 
				NOT = { # To prevent multiple setbacks
					check_variable = {
						which = peke_debris
						value > 0
					} 
				}
			}
			set_variable = { # Setup Var Counter
				which = peke_debris
				value = 0 # is redundant
			}
		}
		
		random_playable_country = {
			limit = { is_ai = no }
			country_event = {
				id = dpboo.741 # progress calc event
				days = 300 # Min
				random = 1800 # Max >= 300 + 1800
			}
		}
		random_playable_country = {
			limit = {
				is_ai = no
				NOT = {
					has_country_flag = loop_opend_ff
				}
			}
			country_event = {
				id = dpboo.699 # Should only fire once, marks random science ship as event target
			}
		}
		random_playable_country = {
			limit = {
				is_ai = no
			}
			set_country_flag = no_ai
		}
	set_global_flag = peke_debris_loop_opend
	remove_global_flag = debris_loop_in_waiting
	}

}

country_event = { # Calc for Debris loop
	id = dpboo.741
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOR = {
			has_global_flag = debris_loop_in_waiting
		}
	}
	immediate = {
		random_playable_country = {
			limit = {
				is_ai = no
			}
			country_event = {
				id = dpboo.742 # Show up
				days = 1
			}
			country_event = {
				id = dpboo.743 # Back up
			}			
			set_global_flag = debris_loop_in_waiting # No more Loops should open up while this one is running
		}
		change_variable = {
			which = peke_debris
			value = 1
		}
		if = { # IF the Science Vessel got destroyed and a new location has to be assigned
			limit = {
				NOT = { exists = event_target:debris_loop_ship_locator }
			}
			country_event = {
				id = dpboo.699
			}
		}
		country_event = { # Close the loop if Guardian Tech is reached to ease calc on pc
			id = dpboo.705
		}
		country_event = {
			id = dpboo.706
			days = 1
		}
	}

}

country_event = { # Fired only once - marks the ship the location is on
	id = dpboo.699
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		random_owned_ship = {
			limit = {
				is_ship_class = shipclass_science_ship
			}
		}
		save_event_target_as = debris_loop_ship_locator
		set_country_flag = loop_opend_ff
		remove_global_flag = debris_loop_in_waiting
	}
}

country_event = { # Shown event that more debris was found
	id = dpboo.742
	is_triggered_only = yes
	title = dpboo.742.title
	desc = dpboo.742.desc
	picture = GFX_evt_debris
	location = event_target:debris_loop_ship_locator
	show_sound = event_red_alert
	option = {
		name = OK
	}
}

country_event = { # If the loop fails and the Player doesn´t get the peke tech to progress their empire this will get it done in Endgame year 1
	id = dpboo.743
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		end_game_years_passed > 0
		NOT = {
			has_technology = tech_peace_keeper_tech
		}
	}
	immediate = {
		add_research_option = tech_peace_keeper_tech
		add_tech_progress = {
			tech = tech_peace_keeper_tech
			progress = 0.99
		}
	}
}

country_event = { # Back up trigger if bi_yearly fails two years in a row to start the loop - only opens once
	id = dpboo.744
	hide_window = yes
	trigger = {
		years_passed = 5
		NOT = {
			has_global_flag = peke_debris_loop_opend
		}
		NOT = {
			has_global_flag = loop_failed_1
		}
	}
	immediate = {
		random_playable_country = {
			limit = {
				is_ai = no
			}
			country_event = {
				id = dpboo.740 
			}
		}
		set_global_flag = loop_failed_1
	}
}

country_event = { # Closes the loop when 7 times triggered - if you want to find more or less replace all 7s in the loop with your wish number
	id = dpboo.705
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = peke_debris_loop_opend
		check_variable = {
			which = peke_debris
			value = 7
		}
	}
	immediate = {
		set_global_flag = peke_debris_loop_closed
		remove_global_flag = peke_debris_loop_opend
	}
}

country_event = { # Grants AP Unlock if 7 Debries have been found
	id = dpboo.706
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		check_variable = { # Checks if all debris have been found and grants the unlock flag for the AP
			which = peke_debris
			value >= 7
		}
	}
	immediate = {
		if = {
			limit = { check_variable = { which = peke_debris value = 7 } }
			set_country_flag = ap_guardian_unlocked
		}
	}
}

#####################################
## System Setup - Backup ############
#####################################
event = {
	id = dpboo.399
	hide_window = yes
	fire_only_once = yes
	trigger = {
		NOT = {
			has_global_flag = checked_systems
		}
		NOT = {
			any_system = {
				has_star_flag = pp_system_1_site_1
			}
		}
	}
	immediate = {
		set_global_flag = checked_systems
		every_system = {
			limit = {
				has_star_flag = empire_home_system
				owner = {
					is_ai = no 
				}
			}
			save_event_target_as = emp_home_fs
			random_neighbor_system = {
				limit = {
					has_hyperlane_to = event_target:emp_home_fs
				}
				spawn_system = {
					initializer = "pp_system_site"
					max_jumps = 0
					min_distance = 30
					max_distance = 40
				}
			}
		}
		if = {
			limit = {  
				NOT = {
					any_system = {
						has_star_flag = pp_system_1_site_1
					}
				}
			}
			random_rim_system = {
				limit = {
					NOR = {
						has_star_flag = empire_home_system
						has_star_flag = empire_cluster
						has_star_flag = guardians_dragon_system
						has_star_flag = fallen_shielded_1
						has_star_flag = fallen_shielded_2
						has_star_flag = fallen_shielded_3
						has_star_flag = fallen_shrouded
						has_owner = yes
					}
				}
				set_star_flag = test_potent
			}
		}
	}
}