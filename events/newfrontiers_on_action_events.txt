############################
#
# On Action Events
#
# Written by Annatar
#
############################


namespace = newfrontiers_action

### Infernal World found!
ship_event = {
	id = newfrontiers_action.1
	title = "newfrontiers_action.1.name"
	desc = "newfrontiers_action.1.desc"
	picture = GFX_evt_infernal_world
	show_sound = event_scanner
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_planet_flag = infernal_world
		}
	}
	
	immediate = {
		from = {
			change_pc = { class = pc_hollow inherit_entity = yes }
			set_planet_entity = { 
				picture = pc_infernal
				atmosphere_color = hsv { 0.05 0.65 1.4 }
				atmosphere_intensity = 0.05
				atmosphere_width = 1.0
			}
			add_modifier = {
				modifier = infernal_world
				days = -1
			}
			reroll_deposits = yes
		}
		owner = { country_event = { id = story.5 days = 2 } }
	}

	option = {
		name = INCREDIBLE
	}
}

### Terraform finish
planet_event = {
	id = newfrontiers_action.2
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		THIS = {
			remove_subclass_modifiers = yes
			remove_condition_modifiers = yes
		}
	}

}

### Subglacial World found!
ship_event = {
	id = newfrontiers_action.3
	title = "newfrontiers_action.3.name"
	desc = "newfrontiers_action.3.desc"
	picture = GFX_evt_subglacial_world
	show_sound = event_scanner
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_planet_flag = subglacial_world
		}
	}
	
	immediate = {
		from = {
			change_pc = { class = pc_hollow inherit_entity = yes }
			set_planet_entity = { 
				picture = pc_subglacial
				atmosphere_color 		= hsv { 0.55 0.15 0.7 }
				atmosphere_intensity 	= 1.0
				atmosphere_width 		= 0.5
			}
			add_modifier = {
				modifier = subglacial_world
				days = -1
			}
			reroll_deposits = yes
		}
		owner = { country_event = { id = story.5 days = 2 } }
	}

	option = {
		name = INCREDIBLE
	}
}

### Ammonia Biosphere
ship_event = {
	id = newfrontiers_action.4
	title = "anomaly.690.name"
	desc = "newfrontiers_action.4.desc"
	picture = GFX_evt_ammonia_world
	show_sound = event_ship_bridge
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_modifier = ammonia_world
		}
	}

	immediate = {
		fromfrom = { clear_deposits = yes }
		owner = { country_event = { id = story.5 days = 2 } }
	}
	
	option = {
		name = FASCINATING
		FROMFROM = { 
			set_deposit = d_society_3
		}
	}
}

### Hollow World found!
ship_event = {
	id = newfrontiers_action.5
	title = "newfrontiers_action.5.name"
	desc = "newfrontiers_action.5.desc"
	picture = GFX_evt_hollow_world
	show_sound = event_scanner
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_planet_flag = hollow_world
		}
	}
	
	immediate = {
		from = {
			change_pc = { class = pc_hollow inherit_entity = yes }
			reroll_deposits = yes
		}
		owner = { country_event = { id = story.5 days = 2 } }
	}

	option = {
		name = INCREDIBLE
	}
}

### Forsaken Home Planet found! (Ship)
ship_event = {
	id = newfrontiers_action.6
	title = "newfrontiers_action.6.name"
	desc = "newfrontiers_action.6.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_scanner
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		from = {
			has_planet_flag = forsaken_home_planet
		}
		owner = {
			has_origin = origin_forsaken
			NOT = { has_country_flag = forsaken_home_planet_found }
		}
	}
	
	immediate = {
		owner = { set_country_flag = forsaken_home_planet_found }
	}

	option = {
		name = newfrontiers_action.6.a
		from = {
			add_modifier = {
				modifier = "lost_home"
				days = -1
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier5influencereward
				min = @tier5influencemin
				max = @tier5influencemax
			}
			add_monthly_resource_mult = {
				resource = unity
				value = @tier5unityreward
				min = @tier5unitymin
				max = @tier5unitymax
			}
		}
	}
}

### Forsaken Home Planet found!
planet_event = {
	id = newfrontiers_action.7
	title = "newfrontiers_action.7.name"
	desc = "newfrontiers_action.7.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_scanner
	location = ROOT
	
	is_triggered_only = yes
	
	trigger = {
		has_planet_flag = forsaken_home_planet
		from = {
			has_origin = origin_forsaken
			NOT = { has_country_flag = forsaken_home_planet_found }
		}
	}
	
	immediate = {
		from = { set_country_flag = forsaken_home_planet_found }
	}

	option = {
		name = newfrontiers_action.7.a
		add_modifier = {
			modifier = "lost_home"
			days = -1
		}
		from = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier2influencereward
				min = @tier2influencemin
				max = @tier2influencemax
			}
			add_monthly_resource_mult = {
				resource = unity
				value = @tier4unityreward
				min = @tier4unitymin
				max = @tier4unitymax
			}
		}
	}
}

#Heart or Seed of the Overmind destroyed (oh no!)
#colony destroyed
planet_event = {
	id = newfrontiers_action.8
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_deposit = d_heart_of_the_overmind
			has_deposit = d_seed_of_the_overmind
		}
	}

	immediate = {
		if = {
			limit = { has_deposit = d_heart_of_the_overmind }
			remove_deposit = d_heart_of_the_overmind
			if = {
				limit = { owner = { any_owned_planet = { has_deposit = d_seed_of_the_overmind } } }
				owner = {
					random_owned_planet = {
						limit = { has_deposit = d_seed_of_the_overmind }
						weights = {
							base = 5
							modifier = {
								add = 5
								planet_size > 17
							}
							modifier = {
								add = 5
								planet_size > 21
							}
							modifier = { 
								mult = 2
								has_building = building_hive_capital
							}
							modifier = { 
								mult = 4
								has_building = building_hive_major_capital
							}
						}
						planet_event = { id = newfrontiers_action.11 }
					}
				}
			}
			else = {
				owner = { destroy_country = yes }
			}
		}
		if = {
			limit = { has_deposit = d_seed_of_the_overmind }
			remove_deposit = d_seed_of_the_overmind
			owner = { country_event = { id = newfrontiers_action.12 }}
		}
	}
}

#planet transfer
planet_event = {
	id = newfrontiers_action.9
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_deposit = d_heart_of_the_overmind
			has_deposit = d_seed_of_the_overmind
		}
	}

	immediate = {
		if = {
			limit = { has_deposit = d_heart_of_the_overmind }
			remove_deposit = d_heart_of_the_overmind
			
			every_country = {
				limit = {
					AND = {
						has_origin = origin_sentient_planet
						NOT = { any_owned_planet = { has_deposit = d_heart_of_the_overmind } }
					}
				}
				if = {
					limit = { any_owned_planet = { has_deposit = d_seed_of_the_overmind } }
					random_owned_planet = {
						limit = { has_deposit = d_seed_of_the_overmind }
						weights = {
							base = 5
							modifier = {
								add = 5
								planet_size > 17
							}
							modifier = {
								add = 5
								planet_size > 21
							}
							modifier = { 
								mult = 2
								has_building = building_hive_capital
							}
							modifier = { 
								mult = 4
								has_building = building_hive_major_capital
							}
						}
						planet_event = { id = newfrontiers_action.11 }
					}
				}
				else = {
					destroy_country = yes
				}
			}
		}
		if = {
			limit = { has_deposit = d_seed_of_the_overmind }
			remove_deposit = d_seed_of_the_overmind
		}
	}
}

#planet occupied
planet_event = {
	id = newfrontiers_action.10
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_deposit = d_heart_of_the_overmind
			has_deposit = d_seed_of_the_overmind
		}
	}

	immediate = {
		if = {
			limit = { has_deposit = d_heart_of_the_overmind }
			remove_deposit = d_heart_of_the_overmind
			if = {
				limit = { from = { any_owned_planet = { has_deposit = d_seed_of_the_overmind } } }
				from = {
					random_owned_planet = {
						limit = { has_deposit = d_seed_of_the_overmind }
						weights = {
							base = 5
							modifier = {
								add = 5
								planet_size > 17
							}
							modifier = {
								add = 5
								planet_size > 21
							}
							modifier = { 
								mult = 2
								has_building = building_hive_capital
							}
							modifier = { 
								mult = 4
								has_building = building_hive_major_capital
							}
						}
						planet_event = { id = newfrontiers_action.11 }
					}
				}
			}
			else = {
				from = { destroy_country = yes }
			}
		}
		if = {
			limit = { has_deposit = d_seed_of_the_overmind }
			remove_deposit = d_seed_of_the_overmind
			from = { country_event = { id = newfrontiers_action.12 }}
		}
	}
}

planet_event = {
	id = newfrontiers_action.11
	title = "newfrontiers_action.11.name"
	desc = "newfrontiers_action.11.desc"
	picture = GFX_evt_heart_of_the_overmind
	show_sound = event_space_whale
	location = ROOT
	
	is_triggered_only = yes
	
	immediate = {
		remove_deposit = d_seed_of_the_overmind
		if = {
			limit = { NOT = { is_planet_class = pc_sterile } }
			random_list = {
				33 = {
					change_pc = pc_sterile
				}
				33 = {
					change_pc = pc_lava
					add_modifier = {
						modifier = "lava_world"
						days = -1
					}
				}
				33 = {
					change_pc = pc_ash
					add_modifier = {
						modifier = "ash_world"
						days = -1
					}
				}
			}
			reroll_deposits = yes
		}
		add_deposit = d_heart_of_the_overmind
	}

	option = {
		name = TERRIBLE
		set_capital = yes
	}
}

country_event = {
	id = newfrontiers_action.12
	title = "newfrontiers_action.12.name"
	desc = "newfrontiers_action.12.desc"
	picture = GFX_evt_heart_of_the_overmind
	show_sound = event_space_whale
	location = ROOT
	
	is_triggered_only = yes

	option = {
		name = UNFORTUNATE
	}
}

### Capital check (Spoof Subclasses)
planet_event = {
	id = newfrontiers_action.13
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_capital = yes
		is_planet_subclass = yes
		NOT = { is_spoof_subclasses = yes }
	}
	
	immediate = {
		set_spoof_subclass = yes
	}
}

### First Colonization modifiers
planet_event = {
	id = newfrontiers_action.14
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = no_first_colonization_modifiers }
		NOT = { has_planet_flag = explored_world }
		NOR = {
			is_planet_class = pc_habitat
			is_ringworld = yes
		}
	}
	
	immediate = {
		set_planet_flag = explored_world
		
		random_list = {
			55 = {
				if = { 
					limit = { owner = { is_hive_empire = yes } }
					add_modifier = {
						modifier = adaptation_period_1
						days = 3600
					}
				}
				else_if = {
					limit = { owner = { is_machine_empire = yes } }
					add_modifier = {
						modifier = data_collection_1
						days = 9000
					}
				}
				else = {
					add_modifier = {
						modifier = new_frontier_1
						days = 18000
					}
				}
			}
			30 = {
				modifier = {
					factor = 2
					planet_size > 17
				}
				if = { 
					limit = { owner = { is_hive_empire = yes } }
					add_modifier = {
						modifier = adaptation_period_2
						days = 3600
					}
				}
				else_if = {
					limit = { owner = { is_machine_empire = yes } }
					add_modifier = {
						modifier = data_collection_2
						days = 9000
					}
				}
				else = {
					add_modifier = {
						modifier = new_frontier_2
						days = 18000
					}
				}
				
			}
			15 = {
				modifier = {
					factor = 3
					planet_size > 22
				}
				if = { 
					limit = { owner = { is_hive_empire = yes } }
					add_modifier = {
						modifier = adaptation_period_3
						days = 3600
					}
				}
				else_if = {
					limit = { owner = { is_machine_empire = yes } }
					add_modifier = {
						modifier = data_collection_3
						days = 9000
					}
				}
				else = {
					add_modifier = {
						modifier = new_frontier_3
						days = 18000
					}
				}
			}
		}
		
	}
}

