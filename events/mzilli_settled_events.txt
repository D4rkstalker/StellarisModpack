namespace = mzilli_settled

# Distributes Nascent Worlds
event = {
	id = mzilli_settled.1
	title = OK
	desc = OK
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	
	immediate = {
		if = {
			limit = {
				any_country = { has_country_flag = human_2 }
				NOT = { any_system = { has_star_flag = sol } }
			}
			random_system = { spawn_system = { initializer = "com_sol_system" } }
		}
		every_country = {
			limit = { has_origin = origin_interplanetary_expansion }
			give_technology = {
				tech = tech_hydroponics
				message = no
			}
		}
		every_system = {
			limit = {
				OR = {
					has_star_flag = com_sol
					AND = {
						has_star_flag = empire_home_system
						has_star_flag = empire_cluster
						exists = space_owner
						space_owner = {
							is_country_type = default
							NOT = { has_country_flag = no_mzilli_colonies } #modders, add this flag to excluse your custom empires if desired
						}
					}
				}
			}
			if = {
				limit = { any_system_planet = { has_planet_flag = mzilli_settled_planet } }
				if = {
					limit = {
						NOR = {
							space_owner = { has_origin = origin_life_seeded }
							space_owner = { has_origin = origin_shattered_ring }
							space_owner = { has_origin = origin_void_dwellers }
							space_owner = { has_origin = origin_doomsday }
							space_owner = { has_origin = origin_machine }
						}
					}
					while = {
						count = 2
						random_system_planet = {
							limit = {
								has_planet_flag = mzilli_settled_planet
								NOT = { has_planet_flag = dormant }
							}
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
				}
				if = {
					limit = { space_owner = { has_origin = origin_interplanetary_expansion } }
					random_system_planet = {
						limit = {
							has_planet_flag = mzilli_settled_planet
							NOT = { has_planet_flag = dormant }
						}
						set_planet_flag = dormant
						solar_system = { create_mzilli_settled_colonies_2 = yes }
					}
				}
			}
			else_if = {
				limit = { has_star_flag = sol }
				if = {
					limit = { has_star_flag = mzilli_martian_system } # Distant Origin mod
					if = {
						limit = { space_owner = { has_origin = origin_interplanetary_expansion } }
						random_system_planet = {
							limit = { has_planet_flag = moon_ganymede }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
					if = {
						limit = {
							NOR = {
								space_owner = { has_origin = origin_life_seeded }
								space_owner = { has_origin = origin_shattered_ring }
								space_owner = { has_origin = origin_void_dwellers }
								space_owner = { has_origin = origin_doomsday }
								space_owner = { has_origin = origin_machine }
							}
						}
						random_system_planet = {
							limit = { has_planet_flag = moon_titan }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
						random_system_planet = {
							limit = { has_planet_flag = moon_luna }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
				}
				else = { # Standard Sol System
					if = { # Titan
						limit = { space_owner = { has_origin = origin_interplanetary_expansion } }
						if = {
							limit = {
								NOR = {
									any_system_planet = { has_planet_flag = moon_titan }
									any_system_planet = { has_planet_flag = moon_ganymede }
								}
							}
							random_system_planet = {
								limit = {
									has_ring = yes
									has_moon = yes
									OR = {
										is_planet_class = pc_gas_giant
										is_planet_class = pc_bespin
									}
								}
								random_moon = { set_planet_flag = moon_titan }
							}
							#random_system_planet = {
							#	limit = {
							#		is_planet_class = pc_frozen
							#		is_moon = yes
							#		planet_size = 9
							#	}
							#	set_planet_flag = moon_ganymede
							#}
						}
						random_system_planet = {
							limit = {
								OR = {
									has_planet_flag = moon_titan
									has_planet_flag = moon_ganymede
								}
							}
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
					if = {
						limit = {
							NOR = {
								space_owner = { has_origin = origin_life_seeded }
								space_owner = { has_origin = origin_shattered_ring }
								space_owner = { has_origin = origin_void_dwellers }
								space_owner = { has_origin = origin_doomsday }
								space_owner = { has_origin = origin_machine }
							}
						}
						if = {
							limit = { NOT = { any_system_planet = { has_planet_flag = planet_mars } } }
							random_system_planet = { # Mars
								limit = {
									is_planet_class = pc_barren
									has_modifier = terraforming_candidate
								}
								set_planet_flag = planet_mars
							}
						}
						random_system_planet = {
							limit = { has_planet_flag = planet_mars }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
						if = {
							limit = { NOT = { any_system_planet = { has_planet_flag = moon_luna } } }
							random_system_planet = { # Luna
								limit = {
									is_planet_class = pc_barren_cold
									is_moon = yes
								}
								set_planet_flag = moon_luna
							}
						}
						random_system_planet = {
							limit = { has_planet_flag = moon_luna }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
				}
			}
			else_if = { # Deneb
				limit = { has_star_flag = deneb_system }
				if = { # Helios or New Luna
					limit = { space_owner = { has_origin = origin_interplanetary_expansion } }
					random_system_planet = {
						limit = {
							is_moon = yes
							is_planet_class = pc_frozen
						}
						if = { # Helios
							limit = { planet_size = 8 }
							set_planet_flag = dormant
							set_planet_flag = planet_helios
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
						else = { set_planet_flag = planet_new_luna }
					}
				}
				if = {
					limit = {
						NOR = {
							space_owner = { has_origin = origin_life_seeded }
							space_owner = { has_origin = origin_shattered_ring }
							space_owner = { has_origin = origin_void_dwellers }
							space_owner = { has_origin = origin_doomsday }
							space_owner = { has_origin = origin_machine }
						}
					}
					while = { # Marble and Tumbleweed
						count = 2
						random_system_planet = {
							limit = {
								OR = {
									is_planet_class = pc_barren
									is_planet_class = pc_barren_cold
								}
							}
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
				}
				if = {
					limit = {
						space_owner = { has_origin = origin_interplanetary_expansion }
						any_system_planet = { has_planet_flag = planet_new_luna }
					}
					random_system_planet = { # New Luna
						limit = { has_planet_flag = planet_new_luna }
						set_planet_flag = dormant
						solar_system = { create_mzilli_settled_colonies_2 = yes }
					}
				}
			}
			else = {
				random_system_planet = {
					limit = { exists = owner }
					if = {
						limit = {
							is_moon = yes
							solar_system = { NOT = { any_system_planet = { has_planet_flag = mzilli_settled_planet } } }
						}
						save_event_target_as = mzilli_settled_moon
						solar_system = {
							random_system_planet = {
								limit = {
									any_moon = { is_planet = event_target:mzilli_settled_moon }
									any_moon = { NOT = { is_planet = event_target:mzilli_settled_moon } }
								}
								random_moon = {
									limit = { NOT = { is_planet = event_target:mzilli_settled_moon } }
									set_planet_flag = mzilli_settled_planet
								}						
							}
						}
					}
				}
				if = {
					limit = {
						NOR = {
							space_owner = { has_origin = origin_life_seeded }
							space_owner = { has_origin = origin_shattered_ring }
							space_owner = { has_origin = origin_void_dwellers }
							space_owner = { has_origin = origin_doomsday }
							space_owner = { has_origin = origin_machine }
						}
					}
					create_mzilli_settled_colonies_1 = yes
					solar_system = { create_mzilli_settled_colonies_2 = yes }
					create_mzilli_settled_colonies_1 = yes
					solar_system = { create_mzilli_settled_colonies_2 = yes }
				}
				if = {
					limit = { space_owner = { has_origin = origin_interplanetary_expansion } }
					create_mzilli_settled_colonies_1 = yes
					solar_system = { create_mzilli_settled_colonies_2 = yes }
				}
			}
			every_system_planet = {
				limit = { has_planet_flag = former_dormant }
				remove_planet_flag = former_dormant
				remove_planet_flag = dormant_generator
				remove_planet_flag = dormant_mining
				remove_planet_flag = mzilli_settled_planet
			}
			if = {
				limit = { space_owner = { has_authority = auth_hive_mind } }
				space_owner = {
					capital_scope = {
						remove_district = district_mining
						add_district = district_farming
					}
				}
			}
		}
		every_planet = {
			limit = {
				OR = {
					is_planet_class = pc_dormant
					is_planet_class = pc_dormant_cold
					is_planet_class = pc_dormant_frozen
				}
			}
			if = {
				limit = { has_modifier = dangerous_wildlife }
				remove_modifier = dangerous_wildlife
			}
			if = {
				limit = { has_modifier = titanic_life }
				remove_modifier = titanic_life
			}
			if = {
				limit = { has_modifier = lush_planet }
				remove_modifier = lush_planet
			}
			if = {
				limit = { has_modifier = bleak_planet }
				remove_modifier = bleak_planet
			}
		}
	}
}

# The CoM's version of the Sol System needs a few days for some reason
planet_event = {
	id = mzilli_settled.2
	title = OK
	desc = OK
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		set_owner = space_owner
		while = {
			count = 3
			create_pop = { species = space_owner }
		}
	}
}