namespace = mzilli_settled

# Distributes Nascent Worlds
event = {
	id = mzilli_settled.1
	title = OK
	desc = OK
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	
	immediate = {
		if = {
			limit = {
				any_country = { has_country_flag = human_2 }
				NOT = { any_system = { has_star_flag = sol } }
			}
			random_system = { spawn_system = { initializer = "com_sol_system" } }
		}
		every_system = {
			limit = {
				OR = {
					has_star_flag = com_sol
					AND = {
						has_star_flag = empire_home_system
						has_star_flag = empire_cluster
						exists = space_owner
						space_owner = {
							is_country_type = default
							NOT = { has_country_flag = no_mzilli_colonies } #modders, add this flag to excluse your custom empires if desired
						}
					}
				}
			}
			if = {
				limit = { any_system_planet = { has_planet_flag = mzilli_settled_planet } }
				if = {
					limit = { NOT = { space_owner = { has_civic = civic_life_seeded } } }
					while = {
						count = 2
						random_system_planet = {
							limit = {
								has_planet_flag = mzilli_settled_planet
								NOT = { has_planet_flag = dormant }
							}
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
				}
				if = {
					limit = { space_owner = { has_civic = civic_interplanetary_expansion } }
					random_system_planet = {
						limit = {
							has_planet_flag = mzilli_settled_planet
							NOT = { has_planet_flag = dormant }
						}
						set_planet_flag = dormant
						solar_system = { create_mzilli_settled_colonies_2 = yes }
					}
				}
			}
			else_if = {
				limit = { has_star_flag = sol }
				if = {
					limit = { has_star_flag = mzilli_martian_system } # Distant Origin mod
					if = {
						limit = { space_owner = { has_civic = civic_interplanetary_expansion } }
						random_system_planet = {
							limit = { has_planet_flag = planet_ganymede }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
					if = {
						limit = { NOT = { space_owner = { has_civic = civic_life_seeded } } }
						random_system_planet = {
							limit = { has_planet_flag = planet_titan }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
						random_system_planet = {
							limit = { has_planet_flag = planet_luna }
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
				}
				else = { # Standard Sol System
					if = { # Titan / Ganymede
						limit = { space_owner = { has_civic = civic_interplanetary_expansion } }
						if = {
							limit = { any_system_planet = { has_planet_flag = moon_titan } }
							random_list = {
								10 = {
									random_system_planet = {
										limit = { has_planet_flag = moon_titan }
										set_planet_flag = dormant
										set_planet_flag = planet_titan
										solar_system = { create_mzilli_settled_colonies_2 = yes }
									}
								}
								10 = {
									random_system_planet = {
										limit = { has_planet_flag = moon_ganymede }
										set_planet_flag = dormant
										set_planet_flag = planet_ganymede
										solar_system = { create_mzilli_settled_colonies_2 = yes }
									}
								}
							}
						}
						else = {
							random_list = {
								10 = {
									random_system_planet = {
										limit = {
											has_ring = yes
											has_moon = yes
											OR = {
												is_planet_class = pc_gas_giant
												is_planet_class = pc_bespin
											}
										}
										random_moon = {
											set_planet_flag = dormant
											set_planet_flag = planet_titan
											solar_system = { create_mzilli_settled_colonies_2 = yes }
										}
									}
								}
								10 = {
									random_system_planet = {
										limit = {
											is_planet_class = pc_frozen
											is_moon = yes
											planet_size = 9
										}
										set_planet_flag = dormant
										set_planet_flag = planet_ganymede
										solar_system = { create_mzilli_settled_colonies_2 = yes }
									}
								}
							}
						}
					}
					if = {
						limit = { NOT = { space_owner = { has_civic = civic_life_seeded } } }
						if = {
							limit = { any_system_planet = { has_planet_flag = planet_mars } }
							random_system_planet = {
								limit = { has_planet_flag = planet_mars }
								set_planet_flag = dormant
								solar_system = { create_mzilli_settled_colonies_2 = yes }
							}
						}
						else = {
							random_system_planet = { # Mars
								limit = {
									is_planet_class = pc_barren
									has_modifier = terraforming_candidate
								}
								set_planet_flag = dormant
								set_planet_flag = planet_mars
								solar_system = { create_mzilli_settled_colonies_2 = yes }
							}
						}
						if = {
							limit = { any_system_planet = { has_planet_flag = moon_luna } }
							random_system_planet = {
								limit = { has_planet_flag = moon_luna }
								set_planet_flag = dormant
								set_planet_flag = planet_luna
								solar_system = { create_mzilli_settled_colonies_2 = yes }
							}
						}
						else = {
							random_system_planet = { # Luna
								limit = {
									is_planet_class = pc_barren_cold
									is_moon = yes
								}
								set_planet_flag = dormant
								set_planet_flag = planet_luna
								solar_system = { create_mzilli_settled_colonies_2 = yes }
							}
						}
					}
				}
			}
			else_if = { # Deneb
				limit = { has_star_flag = deneb_system }
				if = { # Helios
					limit = { space_owner = { has_civic = civic_interplanetary_expansion } }
					random_system_planet = {
						limit = {
							is_moon = yes
							is_planet_class = pc_frozen
							planet_size > 5
						}
						set_planet_flag = dormant
						set_planet_flag = planet_helios
						solar_system = { create_mzilli_settled_colonies_2 = yes }
					}
				}
				if = {
					limit = { NOT = { space_owner = { has_civic = civic_life_seeded } } }
					while = { # Marble and Tumbleweed
						count = 2
						random_system_planet = {
							limit = {
								OR = {
									is_planet_class = pc_barren
									is_planet_class = pc_barren_cold
								}
							}
							set_planet_flag = dormant
							solar_system = { create_mzilli_settled_colonies_2 = yes }
						}
					}
				}
			}
			else = {
				random_system_planet = {
					limit = { exists = owner }
					if = {
						limit = {
							is_moon = yes
							solar_system = { NOT = { any_system_planet = { has_planet_flag = mzilli_settled_planet } } }
						}
						save_event_target_as = mzilli_settled_moon
						solar_system = {
							random_system_planet = {
								limit = {
									any_moon = { is_planet = event_target:mzilli_settled_moon }
									any_moon = { NOT = { is_planet = event_target:mzilli_settled_moon } }
								}
								random_moon = {
									limit = { NOT = { is_planet = event_target:mzilli_settled_moon } }
									set_planet_flag = mzilli_settled_planet
								}						
							}
						}
					}
				}
				if = {
					limit = { NOT = { space_owner = { has_civic = civic_life_seeded } } }
					create_mzilli_settled_colonies_1 = yes
					solar_system = { create_mzilli_settled_colonies_2 = yes }
					create_mzilli_settled_colonies_1 = yes
					solar_system = { create_mzilli_settled_colonies_2 = yes }
				}
				if = {
					limit = { space_owner = { has_civic = civic_interplanetary_expansion } }
					create_mzilli_settled_colonies_1 = yes
					solar_system = { create_mzilli_settled_colonies_2 = yes }
				}
			}
			every_system_planet = {
				limit = { has_planet_flag = former_dormant }
				remove_planet_flag = former_dormant
				remove_planet_flag = dormant_generator
				remove_planet_flag = dormant_mining
				remove_planet_flag = mzilli_settled_planet
			}
		}
	}
}

# The CoM's version of the Sol System needs a few days for some reason
planet_event = {
	id = mzilli_settled.2
	title = OK
	desc = OK
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		set_owner = space_owner
		while = {
			count = 3
			create_pop = { species = space_owner }
		}
	}
}