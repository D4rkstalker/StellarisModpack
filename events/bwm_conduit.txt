namespace = bwm_the_conduit

#300 The Conduit
# Code & idea by Frog, writing by Cc

# Early event & project order
#
# 1 -> bwm_CONDUIT_UNLOCK -> 5
#	-> 11 -> bwm_OBELISK_1_PROJECT -> 21 -> 31
#	-> 12 -> bwm_OBELISK_2_PROJECT -> 22 -> 32
#	-> 13 -> bwm_OBELISK_3_PROJECT -> 23 -> 33
#	-> 14 -> bwm_OBELISK_4_PROJECT -> 24 -> 34

#Initial Encounter & First Project Spawn
ship_event = {
	id = bwm_the_conduit.1
	title = "bwm_the_conduit.1"
	desc = "bwm_the_conduit.1.desc"
	picture = GFX_evt_ancient_alien_temple
	show_sound = event_mystic_reveal_light
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			NOT = {
				has_country_flag = encountered_bwm_conduit
			}
			is_ai = no
		}
		FROM = {
			has_star_flag = bwm_garden_system
			NOT = {
				has_star_flag = bwm_garden_unlock 
			}
		}
	}
	
	immediate = {
		FROM = {
			save_event_target_as = bwm_garden_system 
		}
		owner = {
			set_country_flag = encountered_bwm_conduit
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_garden_chain" 
				}
				end_event_chain = "bwm_lex_garden_chain"
			}
		}
	}		
	
	option = {
		name = "bwm_the_conduit.1.a"
		event_target:bwm_shielded_target = {
			enable_special_project = {
				name = "bwm_CONDUIT_UNLOCK"
				location = THIS
				owner = ROOT
			}
		}
	}
}

#Garden Unlock (Planet Access Granted)
ship_event = {
	id = bwm_the_conduit.5
	title = "bwm_the_conduit.5"
	desc = "bwm_the_conduit.5.desc"
	picture = GFX_evt_animal_wildlife
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_unlock
		}
	}
	
	immediate = {
		set_global_flag = bwm_conduit_unlock
	}
		
	option = {
		name = "bwm_the_conduit.5.a"
		custom_tooltip = bwm_the_conduit.5.a.tooltip
		hidden_effect = {
			random_system = {
				limit = {
					has_star_flag = bwm_garden_system
				}
				random_system_planet = {
						limit = {
							is_planet_class = pc_shielded
							has_planet_flag = bwm_conduit_shielded
							NOT = {
								has_planet_flag = bwm_conduit_garden 
							}
							solar_system = {
								NOT = {
									has_star_flag = bwm_garden_unlock 
								}
							}
						}
						change_pc = pc_gaia
						reroll_deposits = yes
						set_planet_entity = {
							entity = "gaia_planet_01_entity"
						}
						set_planet_flag = bwm_conduit_garden
						set_planet_flag = fallen_empire_world
						set_planet_flag = colony_event
						
						add_modifier = {
							modifier = "bwm_garden_mod"
							days = -1
						}
						# TODO
						#random_tile = {
						#	limit = { has_blocker = no has_building = no num_adjacent_tiles = 2 }
						#	add_building = "bwm_building_obelisk_0_1"		
						#	clear_deposits = yes
						#}
						#random_tile = {
						#	limit = { has_blocker = no has_building = no num_adjacent_tiles = 2 }
						#	add_building = "bwm_building_obelisk_0_2"		
						#	clear_deposits = yes
						#}
						#random_tile = {
						#	limit = { has_blocker = no has_building = no num_adjacent_tiles = 2 }
						#	add_building = "bwm_building_obelisk_0_3"	
						#	clear_deposits = yes
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no num_adjacent_tiles = 2 }
						#	add_building = "bwm_building_obelisk_0_4"	
						#	clear_deposits = yes
						#}
						#random_tile = {
						#	limit = { has_blocker = no has_building = no num_adjacent_tiles > 3 }
						#	set_building = "bwm_building_ancient_ruin_2"
						#	add_deposit = d_rich_mineral_energy_deposit
						#	random_neighboring_tile = {
						#			limit = { has_blocker = no has_building = no }``
						add_building = "building_nourishment_center"
						#			add_deposit = d_immense_farmland_deposit					
						#	}
						#	random_neighboring_tile = {
						#			limit = { has_blocker = no has_building = no }
						add_building = "building_class_4_singularity"
						#			add_deposit = d_immense_energy_deposit						
						#	}
						#	random_neighboring_tile = {
						#			limit = { has_blocker = no has_building = no }
						add_building = "building_class_4_singularity"
						#			add_deposit = d_immense_energy_deposit							
						#	}
						#	random_neighboring_tile = {
						#			limit = { has_blocker = no has_building = no }
						add_building = "building_dimensional_fabricator"
						add_building = "building_nano_forge"
						#			add_deposit = d_immense_mineral_deposit						
						#	}				
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_ancient_ruins	
						#	add_deposit = d_immense_engineering_deposit
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_ancient_ruins	
						#	add_deposit = d_immense_society_deposit
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_ancient_ruins	
						#	add_deposit = d_immense_physics_deposit
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_ancient_ruins	
						#	add_deposit = d_betharian_deposit	
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_bwm_paradise	
						#	add_deposit = d_betharian_deposit
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_bwm_paradise	
						#	add_deposit = d_alien_pets_deposit		
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_bwm_paradise	
						#	add_deposit = d_rich_engineering_deposit
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_bwm_paradise	
						#	add_deposit = d_rich_society_deposit							
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_bwm_paradise	
						#	add_deposit = d_rich_physics_deposit		
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_bwm_paradise	
						#	add_deposit = d_rich_farmland_deposit		
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_bwm_paradise	
						#	add_deposit = d_rich_energy_deposit	
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_bwm_paradise	
						#	add_deposit = d_rich_mineral_deposit	
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_bwm_paradise	
						#	add_deposit = d_bwm_energy_food		
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_bwm_paradise	
						#	add_deposit = d_bwm_energy_food		
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_bwm_paradise	
						#	add_deposit = d_bwm_mineral_food	
						#}
						#random_tile = {
						#	limit = { has_building = no has_blocker = no }
						#	add_deposit = tb_bwm_paradise	
						#	add_deposit = d_bwm_mineral_food	
						#}
						while = {
							count = 4
							add_deposit = bwm_building_obelisk_dep0
						}
				}
				solar_system = {
					set_star_flag = bwm_garden_unlock 
				}
			}
		}
	}
	option = {
		name = "bwm_the_conduit.5.b"
		owner = { 
			add_resource = { influence = 100 }
		}
	}
}

#Conduit Obelisk 1 Init
planet_event = {
	id = bwm_the_conduit.11
	title = "bwm_the_conduit.11"
	desc = "bwm_the_conduit.11.desc"
	picture = GFX_evt_alien_ruins
	location = ROOT
	
	fire_only_once = yes

	mean_time_to_happen = {
		years = 3
	}
	
	trigger = {
		exists = owner
		owner = {
			is_ai = no 
		}	
		NOR = {
			has_global_flag = bwm_conduit_eye_appeared
			has_global_flag = bwm_obelisk_1_research_clear
			has_global_flag = bwm_conduit_pillar_1_activated
			has_planet_flag = bwm_conduit_init_1_lock
		}
		has_deposit = bwm_building_obelisk_dep0
		has_planet_flag = bwm_conduit_garden
		has_ground_combat = no
		num_pops > 0
	}
	
	immediate = {
		set_planet_flag = bwm_conduit_init_1_lock
	}

	option = {
		name = bwm_the_conduit.11.a
		enable_special_project = {
			name = "bwm_OBELISK_1_PROJECT"
			location = root
			owner = root
		}
	}
	
	option = {
		name = bwm_the_conduit.11.b
		owner = { 
			add_resource = { influence = -100 }
		}
	}
}

#Conduit Obelisk 2 Init
planet_event = {
	id = bwm_the_conduit.12
	title = "bwm_the_conduit.12"
	desc = "bwm_the_conduit.12.desc"
	picture = GFX_evt_alien_ruins
	location = ROOT
	
	fire_only_once = yes

	mean_time_to_happen = {
		years = 3
	}
	
	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		NOR = {
			has_global_flag = bwm_conduit_eye_appeared
			has_global_flag = bwm_obelisk_2_research_clear
			has_global_flag = bwm_conduit_pillar_2_activated
			has_planet_flag = bwm_conduit_init_2_lock
		}
		AND = {
			OR = {
				has_global_flag = bwm_obelisk_1_research_clear
				has_global_flag = bwm_conduit_pillar_1_activated
			}
			has_deposit = bwm_building_obelisk_dep0
		}
		has_planet_flag = bwm_conduit_garden
		has_ground_combat = no
		num_pops > 0
	}
	
	immediate = {
		set_planet_flag = bwm_conduit_init_2_lock
	}

	option = {
		name = bwm_the_conduit.12.a
		enable_special_project = {
			name = "bwm_OBELISK_2_PROJECT"
			location = root
			owner = root
		}
	}
	
	option = {
		name = bwm_the_conduit.12.b
		hidden_effect = {
			every_owned_pop = { 
				add_modifier = {
					modifier = "opinion_disrespected"
					days = 360
				}
			}
		}
		owner = { 
			add_resource = { influence = -100 }
		}
	}
}

#Conduit Obelisk 3 Init
planet_event = {
	id = bwm_the_conduit.13
	title = "bwm_the_conduit.13"
	desc = "bwm_the_conduit.13.desc"
	picture = GFX_evt_alien_ruins
	location = ROOT
	
	fire_only_once = yes

	mean_time_to_happen = {
		years = 3
	}
	
	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		NOR = {
			has_global_flag = bwm_conduit_eye_appeared
			has_global_flag = bwm_obelisk_3_research_clear
			has_global_flag = bwm_conduit_pillar_3_activated
			has_planet_flag = bwm_conduit_init_3_lock
		}
		AND = {
			OR = {
				has_global_flag = bwm_obelisk_1_research_clear
				has_global_flag = bwm_conduit_pillar_1_activated
			}
			OR = {
				has_global_flag = bwm_obelisk_2_research_clear
				has_global_flag = bwm_conduit_pillar_2_activated
			}
			has_deposit = bwm_building_obelisk_dep0
		}
		has_planet_flag = bwm_conduit_garden
		has_ground_combat = no
		num_pops > 0
	}
	
	immediate = {
		set_planet_flag = bwm_conduit_init_3_lock
	}

	option = {
		name = bwm_the_conduit.13.a
		enable_special_project = {
			name = "bwm_OBELISK_3_PROJECT"
			location = root
			owner = root
		}
	}
	
	option = {
		name = bwm_the_conduit.13.b
		hidden_effect = {
			every_owned_pop = { 
				add_modifier = {
					modifier = "opinion_disrespected"
					days = 360
				}
			}
		}
		owner = { 
			add_resource = { influence = -100 }
		}
	}
}

#Conduit Obelisk 4 Init
planet_event = {
	id = bwm_the_conduit.14
	title = "bwm_the_conduit.14"
	desc = "bwm_the_conduit.14.desc"
	picture = GFX_evt_alien_ruins
	location = ROOT
	
	fire_only_once = yes

	mean_time_to_happen = {
		years = 3
	}

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		NOR = {
			has_global_flag = bwm_conduit_eye_appeared
			has_global_flag = bwm_obelisk_4_research_clear
			has_global_flag = bwm_conduit_pillar_4_activated
			has_planet_flag = bwm_conduit_init_4_lock
		}
		AND = {
			OR = {
				has_global_flag = bwm_obelisk_1_research_clear
				has_global_flag = bwm_conduit_pillar_1_activated
			}
			OR = {
				has_global_flag = bwm_obelisk_2_research_clear
				has_global_flag = bwm_conduit_pillar_2_activated
			}
			OR = {
				has_global_flag = bwm_obelisk_3_research_clear
				has_global_flag = bwm_conduit_pillar_3_activated
			}
			has_deposit = bwm_building_obelisk_dep0
		}
		has_planet_flag = bwm_conduit_garden
		has_ground_combat = no
		num_pops > 0
	}
	
	immediate = {
		set_planet_flag = bwm_conduit_init_4_lock
	}

	option = {
		name = bwm_the_conduit.14.a
		enable_special_project = {
			name = "bwm_OBELISK_4_PROJECT"
			location = root
			owner = root
		}
	}
	
	option = {
		name = bwm_the_conduit.14.b
		hidden_effect = {
			every_owned_pop = { 
				add_modifier = {
					modifier = "pop_angered"
					days = 360
				}
			}
		}
		owner = { 
			add_resource = { influence = -100 }
		}
	}
}

#Conduit Obelisk 1 Research Complete
planet_event = {
	id = bwm_the_conduit.21
	title = "bwm_the_conduit.21"
	desc = "bwm_the_conduit.21.desc"
	picture = GFX_evt_medieval_alien_civilization
	location = ROOT

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		has_planet_flag = bwm_conduit_garden
		has_deposit = bwm_building_obelisk_dep0
		has_ground_combat = no
		num_pops > 0
		NOT = {
			has_global_flag = bwm_obelisk_1_research_clear
		}
	}

	immediate = {
		set_global_flag = bwm_obelisk_1_research_clear
		random_deposit = {
			limit = { is_deposit_type = bwm_building_obelisk_dep0 }
			clear_blocker = yes
		}
	}

	option = {
		name = EXCELLENT
	}
}

#Conduit Obelisk 2 Research Complete
planet_event = {
	id = bwm_the_conduit.22
	title = "bwm_the_conduit.22"
	desc = "bwm_the_conduit.22.desc"
	picture = GFX_evt_medieval_alien_civilization
	location = ROOT

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		has_planet_flag = bwm_conduit_garden
		has_deposit = bwm_building_obelisk_dep0
		has_ground_combat = no
		num_pops > 0
		NOT = {
			has_global_flag = bwm_obelisk_2_research_clear
		}
	}

	immediate = {
		set_global_flag = bwm_obelisk_2_research_clear
		random_deposit = {
			limit = { is_deposit_type = bwm_building_obelisk_dep0 }
			clear_blocker = yes
		}
	}

	option = {
		name = EXCELLENT
	}
}

#Conduit Obelisk 3 Research Complete
planet_event = {
	id = bwm_the_conduit.23
	title = "bwm_the_conduit.23"
	desc = "bwm_the_conduit.23.desc"
	picture = GFX_evt_medieval_alien_civilization
	location = ROOT

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		has_planet_flag = bwm_conduit_garden
		has_deposit = bwm_building_obelisk_dep0
		has_ground_combat = no
		num_pops > 0
		NOT = {
			has_global_flag = bwm_obelisk_3_research_clear
		}
	}

	immediate = {
		set_global_flag = bwm_obelisk_3_research_clear
		random_deposit = {
			limit = { is_deposit_type = bwm_building_obelisk_dep0 }
			clear_blocker = yes
		}
	}

	option = {
		name = EXCELLENT
	}
}

#Conduit Obelisk 4 Research Complete
planet_event = {
	id = bwm_the_conduit.24
	title = "bwm_the_conduit.24"
	desc = "bwm_the_conduit.24.desc"
	picture = GFX_evt_medieval_alien_civilization
	location = ROOT

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		has_planet_flag = bwm_conduit_garden
		has_deposit = bwm_building_obelisk_dep0
		has_ground_combat = no
		num_pops > 0
		NOT = {
			has_global_flag = bwm_obelisk_4_research_clear
		}
	}

	immediate = {
		set_global_flag = bwm_obelisk_4_research_clear
		random_deposit = {
			limit = { is_deposit_type = bwm_building_obelisk_dep0 }
			clear_blocker = yes
		}
	}

	option = {
		name = EXCELLENT
	}
}

#Conduit Orbital Obelisk 1
planet_event = {
	id = bwm_the_conduit.31
	title = "bwm_the_conduit.31"
	desc = "bwm_the_conduit.31.desc"
	picture = GFX_evt_psionics
	show_sound = event_mystic_reveal
	location = ROOT
	
	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_pillar_1_activated
			has_global_flag = bwm_conduit_eye_appeared
		}
		has_global_flag = bwm_obelisk_1_research_clear
		#from = {
		#	has_deposit = bwm_building_obelisk_dep1
		#}
	}
	
	is_triggered_only = yes

	immediate = {
			add_threat = {
			who = owner 
			amount = 5
			}
			add_modifier = {
			modifier = "bwm_obelisk_1_mod"
			days = -1
			}
			every_owned_pop = { 
				add_modifier = {
					modifier = "bwm_pop_conduit_1"
					days = -1
				}
			}	
			solar_system = {
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = bwm_conduit_pillar_1 }
				save_event_target_as = bwm_conduit_pillar_1_target
			}
			create_ambient_object = {
				type = "bwm_conduit_on_object"
			}
			last_created_ambient_object = {
				set_location = event_target:bwm_conduit_pillar_1_target
				set_ambient_object_flag = bwm_conduit_pillar_1_on
			}
			event_target:bwm_conduit_pillar_1_target = {
			destroy_ambient_object = this 
			}
		}
		set_global_flag = bwm_conduit_pillar_1_activated
	}
	
	option = {
		name = bwm_the_conduit.31.a
	}
}

#Conduit Orbital Obelisk 2
planet_event = {
	id = bwm_the_conduit.32
	title = "bwm_the_conduit.32"
	desc = "bwm_the_conduit.32.desc"
	picture = GFX_evt_psionics
	show_sound = event_mystic_reveal
	location = ROOT
	
	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_pillar_2_activated
			has_global_flag = bwm_conduit_eye_appeared
		}
		has_global_flag = bwm_obelisk_2_research_clear
		#from = {
		#	has_building = bwm_building_obelisk_2
		#}
	}
	
	is_triggered_only = yes

	immediate = {
			add_threat = {
			who = owner 
			amount = 5
			}
			add_modifier = {
			modifier = "bwm_obelisk_2_mod"
			days = -1
			}
			every_owned_pop = { 
				add_modifier = {
					modifier = "bwm_pop_conduit_2"
					days = -1
				}
			}
			solar_system = {
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = bwm_conduit_pillar_2 }
				save_event_target_as = bwm_conduit_pillar_2_target
			}
			create_ambient_object = {
				type = "bwm_conduit_on_object"
			}
			last_created_ambient_object = {
				set_location = event_target:bwm_conduit_pillar_2_target
				set_ambient_object_flag = bwm_conduit_pillar_2_on
			}
			event_target:bwm_conduit_pillar_2_target = {
			destroy_ambient_object = this 
			}
		}
		set_global_flag = bwm_conduit_pillar_2_activated
	}
	
	option = {
		name = bwm_the_conduit.32.a
	}
}

#Conduit Orbital Obelisk 3
planet_event = {
	id = bwm_the_conduit.33
	title = "bwm_the_conduit.33"
	desc = "bwm_the_conduit.33.desc"
	picture = GFX_evt_psionics
	show_sound = event_mystic_reveal
	location = ROOT
	
	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_eye_appeared
			has_global_flag = bwm_conduit_pillar_3_activated
		}
		has_global_flag = bwm_obelisk_3_research_clear
		#from = {
		#	has_building = bwm_building_obelisk_3
		#}
	}
	
	is_triggered_only = yes

	immediate = {
		add_threat = {
		who = owner 
		amount = 5
		}
		add_modifier = {
		modifier = "bwm_obelisk_3_mod"
		days = -1
		}
		every_owned_pop = { 
			add_modifier = {
				modifier = "bwm_pop_conduit_3"
				days = -1
			}
		}
		solar_system = {
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = bwm_conduit_pillar_3 }
				save_event_target_as = bwm_conduit_pillar_3_target
			}
			create_ambient_object = {
				type = "bwm_conduit_on_object"
			}
			last_created_ambient_object = {
				set_location = event_target:bwm_conduit_pillar_3_target
				set_ambient_object_flag = bwm_conduit_pillar_3_on
			}
			event_target:bwm_conduit_pillar_3_target = {
			destroy_ambient_object = this 
			}	
		}
		set_global_flag = bwm_conduit_pillar_3_activated
	}
	
	option = {
		name = bwm_the_conduit.33.a
	}
}

#Conduit Orbital Obelisk 4
planet_event = {
	id = bwm_the_conduit.34
	title = "bwm_the_conduit.34"
	desc = "bwm_the_conduit.34.desc"
	picture = GFX_evt_psionics
	show_sound = event_mystic_reveal
	location = ROOT
	
	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_eye_appeared
			has_global_flag = bwm_conduit_pillar_4_activated
		}
		has_global_flag = bwm_obelisk_4_research_clear
		#from = {
		#	has_building = bwm_building_obelisk_4
		#}
	}
	
	is_triggered_only = yes

	immediate = {
			add_threat = {
			who = owner 
			amount = 5
			}
			add_modifier = {
			modifier = "bwm_obelisk_4_mod"
			days = -1
			}
			every_owned_pop = { 
				add_modifier = {
					modifier = "bwm_pop_conduit_4"
					days = -1
				}
			}
			solar_system = {
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = bwm_conduit_pillar_4 }
				save_event_target_as = bwm_conduit_pillar_4_target
			}
			create_ambient_object = {
				type = "bwm_conduit_on_object"
			}
			last_created_ambient_object = {
				set_location = event_target:bwm_conduit_pillar_4_target
				set_ambient_object_flag = bwm_conduit_pillar_4_on
			}
			event_target:bwm_conduit_pillar_4_target = {
			destroy_ambient_object = this 
			}
		}
		set_global_flag = bwm_conduit_pillar_4_activated
	}
	
	option = {
		name = bwm_the_conduit.34.a
	}
}

#Conduit Crisis Init
country_event = {
	id = bwm_the_conduit.50
	hide_window = yes
	
	fire_only_once = yes
	
	trigger = {
		
		OR = {
			has_global_flag = bwm_conduit_pillar_1_activated
			has_global_flag = bwm_conduit_pillar_2_activated
			has_global_flag = bwm_conduit_pillar_3_activated
			has_global_flag = bwm_conduit_pillar_4_activated
		}
		NOT = {
			has_global_flag = bwm_conduit_eye_appeared 
		}
	}
	
	mean_time_to_happen = {
		years = 2000
		
		modifier = {
			factor = 0.8
			has_global_flag = bwm_conduit_pillar_1_activated
		}
		modifier = {
			factor = 0.4
			AND = {
				has_global_flag = bwm_conduit_pillar_1_activated
				has_global_flag = bwm_conduit_pillar_2_activated
			}
		}
		modifier = {
			factor = 0.2
			AND = {
				has_global_flag = bwm_conduit_pillar_1_activated
				has_global_flag = bwm_conduit_pillar_2_activated
				has_global_flag = bwm_conduit_pillar_3_activated
			}
		}
		modifier = {
			factor = 0.1
			AND = {
				has_global_flag = bwm_conduit_pillar_1_activated
				has_global_flag = bwm_conduit_pillar_2_activated
				has_global_flag = bwm_conduit_pillar_3_activated
				has_global_flag = bwm_conduit_pillar_4_activated
			}
		}
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system 
			}
			every_system_planet = {
				if = {
					limit = { 
						has_planet_flag = bwm_conduit_garden
					}
					add_modifier = {
						modifier = "bwm_obelisk_5_mod"
						days = -1
					}
				}
				if = {
					limit = {
						is_star = yes
					}
					save_event_target_as = bwm_garden_star_locator
				}
			}
			create_ambient_object = {
				type = "bwm_conduit_eye_object"
			}
			last_created_ambient_object = {
				set_location = event_target:bwm_garden_star_locator
				set_ambient_object_flag = bwm_conduit_eye_flag
				save_event_target_as = bwm_conduit_eye_locator
			}
			create_ambient_object = {
				type = bwm_effect_explosion_3_object
				duration = 10
				
				use_3d_location = yes
				
				entity_offset = { min = 0 max = 0 }
				entity_offset_angle = { min = 0 max = 0 }
				entity_offset_height = { min = 0 max = 0 }
				
				entity_scale_to_size = yes
				scale = 5
			}
			last_created_ambient_object = {
				set_location = {
					target = event_target:bwm_conduit_eye_locator
					distance = 0
					angle = 675 
				}
			}
			save_event_target_as = bwm_conduit_system
		}
		every_country = {
			if = {
				limit = {
					is_ai = no
					any_owned_planet = {
						has_planet_flag = bwm_conduit_garden
					}
				}
				set_country_flag = bwm_conduit_target
				country_event = { id = bwm_the_conduit.51 }
			}
		}
		set_global_flag = bwm_conduit_eye_appeared
		country_event = { id = bwm_the_conduit.55 days = 1080 }
	}
}

country_event = {
	id = bwm_the_conduit.51
	title = "bwm_the_conduit.51"
	desc = "bwm_the_conduit.51.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_activating_unknown_technology
	
	is_triggered_only = yes

	option = {
		name = WORRYING
	}
}

#Conduit Crisis Start
country_event = {
	id = bwm_the_conduit.55
	hide_window = yes
	
	is_triggered_only = yes
	
	fire_only_once = yes
	
	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_crisis_toggle
		}
	}
	
	immediate = {
		random_owned_starbase = {
			limit = {
				solar_system = {
					has_star_flag = bwm_garden_system
				}
			}
			delete_ship = this
		}
		set_global_flag = bwm_conduit_crisis_toggle
		create_country = {
			name = "The Garden"
			type = bwm_conduit_guardian
			flag = {
				icon = {
					category = "spherical"
					file = "flag_spherical_20.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				 colors={
						"dark_brown"
						"dark_brown"
						"null"
						"null"
				}
			}
			effect = {
				if = {
					limit = {
						NOT = {
							has_modifier = bwm_conduit_power
						}
					}
					add_modifier = {
						modifier = bwm_conduit_power
						days = -1
					}
				}
				save_global_event_target_as = bwm_conduit_country
				set_country_flag = bwm_conduit_country
				set_graphical_culture = fallen_empire_03
				#guardian_difficulty = yes
			}
		}
		event_target:bwm_conduit_system = {
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden
				}
				set_owner = event_target:bwm_conduit_country
			}
			every_system_ambient_object = {
				if = {
					limit = {
						has_ambient_object_flag = bwm_conduit_eye_flag 
					}
					save_event_target_as = bwm_conduit_eye_spawn
				}
				if = {
					limit = {
						OR = {
							has_ambient_object_flag = bwm_conduit_pillar_1
							has_ambient_object_flag = bwm_conduit_pillar_1_on
						}
					}
					save_event_target_as = bwm_conduit_pillar_1_spawn
				}
				if = {
					limit = {
						OR = {
							has_ambient_object_flag = bwm_conduit_pillar_2
							has_ambient_object_flag = bwm_conduit_pillar_2_on
						}
					}
					save_event_target_as = bwm_conduit_pillar_2_spawn
				}
				if = {
					limit = {
						OR = {
							has_ambient_object_flag = bwm_conduit_pillar_3
							has_ambient_object_flag = bwm_conduit_pillar_3_on
						}
					}
					save_event_target_as = bwm_conduit_pillar_3_spawn
				}
				if = {
					limit = {
						OR = {
							has_ambient_object_flag = bwm_conduit_pillar_4
							has_ambient_object_flag = bwm_conduit_pillar_4_on
						}
					}
					save_event_target_as = bwm_conduit_pillar_4_spawn
				}
			}
			bwm_conduit_owner_swap = yes
			if = {
				limit = {
					NOT = {
						any_system = {
							has_star_flag = bwm_garden_anchor_1_system
						}
					}
				}
				spawn_system = {
					min_distance = 20
					max_distance = 80
					initializer = "bwm_garden_anchor_1_init"
				}
			}
			if = {
				limit = {
					NOT = {
						any_system = {
							has_star_flag = bwm_garden_anchor_2_system
						}
					}
				}
				spawn_system = {
					min_distance = 20
					max_distance = 80
					initializer = "bwm_garden_anchor_2_init"
				}
			}
			if = {
				limit = {
					NOT = {
						any_system = {
							has_star_flag = bwm_garden_anchor_3_system
						}
					}
				}
				spawn_system = {
					min_distance = 20
					max_distance = 80
					initializer = "bwm_garden_anchor_3_init"
				}
			}
			if = {
				limit = {
					NOT = {
						any_system = {
							has_star_flag = bwm_garden_anchor_4_system
						}
					}
				}
				spawn_system = {
					min_distance = 20
					max_distance = 80
					initializer = "bwm_garden_anchor_4_init"
				}
			}
		}
		random_system = {
			limit = {
				has_star_flag = bwm_garden_anchor_1_system
			}
			create_starbase = {
				size = "starbase_outpost"
				owner = event_target:bwm_conduit_country
			}
			random_system_planet = {
				limit = {
					is_star = yes
					has_planet_flag = bwm_garden_anchor_1_star
				}
				save_event_target_as = bwm_conduit_anchor_1_spawn
			}
		}
		random_system = {
			limit = {
				has_star_flag = bwm_garden_anchor_2_system
			}
			create_starbase = {
				size = "starbase_outpost"
				owner = event_target:bwm_conduit_country
			}
			random_system_planet = {
				limit = {
					is_star = yes
					has_planet_flag = bwm_garden_anchor_2_star
				}
				save_event_target_as = bwm_conduit_anchor_2_spawn
			}
		}
		random_system = {
			limit = {
				has_star_flag = bwm_garden_anchor_3_system
			}
			create_starbase = {
				size = "starbase_outpost"
				owner = event_target:bwm_conduit_country
			}
			random_system_planet = {
				limit = {
					is_star = yes
					has_planet_flag = bwm_garden_anchor_3_star
				}
				save_event_target_as = bwm_conduit_anchor_3_spawn
			}
		}
		random_system = {
			limit = {
				has_star_flag = bwm_garden_anchor_4_system
			}
			create_starbase = {
				size = "starbase_outpost"
				owner = event_target:bwm_conduit_country
			}
			random_system_planet = {
				limit = {
					is_star = yes
					has_planet_flag = bwm_garden_anchor_4_star
				}
				save_event_target_as = bwm_conduit_anchor_4_spawn
			}
		}
		bwm_conduit_pillar_stations = yes
		bwm_conduit_bulwark = yes
		last_created_fleet = {
			bwm_effect_explosion_4 = yes
		}
		bwm_conduit_fleet_1 = yes
		bwm_conduit_fleet_2 = yes
		#bwm_conduit_fleet_3 = yes
		bwm_conduit_anchor_1 = yes
		bwm_conduit_anchor_2 = yes
		bwm_conduit_anchor_3 = yes
		bwm_conduit_anchor_4 = yes
		event_target:bwm_conduit_country = {
			country_event = { id = bwm_the_conduit.59 days = 30 }
		}
		event_target:bwm_conduit_eye_spawn = {
			destroy_ambient_object = this 
		}
		event_target:bwm_conduit_pillar_1_spawn = {
			destroy_ambient_object = this 
		}
		event_target:bwm_conduit_pillar_2_spawn = {
			destroy_ambient_object = this 
		}
		event_target:bwm_conduit_pillar_3_spawn = {
			destroy_ambient_object = this 
		}
		event_target:bwm_conduit_pillar_4_spawn = {
			destroy_ambient_object = this 
		}
		every_country = {
			if = {
				limit = {
					is_ai = no
					NOT = {
						has_event_chain = bwm_lex_conduit_chain
					}
				}
				begin_event_chain = {
					event_chain = "bwm_lex_conduit_chain"
					target = this
				}
			}
			if = {
				limit = {
					is_ai = no
					has_country_flag = bwm_conduit_target
				}
				country_event = { id = bwm_the_conduit.56 }
			}
			create_point_of_interest = {
				id = bwm_conduit_anchor_poi.1
				name = "bwm_conduit_anchor_1_poi"
				desc = "bwm_conduit_anchor_1_poi_desc"
				event_chain = bwm_lex_conduit_chain
				location = event_target:bwm_conduit_anchor_1_spawn
			}
			create_point_of_interest = {
				id = bwm_conduit_anchor_poi.2
				name = "bwm_conduit_anchor_2_poi"
				desc = "bwm_conduit_anchor_2_poi_desc"
				event_chain = bwm_lex_conduit_chain
				location = event_target:bwm_conduit_anchor_2_spawn
			}
			create_point_of_interest = {
				id = bwm_conduit_anchor_poi.3
				name = "bwm_conduit_anchor_3_poi"
				desc = "bwm_conduit_anchor_3_poi_desc"
				event_chain = bwm_lex_conduit_chain
				location = event_target:bwm_conduit_anchor_3_spawn
			}
			create_point_of_interest = {
				id = bwm_conduit_anchor_poi.4
				name = "bwm_conduit_anchor_4_poi"
				desc = "bwm_conduit_anchor_4_poi_desc"
				event_chain = bwm_lex_conduit_chain
				location = event_target:bwm_conduit_anchor_4_spawn
			}
			establish_communications_no_message = event_target:bwm_conduit_country
		}
	}
}

country_event = {
	id = bwm_the_conduit.56
	title = "bwm_the_conduit.56"
	desc = "bwm_the_conduit.56.desc"
	picture = GFX_evt_fleet_evil
	show_sound = event_red_alert
	location = event_target:bwm_conduit_system
	
	is_triggered_only = yes
	
	option = {
		name = "bwm_the_conduit.56.a"
	}
}

fleet_event = {
	id = bwm_the_conduit.57
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		log = "bwm_the_conduit.57"
		queue_actions = {
			repeat = {
				find_random_system = {
					trigger = {
						id = bwm_conduit_roam.4.trigger.1
						#NOR = {
						#	has_star_flag = enclave
						#	has_star_flag = guardian
						#	has_star_flag = bwm_ring_system
						#	has_star_flag = bwm_grave_system
						#	has_star_flag = bwm_garden_system
						#	has_star_flag = bwm_prison_system
						#	has_star_flag = bwm_gate_system
						#	has_star_flag = bwm_cipher_1_system
						#	has_star_flag = bwm_cipher_2_system
						#	has_star_flag = bwm_cipher_3_system
						#}
						is_inside_border = event_target:bwm_conduit_country 
					}
					found_system = {
						move_to = this
						find_closest_planet = {
							trigger = {
								id = bwm_conduit_roam.4.trigger.2
								is_star = yes
							}
							found_planet = {
								move_to = this
								orbit_planet = this
								wait = {
									duration = 10
									random = 50
								}
							}
						}
					}
				}
			}
		}
	}
}

fleet_event = {
	id = bwm_the_conduit.58
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		queue_actions = {
			repeat = {
				find_closest_planet  = {
					trigger = {
						id = bwm_conduit.patrol.1
						has_planet_flag = bwm_arcadia_patrol_1
					}
					found_planet = {
						move_to = this
						orbit_planet = this
						wait = {
							duration = 30
							random = 15
						}
					}
				}
				find_closest_planet  = {
					trigger = {
						id = bwm_conduit.patrol.2
						has_planet_flag = bwm_arcadia_patrol_2
					}
					found_planet = {
						move_to = this
						orbit_planet = this
						wait = {
							duration = 30
							random = 15
						}
					}
				}
				find_closest_planet  = {
					trigger = {
						id = bwm_conduit.patrol.3
						has_planet_flag = bwm_arcadia_patrol_3
					}
					found_planet = {
						move_to = this
						orbit_planet = this
						wait = {
							duration = 30
							random = 15
						}
					}
				}	
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.59
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		exists = this
		exists = event_target:bwm_conduit_fortress_spawn
		is_country = event_target:bwm_conduit_country
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		NAND = {
			has_country_flag = bwm_conduit_fleet_1_lockout
			has_country_flag = bwm_conduit_fleet_2_lockout
			has_country_flag = bwm_conduit_fleet_3_lockout
			has_country_flag = bwm_conduit_fleet_4_lockout
		}
	}
	
	immediate = {
		random_list = {
			25 = {
				if = {
					limit = {
						NOT = {
							has_country_flag = bwm_conduit_fleet_1_lockout
						}
					}
					if = {
						limit = {
							check_variable = { 
								which = "bwm_conduit_fleet_1_lock" 
								value < 1
							}
						}
						set_variable = {
							which = "bwm_conduit_fleet_1_lock"
							value = 1
						}
						bwm_conduit_fleet_roaming_1 = yes
						if = {
							limit = {
								exists = event_target:bwm_conduit_country
							}
							country_event = { id = bwm_the_conduit.59 days = 90 }
						}
					}
					else = {
						change_variable = {
							which = "bwm_conduit_fleet_1_lock"
							value = 1
						}
						bwm_conduit_fleet_roaming_1 = yes
						if = {
							limit = {
								exists = event_target:bwm_conduit_country
							}
							country_event = { id = bwm_the_conduit.59 days = 90 }
						}
						if = {
							limit = {
								check_variable = {
									which = "bwm_conduit_fleet_1_lock"
									value = 10
								}
							}
							set_country_flag = bwm_conduit_fleet_1_lockout
						}
					}
				}
				break = yes
			}
			25 = {
				if = {
					limit = {
						NOT = {
							has_country_flag = bwm_conduit_fleet_2_lockout
						}
					}
					if = {
						limit = {
							check_variable = { 
								which = "bwm_conduit_fleet_2_lock" 
								value < 1
							}
						}
						set_variable = {
							which = "bwm_conduit_fleet_2_lock"
							value = 1
						}
						bwm_conduit_fleet_roaming_2 = yes
						if = {
							limit = {
								exists = event_target:bwm_conduit_country
							}
							country_event = { id = bwm_the_conduit.59 days = 90 }
						}
					}
					else = {
						change_variable = {
							which = "bwm_conduit_fleet_2_lock"
							value = 1
						}
						bwm_conduit_fleet_roaming_2 = yes
						if = {
							limit = {
								exists = event_target:bwm_conduit_country
							}
							country_event = { id = bwm_the_conduit.59 days = 90 }
						}
						if = {
							limit = {
								check_variable = {
									which = "bwm_conduit_fleet_2_lock"
									value = 10
								}
							}
							set_country_flag = bwm_conduit_fleet_2_lockout
						}
					}
				}
				break = yes
			}
			25 = {
				if = {
					limit = {
						NOT = {
							has_country_flag = bwm_conduit_fleet_3_lockout
						}
					}
					if = {
						limit = {
							check_variable = { 
								which = "bwm_conduit_fleet_3_lock" 
								value < 1
							}
						}
						set_variable = {
							which = "bwm_conduit_fleet_3_lock"
							value = 1
						}
						bwm_conduit_fleet_roaming_3 = yes
						if = {
							limit = {
								exists = event_target:bwm_conduit_country
							}
							country_event = { id = bwm_the_conduit.59 days = 90 }
						}
					}
					else = {
						change_variable = {
							which = "bwm_conduit_fleet_3_lock"
							value = 1
						}
						bwm_conduit_fleet_roaming_3 = yes
						if = {
							limit = {
								exists = event_target:bwm_conduit_country
							}
							country_event = { id = bwm_the_conduit.59 days = 90 }
						}
						if = {
							limit = {
								check_variable = {
									which = "bwm_conduit_fleet_3_lock"
									value = 10
								}
							}
							set_country_flag = bwm_conduit_fleet_3_lockout
						}
					}
				}
				break = yes
			}
			25 = {
				if = {
					limit = {
						NOT = {
							has_country_flag = bwm_conduit_fleet_4_lockout
						}
					}
					if = {
						limit = {
							check_variable = { 
								which = "bwm_conduit_fleet_4_lock" 
								value < 1
							}
						}
						set_variable = {
							which = "bwm_conduit_fleet_4_lock"
							value = 1
						}
						bwm_conduit_fleet_roaming_4 = yes
						if = {
							limit = {
								exists = event_target:bwm_conduit_country
							}
							country_event = { id = bwm_the_conduit.59 days = 90 }
						}
					}
					else = {
						change_variable = {
							which = "bwm_conduit_fleet_4_lock"
							value = 1
						}
						bwm_conduit_fleet_roaming_4 = yes
						if = {
							limit = {
								exists = event_target:bwm_conduit_country
							}
							country_event = { id = bwm_the_conduit.59 days = 90 }
						}
						if = {
							limit = {
								check_variable = {
									which = "bwm_conduit_fleet_4_lock"
									value = 10
								}
							}
							set_country_flag = bwm_conduit_fleet_4_lockout
						}
					}
				}
				break = yes
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.60
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_conduit_avatar_spawn_lockout
			any_owned_fleet = {
				has_fleet_flag = bwm_conduit_boss_fleet
			}
		}
		AND = {
			has_global_flag = bwm_conduit_anchor_1_off
			has_global_flag = bwm_conduit_anchor_2_off
			has_global_flag = bwm_conduit_anchor_3_off
			has_global_flag = bwm_conduit_anchor_4_off
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_avatar_spawn_lockout
		bwm_conduit_fleet_boss = yes
	}
}

#Conduit Mothership summons help

fleet_event = {
	id = bwm_the_conduit.64
	hide_window = yes
	
	trigger = {
		NAND = {
			has_global_flag = bwm_conduit_anchor_1_off
			has_global_flag = bwm_conduit_anchor_2_off
			has_global_flag = bwm_conduit_anchor_3_off
			has_global_flag = bwm_conduit_anchor_4_off
		}
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = bwm_conduit_guardian
			}
			NOT = { 
				has_fleet_flag = bwm_conduit_summon_cooldown
			}
			any_owned_ship = {
				is_ship_size = bwm_conduit_fortress
				has_hp_percentage < 0.8
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = bwm_conduit_guardian
				}
				NOT = { 
					has_fleet_flag = bwm_conduit_summon_cooldown
				}
				any_owned_ship = {
					is_ship_size = bwm_conduit_fortress
				}
			}
			random_system = {
				limit = {
					has_star_flag = bwm_garden_system
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_4 = yes
					save_event_target_as = bwm_conduit_summon
				}
				every_fleet_in_system = {
					if = {
						limit = {
							exists = owner
							owner = {
								is_ai = no
								NOT = {
									is_country_type = bwm_conduit_guardian
								}
							}
						}
						owner = {
							country_event = { id = bwm_the_conduit.65 }
						}
					}
				}
			}
			event_target:bwm_conduit_country = {
				random_list = {
					25 = {
						while = {
							count = 4
							bwm_conduit_summon_1 = yes
						}
					}
					25 = {
						while = {
							count = 4
							bwm_conduit_summon_2 = yes
						}
					}
					25 = {
						while = {
							count = 4
							bwm_conduit_summon_3 = yes
						}
					}
					25 = {
						while = {
							count = 4
							bwm_conduit_summon_4 = yes
						}
					}
				}
			}
			set_timed_fleet_flag = {
				flag = bwm_conduit_summon_cooldown
				days = 360
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.65
	title = "bwm_the_conduit.65"
	desc = "bwm_the_conduit.65.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_yellow_alert
	location = event_target:bwm_conduit_summon
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_conduit_summon_notification
		}
	}
	
	immediate = {
		set_timed_country_flag = {
			flag = bwm_conduit_summon_notification
			days = 30
		}
	}
	
	option = {
		name = BATTLESTATIONS
	}
}

country_event = {
	id = bwm_the_conduit.66
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			is_ship_size = bwm_conduit_avatar_alt
		}
	}
	
	immediate = {
		FROMFROM = {
			if = {
				limit = {
					NOT = {
						has_ship_flag = bwm_conduit_core_repair_cd
					}
					has_modifier = bwm_conduit_sacrifice_power
					has_hp_percentage < 0.5
					has_hp_percentage > 0
				}
				set_timed_ship_flag = {
					flag = bwm_conduit_core_repair_cd
					days = 30
				}
				remove_modifier = "bwm_conduit_sacrifice_power"
				repair_ship = yes
			}
			add_modifier = {
				modifier = "bwm_conduit_core_kill_bonus"
				days = 60
			}
		}
	}
}

#Conduit Crisis Research (Hidden)
country_event = {
	id = bwm_the_conduit.70
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = bwm_conduit_guardian
		
		from = {
			NOT = {
				has_country_flag = bwm_conduit_weakness_check
			}
			is_ai = no
			
			AND = {
				OR = {
					has_technology = "tech_ship_armor_5"
					has_technology = "tech_dragon_armor"
					has_technology = "tech_bwm_lex_armor"
				}
				OR = {
					has_technology = "tech_shields_5"
					has_technology = "tech_psionic_shield"
					#has_technology = "tech_enigmatic_deflector"
					has_technology = "tech_bwm_lex_shield"
				}		
				OR = {
					has_technology = "tech_zero_point_power"
					#has_technology = "tech_enigmatic_power_core"
					has_technology = "tech_bwm_lex_power"
				}
				OR = {
					has_technology = "tech_energy_lance_2"
					has_technology = "tech_arc_emitter_2"
					has_technology = "tech_mass_accelerator_2"
				}
			}
		}
	}

	immediate = {
		random_list = {
			50 = {
				if = {
					limit = {
						check_variable = {
							which = "bwm_conduit_kill_counter"
							value < 1
						}
					}
					set_variable = {
						which = "bwm_conduit_kill_counter"
						value = 1
					}
				}
				else = {
					change_variable = {
						which = "bwm_conduit_kill_counter"
						value = 1
					}
					if = {
						limit ={
							check_variable = {
								which = "bwm_conduit_kill_counter"
								value > 5
							}
						}
						set_variable = {
							which = "bwm_conduit_kill_counter"
							value = 5
						}
					}
					if = {
						limit = {
							check_variable = {
								which = "bwm_conduit_kill_counter"
								value = 5
							}
						}
						from = {
							set_country_flag = bwm_conduit_weakness_check
							country_event = { id = bwm_the_conduit.71 days = 30 }
						}
					}
				}
			}
			50 = {
			}
		}
	}
}

#Conduit Crisis Research (Offer Project)
country_event = {
	id = bwm_the_conduit.71
	title = "bwm_the_conduit.71"
	desc = "bwm_the_conduit.71.desc"
	picture = GFX_evt_exploding_ship
	is_triggered_only = yes

	trigger = {
		NOT = {
			any_country = {
				has_country_flag = bwm_conduit_slayer
			}
			has_country_flag = bwm_conduit_weakness_researched 
		}
	}

	option = {
		name = bwm_the_conduit.71.a
		allow = {
			hidden_trigger = {
				NOT = { has_modifier = bwm_conduit_weakness }
			}
		}
		capital_scope = { save_event_target_as = bwm_pc_home }
		hidden_effect = { set_country_flag = bwm_conduit_weakness_researched }
		enable_special_project = {
			name = "bwm_CONDUIT_WEAKNESS_PROJECT"
			location = event_target:bwm_pc_home
			owner = ROOT
		}
	}
	option = {
		name = bwm_the_conduit.71.b
		add_resource = { influence = 100 }
	}
}

#Conduit Crisis Research (Project Complete)
country_event = {
	id = bwm_the_conduit.72
	title = "bwm_the_conduit.72"
	desc = "bwm_the_conduit.72.desc"
	picture = GFX_evt_physics_research
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_modifier = bwm_conduit_weakness
		}
	}
	
	option = {
		name = bwm_the_conduit.72.a
		add_modifier = {
			modifier = bwm_conduit_weakness
			days = -1
		}
	}
}

#Avatar Destroyed
country_event = {
	id = bwm_the_conduit.73
	hide_window = yes
	is_triggered_only = yes
	
	#fire_only_once = yes

	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_avatar
		}
	}

	immediate = {
		FROMFROM = {
			bwm_effect_explosion_4 = yes
		}
		every_country = {
			limit = { 
				is_country_type = bwm_conduit_guardian
				NOT = { has_modifier = bwm_conduit_avatar_debuff }
			}
			add_modifier = {
				modifier = "bwm_conduit_avatar_debuff"
				days = 360
			}
		}
	}
}

#Anchor 1 Destroyed
country_event = {
	id = bwm_the_conduit.74
	hide_window = yes
	is_triggered_only = yes
	
	#fire_only_once = yes

	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_anchor_1_off
		}
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_converter
			has_ship_flag = bwm_anchor_1_crucible
		}
	}

	immediate = {
		log = "bwm_the_conduit.74"
		print_scope_effect = yes
		FROMFROM = {
			bwm_effect_explosion_4 = yes
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_conduit_chain" 
				}
				remove_point_of_interest = bwm_conduit_anchor_poi.1
				add_event_chain_counter = { 
					event_chain = "bwm_lex_conduit_chain" 
					counter = "bwm_conduit_anchor_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_conduit_guardian
					NOT = {
						has_modifier = bwm_conduit_anchor_1_debuff 
					}
				}
				add_modifier = {
					modifier = "bwm_conduit_anchor_1_debuff"
					days = 360
				}
			}
		}
		set_global_flag = bwm_conduit_anchor_1_off
		country_event = { id = bwm_the_conduit.60 }
	}
}

#Anchor 2 Destroyed
country_event = {
	id = bwm_the_conduit.75
	hide_window = yes
	is_triggered_only = yes
	
	#fire_only_once = yes

	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_anchor_2_off
		}
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_converter
			has_ship_flag = bwm_anchor_2_crucible
		}
	}

	immediate = {
		log = "bwm_the_conduit.75"
		FROMFROM = {
			bwm_effect_explosion_4 = yes
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_conduit_chain" 
				}
				remove_point_of_interest = bwm_conduit_anchor_poi.2
				add_event_chain_counter = { 
					event_chain = "bwm_lex_conduit_chain" 
					counter = "bwm_conduit_anchor_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_conduit_guardian
					NOT = {
						has_modifier = bwm_conduit_anchor_2_debuff 
					}
				}
				add_modifier = {
					modifier = "bwm_conduit_anchor_2_debuff"
					days = 360
				}
			}
		}
		set_global_flag = bwm_conduit_anchor_2_off
		country_event = { id = bwm_the_conduit.60 }
	}
}

#Anchor 3 Destroyed
country_event = {
	id = bwm_the_conduit.76
	hide_window = yes
	is_triggered_only = yes
	
	#fire_only_once = yes

	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_anchor_3_off
		}
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_converter
			has_ship_flag = bwm_anchor_3_crucible
		}
	}

	immediate = {
		log = "bwm_the_conduit.76"
		FROMFROM = {
			bwm_effect_explosion_4 = yes
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_conduit_chain" 
				}
				remove_point_of_interest = bwm_conduit_anchor_poi.3
				add_event_chain_counter = { 
					event_chain = "bwm_lex_conduit_chain" 
					counter = "bwm_conduit_anchor_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_conduit_guardian
					NOT = {
						has_modifier = bwm_conduit_anchor_3_debuff 
					}
				}
				add_modifier = {
					modifier = "bwm_conduit_anchor_3_debuff"
					days = 360
				}
			}
		}
		set_global_flag = bwm_conduit_anchor_3_off
		country_event = { id = bwm_the_conduit.60 }
	}
}

#Anchor 4 Destroyed
country_event = {
	id = bwm_the_conduit.77
	hide_window = yes
	is_triggered_only = yes
	
	#fire_only_once = yes

	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_anchor_4_off
		}
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_converter
			has_ship_flag = bwm_anchor_4_crucible
		}
	}

	immediate = {
		log = "bwm_the_conduit.77"
		FROMFROM = {
			bwm_effect_explosion_4 = yes
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_conduit_chain" 
				}
				remove_point_of_interest = bwm_conduit_anchor_poi.4
				add_event_chain_counter = { 
					event_chain = "bwm_lex_conduit_chain" 
					counter = "bwm_conduit_anchor_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_conduit_guardian
					NOT = {
						has_modifier = bwm_conduit_anchor_4_debuff 
					}
				}
				add_modifier = {
					modifier = "bwm_conduit_anchor_4_debuff"
					days = 360
				}
			}
		}
		set_global_flag = bwm_conduit_anchor_4_off
		country_event = { id = bwm_the_conduit.60 }
	}
}

country_event = {
	id = bwm_the_conduit.78
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_1_fortress_1
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_1_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_1_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.79
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_1_fortress_2
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_1_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_1_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.80
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_1_fortress_3
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_1_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_1_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.81
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_1_fortress_4
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_1_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_1_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.82
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_2_fortress_1
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_2_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_2_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.83
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_2_fortress_2
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_2_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_2_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.84
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_2_fortress_3
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_2_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_2_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.85
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_2_fortress_4
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_2_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_2_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.86
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_3_fortress_1
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_3_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_3_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.87
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_3_fortress_2
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_3_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_3_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.88
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_3_fortress_3
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_3_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_3_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.89
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_3_fortress_4
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_3_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_3_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.90
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_4_fortress_1
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_4_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_4_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.91
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_4_fortress_2
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_4_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_4_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.92
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_4_fortress_3
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_4_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_4_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.93
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			has_ship_flag = bwm_anchor_4_fortress_4
		}
	}
	
	immediate = {
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					AND = {
						is_ship_size = bwm_conduit_converter
						has_ship_flag = bwm_anchor_4_crucible
					}
				}
			}
			every_owned_ship = {
				limit = {
					is_ship_size = bwm_conduit_converter
					has_ship_flag = bwm_anchor_4_crucible
				}
				if = {
					limit = {
						has_modifier = bwm_conduit_crucible_buff
					}
					remove_modifier = "bwm_conduit_crucible_buff"
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.94
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_pillar
			has_ship_flag = bwm_conduit_pillar_1_station
		}
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system
			}
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden
				}
				if = {
					limit = {
						has_modifier = bwm_obelisk_1_mod 
					}
					remove_modifier = bwm_obelisk_1_mod
				}
			}
		}
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					has_modifier = bwm_conduit_pillar_buff
				}
			}
			every_owned_ship = {
				limit = {
					has_modifier = bwm_conduit_pillar_buff
				}
				remove_modifier = "bwm_conduit_pillar_buff"
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.95
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_pillar
			has_ship_flag = bwm_conduit_pillar_2_station
		}
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system
			}
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden
				}
				if = {
					limit = {
						has_modifier = bwm_obelisk_2_mod 
					}
					remove_modifier = bwm_obelisk_2_mod
				}
			}
		}
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					has_modifier = bwm_conduit_pillar_buff
				}
			}
			every_owned_ship = {
				limit = {
					has_modifier = bwm_conduit_pillar_buff
				}
				remove_modifier = "bwm_conduit_pillar_buff"
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.96
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_pillar
			has_ship_flag = bwm_conduit_pillar_3_station
		}
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system
			}
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden
				}
				if = {
					limit = {
						has_modifier = bwm_obelisk_3_mod 
					}
					remove_modifier = bwm_obelisk_3_mod
				}
			}
		}
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					has_modifier = bwm_conduit_pillar_buff
				}
			}
			every_owned_ship = {
				limit = {
					has_modifier = bwm_conduit_pillar_buff
				}
				remove_modifier = "bwm_conduit_pillar_buff"
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.97
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_pillar
			has_ship_flag = bwm_conduit_pillar_4_station
		}
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system
			}
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden
				}
				if = {
					limit = {
						has_modifier = bwm_obelisk_4_mod 
					}
					remove_modifier = bwm_obelisk_4_mod
				}
			}
		}
		if = {
			limit = {
				any_owned_ship = {
					exists = this
					has_modifier = bwm_conduit_pillar_buff
				}
			}
			every_owned_ship = {
				limit = {
					has_modifier = bwm_conduit_pillar_buff
				}
				remove_modifier = "bwm_conduit_pillar_buff"
			}
		}
	}
}

#Conduit Crisis Core Spawn
ship_event = {
	id = bwm_the_conduit.98
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		owner = {
			is_country_type = bwm_conduit_guardian
			has_country_flag = bwm_conduit_country
		}
		is_ship_size = bwm_conduit_fortress 
	}
	
	immediate = {
		save_event_target_as = bwm_conduit_core_spawn_loc
		bwm_effect_explosion_4 = yes
		create_fleet = {
			name = "Eternal Guardian"
			settings = {
				spawn_debris = no 
				is_boss = yes
			}
			effect = {
				set_owner = event_target:bwm_conduit_country
				create_ship = {
					name = "Conduit"
					design = "Thoth"
					graphical_culture = "fallen_empire_03"
					prefix = no
					
					effect = {
						set_disable_at_health = 0.05
						set_ship_flag = bwm_conduit_core_sacrifice
						save_event_target_as = bwm_conduit_core_sacrifice
					}
				}
				log = "Thoth Spawn"
				set_location = event_target:bwm_conduit_core_spawn_loc
				save_global_event_target_as = bwm_conduit_core_boss
			}
		}
		event_target:bwm_conduit_country = {
			if = {
				limit = {
					any_owned_planet = {
						exists = this
						has_planet_flag = bwm_conduit_garden
						any_owned_pop = {
							exists = this
						}
					}
				}
				random_owned_planet = {
					limit = {
						has_planet_flag = bwm_conduit_garden
					}
					# TODO
					#every_tile = {
					#	if = {
					#		limit = {
					#			has_building = yes
					#			is_ruined = no
					#			NOR = {
					#				has_building = "building_agri_processing_complex"
					#				has_building = "building_dark_matter_power_plant"
					#				has_building = "building_ancient_factory"
					#				has_building = "bwm_building_obelisk_0_1"
					#				has_building = "bwm_building_obelisk_0_2"
					#				has_building = "bwm_building_obelisk_0_3"
					#				has_building = "bwm_building_obelisk_0_4"
					#				has_building = "bwm_building_obelisk_1"
					#				has_building = "bwm_building_obelisk_2"
					#				has_building = "bwm_building_obelisk_3"
					#				has_building = "bwm_building_obelisk_4"
					#			}
					#		}
					#		set_ruined = yes
					#	}
					#}
					while = {
						limit = {
							num_pops > 1
						}
						random_owned_pop = {
							kill_pop = yes
							event_target:bwm_conduit_core_sacrifice = {
								add_modifier = {
									modifier = "bwm_conduit_sacrifice_power"
									days = -1
								}
							}
						}	
					}
				}
			}
		}
		fleet = {
			delete_fleet = this
		}
		FROM = {
			owner = {
				country_event = { id = bwm_the_conduit.99  }
			}
		}
	}
}

#Conduit Final Boss Notify
country_event = {
	id = bwm_the_conduit.99
	title = "bwm_the_conduit.99"
	desc = "bwm_the_conduit.99.desc"
	picture = GFX_evt_exploding_ship
	show_sound = event_red_alert
	location = event_target:bwm_conduit_core_spawn_loc
	
	is_triggered_only = yes

	option = {
		name = "bwm_the_conduit.99.a"
	}
}

#Conduit Crisis Clear (Hidden)
ship_event = {
	id = bwm_the_conduit.100
	hide_window = yes
	
	#fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		owner = {
			is_country_type = bwm_conduit_guardian
			has_country_flag = bwm_conduit_country
		}
		OR = {
			is_ship_size = bwm_conduit_avatar_alt
			has_ship_flag = bwm_conduit_core_sacrifice
		}
		has_global_flag = bwm_conduit_crisis_toggle
	}
	
	immediate = {
		log = "bwm_the_conduit.100"
		if = {
			limit = {
				has_global_flag = bwm_conduit_crisis_toggle
			}
			remove_global_flag = bwm_conduit_crisis_toggle
		}
		bwm_effect_explosion_4 = yes
		create_ambient_object = {
			type = "bwm_conduit_eye_alt_object"
			location = this
		}
		last_created_ambient_object = {
			set_ambient_object_flag = bwm_conduit_guardian_object
		}
		create_ambient_object = {
			type = "large_debris_object"
			location = this
		}
		last_created_ambient_object = {
			set_ambient_object_flag = bwm_conduit_guardian_debris
		}
		fleet = {
			delete_fleet = this
		}
		owner = {
			every_owned_ship = {
				limit = {
					exists = THIS
					OR = {
						is_ship_size = bwm_conduit_pillar
						is_ship_size = bwm_conduit_anchor
						is_ship_size = bwm_conduit_converter
					}
				}
				fleet = {
					destroy_fleet = THIS
				}
			}
			every_owned_fleet = {
				limit = {
					exists = THIS
				}
				clear_orders = yes 
				queue_actions = {
					repeat = {
						find_random_system = {
							trigger = {
								id = bwm_conduit_scatter.1
								NOR = {
									has_star_flag = enclave
									has_star_flag = guardian
									has_star_flag = bwm_ring_system
									has_star_flag = bwm_grave_system
									has_star_flag = bwm_garden_system
									has_star_flag = bwm_prison_system
									has_star_flag = bwm_gate_system
									has_star_flag = bwm_cipher_1_system
									has_star_flag = bwm_cipher_2_system
									has_star_flag = bwm_cipher_3_system
								}
							}
							found_system = {
								move_to = this
								
								find_closest_planet = {
									trigger = {
										id =  bwm_conduit_scatter.2
										is_star = yes
									}
									found_planet = {
										move_to = this
										wait = {
											duration = 360
											random = 180
										}
									}
								}
							}
						}
					}
				}
			}
		}
		FROM = {
			owner = {
				save_event_target_as = bwm_conduit_slayer_target
				set_country_flag = bwm_conduit_slayer
				add_threat = {
					who = THIS
					amount = 10
				}
			}
		}
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system 
			}
			every_fleet_in_system = {
				limit = {
					owner = {
						is_country_type = bwm_conduit_guardian
						has_country_flag = bwm_conduit_country
					}
				}
				destroy_fleet = this
			}
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden
				}
				if = {
					limit = {
						has_modifier = bwm_obelisk_5_mod
					}
					remove_modifier = bwm_obelisk_5_mod
				}
				if = {
					limit = {
						NOT = {
							has_modifier = bwm_obelisk_6_mod
						}
					}
					add_modifier = {
						modifier = "bwm_obelisk_6_mod"
						days = 1800
					}
				}
				if = {
					limit = {
						NOT = {
							has_modifier = bwm_obelisk_8_mod
						}
					}
					add_modifier = {
						modifier = "bwm_obelisk_8_mod"
						days = -1
					}
				}
				every_owned_pop = {
					if = {
						limit = {
							NOT = {
								has_modifier = bwm_pop_conduit_5
							}
						}
						add_modifier = {
							modifier = "bwm_pop_conduit_5"
							days = -1
						}
					}
				}
				set_owner = event_target:bwm_conduit_slayer_target
				save_event_target_as = bwm_garden_aid
			}
			save_event_target_as = bwm_conduit_system
			#set_owner = event_target:bwm_conduit_slayer_target
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_conduit_chain" 
				}
				end_event_chain = "bwm_lex_conduit_chain"
			}
			if = {
				limit = { 
					has_modifier = bwm_conduit_weakness
				}
				remove_modifier = "bwm_conduit_weakness"
			}
			if = {
				limit = {
					has_special_project = bwm_CONDUIT_WEAKNESS_PROJECT
				}
				abort_special_project = {
					type = "bwm_CONDUIT_WEAKNESS_PROJECT"
					location = capital_scope
				}
			}
			if = {
				limit = {
					has_country_flag = bwm_conduit_slayer
					any_system = {
						AND = {
							has_star_flag = bwm_garden_system
							any_system_planet = {
								has_planet_flag = bwm_conduit_garden
							}
						}
					}
				}
				if = {
					limit = {
						is_ai = no
					}
					country_event = { id = bwm_the_conduit.101 }
				}
				else = {
					if = {
						limit = {
							is_ai = yes
							OR = {
								is_country_type = default
								is_country_type = fallen_empire
								is_country_type = awakened_fallen_empire
							}
						}
						set_country_flag = bwm_the_conduit_ai_path
						country_event = { id = bwm_the_conduit.102  }
					}
				}
			}
		}
		bwm_awaken = yes
	}
}

#Conduit Crisis Clear Destoryed (Hidden)
country_event = {
	id = bwm_the_conduit.120
	#hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes

	trigger = {
		From = {
			is_country_type = bwm_conduit_guardian
			has_country_flag = bwm_conduit_country
		}
		FromFromFrom={
			is_ship_size = bwm_conduit_avatar_alt
		}
	}
	
	immediate = {
		FromFromFrom={
			ship_event = { id = bwm_the_conduit.100 }
		}
	}
}

#Conduit Crisis Clear
country_event = {
	id = bwm_the_conduit.101
	title = "bwm_the_conduit.101"
	desc = "bwm_the_conduit.101.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_space_battle
	location = event_target:bwm_conduit_system 
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = no
		NOT = {
			has_country_flag = bwm_conduit_aid_notify
		}
	}

	immediate = {
		set_country_flag = bwm_conduit_aid_notify
	}
	
	option = {
		name = "bwm_the_conduit.101.a"
		event_target:bwm_garden_aid = {
			enable_special_project = {
				name = "bwm_GARDEN_HELP"
				location = THIS
				owner = ROOT
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.102
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		has_country_flag = bwm_the_conduit_ai_path
		NOT = {
			has_country_flag = bwm_garden_aid_complete 
		}
	}

	immediate = {
		set_country_flag = bwm_garden_aid_complete
		every_owned_pop = {
			if = {
					limit = { has_modifier = bwm_pop_conduit_1 }
					remove_modifier = bwm_pop_conduit_1
			}	
			if = {
					limit = { has_modifier = bwm_pop_conduit_2 }
					remove_modifier = bwm_pop_conduit_2
			}
			if = {
					limit = { has_modifier = bwm_pop_conduit_3 }
					remove_modifier = bwm_pop_conduit_3
			}
			if = {
					limit = { has_modifier = bwm_pop_conduit_4 }
					remove_modifier = bwm_pop_conduit_4
			}
			if = {
					limit = { has_modifier = bwm_pop_conduit_5 }
					remove_modifier = bwm_pop_conduit_5
			}
		}
		country_event = { id = bwm_the_conduit.103 days = 1800 }
	}
}

country_event = {
	id = bwm_the_conduit.103
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		has_country_flag = bwm_the_conduit_ai_path
		has_country_flag = bwm_garden_aid_complete
		NOT = {
			has_country_flag = bwm_the_conduit_ai_lock_1
			has_technology = "tech_bwm_lex_garden"
		}
	}

	immediate = {
		set_country_flag = bwm_the_conduit_ai_lock_1
		add_research_option = tech_bwm_lex_garden
		add_tech_progress = {
			tech = tech_bwm_lex_garden
			progress = 0.1
		}
		country_event = { id = bwm_the_conduit.104 days = 1800 }
	}
}

country_event = {
	id = bwm_the_conduit.104
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		NOT = {
			has_country_flag = bwm_the_conduit_ai_lock_2
		}
		has_country_flag = bwm_the_conduit_ai_path
		has_country_flag = bwm_garden_aid_complete
	}

	immediate = {
		set_country_flag = bwm_the_conduit_ai_lock_2
		this = {
			save_event_target_as = bwm_conduit_project_ai_owner
		}
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system
			}
			random_system_planet = {
				limit = {
					is_planet_class = pc_molten
				}
				save_event_target_as = bwm_garden_molten
			}
		}
		create_fleet = {
			name = "Bound Avatar"
			settings = {
				spawn_debris = no
				is_boss = yes
			}
			effect = {
				set_owner = event_target:bwm_conduit_project_ai_owner
				create_ship = {
					name = "Conduit"
					design = "Seqtet"
					graphical_culture = "fallen_empire_03"
					prefix = no
				}
				set_location = event_target:bwm_garden_molten
			}
		}
		every_country = {
			limit = {
				has_communications = event_target:bwm_conduit_project_ai_owner 
				NOT = {
					is_country = event_target:bwm_conduit_project_ai_owner 
				}
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire		
				}	
			}
			add_opinion_modifier = { who = event_target:bwm_conduit_project_ai_owner modifier = bwm_conduit_leviathan_owner }
		}
		every_country = {
			limit = {
				is_ai = no
			}
			country_event = { id = bwm_the_conduit.108 days = 30 }
		}
		country_event = { id = bwm_the_conduit.105 days = 3600 }
	}
}

country_event = {
	id = bwm_the_conduit.105
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		has_country_flag = bwm_the_conduit_ai_path
		NOT = {
			has_country_flag = bwm_the_conduit_ai_lock_3
		}
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar_bound
		}
	}
	
	immediate = {
		set_country_flag = bwm_the_conduit_ai_lock_3
		this = {
			save_event_target_as = bwm_conduit_avatar_ai_owner
		}
		random_owned_ship = {
			limit = {
				is_ship_size = bwm_conduit_avatar_bound
			}
			save_event_target_as = bwm_conduit_avatar_ai_spawn
			create_fleet = {
			name = "Unbound Avatar"
			settings = {
				spawn_debris = no
				is_boss = yes
			}
			effect = {
				set_owner = event_target:bwm_conduit_avatar_ai_owner
				create_ship = {
					name = "Conduit"
					design = "Matet"
					graphical_culture = "fallen_empire_03"
					prefix = no
				}
				set_location = {
					target = event_target:bwm_conduit_avatar_ai_spawn
					distance = 0
					angle = random
					}	
				}
			}
			last_created_fleet = {
				bwm_effect_explosion_4 = yes
			}
			fleet = {
				delete_fleet = this
			}
		}
		country_event = { id = bwm_the_conduit.106 days = 3600 }
	}
}

country_event = {
	id = bwm_the_conduit.106
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		has_country_flag = bwm_the_conduit_ai_path
		NOT = {
			has_country_flag = bwm_conduit_overdrive_unlock
		}
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_overdrive_unlock 
		country_event = { id = bwm_the_conduit.107 days = 3600 }
	}
}

country_event = {
	id = bwm_the_conduit.107
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		NOT = {
			has_technology = "tech_bwm_magma_diver"
			has_country_flag = bwm_ai_tech_toggle_3
		}
		has_country_flag = bwm_the_conduit_ai_path
		has_country_flag = bwm_conduit_overdrive_unlock
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar
		}
	}
	
	immediate = {
		set_country_flag = bwm_ai_tech_toggle_3
		add_research_option = tech_bwm_magma_diver
		add_tech_progress = {
			tech = tech_bwm_magma_diver
			progress = 0.1
		}
	}
}

country_event = {
	id = bwm_the_conduit.108
	title = "bwm_the_conduit.108"
	desc = "bwm_the_conduit.108.desc"
	picture = GFX_evt_small_space_battle
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_conduit_ai_capture_notify
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_ai_capture_notify
	}
	
	option = {
		name = "CURSES"
	}
}

#Garden Aid Completion
ship_event = {
	id = bwm_the_conduit.110
	title = "bwm_the_conduit.110"
	desc = "bwm_the_conduit.110.desc"
	picture = GFX_evt_colony_settlement
	location = event_target:bwm_conduit_system

	is_triggered_only = yes

	trigger = {
		owner = {
			is_ai = no
			NOT = {
				has_country_flag = bwm_garden_aid_complete 
			}
		}
	}

	immediate = {
		owner = {
			every_owned_planet = {
				if = {
					limit = {
						has_modifier = bwm_obelisk_8_mod
					}
					remove_modifier = bwm_obelisk_8_mod
				}
			}
			every_owned_pop = {
				if = {
						limit = { has_modifier = bwm_pop_conduit_1 }
						remove_modifier = bwm_pop_conduit_1
				}	
				if = {
						limit = { has_modifier = bwm_pop_conduit_2 }
						remove_modifier = bwm_pop_conduit_2
				}
				if = {
						limit = { has_modifier = bwm_pop_conduit_3 }
						remove_modifier = bwm_pop_conduit_3
				}
				if = {
						limit = { has_modifier = bwm_pop_conduit_4 }
						remove_modifier = bwm_pop_conduit_4
				}
				if = {
						limit = { has_modifier = bwm_pop_conduit_5 }
						remove_modifier = bwm_pop_conduit_5
				}
			}
			set_country_flag = bwm_garden_aid_complete
		}
		random_system = {
			limit =  {
				has_star_flag = bwm_garden_system 
			}
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden 
				}
				save_event_target_as = bwm_garden_clear
			}
		}
		event_target:bwm_conduit_country = {
			every_owned_starbase = {
				delete_ship = this
			}
			destroy_country = yes
		}
	}
	option = {
		name = bwm_the_conduit.110.a
	}
}

country_event = {
	id = bwm_the_conduit.111
	title = "bwm_the_conduit.111"
	desc = "bwm_the_conduit.111.desc"
	picture = GFX_evt_space_debris
	location = event_target:bwm_conduit_system
	
	fire_only_once = yes
	
	trigger = {
		is_ai = no
		NOT = {
			has_country_flag = bwm_conduit_guardian_research
			any_owned_planet = {
				has_modifier = bwm_obelisk_6_mod
			}
		}
		any_country = {
			has_country_flag = bwm_garden_aid_complete
			has_country_flag = bwm_conduit_slayer
		}
		any_owned_planet = {
			has_planet_flag = bwm_conduit_garden
		}
	}
	
	mean_time_to_happen = {
		years = 1
	}
	
	immediate = {
		set_country_flag = bwm_conduit_guardian_research
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system
			}
			save_event_target_as = bwm_conduit_system	
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden 
				}
				save_event_target_as = bwm_garden_planet_loc
			}
			random_system_ambient_object = {
				limit = {
					has_ambient_object_flag = bwm_conduit_guardian_object
				}
				save_event_target_as = bwm_conduit_eye_wreckage_loc	
			}
		}
	}
	
	option = {
		name = "bwm_the_conduit.111.a"
		event_target:bwm_conduit_eye_wreckage_loc = {
			enable_special_project = {
				name = "bwm_CONDUIT_GUARDIAN"
				location = THIS
				owner = ROOT
			}
		}
	}
	
	option = {
		name = "bwm_the_conduit.111.b"
		add_resource = {
			influence = 100
			minerals = 5000
			energy = 5000
		}
	}
}

country_event = {
	id = bwm_the_conduit.112
	title = "bwm_the_conduit.112"
	desc = "bwm_the_conduit.112.desc"
	picture = GFX_evt_fallen_empire
	location = event_target:bwm_conduit_system
	
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = bwm_conduit_guardian_research
		NOT = {
			has_country_flag = bwm_conduit_legacy_unlock
		}
	}

	immediate = {
		set_country_flag = bwm_conduit_legacy_unlock
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system
			}
			save_event_target_as = bwm_conduit_system
			every_system_ambient_object = {
				limit = {
					OR = {
						has_ambient_object_flag = bwm_conduit_guardian_object
						has_ambient_object_flag = bwm_conduit_guardian_debris
					}
				}
				destroy_ambient_object = this
			}
		}
	}
	
	option = {
		name = "bwm_the_conduit.112.a"
		if = {
			limit = {
				NOT = {
					has_technology = "tech_bwm_lex_garden"
				}
			}
			add_research_option = tech_bwm_lex_garden
			add_tech_progress = {
				tech = tech_bwm_lex_garden
				progress = 0.1
			}
		}
	}
}

# bwm_the_conduit.120 is used for Conduit Boss destruction (in case you did enough damage to destory it instead of just disabling it)

#Conduit Crisis Timed Reward Init (Make bwm_LAVA_DRIVER project available)
country_event = {
	id = bwm_the_conduit.121
	title = "bwm_the_conduit.121"
	desc = "bwm_the_conduit.121.desc"
	picture = GFX_evt_molten
	location = event_target:bwm_conduit_system
	
	fire_only_once = yes
	
	trigger = {
		is_ai = no
		has_country_flag = bwm_conduit_legacy_unlock
		has_technology = "tech_bwm_lex_garden"
		any_country = {
			has_country_flag = bwm_conduit_slayer
		}
		any_owned_planet = {
			has_planet_flag = bwm_conduit_garden
		}
	}
	
	mean_time_to_happen = {
		years = 1
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system
			}
			save_event_target_as = bwm_conduit_system	
			random_system_planet = {
				limit = {
					is_planet_class = pc_molten
				}
				save_event_target_as = bwm_garden_molten
			}
		}
	}
	
	option = {
		name = "bwm_the_conduit.121.a"
		event_target:bwm_garden_molten = {
			enable_special_project = {
				name = "bwm_LAVA_DIVER"
				location = THIS
				owner = ROOT
			}
		}
	}
	
	option = {
		name = "bwm_the_conduit.121.b"
		add_resource = { influence = 100 }
	}
}

#Conduit Crisis Timed Reward (bwm_LAVA_DRIVER complete)
ship_event = {
	id = bwm_the_conduit.122
	title = "bwm_the_conduit.122"
	desc = "bwm_the_conduit.122.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_mystic_reveal_light
	location = event_target:bwm_conduit_system
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			owner = {
				has_country_flag = bwm_conduit_leviathan_unlock
			}
		}
	}
	
	immediate = {
		owner = {
			save_event_target_as = bwm_conduit_project_owner 
			set_country_flag = bwm_conduit_leviathan_unlock
		}
		
	}
	
	option = { 
		name = "bwm_the_conduit.122.a"
		hidden_effect = {
			owner = {
				add_threat = {
					who = THIS
					amount = 5
				}
			}
		}
		every_country = {
			limit = {
				has_communications = event_target:bwm_conduit_project_owner 
				NOT = {
					is_country = event_target:bwm_conduit_project_owner 
				}
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire		
				}	
			}
			add_opinion_modifier = { who = event_target:bwm_conduit_project_owner modifier = bwm_conduit_leviathan_owner }
		}
		create_fleet = {
			name = "Bound Avatar"
			settings = {
				spawn_debris = no
				is_boss = yes
			}
			effect = {
				set_owner = event_target:bwm_conduit_project_owner
				create_ship = {
					name = "Conduit"
					design = "Seqtet"
					graphical_culture = "fallen_empire_03"
					prefix = no
				}
				set_location = root
			}
		}
	}
	
	option = {
		name = "bwm_the_conduit.122.b"
		owner = {
			add_resource = {
				minerals = 5000
				energy = 5000
			}
		}
	}
}

#Conduit Crisis Timed Reward Upgrade Init (Make bwm_CONDUIT_AWAKENING project available)
country_event = {
	id = bwm_the_conduit.130
	title = "bwm_the_conduit.130"
	desc = "bwm_the_conduit.130.desc"
	picture = GFX_evt_unspeakable_horror

	trigger = {
		is_ai = no
		NOT = {
			has_country_flag = bwm_conduit_upgrade_lock
		}
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar_bound
		}
	}
	
	mean_time_to_happen = {
		years = 10

		modifier = {
			factor = 0.5
			any_owned_ship = {
				OR = {
					is_ship_size = bwm_titan
					is_ship_size = bwm_grave_awakened_pc
				}
			}
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_upgrade_lock
		capital_scope = { save_event_target_as = bwm_pc_home }
	}

	option = {
		name = "bwm_the_conduit.130.a"
		event_target:bwm_pc_home = {
			enable_special_project = {
				name = "bwm_CONDUIT_AWAKENING"
				location = THIS
				owner = ROOT
			}
		}
	}
	option = {
		name = "bwm_the_conduit.130.b"
		add_resource = { influence = 100 }
	}
}

#Conduit Crisis Timed Reward Upgrade Activation (bwm_CONDUIT_AWAKENING project complete)
country_event = {
	id = bwm_the_conduit.131
	title = "bwm_the_conduit.131"
	desc = "bwm_the_conduit.131.desc"
	picture = GFX_evt_ship_in_orbit
	
	is_triggered_only = yes
	
	trigger = {
			is_ai = no
			NOT = {
				has_country_flag = bwm_conduit_avatar_awakening 
			}
			any_owned_ship = {
			is_ship_size = bwm_conduit_avatar_bound
			}
		}

	option = {
		name = "bwm_the_conduit.131.a"
		custom_tooltip = bwm_the_conduit.131.a.tooltip
		hidden_effect = {
			set_country_flag = bwm_conduit_avatar_awakening
		}
	}	
}

#Conduit Crisis Timed Reward Upgrade Transform
country_event = {
	id = bwm_the_conduit.132

	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		is_ai = no
		NOT = {
			has_country_flag = bwm_conduit_evolve_success 
		}
		has_country_flag = bwm_conduit_avatar_awakening
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar_bound
		}
	}
	
	immediate = {
		add_threat = {
			who = THIS
			amount = 5
		}
		FROMFROM = {
			save_event_target_as = bwm_conduit_avatar_spawn
		}
		if = {
			limit = {
				FROMFROM = {
					OWNER = {
						count_owned_ship = {
							limit = {
								is_ship_size = bwm_conduit_avatar_bound
								FLEET = { is_same_value = event_target:bwm_conduit_avatar_spawn }
							}
							count > 0
						}
					}
				}
			}
			log = "Test"
			FROMFROM = {
				if = {
					limit = { exists = leader }
					leader = { unassign_leader = this }
				}
				random_owned_ship = {
					limit = { is_ship_size = bwm_conduit_avatar_bound }
					delete_ship = this
				}
				create_ship = {
					name = "Conduit"
					design = "Matet"
					graphical_culture = "fallen_empire_03"
					prefix = no
				}
			}
			last_created_ship = {
				bwm_effect_explosion_4 = yes
			}
			set_country_flag = bwm_conduit_evolve_success
		}
	}
}

country_event = {
	id = bwm_the_conduit.133
	title = "bwm_the_conduit.133"
	desc = "bwm_the_conduit.133.desc"
	picture = GFX_evt_galactic_senate

	trigger = {
		NOT = {
			has_country_flag = bwm_conduit_schematic_research
		}
		is_ai = no
		has_country_flag = bwm_conduit_evolve_success
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar
		}
	}
	
	mean_time_to_happen = {
		years = 10
		
		modifier = {
			factor = 0.5
				OR = {
					has_technology = "tech_bwm_solar_envoy"
					has_technology = "tech_bwm_gravekeeper"
				}
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_schematic_research
		capital_scope = {
			save_event_target_as = bwm_pc_home
		}
	}

	option = {
		name = "bwm_the_conduit.133.a"
		custom_tooltip = bwm_the_conduit.133.a.tooltip
		hidden_effect = {
			every_owned_ship = {
				limit = {
					exists = this
					is_ship_size = bwm_conduit_avatar
					NOT = {
						has_modifier = bwm_leviathan_research_debuff
					}
				}
				add_modifier = {
					modifier = "bwm_leviathan_research_debuff"
					days = -1
				}
			}
		}
		event_target:bwm_pc_home = {
			enable_special_project = {
				name = "bwm_CONDUIT_SCHEMATICS_PROJECT"
				location = THIS
				owner = ROOT
			}
		}
	}
	option = {
		name = "bwm_the_conduit.133.b"
		add_resource = { influence = 100 }
		hidden_effect = {
			set_country_flag = bwm_conduit_schematic_tech_lock
		}
	}
}

country_event = {
	id = bwm_the_conduit.134
	title = "bwm_the_conduit.134"
	desc = "bwm_the_conduit.134.desc"
	picture = GFX_evt_sapient_AI
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_conduit_schematic_tech_lock
		}
		is_ai = no
		has_country_flag = bwm_conduit_schematic_research
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_schematic_tech_lock
	}

	option = {
		name = MARVELOUS
		hidden_effect = {
			every_owned_ship = {
				limit = {
					exists = this
						is_ship_size = bwm_conduit_avatar
					has_modifier = bwm_leviathan_research_debuff
				}
				remove_modifier = "bwm_leviathan_research_debuff"
			}
		}
		if = {
			limit = {
				NOT = {
					has_technology = "tech_bwm_magma_diver"
				}
			}
			add_research_option = tech_bwm_magma_diver
			add_tech_progress = {
				tech = tech_bwm_magma_diver
				progress = 0.1
			}
		}
	}
}

#Broken Pillars
country_event = {
	id = bwm_the_conduit.140
	title = "bwm_the_conduit.140"
	desc = "bwm_the_conduit.140.desc"
	picture = GFX_evt_alien_ruins
	location = event_target:bwm_conduit_system
	
	fire_only_once = yes
	
	trigger = {
		is_ai = no
		AND = {
			has_country_flag = bwm_conduit_slayer
			has_country_flag = bwm_garden_aid_complete
		}
		any_owned_planet = {
			has_planet_flag = bwm_conduit_garden
			NOR = {
				#has_building = "bwm_building_obelisk_0_1"
				#has_building = "bwm_building_obelisk_0_2"
				#has_building = "bwm_building_obelisk_0_3"
				#has_building = "bwm_building_obelisk_0_4"
				#has_building = "bwm_building_obelisk_1"
				#has_building = "bwm_building_obelisk_2"
				#has_building = "bwm_building_obelisk_3"
				#has_building = "bwm_building_obelisk_4"
				has_deposit = bwm_building_obelisk_dep0
				has_deposit = bwm_building_obelisk_dep1
			}
		}
	}

	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system 
			}
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden 
				}
				if = {
					limit = { has_modifier = bwm_obelisk_6_mod }
					remove_modifier = bwm_obelisk_6_mod
				}
				if = {
					limit = { 
						NOT = {
							has_modifier = bwm_obelisk_7_mod 
						}
					}
					add_modifier = {
						modifier = "bwm_obelisk_7_mod"
						days = -1
					}
				}
			}
		}
		set_country_flag = bwm_conduit_obelisks_destroyed
	}
	
	option = {
		name = bwm_the_conduit.140.a
	}
}

country_event = {
	id = bwm_the_conduit.200
	title = "bwm_the_conduit.200"
	desc = "bwm_the_conduit.200.desc"
	picture = GFX_evt_unspeakable_horror

	trigger = {
		is_ai = no
		NOT = {
			has_country_flag = bwm_conduit_limit_break_lock
		}
		has_country_flag = bwm_conduit_evolve_success
		has_country_flag = bwm_conduit_schematic_tech_lock
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar
		}
	}
	
	mean_time_to_happen = {
		years = 10

		modifier = {
			factor = 0.5
				OR = {
					OR ={
						has_country_flag = bwm_titan_overdrive_unlock 
						has_country_flag = bwm_grave_overdrive_unlock
					}
					OR = {
						has_global_flag = prethoryn_invasion_happened
						has_global_flag = extradimensional_invasion_happened
						has_global_flag = war_in_heaven_started
						has_global_flag = bwm_ancestor_crisis_start
					}
				}
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_limit_break_lock
		capital_scope = { save_event_target_as = bwm_pc_home }
	}

	option = {
		name = "bwm_the_conduit.200.a"
		event_target:bwm_pc_home = {
			enable_special_project = {
				name = "bwm_CONDUIT_LIMIT_BREAK"
				location = THIS
				owner = ROOT
			}
		}
	}
	option = {
		name = "bwm_the_conduit.200.b"
		add_resource = { influence = 100 }
	}
}

country_event = {
	id = bwm_the_conduit.201
	title = "bwm_the_conduit.201"
	desc = "bwm_the_conduit.201.desc"
	picture = GFX_evt_ship_in_orbit
	
	is_triggered_only = yes
	
	trigger = {
			is_ai = no
			has_country_flag = bwm_conduit_evolve_success
			has_country_flag = bwm_conduit_schematic_tech_lock
			NOT = {
				has_country_flag = bwm_conduit_overdrive_unlock 
			}
			any_owned_ship = {
				is_ship_size = bwm_conduit_avatar
			}
		}

	option = {
		name = "bwm_the_conduit.201.a"
		custom_tooltip = bwm_the_conduit.201.a.tooltip
		hidden_effect = {
			set_country_flag = bwm_conduit_overdrive_unlock 
		}
	}	
}

fleet_event = {
	id = bwm_the_conduit.202
	hide_window = yes

	trigger = {	
		any_combatant_fleet = {
			exists = owner
			owner = {
				has_country_flag = bwm_conduit_overdrive_unlock 
				NOT = {
					has_country_flag = bwm_conduit_overdrive_cd_flag
				}
			}
			any_owned_ship = {
				is_ship_size = bwm_conduit_avatar
				has_hp_percentage < 0.1
				has_hp_percentage > 0
			}
		}
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_ai = no
					has_country_flag = bwm_conduit_overdrive_unlock 
					NOT = {
						has_country_flag = bwm_conduit_overdrive_cd_flag
					}
				}
				any_owned_ship = {
					is_ship_size = bwm_conduit_avatar
				}
			}
			this = {
				save_event_target_as = bwm_overdrive_fleet_loc
			}
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = bwm_conduit_avatar
					}
					repair_ship = yes
					bwm_overdrive = yes
					ship_event = { id = bwm_the_conduit.203 days = 30   }
				}
				country_event = { id = bwm_the_conduit.204 }
				set_timed_country_flag = {
					flag = bwm_conduit_overdrive_cd_flag
					days = 90
				}
			}
		}
	}
}

ship_event = {
	id = bwm_the_conduit.203
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		this = {
			save_event_target_as = bwm_overdrive_cd_loc
		}
		owner = {
			country_event = { id = bwm_the_conduit.205 }
		}
		bwm_overdrive_cd = yes
	}
}

country_event = {
	id = bwm_the_conduit.204
	title = "bwm_the_conduit.204"
	desc = "bwm_the_conduit.204.desc"
	picture = GFX_evt_small_space_battle
	location = event_target:bwm_overdrive_fleet_loc
	
	is_triggered_only = yes

	option = {
		name = "bwm_the_conduit.204.a"
	}
}

country_event = {
	id = bwm_the_conduit.205
	title = "bwm_the_conduit.205"
	desc = "bwm_the_conduit.205.desc"
	picture = GFX_evt_sapient_AI
	location = event_target:bwm_overdrive_cd_loc
	
	is_triggered_only = yes

	option = {
		name = "bwm_the_conduit.205.a"
	}
}

country_event = {
	id = bwm_the_conduit.800
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		any_owned_megastructure = {
			is_megastructure_type = bwm_conduit_converter_08
		}
	}
	
	immediate = {
		from = {
			set_fleet_flag = bwm_scrap_fleet_tag
		}
		every_owned_ship = {
			limit = {
				fleet = {
					has_fleet_flag = bwm_scrap_fleet_tag
				}
			}
			while = {
				limit = {
					NOT = {
						has_ship_flag = bwm_scrap_ship_tag
					}
				}
				set_ship_flag = bwm_scrap_ship_tag
				if = {
					limit = {
						is_ship_size = corvette
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_corvette_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_corvette_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_corvette_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = destroyer
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_destroyer_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_destroyer_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_destroyer_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = cruiser
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_cruiser_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_cruiser_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_cruiser_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = battleship
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_battleship_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_battleship_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_battleship_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = constructor
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_constructor_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_constructor_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_constructor_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = colonizer
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_colonizer_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_colonizer_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_colonizer_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = science
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_science_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_science_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_science_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = transport
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_transport_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_transport_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_transport_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = military_station_small
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_military_station_s_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_military_station_s_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_military_station_s_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = military_station_medium
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_military_station_m_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_military_station_m_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_military_station_m_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = military_station_large
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_military_station_l_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_military_station_l_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_military_station_l_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = starbase_outpost
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_starbase_outpost_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_starbase_outpost_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_starbase_outpost_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = mining_station
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_mining_station_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_mining_station_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_mining_station_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = research_station
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_research_station_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_research_station_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_research_station_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						is_ship_size = observation_station
					}
					root = {
						if = {
							limit = {
								check_variable = {
									which = "bwm_observation_station_counter_scrap"
									value < 1
								}
							}
							set_variable = {
								which = "bwm_observation_station_counter_scrap"
								value = 1
							}
						}
						else = {
							change_variable = {
								which = "bwm_observation_station_counter_scrap"
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						NOR = {
							is_ship_size = corvette
							is_ship_size = destroyer
							is_ship_size = cruiser
							is_ship_size = battleship
							is_ship_size = constructor
							is_ship_size = colonizer
							is_ship_size = science
							is_ship_size = transport
							is_ship_size = military_station_small
							is_ship_size = military_station_medium
							is_ship_size = military_station_large
							is_ship_size = starbase_outpost
							is_ship_size = mining_station
							is_ship_size = research_station
							is_ship_size = observation_station
						}
					}
					if = {
						limit = {
							is_ship_class = shipclass_transport
						}
						root = {
							if = {
								limit = {
									check_variable = {
										which = "bwm_transport_class_counter_scrap"
										value < 1
									}
								}
								set_variable = {
									which = "bwm_transport_class_counter_scrap"
									value = 1
								}
							}
							else = {
								change_variable = {
									which = "bwm_transport_class_counter_scrap"
									value = 1
								}
							}
						}
					}
					if = {
						limit = {
							is_ship_class = shipclass_constructor
						}
						root = {
							if = {
								limit = {
									check_variable = {
										which = "bwm_constructor_class_counter_scrap"
										value < 1
									}
								}
								set_variable = {
									which = "bwm_constructor_class_counter_scrap"
									value = 1
								}
							}
							else = {
								change_variable = {
									which = "bwm_constructor_class_counter_scrap"
									value = 1
								}
							}
						}
					}
					if = {
						limit = {
							is_ship_class = shipclass_science_ship
						}
						root = {
							if = {
								limit = {
									check_variable = {
										which = "bwm_science_class_counter_scrap"
										value < 1
									}
								}
								set_variable = {
									which = "bwm_science_class_counter_scrap"
									value = 1
								}
							}
							else = {
								change_variable = {
									which = "bwm_science_class_counter_scrap"
									value = 1
								}
							}
						}
					}
					if = {
						limit = {
							is_ship_class = shipclass_colonizer
						}
						root = {
							if = {
								limit = {
									check_variable = {
										which = "bwm_colonizer_class_counter_scrap"
										value < 1
									}
								}
								set_variable = {
									which = "bwm_colonizer_class_counter_scrap"
									value = 1
								}
							}
							else = {
								change_variable = {
									which = "bwm_colonizer_class_counter_scrap"
									value = 1
								}
							}
						}
					}
					if = {
						limit = {
							is_ship_class = shipclass_military
						}
						root = {
							if = {
								limit = {
									check_variable = {
										which = "bwm_military_ship_class_counter_scrap"
										value < 1
									}
								}
								set_variable = {
									which = "bwm_military_ship_class_counter_scrap"
									value = 1
								}
							}
							else = {
								change_variable = {
									which = "bwm_military_ship_class_counter_scrap"
									value = 1
								}
							}
						}
					}
					if = {
						limit = {
							is_ship_class = shipclass_military_station
						}
						root = {
							if = {
								limit = {
									check_variable = {
										which = "bwm_military_station_class_counter_scrap"
										value < 1
									}
								}
								set_variable = {
									which = "bwm_military_station_class_counter_scrap"
									value = 1
								}
							}
							else = {
								change_variable = {
									which = "bwm_military_station_class_counter_scrap"
									value = 1
								}
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_corvette_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_corvette_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_corvette_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 70
					energy = 14
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_destroyer_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_destroyer_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_destroyer_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 160
					energy = 32
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_cruiser_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_cruiser_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_cruiser_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 360
					energy = 72
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_battleship_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_battleship_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_battleship_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 720
					energy = 144
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_constructor_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_constructor_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_constructor_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 85
					energy = 17
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_colonizer_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_colonizer_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_colonizer_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 485
					energy = 97
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_science_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_science_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_science_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 85
					energy = 17
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_transport_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_transport_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_transport_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 35
					energy = 7
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_military_station_s_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_military_station_s_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_military_station_s_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 100
					energy = 20
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_military_station_m_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_military_station_m_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_military_station_m_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 160
					energy = 32
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_military_station_l_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_military_station_l_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_military_station_l_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 320
					energy = 64
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_starbase_outpost_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_starbase_outpost_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_starbase_outpost_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 300
					energy = 60
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_mining_station_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_mining_station_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_mining_station_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 90
					energy = 18
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_research_station_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_research_station_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_research_station_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 90
					energy = 18
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_observation_station_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_observation_station_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_observation_station_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 50
					energy = 10
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_transport_class_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_transport_class_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_transport_class_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 35
					energy = 7
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_constructor_class_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_constructor_class_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_constructor_class_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 85
					energy = 17
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_science_class_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_science_class_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_science_class_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 85
					energy = 17
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_colonizer_class_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_colonizer_class_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_colonizer_class_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 485
					energy = 97
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_military_ship_class_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_military_ship_class_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_military_ship_class_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 160
					energy = 32
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = "bwm_military_station_class_counter_scrap"
					value > 0
				}
			}
			while = {
				limit = {
					check_variable = {
						which = "bwm_military_station_class_counter_scrap"
						value > 0
					}
				}
				change_variable = {
					which = "bwm_military_station_class_counter_scrap"
					value = -1
				}
				add_resource = {
					minerals = 320
					energy = 64
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.801
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		any_owned_megastructure = {
			is_megastructure_type = bwm_conduit_converter_08
		}
	}
	
	immediate = {
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = corvette
				}
			}
			add_resource = {
				minerals = 14
				energy = 28
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = destroyer
				}
			}
			add_resource = {
				minerals = 32
				energy = 64
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = cruiser
				}
			}
			add_resource = {
				minerals = 72
				energy = 144
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = battleship
				}
			}
			add_resource = {
				minerals = 144
				energy = 288
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = constructor
				}
			}
			add_resource = {
				minerals = 17
				energy = 34
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = colonizer
				}
			}
			add_resource = {
				minerals = 97
				energy = 194
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = science
				}
			}
			add_resource = {
				minerals = 17
				energy = 34
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = transport
				}
			}
			add_resource = {
				minerals = 7
				energy = 14
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = military_station_small
				}
			}
			add_resource = {
				minerals = 20
				energy = 40
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = military_station_medium
				}
			}
			add_resource = {
				minerals = 32
				energy = 64
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = military_station_large
				}
			}
			add_resource = {
				minerals = 64
				energy = 128
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = starbase_outpost
				}
			}
			add_resource = {
				minerals = 60
				energy = 120
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = mining_station
				}
			}
			add_resource = {
				minerals = 18
				energy = 36
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = research_station
				}
			}
			add_resource = {
				minerals = 18
				energy = 36
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					is_ship_size = observation_station
				}
			}
			add_resource = {
				minerals = 10
				energy = 20
			}
			break = yes
		}
		if = {
			limit = {
				FROMFROM = {
					NOR = {
						is_ship_size = corvette
						is_ship_size = destroyer
						is_ship_size = cruiser
						is_ship_size = battleship
						is_ship_size = constructor
						is_ship_size = colonizer
						is_ship_size = science
						is_ship_size = transport
						is_ship_size = military_station_small
						is_ship_size = military_station_medium
						is_ship_size = military_station_large
						is_ship_size = starbase_outpost
						is_ship_size = mining_station
						is_ship_size = research_station
						is_ship_size = observation_station
					}
				}
			}
			if = {
				limit = {
					FROMFROM = {
						is_ship_class = shipclass_transport
					}
				}
				add_resource = {
					minerals = 7
					energy = 14
				}
				break = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_ship_class = shipclass_constructor
					}
				}
				add_resource = {
					minerals = 17
					energy = 34
				}
				break = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_ship_class = shipclass_science_ship
					}
				}
				add_resource = {
					minerals = 17
					energy = 34
				}
				break = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_ship_class = shipclass_colonizer
					}
				}
				add_resource = {
					minerals = 97
					energy = 194
				}
				break = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_ship_class = shipclass_military
					}
				}
				add_resource = {
					minerals = 32
					energy = 64
				}
				break = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_ship_class = shipclass_military_station
					}
				}
				add_resource = {
					minerals = 64
					energy = 128
				}
				break = yes
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.900
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_fleet_flag = bwm_conduit_shipyard_fleet
		}
	}
	
	immediate = {
		FROM = {
			solar_system = {
				random_system_planet = {
					limit = {
						is_star = yes
					}
					if = {
						limit = {
							has_planet_flag = bwm_conduit_shipyard_star
						}
						remove_planet_flag = bwm_conduit_shipyard_star
					}
					if = {
						limit = {
							has_planet_flag = has_megastructure
						}
						remove_planet_flag = has_megastructure
					}
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.901
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			AND = {
				has_ship_flag = bwm_conduit_shipyard_unit
				is_ship_size = bwm_conduit_fortress
			}
			NOT = {
				owner = {
					is_country_type = bwm_conduit_guardian
				}
			}
		}
	}
	
	immediate = {
		FROMFROM = {
			solar_system = {
				random_system_planet = {
					limit = {
						is_star = yes
					}
					if = {
						limit = {
							has_planet_flag = bwm_conduit_shipyard_star
						}
						remove_planet_flag = bwm_conduit_shipyard_star
					}
					if = {
						limit = {
							has_planet_flag = has_megastructure
						}
						remove_planet_flag = has_megastructure
					}
				}
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.1000
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			OR = {
				is_ship_size = bwm_conduit_avatar
				is_ship_size = bwm_conduit_avatar_alt
				is_ship_size = bwm_conduit_avatar_bound
			}
		}
		FROM = {
			OR = {
				is_country_type = extradimensional
				is_country_type = extradimensional_2
				is_country_type = extradimensional_3
			}
		}
	}
	
	immediate = {
		FROMFROM = {
			add_modifier = {
				modifier = "bwm_power_bonus"
				days = 360
			}
		}
	}
}
