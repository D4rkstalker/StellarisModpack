############################
#
# Expanded Magastructure Events
#
############################

namespace = megaexpanded

##################################
# Sensor Array
# Reserved 1 - 19
##################################

# Detect Crisis
# Prethoryn
# Approaching Subspace Echoes
country_event = {
	id = megaexpanded.1
	title = "crisis.11.name"
	desc = "megaexpanded.1.desc"
	picture = GFX_evt_spy_orb
	show_sound = event_spy_orb_build_complete
	
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = spy_orb_spots_crisis
	}
	
	option = {
		name = crisis.11.a
		begin_event_chain = {
			event_chain = "coming_storm_chain"
			target = ROOT
		}
	}
}

# Tracking Telemetry
country_event = {
	id = megaexpanded.2
	title = "megaexpanded.2.name"
	desc = "megaexpanded.2.desc"
	picture = GFX_evt_unidentified_monster
	show_sound = event_sensor_ping
	
	is_triggered_only = yes
	
	immediate = {
		random_rim_system = {
			limit = { has_star_flag = swarm_invasion_target_1 }
			save_event_target_as = prethoryn_invasion_system
			closest_system = {
				limit = {
					NOR = {
						has_star_flag = swarm_invasion_warning
						has_star_flag = swarm_invasion_target_1
					}
				}
				set_star_flag = swarm_invasion_warning
				save_event_target_as = swarm_invasion_warning_1
			}
			closest_system = {
				limit = {
					NOR = {
						has_star_flag = swarm_invasion_warning
						has_star_flag = swarm_invasion_target_1
					}
				}
				set_star_flag = swarm_invasion_warning
				save_event_target_as = swarm_invasion_warning_2
			}
			closest_system = {
				limit = {
					NOR = {
						has_star_flag = swarm_invasion_warning
						has_star_flag = swarm_invasion_target_1
					}
				}
				set_star_flag = swarm_invasion_warning
				save_event_target_as = swarm_invasion_warning_3
			}
			closest_system = {
				limit = {
					NOR = {
						has_star_flag = swarm_invasion_warning
						has_star_flag = swarm_invasion_target_1
					}
				}
				set_star_flag = swarm_invasion_warning
				save_event_target_as = swarm_invasion_warning_4
			}
			closest_system = {
				limit = {
					NOR = {
						has_star_flag = swarm_invasion_warning
						has_star_flag = swarm_invasion_target_1
					}
				}
				set_star_flag = swarm_invasion_warning
				save_event_target_as = swarm_invasion_warning_5
			}
		}
	}
	
	option = {
		name = megaexpanded.2.a
		create_point_of_interest = {
			id = coming_storm_poi.1
			name = "coming_storm_poi_1_poi"
			desc = "coming_storm_poi_1_poi_desc"
			event_chain = "coming_storm_chain"
			category = coming_storm
			location = event_target:prethoryn_invasion_system
		}
		hidden_effect = {
			create_point_of_interest = {
				id = coming_storm_poi.2
				event_chain = "coming_storm_chain"
				category = coming_storm
				location = event_target:swarm_invasion_warning_1
			}
			create_point_of_interest = {
				id = coming_storm_poi.3
				event_chain = "coming_storm_chain"
				category = coming_storm
				location = event_target:swarm_invasion_warning_2
			}
			create_point_of_interest = {
				id = coming_storm_poi.4
				event_chain = "coming_storm_chain"
				category = coming_storm
				location = event_target:swarm_invasion_warning_3
			}
			create_point_of_interest = {
				id = coming_storm_poi.5
				event_chain = "coming_storm_chain"
				category = coming_storm
				location = event_target:swarm_invasion_warning_4
			}
			create_point_of_interest = {
				id = coming_storm_poi.6
				event_chain = "coming_storm_chain"
				category = coming_storm
				location = event_target:swarm_invasion_warning_5
			}
		}
	}
}

# Approaching the Outer Rim 
country_event = {
	id = megaexpanded.3
	title = "crisis.13.name"
	picture = GFX_evt_physics_research
	show_sound = event_alien_nature
	
	desc = {
		text = "megaexpanded.3.desc"
		trigger = {
			NOT = { owner_species = { OR = { has_trait = trait_psionic has_trait = trait_hive_mind } } }
		}
	}
	desc = {
		text = "megaexpanded.3.b.desc"
		trigger = {
			owner_species = { has_trait = trait_psionic }
		}
	}
	desc = {
		text = "megaexpanded.3.c.desc"
		trigger = {
			owner_species = { has_trait = trait_hive_mind }
		}
	}
	
	is_triggered_only = yes
	
	option = {
		name = crisis.13.a
		add_modifier = {
			modifier = prepared_for_the_end
			days = -1
		}
	}
}

# Hole in the Void
country_event = {
	id = megaexpanded.4
	title = "crisis.234.name"
	desc = "megaexpanded.4.desc"
	picture = GFX_evt_spy_orb
	show_sound = event_spy_orb_build_complete
	
	trigger = {
		OR = { is_country_type = default is_country_type = ascended_empire is_country_type = lost_empire }
		has_crisis = no
		OR = {
			NOR = {
				owner_species = { has_trait = trait_psionic }
				owner_species = { has_trait = trait_hive_mind }
			}
			NOT = { any_owned_leader = { has_leader_flag = captured_queen } }
		}
		OR = {
			has_megastructure = spy_orb_4
			has_megastructure = spy_orb_restored
		}
		NOT = { has_country_flag = crisis.234 }
	}
	
	mean_time_to_happen = {
		years = 100
	}	
	
	option = {
		name = crisis.234.a
		set_country_flag = crisis.234
		add_monthly_resource_mult = {
			resource = physics_research
			value = 10
			min = 1000
			max = 5000
		}
	}
}

# Extradimensional Invaders
# Mark spawning system
country_event = {
	id = megaexpanded.5
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes
	
	immediate = {
		random_system = {
			limit = {
				NOR = {
					any_country = {
						OR = {
							is_country_type = fallen_empire
							is_country_type = awakened_fallen_empire
						}
						any_system_within_border = {
							is_same_value = prev
						}
					}
					is_star_class = sc_dn
				}
			}
			set_star_flag = extradimensional_origin_system
			save_event_target_as = extradimensional_system
		}
		every_country = {
			limit = {
				OR = { is_country_type = default is_country_type = ascended_empire is_country_type = lost_empire }
				OR = {
					has_megastructure = spy_orb_4
					has_megastructure = spy_orb_restored
				}
			}
			country_event = { id = megaexpanded.6 days = 5 random = 95 }
		}
	}
}

# Tear detected
country_event = {
	id = megaexpanded.6
	title = "megaexpanded.6.name"
	desc = "megaexpanded.6.desc"
	picture = GFX_evt_wormhole
	show_sound = event_ex_started
	location = event_target:extradimensional_system
	
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = spy_orb_spots_crisis
	}
	
	option = {
		name = megaexpanded.6.a
		begin_event_chain = {
			event_chain = "extradimensional_invasion_warning_chain"
			target = ROOT
		}
		create_point_of_interest = {
			id = extradimensional_invasion_warning_poi.1
			name = "extradimensional_invasion_warning_poi_1_poi"
			desc = "extradimensional_invasion_warning_poi_1_poi_desc"
			event_chain = "extradimensional_invasion_warning_chain"
			location = event_target:extradimensional_system
		}
	}
}

# Invader ships scanned
country_event = {
	id = megaexpanded.7
	title = "megaexpanded.7.name"
	desc = "megaexpanded.7.desc"
	picture = GFX_evt_wormhole
	show_sound = event_ex_started
	
	is_triggered_only = yes
	
	option = {
		name = megaexpanded.7.a
		end_event_chain = extradimensional_invasion_warning_chain
		add_modifier = {
			modifier = prepared_for_the_end
			days = -1
		}
	}
}

# The Contingency
# The Ghost Signal
country_event = {
	id = megaexpanded.8
	title = "crisis.2010.name"
	desc = {
		trigger = {
			NOT = {
				has_authority = auth_machine_intelligence	
			}
		}
		text = megaexpanded.8.desc
	}
	desc = {
		trigger = {
			has_authority = auth_machine_intelligence	
		}
		text = megaexpanded.8.desc.b
	}
	picture = GFX_evt_spy_orb
	show_sound = event_spy_orb_build_complete
	
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = spy_orb_spots_crisis
	}
	
	option = {
		name = crisis.2010.a
		begin_event_chain = {
			event_chain = "ghost_signal_chain"
			target = ROOT
		}
	}
}

# Other empires notice the ghost signal
country_event = {
	id = megaexpanded.9
	title = "crisis.2010.name"
	desc = {
		trigger = {
			NOT = {
				has_authority = auth_machine_intelligence	
			}
		}
		text = megaexpanded.9.desc
	}
	desc = {
		trigger = {
			has_authority = auth_machine_intelligence	
		}
		text = megaexpanded.9.desc.b
	}
	picture = GFX_evt_glitchy_matrix
	show_sound = event_alien_signal
	
	is_triggered_only = yes
	
	option = {
		name = INTRIGUING
	}
}

# Pinpoints a sterilization hub
country_event = {
	id = megaexpanded.10
	title = "megaexpanded.10.name"
	desc = "megaexpanded.10.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_alien_signal
	
	is_triggered_only = yes
	
	immediate = {
		random_galaxy_planet = {
			limit = { has_planet_flag = machine_world_1 }
			save_event_target_as = machine_world_1_scope
		}
	}
	
	option = {
		name = PECULIAR
		create_point_of_interest = {
			id = machine_world_1_poi.1
			name = "machine_world_1_poi_1_poi"
			desc = "machine_world_1_poi_1_poi_desc"
			event_chain = "ghost_signal_chain"
			location = event_target:machine_world_1_scope
		}
	}
}

# Scan contingency ships
country_event = {
	id = megaexpanded.11
	title = "megaexpanded.11.name"
	desc = "megaexpanded.11.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_alien_signal
	
	is_triggered_only = yes
	
	option = {
		name = megaexpanded.7.a
		add_modifier = {
			modifier = prepared_for_the_end
			days = -1
		}
	}
}

##################################
# Crisis Sphere
# Reserved 15 - 19
##################################

# Contingency prioritizes crisis sphere

country_event = {
	id = megaexpanded.15
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = ai_invasion_ongoing
		any_system_within_border = {
			OR = {
				has_megastructure = crisis_sphere_0
				has_megastructure = crisis_sphere_1
				has_megastructure = crisis_sphere_2
				has_megastructure = crisis_sphere_3
			}
		}
	}
	
	immediate = {
		country_event = { id = megaexpanded.16 days = 30 random = 1050 } # in case there is more than one crisis empire
	}
}

country_event = {
	id = megaexpanded.16
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = ai_invasion_ongoing
		any_system_within_border = {
			OR = {
				has_megastructure = crisis_sphere_0
				has_megastructure = crisis_sphere_1
				has_megastructure = crisis_sphere_2
				has_megastructure = crisis_sphere_3
			}
		}
	}
	
	immediate = {
		save_event_target_as = crisis_beacon_target_country
		random_system_within_border = {
			limit = {
				OR = {
					has_megastructure = crisis_sphere_0
					has_megastructure = crisis_sphere_1
					has_megastructure = crisis_sphere_2
					has_megastructure = crisis_sphere_3
				}
			}
			save_event_target_as = crisis_beacon_target_capital
		}
		espionage_crisis_beacon_lure = { TYPE = ai_empire }
	}
}

##################################
# Grey Tempest
# Reserved 20 - 99
##################################

# Response to the Grey Tempest
country_event = {
	id = megaexpanded.20
	hide_window = yes

	trigger = {
		has_global_flag = gray_goo_crisis_active
		NOT = { has_global_flag = graygoo_response }
		is_country_type = gray_goo
		galaxy_percentage > 0.20
	}

	mean_time_to_happen = {
		months = 12
	}

	immediate = {
		if = {
			limit = {
				any_country = {
					is_country_type = enclave
					has_country_flag = curator_enclave_country
				}
			 }	
			 random_country = {
				limit = {
					is_country_type = enclave
					has_country_flag = curator_enclave_country
				}
				save_event_target_as = the_curators 
			}
		}
		
		set_global_flag = graygoo_response
		save_event_target_as = graygoo_country
		
		random_list = {
			# Breakthrough (anti-nanite weapon)
			10 = {
				modifier = {
					factor = 0
					exists = event_target:the_curators
				}
				set_global_flag = tech_gray_goo_enabled
				if = {
					limit = {
						any_country = {
							is_country_type = default
							is_ai = no
							is_homicidal = no
							any_neighbor_country = { is_country_type = gray_goo }
						}
					}
					random_country = {
						limit = {
							is_country_type = default
							is_ai = no
							is_homicidal = no
							any_neighbor_country = { is_country_type = gray_goo }
						}
						country_event = { id = megaexpanded.21 }
					}
				}
				else_if = {
					limit = {
						any_country = {
							is_country_type = default
							is_homicidal = no
							any_neighbor_country = { is_country_type = gray_goo }
						}
					}
					random_country = {
						limit = {
							is_country_type = default
							is_homicidal = no
							any_neighbor_country = { is_country_type = gray_goo }
						}
						country_event = { id = megaexpanded.21 }
					}
				}
				else_if = {
					limit = {
						any_country = {
							is_country_type = default
							is_ai = no
							is_homicidal = no
						}
					}
					random_country = {
						limit = {
							is_country_type = default
							is_ai = no
							is_homicidal = no
						}
						country_event = { id = megaexpanded.21 }
					}
				}
				else = {
					random_country = {
						limit = {
							is_country_type = default
							is_homicidal = no
						}
						country_event = { id = megaexpanded.21 }
					}
				}
			}
			# Curators (anti-nanite weapon)
			15 = {
				modifier = {
					factor = 0
					NOT = { exists = event_target:the_curators }
				}
				set_global_flag = tech_gray_goo_enabled
				set_global_flag = gray_goo_curator_help
				every_country = {
					limit = {
						is_country_type = default
						is_homicidal = no
					}
					country_event = { id = megaexpanded.40 }
				}
			}
			# Gate Builder Remnants
			20 = {
				set_global_flag = gate_builders_remnant_returns
				random_system = {
					limit = { has_star_flag = lgate }
					closest_system = {
						limit = {
							any_system_planet = { is_planet_class = pc_ice_asteroid }
						}
						save_event_target_as = gate_builders_entrance_system
						random_system_planet = {
							limit = { is_planet_class = pc_ice_asteroid }
							solar_system = {
								spawn_megastructure = {
									type = "gateway_restored" 
									planet = PREV
									orbit_distance = 25
									orbit_angle = 60
								}
							}
							remove_planet = yes
						}
					}
				}
				random_rim_system = {
					spawn_system = {
						min_distance >= 20
						max_distance <= 50
						initializer = "gatebuilder_remnant_init_01"
					}
				}
				add_extra_hyperlane_to_spawned_system_effect = yes
				every_system = {
					limit = {
						has_star_flag = gatebuilder_remnant
					}
					isolate_system = yes
				}
				every_country = {
					limit = {
						OR = { is_country_type = default is_country_type = ascended_empire is_country_type = lost_empire }
					}
					country_event = { id = megaexpanded.25 days = 2 }
				}
				random_country = {
					limit = { is_country_type = gate_builders_remnant }
					establish_communications_no_message = root
					random_planet_within_border = {
						limit = { has_planet_flag = energy_habitat }
						set_owner = event_target:gate_builders_remnant_country
						set_controller = event_target:gate_builders_remnant_country
						set_planet_flag = advanced_habitat
						set_planet_flag = advanced_habitat_2
						set_planet_size = 8
						set_planet_entity = {
							entity = "habitat_phase_03_entity"
							graphical_culture = owner
						}
						add_building = building_hab_major_capital # 3 jobs
						add_building = building_nourishment_center
						add_building = building_class_4_singularity
						add_building = building_class_4_singularity
						add_building = building_class_4_singularity
						while = {
							count = 1
							add_district = district_hab_housing
						}
						while = {
							count = 4
							add_district = district_hab_energy # 12 jobs
						}
						while = {
							count = 1
							add_district = district_hab_cultural # 3 jobs
						}
						while = {
							count = 21
							create_pop = {
								species = owner_main_species
							}
						}
						if = {
							limit = { has_global_flag = expanded_megastructures_installed }
							while = {
								count = 3
								create_pop = {
									species = owner_main_species
								}
							}
						}
					}
					random_planet_within_border = {
						limit = { has_planet_flag = mining_habitat }
						set_owner = event_target:gate_builders_remnant_country
						set_controller = event_target:gate_builders_remnant_country
						set_planet_flag = advanced_habitat
						set_planet_flag = advanced_habitat_2
						set_planet_size = 8
						set_planet_entity = {
							entity = "habitat_phase_03_entity"
							graphical_culture = owner
						}
						add_building = building_hab_major_capital # 3 jobs
						add_building = building_dimensional_fabricator
						add_building = building_dimensional_fabricator
						add_building = building_dimensional_fabricator
						if = {
							limit = {
								owner = { is_lithoid_empire = no }
							}
							add_building = building_nourishment_center
						}
						else = {
							add_building = building_dimensional_fabricator
						}
						while = {
							count = 1
							add_district = district_hab_housing
						}
						while = {
							count = 4
							add_district = district_hab_mining # 12 jobs
						}
						while = {
							count = 1
							add_district = district_hab_cultural # 3 jobs
						}
						while = {
							count = 21
							create_pop = {
								species = owner_main_species
							}
						}
						if = {
							limit = { has_global_flag = expanded_megastructures_installed }
							while = {
								count = 3
								create_pop = {
									species = owner_main_species
								}
							}
						}
					}
					random_planet_within_border = {
						limit = { has_planet_flag = research_habitat }
						set_owner = event_target:gate_builders_remnant_country
						set_controller = event_target:gate_builders_remnant_country
						set_planet_flag = advanced_habitat
						set_planet_flag = advanced_habitat_2
						set_planet_size = 8
						set_planet_entity = {
							entity = "habitat_phase_03_entity"
							graphical_culture = owner
						}
						add_building = building_hab_major_capital # 3 jobs
						add_building = building_nourishment_center
						add_building = building_class_4_singularity
						add_building = building_class_4_singularity
						add_building = building_class_4_singularity
						while = {
							count = 1
							add_district = district_hab_housing
						}
						while = {
							count = 4
							add_district = district_hab_science # 12 jobs
						}
						while = {
							count = 1
							add_district = district_hab_cultural # 3 jobs
						}
						while = {
							count = 21
							create_pop = {
								species = owner_main_species
							}
						}
						if = {
							limit = { has_global_flag = expanded_megastructures_installed }
							while = {
								count = 3
								create_pop = {
									species = owner_main_species
								}
							}
						}
					}
				}
			}
			# Other Options
		}
	}
}

# anti-nanite weapon
country_event = {
	id = megaexpanded.21
	title = "megaexpanded.21.name"
	desc = "megaexpanded.21.desc"
	picture = GFX_evt_gray_goo_ships
	show_sound = event_radio_chatter
	
	is_triggered_only = yes
	
	immediate = {
		 random_owned_leader = {
			limit = {
				is_researching_area = physics
			}
			save_event_target_as = gray_goo_scientist
		}
	}
	
	option = {
		name = megaexpanded.21.a
		give_technology = { tech = tech_gray_goo }
		custom_tooltip = megaexpanded.21.a.tooltip
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						is_country_type = default
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
					NOT = { is_same_value = ROOT }
					is_homicidal = no
				}
				country_event = { id = megaexpanded.22 }
				give_technology = { tech = tech_gray_goo }
			}
		}
	}
	option = {
		name = megaexpanded.21.b
		trigger = {
			OR = {
				is_ai = no
				AND = {
					is_xenophile = no
					is_pacifist = no
				}
			}
		}
		allow = {
			any_country = {
				OR = {
					is_in_federation_with = ROOT
					has_defensive_pact = ROOT
				}
			}
		}
		give_technology = { tech = tech_gray_goo }
		custom_tooltip = megaexpanded.21.b.tooltip
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						is_in_federation_with = ROOT
						has_defensive_pact = ROOT
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
					NOT = { is_same_value = ROOT }
					is_homicidal = no
				}
				give_technology = { tech = tech_gray_goo }
				country_event = { id = megaexpanded.22 }
			}
			every_country = {
				limit = {
					is_country_type = default
					NOR = {
						is_in_federation_with = ROOT
						has_defensive_pact = ROOT
						is_same_value = ROOT
					}
					is_homicidal = no
				}
				country_event = { id = megaexpanded.23 }
			}
		}
	}
	option = {
		name = megaexpanded.21.c
		trigger = {
			OR = {
				is_ai = no
				is_xenophobe = yes
			}
		}
		give_technology = { tech = tech_gray_goo }
		custom_tooltip = megaexpanded.21.c.tooltip
		hidden_effect = {
			every_country = {
				limit = {
					is_country_type = default
					NOT = { is_same_value = ROOT }
					is_homicidal = no
				}
				country_event = { id = megaexpanded.23 }
			}
			every_country = {
				limit = {
					OR = {
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
				}
				give_technology = { tech = tech_gray_goo }
			}
		}
	}
}
country_event = {
	id = megaexpanded.22
	title = "megaexpanded.22.name"
	desc = "megaexpanded.22.desc"
	picture = GFX_evt_gray_goo_ships
	show_sound = event_radio_chatter
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		tooltip = {
			give_technology = { tech = tech_gray_goo }
		}
	}
}
country_event = {
	id = megaexpanded.23
	title = "megaexpanded.22.name"
	desc = {
		trigger = { is_xenophobe = no }
		text = "megaexpanded.23.desc"
	}
	desc = {
		trigger = { is_xenophobe = yes }
		text = "megaexpanded.23.desc_phobe"
	}
	picture = GFX_evt_gray_goo_ships
	show_sound = event_radio_chatter
	
	is_triggered_only = yes
	
	option = {
		name = megaexpanded.23.a
		custom_tooltip = megaexpanded.23.a.tooltip
		add_opinion_modifier = {
			modifier = opinion_withheld_tech
			who = from
		}
	}
}

# Find ancient fe fleet
country_event = {
	id = megaexpanded.24
	title = "megaexpanded.24.name"
	desc = "megaexpanded.24.desc"
	picture = GFX_evt_gray_goo_ships
	show_sound = event_radio_chatter
	
	trigger = {
		has_global_flag = tech_gray_goo_enabled
		NOT = { has_country_flag = gate_builders_remnant_donation }
		is_country_type = default
		is_homicidal = no
		NOT = {
			any_country = {
				is_country_type = enclave
				has_country_flag = curator_enclave_country
			}
		}
		any_country = {
			is_country_type = gray_goo
			galaxy_percentage > 0.10
		}
		OR = {
			check_variable = {
				which = "gray_fleet_kills"
				value > 6
			}
			any_country = {
				is_country_type = gray_goo
				galaxy_percentage > 0.40
			}
		}
	}
	
	mean_time_to_happen = {
		months = 80
	}
	
	immediate = {
		set_country_flag = gate_builders_remnant_donation
		random_system_within_border = {
			save_event_target_as = ancient_starbase_system
		}
	}
	
	option = {
		name = EXCELLENT
		custom_tooltip = megaexpanded.41.a.tooltip
		hidden_effect = {
			capital_scope = {
				create_fleet = {
					name = "NAME_Salvaged_FE_Fleet"
					effect = {
						set_owner = root
						set_fleet_flag = gate_builders_remnant_donation_fleet
						while = {
							count = 1
							create_ship = {
								name = random
								design = "NAME_Surplus_Custodian"
								graphical_culture = fallen_empire_03
								upgradable = no
							}
						}
						while = {
							count = 3
							create_ship = {
								name = random
								design = "NAME_Surplus_Warden"
								graphical_culture = fallen_empire_03
								upgradable = no
							}
						}
						set_location = {
							target = PREV
							distance = 45
							angle = random
						}
					}
					settings = {
						can_upgrade = no
						can_change_composition = no
						uses_naval_capacity = no
					}
				}
			}
		}
	}
}

# Gate-Builders
country_event = {
	id = megaexpanded.25
	title = "crisis.2401.name"
	desc = "megaexpanded.25.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_radio_chatter
	location = event_target:gate_builders_remnant_system

	is_triggered_only = yes

	option = {
		name = ONSCREEN
		hidden_effect = {
			country_event = { id = megaexpanded.26 }
			establish_communications_no_message = event_target:gate_builders_remnant_country
			event_target:gate_builders_remnant_system = {
				every_system_planet = {
 					set_surveyed = {
 						surveyed = yes
 						surveyor = root
 					}
 				}
 			}
		}
	}
}

country_event = {
	id = megaexpanded.26
	title = "TRANSMISSION"
	desc = {
		trigger = { NOT = { has_country_flag = lcluster_opener } }
		text = "megaexpanded.26.desc"
	}
	desc = {
		trigger = { has_country_flag = lcluster_opener }
		text = "megaexpanded.26.desc.angry"
	}

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:gate_builders_remnant_country
	}

	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = { has_country_flag = lcluster_opener }
			save_event_target_as = lcluster_opener_country
		}
	}
	
	option = {
		name = megaexpanded.26.a
		trigger = { NOT = { has_country_flag = lcluster_opener } }
		response_text = megaexpanded.26.a.response
		is_dialog_only = yes
	}
	
	option = {
		name = megaexpanded.26.a
		trigger = { has_country_flag = lcluster_opener }
		response_text = megaexpanded.26.a.angry.response
		is_dialog_only = yes
	}
	
	option = {
		name = megaexpanded.26.b
		trigger = { NOT = { has_country_flag = lcluster_opener } }
		response_text = megaexpanded.26.b.response
		is_dialog_only = yes
	}
	
	option = {
		name = megaexpanded.26.c
		trigger = { has_country_flag = lcluster_opener }
		response_text = megaexpanded.26.c.response
		is_dialog_only = yes
	}

	option = {
		name = crisis.2402.a
		if = {
			limit = {
				is_ai = yes
				is_homicidal = no
			}
			add_research_option = tech_gray_goo
			add_tech_progress = {
				tech = tech_gray_goo
				progress = 0.25
			}
		}
	}
	
	option = {
		name = SCUM
		exclusive_trigger = {
			has_valid_civic = civic_fanatic_purifiers
		}
	}
	
	option = {
		name = TASTY
		exclusive_trigger = {
			has_valid_civic = civic_hive_devouring_swarm
		}
	}

	option = {
		name = EXTERMINATE
		exclusive_trigger = {
			has_valid_civic = civic_machine_terminator
		}
	}
}

country_event = {
	id = megaexpanded.27
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		is_country_type = gate_builders_remnant
	}

	immediate = {
		every_country = {
			limit = { is_country_type = default }
			country_event = { id = megaexpanded.28 }
		}
		From = { save_event_target_as = killer }
		set_global_flag = gate_builders_remnant_destroyed
	}
}
# Gate-Builders Destroyed
country_event = {
	id = megaexpanded.28
	title = "megaexpanded.28.name"
	desc = "megaexpanded.28.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_ghost_town
	location = event_target:gate_builders_remnant_system

	is_triggered_only = yes

	option = {
		name = DISCONCERTING
		trigger = {
			NOT = { is_same_value = event_target:killer }
		}
	}
	option = {
		name = crisis.2405.b
		trigger = {
			is_same_value = event_target:killer
		}
	}
}

# Gate-Builder Diplomacy
country_event = {
	id = megaexpanded.29
	title = "megaexpanded.29.name"

	desc = {
		text = megaexpanded.29.desc_01
	}
	desc = {
		text = megaexpanded.29.desc_02
		trigger = {
			has_country_flag = lcluster_opener
			NOT = {
				check_variable = {
					which = "gray_fleet_kills"
					value > 9
				}
			}
		}
	}
	desc = {
		text = megaexpanded.29.desc_03
		trigger = {
			OR = {
				NOT = { has_country_flag = lcluster_opener }
				check_variable = {
					which = "gray_fleet_kills"
					value > 9
				}
			}
		}
	}
	desc = {
		text = megaexpanded.29.desc_04
		trigger = {
			has_country_flag = lcluster_opener
			NOT = {
				check_variable = {
					which = "gray_fleet_kills"
					value > 9
				}
			}
		}
	}
	desc = {
		text = megaexpanded.29.desc_05
		trigger = {
			NOT = { has_country_flag = lcluster_opener }
			check_variable = {
				which = "gray_fleet_kills"
				value > 6
			}
		}
	}
	desc = {
		text = megaexpanded.29.desc_06
		trigger = {
			has_country_flag = lcluster_opener
			check_variable = {
				which = "gray_fleet_kills"
				value > 9
			}
		}
	}
	desc = {
		text = megaexpanded.29.desc_07
	}

	diplomatic = yes

	picture_event_data = {
		portrait = FROM
	}

	is_triggered_only = yes

	trigger = {
		has_global_flag = gray_goo_crisis_active
		FROM = {
			is_country_type = gate_builders_remnant
		}
	}

	option = {
		name = megaexpanded.29.a
		response_text = megaexpanded.29.a.response
		is_dialog_only = yes
	}
	option = {
		name = megaexpanded.29.b
		trigger = {
			NOT = { has_country_flag = gate_builders_remnant_gift }
			NOT = { has_country_flag = lcluster_opener }
		}
		response_text = megaexpanded.29.b.response
		is_dialog_only = yes
		add_research_option = tech_gray_goo
		add_tech_progress = {
			tech = tech_gray_goo
			progress = 0.25
		}
		hidden_effect = {
			set_country_flag = gate_builders_remnant_gift
		}
	}
	option = {
		name = megaexpanded.29.b
		trigger = {
			NOT = { has_country_flag = gate_builders_remnant_gift }
			has_country_flag = lcluster_opener
		}
		response_text = megaexpanded.29.b.response.opener
		add_research_option = tech_gray_goo
		add_tech_progress = {
			tech = tech_gray_goo
			progress = 0.25
		}
		hidden_effect = {
			set_country_flag = gate_builders_remnant_gift
		}
	}
	option = {
		name = crisis.55.d
		response_text = megaexpanded.29.c.response
	}
	option = {
		name = SCUM
		exclusive_trigger = {
			has_valid_civic = civic_fanatic_purifiers
		}
	}
	
	option = {
		name = TASTY
		exclusive_trigger = {
			has_valid_civic = civic_hive_devouring_swarm
		}
	}

	option = {
		name = EXTERMINATE
		exclusive_trigger = {
			has_valid_civic = civic_machine_terminator
		}
	}
}

# Gate Builder Custom Diplomacy
country_event = {
	id = megaexpanded.30
	title = "megaexpanded.29.name"

	desc = {
		text = megaexpanded.30.desc_01
		trigger = {
			is_homicidal = no
			OR = {
				NOT = { has_country_flag = lcluster_opener }
				has_global_flag = lcluster_opener_country_redeemed
			}
			has_crisis = no
		}
	}
	desc = {
		text = megaexpanded.30.desc_02
		trigger = {
			is_homicidal = no
			OR = {
				NOT = { has_country_flag = lcluster_opener }
				has_global_flag = lcluster_opener_country_redeemed
			}
		}
	}
	desc = {
		text = megaexpanded.30.desc_03
		trigger = {
			is_homicidal = no
			is_militarist = no
			is_xenophobe = no
			is_robot_empire = no
			is_at_war = no
			OR = {
				NOT = { has_country_flag = lcluster_opener }
				has_global_flag = lcluster_opener_country_redeemed
			}
			has_crisis = no
		}
	}
	desc = {
		text = megaexpanded.30.desc_04
		trigger = {
			is_homicidal = no
			is_militarist = no
			is_xenophobe = no
			is_robot_empire = yes
			is_at_war = no
			OR = {
				NOT = { has_country_flag = lcluster_opener }
				has_global_flag = lcluster_opener_country_redeemed
			}
			has_crisis = no
		}
	}
	desc = {
		text = megaexpanded.30.desc_05
		trigger = {
			has_country_flag = lcluster_opener
			NOT = {
				has_global_flag = lcluster_opener_country_redeemed
			}
		}
	}
	desc = {
		text = megaexpanded.30.desc_06
		trigger = {
			has_country_flag = lcluster_opener
			NOT = {
				has_global_flag = lcluster_opener_country_redeemed
			}
		}
	}
	desc = {
		text = megaexpanded.30.desc_07
		trigger = {
			is_homicidal = no
			is_robot_empire = yes
			OR = {
				NOT = { has_country_flag = lcluster_opener }
				has_global_flag = lcluster_opener_country_redeemed
			}
		}
	}
	desc = {
		text = megaexpanded.30.desc_08
		trigger = {
			is_homicidal = yes
			is_robot_empire = yes
		}
	}
	desc = {
		text = megaexpanded.30.desc_09
		trigger = {
			is_homicidal = yes
		}
	}
	desc = {
		text = megaexpanded.30.desc_10
		trigger = {
			is_homicidal = yes
		}
	}
	desc = {
		text = megaexpanded.30.desc_11
		trigger = {
			is_homicidal = no
			OR = {
				NOT = { has_country_flag = lcluster_opener }
				has_global_flag = lcluster_opener_country_redeemed
			}
			has_crisis = no
		}
	}
	desc = {
		text = megaexpanded.30.desc_12
		trigger = {
			has_global_flag = ai_invasion_ongoing
		}
	}
	desc = {
		text = megaexpanded.30.desc_13
		trigger = {
			has_global_flag = ai_invasion_ongoing
		}
	}
	desc = {
		text = megaexpanded.30.desc_14
		trigger = {
			has_global_flag = ai_invasion_ongoing
		}
	}
	desc = {
		text = megaexpanded.30.desc_15
		trigger = {
			has_crisis = yes
		}
	}
	desc = {
		text = megaexpanded.30.desc_16
		trigger = {
			OR = {
				has_global_flag = ongoing_prethoryn_invasion
				AND = {
					has_global_flag = extradimensional_invasion_happened
					NOT = { has_global_flag = extradimensional_invasion_defeated }
				}
			}
		}
	}
	desc = {
		text = megaexpanded.30.desc_17
		trigger = {
			has_global_flag = ongoing_prethoryn_invasion
		}
	}
	desc = {
		text = megaexpanded.30.desc_18
		trigger = {
			has_global_flag = extradimensional_invasion_happened
			NOT = { has_global_flag = extradimensional_invasion_defeated }
		}
	}

	diplomatic = yes

	picture_event_data = {
		portrait = FROM
	}

	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = gray_goo_crisis_active }
		FROM = {
			is_country_type = gate_builders_remnant
		}
	}
	
	# sell access to living metal, maybe nanites
	
	option = {
		name = megaexpanded.30.a
		trigger = {
			OR = {
				NOT = { has_country_flag = lcluster_opener }
				has_global_flag = lcluster_opener_country_redeemed
			}
		}
		response_text = megaexpanded.30.a.response
		is_dialog_only = yes
	}
	option = {
		name = megaexpanded.30.b
		trigger = {
			OR = {
				NOT = { has_country_flag = lcluster_opener }
				has_global_flag = lcluster_opener_country_redeemed
			}
		}
		response_text = megaexpanded.30.b.response
		is_dialog_only = yes
	}
	
	option = {
		name = crisis.55.d
	}
	
	option = {
		name = SCUM
		exclusive_trigger = {
			has_valid_civic = civic_fanatic_purifiers
		}
	}
	
	option = {
		name = TASTY
		exclusive_trigger = {
			has_valid_civic = civic_hive_devouring_swarm
		}
	}

	option = {
		name = EXTERMINATE
		exclusive_trigger = {
			has_valid_civic = civic_machine_terminator
		}
	}
}
country_event = {
	id = megaexpanded.31
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = from
		OR = {
			has_global_flag = gate_builders_remnant_returns
			has_global_flag = tech_gray_goo_enabled
		}
		is_country_type = default
		FROM = { is_country_type = gray_goo }
	}

	immediate = {
		change_variable = {
			which = "gray_fleet_kills"
			value = 1
		}
	}
}

# Gate Builder Donates Fleet
country_event = {
	id = megaexpanded.32
	title = "megaexpanded.29.name"
	desc = {
		trigger = { NOT = { has_country_flag = lcluster_opener } }
		text = "megaexpanded.32.desc"
	}
	desc = {
		trigger = { has_country_flag = lcluster_opener }
		text = "megaexpanded.32.desc.opener"
	}

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:gate_builders_remnant_country
	}

	trigger = {
		is_country_type = default
		has_global_flag = gate_builders_remnant_returns
		NOT = { has_global_flag = gate_builders_remnant_destroyed }
		NOT = { has_country_flag = gate_builders_remnant_donation }
		OR = {
			AND = {
				NOT = { has_country_flag = lcluster_opener }
				check_variable = {
					which = "gray_fleet_kills"
					value > 6
				}
			}
			check_variable = {
				which = "gray_fleet_kills"
				value > 9
			}
		}
		any_country = {
			is_country_type = gate_builders_remnant
			fleet_power > 60000
			ROOT = {
				NOT = { is_at_war_with = PREV }
			}
		}
	}

	mean_time_to_happen = {
		months = 80
	}

	immediate = {
		set_country_flag = gate_builders_remnant_donation
	}

	option = {
		name = crisis.2473.a
		response_text = megaexpanded.32.a.response
		custom_tooltip = megaexpanded.32.a.tooltip
		hidden_effect = {
			capital_scope = {
				create_fleet = {
					name = "NAME_Gate_Builder_Auxiliary_Fleet"
					effect = {
						set_owner = event_target:gate_builders_remnant_country
						set_fleet_flag = gate_builders_remnant_donation_fleet
						while = {
							count = 1
							create_ship = {
								name = random
								design = "NAME_Surplus_Custodian"
								graphical_culture = fallen_empire_03
								upgradable = no
							}
						}
						while = {
							count = 3
							create_ship = {
								name = random
								design = "NAME_Surplus_Warden"
								graphical_culture = fallen_empire_03
								upgradable = no
							}
						}
						set_owner = root
						set_location = {
							target = PREV
							distance = 45
							angle = random
						}
					}
					settings = {
						can_upgrade = no
						can_change_composition = no
						uses_naval_capacity = no
					}
				}
			}
		}
	}
	option = {
		name = crisis.71.b
		trigger = { is_ai = no }
		response_text = megaexpanded.32.b.response
	}
}

# Gate-Builder Reinforcements
country_event = {
	id = megaexpanded.33
	hide_window = yes

	trigger = {
		OR = {
			has_global_flag = gray_goo_crisis_active
			has_global_flag = ongoing_prethoryn_invasion
			AND = {
				has_global_flag = extradimensional_invasion_happened
				NOT = { has_global_flag = extradimensional_invasion_defeated }
			}
			has_global_flag = ai_invasion_ongoing
			AND = {
				is_at_war = no
				fleet_power < 5000
			}
		}
		has_global_flag = gate_builders_remnant_returns
		NOT = { has_global_flag = gate_builders_remnant_destroyed }
		is_country_type = gate_builders_remnant
		fleet_power < 200000
	}

	mean_time_to_happen = {
		months = 100
		modifier = {
			factor = 0.25
			fleet_power < 5000
		}
	}

	immediate = {
		capital_scope = { create_fallen_empire_fleet = yes }
	}
}

# Gray Tempest defeated, Gate-Builders sieze terminal
country_event = {
	id = megaexpanded.34
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = { has_country_flag = lcluster_opener }
			save_event_target_as = lcluster_opener_country
			if = {
				limit = {
					OR = {
						check_variable = {
							which = "gray_fleet_kills"
							value > 9
						}
						AND = {
							any_owned_fleet = {
								solar_system = { has_star_flag = lcluster }
							}
							check_variable = {
								which = "gray_fleet_kills"
								value > 0
							}
						}
						AND = {
							any_owned_fleet = {
								solar_system = { has_star_flag = graygoo_factory_system }
							}
						}
					}
				}
				set_global_flag = lcluster_opener_country_redeemed
			}
		}
		# destroy existing fleets, spawn new ones
		every_owned_fleet = {
			destroy_fleet = this
		}
		capital_scope = {
			create_fallen_empire_fleet = yes
			create_fallen_empire_fleet = yes
			create_fleet = {
				effect = {
					set_owner = prev.owner
					create_fallen_empire_titan = yes
					set_location = {
						target = prev
						distance = 20
						angle = random
					}
				}
			}
			create_fleet = {
				effect = {
					set_owner = prev.owner
					create_fallen_empire_construction_ship = yes
					set_location = {
						target = prev
						distance = 60
						angle = random
					}
				}
			}
			create_fleet = {
				effect = {
					set_owner = prev.owner
					create_fallen_empire_construction_ship = yes
					set_location = {
						target = prev
						distance = 80
						angle = random
					}
				}
			}
			create_fleet = {
				effect = {
					set_owner = prev.owner
					create_fallen_empire_construction_ship = yes
					set_location = {
						target = prev
						distance = 100
						angle = random
					}
				}
			}
			while = {
				count = 20
				create_army = {
					name = random
					owner = event_target:gate_builders_remnant_country
					species = event_target:gate_builders_remnant_country
					type = "robotic_army"
				}
			}
		}
		# take control over the l-gate terminal
		random_system = {
			limit = { has_star_flag = lcluster1 }
			create_fe_home_citadel = yes
			starbase = {
				set_owner = event_target:gate_builders_remnant_country
			}
			random_system_planet = {
				limit = {
					is_planet_class = pc_gray_goo
					is_moon = no
				}
				planet_event = { id = megaexpanded.36 days = 3600 random = 3600 }
				ROOT = {
					create_leader = {
						class = admiral
						species = owner_main_species
						name = random
						skill = 10
						leader_age_min = 25
						leader_age_max = 45
						traits = {
							trait = random_trait
							trait = random_trait
							trait = random_trait
						}
					}
				}
				create_fleet = {
					effect = {
						set_owner = ROOT
						while = {
							count = 8
							create_fallen_empire_large_ship = yes
						}
						while = {
							count = 18
							create_fallen_empire_small_ship = yes
						}
						random_list = {
							25 = {
								set_location = {
									target = prev
									distance = 30
									angle = random
								}
							}
							25 = {
								set_location = {
									target = prev
									distance = 45
									angle = random
								}
							}
							25 = {
								set_location = {
									target = prev
									distance = 60
									angle = random
								}
							}
							25 = {
								set_location = {
									target = prev
									distance = 75
									angle = random
								}
							}
						}
					}
				}
				ROOT = {
					create_leader = {
						class = admiral
						species = owner_main_species
						name = random
						skill = 10
						leader_age_min = 25
						leader_age_max = 45
						traits = {
							trait = random_trait
							trait = random_trait
							trait = random_trait
						}
					}
				}
				create_fleet = {
					effect = {
						set_owner = ROOT
						while = {
							count = 8
							create_fallen_empire_large_ship = yes
						}
						while = {
							count = 18
							create_fallen_empire_small_ship = yes
						}
						random_list = {
							25 = {
								set_location = {
									target = prev
									distance = 30
									angle = random
								}
							}
							25 = {
								set_location = {
									target = prev
									distance = 45
									angle = random
								}
							}
							25 = {
								set_location = {
									target = prev
									distance = 60
									angle = random
								}
							}
							25 = {
								set_location = {
									target = prev
									distance = 75
									angle = random
								}
							}
						}
					}
				}
			}
		}
		every_country = {
			limit = {
				OR = { is_country_type = default is_country_type = ascended_empire is_country_type = lost_empire }
			}
			country_event = { id = megaexpanded.35 }
		}
	}
}
# Gate-Builders Contact Galaxy
country_event = {
	id = megaexpanded.35
	title = "TRANSMISSION"
	desc = {
		trigger = {
			has_global_flag = lcluster_opener_country_redeemed
		}
		text = "megaexpanded.35.desc"
	}
	desc = {
		trigger = {
			NOT = { has_global_flag = lcluster_opener_country_redeemed }
		}
		text = "megaexpanded.35.desc.guard"
	}

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:gate_builders_remnant_country
	}

	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = { has_country_flag = lcluster_opener }
			save_event_target_as = lcluster_opener_country
		}
		if = {
			limit = {
				has_country_flag = lcluster_opener
				NOT = { has_global_flag = lcluster_opener_country_redeemed }
			}
			event_target:gate_builders_remnant_country = {
				set_faction_hostility = {
					target = root
					set_hostile = yes
					set_neutral = no
					set_friendly = no
				}
			}
		}
		if = {
			limit = {
				is_homicidal = yes
			}
			event_target:gate_builders_remnant_country = {
				set_faction_hostility = {
					target = root
					set_hostile = yes
					set_neutral = no
					set_friendly = no
				}
			}
		}
	}

	option = {
		name = crisis.2402.a
		if = {
			limit = {
				any_owned_fleet = { has_fleet_flag = gate_builders_remnant_donation_fleet }
			}
			custom_tooltip = megaexpanded.35.a.tooltip
			hidden_effect = {
				every_owned_fleet = {
					limit = { has_fleet_flag = gate_builders_remnant_donation_fleet }
					destroy_fleet = this
				}
			}
		}
	}
}

planet_event = {
	id = megaexpanded.36
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = { is_planet_class = pc_gaia }
		solar_system = {
			exists = space_owner
			space_owner = { is_country_type = gate_builders_remnant }
		}
	}
	
	immediate = {
		remove_modifier = terraforming_candidate
		set_planet_size = 25
		change_pc = pc_gaia
		reroll_planet = yes
		clear_blockers = yes
		set_owner = FROM
		set_controller = FROM
		add_building = building_system_capital # 7 jobs
		add_building = building_hall_judgment # 5 jobs
		add_building = building_fortress # 3 jobs
		add_building = building_hyper_entertainment_forum # 5 jobs
		add_building = building_research_lab_3 # 8
		add_building = building_research_lab_3 # 8
		add_building = building_factory_3 # 8
		add_building = building_factory_3 # 8
		add_building = building_nourishment_center
		add_building = building_class_4_singularity
		add_building = building_class_4_singularity
		add_building = building_dimensional_fabricator
		add_building = building_dimensional_fabricator
		add_building = building_fe_dome
		while = {
			count = 12
			add_district = district_city # 12 jobs
		}
		while = {
			count = 4
			add_district = district_generator # 8 jobs
		}
		while = {
			count = 4
			add_district = district_mining # 8 jobs
		}
		if = {
			limit = { FROM = { is_lithoid_empire = no } }
			while = {
				count = 5
				add_district = district_farming # 10 jobs
			}
		}
		else = {
			while = {
				count = 5
				add_district = district_mining # 10 jobs
			}
		}
		while = {
			count = 90
			create_pop = {
				species = owner_main_species
			}
		}
	}
}

# Curators - Gray Goo Tech
country_event = {
	id = megaexpanded.40
	title = leviathans.500.name
	desc = megaexpanded.40.desc
	is_triggered_only = yes
	diplomatic = yes

	custom_gui = "enclave_curator_window"

	picture_event_data = {
		portrait = event_target:the_curators
		room = enclave_curator_room
	}
	
	trigger = {
		is_homicidal = no
		exists = event_target:the_curators
		any_country = {
			is_country_type = gray_goo
			galaxy_percentage > 0.10
		}
	}

	option = {
		name = megaexpanded.40.a
		is_dialog_only = yes
		response_text = megaexpanded.40.a.explain
	}
	option = {
		name = megaexpanded.40.b
		response_text = megaexpanded.40.b.explain
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value >= 1000	
			}
		}	
		add_resource = {
			energy = -1000
		}
		give_technology = { tech = tech_gray_goo }
	}
	option = {
		name = TOOPOOR
		trigger = {
			OR = {
				is_ai = no
				NOT = {
					resource_stockpile_compare = {
						resource = energy
						value >= 1000	
					}
				}
			}
		}
		response_text = megaexpanded.40.c.explain
		add_research_option = tech_gray_goo
		add_tech_progress = {
			tech = tech_gray_goo
			progress = 0.25
		}
	}
}

# Curator Finds Fleet
country_event = {
	id = megaexpanded.41
	title = leviathans.500.name
	desc = megaexpanded.41.desc
	diplomatic = yes

	custom_gui = "enclave_curator_window"

	picture_event_data = {
		portrait = event_target:the_curators
		room = enclave_curator_room
	}
	
	trigger = {
		has_global_flag = tech_gray_goo_enabled
		NOT = { has_country_flag = gate_builders_remnant_donation }
		is_country_type = default
		is_homicidal = no
		any_country = {
			is_country_type = enclave
			has_country_flag = curator_enclave_country
			OR = {
				trust = { who = root value >= 50 }
				any_country = {
					is_country_type = gray_goo
					galaxy_percentage > 0.40
				}
			}
		}
		any_country = {
			is_country_type = gray_goo
			galaxy_percentage > 0.10
		}
		check_variable = {
			which = "gray_fleet_kills"
			#value > 6
			value > 0
		}
	}
	
	mean_time_to_happen = {
		months = 80
	}
	
	immediate = {
		set_country_flag = gate_builders_remnant_donation
		random_country = {
			limit = {
				is_country_type = enclave
				has_country_flag = curator_enclave_country
			}
			save_event_target_as = the_curators 
		}
		random_system_within_border = {
			save_event_target_as = ancient_starbase_system
		}
	}

	option = {
		name = megaexpanded.41.a
		response_text = megaexpanded.41.a.explain
		custom_tooltip = megaexpanded.41.a.tooltip
		hidden_effect = {
			capital_scope = {
				create_fleet = {
					name = "NAME_Salvaged_FE_Fleet"
					effect = {
						set_owner = root
						set_fleet_flag = gate_builders_remnant_donation_fleet
						while = {
							count = 1
							create_ship = {
								name = random
								design = "NAME_Surplus_Custodian"
								graphical_culture = fallen_empire_03
								upgradable = no
							}
						}
						while = {
							count = 3
							create_ship = {
								name = random
								design = "NAME_Surplus_Warden"
								graphical_culture = fallen_empire_03
								upgradable = no
							}
						}
						set_location = {
							target = PREV
							distance = 45
							angle = random
						}
					}
					settings = {
						can_upgrade = no
						can_change_composition = no
						uses_naval_capacity = no
					}
				}
			}
		}
	}
	
	option = {
		name = megaexpanded.41.b
		trigger = { is_ai = no }
		response_text = megaexpanded.41.b.response
		custom_tooltip = opinion-5
		hidden_effect = {
			event_target:the_curators = {
				add_trust = {
					who = root
					amount = -5
				}
			}
			random_relation = {
				limit = {
					is_ai = yes
					is_country_type = default
					is_homicidal = no
				}
				save_event_target_as = curator_alternate_giftee
				capital_scope = {
					create_fleet = {
						name = "NAME_Salvaged_FE_Fleet"
						effect = {
							set_owner = event_target:curator_alternate_giftee
							set_fleet_flag = gate_builders_remnant_donation_fleet
							while = {
								count = 1
								create_ship = {
									name = random
									design = "NAME_Surplus_Custodian"
									graphical_culture = fallen_empire_03
									upgradable = no
								}
							}
							while = {
								count = 3
								create_ship = {
									name = random
									design = "NAME_Surplus_Warden"
									graphical_culture = fallen_empire_03
									upgradable = no
								}
							}
							set_location = {
								target = PREV
								distance = 45
								angle = random
							}
						}
						settings = {
							can_upgrade = no
							can_change_composition = no
							uses_naval_capacity = no
						}
					}
				}
			}
		}
	}
}