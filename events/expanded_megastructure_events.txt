############################
#
# Expanded Magastructure Events
#
############################

namespace = megaexpanded

##################################
# Sensor Array
# Reserved 1 - 100
##################################

# Detect Crisis
# Prethoryn
# Approaching Subspace Echoes
country_event = {
	id = megaexpanded.1
	title = "crisis.11.name"
	desc = "megaexpanded.1.desc"
	picture = GFX_evt_physics_research
	show_sound = event_alien_nature
	
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = spy_orb_spots_crisis
	}
	
	option = {
		name = crisis.11.a
		begin_event_chain = {
			event_chain = "coming_storm_chain"
			target = ROOT
		}
	}
}

# Tracking Telemetry
country_event = {
	id = megaexpanded.2
	title = "megaexpanded.2.name"
	desc = "megaexpanded.2.desc"
	picture = GFX_evt_physics_research
	show_sound = event_alien_nature
	
	is_triggered_only = yes
	
	immediate = {
		random_rim_system = {
			limit = { has_star_flag = swarm_invasion_target_1 }
			save_event_target_as = prethoryn_invasion_system
			closest_system = {
				limit = {
					NOT = { 
						has_star_flag = swarm_invasion_warning 
						has_star_flag = swarm_invasion_target_1
					}
				}
				set_star_flag = swarm_invasion_warning
				save_event_target_as = swarm_invasion_warning_1
			}
			closest_system = {
				limit = {
					NOT = { 
						has_star_flag = swarm_invasion_warning 
						has_star_flag = swarm_invasion_target_1
					}
				}
				set_star_flag = swarm_invasion_warning
				save_event_target_as = swarm_invasion_warning_2
			}
			closest_system = {
				limit = {
					NOT = { 
						has_star_flag = swarm_invasion_warning 
						has_star_flag = swarm_invasion_target_1
					}
				}
				set_star_flag = swarm_invasion_warning
				save_event_target_as = swarm_invasion_warning_3
			}
			closest_system = {
				limit = {
					NOT = { 
						has_star_flag = swarm_invasion_warning 
						has_star_flag = swarm_invasion_target_1
					}
				}
				set_star_flag = swarm_invasion_warning
				save_event_target_as = swarm_invasion_warning_4
			}
			closest_system = {
				limit = {
					NOT = { 
						has_star_flag = swarm_invasion_warning 
						has_star_flag = swarm_invasion_target_1
					}
				}
				set_star_flag = swarm_invasion_warning
				save_event_target_as = swarm_invasion_warning_5
			}
		}
		
	}
	
	option = {
		name = megaexpanded.2.a
		create_point_of_interest = {
			id = coming_storm_poi.1
			name = "coming_storm_poi_1_poi"
			desc = "coming_storm_poi_1_poi_desc"
			event_chain = "coming_storm_chain"
			category = coming_storm
			location = event_target:prethoryn_invasion_system
		}
		hidden_effect = {
			create_point_of_interest = {
				id = coming_storm_poi.2
				event_chain = "coming_storm_chain"
				category = coming_storm
				location = event_target:swarm_invasion_warning_1
			}
			create_point_of_interest = {
				id = coming_storm_poi.3
				event_chain = "coming_storm_chain"
				category = coming_storm
				location = event_target:swarm_invasion_warning_2
			}
			create_point_of_interest = {
				id = coming_storm_poi.4
				event_chain = "coming_storm_chain"
				category = coming_storm
				location = event_target:swarm_invasion_warning_3
			}
			create_point_of_interest = {
				id = coming_storm_poi.5
				event_chain = "coming_storm_chain"
				category = coming_storm
				location = event_target:swarm_invasion_warning_4
			}
			create_point_of_interest = {
				id = coming_storm_poi.6
				event_chain = "coming_storm_chain"
				category = coming_storm
				location = event_target:swarm_invasion_warning_5
			}
		}
	}
}

# Approaching the Outer Rim 
country_event = {
	id = megaexpanded.3
	title = "crisis.13.name"
	picture = GFX_evt_physics_research
	show_sound = event_alien_nature
	
	desc = {
		text = "megaexpanded.3.desc"
		trigger = {
			NOT = { owner_species = { OR = { has_trait = trait_psionic has_trait = trait_hive_mind } } }
		}
	}
	desc = {
		text = "megaexpanded.3.b.desc"
		trigger = {
			owner_species = { has_trait = trait_psionic }
		}
	}
	desc = {
		text = "megaexpanded.3.c.desc"
		trigger = {
			owner_species = { has_trait = trait_hive_mind }
		}
	}
	
	is_triggered_only = yes
	
	option = {
		name = crisis.13.a
		add_modifier = {
			modifier = prepared_for_the_end
			days = -1
		}
	}
}

# Hole in the Void
country_event = {
	id = megaexpanded.4
	title = "crisis.234.name"
	desc = "megaexpanded.4.desc"
	picture = GFX_evt_physics_research
	show_sound = event_alien_nature	
	
	trigger = {
		OR = { is_country_type = default is_country_type = ascended_empire is_country_type = lost_empire }
		has_crisis = no
		OR = {
			NOR = {
				owner_species = { has_trait = trait_psionic }
				owner_species = { has_trait = trait_hive_mind }
			}
			NOT = { any_owned_leader = { has_leader_flag = captured_queen } }
		}
		OR = {
			has_megastructure = spy_orb_4
			has_megastructure = spy_orb_restored
		}
		NOT = { has_country_flag = crisis.234 }
	}
	
	mean_time_to_happen = {
		years = 100
	}	
	
	option = {
		name = crisis.234.a
		set_country_flag = crisis.234
		add_monthly_resource_mult = {
			resource = physics_research
			value = 10
			min = 1000
			max = 5000
		}
	}
}

# Extradimensional Invaders
# Mark spawning system
country_event = {
	id = megaexpanded.5
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes
	
	immediate = {
		random_system = {
			limit = {
				NOT = {
					any_country = {
						OR = {
							is_country_type = fallen_empire
							is_country_type = awakened_fallen_empire
						}
						any_system_within_border = {
							is_same_value = prev
						}
					}
				}
			}
			set_star_flag = extradimensional_origin_system
			save_event_target_as = extradimensional_system
		}
		every_country = {
			limit = {
				OR = { is_country_type = default is_country_type = ascended_empire is_country_type = lost_empire }
				OR = {
					has_megastructure = spy_orb_4
					has_megastructure = spy_orb_restored
				}
			}
			country_event = { id = megaexpanded.6 days = 5 random = 95 }
		}
	}
}

# Tear detected
country_event = {
	id = megaexpanded.6
	title = "megaexpanded.6.name"
	desc = "megaexpanded.6.desc"
	picture = GFX_evt_wormhole
	show_sound = event_ex_started
	location = event_target:extradimensional_system
	
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = spy_orb_spots_crisis
	}
	
	option = {
		name = megaexpanded.6.a
		begin_event_chain = {
			event_chain = "extradimensional_invasion_warning_chain"
			target = ROOT
		}
		create_point_of_interest = {
			id = extradimensional_invasion_warning_poi.1
			name = "extradimensional_invasion_warning_poi_1_poi"
			desc = "extradimensional_invasion_warning_poi_1_poi_desc"
			event_chain = "extradimensional_invasion_warning_chain"
			location = event_target:extradimensional_system
		}
	}
}

# Invader ships scanned
country_event = {
	id = megaexpanded.7
	title = "megaexpanded.7.name"
	desc = "megaexpanded.7.desc"
	picture = GFX_evt_wormhole
	show_sound = event_ex_started
	
	is_triggered_only = yes
	
	option = {
		name = megaexpanded.7.a
		end_event_chain = extradimensional_invasion_warning_chain
		add_modifier = {
			modifier = prepared_for_the_end
			days = -1
		}
	}
}

# The Contingency
# The Ghost Signal
country_event = {
	id = megaexpanded.8
	title = "crisis.2010.name"
	desc = {
		trigger = {
			NOT = {
				has_authority = auth_machine_intelligence	
			}
		}
		text = megaexpanded.8.desc
	}
	desc = {
		trigger = {
			has_authority = auth_machine_intelligence	
		}
		text = megaexpanded.8.desc.b
	}
	picture = GFX_evt_glitchy_matrix
	
	show_sound = event_alien_signal
	
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = spy_orb_spots_crisis
	}
	
	option = {
		name = crisis.2010.a
		begin_event_chain = {
			event_chain = "ghost_signal_chain"
			target = ROOT
		}
	}
}

# Other empires notice the ghost signal
country_event = {
	id = megaexpanded.9
	title = "crisis.2010.name"
	desc = {
		trigger = {
			NOT = {
				has_authority = auth_machine_intelligence	
			}
		}
		text = megaexpanded.9.desc
	}
	desc = {
		trigger = {
			has_authority = auth_machine_intelligence	
		}
		text = megaexpanded.9.desc.b
	}
	picture = GFX_evt_glitchy_matrix
	show_sound = event_alien_signal
	
	is_triggered_only = yes
	
	option = {
		name = INTRIGUING
	}
}

# Pinpoints a sterilization hub
country_event = {
	id = megaexpanded.10
	title = "megaexpanded.10.name"
	desc = "megaexpanded.10.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_alien_signal
	
	is_triggered_only = yes
	
	immediate = {
		random_planet = {
			limit = { has_planet_flag = machine_world_1 }
			save_event_target_as = machine_world_1_scope
		}
	}
	
	option = {
		name = PECULIAR
		create_point_of_interest = {
			id = machine_world_1_poi.1
			name = "machine_world_1_poi_1_poi"
			desc = "machine_world_1_poi_1_poi_desc"
			event_chain = "ghost_signal_chain"
			location = event_target:machine_world_1_scope
		}
	}
}

# Scan contingency ships
country_event = {
	id = megaexpanded.11
	title = "megaexpanded.11.name"
	desc = "megaexpanded.11.desc"
	picture = GFX_evt_glitchy_matrix
	show_sound = event_alien_signal
	
	is_triggered_only = yes
	
	option = {
		name = megaexpanded.11.a
		add_modifier = {
			modifier = prepared_for_the_end
			days = -1
		}
	}
}