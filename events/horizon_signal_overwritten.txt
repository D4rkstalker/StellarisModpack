#Horozon signal events edited to exclude habitable megastructures. Why isn't this scripted_trigger already in use? I really don't know.

namespace = akx

# on colonized
planet_event = {
	id = akx.9499
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		NOR = {
			habitable_structure = yes
			#is_planet_class = pc_habitat
			#is_planet_class = pc_ringworld_habitable
			is_planet_class = pc_city
		}
		exists = owner
		owner = {
			has_country_flag = worm_events_available
			NOT = {
				has_country_flag = waiting_world
			}
		}
	}

	immediate = {
		owner = {
			set_country_flag = waiting_world
		}
		planet_event = { id = akx.9500 days = 30 }
	}
}

planet_event = {
	id = akx.10020
	title = akx.10020.name
	desc = akx.10020.desc
	picture = GFX_evt_black_hole
	show_sound = event_activating_unknown_technology
	location = root

	is_triggered_only = yes

	trigger = { owner = { is_ai = no } }

#change: All pops everywhere in the system get the new traits, but the rules for turning them into tomb worlds still apply

	immediate = {
		solar_system = {
			every_system_planet = {
				every_owned_pop = {
					limit = {
						is_robot_pop = no
						is_sapient = yes
					}
					if = {
						limit = { NOT = { has_trait = trait_natural_physicists } }
						# remove opposite traits
						if = {
							limit = { has_trait = trait_natural_engineers }
							modify_species = {
								species = this
								remove_trait = trait_natural_engineers
							}
						}
						if = {
							limit = { has_trait = trait_natural_sociologists }
							modify_species = {
								species = this
								remove_trait = trait_natural_sociologists
							}
						}
						if = {
							limit = { has_trait = trait_nerve_stapled }
							modify_species = {
								species = this
								remove_trait = trait_nerve_stapled
							}
						}
						# add trait
						modify_species = {
							species = this
							add_trait = trait_natural_physicists
						}
					}
					if = {
						limit = { NOT = { has_trait = trait_repugnant } }
						# remove opposite traits
						if = {
							limit = { has_trait = trait_charismatic }
							modify_species = {
								species = this
								remove_trait = trait_charismatic
							}
						}
						modify_species = {
							species = this
							add_trait = trait_repugnant
						}
					}
					modify_species = {
						species = this
						ideal_planet_class = pc_nuked
					}
				}
				if = {
					limit = {
						NOR = {
							habitable_structure = yes
							is_planet_class = pc_gas_giant
							is_planet_class = pc_ringworld_habitable
							is_planet_class = pc_ringworld_habitable_damaged
							is_planet_class = pc_ringworld_tech
							is_planet_class = pc_ringworld_tech_damaged
							is_planet_class = pc_ringworld_seam
							is_planet_class = pc_ringworld_seam_damaged
							is_planet_class = pc_habitat
							is_planet_class = pc_asteroid
							is_planet_class = pc_ice_asteroid
							is_planet_class = pc_city
							is_star = yes
						}
						planet_size < 26
					}
					change_pc = pc_nuked
					reroll_planet = yes
				}
			}
			random_system_planet = {
				limit = { is_star = yes }
				change_pc = pc_black_hole
			}
		}
		owner = { observer_event = { id = observer.71 } }
	}

	after = {
		hidden_effect = {
			owner = {
				remove_country_flag = worm_events_available
				set_country_flag = worm_awaited
				set_country_flag = worm_tomb_ending
			}
		}
	}

	option = {
		name = akx.10020.a
		owner = { end_event_chain = WORM_CHAIN_2 }
	}
}





