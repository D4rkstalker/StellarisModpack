namespace = habitataifix
country_event = {
	id = habitataifix.99
	hide_window = yes
	fire_only_once = yes
	immediate = {
		set_global_flag = habitataifix_installed
	}
}

country_event = {
	id = habitataifix.0
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = yes
		OR = {
			is_country_type = default
			is_country_type = awakened_fallen_empire
		}
	}
	immediate = {
		country_event = {
			id = habitataifix.10
			days = 8
			random = 0
		}
	}
}

country_event = {
	id = habitataifix.10
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = yes
		OR = {
			is_country_type = default
			is_country_type = awakened_fallen_empire
		}
		any_planet_within_border = {
			OR = {
				# Vanilla
				is_planet_class = pc_habitat
				is_planet_class = pc_ringworld_habitable
				# Planetary Diversity - Planetary Habitats
				uses_district_set = pdplanethab
				#	is_planet_class = pc_pd_barren_cold_hab
				#	is_planet_class = pc_pd_barren_hab
				#	is_planet_class = pc_pd_frozen_hab
				#	is_planet_class = pc_pd_gas_giant_hab
				#	is_planet_class = pc_pd_hothouse_hab
				#	is_planet_class = pc_pd_molten_hab
				#	is_planet_class = pc_pd_asteroid_hab
				#	is_planet_class = pc_pd_toxic_hab
				# Dyson Swarm - colonizing space
				is_planet_class = pc_dyson_swarm
			}
			is_colony = no
			is_under_colonization = no
		}
	}
	immediate = {
		country_event = {
			id = habitataifix.20
			days = 0
			random = 0
		}
	}
}

country_event = {
	id = habitataifix.20
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		if = {
			limit = {
				is_gestalt = no
				is_lithoid_empire = no
				has_resource = {
					type = food
					amount > 200
				}
				has_resource = {
					type = consumer_goods
					amount > 200
				}
				has_resource = {
					type = alloys
					amount > 200
				}
			}
			add_resource = {
				# minerals = -200
				# energy = -200
				food = -200
				consumer_goods = -200
				alloys = -200
			}
			country_event = {
				id = habitataifix.30
				days = 0
				random = 0
			}
			break = yes
		}
		else_if = {
			limit = {
				is_gestalt = no
				is_lithoid_empire = yes
				has_resource = {
					type = minerals
					amount > 200
				}
				has_resource = {
					type = consumer_goods
					amount > 200
				}
				has_resource = {
					type = alloys
					amount > 200
				}
			}
			add_resource = {
				minerals = -200
				# energy = -200
				# food = -200
				consumer_goods = -200
				alloys = -200
			}
			country_event = {
				id = habitataifix.30
				days = 0
				random = 0
			}
			break = yes
		}
		else_if = {
			limit = {
				has_origin = origin_tree_of_life
				is_lithoid_empire = no
				has_resource = {
					type = food
					amount > 1000
				}
				has_resource = {
					type = alloys
					amount > 50
				}
			}
			add_resource = {
				# minerals = -200
				# energy = -200
				food = -1000
				# consumer_goods = -200
				alloys = -50
			}
			country_event = {
				id = habitataifix.30
				days = 0
				random = 0
			}
			break = yes
		}
		else_if = {
			limit = {
				has_origin = origin_tree_of_life
				is_lithoid_empire = yes
				has_resource = {
					type = minerals
					amount > 500
				}
				has_resource = {
					type = food
					amount > 500
				}
				has_resource = {
					type = alloys
					amount > 50
				}
			}
			add_resource = {
				minerals = -500
				# energy = -200
				food = -500
				# consumer_goods = -200
				alloys = -50
			}
			country_event = {
				id = habitataifix.30
				days = 0
				random = 0
			}
			break = yes
		}
		else_if = {
			limit = {
				has_authority = auth_hive_mind
				is_lithoid_empire = no
				has_resource = {
					type = food
					amount > 500
				}
				has_resource = {
					type = alloys
					amount > 200
				}
			}
			add_resource = {
				# minerals = -200
				# energy = -200
				food = -500
				# consumer_goods = -200
				alloys = -200
			}
			country_event = {
				id = habitataifix.30
				days = 0
				random = 0
			}
			break = yes
		}
		else_if = {
			limit = {
				has_authority = auth_hive_mind
				is_lithoid_empire = yes
				has_resource = {
					type = minerals
					amount > 500
				}
				has_resource = {
					type = alloys
					amount > 200
				}
			}
			add_resource = {
				minerals = -500
				# energy = -200
				# food = -200
				# consumer_goods = -200
				alloys = -200
			}
			country_event = {
				id = habitataifix.30
				days = 0
				random = 0
			}
			break = yes
		}
		else_if = {
			limit = {
				is_gestalt = yes
				NOT = {
					has_authority = auth_hive_mind
				}
				is_lithoid_empire = no
				has_resource = {
					type = alloys
					amount > 400
				}
			}
			add_resource = {
				# minerals = -200
				# energy = -200
				# food = -200
				# consumer_goods = -200
				alloys = -400
			}
			country_event = {
				id = habitataifix.30
				days = 0
				random = 0
			}
			break = yes
		}
		else = {
			break = yes
		}
	}
}

# Because start_colony effect broke in 2.8
planet_event = {
	id = habitataifix.35
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		if = {
			limit = {
				has_colony_progress >= 1
			}
			create_colony = {
				owner = solar_system.owner
				species = solar_system.owner
				# ethos = solar_system.owner
			}
		}
	}
}

# Hotfix for ongoing games.
country_event = {
	id = habitataifix.36
	hide_window = yes
	fire_only_once = yes
	immediate = {
		country_event = {
			id = habitataifix.37
			days = 480
		}
	}
}

country_event = {
	id = habitataifix.37
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		save_event_target_as = habitataifix_assisted_colony_owner
		every_planet_within_border = {
			limit = {
				has_colony_progress >= 1
				num_pops = 0
			}
			set_planet_flag = habitataifix_assisted_colony
			planet_event = {
				id = habitataifix.35
				days = 480
			}
			start_colony = {
				owner = event_target:habitataifix_assisted_colony_owner
				species = event_target:habitataifix_assisted_colony_owner
				ethos = event_target:habitataifix_assisted_colony_owner
			}
		}
	}
}

country_event = {
	id = habitataifix.30
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		save_event_target_as = habitataifix_assisted_colony_owner
		random_planet_within_border = {
			limit = {
				OR = {
					# Vanilla
					is_planet_class = pc_habitat
					is_planet_class = pc_ringworld_habitable
					# Planetary Diversity - Planetary Habitats
					uses_district_set = pdplanethab
					#	is_planet_class = pc_pd_barren_cold_hab
					#	is_planet_class = pc_pd_barren_hab
					#	is_planet_class = pc_pd_frozen_hab
					#	is_planet_class = pc_pd_gas_giant_hab
					#	is_planet_class = pc_pd_hothouse_hab
					#	is_planet_class = pc_pd_molten_hab
					#	is_planet_class = pc_pd_asteroid_hab
					#	is_planet_class = pc_pd_toxic_hab
					# Dyson Swarm - colonizing space
					is_planet_class = pc_dyson_swarm
				}
				is_colony = no
				is_under_colonization = no
			}
			set_planet_flag = habitataifix_assisted_colony
			planet_event = {
				id = habitataifix.35
				days = 480
			}
			start_colony = {
				owner = event_target:habitataifix_assisted_colony_owner
				species = event_target:habitataifix_assisted_colony_owner
				ethos = event_target:habitataifix_assisted_colony_owner
			}
		}
	}
}
