namespace = aihealthcheck

event = {
	id = aihealthcheck.100
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			limit = {
				is_ai = yes
				is_country_type = default
			}
			random_owned_planet = {
				limit = {
					is_colony = yes
					is_hostile_planet_ia = yes
					not = { has_planet_flag = pf_hostile_reached_10 }
				}
				if = {
					limit = {
						num_pops > 9
					}
					set_planet_flag = pf_hostile_reached_10
					owner = {
						remove_country_flag = cf_stop_hostile_terraforming
					}
				}
			}
		}
		
	}
}

event = {
	id = aihealthcheck.10
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			limit = {
				is_ai = no
				is_regular_empire = yes
				is_country_type = default
				not = { has_policy_flag = alp_outpost_nobuilding }
			}
			save_event_target_as = healthcheckedcountry
			if = {
				limit = { has_policy_flag = alp_outpost_commsrelay }
				add_relay_building_to_random_outpost = yes
				add_relay_building_to_random_outpost = yes
			}	
			else_if = {
				limit = { has_policy_flag = alp_outpost_freightyard }
				add_freight_building_to_random_outpost = yes
				add_freight_building_to_random_outpost = yes
			}
			else_if = {
				limit = { has_policy_flag = alp_outpost_crewquarters }
				add_crew_building_to_random_outpost = yes
				add_crew_building_to_random_outpost = yes
			}
			else_if = {
				limit = { has_policy_flag = alp_outpost_resourcesilo }
				add_silo_building_to_random_outpost = yes
				add_silo_building_to_random_outpost = yes
			}			
		}
	}
}

event = {
	id = aihealthcheck.3
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			1 = {
				every_country = {
					limit = {
						has_technology = tech_toxic_world_terraforming
						is_regular_empire = yes
						is_country_type = default
					}
					random_planet_within_border = {
						limit = {
							is_colony = no
							is_planet_class = pc_toxic
							not = { has_modifier = terraforming_candidate }
							not = { has_modifier = potential_toxic_habitable }
							or = {
								and = {
									is_moon = yes
									planet_size < 15
									planet_size > 3
								}
								and = {
									planet_size < 13
									planet_size > 4
								}
								and = {
									space_owner = {
										has_ascension_perk = ap_all_these_worlds
									}
									planet_size < 19
									planet_size > 3				
								}
							}
						}
						#add_modifier = {
						#	modifier = potential_toxic_habitable
						#	days = -1
						#}
						add_modifier = {
							modifier = terraforming_candidate
							days = -1
						}
					}
				}
			}
			1 = {
				every_country = {
					limit = {
						has_technology = tech_molten_world_terraforming
						is_regular_empire = yes
						is_country_type = default
					}
					random_planet_within_border = {
						limit = {
							is_colony = no
							is_planet_class = pc_molten
							not = { has_modifier = terraforming_candidate }
							not = { has_modifier = potential_molten_habitable }
							or = {
								and = {
									is_moon = yes
									planet_size < 15
									planet_size > 3
								}
								and = {
									planet_size < 13
									planet_size > 4
								}
								and = {
									space_owner = {
										has_ascension_perk = ap_all_these_worlds
									}
									planet_size < 19
									planet_size > 3				
								}
							}
						}
						#add_modifier = {
						#	modifier = potential_molten_habitable
						#	days = -1
						#}
						add_modifier = {
							modifier = terraforming_candidate
							days = -1
						}
					}
				}
			}
			1 = {
				every_country = {
					limit = {
						has_technology = tech_frozen_world_terraforming
						is_regular_empire = yes
						is_country_type = default
					}
					random_planet_within_border = {
						limit = {
							is_colony = no
							is_planet_class = pc_frozen
							not = { has_modifier = terraforming_candidate }
							not = { has_modifier = potential_frozen_habitable }
							or = {
								and = {
									is_moon = yes
									planet_size < 15
									planet_size > 3
								}
								and = {
									planet_size < 13
									planet_size > 4
								}
								and = {
									space_owner = {
										has_ascension_perk = ap_all_these_worlds
									}
									planet_size < 19
									planet_size > 3				
								}
							}
						}
						#add_modifier = {
						#	modifier = potential_frozen_habitable
						#	days = -1
						#}
						add_modifier = {
							modifier = terraforming_candidate
							days = -1
						}
					}
				}
			}
			97 = {}
		}
		
		every_country = {
			limit = {
				is_ai = no
				is_country_type = default
			}
			random_owned_planet = {
				limit = {
					is_colony = yes
					has_modifier = auto_resettling
					not = { has_planet_flag = recent_resettlement_check }
					not = { num_pops < 6 }
					not = { num_pops = 10 }
					not = { num_pops = 15 }
					not = { num_pops = 20 }
					not = { num_pops = 25 }
					not = { num_pops = 30 }
					not = { num_pops = 35 }
					not = { num_pops = 40 }
					not = { num_pops = 45 }
					not = { num_pops = 50 }
					not = { num_pops = 55 }
					not = { num_pops = 60 }
					not = { num_pops = 65 }
					not = { num_pops = 70 }
					not = { num_pops = 75 }
					not = { num_pops = 80 }
					not = { num_pops = 85 }
				}
				set_timed_planet_flag = {
					flag = recent_resettlement_check
					days = 90
				}
				random_owned_pop = {
					limit = {
						is_unemployed = yes
						not = { has_pop_flag = just_resettled }
					}
					save_event_target_as = jobless_pop_to_resettle
				}
			}
			if = {
				limit = {
					exists = event_target:jobless_pop_to_resettle
				}
				random_owned_planet = {
					limit = {
						is_colony = yes
						not = { has_planet_flag = recent_resettlement_check }
						free_jobs > 1
					}
					save_event_target_as = auto_resettle_destination
					set_timed_planet_flag = {
						flag = recent_resettlement_check
						days = 30
					}
				}
				if = {
					limit = {
						exists = event_target:auto_resettle_destination
					}
					event_target:jobless_pop_to_resettle = { 
						set_timed_pop_flag = {
							flag = just_resettled
							days = 360
						}
					}
					resettle_pop = {
						pop = event_target:jobless_pop_to_resettle
						planet = event_target:auto_resettle_destination
					}
					event_target:jobless_pop_to_resettle = { 
						clear_pop_category = yes
					}
				}			
			}
		}
	}
}

event = {
	id = aihealthcheck.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {		
		if = {
			limit = {
				years_passed < 150
			}
			random_list = {
				50 = {}
				50 = {
					every_country = {
						limit = {
							is_ai = yes
							is_machine_empire = yes
							is_end_game_healthy_machine = no
							is_country_type = default
						}
						save_event_target_as = healthcheckedcountry
						# Outposts with an empty building slot
						if = {
							limit = { is_at_war = no }
							add_building_to_random_outpost_machine = yes
							add_building_to_random_outpost_machine = yes
						}
						
						random_owned_planet = {
							limit = {
								machine_planet_needs_health_check = yes
							}
							set_timed_planet_flag = {
								flag = pf_health_checked
								days = 90
							}
							add_modifier = {
								modifier = health_checking
								days = 90
							}
							
							# Energy crisis
							if = {
								limit = { owner = { has_monthly_income = { resource = energy value < 50 }}}
								owner = {
									give_technology = { message = no tech = tech_power_hub_1 }
								}
								if = {
									limit = { has_free_generator_land = yes }
									add_district = district_generator
								}
								if = {
									limit = {
										num_pops > 14
										free_building_slots > 0 
									}
									if = {
										limit = {
											not = { has_building = building_energy_grid }
											not = { has_building = building_energy_nexus }
											num_districts = { type = district_generator value > 0 }
										}
										add_building = building_energy_grid
									}										
									else_if = {
										limit = {
											owner = { has_monthly_income = { resource = sr_actinides value > 2 }}
										}
										add_building = building_nuclear_plant
									}
									else_if = {
										limit = {
											owner = { has_monthly_income = { resource = sr_natural_fuels value > 3 }}
										}
										add_building = building_fuels_power_plant
									}
								}
							}
							
							# Actinides and Fuels deficits fix
							if = {
								limit = {
									owner = { has_monthly_income = { resource = energy value > 100 }}
									num_pops > 19
								}
								# Natural fuels over-use fix
								if = {
									limit = {
										owner = { has_monthly_income = { resource = sr_natural_fuels value < 1 }}
										free_jobs > 3
										has_building = building_fuels_power_plant
									}
									remove_building = building_fuels_power_plant
								}
								
								# Actinides over-use fix
								if = {
									limit = {
										owner = { has_monthly_income = { resource = sr_actinides value < 1 }}
										free_jobs > 3
										has_building = building_nuclear_plant
									}
									remove_building = building_nuclear_plant
								}
							}
							
							# LANs instead of Nexus fix
							if = {
								limit = {
									num_pops > 4
									free_housing > 4
									num_districts = { type = district_nexus value > 1 }
									num_districts = { type = district_local_network value < 2 }
									num_free_districts = { type = district_local_network value > 1 }
								}
								remove_district = district_nexus
								add_district = district_local_network
								add_district = district_local_network
							}
							
							# Prioritise energy districts
							# Remove other stuff to free up pops
							if = {
								limit = {
									has_free_generator_land = yes
									owner = { has_monthly_income = { resource = energy value < 25 }}
								}
								if = {
									limit = { has_building = building_factory_1 }
									add_district = district_generator
									remove_building = building_factory_1
								}
								else_if = {
									limit = { has_building = building_research_lab_1 }
									add_district = district_generator
									remove_building = building_research_lab_1
								}
								else_if = {
									limit = { num_buildings = { type = building_foundry_1 value > 1 }}
									add_district = district_generator
									remove_building = building_foundry_1
								}
								else_if = {
									limit = {
										num_districts = { type = district_mining value > 0 }
										owner = { has_monthly_income = { resource = minerals value > 50 }}
									}
									remove_district = district_mining
									add_district = district_generator
								}
								else_if = {
									limit = { free_district_slots > 5 }
									add_district = district_generator
								}
							}
							
							# Minerals crisis
							if = { 
								limit = { owner = { has_monthly_income = { resource = minerals value < 25 }}}				
								owner = {
									give_technology = { message = no tech = tech_space_mining_1 }
									give_technology = { message = no tech = tech_space_mining_2 }					
								}
								if = { 
									limit = { 
										has_free_mining_land = yes 
										free_district_slots > 0
									}
									add_district = district_mining
									# Free some jobs and minerals consumption
									if = {
										limit = { has_building = building_factory_1 }
										remove_building = building_factory_1
									}
									else_if = {
										limit = { has_building = building_foundry_1 }
										remove_building = building_foundry_1
									}
									else_if = {
										limit = {
											free_housing > 2
											num_districts = { type = district_industrialised value > 1 }
										}
										remove_district = district_industrialised
									}
									else_if = {
										limit = {
											num_districts = { type = district_generator value > 1 }
											owner = { has_monthly_income = { resource = energy value > 50 }}
										}
										remove_district = district_generator
									}														
								}
							}
							
							# Severe minerals crisis and nothing to mine. Get rid of minerals consumers.
							if = { 
								limit = {
									has_free_mining_land = no
									owner = { has_monthly_income = { resource = minerals value < 10 }}
									free_jobs > 2
								}
								if = {
									limit = { has_building = building_factory_1 }
									remove_building = building_factory_1
								}
								else_if = {
									limit = { has_building = building_foundry_1 }
									remove_building = building_foundry_1
								}
								else_if = {
									limit = {
										free_housing > 2
										num_districts = { type = district_industrialised value > 1 }
									}
									remove_district = district_industrialised
								}					
							}
							
							# Housing shortage
							if = {
								limit = {
									free_housing < 3
									free_building_slots > 1
									planet_devastation < 1
								}
								add_building = building_drone_storage
							}
							else_if = {
								limit = {
									free_housing < 2
									planet_devastation < 1
									num_free_districts = { type = district_nexus value > 0 }
								}
								add_district = district_nexus
							}				
							
							# Unemployment
							if = {
								limit = { not_enough_free_machine_jobs = yes }
								if = {
									limit = {
										has_free_generator_land = yes
										owner = { has_monthly_income = { resource = energy value < 100 }}
									}
									add_district = district_generator
								}					
								else_if = {
									limit = {
										owner = { country_uses_food = yes }
										has_free_farming_land = yes
										has_low_income_food = yes
									}
									add_district = district_farming
								}
								else_if = {
									limit = {
										has_free_mining_land = yes
										owner = { has_monthly_income = { resource = minerals value < 100 }}
									}
									add_district = district_mining
								}
								else_if = {
									limit = {
										has_free_industrialised_land = yes
										owner = { has_monthly_income = { resource = minerals value > 100 }}
									}
									add_district = district_industrialised
								}
							}
							
							if = {
								limit = { 
									not_enough_free_machine_jobs = yes
									free_building_slots > 0
									owner = { has_monthly_income = { resource = energy value > -1 }}
								}					
								if = {
									limit = { planet_crime > 0 }
									add_building = building_sentinel_posts
								}				
								else_if = {
									limit = { free_housing > 0 }
									add_building = building_research_lab_1
								}
							}
							
							# Empty building slots
							if = {
								limit = {
									free_jobs < 10
									free_building_slots > 1
									owner = { has_monthly_income = { resource = energy value > -1 }}
								}
								if = {
									limit = { owner = { has_monthly_income = { resource = minerals value > 100 }}}
									add_building = building_foundry_1
								}
								else_if = {
									limit = { not = { has_building = building_maintenance_depot }}
									add_building = building_maintenance_depot
								}
								else_if = {
									limit = { not = { has_building = building_sentinel_posts }}
									add_building = building_sentinel_posts
								}
								else_if = {
									limit = { need_more_housing_soon = yes }
									add_building = building_drone_storage
								}
								else = { add_building = building_research_lab_1 }
							}
							if = {
								limit = { free_building_slots > 2 }
								if = {
									limit = { owner = { has_monthly_income = { resource = minerals value > 100 }}}
									add_building = building_foundry_1
								}
								else_if = {
									limit = { not = { has_building = building_maintenance_depot }}
									add_building = building_maintenance_depot
								}
								else_if = {
									limit = { not = { has_building = building_sentinel_posts }}
									add_building = building_sentinel_posts
								}
								else_if = {
									limit = { need_more_housing_soon = yes }
									add_building = building_drone_storage
								}
								else = {
									add_building = building_research_lab_1
								}
							}
						}				
					}
					
					every_country = {
						limit = {
							is_ai = no
							is_regular_empire = yes
							is_country_type = default
						}
						check_waste_management_bonus = yes
						random_list = {
							95 = {}
							5 = {
								random_owned_pop = {
									limit = {
										not = { has_modifier = pop_qualified }
										not = { has_modifier = pop_transcendent }
										not = { has_trait = trait_mechanical }
										is_enslaved = no
										has_job = student
									}
									add_modifier = {
										modifier = pop_qualified
										days = -1
									}
									remove_modifier = pop_inexperienced
								}
							}			
						}
					}
					
					every_country = {
						limit = {
							is_country_type = default
						}
						# District fixing
						random_owned_planet = {
							limit = {
								is_normal_planet_class = yes
								or = {
									has_planet_flag = pf_hide_city
									has_planet_flag = pf_hide_generator
									has_planet_flag = pf_hide_farming				
								}
								is_colony = yes
							}
							remove_planet_flag = pf_hide_city
							remove_planet_flag = pf_hide_generator
							remove_planet_flag = pf_hide_farming
							# Hostile to gaia from abandoned terraforming fix
							if = {
								limit = {
									is_planet_class = pc_gaia
								}				
								add_deposit = d_tempestous_mountain
								add_deposit = d_bountiful_plains
								add_deposit = d_green_hills
							}
						}			
					}

					every_country = {
						limit = {
							is_ai = yes
							is_regular_empire = yes
							is_country_type = default
						}
						check_waste_management_bonus = yes
					}
					
					every_country = {
						limit = {
							is_ai = yes
							is_regular_empire = yes
							is_country_type = default
							is_end_game_healthy_regular = no
						}
						save_event_target_as = healthcheckedcountry
						
						if = {
							limit = { tanked_energy = yes }
							every_owned_leader = {
								limit = {
									leader_class = admiral
									has_level < 2
								}
								set_age = 900
							}
							every_owned_ship = {
								limit = {
									is_ship_size = nanite_space_dragon_baby
								}
								fleet = { destroy_fleet = this }
							}
						}
						
						# Starbases
						if = {
							limit = { is_at_war = no }
							add_building_to_random_outpost = yes
							add_building_to_random_outpost = yes
							fill_out_random_starport = yes
							upgrade_random_starhold = yes
						}
						
						# More comm district spam fixing
						random_owned_planet = {
							limit = {
								owner = { not_fanatical = no }
								is_colony = yes
								not = { has_planet_flag = pf_comm_districts_fixed }
								has_some_community_type_districts = yes				
							}
							set_planet_flag = pf_comm_districts_fixed
							clear_district_flags = yes
							reswap_comm_districts = yes
						}
						
						# HEALTH CHECK
						random_owned_planet = {
							limit = { regular_planet_needs_health_check = yes }				
							set_random_healthcheck_flag = yes
							
							# Student job can make pop qualified
							random_list = {
								95 = {}
								5 = {
									random_pop = {
										limit = {
											not = { has_modifier = pop_qualified }
											not = { has_modifier = pop_transcendent }
											not = { has_trait = trait_mechanical }
											is_enslaved = no
											has_job = student
										}
										make_pop_qualified = yes
									}
								}			
							}
							
							# Remove martial law like you were supposed to
							check_end_martial_law = yes
							
							# Starbases in a colonised system
							upgrade_colony_starbase = yes
							
							# Community District spam fix
							if = {
								limit = {
									not = { has_planet_flag = pf_more_comm_spam_fixing_2 }
									free_jobs > 7
									free_housing > 7
									has_too_many_comm_type_districts = yes
								}
								set_planet_flag = pf_more_comm_spam_fixing_2
								remove_excess_comm_districts = yes
							}
							
							# Industrial District spam fix
							fix_industrial_district_spam = yes
							
							# Energy deficit
							fix_energy_deficit = yes
							
							# Minerals deficit and alloys or energy surplus
							fix_minerals_deficit = yes
							
							# Crime and Instability
							if = { limit = { planet_is_unlawful = yes } fix_crime_instability = yes	}
							
							# Amenities
							if = { limit = { planet_is_bored = yes } fix_amenities = yes }
							
							# Create More Jobs
							if = { limit = { planet_is_ready_to_grow = yes } fix_low_vacancies = yes }
							
							# Unemployment
							if = { limit = { any_owned_pop = { is_unemployed = yes }} fix_unemployment = yes }
							
							# Research > Alloys when not at war
							if = {
								limit = {
									has_building = building_foundry_1
									owner = { is_at_war = no }
									owner = { has_monthly_income = { resource = alloys value > 20 }}
									owner = { has_monthly_income = { resource = consumer_goods value > 20 }}
								}
								remove_building = building_foundry_1
								add_building = building_research_lab_1
							}
							
							# CGs > Alloys when not at war
							if = {
								limit = {
									has_building = building_foundry_1
									owner = { is_at_war = no }
									owner = { has_monthly_income = { resource = alloys value > 25 }}
									owner = { has_monthly_income = { resource = consumer_goods value < 25 }}
									owner = { country_uses_consumer_goods = yes }
								}
								remove_building = building_foundry_1
								add_building = building_factory_1
							}

							# Alloys > CGs when at war
							if = {
								limit = {
									has_building = building_factory_1
									owner = { is_at_war = yes }
									owner = { has_monthly_income = { resource = alloys value < 50 }}
									owner = { has_monthly_income = { resource = consumer_goods value > 20 }}
								}
								remove_building = building_factory_1
								add_building = building_foundry_1
							}
							
							# Alloys > Research when at war
							if = {
								limit = {
									has_building = building_research_lab_1
									owner = { is_at_war = yes }
									owner = { has_monthly_income = { resource = alloys value < 50 }}
									owner = { has_monthly_income = { resource = minerals value > 25 }}
								}
								remove_building = building_research_lab_1
								add_building = building_foundry_1
							}
							
							# Uncleared blockers - just get rid of them
							if = {
								limit = { free_district_slots < 2 }
								clear_blockers = yes
							}
							
							# Economic Fine Tuning - surplus is wasting space
							if = {
								limit = {
									free_housing > 3
									free_jobs > 3
									free_district_slots < 2
									not = { any_owned_pop = { is_unemployed = yes }}
								}
								if = {
									limit = {
										has_district = district_industrialised
										owner = { 
											has_monthly_income = { resource = consumer_goods value > 150 }
											has_monthly_income = { resource = alloys value > 75 }
											resource_stockpile_compare = { resource = consumer_goods value > 5000 }
											resource_stockpile_compare = { resource = alloys value > 2500 }
										}
									}
									remove_district = district_industrialised
								}
							}
							if = {
								limit = {
									free_housing > 4
									free_jobs > 3
									free_district_slots < 2
									not = { any_owned_pop = { is_unemployed = yes }}
								}
								if = {
									limit = {
										has_district = district_farming
										owner = {
											or = {
												country_uses_food = no
												and = {
													has_monthly_income = { resource = food value > 150 }
													resource_stockpile_compare = { resource = food value > 5000 }
												}
											}
										}
									}
									remove_district = district_farming
								}
							}
							if = {
								limit = {
									free_housing > 3
									free_jobs > 3
									free_district_slots < 2
									not = { any_owned_pop = { is_unemployed = yes }}
								}
								if = {
									limit = {
										has_district = district_mining
										owner = {
											has_monthly_income = { resource = minerals value > 500 }
											resource_stockpile_compare = { resource = minerals value > 12000 }
										}
									}
									remove_district = district_mining
								}
							}
							if = {
								limit = {
									free_housing > 3
									free_jobs > 3
									free_district_slots < 2
									not = { any_owned_pop = { is_unemployed = yes }}
								}
								if = {
									limit = {
										has_district = district_generator
										owner = {
											has_monthly_income = { resource = energy value > 250 }
											resource_stockpile_compare = { resource = energy value > 10000 }
										}
									}
									remove_district = district_generator
								}
							}
							
							# Housing
							if = {
								limit = {
									free_housing > 8
									not = { has_planet_flag = pf_mega_cities }
									num_districts = { type = district_city value > 5 }
									num_pops > 90
								}
								set_planet_flag = pf_mega_cities
								owner = { add_resource = { minerals = -4000 }}
							}
							if = {
								limit = {
									needs_more_housing = yes
									not = { has_planet_flag = pf_mega_cities }
									num_districts = { type = district_city value > 7 }
								}
								set_planet_flag = pf_mega_cities
								owner = { add_resource = { minerals = -6000 }}
							}
							else_if = {
								limit = {
									needs_more_housing = yes
									not = { has_planet_flag = pf_mega_cities }
									num_free_districts = { type = district_city value > 0 }
								}
								add_district = district_city
							}
							else_if = {
								limit = {
									needs_more_housing = yes
									has_planet_flag = pf_mega_cities
									num_free_districts = { type = district_megacity value > 0 }
								}
								add_district = district_megacity
							}
							else_if = {
								limit = { free_housing < -1 }
								clear_blockers = yes
							}
							
							# Overcrowding - pointless unemployed pops lags up the game
							if = {
								limit = {
									any_owned_pop = { is_unemployed = yes }
									num_pops > 93
								}
								if = {
									limit = { free_building_slots > 1 }
									if = {
										limit = {
											exists = owner
											owner = { is_at_war = yes }
										}
										add_building = building_stronghold
									}
									else_if = {
										limit = { free_amenities < 50 }
										add_building = building_holo_theatres
									}
									else_if = {
										limit = { planet_crime > 0 }
										add_building = building_precinct_house						
									}
									else = {
										random_list = {
											25 = {
												add_building = building_commercial_zone
											}
											25 = {
												add_building = building_research_lab_1
											}
											25 = {
												add_building = building_mining_consortium
											}
											25 = {
												add_building = building_energy_consortium
											}
										}
									}
								}
								else = {
									kill_the_unemployed = yes
									kill_the_unemployed = yes
									kill_the_unemployed = yes
								}
							}
							
							# Homeless pops are pointless
							if = {
								limit = {
									free_housing < -2
									num_pops > 92
									free_building_slots < 2
									free_district_slots < 2					
								}
								random_owned_pop = {
									limit = {
										or = {
											is_unemployed = yes
											has_job = job_clerk
										}
									}
									kill_pop = yes
								}
								random_owned_pop = {
									limit = {
										or = {
											is_unemployed = yes
											has_job = job_clerk
										}
									}
									kill_pop = yes
								}
								if = {
									limit = {
										num_districts = { type = district_city value > 3 }
										not = { has_planet_flag = pf_mega_cities }
										exists = owner
										owner = {
											resource_stockpile_compare = {
												resource = minerals
												value > 5000
											}
										}
									}
									set_planet_flag = pf_mega_cities
									add_district = district_megacity
									owner = { add_resource = { minerals = -4000 }}
								}
							}
							
							# Free housing and free building slots means convert districts to buildings
							if = {
								limit = {
									free_building_slots > 1
									free_housing > 3
								}
								if = {
									limit = {
										num_districts = { type = district_industrialised value > 0 }
										owner = { has_monthly_income = { resource = consumer_goods value < 25 }}
										owner = { country_uses_consumer_goods = yes }
									}
									remove_district = district_industrialised
									add_building = building_factory_1
								}						
							}
							if = {
								limit = {
									free_building_slots > 1
									free_housing > 3
								}
								if = {
									limit = {
										num_districts = { type = district_generator value > 0 }
										owner = { has_monthly_income = { resource = energy value < 50 }}
									}
									remove_district = district_generator
									add_building = building_energy_consortium
								}						
							}
							if = {
								limit = {
									free_building_slots > 1
									free_housing > 4
								}
								if = {
									limit = {
										num_districts = { type = district_mining value > 0 }
										owner = { has_monthly_income = { resource = minerals value < 200 }}
									}
									remove_district = district_mining
									add_building = building_mining_consortium
								}						
							}
							
							# If there is a need for jobs and has emergency buildings, replace them
							if = {
								limit = {
									has_building = building_goods_bank
									free_jobs < 3
									owner = { country_uses_consumer_goods = yes }
								}
								remove_building = building_goods_bank
								add_building = building_factory_1						
							}
							if = {
								limit = {
									has_building = building_food_bank
									num_free_districts = { type = district_farming value > 0 }
									free_jobs < 3
									exists = owner
									owner = { country_uses_food = yes }
								}
								remove_building = building_food_bank
								add_district = district_farming						
							}
							
							# Stop stockpiling like you were supposed to
							if = {
								limit = { 
									has_planet_flag = preserving_fuels
									owner = {
										resource_stockpile_compare = {
											resource = sr_natural_fuels
											value > 3000
										}
										resource_stockpile_compare = {
											resource = energy
											value < 10000
										}
										has_monthly_income = {
											resource = sr_natural_fuels
											value > -1
										}
									}
								}
								remove_planet_flag = preserving_fuels
								remove_modifier = plm_preserving_fuels
							}
							if = {
								limit = { 
									has_planet_flag = preserving_ice
									owner = {
										resource_stockpile_compare = {
											resource = sr_ice
											value > 2000
										}
										resource_stockpile_compare = {
											resource = food
											value < 10000
										}
										has_monthly_income = {
											resource = sr_ice
											value > -1
										}
									}
								}
								remove_planet_flag = preserving_ice
								remove_modifier = plm_preserving_ice
							}
							if = {
								limit = { 
									has_planet_flag = preserving_actinides
									owner = {
										resource_stockpile_compare = {
											resource = sr_actinides
											value > 2000
										}
										resource_stockpile_compare = {
											resource = energy
											value < 10000
										}
										has_monthly_income = {
											resource = sr_actinides
											value > -1
										}
									}	
								}
								remove_planet_flag = preserving_actinides
								remove_modifier = plm_preserving_actinides
							}
							
							# Surplus getting in the way
							if = {
								limit = {
									free_housing > 9
									num_districts = { type = district_city value > 0 }
									free_jobs > 2
								}
								remove_district = district_city
							}
							else_if = {
								limit = {
									free_housing > 9
									num_districts = { type = district_city value > 0 }
									free_jobs < 1
									free_district_slots < 1
									exists = owner
									owner = { country_uses_food = yes }
								}
								remove_district = district_city
								random_list = {
									33 = { add_district = district_farming }
									33 = { add_district = district_mining }
									33 = { add_district = district_generator }
								}
							}				
							else_if = {
								limit = {
									free_housing > 15
									num_districts = { type = district_megacity value > 0 }
									free_jobs > 4
								}
								remove_district = district_megacity
							}
							else_if = {
								limit = {
									free_housing > 15
									num_districts = { type = district_megacity value > 0 }
									free_jobs < 1
									free_district_slots < 1
									exists = owner
									owner = { country_uses_food = yes }
								}
								remove_district = district_megacity
								random_list = {
									33 = { add_district = district_farming }
									33 = { add_district = district_mining }
									33 = { add_district = district_generator }
								}
							}
							
							if = {
								limit = {
									has_building = building_commercial_zone
									free_jobs > 4
									free_amenities > 25
									owner = {
										has_monthly_income = {
											resource = energy
											value > 150
										}
										has_monthly_income = {
											resource = consumer_goods
											value > 75
										}
									}
								}
								remove_building = building_commercial_zone
							}
							
							# Shortages rectified by removing surplus
							if = {
								limit = {
									num_districts = { type = district_mining value > 0 }
									num_free_districts = { type = district_farming value > 0 }
									owner = {
										has_monthly_income = { resource = minerals value > 50 }
										resource_stockpile_compare = { resource = minerals value > 1000 }
										has_monthly_income = { resource = food value < 2 }
										country_uses_food = yes
									}
								}
								remove_district = district_mining
								add_district = district_farming
							}
							if = {
								limit = {
									num_districts = { type = district_mining value > 0 }
									has_building = building_goods_bank
									owner = { country_uses_consumer_goods = yes }
									owner = {
										has_monthly_income = {
											resource = minerals
											value > 100
										}
										resource_stockpile_compare = {
											resource = minerals
											value > 2000
										}
										has_monthly_income = {
											resource = consumer_goods
											value < 6
										}
									}
								}
								remove_district = district_mining
								remove_building = building_goods_bank
								add_building = building_factory_1
							}
							if = {
								limit = {
									num_districts = { type = district_mining value > 0 }
									num_free_districts = { type = district_industrialised value > 0 }
									owner = {
										has_monthly_income = {
											resource = minerals
											value > 120
										}
										resource_stockpile_compare = {
											resource = minerals
											value > 5000
										}
										has_monthly_income = {
											resource = consumer_goods
											value < 2
										}
									}
								}
								remove_district = district_mining
								add_district = district_industrialised
							}						
							if = {
								limit = {
									has_district = district_generator
									num_free_districts = { type = district_farming value > 0 }
									owner = {
										country_uses_food = yes
										has_monthly_income = {
											resource = energy
											value > 100
										}
										resource_stockpile_compare = {
											resource = energy
											value > 500
										}
										has_monthly_income = {
											resource = food
											value < 2
										}
									}
								}
								remove_district = district_generator
								add_district = district_farming
							}
							if = {
								limit = {
									has_district = district_farming
									num_free_districts = { type = district_generator value > 0 }
									owner = {
										has_monthly_income = {
											resource = energy
											value < 2
										}
										resource_stockpile_compare = {
											resource = energy
											value < 500
										}
										has_monthly_income = {
											resource = food
											value > 100
										}
										resource_stockpile_compare = {
											resource = food
											value > 500
										}
									}
								}
								remove_district = district_farming
								add_district = district_generator
							}
							
							# Minerals shortages are rare
							if = {
								limit = {
									num_free_districts = { type = district_mining value > 0 }
									free_jobs < 5
									num_pops > 25
									owner = { has_monthly_income = { resource = minerals value < 25 }}
								}
								add_district = district_mining
							}
							if = {
								limit = {
									has_building = building_factory_1
									owner = {
										has_monthly_income = {
											resource = minerals
											value < 50
										}
									}
									owner = {
										has_monthly_income = {
											resource = consumer_goods
											value > 75
										}
									}
								}
								remove_building = building_factory_1
								add_building = building_mining_consortium
							}
							if = {
								limit = {
									num_free_districts = { type = district_mining value > 0 }
									num_districts = { type = district_industrialised value > 0 }
									owner = {
										has_monthly_income = {
											resource = minerals
											value < 50
										}
									}
									owner = {
										has_monthly_income = {
											resource = consumer_goods
											value > 75
										}
									}
								}
								remove_district = district_industrialised
								add_district = district_mining
							}
							
							# Consumer Goods deficit
							if = {
								limit = {
									has_building = building_mining_consortium
									owner = { country_uses_consumer_goods = yes }
									owner = {
										has_monthly_income = {
											resource = consumer_goods
											value < 5
										}
									}
									owner = {
										has_monthly_income = {
											resource = minerals
											value > 150
										}
									}
								}
								remove_building = building_mining_consortium
								add_building = building_factory_1
							}
							if = {
								limit = {
									num_districts = { type = district_generator value > 1 }
									free_housing > 3
									free_building_slots > 0
									owner = { has_monthly_income = { resource = consumer_goods value < 10 }}
									owner = { has_monthly_income = { resource = energy value > 150 }}
									owner = { country_uses_consumer_goods = yes }
								}
								remove_district = district_generator
								add_building = building_factory_1
							}
							if = {
								limit = {
									has_building = building_research_lab_1
									has_tanked_goods = yes
									owner = { country_uses_consumer_goods = yes }
								}
								remove_building = building_research_lab_1
								add_building = building_factory_1
							}
							
							# Alloys deficit
							if = {
								limit = {
									has_building = building_mining_consortium
									owner = {
										has_monthly_income = {
											resource = alloys
											value < 5
										}
									}
									owner = {
										has_monthly_income = {
											resource = minerals
											value > 150
										}
									}
								}
								remove_building = building_mining_consortium
								add_building = building_foundry_1
							}
							if = {
								limit = {
									num_districts = { type = district_generator value > 1 }
									free_housing > 3
									free_building_slots > 0
									owner = {
										has_monthly_income = {
											resource = alloys
											value < 5
										}
									}
									owner = {
										has_monthly_income = {
											resource = energy
											value > 150
										}
									}
								}
								remove_district = district_generator
								add_building = building_foundry_1
							}
							
							# Alloys and CGs deficit
							if = {
								limit = {
									free_housing > 1
									num_districts = { type = district_generator value > 1 }
									num_free_districts = { type = district_industrialised value > 0 }
									owner = {
										has_monthly_income = {
											resource = energy
											value > 150
										}
									}
									owner = {
										has_monthly_income = {
											resource = alloys
											value < 10
										}
									}
									owner = {
										has_monthly_income = {
											resource = consumer_goods
											value < 10
										}
									}
								}
								remove_district = district_generator
								add_district = district_industrialised
							}
							
							# District spam
							if = {
								limit = {
									has_too_many_comm_districts = yes
								}
								remove_district = district_community
								remove_district = district_labour_camp
								remove_district = district_markettowns
								remove_district = district_parish
								remove_district = district_securityzone
								remove_district = district_warrior_house
								remove_district = district_campus
								remove_district = district_culture_commune
							}

							# Homeworld with too many empty building slots
							if = {
								limit = {
									or = {
										is_homeworld = yes
										is_capital = yes
									}
									free_building_slots > 3
									num_pops > 50
									owner = { has_monthly_income = { resource = minerals value < 200 }}
								}
								add_building = building_mining_consortium
							}
							if = {
								limit = {
									or = {
										is_homeworld = yes
										is_capital = yes
									}
									free_building_slots > 3
									num_pops > 50
									owner = { has_monthly_income = { resource = energy value < 100 }}
								}
								add_building = building_energy_consortium
							}				
							if = {
								limit = {
									or = {
										is_homeworld = yes
										is_capital = yes
									}
									free_building_slots > 3
									free_jobs < 3
									num_pops > 50
								}
								add_building = building_research_lab_1
							}
							if = {
								limit = {
									or = {
										is_homeworld = yes
										is_capital = yes
									}
									free_building_slots > 2
									num_pops > 50
									owner = { has_monthly_income = { resource = minerals value < 200 }}
								}
								add_building = building_mining_consortium
							}
							if = {
								limit = {
									or = {
										is_homeworld = yes
										is_capital = yes
									}
									free_building_slots > 2
									num_pops > 50
									owner = { has_monthly_income = { resource = energy value < 100 }}
								}
								add_building = building_energy_consortium
							}				
							if = {
								limit = {
									or = {
										is_homeworld = yes
										is_capital = yes
									}
									free_building_slots > 2
									free_jobs < 3
									num_pops > 50
								}
								add_building = building_research_lab_1
							}
							if = {
								limit = {
									or = {
										is_homeworld = yes
										is_capital = yes
									}
									free_building_slots > 2
									free_jobs < 10
									num_pops > 50
								}
								add_building = building_research_lab_1
							}				

							# Last resort
							if = {
								limit = { situation_fubar = yes }
								kill_the_redundant = yes
							}
						}
					}
				}
			}
		}
	}
}

event = {
	id = aihealthcheck.1
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {		
		every_country = {
			limit = {
				is_ai = yes
				is_machine_empire = yes
				is_end_game_healthy_machine = no
				is_country_type = default
			}
			save_event_target_as = healthcheckedcountry
			# Outposts with an empty building slot
			if = {
				limit = { is_at_war = no }
				add_building_to_random_outpost_machine = yes
				add_building_to_random_outpost_machine = yes
			}
			
			random_owned_planet = {
				limit = {
					machine_planet_needs_health_check = yes
				}
				set_timed_planet_flag = {
					flag = pf_health_checked
					days = 90
				}
				add_modifier = {
					modifier = health_checking
					days = 90
				}
				
				# Energy crisis
				if = {
					limit = { owner = { has_monthly_income = { resource = energy value < 10 }}}
					owner = {
						give_technology = { message = no tech = tech_power_hub_1 }
					}
					if = {
						limit = {
							free_building_slots > 0
							not = { has_building = building_energy_grid }
							not = { has_building = building_energy_nexus }
						}
						add_building = building_energy_grid
					}
				}
				if = {
					limit = {
						has_free_generator_land = no
						owner = { has_monthly_income = { resource = energy value < 25 }}
						owner = { has_monthly_income = { resource = sr_actinides value > 1 }}
						free_building_slots > 0
						free_jobs < 5
					}
					add_building = building_nuclear_plant
				}
				else_if = {
					limit = {
						owner = { has_monthly_income = { resource = energy value < 25 }}
						owner = { has_monthly_income = { resource = sr_natural_fuels value > 1 }}
						free_building_slots > 0
					}
					add_building = building_fuels_power_plant
				}
				
				if = {
					limit = {
						has_free_generator_land = yes
						owner = { has_monthly_income = { resource = energy value < 10 }}
					}
					if = {
						limit = { has_building = building_factory_1 }
						add_district = district_generator
						remove_building = building_factory_1
					}
					else_if = {
						limit = { has_building = building_research_lab_1 }
						add_district = district_generator
						remove_building = building_research_lab_1
					}
					else_if = {
						limit = { num_buildings = { type = building_foundry_1 value > 1 }}
						add_district = district_generator
						remove_building = building_foundry_1
					}
					else_if = {
						limit = {
							num_districts = { type = district_mining value > 0 }
							owner = { has_monthly_income = { resource = minerals value > 25 }}
						}
						remove_district = district_mining
						add_district = district_generator
					}
					else_if = {
						limit = { free_district_slots > 5 }
						add_district = district_generator
					}
					else_if = {
						limit = { 
							has_building = building_research_lab_1
							free_jobs > 0
						}
						remove_building = building_research_lab_1
					}
					else_if = {
						limit = { num_pops > 20 }
						random_owned_pop = {
							limit = {
								nor = {
									has_job = mining_drone
									has_job = technician_drone
								}
							}
							kill_pop = yes
						}
					}
				}
				
				# Minerals crisis
				if = { 
					limit = { owner = { has_monthly_income = { resource = minerals value < 10 }}}				
					owner = {
						give_technology = { message = no tech = tech_space_mining_1 }
						give_technology = { message = no tech = tech_space_mining_2 }					
					}
				}
				if = { 
					limit = {
						has_free_mining_land = yes
						owner = { has_monthly_income = { resource = minerals value < 10 }}
					}
					if = {
						limit = { has_building = building_factory_1 }
						remove_building = building_factory_1
					}
					else_if = {
						limit = { has_building = building_foundry_1 }
						remove_building = building_foundry_1
					}
					else_if = {
						limit = {
							free_housing > 2
							num_districts = { type = district_industrialised value > 0 }
						}
						remove_district = district_industrialised
					}
					else_if = {
						limit = {
							num_districts = { type = district_generator value > 0 }
							owner = { has_monthly_income = { resource = energy value > 25 }}
						}
						remove_district = district_generator
						add_district = district_mining
					}					
					
					if = {
						limit = { free_district_slots > 5 }
						add_district = district_mining
					}
				}
				
				if = { 
					limit = {
						has_free_mining_land = no
						owner = { has_monthly_income = { resource = minerals value < 10 }}
					}
					if = {
						limit = {
							free_jobs > 2
							has_building = building_factory_1 
						}
						remove_building = building_factory_1
					}
					else_if = {
						limit = {
							free_jobs > 2
							has_building = building_foundry_1 
						}
						remove_building = building_foundry_1
					}
					else_if = {
						limit = {
							free_jobs > 2
							free_housing > 2
							num_districts = { type = district_industrialised value > 0 }
						}
						remove_district = district_industrialised
					}					
				}
				
				# Housing shortage
				if = {
					limit = {
						free_housing < 3
						free_building_slots > 1
						planet_devastation < 1
					}
					add_building = building_drone_storage
				}
				else_if = {
					limit = {
						free_housing < 2
						planet_devastation < 1
						num_free_districts = { type = district_nexus value > 0 }
					}
					add_district = district_nexus
				}				
				
				# Unemployment
				if = {
					limit = { not_enough_free_machine_jobs = yes }
					if = {
						limit = {
							has_free_generator_land = yes
							owner = { has_monthly_income = { resource = energy value < 100 }}
						}
						add_district = district_generator
					}					
					else_if = {
						limit = {
							owner = { country_uses_food = yes }
							has_free_farming_land = yes
							has_low_income_food = yes
						}
						add_district = district_farming
					}
					else_if = {
						limit = {
							has_free_mining_land = yes
							owner = { has_monthly_income = { resource = minerals value < 100 }}
						}
						add_district = district_mining
					}
					else_if = {
						limit = {
							has_free_industrialised_land = yes
							owner = { has_monthly_income = { resource = minerals value > 100 }}
						}
						add_district = district_industrialised
					}
				}
				
				if = {
					limit = { 
						not_enough_free_machine_jobs = yes
						free_building_slots > 0
						owner = { has_monthly_income = { resource = energy value > -1 }}
					}					
					if = {
						limit = {
							free_amenities < 20
							not = { has_building = building_maintenance_depot }
						}
						add_building = building_maintenance_depot
					}
					else_if = {
						limit = { planet_crime > 0 }
						add_building = building_sentinel_posts
					}				
					else_if = {
						limit = { free_housing > 0 }
						add_building = building_research_lab_1
					}
				}
				
				# Empty building slots
				if = {
					limit = {
						free_jobs < 10
						free_building_slots > 1
						owner = { has_monthly_income = { resource = energy value > -1 }}
					}
					if = {
						limit = { owner = { has_monthly_income = { resource = minerals value > 100 }}}
						add_building = building_foundry_1
					}
					else_if = {
						limit = { not = { has_building = building_maintenance_depot }}
						add_building = building_maintenance_depot
					}
					else_if = {
						limit = { not = { has_building = building_sentinel_posts }}
						add_building = building_sentinel_posts
					}
					else_if = {
						limit = { need_more_housing_soon = yes }
						add_building = building_drone_storage
					}
					else = { add_building = building_research_lab_1 }
				}
				if = {
					limit = { free_building_slots > 2 }
					if = {
						limit = { owner = { has_monthly_income = { resource = minerals value > 100 }}}
						add_building = building_foundry_1
					}
					else_if = {
						limit = { not = { has_building = building_maintenance_depot }}
						add_building = building_maintenance_depot
					}
					else_if = {
						limit = { not = { has_building = building_sentinel_posts }}
						add_building = building_sentinel_posts
					}
					else_if = {
						limit = { need_more_housing_soon = yes }
						add_building = building_drone_storage
					}
					else = {
						add_building = building_research_lab_1
					}
				}
			}				
		}
		
		every_country = {
			limit = {
				is_ai = no
				is_regular_empire = yes
				is_country_type = default
			}
			check_waste_management_bonus = yes
			random_list = {
				90 = {}
				10 = {
					random_owned_pop = {
						limit = {
							not = { has_modifier = pop_qualified }
							not = { has_modifier = pop_transcendent }
							not = { has_trait = trait_mechanical }
							is_enslaved = no
							has_job = student
						}
						add_modifier = {
							modifier = pop_qualified
							days = -1
						}
						remove_modifier = pop_inexperienced
					}
				}			
			}
		}
		
		every_country = {
			limit = {
				is_country_type = default
			}
			# District fixing
			random_owned_planet = {
				limit = {
					is_normal_planet_class = yes
					or = {
						has_planet_flag = pf_hide_city
						has_planet_flag = pf_hide_generator
						has_planet_flag = pf_hide_farming				
					}
					is_colony = yes
				}
				remove_planet_flag = pf_hide_city
				remove_planet_flag = pf_hide_generator
				remove_planet_flag = pf_hide_farming
				# Hostile to gaia from abandoned terraforming fix
				if = {
					limit = {
						is_planet_class = pc_gaia
					}				
					add_deposit = d_tempestous_mountain
					add_deposit = d_bountiful_plains
					add_deposit = d_green_hills
				}
			}			
		}

		every_country = {
			limit = {
				is_ai = yes
				is_regular_empire = yes
				is_country_type = default
			}
			check_waste_management_bonus = yes
		}
		
		every_country = {
			limit = {
				is_ai = yes
				is_regular_empire = yes
				is_country_type = default
				is_end_game_healthy_regular = no
				num_owned_planets > 2
			}
			save_event_target_as = healthcheckedcountry
			
			if = {
				limit = { tanked_energy = yes }
				every_owned_leader = {
					limit = {
						leader_class = admiral
						has_level < 2
					}
					set_age = 900
				}
				every_owned_ship = {
					limit = {
						is_ship_size = nanite_space_dragon_baby
					}
					fleet = { destroy_fleet = this }
				}
			}
			
			# Starbases
			if = {
				limit = { is_at_war = no }
				add_building_to_random_outpost = yes
				add_building_to_random_outpost = yes
				fill_out_random_starport = yes
				upgrade_random_starhold = yes
			}
			
			# More comm district spam fixing
			random_owned_planet = {
				limit = {
					owner = { not_fanatical = no }
					is_colony = yes
					not = { has_planet_flag = pf_comm_districts_fixed }
					has_some_community_type_districts = yes				
				}
				set_planet_flag = pf_comm_districts_fixed
				clear_district_flags = yes
				reswap_comm_districts = yes
			}
			
			random_owned_planet = {
				limit = { regular_planet_needs_health_check = yes }				
				set_random_healthcheck_flag = yes
				
				random_list = {
					95 = {}
					5 = {
						random_pop = {
							limit = {
								not = { has_modifier = pop_qualified }
								not = { has_modifier = pop_transcendent }
								not = { has_trait = trait_mechanical }
								is_enslaved = no
								has_job = student
							}
							add_modifier = {
								modifier = pop_qualified
								days = -1
							}
							remove_modifier = pop_inexperienced
						}
					}			
				}
				
				# Remove martial law like you were supposed to
				if = {
					limit = {
						has_modifier = martial_law
						planet_stability > 40
						owner = { is_at_war = no }
					}
					remove_modifier = martial_law
				}
				
				# Starbases in a colonised system
				upgrade_colony_starbase = yes
				
				# Community District spam fix
				if = {
					limit = {
						not = { has_planet_flag = pf_more_comm_spam_fixing_2 }
						free_jobs > 7
						free_housing > 7
						has_too_many_comm_type_districts = yes
					}
					set_planet_flag = pf_more_comm_spam_fixing_2
					remove_excess_comm_districts = yes
				}
				
				# Industrial District spam fix
				if = {
					limit = {
						free_jobs > 3
						free_housing > 3
						owner = {
							owner = { has_monthly_income = { resource = consumer_goods value > 20 }}
							owner = { has_monthly_income = { resource = alloys value > 20 }}
						}
						num_districts = { type = district_industrialised value > 2 }
					}
					remove_district = district_industrialised
				}
				
				# Energy deficit
				if = {
					limit = { owner = { has_monthly_income = { resource = energy value < 0 }}}
					if = {
						limit = {
							free_building_slots > 0
							free_jobs < 3
							free_housing > 1
						}
						add_building = building_energy_consortium
					}
					else_if = {
						limit = {
							num_free_districts = { type = district_generator value > 0 }
							free_jobs < 3
						}
						add_district = district_generator
					}
					else_if = {
						limit = {
							num_districts = { type = district_industrialised value > 0 }
							num_free_districts = { type = district_generator value > 0 }
							owner = { has_monthly_income = { resource = alloys value > 20 }}
							owner = { has_monthly_income = { resource = consumer_goods value > 20 }}
						}					
						remove_district = district_industrialised
						add_district = district_generator
					}
					else_if = {
						limit = {
							num_districts = { type = district_city value > 0 }
							free_housing > 6
						}
						remove_district = district_city
					}
					else_if = {
						limit = {
							num_districts = { type = district_mining value > 0 }
							num_free_districts = { type = district_generator value > 0 }
							owner = { has_monthly_income = { resource = minerals value > 50 }}
						}					
						remove_district = district_mining
						add_district = district_generator
					}
					else_if = {
						limit = {
							num_districts = { type = district_farming value > 0 }
							num_free_districts = { type = district_generator value > 0 }
							owner = { has_monthly_income = { resource = food value > 50 }}
						}					
						remove_district = district_farming
						add_district = district_generator
					}
					else_if = {
						limit = {
							free_district_slots < 0
							free_building_slots < 0
							free_jobs > 3
							has_building = building_commercial_zone
						}					
						remove_building = building_commercial_zone
						add_building = building_energy_consortium
					}
					else_if = {
						limit = {
							free_district_slots < 0
							free_building_slots < 0
							has_building = building_research_lab_1
						}					
						remove_building = building_research_lab_1
						add_building = building_energy_consortium
					}
					else_if = {
						limit = {
							free_district_slots < 0
							free_building_slots < 0
							has_building = building_factory_1
							owner = { has_monthly_income = { resource = consumer_goods value > 20 }}
						}					
						remove_building = building_factory_1
						add_building = building_energy_consortium
					}
					else_if = {
						limit = {
							free_district_slots < 0
							free_building_slots < 0
							has_building = building_foundry_1
							owner = { has_monthly_income = { resource = alloys value > 20 }}
						}					
						remove_building = building_foundry_1
						add_building = building_energy_consortium
					}
				}
				
				# Minerals deficit and alloys or energy surplus due to Admiral bug
				if = {
					limit = {
						owner = { has_monthly_income = { resource = minerals value < 0 }}
						owner = { has_monthly_income = { resource = alloys value > 30 }}
						has_building = building_foundry_1
						free_jobs > 2
					}
					remove_building = building_foundry_1
				}
				else_if = {
					limit = {
						owner = { has_monthly_income = { resource = minerals value < 10 }}
						owner = { has_monthly_income = { resource = alloys value > 50 }}
						has_building = building_foundry_2
						free_jobs > 4
					}
					remove_building = building_foundry_2
				}
				else_if = {
					limit = {
						owner = { has_monthly_income = { resource = minerals value < 0 }}
						owner = { has_monthly_income = { resource = alloys value > 50 }}
						has_building = building_foundry_2
						free_jobs > 1
					}
					remove_building = building_foundry_2
					add_building = building_mining_consortium
				}
				
				if = {
					limit = {
						owner = { has_monthly_income = { resource = energy value > 200 }}
						owner = { has_monthly_income = { resource = minerals value < 100 }}
						has_building = building_energy_consortium
						free_jobs > 2
					}
					remove_building = building_energy_consortium
				}
				if = {
					limit = {
						owner = { has_monthly_income = { resource = minerals value > 100 }}
						owner = { has_monthly_income = { resource = energy value < 50 }}
						has_building = building_mining_consortium
						free_jobs > 1
					}
					remove_building = building_mining_consortium
					add_building = building_energy_consortium
				}
				
				# Crime and Instability
				if = {
					limit = { planet_is_unlawful = yes }
					if = {
						limit = { 
							free_building_slots > 0
							free_jobs < 2
						}
						add_building = building_precinct_house
					}
					else_if = {
						limit = { has_building = building_family_planning }
						remove_building = building_family_planning
						add_building = building_precinct_house
					}
					else_if = {
						limit = { 
							has_building = building_energy_consortium
							owner = { has_monthly_income = { resource = energy value > 25 }}
						}
						remove_building = building_energy_consortium
						add_building = building_precinct_house						
					}
					else_if = {
						limit = { 
							has_building = building_mining_consortium
							owner = { has_monthly_income = { resource = minerals value > 25 }}
						}
						remove_building = building_mining_consortium
						add_building = building_precinct_house
					}
					else_if = {
						limit = { has_building = building_holo_theatres }
						remove_building = building_holo_theatres
						add_building = building_precinct_house
					}
					else_if = {
						limit = { has_building = building_research_lab_1 }
						remove_building = building_research_lab_1
						add_building = building_precinct_house
					}					
				}
				
				# Amenities
				if = {
					limit = { planet_is_bored = yes }
					if = {
						limit = { 
							free_building_slots > 0
							free_jobs < 2
						}
						add_building = building_holo_theatres
					}
					else_if = {
						limit = { has_building = building_family_planning }
						remove_building = building_family_planning
						add_building = building_holo_theatres
					}
					else_if = {
						limit = { 
							has_building = building_mining_consortium
							owner = { has_monthly_income = { resource = minerals value > 50 }}
						}
						remove_building = building_mining_consortium
						add_building = building_holo_theatres
					}
					else_if = {
						limit = { 
							has_building = building_energy_consortium
							owner = { has_monthly_income = { resource = energy value > 50 }}
						}
						remove_building = building_energy_consortium
						add_building = building_holo_theatres						
					}
					else_if = {
						limit = { has_building = building_research_lab_1 }
						remove_building = building_research_lab_1
						add_building = building_holo_theatres						
					}					
				}
				
				# Create More Jobs
				if = {
					limit = { planet_is_ready_to_grow = yes }
					if = {
						limit = {
							not = { has_building = building_factory_1 }
							owner = { has_monthly_income = { resource = minerals value > 25 }}
							owner = { has_monthly_income = { resource = consumer_goods value < 25 }}
							owner = { country_uses_consumer_goods = yes }
						}
						add_building = building_factory_1					
					}
					else_if = {
						limit = {
							not = { has_building = building_foundry_1 }
							owner = { has_monthly_income = { resource = minerals value > 25 }}
							owner = { has_monthly_income = { resource = alloys value < 25 }}
						}
						add_building = building_foundry_1					
					}
					else_if = {
						limit = { owner = { has_monthly_income = { resource = energy value < 10 }}}
						add_building = building_energy_consortium					
					}
					else_if = {
						limit = { owner = { has_monthly_income = { resource = minerals value < 10 }}}
						add_building = building_mining_consortium					
					}
					else_if = {
						limit = {
							num_buildings = { type = building_factory_1 value < 2 }
							owner = { is_at_war = no }
							owner = { has_monthly_income = { resource = minerals value > 50 }}
							owner = { has_monthly_income = { resource = consumer_goods value < 50 }}
							owner = { country_uses_consumer_goods = yes }
						}
						add_building = building_factory_1				
					}
					else_if = {
						limit = {
							num_buildings = { type = building_foundry_1 value < 2 }
							owner = { is_at_war = yes }
							owner = { has_monthly_income = { resource = minerals value > 50 }}
							owner = { has_monthly_income = { resource = alloys value < 50 }}
						}
						add_building = building_foundry_1					
					}
					else_if = {
						limit = {
							owner = { has_monthly_income = { resource = consumer_goods value > 10 }}
							num_buildings = { type = building_research_lab_1 value < 2 }
						}
						add_building = building_research_lab_1					
					}
					else_if = {
						limit = { owner = { has_monthly_income = { resource = energy value < 25 }}}
						add_building = building_energy_consortium					
					}
					else_if = {
						limit = { owner = { has_monthly_income = { resource = minerals value < 25 }}}
						add_building = building_mining_consortium					
					}
					else_if = {
						limit = {
							free_amenities < 20
							not = { has_building = building_holo_theatres }
						}
						add_building = building_holo_theatres				
					}
					else = { add_building = building_commercial_zone }
				}
				
				# Unemployment
				if = {
					limit = { any_owned_pop = { is_unemployed = yes }}
					if = {
						limit = { 
							num_free_districts = { type = district_generator value > 1 }
							owner = { has_monthly_income = { resource = energy value < 50 }}
						}
						add_district = district_generator
					}
					else_if = {
						limit = { 
							num_free_districts = { type = district_farming value > 1 }
							owner = { 
								country_uses_food = yes
								has_monthly_income = { resource = food value < 25 }
							}
						}
						add_district = district_farming					
					}
					else_if = {
						limit = { 
							num_free_districts = { type = district_mining value > 0 }
							owner = { has_monthly_income = { resource = minerals value < 75 }}
						}
						add_district = district_mining				
					}
					else_if = {
						limit = { free_building_slots > 1 }
						if = {
							limit = { 
								not = { has_building = building_factory_1 }
								owner = { has_monthly_income = { resource = consumer_goods value < 25 }}
								owner = { country_uses_consumer_goods = yes }
							}
							add_building = building_factory_1					
						}
						else_if = {
							limit = { 
								owner = { has_monthly_income = { resource = minerals value > 50 }}
								owner = { has_monthly_income = { resource = alloys value < 75 }}
							}
							add_building = building_foundry_1							
						}
						else_if = {
							limit = {
								owner = { has_monthly_income = { resource = consumer_goods value > 25 }}
								free_amenities < 10
							}
							add_building = building_holo_theatres				
						}
						else_if = {
							limit = { 
								owner = { has_monthly_income = { resource = consumer_goods value > 20 }}
							}
							add_building = building_research_lab_1					
						}
						else = { add_building = building_commercial_zone }
					}
				}
				
				# Research > Alloys when not at war
				if = {
					limit = {
						has_building = building_foundry_1
						owner = { is_at_war = no }
						owner = { has_monthly_income = { resource = alloys value > 20 }}
						owner = { has_monthly_income = { resource = consumer_goods value > 20 }}
					}
					remove_building = building_foundry_1
					add_building = building_research_lab_1
				}
				
				# CGs > Alloys when not at war
				if = {
					limit = {
						has_building = building_foundry_1
						owner = { is_at_war = no }
						owner = { has_monthly_income = { resource = alloys value > 25 }}
						owner = { has_monthly_income = { resource = consumer_goods value < 25 }}
						owner = { country_uses_consumer_goods = yes }
					}
					remove_building = building_foundry_1
					add_building = building_factory_1
				}

				# Alloys > CGs when at war
				if = {
					limit = {
						has_building = building_factory_1
						owner = { is_at_war = yes }
						owner = { has_monthly_income = { resource = alloys value < 50 }}
						owner = { has_monthly_income = { resource = consumer_goods value > 20 }}
					}
					remove_building = building_factory_1
					add_building = building_foundry_1
				}
				
				# Alloys > Research when at war
				if = {
					limit = {
						has_building = building_research_lab_1
						owner = { is_at_war = yes }
						owner = { has_monthly_income = { resource = alloys value < 50 }}
						owner = { has_monthly_income = { resource = minerals value > 25 }}
					}
					remove_building = building_research_lab_1
					add_building = building_foundry_1
				}
				
				# Uncleared blockers - just get rid of them
				if = {
					limit = { free_district_slots < 2 }
					clear_blockers = yes
				}
				
				# Economic Fine Tuning - surplus is wasting space
				if = {
					limit = {
						free_housing > 3
						free_jobs > 3
						free_district_slots < 2
						not = { any_owned_pop = { is_unemployed = yes }}
					}
					if = {
						limit = {
							has_district = district_industrialised
							owner = { 
								has_monthly_income = { resource = consumer_goods value > 150 }
								has_monthly_income = { resource = alloys value > 75 }
								resource_stockpile_compare = { resource = consumer_goods value > 5000 }
								resource_stockpile_compare = { resource = alloys value > 2500 }
							}
						}
						remove_district = district_industrialised
					}
				}
				if = {
					limit = {
						free_housing > 4
						free_jobs > 3
						free_district_slots < 2
						not = { any_owned_pop = { is_unemployed = yes }}
					}
					if = {
						limit = {
							has_district = district_farming
							owner = {
								has_monthly_income = { resource = food value > 150 }
								resource_stockpile_compare = { resource = food value > 5000 }
							}
						}
						remove_district = district_farming
					}
				}
				if = {
					limit = {
						free_housing > 3
						free_jobs > 3
						free_district_slots < 2
						not = { any_owned_pop = { is_unemployed = yes }}
					}
					if = {
						limit = {
							has_district = district_mining
							owner = {
								has_monthly_income = { resource = minerals value > 500 }
								resource_stockpile_compare = { resource = minerals value > 12000 }
							}
						}
						remove_district = district_mining
					}
				}
				if = {
					limit = {
						free_housing > 3
						free_jobs > 3
						free_district_slots < 2
						not = { any_owned_pop = { is_unemployed = yes }}
					}
					if = {
						limit = {
							has_district = district_generator
							owner = {
								has_monthly_income = { resource = energy value > 250 }
								resource_stockpile_compare = { resource = energy value > 10000 }
							}
						}
						remove_district = district_generator
					}
				}
				
				# Housing
				if = {
					limit = {
						free_housing > 8
						not = { has_planet_flag = pf_mega_cities }
						num_districts = { type = district_city value > 5 }
						num_pops > 90
					}
					set_planet_flag = pf_mega_cities
					owner = { add_resource = { minerals = -4000 }}
				}
				if = {
					limit = {
						needs_more_housing = yes
						not = { has_planet_flag = pf_mega_cities }
						num_districts = { type = district_city value > 7 }
					}
					set_planet_flag = pf_mega_cities
					owner = { add_resource = { minerals = -6000 }}
				}
				else_if = {
					limit = {
						needs_more_housing = yes
						not = { has_planet_flag = pf_mega_cities }
						num_free_districts = { type = district_city value > 0 }
					}
					add_district = district_city
				}
				else_if = {
					limit = {
						needs_more_housing = yes
						has_planet_flag = pf_mega_cities
						num_free_districts = { type = district_megacity value > 0 }
					}
					add_district = district_megacity
				}
				else_if = {
					limit = { free_housing < -1 }
					clear_blockers = yes
				}
				
				# Overcrowding - pointless unemployed pops lags up the game
				if = {
					limit = {
						any_owned_pop = { is_unemployed = yes }
						num_pops > 90
					}
					if = {
						limit = { free_building_slots > 1 }
						if = {
							limit = {
								exists = owner
								owner = { is_at_war = yes }
							}
							add_building = building_stronghold
						}
						else_if = {
							limit = { free_amenities < 50 }
							add_building = building_holo_theatres
						}
						else_if = {
							limit = { planet_crime > 0 }
							add_building = building_precinct_house						
						}
						else = {
							random_list = {
								25 = {
									add_building = building_commercial_zone
								}
								25 = {
									add_building = building_research_lab_1
								}
								25 = {
									add_building = building_mining_consortium
								}
								25 = {
									add_building = building_energy_consortium
								}
							}
						}
					}
					else = {
						kill_the_unemployed = yes
						kill_the_unemployed = yes
						kill_the_unemployed = yes
					}
				}
				
				# Homeless pops are pointless
				if = {
					limit = {
						free_housing < -2
						num_pops > 92
						free_building_slots < 2
						free_district_slots < 2					
					}
					random_owned_pop = {
						limit = {
							or = {
								is_unemployed = yes
								has_job = job_clerk
							}
						}
						kill_pop = yes
					}
					random_owned_pop = {
						limit = {
							or = {
								is_unemployed = yes
								has_job = job_clerk
							}
						}
						kill_pop = yes
					}
					if = {
						limit = {
							num_districts = { type = district_city value > 3 }
							not = { has_planet_flag = pf_mega_cities }
							exists = owner
							owner = {
								resource_stockpile_compare = {
									resource = minerals
									value > 5000
								}
							}
						}
						set_planet_flag = pf_mega_cities
						add_district = district_megacity
						owner = { add_resource = { minerals = -4000 }}
					}
				}
				
				# Free housing and free building slots means convert districts to buildings
				if = {
					limit = {
						free_building_slots > 1
						free_housing > 3
					}
					if = {
						limit = {
							num_districts = { type = district_industrialised value > 0 }
							owner = { has_monthly_income = { resource = consumer_goods value < 25 }}
							owner = { country_uses_consumer_goods = yes }
						}
						remove_district = district_industrialised
						add_building = building_factory_1
					}						
				}
				if = {
					limit = {
						free_building_slots > 1
						free_housing > 3
					}
					if = {
						limit = {
							num_districts = { type = district_generator value > 0 }
							owner = { has_monthly_income = { resource = energy value < 50 }}
						}
						remove_district = district_generator
						add_building = building_energy_consortium
					}						
				}
				if = {
					limit = {
						free_building_slots > 1
						free_housing > 4
					}
					if = {
						limit = {
							num_districts = { type = district_mining value > 0 }
							owner = { has_monthly_income = { resource = minerals value < 200 }}
						}
						remove_district = district_mining
						add_building = building_mining_consortium
					}						
				}
				
				# If there is a need for jobs and has emergency buildings, replace them
				if = {
					limit = {
						has_building = building_goods_bank
						free_jobs < 3
						owner = { country_uses_consumer_goods = yes }
					}
					remove_building = building_goods_bank
					add_building = building_factory_1						
				}
				if = {
					limit = {
						has_building = building_food_bank
						num_free_districts = { type = district_farming value > 0 }
						free_jobs < 3
					}
					remove_building = building_food_bank
					add_district = district_farming						
				}
				
				# Stop stockpiling like you were supposed to
				if = {
					limit = { 
						has_planet_flag = preserving_fuels
						owner = {
							resource_stockpile_compare = {
								resource = sr_natural_fuels
								value > 3000
							}
							resource_stockpile_compare = {
								resource = energy
								value < 10000
							}
							has_monthly_income = {
								resource = sr_natural_fuels
								value > -1
							}
						}
					}
					remove_planet_flag = preserving_fuels
					remove_modifier = plm_preserving_fuels
				}
				if = {
					limit = { 
						has_planet_flag = preserving_ice
						owner = {
							resource_stockpile_compare = {
								resource = sr_ice
								value > 2000
							}
							resource_stockpile_compare = {
								resource = food
								value < 10000
							}
							has_monthly_income = {
								resource = sr_ice
								value > -1
							}
						}
					}
					remove_planet_flag = preserving_ice
					remove_modifier = plm_preserving_ice
				}
				if = {
					limit = { 
						has_planet_flag = preserving_actinides
						owner = {
							resource_stockpile_compare = {
								resource = sr_actinides
								value > 2000
							}
							resource_stockpile_compare = {
								resource = energy
								value < 10000
							}
							has_monthly_income = {
								resource = sr_actinides
								value > -1
							}
						}	
					}
					remove_planet_flag = preserving_actinides
					remove_modifier = plm_preserving_actinides
				}
				
				# Surplus getting in the way
				if = {
					limit = {
						free_housing > 9
						num_districts = { type = district_city value > 0 }
						free_jobs > 2
					}
					remove_district = district_city
				}
				else_if = {
					limit = {
						free_housing > 9
						num_districts = { type = district_city value > 0 }
						free_jobs < 1
						free_district_slots < 1
					}
					remove_district = district_city
					random_list = {
						33 = { add_district = district_farming }
						33 = { add_district = district_mining }
						33 = { add_district = district_generator }
					}
				}				
				else_if = {
					limit = {
						free_housing > 15
						num_districts = { type = district_megacity value > 0 }
						free_jobs > 4
					}
					remove_district = district_megacity
				}
				else_if = {
					limit = {
						free_housing > 15
						num_districts = { type = district_megacity value > 0 }
						free_jobs < 1
						free_district_slots < 1
					}
					remove_district = district_megacity
					random_list = {
						33 = { add_district = district_farming }
						33 = { add_district = district_mining }
						33 = { add_district = district_generator }
					}
				}
				
				if = {
					limit = {
						has_building = building_commercial_zone
						free_jobs > 4
						free_amenities > 25
						owner = {
							has_monthly_income = {
								resource = energy
								value > 150
							}
							has_monthly_income = {
								resource = consumer_goods
								value > 75
							}
						}
					}
					remove_building = building_commercial_zone
				}
				
				# Shortages rectified by removing surplus
				if = {
					limit = {
						num_districts = { type = district_mining value > 0 }
						num_free_districts = { type = district_farming value > 0 }
						owner = {
							country_uses_food = yes
							has_monthly_income = { resource = minerals value > 50 }
							resource_stockpile_compare = { resource = minerals value > 1000 }
							has_monthly_income = { resource = food value < 2 }
						}
					}
					remove_district = district_mining
					add_district = district_farming
				}
				if = {
					limit = {
						num_districts = { type = district_mining value > 0 }
						has_building = building_goods_bank
						owner = { country_uses_consumer_goods = yes }
						owner = {
							has_monthly_income = {
								resource = minerals
								value > 100
							}
							resource_stockpile_compare = {
								resource = minerals
								value > 2000
							}
							has_monthly_income = {
								resource = consumer_goods
								value < 6
							}
						}
					}
					remove_district = district_mining
					remove_building = building_goods_bank
					add_building = building_factory_1
				}
				if = {
					limit = {
						num_districts = { type = district_mining value > 0 }
						num_free_districts = { type = district_industrialised value > 0 }
						owner = {
							has_monthly_income = {
								resource = minerals
								value > 120
							}
							resource_stockpile_compare = {
								resource = minerals
								value > 5000
							}
							has_monthly_income = {
								resource = consumer_goods
								value < 2
							}
						}
					}
					remove_district = district_mining
					add_district = district_industrialised
				}						
				if = {
					limit = {
						has_district = district_generator
						num_free_districts = { type = district_farming value > 0 }
						owner = {
							country_uses_food = yes
							has_monthly_income = {
								resource = energy
								value > 100
							}
							resource_stockpile_compare = {
								resource = energy
								value > 500
							}
							has_monthly_income = {
								resource = food
								value < 2
							}
						}
					}
					remove_district = district_generator
					add_district = district_farming
				}
				if = {
					limit = {
						has_district = district_farming
						num_free_districts = { type = district_generator value > 0 }
						owner = {
							has_monthly_income = {
								resource = energy
								value < 2
							}
							resource_stockpile_compare = {
								resource = energy
								value < 500
							}
							has_monthly_income = {
								resource = food
								value > 100
							}
							resource_stockpile_compare = {
								resource = food
								value > 500
							}
						}
					}
					remove_district = district_farming
					add_district = district_generator
				}
				
				# Minerals shortages are rare
				if = {
					limit = {
						num_free_districts = { type = district_mining value > 0 }
						free_jobs < 5
						num_pops > 25
						owner = { has_monthly_income = { resource = minerals value < 25 }}
					}
					add_district = district_mining
				}
				if = {
					limit = {
						has_building = building_factory_1
						owner = {
							has_monthly_income = {
								resource = minerals
								value < 50
							}
						}
						owner = {
							has_monthly_income = {
								resource = consumer_goods
								value > 75
							}
						}
					}
					remove_building = building_factory_1
					add_building = building_mining_consortium
				}
				if = {
					limit = {
						num_free_districts = { type = district_mining value > 0 }
						num_districts = { type = district_industrialised value > 0 }
						owner = {
							has_monthly_income = {
								resource = minerals
								value < 50
							}
						}
						owner = {
							has_monthly_income = {
								resource = consumer_goods
								value > 75
							}
						}
					}
					remove_district = district_industrialised
					add_district = district_mining
				}
				
				# Consumer Goods deficit
				if = {
					limit = {
						has_building = building_mining_consortium
						owner = { country_uses_consumer_goods = yes }
						owner = {
							has_monthly_income = {
								resource = consumer_goods
								value < 5
							}
						}
						owner = {
							has_monthly_income = {
								resource = minerals
								value > 150
							}
						}
					}
					remove_building = building_mining_consortium
					add_building = building_factory_1
				}
				if = {
					limit = {
						num_districts = { type = district_generator value > 1 }
						free_housing > 3
						free_building_slots > 0
						owner = { has_monthly_income = { resource = consumer_goods value < 10 }}
						owner = { has_monthly_income = { resource = energy value > 150 }}
					}
					remove_district = district_generator
					add_building = building_factory_1
				}
				if = {
					limit = {
						has_building = building_research_lab_1
						has_tanked_goods = yes
						owner = { country_uses_consumer_goods = yes }
					}
					remove_building = building_research_lab_1
					add_building = building_factory_1
				}
				
				# Alloys deficit
				if = {
					limit = {
						has_building = building_mining_consortium
						owner = {
							has_monthly_income = {
								resource = alloys
								value < 5
							}
						}
						owner = {
							has_monthly_income = {
								resource = minerals
								value > 150
							}
						}
					}
					remove_building = building_mining_consortium
					add_building = building_foundry_1
				}
				if = {
					limit = {
						num_districts = { type = district_generator value > 1 }
						free_housing > 3
						free_building_slots > 0
						owner = {
							has_monthly_income = {
								resource = alloys
								value < 5
							}
						}
						owner = {
							has_monthly_income = {
								resource = energy
								value > 150
							}
						}
					}
					remove_district = district_generator
					add_building = building_foundry_1
				}
				
				# Alloys and CGs deficit
				if = {
					limit = {
						free_housing > 1
						num_districts = { type = district_generator value > 1 }
						num_free_districts = { type = district_industrialised value > 0 }
						owner = {
							has_monthly_income = {
								resource = energy
								value > 150
							}
						}
						owner = {
							has_monthly_income = {
								resource = alloys
								value < 10
							}
						}
						owner = {
							has_monthly_income = {
								resource = consumer_goods
								value < 10
							}
						}
					}
					remove_district = district_generator
					add_district = district_industrialised
				}
				
				# District spam
				if = {
					limit = {
						has_too_many_comm_districts = yes
					}
					remove_district = district_community
					remove_district = district_labour_camp
					remove_district = district_markettowns
					remove_district = district_parish
					remove_district = district_securityzone
					remove_district = district_warrior_house
					remove_district = district_campus
					remove_district = district_culture_commune
				}

				# Homeworld with too many empty building slots
				if = {
					limit = {
						or = {
							is_homeworld = yes
							is_capital = yes
						}
						free_building_slots > 3
						num_pops > 50
						owner = { has_monthly_income = { resource = minerals value < 200 }}
					}
					add_building = building_mining_consortium
				}
				if = {
					limit = {
						or = {
							is_homeworld = yes
							is_capital = yes
						}
						free_building_slots > 3
						num_pops > 50
						owner = { has_monthly_income = { resource = energy value < 100 }}
					}
					add_building = building_energy_consortium
				}				
				if = {
					limit = {
						or = {
							is_homeworld = yes
							is_capital = yes
						}
						free_building_slots > 3
						free_jobs < 3
						num_pops > 50
					}
					add_building = building_research_lab_1
				}
				if = {
					limit = {
						or = {
							is_homeworld = yes
							is_capital = yes
						}
						free_building_slots > 2
						num_pops > 50
						owner = { has_monthly_income = { resource = minerals value < 200 }}
					}
					add_building = building_mining_consortium
				}
				if = {
					limit = {
						or = {
							is_homeworld = yes
							is_capital = yes
						}
						free_building_slots > 2
						num_pops > 50
						owner = { has_monthly_income = { resource = energy value < 100 }}
					}
					add_building = building_energy_consortium
				}				
				if = {
					limit = {
						or = {
							is_homeworld = yes
							is_capital = yes
						}
						free_building_slots > 2
						free_jobs < 3
						num_pops > 50
					}
					add_building = building_research_lab_1
				}
				if = {
					limit = {
						or = {
							is_homeworld = yes
							is_capital = yes
						}
						free_building_slots > 2
						free_jobs < 10
						num_pops > 50
					}
					add_building = building_research_lab_1
				}				

				# Last resort
				if = {
					limit = { situation_fubar = yes }
					kill_the_redundant = yes
				}
				check_planet_employment = yes
			}
		}
	}
}