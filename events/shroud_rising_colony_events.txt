###########################################################

# Shroud Rising Colony Events
# Written by LastLeviathan

###########################################################

namespace = shroud_rising_colony

###########################################################
# shroud_rising_colony.1 | Whispers Beckon
# shroud_rising_colony.2 | Discover Temple
# shroud_rising_colony.3 | Choose a patron (small advantage) or destroy 
# shroud_rising_colony.4 | Ask for sacrifice (Small or big)
# shroud_rising_colony.5 | Refused and spawns a monster
# shroud_rising_colony.6 | Spawn entities
# shroud_rising_colony.7 | Spawn a Horror
###########################################################

#whispers beckon
planet_event = {
	id = shroud_rising_colony.1
	title = "shroud_rising_colony.1.name"
	desc = "shroud_rising_colony.1.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_psionic
	location = ROOT	

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}

	trigger = {
		owner = {
			NOT = { has_authority = auth_machine_intelligence }
		}
		num_pops > 0
		habitable_planet = yes
		is_artificial = no		
	}

	is_triggered_only = yes

	immediate = {						
	}

	option = {
		name = shroud_rising_colony.1.a		
		hidden_effect = {
			planet_event = { id = shroud_rising_colony.2 days = 60 }	
		}
	}
}

#temple discovered
planet_event = {
	id = shroud_rising_colony.2
	title = "shroud_rising_colony.2.name"
	desc = "shroud_rising_colony.2.desc"
	picture = GFX_evt_habitable_dig_site
	show_sound = event_alien_nature
	location = ROOT	
	is_triggered_only = yes

	trigger = {
	
	}

	is_triggered_only = yes

	immediate = {		
		set_planet_flag = colony_event
		
	}

	option = {
		name = shroud_rising_colony.2.a	
		add_deposit = d_shroud_temple
		hidden_effect = {
			planet_event = { id = shroud_rising_colony.3 days = 60 }	
		}
	}
}

#choose a patron or destroy
planet_event = {
	id = shroud_rising_colony.3
	title = "shroud_rising_colony.3.name"
	desc = "shroud_rising_colony.3.desc"
	picture = GFX_evt_surreal_visions
	show_sound = event_psionic
	location = ROOT	
	is_triggered_only = yes

	trigger = {
	
	}

	is_triggered_only = yes

	immediate = {		
			
	}
	
	#Composer of Strands
	option = {
		name = shroud_rising_colony.3.a
		custom_tooltip = shroud_rising_colony.3.a.tooltip
		add_modifier = { modifier = "shroud_composer_effect" }
		hidden_effect = {
			planet_event = { id = shroud_rising_colony.4 days = 720 }
			set_global_flag = colony_composer_patron
		}
	}
	#Eater of Worlds
	option = {
		name = shroud_rising_colony.3.b
		custom_tooltip = shroud_rising_colony.3.b.tooltip
		add_modifier = { modifier = "shroud_eater_effect" }
		hidden_effect = {
			planet_event = { id = shroud_rising_colony.4 days = 720 }	
			set_global_flag = colony_eater_patron
		}
	}
	#Instrument of Desire
	option = {
		name = shroud_rising_colony.3.c
		custom_tooltip = shroud_rising_colony.3.c.tooltip		
		add_modifier = { modifier = "shroud_desire_effect" }
		hidden_effect = {
			planet_event = { id = shroud_rising_colony.4 days = 720 }	
			set_global_flag = colony_desire_patron
		}	
	}
	#Whisperers in the Void
	option = {
		name = shroud_rising_colony.3.d
		custom_tooltip = shroud_rising_colony.3.d.tooltip
		add_modifier = { modifier = "shroud_whisperer_effect" }
		hidden_effect = {
			planet_event = { id = shroud_rising_colony.4 days = 720 }	
			set_global_flag = colony_whisperers_patron
			}
	}
	#Destroy
	option = {
		name = shroud_rising_colony.3.e
		custom_tooltip = shroud_rising_colony.3.e.tooltip		
		remove_deposit = d_shroud_temple
	}
}

#Ask for sacrifice
planet_event = {
	id = shroud_rising_colony.4
	title = "shroud_rising_colony.4.name"
	desc = "shroud_rising_colony.4.desc"
	picture = GFX_evt_zro_2
	show_sound = event_psionic
	location = ROOT	
	is_triggered_only = yes

	trigger = {
	
	}

	is_triggered_only = yes

	immediate = {						
	}
	
	#sacrifice locals
	option = {
		name = shroud_rising_colony.4.a
		custom_tooltip = shroud_rising_colony.4.a.tooltip
		hidden_effect = {
			planet_event = { id = shroud_rising_colony.6 days = 1 }	
		}
		owner = {
			add_modifier = { modifier = shroud_avatar_gift days = 3600 } 
		}
		random_owned_pop = { kill_pop = yes }
		random_owned_pop = { kill_pop = yes }
		random_owned_pop = { kill_pop = yes }
	}
	#sacrifice planet
	option = {
		name = shroud_rising_colony.4.b
		custom_tooltip = shroud_rising_colony.4.b.tooltip
		hidden_effect = {
			planet_event = { id = shroud_rising_colony.7 days = 1 }
			add_deposit = d_zro_deposit_1
		}
		owner = {
			add_modifier = { modifier = shroud_avatar_gift_2 days = 3600 } 
		}		
	}
	#refuse
	option = {
		name = shroud_rising_colony.4.c	
		custom_tooltip = shroud_rising_colony.4.c.tooltip
		hidden_effect = {	
			planet_event = { id = shroud_rising_colony.5 days = 1 }	
		}
	}
}

#Refused spawn planet monster
planet_event = {
	id = shroud_rising_colony.5
	title = "shroud_rising_colony.5.name"
	desc = "shroud_rising_colony.5.desc"
	picture = GFX_evt_zro_3
	show_sound = event_psionic
	location = ROOT	
	is_triggered_only = yes

	trigger = {
	
	}

	is_triggered_only = yes

	immediate = {
		remove_planet_flag = colony_event
		create_country = {
					name = "NAME_shroud_horror_country"
					type = shroud_entities	
					name_list = "SHROUD_HORRORS"
					flag = {
					icon = {
						category = "special"
						file = "the_shroud.dds"
					}
					background= {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors={
						"dark_purple"
						"black"
						"null"
						"null"
					}
					}
					effect = {						
						apply_shroud_rising_difficulty = yes
						
					}
				}						
				last_created_country = {				
				save_global_event_target_as = shroud_storm_horror
				}		
				every_country = { establish_communications_no_message = event_target:shroud_storm_horror }		
	}
	#pissed of demon
	option = {
		name = shroud_rising_colony.5.a
		remove_deposit = d_shroud_temple
		create_army = {
					name = "NAME_greater_horror_hunger"
					owner = last_created_country
					species = last_created_species
					type = "shroud_greater_horror_army"
					}
		if = {
			limit = {
				has_modifier = "shroud_composer_effect"
			}
			remove_modifier = shroud_composer_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_eater_effect"
			}
			remove_modifier = shroud_eater_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_desire_effect"
			}
			remove_modifier = shroud_desire_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_whisperer_effect"
			}
			remove_modifier = shroud_whisperer_effect			
		}
		hidden_effect = {
			remove_global_flag = colony_desire_patron
			remove_global_flag = colony_composer_patron
			remove_global_flag = colony_eater_patron
			remove_global_flag = colony_whisperers_patron
		}
		random_owned_pop = { kill_pop = yes }
		random_owned_pop = { kill_pop = yes }
		add_planet_devastation = 40
	}
}

#Sacrifice a couple of pops
planet_event = {
	id = shroud_rising_colony.6
	title = "shroud_rising_colony.6.name"
	desc = "shroud_rising_colony.6.desc"
	picture = GFX_evt_space_monster
	show_sound = event_psionic
	location = ROOT	
	is_triggered_only = yes

	trigger = {
	
	}

	is_triggered_only = yes

	immediate = {
		remove_planet_flag = colony_event
		create_country = {
					name = "NAME_shroud_horror_country"
					type = shroud_entities	
					name_list = "SHROUD_HORRORS"
					flag = {
					icon = {
						category = "special"
						file = "the_shroud.dds"
					}
					background= {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors={
						"dark_purple"
						"black"
						"null"
						"null"
					}
					}
					effect = {						
						apply_shroud_rising_difficulty = yes
						
					}
				}
				last_created_country = {									
					set_faction_hostility = {
						set_hostile = no
						set_neutral = yes
						target = root.owner
							
					}
				}
				last_created_country = {				
				save_global_event_target_as = shroud_storm_horror
				}		
				every_country = { establish_communications_no_message = event_target:shroud_storm_horror }
				create_fleet = {
					# name = random
					settings = {
						spawn_debris = no
						is_boss = yes
					}
					effect = {
						set_owner = event_target:shroud_storm_horror				
						create_ship = {
							name = "NAME_shroud_horrors_single"
							design = "NAME_shroud_entity"								
							}				
							
						set_location = root
						set_fleet_stance = aggressive
						set_fleet_bombardment_stance = devour
						set_aggro_range_measure_from = self
						set_aggro_range = 300
						
					
					
					
					}
					
				}
	}
	#oops
	option = {
		name = shroud_rising_colony.6.a
		remove_deposit = d_shroud_temple
		if = {
			limit = {
				has_modifier = "shroud_composer_effect"
			}
			remove_modifier = shroud_composer_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_eater_effect"
			}
			remove_modifier = shroud_eater_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_desire_effect"
			}
			remove_modifier = shroud_desire_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_whisperer_effect"
			}
			remove_modifier = shroud_whisperer_effect
		}
		hidden_effect = {
			remove_global_flag = colony_desire_patron
			remove_global_flag = colony_composer_patron
			remove_global_flag = colony_eater_patron
			remove_global_flag = colony_whisperers_patron
		}
		add_modifier = {
				modifier = eater_unhappiness_planet_1
				days = 1800
		}
	}
	option = {
		name = shroud_rising_colony.6.b
		remove_deposit = d_shroud_temple
		if = {
			limit = {
				has_modifier = "shroud_composer_effect"
			}
			remove_modifier = shroud_composer_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_eater_effect"
			}
			remove_modifier = shroud_eater_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_desire_effect"
			}
			remove_modifier = shroud_desire_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_whisperer_effect"
			}
			remove_modifier = shroud_whisperer_effect
		}
		hidden_effect = {
			remove_global_flag = colony_desire_patron
			remove_global_flag = colony_composer_patron
			remove_global_flag = colony_eater_patron
			remove_global_flag = colony_whisperers_patron
		}
		add_modifier = {
				modifier = eater_unhappiness_planet_1
				days = 1800
		}
	}
}

#Sacrifice planet
planet_event = {
	id = shroud_rising_colony.7
	title = "shroud_rising_colony.7.name"	
	desc = "shroud_rising_colony.7.desc"
	picture = GFX_evt_dimensional_horror
	show_sound = event_psionic
	location = ROOT	
	is_triggered_only = yes
	
	trigger = {
	
	}

	is_triggered_only = yes

	immediate = {
			remove_planet_flag = colony_event
			random_country = {
						limit = { is_country_type = global_event }
						change_variable = {
							which = "shroud_planets"
							value = 1
						}
					}
			
			create_country = {
				name = "NAME_shroud_horror_country"
				type = shroud_horrors
				name_list = "SHROUD_HORRORS"
				flag = {
						icon = {
							category = "special"
							file = "the_shroud.dds"
						}
						background= {
							category = "backgrounds"
							file = "00_solid.dds"
						}
						colors={
							"dark_purple"
							"black"
							"null"
							"null"
						}
					}
				effect = {
						apply_shroud_rising_difficulty = yes
					}
			}			
			last_created_country = {				
				save_global_event_target_as = shroud_horror_fleet
			}
			last_created_country = {									
				set_faction_hostility = {
					set_hostile = no
					set_neutral = yes
					target = root.owner
						
				}
			}
			every_country = { establish_communications_no_message = event_target:shroud_horror_fleet }
			if = {
				limit = {
					has_global_flag = colony_whisperers_patron
				}
				create_fleet = {
							# name = random
							settings = {
							spawn_debris = no
							is_boss = yes
							}
							effect = {
								set_owner = event_target:shroud_horror_fleet				
								create_ship = {
									name = "NAME_greater_horror_whisper"
									design = "NAME_horror_whisper"							
									}						
									
								set_location = root
								set_fleet_stance = aggressive
								set_fleet_bombardment_stance = devour
								set_aggro_range_measure_from = self
								set_aggro_range = 300
								
							
							
							
							}
						
						}
			}
			else_if = {
				limit = {
					has_global_flag = colony_composer_patron
				}
				create_fleet = {
							# name = random
							settings = {
							spawn_debris = no
							is_boss = yes
							}
							effect = {
								set_owner = event_target:shroud_horror_fleet				
								create_ship = {
									name = "NAME_greater_horror_corruption"
									design = "NAME_horror_corruption"								
									}						
									
								set_location = root
								set_fleet_stance = aggressive
								set_fleet_bombardment_stance = devour
								set_aggro_range_measure_from = self
								set_aggro_range = 300
								
							
							
							
							}
						
						}
			}
			else_if = {
				limit = {
					has_global_flag = colony_desire_patron
				}
				create_fleet = {
							# name = random
							settings = {
							spawn_debris = no
							is_boss = yes
							}
							effect = {
								set_owner = event_target:shroud_horror_fleet				
								create_ship = {
									name = "NAME_greater_horror_desire"
									design = "NAME_horror_desire"								
									}						
									
								set_location = root
								set_fleet_stance = aggressive
								set_fleet_bombardment_stance = devour
								set_aggro_range_measure_from = self
								set_aggro_range = 300
								
							
							
							
							}
						
						}
			}
			else_if = {
				limit = {
					has_global_flag = colony_eater_patron
				}
				create_fleet = {
							# name = random
							settings = {
							spawn_debris = no
							is_boss = yes
							}
							effect = {
								set_owner = event_target:shroud_horror_fleet				
								create_ship = {
									name = "NAME_greater_horror_hunger"
									design = "NAME_horror_hunger"										
									}						
									
								set_location = root
								set_fleet_stance = aggressive
								set_fleet_bombardment_stance = devour
								set_aggro_range_measure_from = self
								set_aggro_range = 300
								
							
							
							
							}
						
						}
			}
		random_country = {
			limit = { is_country_type = global_event }
			change_variable = {
				which = "shroud_planets"
				value = 1
			}
		}
		destroy_colony = yes
		reset_planet = yes
		change_pc = pc_shrouded			
		add_modifier = {
			modifier = "devoured_world"
			days = -1
		}
	}
	#my bad
	option = {
		name = shroud_rising_colony.7.a
		remove_deposit = d_shroud_temple
		if = {
			limit = {
				has_modifier = "shroud_composer_effect"
			}
			remove_modifier = shroud_composer_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_eater_effect"
			}
			remove_modifier = shroud_eater_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_desire_effect"
			}
			remove_modifier = shroud_desire_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_whisperer_effect"
			}
			remove_modifier = shroud_whisperer_effect
		}
		hidden_effect = {
			remove_global_flag = colony_desire_patron
			remove_global_flag = colony_composer_patron
			remove_global_flag = colony_eater_patron
			remove_global_flag = colony_whisperers_patron
		}
		
	}
	
	option = {
		name = shroud_rising_colony.7.b
		remove_deposit = d_shroud_temple
		if = {
			limit = {
				has_modifier = "shroud_composer_effect"
			}
			remove_modifier = shroud_composer_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_eater_effect"
			}
			remove_modifier = shroud_eater_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_desire_effect"
			}
			remove_modifier = shroud_desire_effect
		}
		else_if = {
			limit = {
				has_modifier = "shroud_whisperer_effect"
			}
			remove_modifier = shroud_whisperer_effect
		}
		hidden_effect = {
			remove_global_flag = colony_desire_patron
			remove_global_flag = colony_composer_patron
			remove_global_flag = colony_eater_patron
			remove_global_flag = colony_whisperers_patron
		}
		
	}
}